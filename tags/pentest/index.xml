<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PENTEST on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/tags/pentest/</link><description>Recent content in PENTEST on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 06 May 2022 16:52:58 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/tags/pentest/index.xml" rel="self" type="application/rss+xml"/><item><title>DNS域传送漏洞学习</title><link>https://amiaaaz.github.io/2022/05/06/dns-zone-transfer-study-note/</link><pubDate>Fri, 06 May 2022 16:52:58 +0800</pubDate><guid>https://amiaaaz.github.io/2022/05/06/dns-zone-transfer-study-note/</guid><description>&lt;p>DNS服务器提供域名解析的基础性服务，可以细分为主服务器、备份服务器、缓存服务器，备份服务器会从主服务器中拷贝数据来更新自己的数据库，而这个同步的过程中就需要用到DNS域传送，一旦配置不当，就可能会导致任何匿名用户都可以获取DNS服务器某一域的所有记录，泄露重要信息&lt;/p>
&lt;h2 id="漏洞成因">漏洞成因&lt;/h2>
&lt;p>在域传送中关键的配置项有这两个&lt;/p>
&lt;pre tabindex="0">&lt;code>allow-transfer {ipaddress;}; 通过ip限制可进行域传送的服务器
allow-transfer { key transfer; }; 通过key限制可进行域传送的服务器
&lt;/code>&lt;/pre>&lt;p>有两种设置方式，options或是zone，默认优先级为zone 如果为空则遵循options，示例&lt;/p>
&lt;pre tabindex="0">&lt;code>options {
listen-on { 1.1.1.1; };
listen-on-v6 { any; };
directory &amp;#34;/bind&amp;#34;;
pid-file &amp;#34;/bind/run/pid&amp;#34;;
dump-file &amp;#34;/bind/data/named_dump.db&amp;#34;;
statistics-file &amp;#34;/bind/data/named.stats&amp;#34;;
allow-transfer { any; };
allow-query {any;};
};
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>zone &amp;#34;wooyun.org&amp;#34; {
type master;
file &amp;#34;/bind/etc/wooyun.org.conf&amp;#34;;
allow-transfer {any;};
};
&lt;/code>&lt;/pre>&lt;p>如果没有手动添加&lt;code>allow-transfer&lt;/code>来限制获取记录的来源，就会存在DNS域传送漏洞&lt;/p>
&lt;h2 id="检测方式">检测方式&lt;/h2>
&lt;h3 id="dig--linux">dig / linux&lt;/h3>
&lt;p>以vulhub为例，以常规的8.8.8.8作为DNS服务器进行解析，如果发送axfr的请求会failed&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220506160422503.png" alt="image-20220506160422503">&lt;/p>
&lt;p>如果使用存在漏洞的DNS服务器进行查询，则会返回域内所有的字域、A记录和CNAME等信息&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220506160602721.png" alt="image-20220506160602721">&lt;/p>
&lt;h3 id="nslookup--windowslinux">nslookup / windows&amp;amp;linux&lt;/h3>
&lt;p>正常情况：&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220506163501741.png" alt="image-20220506163501741">&lt;/p>
&lt;p>存在漏洞的情况（linux示例）：&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220506164756031.png" alt="image-20220506164756031">&lt;/p>
&lt;h3 id="nmap">Nmap&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nmap -script dns-zone-transfer -script-args dns-zone-transfer.domain&lt;span style="color:#f92672">=&lt;/span>vulhub.org -p &lt;span style="color:#ae81ff">53&lt;/span> -Pn 172.27.0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="dnsrecon">dnsrecon&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dnsrecon -d example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="dnsenum">dnsenum&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>dnsenum example.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
以下是本文中涉及到的 和我学习时看过的所有文章的链接 每日感谢互联网的丰富资源（
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://www.mi1k7ea.com/2021/04/03/%E6%B5%85%E6%9E%90DNS%E5%9F%9F%E4%BC%A0%E9%80%81%E6%BC%8F%E6%B4%9E/">浅析DNS域传送漏洞&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://drops.xmd5.com/static/drops/papers-64.html">DNS域传送信息泄露&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/vulhub/vulhub/blob/master/dns/dns-zone-transfer/README.zh-cn.md">vulhub复现环境&lt;/a>&lt;/p>
&lt;/details></description></item></channel></rss>